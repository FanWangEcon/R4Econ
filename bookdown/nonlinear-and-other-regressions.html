<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Nonlinear and Other Regressions | Data Structures, Estimation and Optimization with R</title>
  <meta name="description" content="<p>Run system executable and shell commands.
Activate conda environment with shell script.</p>" />
  <meta name="generator" content="bookdown 0.23 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Nonlinear and Other Regressions | Data Structures, Estimation and Optimization with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="<p>Run system executable and shell commands.
Activate conda environment with shell script.</p>" />
  <meta name="github-repo" content="fanwangecon/R4Econ" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Nonlinear and Other Regressions | Data Structures, Estimation and Optimization with R" />
  
  <meta name="twitter:description" content="<p>Run system executable and shell commands.
Activate conda environment with shell script.</p>" />
  

<meta name="author" content="Fan Wang" />


<meta name="date" content="2021-09-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="linear-regression.html"/>
<link rel="next" href="optimization.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-92953468-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-92953468-5');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Structures and Estimation with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html"><i class="fa fa-check"></i><b>1</b> Array, Matrix, Dataframe</a>
<ul>
<li class="chapter" data-level="1.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#list"><i class="fa fa-check"></i><b>1.1</b> List</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#lists"><i class="fa fa-check"></i><b>1.1.1</b> Lists</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#array"><i class="fa fa-check"></i><b>1.2</b> Array</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#array-basics"><i class="fa fa-check"></i><b>1.2.1</b> Array Basics</a></li>
<li class="chapter" data-level="1.2.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-arrays"><i class="fa fa-check"></i><b>1.2.2</b> Generate Arrays</a></li>
<li class="chapter" data-level="1.2.3" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#string-arrays"><i class="fa fa-check"></i><b>1.2.3</b> String Arrays</a></li>
<li class="chapter" data-level="1.2.4" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#mesh-matrices-arrays-and-scalars"><i class="fa fa-check"></i><b>1.2.4</b> Mesh Matrices, Arrays and Scalars</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#matrix"><i class="fa fa-check"></i><b>1.3</b> Matrix</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-matrixes"><i class="fa fa-check"></i><b>1.3.1</b> Generate Matrixes</a></li>
<li class="chapter" data-level="1.3.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#linear-algebra"><i class="fa fa-check"></i><b>1.3.2</b> Linear Algebra</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#variables-in-dataframes"><i class="fa fa-check"></i><b>1.4</b> Variables in Dataframes</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-dataframe"><i class="fa fa-check"></i><b>1.4.1</b> Generate Dataframe</a></li>
<li class="chapter" data-level="1.4.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#factor-label-and-combine"><i class="fa fa-check"></i><b>1.4.2</b> Factor Label and Combine</a></li>
<li class="chapter" data-level="1.4.3" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#drawly-random-rows"><i class="fa fa-check"></i><b>1.4.3</b> Drawly Random Rows</a></li>
<li class="chapter" data-level="1.4.4" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-variables-conditional-on-others"><i class="fa fa-check"></i><b>1.4.4</b> Generate Variables Conditional On Others</a></li>
<li class="chapter" data-level="1.4.5" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#string-dataframes"><i class="fa fa-check"></i><b>1.4.5</b> String Dataframes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="summarize-data.html"><a href="summarize-data.html"><i class="fa fa-check"></i><b>2</b> Summarize Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="summarize-data.html"><a href="summarize-data.html#counting-observation"><i class="fa fa-check"></i><b>2.1</b> Counting Observation</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="summarize-data.html"><a href="summarize-data.html#uncount"><i class="fa fa-check"></i><b>2.1.1</b> Uncount</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="summarize-data.html"><a href="summarize-data.html#sorting-indexing-slicing"><i class="fa fa-check"></i><b>2.2</b> Sorting, Indexing, Slicing</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="summarize-data.html"><a href="summarize-data.html#sorting"><i class="fa fa-check"></i><b>2.2.1</b> Sorting</a></li>
<li class="chapter" data-level="2.2.2" data-path="summarize-data.html"><a href="summarize-data.html#group-sort-and-slice"><i class="fa fa-check"></i><b>2.2.2</b> Group, Sort and Slice</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="summarize-data.html"><a href="summarize-data.html#group-statistics"><i class="fa fa-check"></i><b>2.3</b> Group Statistics</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="summarize-data.html"><a href="summarize-data.html#cumulative-statistics-within-group"><i class="fa fa-check"></i><b>2.3.1</b> Cumulative Statistics within Group</a></li>
<li class="chapter" data-level="2.3.2" data-path="summarize-data.html"><a href="summarize-data.html#groups-statistics"><i class="fa fa-check"></i><b>2.3.2</b> Groups Statistics</a></li>
<li class="chapter" data-level="2.3.3" data-path="summarize-data.html"><a href="summarize-data.html#one-variable-group-summary"><i class="fa fa-check"></i><b>2.3.3</b> One Variable Group Summary</a></li>
<li class="chapter" data-level="2.3.4" data-path="summarize-data.html"><a href="summarize-data.html#nested-within-group-stats"><i class="fa fa-check"></i><b>2.3.4</b> Nested within Group Stats</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="summarize-data.html"><a href="summarize-data.html#distributional-statistics"><i class="fa fa-check"></i><b>2.4</b> Distributional Statistics</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="summarize-data.html"><a href="summarize-data.html#histogram"><i class="fa fa-check"></i><b>2.4.1</b> Histogram</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="summarize-data.html"><a href="summarize-data.html#summarize-multiple-variables"><i class="fa fa-check"></i><b>2.5</b> Summarize Multiple Variables</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="summarize-data.html"><a href="summarize-data.html#generate-replace-variables"><i class="fa fa-check"></i><b>2.5.1</b> Generate Replace Variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>3</b> Functions</a>
<ul>
<li class="chapter" data-level="3.1" data-path="functions.html"><a href="functions.html#dataframe-mutate"><i class="fa fa-check"></i><b>3.1</b> Dataframe Mutate</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="functions.html"><a href="functions.html#row-input-functions"><i class="fa fa-check"></i><b>3.1.1</b> Row Input Functions</a></li>
<li class="chapter" data-level="3.1.2" data-path="functions.html"><a href="functions.html#evaluate-choices-across-states"><i class="fa fa-check"></i><b>3.1.2</b> Evaluate Choices Across States</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="functions.html"><a href="functions.html#dataframe-do-anything"><i class="fa fa-check"></i><b>3.2</b> Dataframe Do Anything</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="functions.html"><a href="functions.html#mx1-by-n-to-mxq-by-n1"><i class="fa fa-check"></i><b>3.2.1</b> (Mx1 by N) to (MxQ by N+1)</a></li>
<li class="chapter" data-level="3.2.2" data-path="functions.html"><a href="functions.html#mxp-by-n-to-mx1-by-1"><i class="fa fa-check"></i><b>3.2.2</b> (MxP by N) to (Mx1 by 1)</a></li>
<li class="chapter" data-level="3.2.3" data-path="functions.html"><a href="functions.html#mxp-by-n-to-mxq-by-nz"><i class="fa fa-check"></i><b>3.2.3</b> (MxP by N) to (MxQ by N+Z)</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="functions.html"><a href="functions.html#apply-and-pmap"><i class="fa fa-check"></i><b>3.3</b> Apply and pmap</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="functions.html"><a href="functions.html#apply-and-sapply"><i class="fa fa-check"></i><b>3.3.1</b> Apply and Sapply</a></li>
<li class="chapter" data-level="3.3.2" data-path="functions.html"><a href="functions.html#mutate-evaluate-functions"><i class="fa fa-check"></i><b>3.3.2</b> Mutate Evaluate Functions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html"><i class="fa fa-check"></i><b>4</b> Multi-dimensional Data Structures</a>
<ul>
<li class="chapter" data-level="4.1" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#generate-gather-bind-and-join"><i class="fa fa-check"></i><b>4.1</b> Generate, Gather, Bind and Join</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#generate-panel-structure"><i class="fa fa-check"></i><b>4.1.1</b> Generate Panel Structure</a></li>
<li class="chapter" data-level="4.1.2" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#join-datasets"><i class="fa fa-check"></i><b>4.1.2</b> Join Datasets</a></li>
<li class="chapter" data-level="4.1.3" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#gather-files"><i class="fa fa-check"></i><b>4.1.3</b> Gather Files</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#wide-and-long"><i class="fa fa-check"></i><b>4.2</b> Wide and Long</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#long-to-wide"><i class="fa fa-check"></i><b>4.2.1</b> Long to Wide</a></li>
<li class="chapter" data-level="4.2.2" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#wide-to-long"><i class="fa fa-check"></i><b>4.2.2</b> Wide to Long</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#join-and-compare"><i class="fa fa-check"></i><b>4.3</b> Join and Compare</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#find-closest-neighbor-on-grid"><i class="fa fa-check"></i><b>4.3.1</b> Find Closest Neighbor on Grid</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i><b>5</b> Linear Regression</a>
<ul>
<li class="chapter" data-level="5.1" data-path="linear-regression.html"><a href="linear-regression.html#polynomial-fitting"><i class="fa fa-check"></i><b>5.1</b> Polynomial Fitting</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="linear-regression.html"><a href="linear-regression.html#polynomial-time-series"><i class="fa fa-check"></i><b>5.1.1</b> Polynomial Time Series</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="linear-regression.html"><a href="linear-regression.html#ols-and-iv"><i class="fa fa-check"></i><b>5.2</b> OLS and IV</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="linear-regression.html"><a href="linear-regression.html#ols-and-iv-regression"><i class="fa fa-check"></i><b>5.2.1</b> OLS and IV Regression</a></li>
<li class="chapter" data-level="5.2.2" data-path="linear-regression.html"><a href="linear-regression.html#iv-loop-over-rhs"><i class="fa fa-check"></i><b>5.2.2</b> IV Loop over RHS</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="linear-regression.html"><a href="linear-regression.html#decomposition"><i class="fa fa-check"></i><b>5.3</b> Decomposition</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="linear-regression.html"><a href="linear-regression.html#decompose-rhs"><i class="fa fa-check"></i><b>5.3.1</b> Decompose RHS</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html"><i class="fa fa-check"></i><b>6</b> Nonlinear and Other Regressions</a>
<ul>
<li class="chapter" data-level="6.1" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html#logit-regression"><i class="fa fa-check"></i><b>6.1</b> Logit Regression</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html#binary-logit"><i class="fa fa-check"></i><b>6.1.1</b> Binary Logit</a></li>
<li class="chapter" data-level="6.1.2" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html#logistic-choice-model-with-aggregate-shares"><i class="fa fa-check"></i><b>6.1.2</b> Logistic Choice Model with Aggregate Shares</a></li>
<li class="chapter" data-level="6.1.3" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html#prices-from-aggregate-shares-in-logistic-choice-model"><i class="fa fa-check"></i><b>6.1.3</b> Prices from Aggregate Shares in Logistic Choice Model</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html#quantile-regression"><i class="fa fa-check"></i><b>6.2</b> Quantile Regression</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html#quantile-regression-basics"><i class="fa fa-check"></i><b>6.2.1</b> Quantile Regression Basics</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="optimization.html"><a href="optimization.html"><i class="fa fa-check"></i><b>7</b> Optimization</a>
<ul>
<li class="chapter" data-level="7.1" data-path="optimization.html"><a href="optimization.html#bisection"><i class="fa fa-check"></i><b>7.1</b> Bisection</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="optimization.html"><a href="optimization.html#bisection-1"><i class="fa fa-check"></i><b>7.1.1</b> Bisection</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="mathematics.html"><a href="mathematics.html"><i class="fa fa-check"></i><b>8</b> Mathematics</a>
<ul>
<li class="chapter" data-level="8.1" data-path="mathematics.html"><a href="mathematics.html#basics"><i class="fa fa-check"></i><b>8.1</b> Basics</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="mathematics.html"><a href="mathematics.html#log-with-different-bases-and-exponents"><i class="fa fa-check"></i><b>8.1.1</b> Log with Different Bases and Exponents</a></li>
<li class="chapter" data-level="8.1.2" data-path="mathematics.html"><a href="mathematics.html#rescale-a-parameter-with-fixed-min-and-max"><i class="fa fa-check"></i><b>8.1.2</b> Rescale a Parameter with Fixed Min and Max</a></li>
<li class="chapter" data-level="8.1.3" data-path="mathematics.html"><a href="mathematics.html#find-nearest"><i class="fa fa-check"></i><b>8.1.3</b> Find Nearest</a></li>
<li class="chapter" data-level="8.1.4" data-path="mathematics.html"><a href="mathematics.html#linear-scalar-fx0-solutions"><i class="fa fa-check"></i><b>8.1.4</b> Linear Scalar f(x)=0 Solutions</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="mathematics.html"><a href="mathematics.html#production-function"><i class="fa fa-check"></i><b>8.2</b> Production Function</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="mathematics.html"><a href="mathematics.html#nested-ces-production-function"><i class="fa fa-check"></i><b>8.2.1</b> Nested CES Production Function</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="mathematics.html"><a href="mathematics.html#inequality-models"><i class="fa fa-check"></i><b>8.3</b> Inequality Models</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="mathematics.html"><a href="mathematics.html#gini-discrete-sample"><i class="fa fa-check"></i><b>8.3.1</b> GINI Discrete Sample</a></li>
<li class="chapter" data-level="8.3.2" data-path="mathematics.html"><a href="mathematics.html#gini-formula-for-discrete-random-varialbe"><i class="fa fa-check"></i><b>8.3.2</b> GINI Formula for Discrete Random Varialbe</a></li>
<li class="chapter" data-level="8.3.3" data-path="mathematics.html"><a href="mathematics.html#atkinson-inequality-index"><i class="fa fa-check"></i><b>8.3.3</b> Atkinson Inequality Index</a></li>
<li class="chapter" data-level="8.3.4" data-path="mathematics.html"><a href="mathematics.html#location-population-and-pollution"><i class="fa fa-check"></i><b>8.3.4</b> Location, Population, and Pollution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="statistics.html"><a href="statistics.html"><i class="fa fa-check"></i><b>9</b> Statistics</a>
<ul>
<li class="chapter" data-level="9.1" data-path="statistics.html"><a href="statistics.html#random-draws"><i class="fa fa-check"></i><b>9.1</b> Random Draws</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="statistics.html"><a href="statistics.html#randomly-perturbing-a-parameter"><i class="fa fa-check"></i><b>9.1.1</b> Randomly Perturbing a Parameter</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="statistics.html"><a href="statistics.html#distributions"><i class="fa fa-check"></i><b>9.2</b> Distributions</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="statistics.html"><a href="statistics.html#integrate-over-normal-guassian-process-shock"><i class="fa fa-check"></i><b>9.2.1</b> Integrate Over Normal Guassian Process Shock</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="statistics.html"><a href="statistics.html#discrete-random-variable"><i class="fa fa-check"></i><b>9.3</b> Discrete Random Variable</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="statistics.html"><a href="statistics.html#discrete-approximation-of-continuous-random-variables"><i class="fa fa-check"></i><b>9.3.1</b> Discrete Approximation of Continuous Random Variables</a></li>
<li class="chapter" data-level="9.3.2" data-path="statistics.html"><a href="statistics.html#obtaining-joint-distribution-from-marginal-with-rectilinear-restrictions"><i class="fa fa-check"></i><b>9.3.2</b> Obtaining Joint Distribution from Marginal with Rectilinear Restrictions</a></li>
<li class="chapter" data-level="9.3.3" data-path="statistics.html"><a href="statistics.html#obtaining-joint-distribution-from-conditional-with-rectilinear-restrictions"><i class="fa fa-check"></i><b>9.3.3</b> Obtaining Joint Distribution from Conditional with Rectilinear Restrictions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html"><i class="fa fa-check"></i><b>10</b> Tables and Graphs</a>
<ul>
<li class="chapter" data-level="10.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#r-base-plots"><i class="fa fa-check"></i><b>10.1</b> R Base Plots</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#plot-curve-line-and-points"><i class="fa fa-check"></i><b>10.1.1</b> Plot Curve, Line and Points</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#ggplot-line-related-plots"><i class="fa fa-check"></i><b>10.2</b> ggplot Line Related Plots</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#ggplot-line-plot"><i class="fa fa-check"></i><b>10.2.1</b> ggplot Line Plot</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#ggplot-scatter-related-plots"><i class="fa fa-check"></i><b>10.3</b> ggplot Scatter Related Plots</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#ggplot-scatter-plot"><i class="fa fa-check"></i><b>10.3.1</b> ggplot Scatter Plot</a></li>
<li class="chapter" data-level="10.3.2" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#ggplot-multiple-scatter-lines-with-facet-wrap"><i class="fa fa-check"></i><b>10.3.2</b> ggplot Multiple Scatter-Lines with Facet Wrap</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#write-and-read-plots"><i class="fa fa-check"></i><b>10.4</b> Write and Read Plots</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#import-and-export-images"><i class="fa fa-check"></i><b>10.4.1</b> Import and Export Images</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="get-data.html"><a href="get-data.html"><i class="fa fa-check"></i><b>11</b> Get Data</a>
<ul>
<li class="chapter" data-level="11.1" data-path="get-data.html"><a href="get-data.html#environmental-data"><i class="fa fa-check"></i><b>11.1</b> Environmental Data</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="get-data.html"><a href="get-data.html#ecmwf-era5-data"><i class="fa fa-check"></i><b>11.1.1</b> ECMWF ERA5 Data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="code-and-development.html"><a href="code-and-development.html"><i class="fa fa-check"></i><b>12</b> Code and Development</a>
<ul>
<li class="chapter" data-level="12.1" data-path="code-and-development.html"><a href="code-and-development.html#files-in-and-out"><i class="fa fa-check"></i><b>12.1</b> Files In and Out</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="code-and-development.html"><a href="code-and-development.html#file-path"><i class="fa fa-check"></i><b>12.1.1</b> File Path</a></li>
<li class="chapter" data-level="12.1.2" data-path="code-and-development.html"><a href="code-and-development.html#text-to-file"><i class="fa fa-check"></i><b>12.1.2</b> Text to File</a></li>
<li class="chapter" data-level="12.1.3" data-path="code-and-development.html"><a href="code-and-development.html#rmd-to-html"><i class="fa fa-check"></i><b>12.1.3</b> Rmd to HTML</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="code-and-development.html"><a href="code-and-development.html#python-with-r"><i class="fa fa-check"></i><b>12.2</b> Python with R</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="code-and-development.html"><a href="code-and-development.html#reticulate-basics"><i class="fa fa-check"></i><b>12.2.1</b> Reticulate Basics</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="code-and-development.html"><a href="code-and-development.html#command-line"><i class="fa fa-check"></i><b>12.3</b> Command Line</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="code-and-development.html"><a href="code-and-development.html#shell-and-system-commands"><i class="fa fa-check"></i><b>12.3.1</b> Shell and System Commands</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="index-and-code-links.html"><a href="index-and-code-links.html"><i class="fa fa-check"></i><b>A</b> Index and Code Links</a>
<ul>
<li class="chapter" data-level="A.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#array-matrix-dataframe-links"><i class="fa fa-check"></i><b>A.1</b> Array, Matrix, Dataframe links</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.1-listlist-links"><i class="fa fa-check"></i><b>A.1.1</b> <span>Section 1.1 List</span> links</a></li>
<li class="chapter" data-level="A.1.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.2-arrayarray-links"><i class="fa fa-check"></i><b>A.1.2</b> <span>Section 1.2 Array</span> links</a></li>
<li class="chapter" data-level="A.1.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.3-matrixmatrix-links"><i class="fa fa-check"></i><b>A.1.3</b> <span>Section 1.3 Matrix</span> links</a></li>
<li class="chapter" data-level="A.1.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.4-variables-in-dataframesvariables-in-dataframes-links"><i class="fa fa-check"></i><b>A.1.4</b> <span>Section 1.4 Variables in Dataframes</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#summarize-data-links"><i class="fa fa-check"></i><b>A.2</b> Summarize Data links</a>
<ul>
<li class="chapter" data-level="A.2.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.1-counting-observationcounting-observation-links"><i class="fa fa-check"></i><b>A.2.1</b> <span>Section 2.1 Counting Observation</span> links</a></li>
<li class="chapter" data-level="A.2.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.2-sorting-indexing-slicingsorting-indexing-slicing-links"><i class="fa fa-check"></i><b>A.2.2</b> <span>Section 2.2 Sorting, Indexing, Slicing</span> links</a></li>
<li class="chapter" data-level="A.2.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.3-group-statisticsgroup-statistics-links"><i class="fa fa-check"></i><b>A.2.3</b> <span>Section 2.3 Group Statistics</span> links</a></li>
<li class="chapter" data-level="A.2.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.4-distributional-statisticsdistributional-statistics-links"><i class="fa fa-check"></i><b>A.2.4</b> <span>Section 2.4 Distributional Statistics</span> links</a></li>
<li class="chapter" data-level="A.2.5" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.5-summarize-multiple-variablessummarize-multiple-variables-links"><i class="fa fa-check"></i><b>A.2.5</b> <span>Section 2.5 Summarize Multiple Variables</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#functions-links"><i class="fa fa-check"></i><b>A.3</b> Functions links</a>
<ul>
<li class="chapter" data-level="A.3.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.1-dataframe-mutatedataframe-mutate-links"><i class="fa fa-check"></i><b>A.3.1</b> <span>Section 3.1 Dataframe Mutate</span> links</a></li>
<li class="chapter" data-level="A.3.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.2-dataframe-do-anythingdataframe-do-anything-links"><i class="fa fa-check"></i><b>A.3.2</b> <span>Section 3.2 Dataframe Do Anything</span> links</a></li>
<li class="chapter" data-level="A.3.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.3-apply-and-pmapapply-and-pmap-links"><i class="fa fa-check"></i><b>A.3.3</b> <span>Section 3.3 Apply and pmap</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#multi-dimensional-data-structures-links"><i class="fa fa-check"></i><b>A.4</b> Multi-dimensional Data Structures links</a>
<ul>
<li class="chapter" data-level="A.4.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-4.1-generate-gather-bind-and-joingenerate-gather-bind-and-join-links"><i class="fa fa-check"></i><b>A.4.1</b> <span>Section 4.1 Generate, Gather, Bind and Join</span> links</a></li>
<li class="chapter" data-level="A.4.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-4.2-wide-and-longwide-and-long-links"><i class="fa fa-check"></i><b>A.4.2</b> <span>Section 4.2 Wide and Long</span> links</a></li>
<li class="chapter" data-level="A.4.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-4.3-join-and-comparejoin-and-compare-links"><i class="fa fa-check"></i><b>A.4.3</b> <span>Section 4.3 Join and Compare</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.5" data-path="index-and-code-links.html"><a href="index-and-code-links.html#linear-regression-links"><i class="fa fa-check"></i><b>A.5</b> Linear Regression links</a>
<ul>
<li class="chapter" data-level="A.5.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-5.1-polynomial-fittingpolynomial-fitting-links"><i class="fa fa-check"></i><b>A.5.1</b> <span>Section 5.1 Polynomial Fitting</span> links</a></li>
<li class="chapter" data-level="A.5.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-5.2-ols-and-ivols-and-iv-links"><i class="fa fa-check"></i><b>A.5.2</b> <span>Section 5.2 OLS and IV</span> links</a></li>
<li class="chapter" data-level="A.5.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-5.3-decompositiondecomposition-links"><i class="fa fa-check"></i><b>A.5.3</b> <span>Section 5.3 Decomposition</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.6" data-path="index-and-code-links.html"><a href="index-and-code-links.html#nonlinear-and-other-regressions-links"><i class="fa fa-check"></i><b>A.6</b> Nonlinear and Other Regressions links</a>
<ul>
<li class="chapter" data-level="A.6.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-6.1-logit-regressionlogit-regression-links"><i class="fa fa-check"></i><b>A.6.1</b> <span>Section 6.1 Logit Regression</span> links</a></li>
<li class="chapter" data-level="A.6.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-6.2-quantile-regressionquantile-regression-links"><i class="fa fa-check"></i><b>A.6.2</b> <span>Section 6.2 Quantile Regression</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.7" data-path="index-and-code-links.html"><a href="index-and-code-links.html#optimization-links"><i class="fa fa-check"></i><b>A.7</b> Optimization links</a>
<ul>
<li class="chapter" data-level="A.7.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-7.1-bisectionbisection-links"><i class="fa fa-check"></i><b>A.7.1</b> <span>Section 7.1 Bisection</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.8" data-path="index-and-code-links.html"><a href="index-and-code-links.html#mathematics-links"><i class="fa fa-check"></i><b>A.8</b> Mathematics links</a>
<ul>
<li class="chapter" data-level="A.8.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-8.1-basicsbasics-links"><i class="fa fa-check"></i><b>A.8.1</b> <span>Section 8.1 Basics</span> links</a></li>
<li class="chapter" data-level="A.8.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-8.2-production-functionproduction-function-links"><i class="fa fa-check"></i><b>A.8.2</b> <span>Section 8.2 Production Function</span> links</a></li>
<li class="chapter" data-level="A.8.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-8.3-inequality-modelsinequality-models-links"><i class="fa fa-check"></i><b>A.8.3</b> <span>Section 8.3 Inequality Models</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.9" data-path="index-and-code-links.html"><a href="index-and-code-links.html#statistics-links"><i class="fa fa-check"></i><b>A.9</b> Statistics links</a>
<ul>
<li class="chapter" data-level="A.9.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-9.1-random-drawsrandom-draws-links"><i class="fa fa-check"></i><b>A.9.1</b> <span>Section 9.1 Random Draws</span> links</a></li>
<li class="chapter" data-level="A.9.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-9.2-distributionsdistributions-links"><i class="fa fa-check"></i><b>A.9.2</b> <span>Section 9.2 Distributions</span> links</a></li>
<li class="chapter" data-level="A.9.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-9.3-discrete-random-variablediscrete-random-variable-links"><i class="fa fa-check"></i><b>A.9.3</b> <span>Section 9.3 Discrete Random Variable</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.10" data-path="index-and-code-links.html"><a href="index-and-code-links.html#tables-and-graphs-links"><i class="fa fa-check"></i><b>A.10</b> Tables and Graphs links</a>
<ul>
<li class="chapter" data-level="A.10.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-10.1-r-base-plotsr-base-plots-links"><i class="fa fa-check"></i><b>A.10.1</b> <span>Section 10.1 R Base Plots</span> links</a></li>
<li class="chapter" data-level="A.10.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-10.2-ggplot-line-related-plotsggplot-line-related-plots-links"><i class="fa fa-check"></i><b>A.10.2</b> <span>Section 10.2 ggplot Line Related Plots</span> links</a></li>
<li class="chapter" data-level="A.10.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-10.3-ggplot-scatter-related-plotsggplot-scatter-related-plots-links"><i class="fa fa-check"></i><b>A.10.3</b> <span>Section 10.3 ggplot Scatter Related Plots</span> links</a></li>
<li class="chapter" data-level="A.10.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-10.4-write-and-read-plotswrite-and-read-plots-links"><i class="fa fa-check"></i><b>A.10.4</b> <span>Section 10.4 Write and Read Plots</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.11" data-path="index-and-code-links.html"><a href="index-and-code-links.html#get-data-links"><i class="fa fa-check"></i><b>A.11</b> Get Data links</a>
<ul>
<li class="chapter" data-level="A.11.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-11.1-environmental-dataenvironmental-data-links"><i class="fa fa-check"></i><b>A.11.1</b> <span>Section 11.1 Environmental Data</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.12" data-path="index-and-code-links.html"><a href="index-and-code-links.html#code-and-development-links"><i class="fa fa-check"></i><b>A.12</b> Code and Development links</a>
<ul>
<li class="chapter" data-level="A.12.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-12.1-files-in-and-outfiles-in-and-out-links"><i class="fa fa-check"></i><b>A.12.1</b> <span>Section 12.1 Files In and Out</span> links</a></li>
<li class="chapter" data-level="A.12.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-12.2-python-with-rpython-with-r-links"><i class="fa fa-check"></i><b>A.12.2</b> <span>Section 12.2 Python with R</span> links</a></li>
<li class="chapter" data-level="A.12.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-12.3-command-linecommand-line-links"><i class="fa fa-check"></i><b>A.12.3</b> <span>Section 12.3 Command Line</span> links</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://fanwangecon.github.io/R4Econ/bookdown/index.html" target="blank">R4Econ Bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Structures, Estimation and Optimization with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="nonlinear-and-other-regressions" class="section level1" number="6">
<h1><span class="header-section-number">Chapter 6</span> Nonlinear and Other Regressions</h1>

<div id="logit-regression" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Logit Regression</h2>

<div id="binary-logit" class="section level3" number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> Binary Logit</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R Code Examples</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository (<a href="https://fanwangecon.github.io/Stat4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<p><em>Data Preparation</em></p>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb412-1"><a href="nonlinear-and-other-regressions.html#cb412-1" aria-hidden="true" tabindex="-1"></a>df_mtcars <span class="ot">&lt;-</span> mtcars</span>
<span id="cb412-2"><a href="nonlinear-and-other-regressions.html#cb412-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb412-3"><a href="nonlinear-and-other-regressions.html#cb412-3" aria-hidden="true" tabindex="-1"></a><span class="co"># X-variables to use on RHS</span></span>
<span id="cb412-4"><a href="nonlinear-and-other-regressions.html#cb412-4" aria-hidden="true" tabindex="-1"></a>ls_st_xs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;mpg&#39;</span>, <span class="st">&#39;qsec&#39;</span>)</span>
<span id="cb412-5"><a href="nonlinear-and-other-regressions.html#cb412-5" aria-hidden="true" tabindex="-1"></a>ls_st_xs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;mpg&#39;</span>)</span>
<span id="cb412-6"><a href="nonlinear-and-other-regressions.html#cb412-6" aria-hidden="true" tabindex="-1"></a>ls_st_xs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;qsec&#39;</span>)</span>
<span id="cb412-7"><a href="nonlinear-and-other-regressions.html#cb412-7" aria-hidden="true" tabindex="-1"></a>ls_st_xs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;wt&#39;</span>)</span>
<span id="cb412-8"><a href="nonlinear-and-other-regressions.html#cb412-8" aria-hidden="true" tabindex="-1"></a>ls_st_xs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;mpg&#39;</span>, <span class="st">&#39;wt&#39;</span>, <span class="st">&#39;vs&#39;</span>)</span>
<span id="cb412-9"><a href="nonlinear-and-other-regressions.html#cb412-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb412-10"><a href="nonlinear-and-other-regressions.html#cb412-10" aria-hidden="true" tabindex="-1"></a>svr_binary <span class="ot">&lt;-</span> <span class="st">&#39;hpLowHigh&#39;</span></span>
<span id="cb412-11"><a href="nonlinear-and-other-regressions.html#cb412-11" aria-hidden="true" tabindex="-1"></a>svr_binary_lb0 <span class="ot">&lt;-</span> <span class="st">&#39;LowHP&#39;</span></span>
<span id="cb412-12"><a href="nonlinear-and-other-regressions.html#cb412-12" aria-hidden="true" tabindex="-1"></a>svr_binary_lb1 <span class="ot">&lt;-</span> <span class="st">&#39;HighHP&#39;</span></span>
<span id="cb412-13"><a href="nonlinear-and-other-regressions.html#cb412-13" aria-hidden="true" tabindex="-1"></a>svr_outcome <span class="ot">&lt;-</span> <span class="st">&#39;am&#39;</span></span>
<span id="cb412-14"><a href="nonlinear-and-other-regressions.html#cb412-14" aria-hidden="true" tabindex="-1"></a>sdt_name <span class="ot">&lt;-</span> <span class="st">&#39;mtcars&#39;</span></span>
<span id="cb412-15"><a href="nonlinear-and-other-regressions.html#cb412-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb412-16"><a href="nonlinear-and-other-regressions.html#cb412-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Discretize hp</span></span>
<span id="cb412-17"><a href="nonlinear-and-other-regressions.html#cb412-17" aria-hidden="true" tabindex="-1"></a>df_mtcars <span class="ot">&lt;-</span> df_mtcars <span class="sc">%&gt;%</span></span>
<span id="cb412-18"><a href="nonlinear-and-other-regressions.html#cb412-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_binary) <span class="sc">:</span><span class="er">=</span> <span class="fu">cut</span>(hp,</span>
<span id="cb412-19"><a href="nonlinear-and-other-regressions.html#cb412-19" aria-hidden="true" tabindex="-1"></a>                           <span class="at">breaks=</span><span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="dv">210</span>, <span class="cn">Inf</span>),</span>
<span id="cb412-20"><a href="nonlinear-and-other-regressions.html#cb412-20" aria-hidden="true" tabindex="-1"></a>                           <span class="at">labels=</span><span class="fu">c</span>(svr_binary_lb0, svr_binary_lb1)))</span></code></pre></div>
<div id="logit-regresion-and-prediction" class="section level4" number="6.1.1.1">
<h4><span class="header-section-number">6.1.1.1</span> Logit Regresion and Prediction</h4>
<p>logit regression with glm, and predict using estimation data. Prediction and estimation with one variable.</p>
<ul>
<li><a href="https://stats.idre.ucla.edu/r/dae/logit-regression/">LOGIT REGRESSION R DATA ANALYSIS EXAMPLES</a></li>
<li><a href="https://www.statmethods.net/advstats/glm.html">Generalized Linear Models</a></li>
</ul>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb413-1"><a href="nonlinear-and-other-regressions.html#cb413-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Regress</span></span>
<span id="cb413-2"><a href="nonlinear-and-other-regressions.html#cb413-2" aria-hidden="true" tabindex="-1"></a>rs_logit <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="fu">as.formula</span>(<span class="fu">paste</span>(svr_outcome, <span class="st">&quot;~&quot;</span>, <span class="fu">paste</span>(ls_st_xs, <span class="at">collapse=</span><span class="st">&quot;+&quot;</span>)))</span>
<span id="cb413-3"><a href="nonlinear-and-other-regressions.html#cb413-3" aria-hidden="true" tabindex="-1"></a>                ,<span class="at">data =</span> df_mtcars, <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb413-4"><a href="nonlinear-and-other-regressions.html#cb413-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rs_logit)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = as.formula(paste(svr_outcome, &quot;~&quot;, paste(ls_st_xs, 
##     collapse = &quot;+&quot;))), family = &quot;binomial&quot;, data = df_mtcars)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -1.73603  -0.25477  -0.04891   0.13402   1.90321  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)  
## (Intercept) 22.69008   13.95112   1.626   0.1039  
## mpg         -0.01786    0.33957  -0.053   0.9581  
## wt          -6.73804    3.01400  -2.236   0.0254 *
## vs          -4.44046    2.84247  -1.562   0.1182  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 43.230  on 31  degrees of freedom
## Residual deviance: 13.092  on 28  degrees of freedom
## AIC: 21.092
## 
## Number of Fisher Scoring iterations: 7</code></pre>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb415-1"><a href="nonlinear-and-other-regressions.html#cb415-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predcit Using Regression Data</span></span>
<span id="cb415-2"><a href="nonlinear-and-other-regressions.html#cb415-2" aria-hidden="true" tabindex="-1"></a>df_mtcars<span class="sc">$</span>p_mpg <span class="ot">&lt;-</span> <span class="fu">predict</span>(rs_logit, <span class="at">newdata =</span> df_mtcars, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span></code></pre></div>
<div id="prediction-with-observed-binary-input" class="section level5" number="6.1.1.1.1">
<h5><span class="header-section-number">6.1.1.1.1</span> Prediction with Observed Binary Input</h5>
<p>Logit regression with a continuous variable and a binary variable. Predict outcome with observed continuous variable as well as observed binary input variable.</p>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb416-1"><a href="nonlinear-and-other-regressions.html#cb416-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Regress</span></span>
<span id="cb416-2"><a href="nonlinear-and-other-regressions.html#cb416-2" aria-hidden="true" tabindex="-1"></a>rs_logit_bi <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="fu">as.formula</span>(<span class="fu">paste</span>(svr_outcome,</span>
<span id="cb416-3"><a href="nonlinear-and-other-regressions.html#cb416-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;~ factor(&quot;</span>, svr_binary,<span class="st">&quot;) + &quot;</span>,</span>
<span id="cb416-4"><a href="nonlinear-and-other-regressions.html#cb416-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">paste</span>(ls_st_xs, <span class="at">collapse=</span><span class="st">&quot;+&quot;</span>)))</span>
<span id="cb416-5"><a href="nonlinear-and-other-regressions.html#cb416-5" aria-hidden="true" tabindex="-1"></a>                   , <span class="at">data =</span> df_mtcars, <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb416-6"><a href="nonlinear-and-other-regressions.html#cb416-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rs_logit_bi)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = as.formula(paste(svr_outcome, &quot;~ factor(&quot;, svr_binary, 
##     &quot;) + &quot;, paste(ls_st_xs, collapse = &quot;+&quot;))), family = &quot;binomial&quot;, 
##     data = df_mtcars)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -1.45771  -0.09563  -0.00875   0.00555   1.87612  
## 
## Coefficients:
##                         Estimate Std. Error z value Pr(&gt;|z|)  
## (Intercept)               3.8285    18.0390   0.212   0.8319  
## factor(hpLowHigh)HighHP   6.9907     5.5176   1.267   0.2052  
## mpg                       0.8985     0.8906   1.009   0.3131  
## wt                       -6.7291     3.3166  -2.029   0.0425 *
## vs                       -5.9206     4.1908  -1.413   0.1577  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 43.2297  on 31  degrees of freedom
## Residual deviance:  8.9777  on 27  degrees of freedom
## AIC: 18.978
## 
## Number of Fisher Scoring iterations: 9</code></pre>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="nonlinear-and-other-regressions.html#cb418-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predcit Using Regresion Data</span></span>
<span id="cb418-2"><a href="nonlinear-and-other-regressions.html#cb418-2" aria-hidden="true" tabindex="-1"></a>df_mtcars<span class="sc">$</span>p_mpg_hp <span class="ot">&lt;-</span> <span class="fu">predict</span>(rs_logit_bi, <span class="at">newdata =</span> df_mtcars, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb418-3"><a href="nonlinear-and-other-regressions.html#cb418-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb418-4"><a href="nonlinear-and-other-regressions.html#cb418-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicted Probabilities am on mgp with or without hp binary</span></span>
<span id="cb418-5"><a href="nonlinear-and-other-regressions.html#cb418-5" aria-hidden="true" tabindex="-1"></a>scatter <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_mtcars, <span class="fu">aes</span>(<span class="at">x=</span>p_mpg_hp, <span class="at">y=</span>p_mpg)) <span class="sc">+</span></span>
<span id="cb418-6"><a href="nonlinear-and-other-regressions.html#cb418-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb418-7"><a href="nonlinear-and-other-regressions.html#cb418-7" aria-hidden="true" tabindex="-1"></a>      <span class="co"># geom_smooth(method=lm) + # Trend line</span></span>
<span id="cb418-8"><a href="nonlinear-and-other-regressions.html#cb418-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="co"># 45 degree line</span></span>
<span id="cb418-9"><a href="nonlinear-and-other-regressions.html#cb418-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">&#39;Predicted Probabilities &#39;</span>, svr_outcome, <span class="st">&#39; on &#39;</span>, ls_st_xs, <span class="st">&#39; with or without hp binary&#39;</span>),</span>
<span id="cb418-10"><a href="nonlinear-and-other-regressions.html#cb418-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">paste0</span>(<span class="st">&#39;prediction with &#39;</span>, ls_st_xs, <span class="st">&#39; and binary &#39;</span>, svr_binary, <span class="st">&#39; indicator, 1 is high&#39;</span>),</span>
<span id="cb418-11"><a href="nonlinear-and-other-regressions.html#cb418-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fu">paste0</span>(<span class="st">&#39;prediction with only &#39;</span>, ls_st_xs),</span>
<span id="cb418-12"><a href="nonlinear-and-other-regressions.html#cb418-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">caption =</span> <span class="st">&#39;mtcars; prediction based on observed data&#39;</span>) <span class="sc">+</span></span>
<span id="cb418-13"><a href="nonlinear-and-other-regressions.html#cb418-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_bw</span>()</span>
<span id="cb418-14"><a href="nonlinear-and-other-regressions.html#cb418-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(scatter)</span></code></pre></div>
<p><img src="Panel-Data-and-Optimization-with-R_files/figure-html/logit%20with%20binary%20and%20continuous%20RHS-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="prediction-with-binary-set-to-0-and-1" class="section level5" number="6.1.1.1.2">
<h5><span class="header-section-number">6.1.1.1.2</span> Prediction with Binary set to 0 and 1</h5>
<p>Now generate two predictions. One set where binary input is equal to 0, and another where the binary inputs are equal to 1. Ignore whether in data binary input is equal to 0 or 1. Use the same regression results as what was just derived.</p>
<p>Note that given the example here, the probability changes a lot when we</p>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb419-1"><a href="nonlinear-and-other-regressions.html#cb419-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Previous regression results</span></span>
<span id="cb419-2"><a href="nonlinear-and-other-regressions.html#cb419-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rs_logit_bi)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = as.formula(paste(svr_outcome, &quot;~ factor(&quot;, svr_binary, 
##     &quot;) + &quot;, paste(ls_st_xs, collapse = &quot;+&quot;))), family = &quot;binomial&quot;, 
##     data = df_mtcars)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -1.45771  -0.09563  -0.00875   0.00555   1.87612  
## 
## Coefficients:
##                         Estimate Std. Error z value Pr(&gt;|z|)  
## (Intercept)               3.8285    18.0390   0.212   0.8319  
## factor(hpLowHigh)HighHP   6.9907     5.5176   1.267   0.2052  
## mpg                       0.8985     0.8906   1.009   0.3131  
## wt                       -6.7291     3.3166  -2.029   0.0425 *
## vs                       -5.9206     4.1908  -1.413   0.1577  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 43.2297  on 31  degrees of freedom
## Residual deviance:  8.9777  on 27  degrees of freedom
## AIC: 18.978
## 
## Number of Fisher Scoring iterations: 9</code></pre>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb421-1"><a href="nonlinear-and-other-regressions.html#cb421-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Two different dataframes, mutate the binary regressor</span></span>
<span id="cb421-2"><a href="nonlinear-and-other-regressions.html#cb421-2" aria-hidden="true" tabindex="-1"></a>df_mtcars_bi0 <span class="ot">&lt;-</span> df_mtcars <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_binary) <span class="sc">:</span><span class="er">=</span> svr_binary_lb0)</span>
<span id="cb421-3"><a href="nonlinear-and-other-regressions.html#cb421-3" aria-hidden="true" tabindex="-1"></a>df_mtcars_bi1 <span class="ot">&lt;-</span> df_mtcars <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_binary) <span class="sc">:</span><span class="er">=</span> svr_binary_lb1)</span>
<span id="cb421-4"><a href="nonlinear-and-other-regressions.html#cb421-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb421-5"><a href="nonlinear-and-other-regressions.html#cb421-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Predcit Using Regresion Data</span></span>
<span id="cb421-6"><a href="nonlinear-and-other-regressions.html#cb421-6" aria-hidden="true" tabindex="-1"></a>df_mtcars<span class="sc">$</span>p_mpg_hp_bi0 <span class="ot">&lt;-</span> <span class="fu">predict</span>(rs_logit_bi, <span class="at">newdata =</span> df_mtcars_bi0, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb421-7"><a href="nonlinear-and-other-regressions.html#cb421-7" aria-hidden="true" tabindex="-1"></a>df_mtcars<span class="sc">$</span>p_mpg_hp_bi1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(rs_logit_bi, <span class="at">newdata =</span> df_mtcars_bi1, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb421-8"><a href="nonlinear-and-other-regressions.html#cb421-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb421-9"><a href="nonlinear-and-other-regressions.html#cb421-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicted Probabilities and Binary Input</span></span>
<span id="cb421-10"><a href="nonlinear-and-other-regressions.html#cb421-10" aria-hidden="true" tabindex="-1"></a>scatter <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_mtcars, <span class="fu">aes</span>(<span class="at">x=</span>p_mpg_hp_bi0)) <span class="sc">+</span></span>
<span id="cb421-11"><a href="nonlinear-and-other-regressions.html#cb421-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y=</span>p_mpg_hp), <span class="at">size=</span><span class="dv">4</span>, <span class="at">shape=</span><span class="dv">4</span>, <span class="at">color=</span><span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb421-12"><a href="nonlinear-and-other-regressions.html#cb421-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y=</span>p_mpg_hp_bi1), <span class="at">size=</span><span class="dv">2</span>, <span class="at">shape=</span><span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb421-13"><a href="nonlinear-and-other-regressions.html#cb421-13" aria-hidden="true" tabindex="-1"></a>      <span class="co"># geom_smooth(method=lm) + # Trend line</span></span>
<span id="cb421-14"><a href="nonlinear-and-other-regressions.html#cb421-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="co"># 45 degree line</span></span>
<span id="cb421-15"><a href="nonlinear-and-other-regressions.html#cb421-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">&#39;Predicted Probabilities and Binary Input&#39;</span>,</span>
<span id="cb421-16"><a href="nonlinear-and-other-regressions.html#cb421-16" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&#39;</span><span class="sc">\n</span><span class="st">cross(shape=4)/red is predict actual binary data&#39;</span>,</span>
<span id="cb421-17"><a href="nonlinear-and-other-regressions.html#cb421-17" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&#39;</span><span class="sc">\n</span><span class="st">star(shape=8)/black is predict set binary = 1 for all&#39;</span>),</span>
<span id="cb421-18"><a href="nonlinear-and-other-regressions.html#cb421-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> <span class="fu">paste0</span>(<span class="st">&#39;prediction with &#39;</span>, ls_st_xs, <span class="st">&#39; and binary &#39;</span>, svr_binary, <span class="st">&#39; = 0 for all&#39;</span>),</span>
<span id="cb421-19"><a href="nonlinear-and-other-regressions.html#cb421-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="fu">paste0</span>(<span class="st">&#39;prediction with &#39;</span>, ls_st_xs, <span class="st">&#39; and binary &#39;</span>, svr_binary, <span class="st">&#39; = 1&#39;</span>),</span>
<span id="cb421-20"><a href="nonlinear-and-other-regressions.html#cb421-20" aria-hidden="true" tabindex="-1"></a>           <span class="at">caption =</span> <span class="fu">paste0</span>(sdt_name)) <span class="sc">+</span></span>
<span id="cb421-21"><a href="nonlinear-and-other-regressions.html#cb421-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_bw</span>()</span>
<span id="cb421-22"><a href="nonlinear-and-other-regressions.html#cb421-22" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(scatter)</span></code></pre></div>
<p><img src="Panel-Data-and-Optimization-with-R_files/figure-html/logit%20prediction%200%20vs%201-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="prediction-with-binary-set-to-0-and-1-difference" class="section level5" number="6.1.1.1.3">
<h5><span class="header-section-number">6.1.1.1.3</span> Prediction with Binary set to 0 and 1 Difference</h5>
<p>What is the difference in probability between binary = 0 vs binary = 1. How does that relate to the probability of outcome of interest when binary = 0 for all.</p>
<p>In the binary logit case, the relationship will be hump–shaped by construction between <span class="math inline">\(A_i\)</span> and <span class="math inline">\(\alpha_i\)</span>. In the exponential wage cases, the relationship is convex upwards.</p>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb422-1"><a href="nonlinear-and-other-regressions.html#cb422-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate Gap Variable</span></span>
<span id="cb422-2"><a href="nonlinear-and-other-regressions.html#cb422-2" aria-hidden="true" tabindex="-1"></a>df_mtcars <span class="ot">&lt;-</span> df_mtcars <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">alpha_i =</span> p_mpg_hp_bi1 <span class="sc">-</span> p_mpg_hp_bi0) <span class="sc">%&gt;%</span></span>
<span id="cb422-3"><a href="nonlinear-and-other-regressions.html#cb422-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">A_i =</span> p_mpg_hp_bi0)</span>
<span id="cb422-4"><a href="nonlinear-and-other-regressions.html#cb422-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb422-5"><a href="nonlinear-and-other-regressions.html#cb422-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Binary Marginal Effects and Prediction without Binary</span></span>
<span id="cb422-6"><a href="nonlinear-and-other-regressions.html#cb422-6" aria-hidden="true" tabindex="-1"></a>scatter <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_mtcars, <span class="fu">aes</span>(<span class="at">x=</span>A_i)) <span class="sc">+</span></span>
<span id="cb422-7"><a href="nonlinear-and-other-regressions.html#cb422-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y=</span>alpha_i), <span class="at">size=</span><span class="dv">4</span>, <span class="at">shape=</span><span class="dv">4</span>, <span class="at">color=</span><span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb422-8"><a href="nonlinear-and-other-regressions.html#cb422-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="co"># 45 degree line</span></span>
<span id="cb422-9"><a href="nonlinear-and-other-regressions.html#cb422-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">&#39;Binary Marginal Effects and Prediction without Binary&#39;</span>),</span>
<span id="cb422-10"><a href="nonlinear-and-other-regressions.html#cb422-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="st">&#39;P(binary=0) for all&#39;</span>,</span>
<span id="cb422-11"><a href="nonlinear-and-other-regressions.html#cb422-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">&#39;P(binary=1) - P(binary=0) gap&#39;</span>,</span>
<span id="cb422-12"><a href="nonlinear-and-other-regressions.html#cb422-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">caption =</span> <span class="fu">paste0</span>(sdt_name)) <span class="sc">+</span></span>
<span id="cb422-13"><a href="nonlinear-and-other-regressions.html#cb422-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_bw</span>()</span>
<span id="cb422-14"><a href="nonlinear-and-other-regressions.html#cb422-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(scatter)</span></code></pre></div>
<p><img src="Panel-Data-and-Optimization-with-R_files/figure-html/logit%20prediction%20marginal%20vs%20base-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="x-variables-and-a-and-alpha" class="section level5" number="6.1.1.1.4">
<h5><span class="header-section-number">6.1.1.1.4</span> X variables and A and alpha</h5>
<p>Given the x-variables included in the logit regression, how do they relate to A_i and alpha_i</p>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="nonlinear-and-other-regressions.html#cb423-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate Gap Variable</span></span>
<span id="cb423-2"><a href="nonlinear-and-other-regressions.html#cb423-2" aria-hidden="true" tabindex="-1"></a>df_mtcars <span class="ot">&lt;-</span> df_mtcars <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">alpha_i =</span> p_mpg_hp_bi1 <span class="sc">-</span> p_mpg_hp_bi0) <span class="sc">%&gt;%</span></span>
<span id="cb423-3"><a href="nonlinear-and-other-regressions.html#cb423-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">A_i =</span> p_mpg_hp_bi0)</span>
<span id="cb423-4"><a href="nonlinear-and-other-regressions.html#cb423-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb423-5"><a href="nonlinear-and-other-regressions.html#cb423-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Binary Marginal Effects and Prediction without Binary</span></span>
<span id="cb423-6"><a href="nonlinear-and-other-regressions.html#cb423-6" aria-hidden="true" tabindex="-1"></a>ggplot.A.alpha.x <span class="ot">&lt;-</span> <span class="cf">function</span>(svr_x, df,</span>
<span id="cb423-7"><a href="nonlinear-and-other-regressions.html#cb423-7" aria-hidden="true" tabindex="-1"></a>                             <span class="at">svr_alpha =</span> <span class="st">&#39;alpha_i&#39;</span>, <span class="at">svr_A =</span> <span class="st">&quot;A_i&quot;</span>){</span>
<span id="cb423-8"><a href="nonlinear-and-other-regressions.html#cb423-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb423-9"><a href="nonlinear-and-other-regressions.html#cb423-9" aria-hidden="true" tabindex="-1"></a>  scatter <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span><span class="sc">!!</span><span class="fu">sym</span>(svr_x))) <span class="sc">+</span></span>
<span id="cb423-10"><a href="nonlinear-and-other-regressions.html#cb423-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y=</span>alpha_i), <span class="at">size=</span><span class="dv">4</span>, <span class="at">shape=</span><span class="dv">4</span>, <span class="at">color=</span><span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb423-11"><a href="nonlinear-and-other-regressions.html#cb423-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y=</span>A_i), <span class="at">size=</span><span class="dv">2</span>, <span class="at">shape=</span><span class="dv">8</span>, <span class="at">color=</span><span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb423-12"><a href="nonlinear-and-other-regressions.html#cb423-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="co"># 45 degree line</span></span>
<span id="cb423-13"><a href="nonlinear-and-other-regressions.html#cb423-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">&#39;A (blue) and alpha (red) vs x variables=&#39;</span>, svr_x),</span>
<span id="cb423-14"><a href="nonlinear-and-other-regressions.html#cb423-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">x =</span> svr_x,</span>
<span id="cb423-15"><a href="nonlinear-and-other-regressions.html#cb423-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> <span class="st">&#39;Probabilities&#39;</span>,</span>
<span id="cb423-16"><a href="nonlinear-and-other-regressions.html#cb423-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">caption =</span> <span class="fu">paste0</span>(sdt_name)) <span class="sc">+</span></span>
<span id="cb423-17"><a href="nonlinear-and-other-regressions.html#cb423-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_bw</span>()</span>
<span id="cb423-18"><a href="nonlinear-and-other-regressions.html#cb423-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb423-19"><a href="nonlinear-and-other-regressions.html#cb423-19" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(scatter)</span>
<span id="cb423-20"><a href="nonlinear-and-other-regressions.html#cb423-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb423-21"><a href="nonlinear-and-other-regressions.html#cb423-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb423-22"><a href="nonlinear-and-other-regressions.html#cb423-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot over multiple</span></span>
<span id="cb423-23"><a href="nonlinear-and-other-regressions.html#cb423-23" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(ls_st_xs,</span>
<span id="cb423-24"><a href="nonlinear-and-other-regressions.html#cb423-24" aria-hidden="true" tabindex="-1"></a>       ggplot.A.alpha.x,</span>
<span id="cb423-25"><a href="nonlinear-and-other-regressions.html#cb423-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">df =</span> df_mtcars)</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="Panel-Data-and-Optimization-with-R_files/figure-html/unnamed-chunk-215-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="Panel-Data-and-Optimization-with-R_files/figure-html/unnamed-chunk-215-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[3]]</code></pre>
<p><img src="Panel-Data-and-Optimization-with-R_files/figure-html/unnamed-chunk-215-3.png" width="672" style="display: block; margin: auto;" /></p>

</div>
</div>
</div>
<div id="logistic-choice-model-with-aggregate-shares" class="section level3" number="6.1.2">
<h3><span class="header-section-number">6.1.2</span> Logistic Choice Model with Aggregate Shares</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R Code Examples</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository (<a href="https://fanwangecon.github.io/Stat4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<div id="logistic-choices-wages-and-market-shares" class="section level4" number="6.1.2.1">
<h4><span class="header-section-number">6.1.2.1</span> Logistic Choices, Wages and Market Shares</h4>
<div id="wage-and-aggregate-share-of-workers" class="section level5" number="6.1.2.1.1">
<h5><span class="header-section-number">6.1.2.1.1</span> Wage and Aggregate Share of Workers</h5>
<p><em>Note</em>: See <a href="https://fanwangecon.github.io/R4Econ/regnonlin/logit/htmlpdfr/fs_logit_aggregate_share_to_price.html">Fit Prices Given Quantities Logistic Choice with Aggregate Data</a> for solving/estimating for wages given aggregate shares.</p>
<p>Individual <span class="math inline">\(i\)</span> can choose among <span class="math inline">\(M+1\)</span> options, the <span class="math inline">\(M\)</span> options, are for example, alternative job possibilities. The <span class="math inline">\(+1\)</span> refers to a leisure category. The value associated with each one of the choice alternatives is:</p>
<p><span class="math display">\[
V_{itm} = \widehat{V}_{tm} + \epsilon_{itm} = \alpha_m + \beta\cdot\text{WAGE}_{tm}  + \epsilon_{itm}
\]</span>
Note that <span class="math inline">\(\beta\)</span> captures the effect of occupation-specific wage, <span class="math inline">\(\beta\)</span> is the same across occupational groups. Each occupational group has its own intercept <span class="math inline">\(\alpha_m\)</span>, and <span class="math inline">\(\epsilon_{im}\)</span> is the individual and occupation specific extreme value error. The non-error component of the value of leisure is normalized to <span class="math inline">\(0\)</span> (<span class="math inline">\(\exp(0)=1\)</span>).</p>
<p>The discrete choice problem is solved by a comparison across alternatives. <span class="math inline">\(o_i\)</span> is the individual optimal choice <span class="math inline">\(o_i = \arg\max_m \left(V_{i,m}\right)\)</span></p>
<p>Choice probabilities are functions of wages. The probability that individual <span class="math inline">\(i\)</span> chooses occupation <span class="math inline">\(m\)</span> is (ignoring the t-subscripts):</p>
<p><span class="math display">\[
P(o=m) = \frac{\exp\left(\widehat{V}_m\right)}{1 + \sum_{\hat{m}=1}^M\exp\left(\widehat{V}_{\hat{m}}\right)}
\]</span></p>
<p>The log ratio of probability of choosing any of the <span class="math inline">\(M\)</span> occupation alternatives and leisure is:</p>
<p><span class="math display">\[
\log  P\left( o = m \right) - \log P\left( o = 0 \right)
= \log \left(\frac{P\left( o = m \right)}{P\left( o = 0 \right)}\right)
= \log\left(
\frac{\exp\left(\widehat{V}_m\right)}{1 + \sum_{\hat{m}=1}^M\exp\left(\widehat{V}_{\hat{m}}\right)}
\cdot
\frac{1 + \sum_{\hat{m}=1}^M\exp\left(\widehat{V}_{\hat{m}}\right)}{1}
\right)
\]</span></p>
<p>This means that the log of the probability ratio is linear in wages:</p>
<p><span class="math display">\[
\log \left(\frac{P\left( o = m \right)}{P\left( o = 0 \right)}\right)
= \alpha_m + \beta\cdot\text{WAGE}_m
\]</span></p>
<p>Supose we have <span class="math inline">\(M-1\)</span>, either work or leisure. Suppose we have aggregate data from 1 time period, with relative work to leisure share (aggregate-share data, “market-share” data) and a single measure of wage, then we have 1 equation with two parameters, <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> can not be jointly identified. <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>, neither of which is time-varying, are exactly identified if we have data from two periods with variations in wage across the periods.</p>
</div>
<div id="simulate-market-share" class="section level5" number="6.1.2.1.2">
<h5><span class="header-section-number">6.1.2.1.2</span> Simulate Market Share</h5>
<p>In this section, we now simulate the above model, with <span class="math inline">\(M=2\)</span> and data over three periods, and estimate <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> via OLS. Note that <span class="math inline">\(m=0\)</span> is leisure.</p>
<p>First, simulate the data.</p>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb427-1"><a href="nonlinear-and-other-regressions.html#cb427-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed</span></span>
<span id="cb427-2"><a href="nonlinear-and-other-regressions.html#cb427-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb427-3"><a href="nonlinear-and-other-regressions.html#cb427-3" aria-hidden="true" tabindex="-1"></a><span class="co"># T periods, and M occupations (+1 leisure)</span></span>
<span id="cb427-4"><a href="nonlinear-and-other-regressions.html#cb427-4" aria-hidden="true" tabindex="-1"></a>it_T <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb427-5"><a href="nonlinear-and-other-regressions.html#cb427-5" aria-hidden="true" tabindex="-1"></a>it_M <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb427-6"><a href="nonlinear-and-other-regressions.html#cb427-6" aria-hidden="true" tabindex="-1"></a><span class="co"># define alpha and beta parameters</span></span>
<span id="cb427-7"><a href="nonlinear-and-other-regressions.html#cb427-7" aria-hidden="true" tabindex="-1"></a>ar_alpha <span class="ot">&lt;-</span> <span class="fu">runif</span>(it_M) <span class="sc">+</span> <span class="dv">0</span></span>
<span id="cb427-8"><a href="nonlinear-and-other-regressions.html#cb427-8" aria-hidden="true" tabindex="-1"></a>fl_beta <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">+</span> <span class="dv">0</span></span>
<span id="cb427-9"><a href="nonlinear-and-other-regressions.html#cb427-9" aria-hidden="true" tabindex="-1"></a><span class="co"># wage matrix, no wage for leisure</span></span>
<span id="cb427-10"><a href="nonlinear-and-other-regressions.html#cb427-10" aria-hidden="true" tabindex="-1"></a>mt_wages <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">runif</span>(it_T<span class="sc">*</span>it_M) <span class="sc">+</span> <span class="dv">1</span>, <span class="at">nrow=</span>it_T, <span class="at">ncol=</span>it_M)</span>
<span id="cb427-11"><a href="nonlinear-and-other-regressions.html#cb427-11" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mt_wages) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;m&#39;</span>, <span class="fu">seq</span>(<span class="dv">1</span>,it_M))</span>
<span id="cb427-12"><a href="nonlinear-and-other-regressions.html#cb427-12" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(mt_wages) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;t&#39;</span>, <span class="fu">seq</span>(<span class="dv">1</span>,it_T))</span>
<span id="cb427-13"><a href="nonlinear-and-other-regressions.html#cb427-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a probability assignment function</span></span>
<span id="cb427-14"><a href="nonlinear-and-other-regressions.html#cb427-14" aria-hidden="true" tabindex="-1"></a>ffi_logit_prob_alpha_beta <span class="ot">&lt;-</span> <span class="cf">function</span>(ar_alpha, fl_beta, mt_wages) {</span>
<span id="cb427-15"><a href="nonlinear-and-other-regressions.html#cb427-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Dimensions</span></span>
<span id="cb427-16"><a href="nonlinear-and-other-regressions.html#cb427-16" aria-hidden="true" tabindex="-1"></a>  it_T <span class="ot">&lt;-</span> <span class="fu">dim</span>(mt_wages)[<span class="dv">1</span>]</span>
<span id="cb427-17"><a href="nonlinear-and-other-regressions.html#cb427-17" aria-hidden="true" tabindex="-1"></a>  it_M <span class="ot">&lt;-</span> <span class="fu">dim</span>(mt_wages)[<span class="dv">2</span>]</span>
<span id="cb427-18"><a href="nonlinear-and-other-regressions.html#cb427-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Aggregate probabilities</span></span>
<span id="cb427-19"><a href="nonlinear-and-other-regressions.html#cb427-19" aria-hidden="true" tabindex="-1"></a>  mt_prob_o <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span><span class="cn">NA</span>, <span class="at">nrow=</span>it_T, <span class="at">ncol=</span>it_M<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb427-20"><a href="nonlinear-and-other-regressions.html#cb427-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(mt_prob_o) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;m&#39;</span>, <span class="fu">seq</span>(<span class="dv">0</span>,it_M))</span>
<span id="cb427-21"><a href="nonlinear-and-other-regressions.html#cb427-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(mt_prob_o) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;t&#39;</span>, <span class="fu">seq</span>(<span class="dv">1</span>,it_T))</span>
<span id="cb427-22"><a href="nonlinear-and-other-regressions.html#cb427-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate Probabilities</span></span>
<span id="cb427-23"><a href="nonlinear-and-other-regressions.html#cb427-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (it_t <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>, it_T)) {</span>
<span id="cb427-24"><a href="nonlinear-and-other-regressions.html#cb427-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get current period wages</span></span>
<span id="cb427-25"><a href="nonlinear-and-other-regressions.html#cb427-25" aria-hidden="true" tabindex="-1"></a>    ar_wage_at_t <span class="ot">&lt;-</span> mt_wages[it_t, ]</span>
<span id="cb427-26"><a href="nonlinear-and-other-regressions.html#cb427-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Value without shocks/errors, M+1</span></span>
<span id="cb427-27"><a href="nonlinear-and-other-regressions.html#cb427-27" aria-hidden="true" tabindex="-1"></a>    ar_V_hat_at_t <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, ar_alpha <span class="sc">+</span> fl_beta<span class="sc">*</span>ar_wage_at_t)</span>
<span id="cb427-28"><a href="nonlinear-and-other-regressions.html#cb427-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Probabilities across M+1</span></span>
<span id="cb427-29"><a href="nonlinear-and-other-regressions.html#cb427-29" aria-hidden="true" tabindex="-1"></a>    fl_prob_denominator <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">exp</span>(ar_V_hat_at_t))</span>
<span id="cb427-30"><a href="nonlinear-and-other-regressions.html#cb427-30" aria-hidden="true" tabindex="-1"></a>    ar_prob_at_t <span class="ot">&lt;-</span> <span class="fu">exp</span>(ar_V_hat_at_t)<span class="sc">/</span>fl_prob_denominator</span>
<span id="cb427-31"><a href="nonlinear-and-other-regressions.html#cb427-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fill in</span></span>
<span id="cb427-32"><a href="nonlinear-and-other-regressions.html#cb427-32" aria-hidden="true" tabindex="-1"></a>    mt_prob_o[it_t,] <span class="ot">&lt;-</span> ar_prob_at_t</span>
<span id="cb427-33"><a href="nonlinear-and-other-regressions.html#cb427-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb427-34"><a href="nonlinear-and-other-regressions.html#cb427-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(mt_prob_o)</span>
<span id="cb427-35"><a href="nonlinear-and-other-regressions.html#cb427-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb427-36"><a href="nonlinear-and-other-regressions.html#cb427-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Show probabilities</span></span>
<span id="cb427-37"><a href="nonlinear-and-other-regressions.html#cb427-37" aria-hidden="true" tabindex="-1"></a>mt_prob_o <span class="ot">&lt;-</span> <span class="fu">ffi_logit_prob_alpha_beta</span>(ar_alpha, fl_beta, mt_wages)</span>
<span id="cb427-38"><a href="nonlinear-and-other-regressions.html#cb427-38" aria-hidden="true" tabindex="-1"></a>st_caption <span class="ot">&lt;-</span> <span class="st">&#39;Occupation aggregate participation probabilities across time&#39;</span></span>
<span id="cb427-39"><a href="nonlinear-and-other-regressions.html#cb427-39" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(mt_prob_o, <span class="at">caption=</span>st_caption) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-217">Table 6.1: </span>Occupation aggregate participation probabilities across time
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m0
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m2
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
t1
</td>
<td style="text-align:right;">
0.1251712
</td>
<td style="text-align:right;">
0.3604563
</td>
<td style="text-align:right;">
0.5143725
</td>
</tr>
<tr>
<td style="text-align:left;">
t2
</td>
<td style="text-align:right;">
0.1147084
</td>
<td style="text-align:right;">
0.3381795
</td>
<td style="text-align:right;">
0.5471121
</td>
</tr>
<tr>
<td style="text-align:left;">
t3
</td>
<td style="text-align:right;">
0.1390180
</td>
<td style="text-align:right;">
0.2842316
</td>
<td style="text-align:right;">
0.5767504
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="nonlinear-and-other-regressions.html#cb428-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mt_prob_o</span></span></code></pre></div>
</div>
<div id="create-regression-data-inputs" class="section level5" number="6.1.2.1.3">
<h5><span class="header-section-number">6.1.2.1.3</span> Create Regression Data Inputs</h5>
<p>Second, generate relative market shares of various work occupations, columns 2 through <span class="math inline">\(M+1\)</span>, with respect to leisure, column 1. If there are <span class="math inline">\(M\)</span> categories and <span class="math inline">\(T\)</span> time periods, there are <span class="math inline">\(M \times T\)</span> observations (rows). Flatten the structure so that row-groups are the M categories, and we have time-specific information within row groups.</p>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb429-1"><a href="nonlinear-and-other-regressions.html#cb429-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A Matrix with share from 1:M columns</span></span>
<span id="cb429-2"><a href="nonlinear-and-other-regressions.html#cb429-2" aria-hidden="true" tabindex="-1"></a>mt_prob_rela_m2leisure <span class="ot">&lt;-</span></span>
<span id="cb429-3"><a href="nonlinear-and-other-regressions.html#cb429-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span>(<span class="at">data=</span>mt_prob_o[<span class="dv">1</span><span class="sc">:</span>it_T, <span class="dv">2</span><span class="sc">:</span>(it_M<span class="sc">+</span><span class="dv">1</span>)], <span class="at">nrow=</span>it_T, <span class="at">ncol=</span>it_M)</span>
<span id="cb429-4"><a href="nonlinear-and-other-regressions.html#cb429-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mt_prob_rela_m2leisure) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;m&#39;</span>, <span class="fu">seq</span>(<span class="dv">1</span>,it_M))</span>
<span id="cb429-5"><a href="nonlinear-and-other-regressions.html#cb429-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(mt_prob_rela_m2leisure) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;t&#39;</span>, <span class="fu">seq</span>(<span class="dv">1</span>,it_T))</span>
<span id="cb429-6"><a href="nonlinear-and-other-regressions.html#cb429-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Divide 1:M by leisure</span></span>
<span id="cb429-7"><a href="nonlinear-and-other-regressions.html#cb429-7" aria-hidden="true" tabindex="-1"></a>mt_prob_rela_m2leisure <span class="ot">&lt;-</span> mt_prob_rela_m2leisure<span class="sc">/</span>mt_prob_o[<span class="dv">1</span><span class="sc">:</span>it_T, <span class="dv">1</span>]</span>
<span id="cb429-8"><a href="nonlinear-and-other-regressions.html#cb429-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Take Logs, log(Pm/Po)</span></span>
<span id="cb429-9"><a href="nonlinear-and-other-regressions.html#cb429-9" aria-hidden="true" tabindex="-1"></a>mt_prob_rela_m2leisure_log <span class="ot">&lt;-</span> <span class="fu">log</span>(mt_prob_rela_m2leisure)</span>
<span id="cb429-10"><a href="nonlinear-and-other-regressions.html#cb429-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Flatten to single column</span></span>
<span id="cb429-11"><a href="nonlinear-and-other-regressions.html#cb429-11" aria-hidden="true" tabindex="-1"></a>ar_prob_ols_output <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span>mt_prob_rela_m2leisure_log, <span class="at">nrow=</span>it_T<span class="sc">*</span>it_M, <span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb429-12"><a href="nonlinear-and-other-regressions.html#cb429-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Show probabilities</span></span>
<span id="cb429-13"><a href="nonlinear-and-other-regressions.html#cb429-13" aria-hidden="true" tabindex="-1"></a>st_caption <span class="ot">&lt;-</span> <span class="st">&#39;Log of relative participation probabilities against leisure&#39;</span></span>
<span id="cb429-14"><a href="nonlinear-and-other-regressions.html#cb429-14" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(mt_prob_rela_m2leisure_log, <span class="at">caption=</span>st_caption) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-218">Table 6.2: </span>Log of relative participation probabilities against leisure
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m2
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
t1
</td>
<td style="text-align:right;">
1.057688
</td>
<td style="text-align:right;">
1.413265
</td>
</tr>
<tr>
<td style="text-align:left;">
t2
</td>
<td style="text-align:right;">
1.081184
</td>
<td style="text-align:right;">
1.562261
</td>
</tr>
<tr>
<td style="text-align:left;">
t3
</td>
<td style="text-align:right;">
0.715186
</td>
<td style="text-align:right;">
1.422806
</td>
</tr>
</tbody>
</table>
<p>Third, construct the estimation input matrices. If there are <span class="math inline">\(M\)</span> categories and <span class="math inline">\(T\)</span> time periods, there are <span class="math inline">\(M \times T\)</span> observations (rows). Flatten in the same way as for outcomes. There are <span class="math inline">\(M\)</span> indicator vectors and 1 wage vector for data inputs:</p>
<ul>
<li><span class="math inline">\(\alpha\)</span> is a fixed effect that is <span class="math inline">\(m\)</span>-specific, so we have as Data, <span class="math inline">\(M\)</span> indicator vectors.</li>
<li>The wage variable is shared by all, so a single data column</li>
</ul>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="nonlinear-and-other-regressions.html#cb430-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Regression input matrix</span></span>
<span id="cb430-2"><a href="nonlinear-and-other-regressions.html#cb430-2" aria-hidden="true" tabindex="-1"></a>mt_prob_ols_input <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span><span class="cn">NA</span>, <span class="at">nrow=</span>it_T<span class="sc">*</span>it_M, <span class="at">ncol=</span>it_M<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb430-3"><a href="nonlinear-and-other-regressions.html#cb430-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mt_prob_ols_input) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;m&#39;</span>, <span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">dim</span>(mt_prob_ols_input)[<span class="dv">2</span>]))</span>
<span id="cb430-4"><a href="nonlinear-and-other-regressions.html#cb430-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(mt_prob_ols_input) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;rowMcrsT&#39;</span>, <span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">dim</span>(mt_prob_ols_input)[<span class="dv">1</span>]))</span>
<span id="cb430-5"><a href="nonlinear-and-other-regressions.html#cb430-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate index position in ols input matrix for M indicators</span></span>
<span id="cb430-6"><a href="nonlinear-and-other-regressions.html#cb430-6" aria-hidden="true" tabindex="-1"></a>mt_m_indicators <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span><span class="cn">NA</span>, <span class="at">nrow=</span>it_T<span class="sc">*</span>it_M, <span class="at">ncol=</span>it_M)</span>
<span id="cb430-7"><a href="nonlinear-and-other-regressions.html#cb430-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mt_prob_ols_input) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;m&#39;</span>, <span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">dim</span>(mt_prob_ols_input)[<span class="dv">2</span>]))</span>
<span id="cb430-8"><a href="nonlinear-and-other-regressions.html#cb430-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(mt_prob_ols_input) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;rowMcrsT&#39;</span>, <span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">dim</span>(mt_prob_ols_input)[<span class="dv">1</span>]))</span>
<span id="cb430-9"><a href="nonlinear-and-other-regressions.html#cb430-9" aria-hidden="true" tabindex="-1"></a><span class="co"># loop over columns</span></span>
<span id="cb430-10"><a href="nonlinear-and-other-regressions.html#cb430-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (it_indix <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>, it_M)) {</span>
<span id="cb430-11"><a href="nonlinear-and-other-regressions.html#cb430-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># loop over rows</span></span>
<span id="cb430-12"><a href="nonlinear-and-other-regressions.html#cb430-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (it_rowMcrsT <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>, it_T<span class="sc">*</span>it_M)) {</span>
<span id="cb430-13"><a href="nonlinear-and-other-regressions.html#cb430-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ((it_rowMcrsT <span class="sc">&gt;=</span> (it_indix<span class="dv">-1</span>)<span class="sc">*</span>(it_T) <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">&amp;&amp;</span> it_rowMcrsT <span class="sc">&lt;=</span> it_indix<span class="sc">*</span>(it_T)){</span>
<span id="cb430-14"><a href="nonlinear-and-other-regressions.html#cb430-14" aria-hidden="true" tabindex="-1"></a>      mt_m_indicators[it_rowMcrsT, it_indix] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb430-15"><a href="nonlinear-and-other-regressions.html#cb430-15" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb430-16"><a href="nonlinear-and-other-regressions.html#cb430-16" aria-hidden="true" tabindex="-1"></a>      mt_m_indicators[it_rowMcrsT, it_indix] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb430-17"><a href="nonlinear-and-other-regressions.html#cb430-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb430-18"><a href="nonlinear-and-other-regressions.html#cb430-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb430-19"><a href="nonlinear-and-other-regressions.html#cb430-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb430-20"><a href="nonlinear-and-other-regressions.html#cb430-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Indicators are the earlier columns</span></span>
<span id="cb430-21"><a href="nonlinear-and-other-regressions.html#cb430-21" aria-hidden="true" tabindex="-1"></a>mt_prob_ols_input[, <span class="dv">1</span><span class="sc">:</span>it_M] <span class="ot">&lt;-</span> mt_m_indicators</span>
<span id="cb430-22"><a href="nonlinear-and-other-regressions.html#cb430-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Wage is the last column</span></span>
<span id="cb430-23"><a href="nonlinear-and-other-regressions.html#cb430-23" aria-hidden="true" tabindex="-1"></a>mt_prob_ols_input[, it_M<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span>mt_wages, <span class="at">nrow=</span>it_T<span class="sc">*</span>it_M, <span class="at">ncol=</span><span class="dv">1</span>)</span></code></pre></div>
<p>Fourth, combine left-hand-side and right-hand-side regression input data structures/</p>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb431-1"><a href="nonlinear-and-other-regressions.html#cb431-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Construct data structure</span></span>
<span id="cb431-2"><a href="nonlinear-and-other-regressions.html#cb431-2" aria-hidden="true" tabindex="-1"></a>mt_all_inputs <span class="ot">&lt;-</span> <span class="fu">cbind</span>(ar_prob_ols_output, mt_prob_ols_input)</span>
<span id="cb431-3"><a href="nonlinear-and-other-regressions.html#cb431-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mt_all_inputs)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&#39;log_pm_over_po&#39;</span></span>
<span id="cb431-4"><a href="nonlinear-and-other-regressions.html#cb431-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mt_all_inputs)[<span class="fu">dim</span>(mt_all_inputs)[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="st">&#39;wages&#39;</span></span>
<span id="cb431-5"><a href="nonlinear-and-other-regressions.html#cb431-5" aria-hidden="true" tabindex="-1"></a>tb_all_inputs <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(mt_all_inputs)</span>
<span id="cb431-6"><a href="nonlinear-and-other-regressions.html#cb431-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Show data</span></span>
<span id="cb431-7"><a href="nonlinear-and-other-regressions.html#cb431-7" aria-hidden="true" tabindex="-1"></a>st_caption <span class="ot">&lt;-</span> <span class="st">&#39;LHS=Log Probability Ratios (column 1); RHS=Indicators of occupations and wages, OLS inputs (other columns)&#39;</span></span>
<span id="cb431-8"><a href="nonlinear-and-other-regressions.html#cb431-8" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(tb_all_inputs, <span class="at">caption=</span>st_caption) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-220">Table 6.3: </span>LHS=Log Probability Ratios (column 1); RHS=Indicators of occupations and wages, OLS inputs (other columns)
</caption>
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
log_pm_over_po
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
wages
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1.057688
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.883017
</td>
</tr>
<tr>
<td style="text-align:right;">
1.081184
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.940467
</td>
</tr>
<tr>
<td style="text-align:right;">
0.715186
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.045556
</td>
</tr>
<tr>
<td style="text-align:right;">
1.413265
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.528105
</td>
</tr>
<tr>
<td style="text-align:right;">
1.562261
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.892419
</td>
</tr>
<tr>
<td style="text-align:right;">
1.422806
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.551435
</td>
</tr>
</tbody>
</table>
</div>
<div id="estimate-wage-coefficients" class="section level5" number="6.1.2.1.4">
<h5><span class="header-section-number">6.1.2.1.4</span> Estimate Wage Coefficients</h5>
<p>Fifth, estimate the OLS equation, and compare estimate to true parameters.</p>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb432-1"><a href="nonlinear-and-other-regressions.html#cb432-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Regression</span></span>
<span id="cb432-2"><a href="nonlinear-and-other-regressions.html#cb432-2" aria-hidden="true" tabindex="-1"></a>fit_ols_agg_prob <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_pm_over_po <span class="sc">~</span> . <span class="sc">-</span><span class="dv">1</span>, <span class="at">data =</span> tb_all_inputs)</span>
<span id="cb432-3"><a href="nonlinear-and-other-regressions.html#cb432-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_ols_agg_prob)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = log_pm_over_po ~ . - 1, data = tb_all_inputs)
## 
## Residuals:
##          1          2          3          4          5          6 
##  4.027e-17  2.276e-17 -6.303e-17 -6.481e-17 -1.631e-16  2.279e-16 
## 
## Coefficients:
##        Estimate Std. Error   t value Pr(&gt;|t|)    
## m1    2.876e-01  3.784e-16 7.599e+14   &lt;2e-16 ***
## m2    7.883e-01  3.859e-16 2.043e+15   &lt;2e-16 ***
## wages 4.090e-01  2.250e-16 1.818e+15   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.721e-16 on 3 degrees of freedom
## Multiple R-squared:      1,  Adjusted R-squared:      1 
## F-statistic: 1.043e+32 on 3 and 3 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb434-1"><a href="nonlinear-and-other-regressions.html#cb434-1" aria-hidden="true" tabindex="-1"></a><span class="co"># alpha estimates</span></span>
<span id="cb434-2"><a href="nonlinear-and-other-regressions.html#cb434-2" aria-hidden="true" tabindex="-1"></a>ar_coefficients <span class="ot">&lt;-</span> fit_ols_agg_prob<span class="sc">$</span>coefficients</span>
<span id="cb434-3"><a href="nonlinear-and-other-regressions.html#cb434-3" aria-hidden="true" tabindex="-1"></a>ar_alpha_esti <span class="ot">&lt;-</span> ar_coefficients[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(ar_coefficients)<span class="sc">-</span><span class="dv">1</span>)]</span>
<span id="cb434-4"><a href="nonlinear-and-other-regressions.html#cb434-4" aria-hidden="true" tabindex="-1"></a>fl_beta_esti <span class="ot">&lt;-</span> ar_coefficients[<span class="fu">length</span>(ar_coefficients)]</span>
<span id="cb434-5"><a href="nonlinear-and-other-regressions.html#cb434-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare estimates and true</span></span>
<span id="cb434-6"><a href="nonlinear-and-other-regressions.html#cb434-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&#39;ar_alpha_esti=&#39;</span>, ar_alpha_esti))</span></code></pre></div>
<pre><code>## [1] &quot;ar_alpha_esti=0.287577520124614&quot; &quot;ar_alpha_esti=0.788305135443806&quot;</code></pre>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="nonlinear-and-other-regressions.html#cb436-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&#39;ar_alpha=&#39;</span>, ar_alpha))</span></code></pre></div>
<pre><code>## [1] &quot;ar_alpha=0.287577520124614&quot; &quot;ar_alpha=0.788305135443807&quot;</code></pre>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="nonlinear-and-other-regressions.html#cb438-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&#39;fl_beta_esti=&#39;</span>, fl_beta_esti))</span></code></pre></div>
<pre><code>## [1] &quot;fl_beta_esti=0.4089769218117&quot;</code></pre>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb440-1"><a href="nonlinear-and-other-regressions.html#cb440-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&#39;fl_beta=&#39;</span>, fl_beta))</span></code></pre></div>
<pre><code>## [1] &quot;fl_beta=0.4089769218117&quot;</code></pre>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb442-1"><a href="nonlinear-and-other-regressions.html#cb442-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate given estimated parameters using earlier function</span></span>
<span id="cb442-2"><a href="nonlinear-and-other-regressions.html#cb442-2" aria-hidden="true" tabindex="-1"></a>mt_prob_o_esti <span class="ot">&lt;-</span> <span class="fu">ffi_logit_prob_alpha_beta</span>(ar_alpha_esti, fl_beta_esti, mt_wages)</span>
<span id="cb442-3"><a href="nonlinear-and-other-regressions.html#cb442-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Results</span></span>
<span id="cb442-4"><a href="nonlinear-and-other-regressions.html#cb442-4" aria-hidden="true" tabindex="-1"></a>st_caption <span class="ot">&lt;-</span> <span class="st">&#39;Predicted probabilities based on estimates&#39;</span></span>
<span id="cb442-5"><a href="nonlinear-and-other-regressions.html#cb442-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(mt_prob_o_esti, <span class="at">caption=</span>st_caption) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-221">Table 6.4: </span>Predicted probabilities based on estimates
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m0
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m2
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
t1
</td>
<td style="text-align:right;">
0.1251712
</td>
<td style="text-align:right;">
0.3604563
</td>
<td style="text-align:right;">
0.5143725
</td>
</tr>
<tr>
<td style="text-align:left;">
t2
</td>
<td style="text-align:right;">
0.1147084
</td>
<td style="text-align:right;">
0.3381795
</td>
<td style="text-align:right;">
0.5471121
</td>
</tr>
<tr>
<td style="text-align:left;">
t3
</td>
<td style="text-align:right;">
0.1390180
</td>
<td style="text-align:right;">
0.2842316
</td>
<td style="text-align:right;">
0.5767504
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb443-1"><a href="nonlinear-and-other-regressions.html#cb443-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Results</span></span>
<span id="cb443-2"><a href="nonlinear-and-other-regressions.html#cb443-2" aria-hidden="true" tabindex="-1"></a>st_caption <span class="ot">&lt;-</span> <span class="st">&#39;Compare differences in probability predictions based on estimates and true probabilities&#39;</span></span>
<span id="cb443-3"><a href="nonlinear-and-other-regressions.html#cb443-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(mt_prob_o_esti<span class="sc">-</span>mt_prob_o, <span class="at">caption=</span>st_caption) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-221">Table 6.4: </span>Compare differences in probability predictions based on estimates and true probabilities
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m0
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m2
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
t1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
t2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
t3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="logistic-choices-with-time-specific-observables" class="section level4" number="6.1.2.2">
<h4><span class="header-section-number">6.1.2.2</span> Logistic Choices with Time-specific Observables</h4>
<p>In our example here, there are choice alternatives (<span class="math inline">\(m\)</span>) and time periods (<span class="math inline">\(t\)</span>). In terms of data inputs, in the prior example, we had on the Right</p>
<p>In the example in the prior section, the data structure included:</p>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(m\)</span>-specific variables: indicators</li>
<li><span class="math inline">\(m\)</span>- and <span class="math inline">\(t\)</span>-specific variables: wages</li>
</ol>
<p>In the new data structure for this section, we have:</p>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(m\)</span>-specific variables: indicators</li>
<li><span class="math inline">\(m\)</span>- and <span class="math inline">\(t\)</span>-specific variables: wages</li>
<li><span class="math inline">\(t\)</span>-specific variables: characteristics that are homogeneous across groups, but varying over time. This will include both a trend variable capturing time patterns, as well as an observable that is different over time.</li>
</ol>
<p>Suppose there is some information that impacts individual’s willingness to stay at home. Note that leisure is the same as work from home. For example, there could be technological improvements that makes home-production less time-consuming, and we might have a variable that captures the efficiency of home-technology. Captured by a time trend, there might also be changes in social attitudes, which could be harder to measure.</p>
<p>Suppose we still have:</p>
<p><span class="math display">\[
V_{itm} = \widehat{V}_{tm} + \epsilon_{itm} = \alpha_m + \beta\cdot\text{WAGE}_{tm}  + \epsilon_{itm}
\]</span></p>
<p>But now, for the leisure category we have:</p>
<p><span class="math display">\[
V_{it0} = \widehat{V}_{t0} + \epsilon_{it0} = \alpha_0 + \phi \cdot t + \theta\cdot\text{HOMETECH}_{t} + \epsilon_{it0}
\]</span></p>
<p>Because only the differences in value across choices matter, so we can continue with the prior normalization, in difference, we have:</p>
<p><span class="math display">\[
V_{itm} - V_{it0} = \left(\alpha_m - \alpha_0\right) + \left(\beta\cdot\text{WAGE}_{tm} - \phi \cdot t - \theta\cdot\text{HOMETECH}_{t} \right) + \left(\epsilon_{itm}-\epsilon_{it0}\right)
\]</span></p>
<p>Note that:</p>
<ul>
<li><span class="math inline">\(\alpha_0\)</span> is not identifiable.</li>
<li>If the HOMETECH or time variables are multiplied by negative one, the signs changes.</li>
<li>Since only the differences in value matter, the coefficients for these variables represent the net changes on alternative value difference due to changes in time-trend or the HOMETECH variable.</li>
</ul>
<div id="simulate-market-share-1" class="section level5" number="6.1.2.2.1">
<h5><span class="header-section-number">6.1.2.2.1</span> Simulate Market Share</h5>
<p>We simulate market share data now, with information over several more periods, and the HOMETECH variable, along with the time trend.</p>
<p>First, simulate the data.</p>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb444-1"><a href="nonlinear-and-other-regressions.html#cb444-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed</span></span>
<span id="cb444-2"><a href="nonlinear-and-other-regressions.html#cb444-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb444-3"><a href="nonlinear-and-other-regressions.html#cb444-3" aria-hidden="true" tabindex="-1"></a><span class="co"># T periods, and M occupations (+1 leisure/home)</span></span>
<span id="cb444-4"><a href="nonlinear-and-other-regressions.html#cb444-4" aria-hidden="true" tabindex="-1"></a>it_T <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb444-5"><a href="nonlinear-and-other-regressions.html#cb444-5" aria-hidden="true" tabindex="-1"></a>it_M <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb444-6"><a href="nonlinear-and-other-regressions.html#cb444-6" aria-hidden="true" tabindex="-1"></a><span class="co"># define alpha and beta parameters</span></span>
<span id="cb444-7"><a href="nonlinear-and-other-regressions.html#cb444-7" aria-hidden="true" tabindex="-1"></a>ar_alpha <span class="ot">&lt;-</span> <span class="fu">runif</span>(it_M)<span class="sc">*</span><span class="fl">0.5</span></span>
<span id="cb444-8"><a href="nonlinear-and-other-regressions.html#cb444-8" aria-hidden="true" tabindex="-1"></a>fl_beta <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>)<span class="sc">*</span><span class="fl">0.25</span></span>
<span id="cb444-9"><a href="nonlinear-and-other-regressions.html#cb444-9" aria-hidden="true" tabindex="-1"></a><span class="co"># also negative time-trend from home category perspective, culturally increasingly accepting of work</span></span>
<span id="cb444-10"><a href="nonlinear-and-other-regressions.html#cb444-10" aria-hidden="true" tabindex="-1"></a>fl_phi <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">runif</span>(<span class="dv">1</span>)<span class="sc">*</span><span class="fl">0.50</span></span>
<span id="cb444-11"><a href="nonlinear-and-other-regressions.html#cb444-11" aria-hidden="true" tabindex="-1"></a><span class="co"># home-tech is negative from home category perspective, higher home-tech, more chance to work</span></span>
<span id="cb444-12"><a href="nonlinear-and-other-regressions.html#cb444-12" aria-hidden="true" tabindex="-1"></a>fl_theta <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">runif</span>(<span class="dv">1</span>)<span class="sc">*</span><span class="dv">1</span></span>
<span id="cb444-13"><a href="nonlinear-and-other-regressions.html#cb444-13" aria-hidden="true" tabindex="-1"></a><span class="co"># wage matrix, no wage for leisure</span></span>
<span id="cb444-14"><a href="nonlinear-and-other-regressions.html#cb444-14" aria-hidden="true" tabindex="-1"></a>mt_wages <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">runif</span>(it_T<span class="sc">*</span>it_M) <span class="sc">+</span> <span class="dv">1</span>, <span class="at">nrow=</span>it_T, <span class="at">ncol=</span>it_M)</span>
<span id="cb444-15"><a href="nonlinear-and-other-regressions.html#cb444-15" aria-hidden="true" tabindex="-1"></a><span class="co"># HOMETECH changes, random and sorted in ascending order, increasing over time</span></span>
<span id="cb444-16"><a href="nonlinear-and-other-regressions.html#cb444-16" aria-hidden="true" tabindex="-1"></a>ar_hometech <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">runif</span>(it_T))</span>
<span id="cb444-17"><a href="nonlinear-and-other-regressions.html#cb444-17" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mt_wages) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;m&#39;</span>, <span class="fu">seq</span>(<span class="dv">1</span>,it_M))</span>
<span id="cb444-18"><a href="nonlinear-and-other-regressions.html#cb444-18" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(mt_wages) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;t&#39;</span>, <span class="fu">seq</span>(<span class="dv">1</span>,it_T))</span>
<span id="cb444-19"><a href="nonlinear-and-other-regressions.html#cb444-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a probability assignment function</span></span>
<span id="cb444-20"><a href="nonlinear-and-other-regressions.html#cb444-20" aria-hidden="true" tabindex="-1"></a>ffi_logit_prob2_alpha_beta <span class="ot">&lt;-</span> <span class="cf">function</span>(ar_alpha, fl_beta, fl_phi, fl_theta, ar_hometech, mt_wages) {</span>
<span id="cb444-21"><a href="nonlinear-and-other-regressions.html#cb444-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Dimensions</span></span>
<span id="cb444-22"><a href="nonlinear-and-other-regressions.html#cb444-22" aria-hidden="true" tabindex="-1"></a>  it_T <span class="ot">&lt;-</span> <span class="fu">dim</span>(mt_wages)[<span class="dv">1</span>]</span>
<span id="cb444-23"><a href="nonlinear-and-other-regressions.html#cb444-23" aria-hidden="true" tabindex="-1"></a>  it_M <span class="ot">&lt;-</span> <span class="fu">dim</span>(mt_wages)[<span class="dv">2</span>]</span>
<span id="cb444-24"><a href="nonlinear-and-other-regressions.html#cb444-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Aggregate probabilities</span></span>
<span id="cb444-25"><a href="nonlinear-and-other-regressions.html#cb444-25" aria-hidden="true" tabindex="-1"></a>  mt_prob_o <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span><span class="cn">NA</span>, <span class="at">nrow=</span>it_T, <span class="at">ncol=</span>it_M<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb444-26"><a href="nonlinear-and-other-regressions.html#cb444-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(mt_prob_o) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;m&#39;</span>, <span class="fu">seq</span>(<span class="dv">0</span>,it_M))</span>
<span id="cb444-27"><a href="nonlinear-and-other-regressions.html#cb444-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(mt_prob_o) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;t&#39;</span>, <span class="fu">seq</span>(<span class="dv">1</span>,it_T))</span>
<span id="cb444-28"><a href="nonlinear-and-other-regressions.html#cb444-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate Probabilities</span></span>
<span id="cb444-29"><a href="nonlinear-and-other-regressions.html#cb444-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (it_t <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>, it_T)) {</span>
<span id="cb444-30"><a href="nonlinear-and-other-regressions.html#cb444-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get current period wages</span></span>
<span id="cb444-31"><a href="nonlinear-and-other-regressions.html#cb444-31" aria-hidden="true" tabindex="-1"></a>    ar_wage_at_t <span class="ot">&lt;-</span> mt_wages[it_t, ]</span>
<span id="cb444-32"><a href="nonlinear-and-other-regressions.html#cb444-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Value without shocks/errors, M+1</span></span>
<span id="cb444-33"><a href="nonlinear-and-other-regressions.html#cb444-33" aria-hidden="true" tabindex="-1"></a>    ar_V_hat_at_t <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, ar_alpha <span class="sc">+</span> fl_beta<span class="sc">*</span>ar_wage_at_t <span class="sc">-</span> fl_phi<span class="sc">*</span>it_t <span class="sc">-</span> fl_theta<span class="sc">*</span>ar_hometech[it_t] )</span>
<span id="cb444-34"><a href="nonlinear-and-other-regressions.html#cb444-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Probabilities across M+1</span></span>
<span id="cb444-35"><a href="nonlinear-and-other-regressions.html#cb444-35" aria-hidden="true" tabindex="-1"></a>    fl_prob_denominator <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">exp</span>(ar_V_hat_at_t))</span>
<span id="cb444-36"><a href="nonlinear-and-other-regressions.html#cb444-36" aria-hidden="true" tabindex="-1"></a>    ar_prob_at_t <span class="ot">&lt;-</span> <span class="fu">exp</span>(ar_V_hat_at_t)<span class="sc">/</span>fl_prob_denominator</span>
<span id="cb444-37"><a href="nonlinear-and-other-regressions.html#cb444-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fill in</span></span>
<span id="cb444-38"><a href="nonlinear-and-other-regressions.html#cb444-38" aria-hidden="true" tabindex="-1"></a>    mt_prob_o[it_t,] <span class="ot">&lt;-</span> ar_prob_at_t</span>
<span id="cb444-39"><a href="nonlinear-and-other-regressions.html#cb444-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb444-40"><a href="nonlinear-and-other-regressions.html#cb444-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(mt_prob_o)</span>
<span id="cb444-41"><a href="nonlinear-and-other-regressions.html#cb444-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb444-42"><a href="nonlinear-and-other-regressions.html#cb444-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Show probabilities</span></span>
<span id="cb444-43"><a href="nonlinear-and-other-regressions.html#cb444-43" aria-hidden="true" tabindex="-1"></a>mt_prob_o2 <span class="ot">&lt;-</span> <span class="fu">ffi_logit_prob2_alpha_beta</span>(ar_alpha, fl_beta, fl_phi, fl_theta, ar_hometech, mt_wages)</span>
<span id="cb444-44"><a href="nonlinear-and-other-regressions.html#cb444-44" aria-hidden="true" tabindex="-1"></a>st_caption <span class="ot">&lt;-</span> <span class="st">&#39;Occupation aggregate participation probabilities across time: time-varying observables, time- and occupation-specific wages, occupation-specific intercepts; note reduction in m0, home-activity share over time&#39;</span></span>
<span id="cb444-45"><a href="nonlinear-and-other-regressions.html#cb444-45" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(mt_prob_o2, <span class="at">caption=</span>st_caption) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-222">Table 6.5: </span>Occupation aggregate participation probabilities across time: time-varying observables, time- and occupation-specific wages, occupation-specific intercepts; note reduction in m0, home-activity share over time
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m0
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m3
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m4
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
t1
</td>
<td style="text-align:right;">
0.1032335
</td>
<td style="text-align:right;">
0.2056532
</td>
<td style="text-align:right;">
0.2511476
</td>
<td style="text-align:right;">
0.1789233
</td>
<td style="text-align:right;">
0.2610423
</td>
</tr>
<tr>
<td style="text-align:left;">
t2
</td>
<td style="text-align:right;">
0.0932896
</td>
<td style="text-align:right;">
0.1891478
</td>
<td style="text-align:right;">
0.2441729
</td>
<td style="text-align:right;">
0.1906952
</td>
<td style="text-align:right;">
0.2826945
</td>
</tr>
<tr>
<td style="text-align:left;">
t3
</td>
<td style="text-align:right;">
0.0805830
</td>
<td style="text-align:right;">
0.1920307
</td>
<td style="text-align:right;">
0.2269798
</td>
<td style="text-align:right;">
0.2293885
</td>
<td style="text-align:right;">
0.2710180
</td>
</tr>
<tr>
<td style="text-align:left;">
t4
</td>
<td style="text-align:right;">
0.0633282
</td>
<td style="text-align:right;">
0.2043484
</td>
<td style="text-align:right;">
0.2589892
</td>
<td style="text-align:right;">
0.2137280
</td>
<td style="text-align:right;">
0.2596062
</td>
</tr>
<tr>
<td style="text-align:left;">
t5
</td>
<td style="text-align:right;">
0.0653460
</td>
<td style="text-align:right;">
0.1978795
</td>
<td style="text-align:right;">
0.2420864
</td>
<td style="text-align:right;">
0.2224408
</td>
<td style="text-align:right;">
0.2722473
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb445-1"><a href="nonlinear-and-other-regressions.html#cb445-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mt_prob_o</span></span></code></pre></div>
</div>
<div id="create-regression-data-inputs-1" class="section level5" number="6.1.2.2.2">
<h5><span class="header-section-number">6.1.2.2.2</span> Create Regression Data Inputs</h5>
<p>Second, generate relative market shares of various work occupations as prior</p>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="nonlinear-and-other-regressions.html#cb446-1" aria-hidden="true" tabindex="-1"></a>mt_prob_rela_m2leisure2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span>mt_prob_o2[<span class="dv">1</span><span class="sc">:</span>it_T, <span class="dv">2</span><span class="sc">:</span>(it_M<span class="sc">+</span><span class="dv">1</span>)], <span class="at">nrow=</span>it_T, <span class="at">ncol=</span>it_M)</span>
<span id="cb446-2"><a href="nonlinear-and-other-regressions.html#cb446-2" aria-hidden="true" tabindex="-1"></a>ar_prob_ols_output2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span><span class="fu">log</span>(mt_prob_rela_m2leisure2<span class="sc">/</span>mt_prob_o2[<span class="dv">1</span><span class="sc">:</span>it_T, <span class="dv">1</span>]), <span class="at">nrow=</span>it_T<span class="sc">*</span>it_M, <span class="at">ncol=</span><span class="dv">1</span>)</span></code></pre></div>
<p>Third, construct the estimation input matrices as before. There are <span class="math inline">\(M\)</span> indicator vectors, a time variable, a HOMETECH variable, and 1 wage vector for data inputs:</p>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb447-1"><a href="nonlinear-and-other-regressions.html#cb447-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Regression input matrix</span></span>
<span id="cb447-2"><a href="nonlinear-and-other-regressions.html#cb447-2" aria-hidden="true" tabindex="-1"></a>mt_prob_ols_input2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span><span class="cn">NA</span>, <span class="at">nrow=</span>it_T<span class="sc">*</span>it_M, <span class="at">ncol=</span>it_M<span class="sc">+</span><span class="dv">2</span><span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb447-3"><a href="nonlinear-and-other-regressions.html#cb447-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mt_prob_ols_input2) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;m&#39;</span>, <span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">dim</span>(mt_prob_ols_input2)[<span class="dv">2</span>]))</span>
<span id="cb447-4"><a href="nonlinear-and-other-regressions.html#cb447-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(mt_prob_ols_input2) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;rowMcrsT&#39;</span>, <span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">dim</span>(mt_prob_ols_input2)[<span class="dv">1</span>]))</span>
<span id="cb447-5"><a href="nonlinear-and-other-regressions.html#cb447-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate index position in ols input matrix for M indicators</span></span>
<span id="cb447-6"><a href="nonlinear-and-other-regressions.html#cb447-6" aria-hidden="true" tabindex="-1"></a>mt_m_indicators <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span><span class="cn">NA</span>, <span class="at">nrow=</span>it_T<span class="sc">*</span>it_M, <span class="at">ncol=</span>it_M)</span>
<span id="cb447-7"><a href="nonlinear-and-other-regressions.html#cb447-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (it_indix <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>, it_M)) {</span>
<span id="cb447-8"><a href="nonlinear-and-other-regressions.html#cb447-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (it_rowMcrsT <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>, it_T<span class="sc">*</span>it_M)) {</span>
<span id="cb447-9"><a href="nonlinear-and-other-regressions.html#cb447-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ((it_rowMcrsT <span class="sc">&gt;=</span> (it_indix<span class="dv">-1</span>)<span class="sc">*</span>(it_T) <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">&amp;&amp;</span> it_rowMcrsT <span class="sc">&lt;=</span> it_indix<span class="sc">*</span>(it_T)){</span>
<span id="cb447-10"><a href="nonlinear-and-other-regressions.html#cb447-10" aria-hidden="true" tabindex="-1"></a>      mt_m_indicators[it_rowMcrsT, it_indix] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb447-11"><a href="nonlinear-and-other-regressions.html#cb447-11" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb447-12"><a href="nonlinear-and-other-regressions.html#cb447-12" aria-hidden="true" tabindex="-1"></a>      mt_m_indicators[it_rowMcrsT, it_indix] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb447-13"><a href="nonlinear-and-other-regressions.html#cb447-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb447-14"><a href="nonlinear-and-other-regressions.html#cb447-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb447-15"><a href="nonlinear-and-other-regressions.html#cb447-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb447-16"><a href="nonlinear-and-other-regressions.html#cb447-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Indicators are the earlier columns</span></span>
<span id="cb447-17"><a href="nonlinear-and-other-regressions.html#cb447-17" aria-hidden="true" tabindex="-1"></a>mt_prob_ols_input2[, <span class="dv">1</span><span class="sc">:</span>it_M] <span class="ot">&lt;-</span> mt_m_indicators</span>
<span id="cb447-18"><a href="nonlinear-and-other-regressions.html#cb447-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Time variable column</span></span>
<span id="cb447-19"><a href="nonlinear-and-other-regressions.html#cb447-19" aria-hidden="true" tabindex="-1"></a>ar_time <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">seq</span>(<span class="dv">1</span>,it_T), <span class="at">nrow=</span>it_T<span class="sc">*</span>it_M, <span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb447-20"><a href="nonlinear-and-other-regressions.html#cb447-20" aria-hidden="true" tabindex="-1"></a>mt_prob_ols_input2[, it_M<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> ar_time</span>
<span id="cb447-21"><a href="nonlinear-and-other-regressions.html#cb447-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Home Tech Column</span></span>
<span id="cb447-22"><a href="nonlinear-and-other-regressions.html#cb447-22" aria-hidden="true" tabindex="-1"></a>ar_hometech_mesh <span class="ot">&lt;-</span> <span class="fu">matrix</span>(ar_hometech, <span class="at">nrow=</span>it_T<span class="sc">*</span>it_M, <span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb447-23"><a href="nonlinear-and-other-regressions.html#cb447-23" aria-hidden="true" tabindex="-1"></a>mt_prob_ols_input2[, it_M<span class="sc">+</span><span class="dv">2</span>] <span class="ot">&lt;-</span> ar_hometech_mesh</span>
<span id="cb447-24"><a href="nonlinear-and-other-regressions.html#cb447-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Wage is the last column</span></span>
<span id="cb447-25"><a href="nonlinear-and-other-regressions.html#cb447-25" aria-hidden="true" tabindex="-1"></a>mt_prob_ols_input2[, it_M<span class="sc">+</span><span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span>mt_wages, <span class="at">nrow=</span>it_T<span class="sc">*</span>it_M, <span class="at">ncol=</span><span class="dv">1</span>)</span></code></pre></div>
<p>Fourth, combine left-hand-side and right-hand-side regression input data structures/</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="nonlinear-and-other-regressions.html#cb448-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Construct data structure</span></span>
<span id="cb448-2"><a href="nonlinear-and-other-regressions.html#cb448-2" aria-hidden="true" tabindex="-1"></a>mt_all_inputs2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(ar_prob_ols_output2, mt_prob_ols_input2)</span>
<span id="cb448-3"><a href="nonlinear-and-other-regressions.html#cb448-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mt_all_inputs2)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&#39;log_pm_over_po&#39;</span></span>
<span id="cb448-4"><a href="nonlinear-and-other-regressions.html#cb448-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mt_all_inputs2)[<span class="fu">dim</span>(mt_all_inputs2)[<span class="dv">2</span>]<span class="sc">-</span><span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="st">&#39;time&#39;</span></span>
<span id="cb448-5"><a href="nonlinear-and-other-regressions.html#cb448-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mt_all_inputs2)[<span class="fu">dim</span>(mt_all_inputs2)[<span class="dv">2</span>]<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&#39;hometech&#39;</span></span>
<span id="cb448-6"><a href="nonlinear-and-other-regressions.html#cb448-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mt_all_inputs2)[<span class="fu">dim</span>(mt_all_inputs2)[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="st">&#39;wages&#39;</span></span>
<span id="cb448-7"><a href="nonlinear-and-other-regressions.html#cb448-7" aria-hidden="true" tabindex="-1"></a>tb_all_inputs2 <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(mt_all_inputs2)</span>
<span id="cb448-8"><a href="nonlinear-and-other-regressions.html#cb448-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Show data</span></span>
<span id="cb448-9"><a href="nonlinear-and-other-regressions.html#cb448-9" aria-hidden="true" tabindex="-1"></a>st_caption <span class="ot">&lt;-</span> <span class="st">&#39;LHS=Log Probability Ratios (column 1); RHS=Indicators of occupations and other variables, OLS inputs (other columns)&#39;</span></span>
<span id="cb448-10"><a href="nonlinear-and-other-regressions.html#cb448-10" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(tb_all_inputs2, <span class="at">caption=</span>st_caption) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-225">Table 6.6: </span>LHS=Log Probability Ratios (column 1); RHS=Indicators of occupations and other variables, OLS inputs (other columns)
</caption>
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
log_pm_over_po
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m3
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m4
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
time
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
hometech
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
wages
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0.6891981
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.1471136
</td>
<td style="text-align:right;">
1.892419
</td>
</tr>
<tr>
<td style="text-align:right;">
0.7068206
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.2891597
</td>
<td style="text-align:right;">
1.551435
</td>
</tr>
<tr>
<td style="text-align:right;">
0.8683678
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.5941420
</td>
<td style="text-align:right;">
1.456615
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1714953
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.9022990
</td>
<td style="text-align:right;">
1.956833
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1079617
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.9630242
</td>
<td style="text-align:right;">
1.453334
</td>
</tr>
<tr>
<td style="text-align:right;">
0.8890474
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.1471136
</td>
<td style="text-align:right;">
1.677571
</td>
</tr>
<tr>
<td style="text-align:right;">
0.9621685
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.2891597
</td>
<td style="text-align:right;">
1.572633
</td>
</tr>
<tr>
<td style="text-align:right;">
1.0355731
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.5941420
</td>
<td style="text-align:right;">
1.102925
</td>
</tr>
<tr>
<td style="text-align:right;">
1.4084555
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.9022990
</td>
<td style="text-align:right;">
1.899825
</td>
</tr>
<tr>
<td style="text-align:right;">
1.3095984
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.9630242
</td>
<td style="text-align:right;">
1.246088
</td>
</tr>
<tr>
<td style="text-align:right;">
0.5499640
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.1471136
</td>
<td style="text-align:right;">
1.042059
</td>
</tr>
<tr>
<td style="text-align:right;">
0.7149683
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.2891597
</td>
<td style="text-align:right;">
1.327921
</td>
</tr>
<tr>
<td style="text-align:right;">
1.0461296
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.5941420
</td>
<td style="text-align:right;">
1.954504
</td>
</tr>
<tr>
<td style="text-align:right;">
1.2163730
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.9022990
</td>
<td style="text-align:right;">
1.889539
</td>
</tr>
<tr>
<td style="text-align:right;">
1.2249646
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.9630242
</td>
<td style="text-align:right;">
1.692803
</td>
</tr>
<tr>
<td style="text-align:right;">
0.9276892
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.1471136
</td>
<td style="text-align:right;">
1.640507
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1086584
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.2891597
</td>
<td style="text-align:right;">
1.994270
</td>
</tr>
<tr>
<td style="text-align:right;">
1.2128974
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.5941420
</td>
<td style="text-align:right;">
1.655706
</td>
</tr>
<tr>
<td style="text-align:right;">
1.4108350
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.9022990
</td>
<td style="text-align:right;">
1.708530
</td>
</tr>
<tr>
<td style="text-align:right;">
1.4270142
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.9630242
</td>
<td style="text-align:right;">
1.544066
</td>
</tr>
</tbody>
</table>
</div>
<div id="estimate-wage-coefficients-hometech-effects-and-time-trend" class="section level5" number="6.1.2.2.3">
<h5><span class="header-section-number">6.1.2.2.3</span> Estimate Wage Coefficients, HOMETECH Effects and Time Trend</h5>
<p>Similar to before, estimate with OLS.</p>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb449-1"><a href="nonlinear-and-other-regressions.html#cb449-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Regression</span></span>
<span id="cb449-2"><a href="nonlinear-and-other-regressions.html#cb449-2" aria-hidden="true" tabindex="-1"></a>fit_ols_agg_prob2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_pm_over_po <span class="sc">~</span> . <span class="sc">-</span><span class="dv">1</span>, <span class="at">data =</span> tb_all_inputs2)</span>
<span id="cb449-3"><a href="nonlinear-and-other-regressions.html#cb449-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_ols_agg_prob2)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = log_pm_over_po ~ . - 1, data = tb_all_inputs2)
## 
## Residuals:
##        Min         1Q     Median         3Q        Max 
## -2.670e-16 -8.439e-17 -2.664e-17  9.403e-17  2.704e-16 
## 
## Coefficients:
##           Estimate Std. Error   t value Pr(&gt;|t|)    
## m1       1.438e-01  3.165e-16 4.543e+14   &lt;2e-16 ***
## m2       3.942e-01  2.927e-16 1.347e+15   &lt;2e-16 ***
## m3       2.045e-01  3.046e-16 6.713e+14   &lt;2e-16 ***
## m4       4.415e-01  3.234e-16 1.365e+15   &lt;2e-16 ***
## time     2.278e-02  1.568e-16 1.453e+14   &lt;2e-16 ***
## hometech 5.281e-01  6.900e-16 7.653e+14   &lt;2e-16 ***
## wages    2.351e-01  1.615e-16 1.456e+15   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.741e-16 on 13 degrees of freedom
## Multiple R-squared:      1,  Adjusted R-squared:      1 
## F-statistic: 1.098e+32 on 7 and 13 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="nonlinear-and-other-regressions.html#cb451-1" aria-hidden="true" tabindex="-1"></a><span class="co"># alpha estimates</span></span>
<span id="cb451-2"><a href="nonlinear-and-other-regressions.html#cb451-2" aria-hidden="true" tabindex="-1"></a>ar_coefficients2 <span class="ot">&lt;-</span> fit_ols_agg_prob2<span class="sc">$</span>coefficients</span>
<span id="cb451-3"><a href="nonlinear-and-other-regressions.html#cb451-3" aria-hidden="true" tabindex="-1"></a>ar_alpha_esti2 <span class="ot">&lt;-</span> ar_coefficients2[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(ar_coefficients2)<span class="sc">-</span><span class="dv">3</span>)]</span>
<span id="cb451-4"><a href="nonlinear-and-other-regressions.html#cb451-4" aria-hidden="true" tabindex="-1"></a><span class="co"># time -1 because of the sign structure</span></span>
<span id="cb451-5"><a href="nonlinear-and-other-regressions.html#cb451-5" aria-hidden="true" tabindex="-1"></a>fl_phi_esti2 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span><span class="sc">*</span>ar_coefficients2[<span class="fu">length</span>(ar_coefficients2)<span class="sc">-</span><span class="dv">2</span>]</span>
<span id="cb451-6"><a href="nonlinear-and-other-regressions.html#cb451-6" aria-hidden="true" tabindex="-1"></a><span class="co"># time -1 because of the sign structure</span></span>
<span id="cb451-7"><a href="nonlinear-and-other-regressions.html#cb451-7" aria-hidden="true" tabindex="-1"></a>fl_theta_esti2 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span><span class="sc">*</span>ar_coefficients2[<span class="fu">length</span>(ar_coefficients2)<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb451-8"><a href="nonlinear-and-other-regressions.html#cb451-8" aria-hidden="true" tabindex="-1"></a>fl_beta_esti2 <span class="ot">&lt;-</span> ar_coefficients2[<span class="fu">length</span>(ar_coefficients2)]</span>
<span id="cb451-9"><a href="nonlinear-and-other-regressions.html#cb451-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare estimates and true</span></span>
<span id="cb451-10"><a href="nonlinear-and-other-regressions.html#cb451-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&#39;ar_alpha_esti2=&#39;</span>, ar_alpha_esti2))</span></code></pre></div>
<pre><code>## [1] &quot;ar_alpha_esti2=0.143788760062308&quot; &quot;ar_alpha_esti2=0.394152567721904&quot; &quot;ar_alpha_esti2=0.20448846090585&quot;  &quot;ar_alpha_esti2=0.441508702002466&quot;</code></pre>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="nonlinear-and-other-regressions.html#cb453-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&#39;ar_alpha=&#39;</span>, ar_alpha))</span></code></pre></div>
<pre><code>## [1] &quot;ar_alpha=0.143788760062307&quot; &quot;ar_alpha=0.394152567721903&quot; &quot;ar_alpha=0.20448846090585&quot;  &quot;ar_alpha=0.441508702002466&quot;</code></pre>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb455-1"><a href="nonlinear-and-other-regressions.html#cb455-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&#39;fl_theta_esti2=&#39;</span>, fl_theta_esti2))</span></code></pre></div>
<pre><code>## [1] &quot;fl_theta_esti2=-0.528105488047005&quot;</code></pre>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb457-1"><a href="nonlinear-and-other-regressions.html#cb457-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&#39;fl_theta=&#39;</span>, fl_theta))</span></code></pre></div>
<pre><code>## [1] &quot;fl_theta=-0.528105488047004&quot;</code></pre>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb459-1"><a href="nonlinear-and-other-regressions.html#cb459-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&#39;fl_phi_esti2=&#39;</span>, fl_phi_esti2))</span></code></pre></div>
<pre><code>## [1] &quot;fl_phi_esti2=-0.0227782496949655&quot;</code></pre>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="nonlinear-and-other-regressions.html#cb461-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&#39;fl_phi=&#39;</span>, fl_phi))</span></code></pre></div>
<pre><code>## [1] &quot;fl_phi=-0.0227782496949658&quot;</code></pre>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb463-1"><a href="nonlinear-and-other-regressions.html#cb463-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&#39;fl_beta_esti2=&#39;</span>, fl_beta_esti2))</span></code></pre></div>
<pre><code>## [1] &quot;fl_beta_esti2=0.235116821073461&quot;</code></pre>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb465-1"><a href="nonlinear-and-other-regressions.html#cb465-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&#39;fl_beta=&#39;</span>, fl_beta))</span></code></pre></div>
<pre><code>## [1] &quot;fl_beta=0.235116821073461&quot;</code></pre>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb467-1"><a href="nonlinear-and-other-regressions.html#cb467-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate given estimated parameters using earlier function</span></span>
<span id="cb467-2"><a href="nonlinear-and-other-regressions.html#cb467-2" aria-hidden="true" tabindex="-1"></a>mt_prob_o2_esti <span class="ot">&lt;-</span> <span class="fu">ffi_logit_prob2_alpha_beta</span>(ar_alpha_esti2, fl_beta_esti2, fl_phi_esti2, fl_theta_esti2, ar_hometech, mt_wages)</span>
<span id="cb467-3"><a href="nonlinear-and-other-regressions.html#cb467-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Results</span></span>
<span id="cb467-4"><a href="nonlinear-and-other-regressions.html#cb467-4" aria-hidden="true" tabindex="-1"></a>st_caption <span class="ot">&lt;-</span> <span class="st">&#39;Predicted probabilities based on estimates&#39;</span></span>
<span id="cb467-5"><a href="nonlinear-and-other-regressions.html#cb467-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(mt_prob_o2_esti, <span class="at">caption=</span>st_caption) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-226">Table 6.7: </span>Predicted probabilities based on estimates
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m0
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m3
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m4
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
t1
</td>
<td style="text-align:right;">
0.1032335
</td>
<td style="text-align:right;">
0.2056532
</td>
<td style="text-align:right;">
0.2511476
</td>
<td style="text-align:right;">
0.1789233
</td>
<td style="text-align:right;">
0.2610423
</td>
</tr>
<tr>
<td style="text-align:left;">
t2
</td>
<td style="text-align:right;">
0.0932896
</td>
<td style="text-align:right;">
0.1891478
</td>
<td style="text-align:right;">
0.2441729
</td>
<td style="text-align:right;">
0.1906952
</td>
<td style="text-align:right;">
0.2826945
</td>
</tr>
<tr>
<td style="text-align:left;">
t3
</td>
<td style="text-align:right;">
0.0805830
</td>
<td style="text-align:right;">
0.1920307
</td>
<td style="text-align:right;">
0.2269798
</td>
<td style="text-align:right;">
0.2293885
</td>
<td style="text-align:right;">
0.2710180
</td>
</tr>
<tr>
<td style="text-align:left;">
t4
</td>
<td style="text-align:right;">
0.0633282
</td>
<td style="text-align:right;">
0.2043484
</td>
<td style="text-align:right;">
0.2589892
</td>
<td style="text-align:right;">
0.2137280
</td>
<td style="text-align:right;">
0.2596062
</td>
</tr>
<tr>
<td style="text-align:left;">
t5
</td>
<td style="text-align:right;">
0.0653460
</td>
<td style="text-align:right;">
0.1978795
</td>
<td style="text-align:right;">
0.2420864
</td>
<td style="text-align:right;">
0.2224408
</td>
<td style="text-align:right;">
0.2722473
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="nonlinear-and-other-regressions.html#cb468-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Results</span></span>
<span id="cb468-2"><a href="nonlinear-and-other-regressions.html#cb468-2" aria-hidden="true" tabindex="-1"></a>st_caption <span class="ot">&lt;-</span> <span class="st">&#39;Compare differences in probability predictions based on estimates and true probabilities&#39;</span></span>
<span id="cb468-3"><a href="nonlinear-and-other-regressions.html#cb468-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(mt_prob_o2_esti<span class="sc">-</span>mt_prob_o2, <span class="at">caption=</span>st_caption) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-226">Table 6.7: </span>Compare differences in probability predictions based on estimates and true probabilities
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m0
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m3
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m4
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
t1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
t2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
t3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
t4
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
t5
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="logistic-choices-and-multiple-types-of-workers" class="section level4" number="6.1.2.3">
<h4><span class="header-section-number">6.1.2.3</span> Logistic Choices and Multiple Types of Workers</h4>
<p>In the prior two examples, we had the same type of worker, choosing among multiple occupations. There could be different types of workers, unskilled and skilled workers, both of whom can choose among the same set of job possibilities. If the two types of workers do not share any parameters in the occupation-choice problems, then we can estimate their problems separately. However, perhaps on the stay-at-home front, they share the same time trend, which captures overall cultural changes to work vs not-work. And perhaps the wage parameter is the same. On other fronts, they are different with different parameters as well as data inputs.</p>
<p>So we have:</p>
<p><span class="math display">\[
V_{istm} - V_{ist0} = \left(\alpha_{sm} - \alpha_{s0}\right) + \left(\beta\cdot\text{WAGE}_{stm} - \phi \cdot t - \theta_s\cdot\text{HOMETECH}_{st} \right) + \left(\epsilon_{istm}-\epsilon_{ist0}\right)
\]</span></p>
<p>In the new data structure for this section, we have:</p>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(k\)</span>- and <span class="math inline">\(m\)</span>-specific variables: indicators</li>
<li><span class="math inline">\(k\)</span>- and <span class="math inline">\(m\)</span>- and <span class="math inline">\(t\)</span>-specific variable: wages</li>
<li><span class="math inline">\(t\)</span>-specific variable: dates</li>
<li><span class="math inline">\(k\)</span>- and <span class="math inline">\(t\)</span>-specific variable: hometech</li>
</ol>
<div id="simulate-market-share-2" class="section level5" number="6.1.2.3.1">
<h5><span class="header-section-number">6.1.2.3.1</span> Simulate Market Share</h5>
<p>In the simulation example, store all K types and T time periods as rows, and the M occupational types as columns.</p>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb469-1"><a href="nonlinear-and-other-regressions.html#cb469-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed</span></span>
<span id="cb469-2"><a href="nonlinear-and-other-regressions.html#cb469-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb469-3"><a href="nonlinear-and-other-regressions.html#cb469-3" aria-hidden="true" tabindex="-1"></a><span class="co"># K skill levels, T periods, and M occupations (+1 leisure/home)</span></span>
<span id="cb469-4"><a href="nonlinear-and-other-regressions.html#cb469-4" aria-hidden="true" tabindex="-1"></a>it_K <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb469-5"><a href="nonlinear-and-other-regressions.html#cb469-5" aria-hidden="true" tabindex="-1"></a>it_T <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb469-6"><a href="nonlinear-and-other-regressions.html#cb469-6" aria-hidden="true" tabindex="-1"></a>it_M <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb469-7"><a href="nonlinear-and-other-regressions.html#cb469-7" aria-hidden="true" tabindex="-1"></a><span class="co"># define alpha and beta parameters</span></span>
<span id="cb469-8"><a href="nonlinear-and-other-regressions.html#cb469-8" aria-hidden="true" tabindex="-1"></a>mt_alpha <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">runif</span>(it_K<span class="sc">*</span>it_M)<span class="sc">*</span><span class="fl">0.5</span>, <span class="at">nrow=</span>it_K, <span class="at">ncol=</span>it_M)</span>
<span id="cb469-9"><a href="nonlinear-and-other-regressions.html#cb469-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mt_alpha) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;m&#39;</span>, <span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">dim</span>(mt_alpha)[<span class="dv">2</span>]))</span>
<span id="cb469-10"><a href="nonlinear-and-other-regressions.html#cb469-10" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(mt_alpha) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;k&#39;</span>, <span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">dim</span>(mt_alpha)[<span class="dv">1</span>]))</span>
<span id="cb469-11"><a href="nonlinear-and-other-regressions.html#cb469-11" aria-hidden="true" tabindex="-1"></a>fl_beta <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>)<span class="sc">*</span><span class="fl">0.25</span></span>
<span id="cb469-12"><a href="nonlinear-and-other-regressions.html#cb469-12" aria-hidden="true" tabindex="-1"></a><span class="co"># also negative time-trend from home category perspective, culturally increasingly accepting of work</span></span>
<span id="cb469-13"><a href="nonlinear-and-other-regressions.html#cb469-13" aria-hidden="true" tabindex="-1"></a>fl_phi <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">runif</span>(<span class="dv">1</span>)<span class="sc">*</span><span class="fl">0.50</span></span>
<span id="cb469-14"><a href="nonlinear-and-other-regressions.html#cb469-14" aria-hidden="true" tabindex="-1"></a><span class="co"># home-tech is negative from home category perspective, higher home-tech, more chance to work</span></span>
<span id="cb469-15"><a href="nonlinear-and-other-regressions.html#cb469-15" aria-hidden="true" tabindex="-1"></a>ar_theta <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">runif</span>(it_K)<span class="sc">*</span><span class="dv">1</span></span>
<span id="cb469-16"><a href="nonlinear-and-other-regressions.html#cb469-16" aria-hidden="true" tabindex="-1"></a><span class="co"># wage matrix, no wage for leisure</span></span>
<span id="cb469-17"><a href="nonlinear-and-other-regressions.html#cb469-17" aria-hidden="true" tabindex="-1"></a>mt_wages <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">runif</span>(it_K<span class="sc">*</span>it_T<span class="sc">*</span>it_M) <span class="sc">+</span> <span class="dv">1</span>, <span class="at">nrow=</span>it_K<span class="sc">*</span>it_T, <span class="at">ncol=</span>it_M)</span>
<span id="cb469-18"><a href="nonlinear-and-other-regressions.html#cb469-18" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mt_wages) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;m&#39;</span>, <span class="fu">seq</span>(<span class="dv">1</span>,it_M))</span>
<span id="cb469-19"><a href="nonlinear-and-other-regressions.html#cb469-19" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(mt_wages) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;kxt&#39;</span>, <span class="fu">seq</span>(<span class="dv">1</span>,it_K<span class="sc">*</span>it_T))</span>
<span id="cb469-20"><a href="nonlinear-and-other-regressions.html#cb469-20" aria-hidden="true" tabindex="-1"></a><span class="co"># HOMETECH changes, random and sorted in ascending order, increasing over time, specific to each k</span></span>
<span id="cb469-21"><a href="nonlinear-and-other-regressions.html#cb469-21" aria-hidden="true" tabindex="-1"></a>mt_hometech <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">seq</span>(<span class="dv">1</span>,it_K), <span class="cf">function</span>(i){<span class="fu">sort</span>(<span class="fu">runif</span>(it_T))})</span>
<span id="cb469-22"><a href="nonlinear-and-other-regressions.html#cb469-22" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mt_hometech) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;k&#39;</span>, <span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">dim</span>(mt_hometech)[<span class="dv">2</span>]))</span>
<span id="cb469-23"><a href="nonlinear-and-other-regressions.html#cb469-23" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(mt_hometech) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;t&#39;</span>, <span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">dim</span>(mt_hometech)[<span class="dv">1</span>]))</span>
<span id="cb469-24"><a href="nonlinear-and-other-regressions.html#cb469-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a probability assignment function</span></span>
<span id="cb469-25"><a href="nonlinear-and-other-regressions.html#cb469-25" aria-hidden="true" tabindex="-1"></a>ffi_logit_prob3_alpha_beta <span class="ot">&lt;-</span> <span class="cf">function</span>(it_K, it_T, it_M,</span>
<span id="cb469-26"><a href="nonlinear-and-other-regressions.html#cb469-26" aria-hidden="true" tabindex="-1"></a>  mt_alpha, fl_beta, fl_phi, ar_theta, mt_hometech, mt_wages) {</span>
<span id="cb469-27"><a href="nonlinear-and-other-regressions.html#cb469-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb469-28"><a href="nonlinear-and-other-regressions.html#cb469-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Aggregate probabilities</span></span>
<span id="cb469-29"><a href="nonlinear-and-other-regressions.html#cb469-29" aria-hidden="true" tabindex="-1"></a>  mt_prob_o <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span><span class="cn">NA</span>, <span class="at">nrow=</span>it_K<span class="sc">*</span>it_T, <span class="at">ncol=</span>it_M<span class="sc">+</span><span class="dv">3</span>)</span>
<span id="cb469-30"><a href="nonlinear-and-other-regressions.html#cb469-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(mt_prob_o) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;skillgroup&#39;</span>, <span class="st">&#39;time&#39;</span>, <span class="fu">paste0</span>(<span class="st">&#39;m&#39;</span>, <span class="fu">seq</span>(<span class="dv">0</span>,it_M)))</span>
<span id="cb469-31"><a href="nonlinear-and-other-regressions.html#cb469-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(mt_prob_o) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;kxt&#39;</span>, <span class="fu">seq</span>(<span class="dv">1</span>,it_K<span class="sc">*</span>it_T))</span>
<span id="cb469-32"><a href="nonlinear-and-other-regressions.html#cb469-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate Probabilities</span></span>
<span id="cb469-33"><a href="nonlinear-and-other-regressions.html#cb469-33" aria-hidden="true" tabindex="-1"></a>  it_kxt_ctr <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb469-34"><a href="nonlinear-and-other-regressions.html#cb469-34" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (it_k <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>, it_K)) {</span>
<span id="cb469-35"><a href="nonlinear-and-other-regressions.html#cb469-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (it_t <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>, it_T)) {</span>
<span id="cb469-36"><a href="nonlinear-and-other-regressions.html#cb469-36" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Counter updating</span></span>
<span id="cb469-37"><a href="nonlinear-and-other-regressions.html#cb469-37" aria-hidden="true" tabindex="-1"></a>      it_kxt_ctr <span class="ot">&lt;-</span> it_kxt_ctr <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb469-38"><a href="nonlinear-and-other-regressions.html#cb469-38" aria-hidden="true" tabindex="-1"></a>      <span class="co"># get current period wages</span></span>
<span id="cb469-39"><a href="nonlinear-and-other-regressions.html#cb469-39" aria-hidden="true" tabindex="-1"></a>      ar_wage_at_t <span class="ot">&lt;-</span> mt_wages[it_kxt_ctr, ]</span>
<span id="cb469-40"><a href="nonlinear-and-other-regressions.html#cb469-40" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Value without shocks/errors, M+1</span></span>
<span id="cb469-41"><a href="nonlinear-and-other-regressions.html#cb469-41" aria-hidden="true" tabindex="-1"></a>      ar_V_hat_at_t <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, mt_alpha[it_k,] <span class="sc">+</span> fl_beta<span class="sc">*</span>ar_wage_at_t <span class="sc">-</span> fl_phi<span class="sc">*</span>it_t <span class="sc">-</span> ar_theta[it_k]<span class="sc">*</span>mt_hometech[it_t, it_k])</span>
<span id="cb469-42"><a href="nonlinear-and-other-regressions.html#cb469-42" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Probabilities across M+1</span></span>
<span id="cb469-43"><a href="nonlinear-and-other-regressions.html#cb469-43" aria-hidden="true" tabindex="-1"></a>      fl_prob_denominator <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">exp</span>(ar_V_hat_at_t))</span>
<span id="cb469-44"><a href="nonlinear-and-other-regressions.html#cb469-44" aria-hidden="true" tabindex="-1"></a>      ar_prob_at_t <span class="ot">&lt;-</span> <span class="fu">exp</span>(ar_V_hat_at_t)<span class="sc">/</span>fl_prob_denominator</span>
<span id="cb469-45"><a href="nonlinear-and-other-regressions.html#cb469-45" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Fill in</span></span>
<span id="cb469-46"><a href="nonlinear-and-other-regressions.html#cb469-46" aria-hidden="true" tabindex="-1"></a>      mt_prob_o[it_kxt_ctr,<span class="dv">1</span>] <span class="ot">&lt;-</span> it_k</span>
<span id="cb469-47"><a href="nonlinear-and-other-regressions.html#cb469-47" aria-hidden="true" tabindex="-1"></a>      mt_prob_o[it_kxt_ctr,<span class="dv">2</span>] <span class="ot">&lt;-</span> it_t</span>
<span id="cb469-48"><a href="nonlinear-and-other-regressions.html#cb469-48" aria-hidden="true" tabindex="-1"></a>      mt_prob_o[it_kxt_ctr,<span class="dv">3</span><span class="sc">:</span><span class="fu">dim</span>(mt_prob_o)[<span class="dv">2</span>]] <span class="ot">&lt;-</span> ar_prob_at_t</span>
<span id="cb469-49"><a href="nonlinear-and-other-regressions.html#cb469-49" aria-hidden="true" tabindex="-1"></a>      <span class="co"># row name</span></span>
<span id="cb469-50"><a href="nonlinear-and-other-regressions.html#cb469-50" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rownames</span>(mt_prob_o)[it_kxt_ctr] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;rk&#39;</span>, it_k, <span class="st">&#39;t&#39;</span>, it_t)</span>
<span id="cb469-51"><a href="nonlinear-and-other-regressions.html#cb469-51" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb469-52"><a href="nonlinear-and-other-regressions.html#cb469-52" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb469-53"><a href="nonlinear-and-other-regressions.html#cb469-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(mt_prob_o)</span>
<span id="cb469-54"><a href="nonlinear-and-other-regressions.html#cb469-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb469-55"><a href="nonlinear-and-other-regressions.html#cb469-55" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb469-56"><a href="nonlinear-and-other-regressions.html#cb469-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Show probabilities</span></span>
<span id="cb469-57"><a href="nonlinear-and-other-regressions.html#cb469-57" aria-hidden="true" tabindex="-1"></a>mt_prob_o3_full <span class="ot">&lt;-</span> <span class="fu">ffi_logit_prob3_alpha_beta</span>(it_K, it_T, it_M,</span>
<span id="cb469-58"><a href="nonlinear-and-other-regressions.html#cb469-58" aria-hidden="true" tabindex="-1"></a>  mt_alpha, fl_beta, fl_phi, ar_theta, mt_hometech, mt_wages)</span>
<span id="cb469-59"><a href="nonlinear-and-other-regressions.html#cb469-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Selected only probability columns</span></span>
<span id="cb469-60"><a href="nonlinear-and-other-regressions.html#cb469-60" aria-hidden="true" tabindex="-1"></a>mt_prob_o3 <span class="ot">&lt;-</span> mt_prob_o3_full[, <span class="dv">3</span><span class="sc">:</span><span class="fu">dim</span>(mt_prob_o3_full)[<span class="dv">2</span>]]</span>
<span id="cb469-61"><a href="nonlinear-and-other-regressions.html#cb469-61" aria-hidden="true" tabindex="-1"></a>st_caption <span class="ot">&lt;-</span> <span class="st">&#39;Occupation aggregate participation probabilities across time: skill- and time-varying observables, skill and time- and occupation-specific wages, skill and occupation-specific intercepts; common wage coefficient and time coefficient; note reduction in m0, home-activity share over time&#39;</span></span>
<span id="cb469-62"><a href="nonlinear-and-other-regressions.html#cb469-62" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(mt_prob_o3_full, <span class="at">caption=</span>st_caption) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-227">Table 6.8: </span>Occupation aggregate participation probabilities across time: skill- and time-varying observables, skill and time- and occupation-specific wages, skill and occupation-specific intercepts; common wage coefficient and time coefficient; note reduction in m0, home-activity share over time
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
skillgroup
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
time
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m0
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m3
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m4
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
rk1t1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0887175
</td>
<td style="text-align:right;">
0.1995146
</td>
<td style="text-align:right;">
0.2020237
</td>
<td style="text-align:right;">
0.2757014
</td>
<td style="text-align:right;">
0.2340428
</td>
</tr>
<tr>
<td style="text-align:left;">
rk1t2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.0646539
</td>
<td style="text-align:right;">
0.1984822
</td>
<td style="text-align:right;">
0.2223035
</td>
<td style="text-align:right;">
0.2803052
</td>
<td style="text-align:right;">
0.2342551
</td>
</tr>
<tr>
<td style="text-align:left;">
rk1t3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.0358582
</td>
<td style="text-align:right;">
0.1975615
</td>
<td style="text-align:right;">
0.2339696
</td>
<td style="text-align:right;">
0.2909961
</td>
<td style="text-align:right;">
0.2416147
</td>
</tr>
<tr>
<td style="text-align:left;">
rk2t1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0942785
</td>
<td style="text-align:right;">
0.2435583
</td>
<td style="text-align:right;">
0.2481846
</td>
<td style="text-align:right;">
0.1610703
</td>
<td style="text-align:right;">
0.2529083
</td>
</tr>
<tr>
<td style="text-align:left;">
rk2t2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.0780946
</td>
<td style="text-align:right;">
0.2411637
</td>
<td style="text-align:right;">
0.2669887
</td>
<td style="text-align:right;">
0.1673420
</td>
<td style="text-align:right;">
0.2464110
</td>
</tr>
<tr>
<td style="text-align:left;">
rk2t3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.0572989
</td>
<td style="text-align:right;">
0.2348487
</td>
<td style="text-align:right;">
0.2807791
</td>
<td style="text-align:right;">
0.1643585
</td>
<td style="text-align:right;">
0.2627147
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="nonlinear-and-other-regressions.html#cb470-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mt_prob_o</span></span></code></pre></div>
</div>
<div id="create-regression-data-inputs-2" class="section level5" number="6.1.2.3.2">
<h5><span class="header-section-number">6.1.2.3.2</span> Create Regression Data Inputs</h5>
<p>Second, generate relative market shares of various work occupations as prior.</p>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb471-1"><a href="nonlinear-and-other-regressions.html#cb471-1" aria-hidden="true" tabindex="-1"></a>mt_prob_rela_m2leisure3 <span class="ot">&lt;-</span> mt_prob_o3[, <span class="dv">2</span><span class="sc">:</span>(it_M<span class="sc">+</span><span class="dv">1</span>)]<span class="sc">/</span>mt_prob_o3[, <span class="dv">1</span>]</span>
<span id="cb471-2"><a href="nonlinear-and-other-regressions.html#cb471-2" aria-hidden="true" tabindex="-1"></a><span class="co"># mt_log_prob_rela_m2leisure3 &lt;- log(mt_prob_rela_m2leisure3/mt_prob_o3[, 1])</span></span>
<span id="cb471-3"><a href="nonlinear-and-other-regressions.html#cb471-3" aria-hidden="true" tabindex="-1"></a><span class="co"># kable(log(mt_prob_rela_m2leisure3/mt_prob_o3[, 1]), caption=st_caption) %&gt;% kable_styling_fc()</span></span></code></pre></div>
<p>Third, construct the estimation input matrices as before. There are <span class="math inline">\(K \times M\)</span> indicator vectors, a time variable, a HOMETECH variable, and 1 wage vector for data inputs. The indicator vectors are specific interecept for each type of worker (skilled or not) and for each occupation. Note:</p>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(k\)</span> and <span class="math inline">\(m\)</span> specific indicators</li>
<li><span class="math inline">\(k\)</span> specific hometech coefficients</li>
<li>common time coefficient</li>
<li>common coefficient for wage</li>
</ol>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="nonlinear-and-other-regressions.html#cb472-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Regression input matrix</span></span>
<span id="cb472-2"><a href="nonlinear-and-other-regressions.html#cb472-2" aria-hidden="true" tabindex="-1"></a><span class="co"># it_K*it_M+it_K+1+1: 1. it_K*it_M for all indicators; 2. it_k for HOMETECH; 3. 1 for time; 4. 1 for wage</span></span>
<span id="cb472-3"><a href="nonlinear-and-other-regressions.html#cb472-3" aria-hidden="true" tabindex="-1"></a>mt_prob_ols_input3 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span><span class="cn">NA</span>, <span class="at">nrow=</span>it_K<span class="sc">*</span>it_T<span class="sc">*</span>it_M, <span class="at">ncol=</span>it_K<span class="sc">*</span>it_M<span class="sc">+</span>it_K<span class="sc">+</span><span class="dv">1</span><span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb472-4"><a href="nonlinear-and-other-regressions.html#cb472-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mt_prob_ols_input3) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;m&#39;</span>, <span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">dim</span>(mt_prob_ols_input3)[<span class="dv">2</span>]))</span>
<span id="cb472-5"><a href="nonlinear-and-other-regressions.html#cb472-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(mt_prob_ols_input3) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;rowkxMxT&#39;</span>, <span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">dim</span>(mt_prob_ols_input3)[<span class="dv">1</span>]))</span>
<span id="cb472-6"><a href="nonlinear-and-other-regressions.html#cb472-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-7"><a href="nonlinear-and-other-regressions.html#cb472-7" aria-hidden="true" tabindex="-1"></a><span class="co"># LHS variable meshed store</span></span>
<span id="cb472-8"><a href="nonlinear-and-other-regressions.html#cb472-8" aria-hidden="true" tabindex="-1"></a>ar_prob_ols_mesh_kmt <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span><span class="cn">NA</span>, <span class="at">nrow=</span>it_K<span class="sc">*</span>it_T<span class="sc">*</span>it_M, <span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb472-9"><a href="nonlinear-and-other-regressions.html#cb472-9" aria-hidden="true" tabindex="-1"></a><span class="co"># RHS variables meshed store</span></span>
<span id="cb472-10"><a href="nonlinear-and-other-regressions.html#cb472-10" aria-hidden="true" tabindex="-1"></a>mt_indi_mesh_kmt <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span><span class="cn">NA</span>, <span class="at">nrow=</span>it_K<span class="sc">*</span>it_T<span class="sc">*</span>it_M, <span class="at">ncol=</span>it_K<span class="sc">*</span>it_M)</span>
<span id="cb472-11"><a href="nonlinear-and-other-regressions.html#cb472-11" aria-hidden="true" tabindex="-1"></a>ar_time_mesh_kmt <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span><span class="cn">NA</span>, <span class="at">nrow=</span>it_K<span class="sc">*</span>it_T<span class="sc">*</span>it_M, <span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb472-12"><a href="nonlinear-and-other-regressions.html#cb472-12" aria-hidden="true" tabindex="-1"></a>ar_wage_mesh_kmt <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span><span class="cn">NA</span>, <span class="at">nrow=</span>it_K<span class="sc">*</span>it_T<span class="sc">*</span>it_M, <span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb472-13"><a href="nonlinear-and-other-regressions.html#cb472-13" aria-hidden="true" tabindex="-1"></a>mt_hometech_mesh_kmt <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span><span class="cn">NA</span>, <span class="at">nrow=</span>it_K<span class="sc">*</span>it_T<span class="sc">*</span>it_M, <span class="at">ncol=</span>it_K)</span>
<span id="cb472-14"><a href="nonlinear-and-other-regressions.html#cb472-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-15"><a href="nonlinear-and-other-regressions.html#cb472-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over columns</span></span>
<span id="cb472-16"><a href="nonlinear-and-other-regressions.html#cb472-16" aria-hidden="true" tabindex="-1"></a>it_kxm_ctr <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb472-17"><a href="nonlinear-and-other-regressions.html#cb472-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (it_r_k <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>, it_K)) {</span>
<span id="cb472-18"><a href="nonlinear-and-other-regressions.html#cb472-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (it_r_m <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>, it_M)) {</span>
<span id="cb472-19"><a href="nonlinear-and-other-regressions.html#cb472-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Column counter</span></span>
<span id="cb472-20"><a href="nonlinear-and-other-regressions.html#cb472-20" aria-hidden="true" tabindex="-1"></a>    it_kxm_ctr <span class="ot">&lt;-</span> it_kxm_ctr <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb472-21"><a href="nonlinear-and-other-regressions.html#cb472-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-22"><a href="nonlinear-and-other-regressions.html#cb472-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update name of indicator column</span></span>
<span id="cb472-23"><a href="nonlinear-and-other-regressions.html#cb472-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(mt_prob_ols_input3)[it_kxm_ctr] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;i_k&#39;</span>, it_r_k, <span class="st">&#39;m&#39;</span>, it_r_m)</span>
<span id="cb472-24"><a href="nonlinear-and-other-regressions.html#cb472-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Start and end row for the indictor function mt_indi_mesh_kmt</span></span>
<span id="cb472-25"><a href="nonlinear-and-other-regressions.html#cb472-25" aria-hidden="true" tabindex="-1"></a>    it_indi_str_row <span class="ot">&lt;-</span> (it_kxm_ctr<span class="dv">-1</span>)<span class="sc">*</span>it_T</span>
<span id="cb472-26"><a href="nonlinear-and-other-regressions.html#cb472-26" aria-hidden="true" tabindex="-1"></a>    it_indi_end_row <span class="ot">&lt;-</span> (it_kxm_ctr<span class="sc">+</span><span class="dv">0</span>)<span class="sc">*</span>it_T</span>
<span id="cb472-27"><a href="nonlinear-and-other-regressions.html#cb472-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-28"><a href="nonlinear-and-other-regressions.html#cb472-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update names of the hometech column</span></span>
<span id="cb472-29"><a href="nonlinear-and-other-regressions.html#cb472-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(mt_prob_ols_input3)[it_K<span class="sc">*</span>it_M <span class="sc">+</span> it_r_k] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;hometech_k&#39;</span>, it_r_k)</span>
<span id="cb472-30"><a href="nonlinear-and-other-regressions.html#cb472-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Start and end row for the indictor function mt_hometech_mesh_kmt</span></span>
<span id="cb472-31"><a href="nonlinear-and-other-regressions.html#cb472-31" aria-hidden="true" tabindex="-1"></a>    it_hometech_str_row <span class="ot">&lt;-</span> (it_r_k<span class="dv">-1</span>)<span class="sc">*</span>it_M<span class="sc">*</span>it_T</span>
<span id="cb472-32"><a href="nonlinear-and-other-regressions.html#cb472-32" aria-hidden="true" tabindex="-1"></a>    it_hometech_end_row <span class="ot">&lt;-</span> (it_r_k<span class="sc">+</span><span class="dv">0</span>)<span class="sc">*</span>it_M<span class="sc">*</span>it_T</span>
<span id="cb472-33"><a href="nonlinear-and-other-regressions.html#cb472-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-34"><a href="nonlinear-and-other-regressions.html#cb472-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over rows</span></span>
<span id="cb472-35"><a href="nonlinear-and-other-regressions.html#cb472-35" aria-hidden="true" tabindex="-1"></a>    it_rowKxT <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb472-36"><a href="nonlinear-and-other-regressions.html#cb472-36" aria-hidden="true" tabindex="-1"></a>    it_rowKxTxM <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb472-37"><a href="nonlinear-and-other-regressions.html#cb472-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (it_k <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>, it_K)) {</span>
<span id="cb472-38"><a href="nonlinear-and-other-regressions.html#cb472-38" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (it_m <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>, it_M)) {</span>
<span id="cb472-39"><a href="nonlinear-and-other-regressions.html#cb472-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (it_t <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>, it_T)) {</span>
<span id="cb472-40"><a href="nonlinear-and-other-regressions.html#cb472-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-41"><a href="nonlinear-and-other-regressions.html#cb472-41" aria-hidden="true" tabindex="-1"></a>          <span class="co"># KxT group counter</span></span>
<span id="cb472-42"><a href="nonlinear-and-other-regressions.html#cb472-42" aria-hidden="true" tabindex="-1"></a>          it_rowKxT <span class="ot">&lt;-</span> it_T<span class="sc">*</span>(it_k<span class="dv">-1</span>) <span class="sc">+</span> it_t</span>
<span id="cb472-43"><a href="nonlinear-and-other-regressions.html#cb472-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-44"><a href="nonlinear-and-other-regressions.html#cb472-44" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Row counter</span></span>
<span id="cb472-45"><a href="nonlinear-and-other-regressions.html#cb472-45" aria-hidden="true" tabindex="-1"></a>          it_rowKxTxM <span class="ot">&lt;-</span> it_rowKxTxM <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb472-46"><a href="nonlinear-and-other-regressions.html#cb472-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-47"><a href="nonlinear-and-other-regressions.html#cb472-47" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Indicator matrix, heterogeneous by K and M</span></span>
<span id="cb472-48"><a href="nonlinear-and-other-regressions.html#cb472-48" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> ((it_rowKxTxM <span class="sc">&gt;</span> it_indi_str_row) <span class="sc">&amp;&amp;</span> (it_rowKxTxM <span class="sc">&lt;=</span> it_indi_end_row)){</span>
<span id="cb472-49"><a href="nonlinear-and-other-regressions.html#cb472-49" aria-hidden="true" tabindex="-1"></a>            mt_indi_mesh_kmt[it_rowKxTxM, it_kxm_ctr] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb472-50"><a href="nonlinear-and-other-regressions.html#cb472-50" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb472-51"><a href="nonlinear-and-other-regressions.html#cb472-51" aria-hidden="true" tabindex="-1"></a>            mt_indi_mesh_kmt[it_rowKxTxM, it_kxm_ctr] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb472-52"><a href="nonlinear-and-other-regressions.html#cb472-52" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb472-53"><a href="nonlinear-and-other-regressions.html#cb472-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-54"><a href="nonlinear-and-other-regressions.html#cb472-54" aria-hidden="true" tabindex="-1"></a>          <span class="co"># HOMETECH specific matrix, heterogeneous by K, homogeneous by M</span></span>
<span id="cb472-55"><a href="nonlinear-and-other-regressions.html#cb472-55" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (it_r_m <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb472-56"><a href="nonlinear-and-other-regressions.html#cb472-56" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> ((it_rowKxTxM <span class="sc">&gt;</span> it_hometech_str_row) <span class="sc">&amp;&amp;</span> (it_rowKxTxM <span class="sc">&lt;=</span> it_hometech_end_row)){</span>
<span id="cb472-57"><a href="nonlinear-and-other-regressions.html#cb472-57" aria-hidden="true" tabindex="-1"></a>              mt_hometech_mesh_kmt[it_rowKxTxM, it_r_k] <span class="ot">&lt;-</span> mt_hometech[it_t, it_k]</span>
<span id="cb472-58"><a href="nonlinear-and-other-regressions.html#cb472-58" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb472-59"><a href="nonlinear-and-other-regressions.html#cb472-59" aria-hidden="true" tabindex="-1"></a>              mt_hometech_mesh_kmt[it_rowKxTxM, it_r_k] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb472-60"><a href="nonlinear-and-other-regressions.html#cb472-60" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb472-61"><a href="nonlinear-and-other-regressions.html#cb472-61" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb472-62"><a href="nonlinear-and-other-regressions.html#cb472-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-63"><a href="nonlinear-and-other-regressions.html#cb472-63" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Only need to do once, homogeneous across K, M and T</span></span>
<span id="cb472-64"><a href="nonlinear-and-other-regressions.html#cb472-64" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (it_kxm_ctr <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb472-65"><a href="nonlinear-and-other-regressions.html#cb472-65" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rownames</span>(mt_prob_ols_input3)[it_rowKxTxM] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;ik&#39;</span>, it_k, <span class="st">&#39;m&#39;</span>, it_m, <span class="st">&#39;t&#39;</span>, it_t)</span>
<span id="cb472-66"><a href="nonlinear-and-other-regressions.html#cb472-66" aria-hidden="true" tabindex="-1"></a>            <span class="co"># RHS</span></span>
<span id="cb472-67"><a href="nonlinear-and-other-regressions.html#cb472-67" aria-hidden="true" tabindex="-1"></a>            ar_time_mesh_kmt[it_rowKxTxM] <span class="ot">&lt;-</span> it_t</span>
<span id="cb472-68"><a href="nonlinear-and-other-regressions.html#cb472-68" aria-hidden="true" tabindex="-1"></a>            ar_wage_mesh_kmt[it_rowKxTxM] <span class="ot">&lt;-</span> mt_wages[it_rowKxT, it_m]</span>
<span id="cb472-69"><a href="nonlinear-and-other-regressions.html#cb472-69" aria-hidden="true" tabindex="-1"></a>            <span class="co"># LHS, log of probability</span></span>
<span id="cb472-70"><a href="nonlinear-and-other-regressions.html#cb472-70" aria-hidden="true" tabindex="-1"></a>            ar_prob_ols_mesh_kmt[it_rowKxTxM] <span class="ot">&lt;-</span> <span class="fu">log</span>(mt_prob_rela_m2leisure3[it_rowKxT, it_m])</span>
<span id="cb472-71"><a href="nonlinear-and-other-regressions.html#cb472-71" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb472-72"><a href="nonlinear-and-other-regressions.html#cb472-72" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb472-73"><a href="nonlinear-and-other-regressions.html#cb472-73" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb472-74"><a href="nonlinear-and-other-regressions.html#cb472-74" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb472-75"><a href="nonlinear-and-other-regressions.html#cb472-75" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb472-76"><a href="nonlinear-and-other-regressions.html#cb472-76" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb472-77"><a href="nonlinear-and-other-regressions.html#cb472-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Indicators are the earlier columns</span></span>
<span id="cb472-78"><a href="nonlinear-and-other-regressions.html#cb472-78" aria-hidden="true" tabindex="-1"></a>mt_prob_ols_input3[, <span class="dv">1</span><span class="sc">:</span>(it_K<span class="sc">*</span>it_M)] <span class="ot">&lt;-</span> mt_indi_mesh_kmt</span>
<span id="cb472-79"><a href="nonlinear-and-other-regressions.html#cb472-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Time variable column</span></span>
<span id="cb472-80"><a href="nonlinear-and-other-regressions.html#cb472-80" aria-hidden="true" tabindex="-1"></a>it_col_start <span class="ot">&lt;-</span> (it_K<span class="sc">*</span>it_M) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb472-81"><a href="nonlinear-and-other-regressions.html#cb472-81" aria-hidden="true" tabindex="-1"></a>it_col_end <span class="ot">&lt;-</span> it_col_start <span class="sc">+</span> it_K <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb472-82"><a href="nonlinear-and-other-regressions.html#cb472-82" aria-hidden="true" tabindex="-1"></a>mt_prob_ols_input3[, it_col_start<span class="sc">:</span>it_col_end] <span class="ot">&lt;-</span> mt_hometech_mesh_kmt</span>
<span id="cb472-83"><a href="nonlinear-and-other-regressions.html#cb472-83" aria-hidden="true" tabindex="-1"></a><span class="co"># Home Tech Column</span></span>
<span id="cb472-84"><a href="nonlinear-and-other-regressions.html#cb472-84" aria-hidden="true" tabindex="-1"></a>mt_prob_ols_input3[, it_col_end<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> ar_time_mesh_kmt</span>
<span id="cb472-85"><a href="nonlinear-and-other-regressions.html#cb472-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Wage is the last column</span></span>
<span id="cb472-86"><a href="nonlinear-and-other-regressions.html#cb472-86" aria-hidden="true" tabindex="-1"></a>mt_prob_ols_input3[, it_col_end<span class="sc">+</span><span class="dv">2</span>] <span class="ot">&lt;-</span> ar_wage_mesh_kmt</span>
<span id="cb472-87"><a href="nonlinear-and-other-regressions.html#cb472-87" aria-hidden="true" tabindex="-1"></a><span class="co"># kable out</span></span>
<span id="cb472-88"><a href="nonlinear-and-other-regressions.html#cb472-88" aria-hidden="true" tabindex="-1"></a><span class="co"># kable(mt_prob_ols_input3) %&gt;% kable_styling_fc()</span></span></code></pre></div>
<p>Fourth, combine left-hand-side and right-hand-side regression input data structures/</p>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb473-1"><a href="nonlinear-and-other-regressions.html#cb473-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Construct data structure</span></span>
<span id="cb473-2"><a href="nonlinear-and-other-regressions.html#cb473-2" aria-hidden="true" tabindex="-1"></a>mt_all_inputs3 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(ar_prob_ols_mesh_kmt, mt_prob_ols_input3)</span>
<span id="cb473-3"><a href="nonlinear-and-other-regressions.html#cb473-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mt_all_inputs3)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&#39;log_pm_over_po&#39;</span></span>
<span id="cb473-4"><a href="nonlinear-and-other-regressions.html#cb473-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mt_all_inputs3)[<span class="fu">dim</span>(mt_all_inputs3)[<span class="dv">2</span>]<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&#39;time&#39;</span></span>
<span id="cb473-5"><a href="nonlinear-and-other-regressions.html#cb473-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mt_all_inputs3)[<span class="fu">dim</span>(mt_all_inputs3)[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="st">&#39;wages&#39;</span></span>
<span id="cb473-6"><a href="nonlinear-and-other-regressions.html#cb473-6" aria-hidden="true" tabindex="-1"></a>tb_all_inputs3 <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(mt_all_inputs3)</span>
<span id="cb473-7"><a href="nonlinear-and-other-regressions.html#cb473-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Show data</span></span>
<span id="cb473-8"><a href="nonlinear-and-other-regressions.html#cb473-8" aria-hidden="true" tabindex="-1"></a>st_caption <span class="ot">&lt;-</span> <span class="st">&#39;LHS=Log Probability Ratios (column 1); RHS=Indicator, time-trends and data with different assumptions on whether coefficients with be skill specific (hometech), occuption and skill specific (indictor), or homogeneous across skills and occupations (time and wage), OLS inputs (other columns)&#39;</span></span>
<span id="cb473-9"><a href="nonlinear-and-other-regressions.html#cb473-9" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(tb_all_inputs3, <span class="at">caption=</span>st_caption) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc_wide</span>()</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:875px; ">
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-230">Table 6.9: </span>LHS=Log Probability Ratios (column 1); RHS=Indicator, time-trends and data with different assumptions on whether coefficients with be skill specific (hometech), occuption and skill specific (indictor), or homogeneous across skills and occupations (time and wage), OLS inputs (other columns)
</caption>
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
log_pm_over_po
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
i_k1m1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
i_k1m2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
i_k1m3
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
i_k1m4
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
i_k2m1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
i_k2m2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
i_k2m3
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
i_k2m4
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
hometech_k1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
hometech_k2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
time
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
wages
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0.8104303
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.2164079
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.677571
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1216510
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.3181810
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1.572633
</td>
</tr>
<tr>
<td style="text-align:right;">
1.7064781
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.7584595
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1.102925
</td>
</tr>
<tr>
<td style="text-align:right;">
0.8229277
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.2164079
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.327921
</td>
</tr>
<tr>
<td style="text-align:right;">
1.2349948
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.3181810
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1.954504
</td>
</tr>
<tr>
<td style="text-align:right;">
1.8756195
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.7584595
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1.889539
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1338609
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.2164079
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.655706
</td>
</tr>
<tr>
<td style="text-align:right;">
1.4668305
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.3181810
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1.708530
</td>
</tr>
<tr>
<td style="text-align:right;">
2.0937381
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.7584595
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1.544066
</td>
</tr>
<tr>
<td style="text-align:right;">
0.9700465
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.2164079
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.963024
</td>
</tr>
<tr>
<td style="text-align:right;">
1.2873623
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.3181810
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1.902299
</td>
</tr>
<tr>
<td style="text-align:right;">
1.9077727
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.7584595
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1.690705
</td>
</tr>
<tr>
<td style="text-align:right;">
0.9491036
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.1428000
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.899825
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1275553
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.2316258
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1.246088
</td>
</tr>
<tr>
<td style="text-align:right;">
1.4106597
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.4145463
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1.042059
</td>
</tr>
<tr>
<td style="text-align:right;">
0.9679200
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.1428000
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.692803
</td>
</tr>
<tr>
<td style="text-align:right;">
1.2292855
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.2316258
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1.640507
</td>
</tr>
<tr>
<td style="text-align:right;">
1.5892864
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.4145463
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1.994270
</td>
</tr>
<tr>
<td style="text-align:right;">
0.5355882
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.1428000
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.594142
</td>
</tr>
<tr>
<td style="text-align:right;">
0.7621188
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.2316258
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1.289160
</td>
</tr>
<tr>
<td style="text-align:right;">
1.0537680
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.4145463
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1.147114
</td>
</tr>
<tr>
<td style="text-align:right;">
0.9867739
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.1428000
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.795467
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1490801
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.2316258
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1.024614
</td>
</tr>
<tr>
<td style="text-align:right;">
1.5227867
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.4145463
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1.477796
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="estimate-wage-and-time-coefficients-skill-specific-fixed-effects-and-hometech-coefficient" class="section level5" number="6.1.2.3.3">
<h5><span class="header-section-number">6.1.2.3.3</span> Estimate Wage and Time Coefficients, Skill Specific Fixed Effects and HOMETECH Coefficient</h5>
<p>Similar to before, estimate with OLS, and show that predictions based on OLS estimates match with the true parameters. Predicted probabilities are the same as observed probabilities.</p>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="nonlinear-and-other-regressions.html#cb474-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Regression</span></span>
<span id="cb474-2"><a href="nonlinear-and-other-regressions.html#cb474-2" aria-hidden="true" tabindex="-1"></a>fit_ols_agg_prob3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_pm_over_po <span class="sc">~</span> . <span class="sc">-</span><span class="dv">1</span>, <span class="at">data =</span> tb_all_inputs3)</span>
<span id="cb474-3"><a href="nonlinear-and-other-regressions.html#cb474-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_ols_agg_prob3)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = log_pm_over_po ~ . - 1, data = tb_all_inputs3)
## 
## Residuals:
##        Min         1Q     Median         3Q        Max 
## -2.978e-16 -1.212e-16  2.245e-17  6.724e-17  5.494e-16 
## 
## Coefficients:
##              Estimate Std. Error   t value Pr(&gt;|t|)    
## i_k1m1      1.438e-01  4.270e-16 3.368e+14   &lt;2e-16 ***
## i_k1m2      2.045e-01  4.796e-16 4.264e+14   &lt;2e-16 ***
## i_k1m3      4.702e-01  4.624e-16 1.017e+15   &lt;2e-16 ***
## i_k1m4      2.641e-01  5.049e-16 5.229e+14   &lt;2e-16 ***
## i_k2m1      3.942e-01  4.277e-16 9.216e+14   &lt;2e-16 ***
## i_k2m2      4.415e-01  5.028e-16 8.780e+14   &lt;2e-16 ***
## i_k2m3      2.278e-02  4.176e-16 5.455e+13   &lt;2e-16 ***
## i_k2m4      4.462e-01  4.348e-16 1.026e+15   &lt;2e-16 ***
## hometech_k1 9.568e-01  7.700e-16 1.243e+15   &lt;2e-16 ***
## hometech_k2 4.533e-01  1.662e-15 2.728e+14   &lt;2e-16 ***
## time        2.283e-01  2.182e-16 1.046e+15   &lt;2e-16 ***
## wages       1.379e-01  2.235e-16 6.168e+14   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.412e-16 on 12 degrees of freedom
## Multiple R-squared:      1,  Adjusted R-squared:      1 
## F-statistic: 5.778e+31 on 12 and 12 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="nonlinear-and-other-regressions.html#cb476-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse coefficients</span></span>
<span id="cb476-2"><a href="nonlinear-and-other-regressions.html#cb476-2" aria-hidden="true" tabindex="-1"></a>ls_coefficients_esti <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;list&quot;</span>, <span class="at">length =</span> <span class="dv">0</span>)</span>
<span id="cb476-3"><a href="nonlinear-and-other-regressions.html#cb476-3" aria-hidden="true" tabindex="-1"></a>ls_coefficients_true <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;list&quot;</span>, <span class="at">length =</span> <span class="dv">0</span>)</span>
<span id="cb476-4"><a href="nonlinear-and-other-regressions.html#cb476-4" aria-hidden="true" tabindex="-1"></a>ar_coefficients3 <span class="ot">&lt;-</span> fit_ols_agg_prob3<span class="sc">$</span>coefficients</span>
<span id="cb476-5"><a href="nonlinear-and-other-regressions.html#cb476-5" aria-hidden="true" tabindex="-1"></a>it_col_end <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb476-6"><a href="nonlinear-and-other-regressions.html#cb476-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (it_coef_grp <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)) {</span>
<span id="cb476-7"><a href="nonlinear-and-other-regressions.html#cb476-7" aria-hidden="true" tabindex="-1"></a>  it_col_str <span class="ot">&lt;-</span> it_col_end <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb476-8"><a href="nonlinear-and-other-regressions.html#cb476-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (it_coef_grp <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb476-9"><a href="nonlinear-and-other-regressions.html#cb476-9" aria-hidden="true" tabindex="-1"></a>    it_grp_coef_cnt <span class="ot">&lt;-</span> (it_K<span class="sc">*</span>it_M)</span>
<span id="cb476-10"><a href="nonlinear-and-other-regressions.html#cb476-10" aria-hidden="true" tabindex="-1"></a>    st_coef_name <span class="ot">&lt;-</span> <span class="st">&#39;indi_km&#39;</span></span>
<span id="cb476-11"><a href="nonlinear-and-other-regressions.html#cb476-11" aria-hidden="true" tabindex="-1"></a>    ar_esti_true <span class="ot">&lt;-</span> mt_alpha</span>
<span id="cb476-12"><a href="nonlinear-and-other-regressions.html#cb476-12" aria-hidden="true" tabindex="-1"></a>    it_sign <span class="ot">&lt;-</span> <span class="sc">+</span><span class="dv">1</span></span>
<span id="cb476-13"><a href="nonlinear-and-other-regressions.html#cb476-13" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (it_coef_grp <span class="sc">==</span> <span class="dv">2</span>) {</span>
<span id="cb476-14"><a href="nonlinear-and-other-regressions.html#cb476-14" aria-hidden="true" tabindex="-1"></a>    it_grp_coef_cnt <span class="ot">&lt;-</span> it_K</span>
<span id="cb476-15"><a href="nonlinear-and-other-regressions.html#cb476-15" aria-hidden="true" tabindex="-1"></a>    st_coef_name <span class="ot">&lt;-</span> <span class="st">&#39;hometech_k&#39;</span></span>
<span id="cb476-16"><a href="nonlinear-and-other-regressions.html#cb476-16" aria-hidden="true" tabindex="-1"></a>    ar_esti_true <span class="ot">&lt;-</span> ar_theta</span>
<span id="cb476-17"><a href="nonlinear-and-other-regressions.html#cb476-17" aria-hidden="true" tabindex="-1"></a>    it_sign <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb476-18"><a href="nonlinear-and-other-regressions.html#cb476-18" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (it_coef_grp <span class="sc">==</span> <span class="dv">3</span>) {</span>
<span id="cb476-19"><a href="nonlinear-and-other-regressions.html#cb476-19" aria-hidden="true" tabindex="-1"></a>    it_grp_coef_cnt <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb476-20"><a href="nonlinear-and-other-regressions.html#cb476-20" aria-hidden="true" tabindex="-1"></a>    st_coef_name <span class="ot">&lt;-</span> <span class="st">&#39;time&#39;</span></span>
<span id="cb476-21"><a href="nonlinear-and-other-regressions.html#cb476-21" aria-hidden="true" tabindex="-1"></a>    ar_esti_true <span class="ot">&lt;-</span> fl_phi</span>
<span id="cb476-22"><a href="nonlinear-and-other-regressions.html#cb476-22" aria-hidden="true" tabindex="-1"></a>    it_sign <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb476-23"><a href="nonlinear-and-other-regressions.html#cb476-23" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (it_coef_grp <span class="sc">==</span> <span class="dv">4</span>) {</span>
<span id="cb476-24"><a href="nonlinear-and-other-regressions.html#cb476-24" aria-hidden="true" tabindex="-1"></a>    it_grp_coef_cnt <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb476-25"><a href="nonlinear-and-other-regressions.html#cb476-25" aria-hidden="true" tabindex="-1"></a>    st_coef_name <span class="ot">&lt;-</span> <span class="st">&#39;wage&#39;</span></span>
<span id="cb476-26"><a href="nonlinear-and-other-regressions.html#cb476-26" aria-hidden="true" tabindex="-1"></a>    ar_esti_true <span class="ot">&lt;-</span> fl_beta</span>
<span id="cb476-27"><a href="nonlinear-and-other-regressions.html#cb476-27" aria-hidden="true" tabindex="-1"></a>    it_sign <span class="ot">&lt;-</span> <span class="sc">+</span><span class="dv">1</span></span>
<span id="cb476-28"><a href="nonlinear-and-other-regressions.html#cb476-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb476-29"><a href="nonlinear-and-other-regressions.html#cb476-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb476-30"><a href="nonlinear-and-other-regressions.html#cb476-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select</span></span>
<span id="cb476-31"><a href="nonlinear-and-other-regressions.html#cb476-31" aria-hidden="true" tabindex="-1"></a>  it_col_end <span class="ot">&lt;-</span> it_col_end <span class="sc">+</span> it_grp_coef_cnt</span>
<span id="cb476-32"><a href="nonlinear-and-other-regressions.html#cb476-32" aria-hidden="true" tabindex="-1"></a>  ar_esti_curgroup <span class="ot">&lt;-</span> ar_coefficients3[it_col_str<span class="sc">:</span>it_col_end]</span>
<span id="cb476-33"><a href="nonlinear-and-other-regressions.html#cb476-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (it_coef_grp <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb476-34"><a href="nonlinear-and-other-regressions.html#cb476-34" aria-hidden="true" tabindex="-1"></a>      ar_esti_curgroup <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">matrix</span>(<span class="at">data=</span>ar_esti_curgroup, <span class="at">nrow=</span>it_M, <span class="at">ncol=</span>it_K))</span>
<span id="cb476-35"><a href="nonlinear-and-other-regressions.html#cb476-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb476-36"><a href="nonlinear-and-other-regressions.html#cb476-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># store</span></span>
<span id="cb476-37"><a href="nonlinear-and-other-regressions.html#cb476-37" aria-hidden="true" tabindex="-1"></a>  ls_coefficients_esti[[st_coef_name]] <span class="ot">&lt;-</span> it_sign<span class="sc">*</span>ar_esti_curgroup</span>
<span id="cb476-38"><a href="nonlinear-and-other-regressions.html#cb476-38" aria-hidden="true" tabindex="-1"></a>  ls_coefficients_true[[st_coef_name]] <span class="ot">&lt;-</span> ar_esti_true</span>
<span id="cb476-39"><a href="nonlinear-and-other-regressions.html#cb476-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb476-40"><a href="nonlinear-and-other-regressions.html#cb476-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb476-41"><a href="nonlinear-and-other-regressions.html#cb476-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare estimates and true</span></span>
<span id="cb476-42"><a href="nonlinear-and-other-regressions.html#cb476-42" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ls_coefficients_esti)</span></code></pre></div>
<pre><code>## $indi_km
##           [,1]      [,2]       [,3]      [,4]
## [1,] 0.1437888 0.2044885 0.47023364 0.2640527
## [2,] 0.3941526 0.4415087 0.02277825 0.4462095
## 
## $hometech_k
## hometech_k1 hometech_k2 
##  -0.9568333  -0.4533342 
## 
## $time
##       time 
## -0.2283074 
## 
## $wage
##     wages 
## 0.1378588</code></pre>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="nonlinear-and-other-regressions.html#cb478-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ls_coefficients_true)</span></code></pre></div>
<pre><code>## $indi_km
##           m1        m2         m3        m4
## k1 0.1437888 0.2044885 0.47023364 0.2640527
## k2 0.3941526 0.4415087 0.02277825 0.4462095
## 
## $hometech_k
## [1] -0.9568333 -0.4533342
## 
## $time
## [1] -0.2283074
## 
## $wage
## [1] 0.1378588</code></pre>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb480-1"><a href="nonlinear-and-other-regressions.html#cb480-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate given estimated parameters using earlier function</span></span>
<span id="cb480-2"><a href="nonlinear-and-other-regressions.html#cb480-2" aria-hidden="true" tabindex="-1"></a>mt_prob_o3_full_esti <span class="ot">&lt;-</span> <span class="fu">ffi_logit_prob3_alpha_beta</span>(it_K, it_T, it_M,</span>
<span id="cb480-3"><a href="nonlinear-and-other-regressions.html#cb480-3" aria-hidden="true" tabindex="-1"></a>  ls_coefficients_esti[[<span class="st">&#39;indi_km&#39;</span>]],</span>
<span id="cb480-4"><a href="nonlinear-and-other-regressions.html#cb480-4" aria-hidden="true" tabindex="-1"></a>  ls_coefficients_esti[[<span class="st">&#39;wage&#39;</span>]],</span>
<span id="cb480-5"><a href="nonlinear-and-other-regressions.html#cb480-5" aria-hidden="true" tabindex="-1"></a>  ls_coefficients_esti[[<span class="st">&#39;time&#39;</span>]],</span>
<span id="cb480-6"><a href="nonlinear-and-other-regressions.html#cb480-6" aria-hidden="true" tabindex="-1"></a>  ls_coefficients_esti[[<span class="st">&#39;hometech_k&#39;</span>]],</span>
<span id="cb480-7"><a href="nonlinear-and-other-regressions.html#cb480-7" aria-hidden="true" tabindex="-1"></a>  mt_hometech, mt_wages)</span>
<span id="cb480-8"><a href="nonlinear-and-other-regressions.html#cb480-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Results</span></span>
<span id="cb480-9"><a href="nonlinear-and-other-regressions.html#cb480-9" aria-hidden="true" tabindex="-1"></a>st_caption <span class="ot">&lt;-</span> <span class="st">&#39;Predicted probabilities based on estimates&#39;</span></span>
<span id="cb480-10"><a href="nonlinear-and-other-regressions.html#cb480-10" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(mt_prob_o3_full_esti, <span class="at">caption=</span>st_caption) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-231">Table 6.10: </span>Predicted probabilities based on estimates
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
skillgroup
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
time
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m0
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m3
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m4
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
rk1t1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0887175
</td>
<td style="text-align:right;">
0.1995146
</td>
<td style="text-align:right;">
0.2020237
</td>
<td style="text-align:right;">
0.2757014
</td>
<td style="text-align:right;">
0.2340428
</td>
</tr>
<tr>
<td style="text-align:left;">
rk1t2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.0646539
</td>
<td style="text-align:right;">
0.1984822
</td>
<td style="text-align:right;">
0.2223035
</td>
<td style="text-align:right;">
0.2803052
</td>
<td style="text-align:right;">
0.2342551
</td>
</tr>
<tr>
<td style="text-align:left;">
rk1t3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.0358582
</td>
<td style="text-align:right;">
0.1975615
</td>
<td style="text-align:right;">
0.2339696
</td>
<td style="text-align:right;">
0.2909961
</td>
<td style="text-align:right;">
0.2416147
</td>
</tr>
<tr>
<td style="text-align:left;">
rk2t1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0942785
</td>
<td style="text-align:right;">
0.2435583
</td>
<td style="text-align:right;">
0.2481846
</td>
<td style="text-align:right;">
0.1610703
</td>
<td style="text-align:right;">
0.2529083
</td>
</tr>
<tr>
<td style="text-align:left;">
rk2t2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.0780946
</td>
<td style="text-align:right;">
0.2411637
</td>
<td style="text-align:right;">
0.2669887
</td>
<td style="text-align:right;">
0.1673420
</td>
<td style="text-align:right;">
0.2464110
</td>
</tr>
<tr>
<td style="text-align:left;">
rk2t3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.0572989
</td>
<td style="text-align:right;">
0.2348487
</td>
<td style="text-align:right;">
0.2807791
</td>
<td style="text-align:right;">
0.1643585
</td>
<td style="text-align:right;">
0.2627147
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb481-1"><a href="nonlinear-and-other-regressions.html#cb481-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Results</span></span>
<span id="cb481-2"><a href="nonlinear-and-other-regressions.html#cb481-2" aria-hidden="true" tabindex="-1"></a>st_caption <span class="ot">&lt;-</span> <span class="st">&#39;Compare differences in probability predictions based on estimates and true probabilities&#39;</span></span>
<span id="cb481-3"><a href="nonlinear-and-other-regressions.html#cb481-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(mt_prob_o3_full_esti<span class="sc">-</span>mt_prob_o3_full, <span class="at">caption=</span>st_caption) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-231">Table 6.10: </span>Compare differences in probability predictions based on estimates and true probabilities
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
skillgroup
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
time
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m0
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m3
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m4
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
rk1t1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
rk1t2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
rk1t3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
rk2t1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
rk2t2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
rk2t3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="prices-from-aggregate-shares-in-logistic-choice-model" class="section level3" number="6.1.3">
<h3><span class="header-section-number">6.1.3</span> Prices from Aggregate Shares in Logistic Choice Model</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R Code Examples</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository (<a href="https://fanwangecon.github.io/Stat4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<div id="observed-shares-and-wages" class="section level4" number="6.1.3.1">
<h4><span class="header-section-number">6.1.3.1</span> Observed Shares and Wages</h4>
<p>In <a href="https://fanwangecon.github.io/R4Econ/regnonlin/logit/htmlpdfr/fs_logit_aggregate_shares.html#11_Logistic_Choices,_Wages_and_Market_Shares">Estimate Logistic Choice Model with Aggregate Shares</a>, we described and developed the multinomial logistic model with choice over alternatives.</p>
<p>The scenario here is that we have estimated the logistic choice model using data from some prior years. We know that for another set of years, model parameters, and in particular, the effect of alternative-specific prices are the same. We have market share information, as well as all other observables from other years, however, no price for alternatives. The goal is to use existing model parameters and the aggregate shares to back out the alternative-specific prices that would explain the data.</p>
<p>We know that values for choice-specific alternatives, with <span class="math inline">\(p_{m}\)</span> as the alternative-specific price/wage, are:</p>
<p><span class="math display">\[
V_{im} = \alpha_m + \beta\cdot w_{m}  + \epsilon_{im}
\]</span></p>
<p>Choice probabilities are functions of wages. The probability that individual <span class="math inline">\(i\)</span> chooses alternative <span class="math inline">\(m\)</span> is:</p>
<p><span class="math display">\[
P(o=m) = P_m = 
\frac{
  \exp\left(\alpha_m + \beta\cdot w_{m} \right)
}{
  1 + \sum_{\widehat{m}=1}^M
  \exp\left(
    \alpha_{\widehat{m}} + \beta\cdot w_{\widehat{m}}
  \right)
}
\]</span></p>
<p>We observe <span class="math inline">\(P(o=m)\)</span>, we know <span class="math inline">\(\alpha_m\)</span> across alternatives, and we know already <span class="math inline">\(\beta\)</span>. We do not know <span class="math inline">\(w_m\)</span> across alternatives. Fitting means adjusting <span class="math inline">\(\left\{w_m\right\}_{m=1}^M\)</span> to fit <span class="math inline">\(\left\{P(o=m)\right\}_{m=1}^M\)</span> observed.</p>
<p>Moving terms around and cross multiplying, we have:</p>
<p><span class="math display">\[
\begin{aligned}
\exp\left(\alpha_m + \beta\cdot w_{m} \right) &amp;= 
  P_m + P_m\sum_{\widehat{m}=1}^M
  \exp\left(
    \alpha_{\widehat{m}} + \beta\cdot w_{\widehat{m}}
  \right)\\
e^{\alpha_m}\exp\left(\beta\cdot w_{m} \right) &amp;= 
  P_m + P_m\sum_{\widehat{m}=1}^M
  e^{\alpha_{\widehat{m}}}
  \exp\left(
    \beta\cdot w_{\widehat{m}}
  \right)  
\end{aligned}
\]</span></p>
<p>This can be viewed as a linear equation, let <span class="math inline">\(\exp(\alpha_m) = A_m\)</span>, which is known, and let <span class="math inline">\(\exp(\beta\cdot w_m)=\theta_m\)</span>, which is a function of the known parameter <span class="math inline">\(\beta\)</span> and unknown price <span class="math inline">\(w_m\)</span>. We have:</p>
<p><span class="math display">\[
\begin{aligned}
P_m &amp;= 
  A_m\cdot \theta_m - P_m\sum_{\widehat{m}=1}^M
  A_{\widehat{m}}\cdot \theta_{\widehat{m}}
\end{aligned}
\]</span></p>
<p>Suppose <span class="math inline">\(M=3\)</span>, and we label the categories as <span class="math inline">\(m,r,a\)</span>. Note that implicitly we have an outside option category that we are normalizing against. We have then:
<span class="math display">\[
\begin{aligned}
P_m &amp;= + 
  A_m \left(1-P_m\right) \cdot \theta_m - 
  A_r P_m \cdot \theta_r - 
  A_a P_m \cdot \theta_a
\\
P_r &amp;= -
  A_m P_r \cdot \theta_m +
  A_r \left(1-P_r\right) \cdot \theta_r  -
  A_a P_r \cdot \theta_a
\\
P_a &amp;= - 
  A_m P_a \cdot \theta_m -
  A_r P_a \cdot \theta_r +
  A_a \left(1-P_a\right) \cdot \theta_a 
\end{aligned}
\]</span></p>
<p>Above, we have a system of equations, with three unknown parameters. Regressing the left-hand-side aggregate share vectors against the matrix of right-hand values composed of <span class="math inline">\(A\)</span> and <span class="math inline">\(P\)</span> values generates <span class="math inline">\(\theta\)</span> values, which then map one to one to the wages.</p>
<p>An important issue to note is that the “backing-out” procedure does not work with any arbitrary probabilities. Note that <span class="math inline">\(\exp\left(\beta \cdot w_m \right) &gt; 0\)</span>. The estimated unknown <span class="math inline">\(\theta_m\)</span> will indeed be positive if the probabilities for example sum up to less than 1, however if the probabilities on the left hand side sum to greater than 1, then <span class="math inline">\(\theta_m &lt; 0\)</span> is possible, which leads to no solutions.</p>
<p>Additionally, note that while the procedure here is correct, we can also obtain the wages that can explaine observed probabilities simply by using the <a href="https://fanwangecon.github.io/R4Econ/regnonlin/logit/htmlpdfr/fs_logit_aggregate_shares.html#111_Wage_and_Aggregate_Share_of_Workers">log-odds ratio equations</a>. Doing that requires first computing the appropriate log-odds, which requires positive probabilities on the outside option category.</p>
</div>
<div id="simulate-market-share-3" class="section level4" number="6.1.3.2">
<h4><span class="header-section-number">6.1.3.2</span> Simulate Market Share</h4>
<p>In this section, we now simulate the above model, with <span class="math inline">\(M=3\)</span> and data over three periods, and estimate <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> via OLS. Note that <span class="math inline">\(m=0\)</span> is leisure. This is identical what is what the <a href="https://fanwangecon.github.io/R4Econ/regnonlin/logit/htmlpdfr/fs_logit_aggregate_shares.html#112_Simulate_Market_Share">simulate market share</a> section from <a href="https://fanwangecon.github.io/R4Econ/regnonlin/logit/htmlpdfr/fs_logit_aggregate_shares.html#11_Logistic_Choices,_Wages_and_Market_Shares">Estimate Logistic Choice Model with Aggregate Shares</a>.</p>
<p>First, wages across alternatives.</p>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="nonlinear-and-other-regressions.html#cb482-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed</span></span>
<span id="cb482-2"><a href="nonlinear-and-other-regressions.html#cb482-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb482-3"><a href="nonlinear-and-other-regressions.html#cb482-3" aria-hidden="true" tabindex="-1"></a><span class="co"># T periods, and M occupations (+1 leisure)</span></span>
<span id="cb482-4"><a href="nonlinear-and-other-regressions.html#cb482-4" aria-hidden="true" tabindex="-1"></a>it_M <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb482-5"><a href="nonlinear-and-other-regressions.html#cb482-5" aria-hidden="true" tabindex="-1"></a><span class="co"># define alpha and beta parameters</span></span>
<span id="cb482-6"><a href="nonlinear-and-other-regressions.html#cb482-6" aria-hidden="true" tabindex="-1"></a>ar_alpha <span class="ot">&lt;-</span> <span class="fu">runif</span>(it_M) <span class="sc">+</span> <span class="dv">0</span></span>
<span id="cb482-7"><a href="nonlinear-and-other-regressions.html#cb482-7" aria-hidden="true" tabindex="-1"></a>fl_beta <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">+</span> <span class="dv">0</span></span>
<span id="cb482-8"><a href="nonlinear-and-other-regressions.html#cb482-8" aria-hidden="true" tabindex="-1"></a><span class="co"># wage matrix, no wage for leisure</span></span>
<span id="cb482-9"><a href="nonlinear-and-other-regressions.html#cb482-9" aria-hidden="true" tabindex="-1"></a>mt_wages <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">runif</span>(<span class="dv">1</span> <span class="sc">*</span> it_M) <span class="sc">+</span> <span class="dv">1</span>, <span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">ncol =</span> it_M)</span>
<span id="cb482-10"><a href="nonlinear-and-other-regressions.html#cb482-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mt_wages) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;m&quot;</span>, <span class="fu">seq</span>(<span class="dv">1</span>, it_M))</span>
<span id="cb482-11"><a href="nonlinear-and-other-regressions.html#cb482-11" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(mt_wages) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;t&quot;</span>, <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb482-12"><a href="nonlinear-and-other-regressions.html#cb482-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Show wages</span></span>
<span id="cb482-13"><a href="nonlinear-and-other-regressions.html#cb482-13" aria-hidden="true" tabindex="-1"></a>st_caption <span class="ot">&lt;-</span> <span class="st">&quot;Wages across occupations&quot;</span></span>
<span id="cb482-14"><a href="nonlinear-and-other-regressions.html#cb482-14" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(mt_wages, <span class="at">caption =</span> st_caption) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-233">Table 6.11: </span>Wages across occupations
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m3
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
t1
</td>
<td style="text-align:right;">
1.940467
</td>
<td style="text-align:right;">
1.045556
</td>
<td style="text-align:right;">
1.528105
</td>
</tr>
</tbody>
</table>
<p>Second, shares across alternatives (and outside option).</p>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb483-1"><a href="nonlinear-and-other-regressions.html#cb483-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a probability assignment function</span></span>
<span id="cb483-2"><a href="nonlinear-and-other-regressions.html#cb483-2" aria-hidden="true" tabindex="-1"></a>ffi_logit_prob_alpha_beta_1t <span class="ot">&lt;-</span> <span class="cf">function</span>(ar_alpha, fl_beta, mt_wages) {</span>
<span id="cb483-3"><a href="nonlinear-and-other-regressions.html#cb483-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Dimensions</span></span>
<span id="cb483-4"><a href="nonlinear-and-other-regressions.html#cb483-4" aria-hidden="true" tabindex="-1"></a>  it_M <span class="ot">&lt;-</span> <span class="fu">dim</span>(mt_wages)[<span class="dv">2</span>]</span>
<span id="cb483-5"><a href="nonlinear-and-other-regressions.html#cb483-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Aggregate probabilities</span></span>
<span id="cb483-6"><a href="nonlinear-and-other-regressions.html#cb483-6" aria-hidden="true" tabindex="-1"></a>  mt_prob_o <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">ncol =</span> it_M <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb483-7"><a href="nonlinear-and-other-regressions.html#cb483-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(mt_prob_o) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;m&quot;</span>, <span class="fu">seq</span>(<span class="dv">0</span>, it_M))</span>
<span id="cb483-8"><a href="nonlinear-and-other-regressions.html#cb483-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(mt_prob_o) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;t&quot;</span>, <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb483-9"><a href="nonlinear-and-other-regressions.html#cb483-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate Probabilities</span></span>
<span id="cb483-10"><a href="nonlinear-and-other-regressions.html#cb483-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Value without shocks/errors, M+1</span></span>
<span id="cb483-11"><a href="nonlinear-and-other-regressions.html#cb483-11" aria-hidden="true" tabindex="-1"></a>  ar_V_hat <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, ar_alpha <span class="sc">+</span> fl_beta <span class="sc">*</span> mt_wages[<span class="dv">1</span>, ])</span>
<span id="cb483-12"><a href="nonlinear-and-other-regressions.html#cb483-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Probabilities across M+1</span></span>
<span id="cb483-13"><a href="nonlinear-and-other-regressions.html#cb483-13" aria-hidden="true" tabindex="-1"></a>  mt_prob_o[<span class="dv">1</span>, ] <span class="ot">&lt;-</span> <span class="fu">exp</span>(ar_V_hat) <span class="sc">/</span> <span class="fu">sum</span>(<span class="fu">exp</span>(ar_V_hat))</span>
<span id="cb483-14"><a href="nonlinear-and-other-regressions.html#cb483-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(mt_prob_o)</span>
<span id="cb483-15"><a href="nonlinear-and-other-regressions.html#cb483-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb483-16"><a href="nonlinear-and-other-regressions.html#cb483-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Show probabilities</span></span>
<span id="cb483-17"><a href="nonlinear-and-other-regressions.html#cb483-17" aria-hidden="true" tabindex="-1"></a>ar_prob_o <span class="ot">&lt;-</span> <span class="fu">ffi_logit_prob_alpha_beta_1t</span>(ar_alpha, fl_beta, mt_wages)</span>
<span id="cb483-18"><a href="nonlinear-and-other-regressions.html#cb483-18" aria-hidden="true" tabindex="-1"></a>st_caption <span class="ot">&lt;-</span> <span class="st">&quot;Participation probabilities across categories&quot;</span></span>
<span id="cb483-19"><a href="nonlinear-and-other-regressions.html#cb483-19" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(ar_prob_o, <span class="at">caption =</span> st_caption) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-234">Table 6.12: </span>Participation probabilities across categories
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m0
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
m3
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
t1
</td>
<td style="text-align:right;">
0.0506663
</td>
<td style="text-align:right;">
0.374767
</td>
<td style="text-align:right;">
0.2805663
</td>
<td style="text-align:right;">
0.2940004
</td>
</tr>
</tbody>
</table>
</div>
<div id="create-inputs-for-wages-fitestimation" class="section level4" number="6.1.3.3">
<h4><span class="header-section-number">6.1.3.3</span> Create Inputs for Wages Fit/Estimation</h4>
<p>See the linearized structure above, where the LHS is a vector of non-outside-option alternative probabilities. And the RHS is <span class="math inline">\(M\)</span> by <span class="math inline">\(M\)</span>, where each row is multiplying by a different occupation-specific probability, and each column is a different non-wage component of the category specific value (without the error term).</p>
<p>Create the right-hand-side matrix.</p>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb484-1"><a href="nonlinear-and-other-regressions.html#cb484-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A Matrix with share from 1:M columns</span></span>
<span id="cb484-2"><a href="nonlinear-and-other-regressions.html#cb484-2" aria-hidden="true" tabindex="-1"></a>mt_rhs_input <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> it_M, <span class="at">ncol =</span> it_M)</span>
<span id="cb484-3"><a href="nonlinear-and-other-regressions.html#cb484-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mt_rhs_input) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;mValNoWage&quot;</span>, <span class="fu">seq</span>(<span class="dv">1</span>, it_M))</span>
<span id="cb484-4"><a href="nonlinear-and-other-regressions.html#cb484-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(mt_rhs_input) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;mProb&quot;</span>, <span class="fu">seq</span>(<span class="dv">1</span>, it_M))</span>
<span id="cb484-5"><a href="nonlinear-and-other-regressions.html#cb484-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb484-6"><a href="nonlinear-and-other-regressions.html#cb484-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over rows</span></span>
<span id="cb484-7"><a href="nonlinear-and-other-regressions.html#cb484-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (it_m_r <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>, it_M)) {</span>
<span id="cb484-8"><a href="nonlinear-and-other-regressions.html#cb484-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># +1 to skip the outside-option category</span></span>
<span id="cb484-9"><a href="nonlinear-and-other-regressions.html#cb484-9" aria-hidden="true" tabindex="-1"></a>  P_m <span class="ot">&lt;-</span> ar_prob_o[it_m_r <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="cb484-10"><a href="nonlinear-and-other-regressions.html#cb484-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Loop over columns</span></span>
<span id="cb484-11"><a href="nonlinear-and-other-regressions.html#cb484-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (it_m_c <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>, it_M)) {</span>
<span id="cb484-12"><a href="nonlinear-and-other-regressions.html#cb484-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Column value for non-wage component of the category-specific value</span></span>
<span id="cb484-13"><a href="nonlinear-and-other-regressions.html#cb484-13" aria-hidden="true" tabindex="-1"></a>    A_m <span class="ot">&lt;-</span> <span class="fu">exp</span>(ar_alpha[it_m_c])</span>
<span id="cb484-14"><a href="nonlinear-and-other-regressions.html#cb484-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Diagonal or not</span></span>
<span id="cb484-15"><a href="nonlinear-and-other-regressions.html#cb484-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (it_m_r <span class="sc">==</span> it_m_c) {</span>
<span id="cb484-16"><a href="nonlinear-and-other-regressions.html#cb484-16" aria-hidden="true" tabindex="-1"></a>      fl_rhs_val <span class="ot">&lt;-</span> A_m <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> P_m)</span>
<span id="cb484-17"><a href="nonlinear-and-other-regressions.html#cb484-17" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb484-18"><a href="nonlinear-and-other-regressions.html#cb484-18" aria-hidden="true" tabindex="-1"></a>      fl_rhs_val <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> A_m <span class="sc">*</span> P_m</span>
<span id="cb484-19"><a href="nonlinear-and-other-regressions.html#cb484-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb484-20"><a href="nonlinear-and-other-regressions.html#cb484-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fill value</span></span>
<span id="cb484-21"><a href="nonlinear-and-other-regressions.html#cb484-21" aria-hidden="true" tabindex="-1"></a>    mt_rhs_input[it_m_r, it_m_c] <span class="ot">&lt;-</span> fl_rhs_val</span>
<span id="cb484-22"><a href="nonlinear-and-other-regressions.html#cb484-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb484-23"><a href="nonlinear-and-other-regressions.html#cb484-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb484-24"><a href="nonlinear-and-other-regressions.html#cb484-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb484-25"><a href="nonlinear-and-other-regressions.html#cb484-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Show rhs matrix</span></span>
<span id="cb484-26"><a href="nonlinear-and-other-regressions.html#cb484-26" aria-hidden="true" tabindex="-1"></a>st_caption <span class="ot">&lt;-</span> <span class="st">&quot;RHS fit wages matrix&quot;</span></span>
<span id="cb484-27"><a href="nonlinear-and-other-regressions.html#cb484-27" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(mt_rhs_input, <span class="at">caption =</span> st_caption) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-235">Table 6.13: </span>RHS fit wages matrix
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
mValNoWage1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
mValNoWage2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
mValNoWage3
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
mProb1
</td>
<td style="text-align:right;">
0.8335569
</td>
<td style="text-align:right;">
-0.8243618
</td>
<td style="text-align:right;">
-0.5641281
</td>
</tr>
<tr>
<td style="text-align:left;">
mProb2
</td>
<td style="text-align:right;">
-0.3740494
</td>
<td style="text-align:right;">
1.5825131
</td>
<td style="text-align:right;">
-0.4223301
</td>
</tr>
<tr>
<td style="text-align:left;">
mProb3
</td>
<td style="text-align:right;">
-0.3919596
</td>
<td style="text-align:right;">
-0.6467025
</td>
<td style="text-align:right;">
1.0627249
</td>
</tr>
</tbody>
</table>
<p>Add in the LHS probability column.</p>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb485-1"><a href="nonlinear-and-other-regressions.html#cb485-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Construct data structure, LHS and RHS, LHS first oclumn</span></span>
<span id="cb485-2"><a href="nonlinear-and-other-regressions.html#cb485-2" aria-hidden="true" tabindex="-1"></a>mt_all_inputs <span class="ot">&lt;-</span> <span class="fu">cbind</span>(ar_prob_o[<span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(ar_prob_o)], mt_rhs_input)</span>
<span id="cb485-3"><a href="nonlinear-and-other-regressions.html#cb485-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mt_all_inputs)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;prob_o&quot;</span></span>
<span id="cb485-4"><a href="nonlinear-and-other-regressions.html#cb485-4" aria-hidden="true" tabindex="-1"></a>tb_all_inputs <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(mt_all_inputs)</span>
<span id="cb485-5"><a href="nonlinear-and-other-regressions.html#cb485-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Show data</span></span>
<span id="cb485-6"><a href="nonlinear-and-other-regressions.html#cb485-6" aria-hidden="true" tabindex="-1"></a>st_caption <span class="ot">&lt;-</span> <span class="st">&quot;col1=prob in non-outside options; other columns, RHS matrix&quot;</span></span>
<span id="cb485-7"><a href="nonlinear-and-other-regressions.html#cb485-7" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(tb_all_inputs, <span class="at">caption=</span>st_caption) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-236">Table 6.14: </span>col1=prob in non-outside options; other columns, RHS matrix
</caption>
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
prob_o
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
mValNoWage1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
mValNoWage2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
mValNoWage3
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0.3747670
</td>
<td style="text-align:right;">
0.8335569
</td>
<td style="text-align:right;">
-0.8243618
</td>
<td style="text-align:right;">
-0.5641281
</td>
</tr>
<tr>
<td style="text-align:right;">
0.2805663
</td>
<td style="text-align:right;">
-0.3740494
</td>
<td style="text-align:right;">
1.5825131
</td>
<td style="text-align:right;">
-0.4223301
</td>
</tr>
<tr>
<td style="text-align:right;">
0.2940004
</td>
<td style="text-align:right;">
-0.3919596
</td>
<td style="text-align:right;">
-0.6467025
</td>
<td style="text-align:right;">
1.0627249
</td>
</tr>
</tbody>
</table>
</div>
<div id="solveestimate-for-wages-that-explain-shares" class="section level4" number="6.1.3.4">
<h4><span class="header-section-number">6.1.3.4</span> Solve/Estimate for Wages that Explain Shares</h4>
<p>Given the RHS matrix just generated estimate the wages, and check that the match the wages used to simulate the probabilities.</p>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb486-1"><a href="nonlinear-and-other-regressions.html#cb486-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Regression</span></span>
<span id="cb486-2"><a href="nonlinear-and-other-regressions.html#cb486-2" aria-hidden="true" tabindex="-1"></a>fit_ols_agg_prob_to_wages <span class="ot">&lt;-</span> <span class="fu">lm</span>(prob_o <span class="sc">~</span> . <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> tb_all_inputs)</span>
<span id="cb486-3"><a href="nonlinear-and-other-regressions.html#cb486-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_ols_agg_prob_to_wages)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = prob_o ~ . - 1, data = tb_all_inputs)
## 
## Residuals:
## ALL 3 residuals are 0: no residual degrees of freedom!
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)
## mValNoWage1    5.548        NaN     NaN      NaN
## mValNoWage2    2.517        NaN     NaN      NaN
## mValNoWage3    3.855        NaN     NaN      NaN
## 
## Residual standard error: NaN on 0 degrees of freedom
## Multiple R-squared:      1,  Adjusted R-squared:    NaN 
## F-statistic:   NaN on 3 and 0 DF,  p-value: NA</code></pre>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="nonlinear-and-other-regressions.html#cb488-1" aria-hidden="true" tabindex="-1"></a><span class="co"># alpha estimates</span></span>
<span id="cb488-2"><a href="nonlinear-and-other-regressions.html#cb488-2" aria-hidden="true" tabindex="-1"></a>ar_coefficients <span class="ot">&lt;-</span> fit_ols_agg_prob_to_wages<span class="sc">$</span>coefficients</span>
<span id="cb488-3"><a href="nonlinear-and-other-regressions.html#cb488-3" aria-hidden="true" tabindex="-1"></a>ar_wages_esti <span class="ot">&lt;-</span> <span class="fu">log</span>(ar_coefficients)<span class="sc">/</span>fl_beta</span>
<span id="cb488-4"><a href="nonlinear-and-other-regressions.html#cb488-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare estimates and true</span></span>
<span id="cb488-5"><a href="nonlinear-and-other-regressions.html#cb488-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&quot;ar_coefficients=&quot;</span>, ar_coefficients))</span></code></pre></div>
<pre><code>## [1] &quot;ar_coefficients=5.54816023677087&quot; &quot;ar_coefficients=2.51744522035287&quot; &quot;ar_coefficients=3.85489489133316&quot;</code></pre>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="nonlinear-and-other-regressions.html#cb490-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&quot;ar_wages_esti=&quot;</span>, ar_wages_esti))</span></code></pre></div>
<pre><code>## [1] &quot;ar_wages_esti=1.94046728429384&quot; &quot;ar_wages_esti=1.04555649938993&quot; &quot;ar_wages_esti=1.528105488047&quot;</code></pre>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb492-1"><a href="nonlinear-and-other-regressions.html#cb492-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&quot;mt_wages=&quot;</span>, mt_wages))</span></code></pre></div>
<pre><code>## [1] &quot;mt_wages=1.94046728429385&quot; &quot;mt_wages=1.04555649938993&quot; &quot;mt_wages=1.528105488047&quot;</code></pre>

</div>
</div>
</div>
<div id="quantile-regression" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Quantile Regression</h2>

<div id="quantile-regression-basics" class="section level3" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> Quantile Regression Basics</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R Code Examples</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository (<a href="https://fanwangecon.github.io/Stat4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<div id="estimate-mean-and-conditional-quantile-coefficients-using-mtcars-dataset" class="section level4" number="6.2.1.1">
<h4><span class="header-section-number">6.2.1.1</span> Estimate Mean and Conditional Quantile Coefficients using mtcars dataset</h4>
<p>Here, we conduct tests for using the <a href="https://cran.r-project.org/web/packages/quantreg/index.html">quantreg</a> package, using the built-in <a href="https://stat.ethz.ch/R-manual/R-devel/library/datasets/html/mtcars.html">mtcars</a> dataset.</p>
<p>First, estimate the mean (OLS) regression:</p>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb494-1"><a href="nonlinear-and-other-regressions.html#cb494-1" aria-hidden="true" tabindex="-1"></a>fit_mean <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> disp <span class="sc">+</span> hp <span class="sc">+</span> <span class="fu">factor</span>(am) <span class="sc">+</span> <span class="fu">factor</span>(vs), <span class="at">data =</span> mtcars)</span>
<span id="cb494-2"><a href="nonlinear-and-other-regressions.html#cb494-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_mean)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = mpg ~ disp + hp + factor(am) + factor(vs), data = mtcars)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.7981 -1.9532  0.0111  1.5665  5.6321 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 24.832119   2.890418   8.591 3.32e-09 ***
## disp        -0.008304   0.010087  -0.823  0.41757    
## hp          -0.037623   0.013846  -2.717  0.01135 *  
## factor(am)1  4.419257   1.493243   2.960  0.00634 ** 
## factor(vs)1  2.052472   1.627096   1.261  0.21794    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.812 on 27 degrees of freedom
## Multiple R-squared:  0.8104, Adjusted R-squared:  0.7823 
## F-statistic: 28.85 on 4 and 27 DF,  p-value: 2.13e-09</code></pre>
<p>Now estimate conditional quantile regressions (not that this remains linear) at various quantiles, standard error obtained via bootstrap. Note that there is a gradient in the quantile hp coefficients as well as disp. disp sign reverses, also the coefficient on factor am is different by quantiles:</p>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb496-1"><a href="nonlinear-and-other-regressions.html#cb496-1" aria-hidden="true" tabindex="-1"></a>ls_fl_quantiles <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.50</span>, <span class="fl">0.75</span>)</span>
<span id="cb496-2"><a href="nonlinear-and-other-regressions.html#cb496-2" aria-hidden="true" tabindex="-1"></a>fit_quantiles <span class="ot">&lt;-</span> <span class="fu">rq</span>(mpg <span class="sc">~</span> disp <span class="sc">+</span> hp <span class="sc">+</span> <span class="fu">factor</span>(am),</span>
<span id="cb496-3"><a href="nonlinear-and-other-regressions.html#cb496-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">tau =</span> ls_fl_quantiles,</span>
<span id="cb496-4"><a href="nonlinear-and-other-regressions.html#cb496-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> mtcars)</span>
<span id="cb496-5"><a href="nonlinear-and-other-regressions.html#cb496-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_quantiles, <span class="at">se =</span> <span class="st">&quot;boot&quot;</span>)</span></code></pre></div>
<pre><code>## 
## Call: rq(formula = mpg ~ disp + hp + factor(am), tau = ls_fl_quantiles, 
##     data = mtcars)
## 
## tau: [1] 0.25
## 
## Coefficients:
##             Value    Std. Error t value  Pr(&gt;|t|)
## (Intercept) 25.34665  1.50911   16.79575  0.00000
## disp        -0.02441  0.00952   -2.56333  0.01603
## hp          -0.01672  0.01641   -1.01845  0.31718
## factor(am)1  1.39719  1.43085    0.97648  0.33719
## 
## Call: rq(formula = mpg ~ disp + hp + factor(am), tau = ls_fl_quantiles, 
##     data = mtcars)
## 
## tau: [1] 0.5
## 
## Coefficients:
##             Value    Std. Error t value  Pr(&gt;|t|)
## (Intercept) 27.49722  1.78258   15.42554  0.00000
## disp        -0.02253  0.01571   -1.43388  0.16268
## hp          -0.02713  0.02329   -1.16494  0.25387
## factor(am)1  3.37328  2.09860    1.60739  0.11919
## 
## Call: rq(formula = mpg ~ disp + hp + factor(am), tau = ls_fl_quantiles, 
##     data = mtcars)
## 
## tau: [1] 0.75
## 
## Coefficients:
##             Value    Std. Error t value  Pr(&gt;|t|)
## (Intercept) 28.06384  1.75630   15.97892  0.00000
## disp         0.00445  0.01427    0.31201  0.75734
## hp          -0.06662  0.01781   -3.74146  0.00084
## factor(am)1  7.91402  2.48452    3.18533  0.00353</code></pre>
</div>
<div id="test-conditional-quantile-coefficients-if-different" class="section level4" number="6.2.1.2">
<h4><span class="header-section-number">6.2.1.2</span> Test Conditional Quantile Coefficients if Different</h4>
<p>Use the rq.anova function frm the quantile regression packge to conduct WALD test. Remember WALD test says given unrestricted model’s estimates, test where null is that the coefficients satisfy some linear restrictions.</p>
<p>To test, use the returned object from running rq with different numbers of quantiles, and set the option <em>joint</em> to true or false. When joint is true: “equality of slopes should be done as joint tests on all slope parameters,” when joint is false: “separate tests on each of the slope parameters should be reported.” A slope parameter refers to one of the RHS variables.</p>
<p>Note that quantile tests are “parallel line” tests. Meaning that we should except to have different x-intercepts for each quantile, because they represents the levels of the conditional shocks distributions. However, if quantile coefficients for the slopes are all the same, then there are no quantile specific effects, mean effects would be sufficient.</p>
<p>see:</p>
<ul>
<li><a href="https://stackoverflow.com/questions/32743758/anova-rq-in-quantreg-package-in-r">anova.rq() in quantreg package in R</a></li>
</ul>
<div id="test-statistical-difference-between-25th-and-50th-conditional-quantiles" class="section level5" number="6.2.1.2.1">
<h5><span class="header-section-number">6.2.1.2.1</span> Test Statistical Difference between 25th and 50th Conditional Quantiles</h5>
<p>Given the quantile estimates above, the difference between 0.25 and 0.50 quantiles exists, but are they sufficiently large to be statistically different? What is the p-value? Reviewing the results below, they are not statistically different.</p>
<p>First, joint = TRUE. This is not testing if the coefficien on disp is the same as the coefficient on hp. This is testing jointly if the coefficients for different quantiles of disp, and different quantiles of hp are the same for each RHS variable.</p>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb498-1"><a href="nonlinear-and-other-regressions.html#cb498-1" aria-hidden="true" tabindex="-1"></a>ls_fl_quantiles <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.50</span>)</span>
<span id="cb498-2"><a href="nonlinear-and-other-regressions.html#cb498-2" aria-hidden="true" tabindex="-1"></a>fit_quantiles <span class="ot">&lt;-</span> <span class="fu">rq</span>(mpg <span class="sc">~</span> disp <span class="sc">+</span> hp <span class="sc">+</span> <span class="fu">factor</span>(am),</span>
<span id="cb498-3"><a href="nonlinear-and-other-regressions.html#cb498-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">tau =</span> ls_fl_quantiles,</span>
<span id="cb498-4"><a href="nonlinear-and-other-regressions.html#cb498-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> mtcars)</span>
<span id="cb498-5"><a href="nonlinear-and-other-regressions.html#cb498-5" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit_quantiles, <span class="at">test =</span> <span class="st">&quot;Wald&quot;</span>, <span class="at">joint=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## Quantile Regression Analysis of Deviance Table
## 
## Model: mpg ~ disp + hp + factor(am)
## Joint Test of Equality of Slopes: tau in {  0.25 0.5  }
## 
##   Df Resid Df F value Pr(&gt;F)
## 1  3       61  0.8421 0.4761</code></pre>
<p>Second, joint = False:</p>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb500-1"><a href="nonlinear-and-other-regressions.html#cb500-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit_quantiles, <span class="at">test =</span> <span class="st">&quot;Wald&quot;</span>, <span class="at">joint=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## Quantile Regression Analysis of Deviance Table
## 
## Model: mpg ~ disp + hp + factor(am)
## Tests of Equality of Distinct Slopes: tau in {  0.25 0.5  }
## 
##             Df Resid Df F value Pr(&gt;F)
## disp         1       63  0.0305 0.8619
## hp           1       63  0.5461 0.4627
## factor(am)1  1       63  1.3500 0.2497</code></pre>
</div>
<div id="test-statistical-difference-between-25th-50th-and-75th-conditional-quantiles" class="section level5" number="6.2.1.2.2">
<h5><span class="header-section-number">6.2.1.2.2</span> Test Statistical Difference between 25th, 50th, and 75th Conditional Quantiles</h5>
<p>The 1st quartile and median do not seem to be statistically different, now include the 3rd quartile. As seen earlier, the quartiles jointly show a gradient. Now, we can see that idisp, hp and am are separately have statistically different</p>
<p>First, joint = TRUE:</p>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb502-1"><a href="nonlinear-and-other-regressions.html#cb502-1" aria-hidden="true" tabindex="-1"></a>ls_fl_quantiles <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.50</span>, <span class="fl">0.75</span>)</span>
<span id="cb502-2"><a href="nonlinear-and-other-regressions.html#cb502-2" aria-hidden="true" tabindex="-1"></a>fit_quantiles <span class="ot">&lt;-</span> <span class="fu">rq</span>(mpg <span class="sc">~</span> disp <span class="sc">+</span> hp <span class="sc">+</span> <span class="fu">factor</span>(am),</span>
<span id="cb502-3"><a href="nonlinear-and-other-regressions.html#cb502-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">tau =</span> ls_fl_quantiles,</span>
<span id="cb502-4"><a href="nonlinear-and-other-regressions.html#cb502-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> mtcars)</span>
<span id="cb502-5"><a href="nonlinear-and-other-regressions.html#cb502-5" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit_quantiles, <span class="at">test =</span> <span class="st">&quot;Wald&quot;</span>, <span class="at">joint=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## Quantile Regression Analysis of Deviance Table
## 
## Model: mpg ~ disp + hp + factor(am)
## Joint Test of Equality of Slopes: tau in {  0.25 0.5 0.75  }
## 
##   Df Resid Df F value   Pr(&gt;F)   
## 1  6       90  3.3173 0.005367 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Second, joint = False:</p>
<div class="sourceCode" id="cb504"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb504-1"><a href="nonlinear-and-other-regressions.html#cb504-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit_quantiles, <span class="at">test =</span> <span class="st">&quot;Wald&quot;</span>, <span class="at">joint=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## Quantile Regression Analysis of Deviance Table
## 
## Model: mpg ~ disp + hp + factor(am)
## Tests of Equality of Distinct Slopes: tau in {  0.25 0.5 0.75  }
## 
##             Df Resid Df F value   Pr(&gt;F)   
## disp         2       94  5.4903 0.005558 **
## hp           2       94  6.7221 0.001868 **
## factor(am)1  2       94  7.2758 0.001154 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>

</div>
</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="linear-regression.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="optimization.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": [["Panel-Data-and-Optimization-with-R.pdf", "PDF"]],
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
