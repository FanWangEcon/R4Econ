<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 10 Get Data | Data Structures, Estimation and Optimization with R</title>
  <meta name="description" content="<p>Run system executable and shell commands.
Activate conda environment with shell script.</p>" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 10 Get Data | Data Structures, Estimation and Optimization with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="<p>Run system executable and shell commands.
Activate conda environment with shell script.</p>" />
  <meta name="github-repo" content="fanwangecon/R4Econ" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 10 Get Data | Data Structures, Estimation and Optimization with R" />
  
  <meta name="twitter:description" content="<p>Run system executable and shell commands.
Activate conda environment with shell script.</p>" />
  

<meta name="author" content="Fan Wang" />


<meta name="date" content="2021-01-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="tables-and-graphs.html"/>
<link rel="next" href="code-and-development.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-92953468-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-92953468-5');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Structures and Estimation with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html"><i class="fa fa-check"></i><b>1</b> Array, Matrix, Dataframe</a>
<ul>
<li class="chapter" data-level="1.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#list"><i class="fa fa-check"></i><b>1.1</b> List</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#multiple-dimensional-list"><i class="fa fa-check"></i><b>1.1.1</b> Multiple Dimensional List</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#array"><i class="fa fa-check"></i><b>1.2</b> Array</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#array-basics"><i class="fa fa-check"></i><b>1.2.1</b> Array Basics</a></li>
<li class="chapter" data-level="1.2.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-arrays"><i class="fa fa-check"></i><b>1.2.2</b> Generate Arrays</a></li>
<li class="chapter" data-level="1.2.3" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#string-arrays"><i class="fa fa-check"></i><b>1.2.3</b> String Arrays</a></li>
<li class="chapter" data-level="1.2.4" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#mesh-matrices-arrays-and-scalars"><i class="fa fa-check"></i><b>1.2.4</b> Mesh Matrices, Arrays and Scalars</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#matrix"><i class="fa fa-check"></i><b>1.3</b> Matrix</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-matrixes"><i class="fa fa-check"></i><b>1.3.1</b> Generate Matrixes</a></li>
<li class="chapter" data-level="1.3.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#linear-algebra"><i class="fa fa-check"></i><b>1.3.2</b> Linear Algebra</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#variables-in-dataframes"><i class="fa fa-check"></i><b>1.4</b> Variables in Dataframes</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-dataframe"><i class="fa fa-check"></i><b>1.4.1</b> Generate Dataframe</a></li>
<li class="chapter" data-level="1.4.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#factor-label-and-combine"><i class="fa fa-check"></i><b>1.4.2</b> Factor Label and Combine</a></li>
<li class="chapter" data-level="1.4.3" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#drawly-random-rows"><i class="fa fa-check"></i><b>1.4.3</b> Drawly Random Rows</a></li>
<li class="chapter" data-level="1.4.4" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-variables-conditional-on-others"><i class="fa fa-check"></i><b>1.4.4</b> Generate Variables Conditional On Others</a></li>
<li class="chapter" data-level="1.4.5" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#string-dataframes"><i class="fa fa-check"></i><b>1.4.5</b> String Dataframes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="summarize-data.html"><a href="summarize-data.html"><i class="fa fa-check"></i><b>2</b> Summarize Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="summarize-data.html"><a href="summarize-data.html#counting-observation"><i class="fa fa-check"></i><b>2.1</b> Counting Observation</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="summarize-data.html"><a href="summarize-data.html#uncount"><i class="fa fa-check"></i><b>2.1.1</b> Uncount</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="summarize-data.html"><a href="summarize-data.html#sorting-indexing-slicing"><i class="fa fa-check"></i><b>2.2</b> Sorting, Indexing, Slicing</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="summarize-data.html"><a href="summarize-data.html#sorting"><i class="fa fa-check"></i><b>2.2.1</b> Sorting</a></li>
<li class="chapter" data-level="2.2.2" data-path="summarize-data.html"><a href="summarize-data.html#group-sort-and-slice"><i class="fa fa-check"></i><b>2.2.2</b> Group, Sort and Slice</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="summarize-data.html"><a href="summarize-data.html#group-statistics"><i class="fa fa-check"></i><b>2.3</b> Group Statistics</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="summarize-data.html"><a href="summarize-data.html#cumulative-statistics-within-group"><i class="fa fa-check"></i><b>2.3.1</b> Cumulative Statistics within Group</a></li>
<li class="chapter" data-level="2.3.2" data-path="summarize-data.html"><a href="summarize-data.html#groups-statistics"><i class="fa fa-check"></i><b>2.3.2</b> Groups Statistics</a></li>
<li class="chapter" data-level="2.3.3" data-path="summarize-data.html"><a href="summarize-data.html#one-variable-group-summary"><i class="fa fa-check"></i><b>2.3.3</b> One Variable Group Summary</a></li>
<li class="chapter" data-level="2.3.4" data-path="summarize-data.html"><a href="summarize-data.html#nested-within-group-stats"><i class="fa fa-check"></i><b>2.3.4</b> Nested within Group Stats</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="summarize-data.html"><a href="summarize-data.html#distributional-statistics"><i class="fa fa-check"></i><b>2.4</b> Distributional Statistics</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="summarize-data.html"><a href="summarize-data.html#histogram"><i class="fa fa-check"></i><b>2.4.1</b> Histogram</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="summarize-data.html"><a href="summarize-data.html#summarize-multiple-variables"><i class="fa fa-check"></i><b>2.5</b> Summarize Multiple Variables</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="summarize-data.html"><a href="summarize-data.html#generate-replace-variables"><i class="fa fa-check"></i><b>2.5.1</b> Generate Replace Variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>3</b> Functions</a>
<ul>
<li class="chapter" data-level="3.1" data-path="functions.html"><a href="functions.html#dataframe-mutate"><i class="fa fa-check"></i><b>3.1</b> Dataframe Mutate</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="functions.html"><a href="functions.html#row-input-functions"><i class="fa fa-check"></i><b>3.1.1</b> Row Input Functions</a></li>
<li class="chapter" data-level="3.1.2" data-path="functions.html"><a href="functions.html#evaluate-choices-across-states"><i class="fa fa-check"></i><b>3.1.2</b> Evaluate Choices Across States</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="functions.html"><a href="functions.html#dataframe-do-anything"><i class="fa fa-check"></i><b>3.2</b> Dataframe Do Anything</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="functions.html"><a href="functions.html#mx1-by-n-to-mxq-by-n1"><i class="fa fa-check"></i><b>3.2.1</b> (Mx1 by N) to (MxQ by N+1)</a></li>
<li class="chapter" data-level="3.2.2" data-path="functions.html"><a href="functions.html#mxp-by-n-to-mx1-by-1"><i class="fa fa-check"></i><b>3.2.2</b> (MxP by N) to (Mx1 by 1)</a></li>
<li class="chapter" data-level="3.2.3" data-path="functions.html"><a href="functions.html#mxp-by-n-to-mxq-by-nz"><i class="fa fa-check"></i><b>3.2.3</b> (MxP by N) to (MxQ by N+Z)</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="functions.html"><a href="functions.html#apply-and-pmap"><i class="fa fa-check"></i><b>3.3</b> Apply and pmap</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="functions.html"><a href="functions.html#apply-and-sapply"><i class="fa fa-check"></i><b>3.3.1</b> Apply and Sapply</a></li>
<li class="chapter" data-level="3.3.2" data-path="functions.html"><a href="functions.html#mutate-evaluate-functions"><i class="fa fa-check"></i><b>3.3.2</b> Mutate Evaluate Functions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="panel-and-multi-dimensional-data-structures.html"><a href="panel-and-multi-dimensional-data-structures.html"><i class="fa fa-check"></i><b>4</b> Panel and Multi-dimensional Data Structures</a>
<ul>
<li class="chapter" data-level="4.1" data-path="panel-and-multi-dimensional-data-structures.html"><a href="panel-and-multi-dimensional-data-structures.html#generate-gather-bind-and-join"><i class="fa fa-check"></i><b>4.1</b> Generate, Gather, Bind and Join</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="panel-and-multi-dimensional-data-structures.html"><a href="panel-and-multi-dimensional-data-structures.html#generate-panel-structure"><i class="fa fa-check"></i><b>4.1.1</b> Generate Panel Structure</a></li>
<li class="chapter" data-level="4.1.2" data-path="panel-and-multi-dimensional-data-structures.html"><a href="panel-and-multi-dimensional-data-structures.html#join-datasets"><i class="fa fa-check"></i><b>4.1.2</b> Join Datasets</a></li>
<li class="chapter" data-level="4.1.3" data-path="panel-and-multi-dimensional-data-structures.html"><a href="panel-and-multi-dimensional-data-structures.html#gather-files"><i class="fa fa-check"></i><b>4.1.3</b> Gather Files</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="panel-and-multi-dimensional-data-structures.html"><a href="panel-and-multi-dimensional-data-structures.html#wide-and-long"><i class="fa fa-check"></i><b>4.2</b> Wide and Long</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="panel-and-multi-dimensional-data-structures.html"><a href="panel-and-multi-dimensional-data-structures.html#long-to-wide"><i class="fa fa-check"></i><b>4.2.1</b> Long to Wide</a></li>
<li class="chapter" data-level="4.2.2" data-path="panel-and-multi-dimensional-data-structures.html"><a href="panel-and-multi-dimensional-data-structures.html#wide-to-long"><i class="fa fa-check"></i><b>4.2.2</b> Wide to Long</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="panel-and-multi-dimensional-data-structures.html"><a href="panel-and-multi-dimensional-data-structures.html#join-and-compare"><i class="fa fa-check"></i><b>4.3</b> Join and Compare</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="panel-and-multi-dimensional-data-structures.html"><a href="panel-and-multi-dimensional-data-structures.html#find-closest-neighbor-on-grid"><i class="fa fa-check"></i><b>4.3.1</b> Find Closest Neighbor on Grid</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i><b>5</b> Linear Regression</a>
<ul>
<li class="chapter" data-level="5.1" data-path="linear-regression.html"><a href="linear-regression.html#ols-and-iv"><i class="fa fa-check"></i><b>5.1</b> OLS and IV</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="linear-regression.html"><a href="linear-regression.html#ols-and-iv-regression"><i class="fa fa-check"></i><b>5.1.1</b> OLS and IV Regression</a></li>
<li class="chapter" data-level="5.1.2" data-path="linear-regression.html"><a href="linear-regression.html#iv-loop-over-rhs"><i class="fa fa-check"></i><b>5.1.2</b> IV Loop over RHS</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="linear-regression.html"><a href="linear-regression.html#decomposition"><i class="fa fa-check"></i><b>5.2</b> Decomposition</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="linear-regression.html"><a href="linear-regression.html#decompose-rhs"><i class="fa fa-check"></i><b>5.2.1</b> Decompose RHS</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html"><i class="fa fa-check"></i><b>6</b> Nonlinear Regression</a>
<ul>
<li class="chapter" data-level="6.1" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html#logit-regression"><i class="fa fa-check"></i><b>6.1</b> Logit Regression</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html#binary-logit"><i class="fa fa-check"></i><b>6.1.1</b> Binary Logit</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html#quantile-regression"><i class="fa fa-check"></i><b>6.2</b> Quantile Regression</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html#quantile-regression-basics"><i class="fa fa-check"></i><b>6.2.1</b> Quantile Regression Basics</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="optimization.html"><a href="optimization.html"><i class="fa fa-check"></i><b>7</b> Optimization</a>
<ul>
<li class="chapter" data-level="7.1" data-path="optimization.html"><a href="optimization.html#bisection"><i class="fa fa-check"></i><b>7.1</b> Bisection</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="optimization.html"><a href="optimization.html#bisection-1"><i class="fa fa-check"></i><b>7.1.1</b> Bisection</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html"><i class="fa fa-check"></i><b>8</b> Mathmatics and Statistics</a>
<ul>
<li class="chapter" data-level="8.1" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#distributions"><i class="fa fa-check"></i><b>8.1</b> Distributions</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#integrate-over-normal-guassian-process-shock"><i class="fa fa-check"></i><b>8.1.1</b> Integrate Over Normal Guassian Process Shock</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#analytical-solutions"><i class="fa fa-check"></i><b>8.2</b> Analytical Solutions</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#linear-scalar-fx0-solutions"><i class="fa fa-check"></i><b>8.2.1</b> Linear Scalar f(x)=0 Solutions</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#inequality-models"><i class="fa fa-check"></i><b>8.3</b> Inequality Models</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#gini-discrete-sample"><i class="fa fa-check"></i><b>8.3.1</b> Gini Discrete Sample</a></li>
<li class="chapter" data-level="8.3.2" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#atkinson-inequality-index"><i class="fa fa-check"></i><b>8.3.2</b> Atkinson Inequality Index</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html"><i class="fa fa-check"></i><b>9</b> Tables and Graphs</a>
<ul>
<li class="chapter" data-level="9.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#r-base-plots"><i class="fa fa-check"></i><b>9.1</b> R Base Plots</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#plot-curve-line-and-points"><i class="fa fa-check"></i><b>9.1.1</b> Plot Curve, Line and Points</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#write-and-read-plots"><i class="fa fa-check"></i><b>9.2</b> Write and Read Plots</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#import-and-export-images"><i class="fa fa-check"></i><b>9.2.1</b> Import and Export Images</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="get-data.html"><a href="get-data.html"><i class="fa fa-check"></i><b>10</b> Get Data</a>
<ul>
<li class="chapter" data-level="10.1" data-path="get-data.html"><a href="get-data.html#environmental-data"><i class="fa fa-check"></i><b>10.1</b> Environmental Data</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="get-data.html"><a href="get-data.html#ecmwf-era5-data"><i class="fa fa-check"></i><b>10.1.1</b> ECMWF ERA5 Data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="code-and-development.html"><a href="code-and-development.html"><i class="fa fa-check"></i><b>11</b> Code and Development</a>
<ul>
<li class="chapter" data-level="11.1" data-path="code-and-development.html"><a href="code-and-development.html#files-in-and-out"><i class="fa fa-check"></i><b>11.1</b> Files In and Out</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="code-and-development.html"><a href="code-and-development.html#file-path"><i class="fa fa-check"></i><b>11.1.1</b> File Path</a></li>
<li class="chapter" data-level="11.1.2" data-path="code-and-development.html"><a href="code-and-development.html#text-to-file"><i class="fa fa-check"></i><b>11.1.2</b> Text to File</a></li>
<li class="chapter" data-level="11.1.3" data-path="code-and-development.html"><a href="code-and-development.html#rmd-to-html"><i class="fa fa-check"></i><b>11.1.3</b> Rmd to HTML</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="code-and-development.html"><a href="code-and-development.html#python-with-r"><i class="fa fa-check"></i><b>11.2</b> Python with R</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="code-and-development.html"><a href="code-and-development.html#reticulate-basics"><i class="fa fa-check"></i><b>11.2.1</b> Reticulate Basics</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="code-and-development.html"><a href="code-and-development.html#command-line"><i class="fa fa-check"></i><b>11.3</b> Command Line</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="code-and-development.html"><a href="code-and-development.html#shell-and-system-commands"><i class="fa fa-check"></i><b>11.3.1</b> Shell and System Commands</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="index-and-code-links.html"><a href="index-and-code-links.html"><i class="fa fa-check"></i><b>A</b> Index and Code Links</a>
<ul>
<li class="chapter" data-level="A.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#array-matrix-dataframe-links"><i class="fa fa-check"></i><b>A.1</b> Array, Matrix, Dataframe links</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.1-listlist-links"><i class="fa fa-check"></i><b>A.1.1</b> <span>Section 1.1 List</span> links</a></li>
<li class="chapter" data-level="A.1.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.2-arrayarray-links"><i class="fa fa-check"></i><b>A.1.2</b> <span>Section 1.2 Array</span> links</a></li>
<li class="chapter" data-level="A.1.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.3-matrixmatrix-links"><i class="fa fa-check"></i><b>A.1.3</b> <span>Section 1.3 Matrix</span> links</a></li>
<li class="chapter" data-level="A.1.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.4-variables-in-dataframesvariables-in-dataframes-links"><i class="fa fa-check"></i><b>A.1.4</b> <span>Section 1.4 Variables in Dataframes</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#summarize-data-links"><i class="fa fa-check"></i><b>A.2</b> Summarize Data links</a>
<ul>
<li class="chapter" data-level="A.2.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.1-counting-observationcounting-observation-links"><i class="fa fa-check"></i><b>A.2.1</b> <span>Section 2.1 Counting Observation</span> links</a></li>
<li class="chapter" data-level="A.2.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.2-sorting-indexing-slicingsorting-indexing-slicing-links"><i class="fa fa-check"></i><b>A.2.2</b> <span>Section 2.2 Sorting, Indexing, Slicing</span> links</a></li>
<li class="chapter" data-level="A.2.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.3-group-statisticsgroup-statistics-links"><i class="fa fa-check"></i><b>A.2.3</b> <span>Section 2.3 Group Statistics</span> links</a></li>
<li class="chapter" data-level="A.2.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.4-distributional-statisticsdistributional-statistics-links"><i class="fa fa-check"></i><b>A.2.4</b> <span>Section 2.4 Distributional Statistics</span> links</a></li>
<li class="chapter" data-level="A.2.5" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.5-summarize-multiple-variablessummarize-multiple-variables-links"><i class="fa fa-check"></i><b>A.2.5</b> <span>Section 2.5 Summarize Multiple Variables</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#functions-links"><i class="fa fa-check"></i><b>A.3</b> Functions links</a>
<ul>
<li class="chapter" data-level="A.3.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.1-dataframe-mutatedataframe-mutate-links"><i class="fa fa-check"></i><b>A.3.1</b> <span>Section 3.1 Dataframe Mutate</span> links</a></li>
<li class="chapter" data-level="A.3.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.2-dataframe-do-anythingdataframe-do-anything-links"><i class="fa fa-check"></i><b>A.3.2</b> <span>Section 3.2 Dataframe Do Anything</span> links</a></li>
<li class="chapter" data-level="A.3.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.3-apply-and-pmapapply-and-pmap-links"><i class="fa fa-check"></i><b>A.3.3</b> <span>Section 3.3 Apply and pmap</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#panel-and-multi-dimensional-data-structures-links"><i class="fa fa-check"></i><b>A.4</b> Panel and Multi-dimensional Data Structures links</a>
<ul>
<li class="chapter" data-level="A.4.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-4.1-generate-gather-bind-and-joingenerate-gather-bind-and-join-links"><i class="fa fa-check"></i><b>A.4.1</b> <span>Section 4.1 Generate, Gather, Bind and Join</span> links</a></li>
<li class="chapter" data-level="A.4.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-4.2-wide-and-longwide-and-long-links"><i class="fa fa-check"></i><b>A.4.2</b> <span>Section 4.2 Wide and Long</span> links</a></li>
<li class="chapter" data-level="A.4.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-4.3-join-and-comparejoin-and-compare-links"><i class="fa fa-check"></i><b>A.4.3</b> <span>Section 4.3 Join and Compare</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.5" data-path="index-and-code-links.html"><a href="index-and-code-links.html#linear-regression-links"><i class="fa fa-check"></i><b>A.5</b> Linear Regression links</a>
<ul>
<li class="chapter" data-level="A.5.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-5.1-ols-and-ivols-and-iv-links"><i class="fa fa-check"></i><b>A.5.1</b> <span>Section 5.1 OLS and IV</span> links</a></li>
<li class="chapter" data-level="A.5.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-5.2-decompositiondecomposition-links"><i class="fa fa-check"></i><b>A.5.2</b> <span>Section 5.2 Decomposition</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.6" data-path="index-and-code-links.html"><a href="index-and-code-links.html#nonlinear-regression-links"><i class="fa fa-check"></i><b>A.6</b> Nonlinear Regression links</a>
<ul>
<li class="chapter" data-level="A.6.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-6.1-logit-regressionlogit-regression-links"><i class="fa fa-check"></i><b>A.6.1</b> <span>Section 6.1 Logit Regression</span> links</a></li>
<li class="chapter" data-level="A.6.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-6.2-quantile-regressionquantile-regression-links"><i class="fa fa-check"></i><b>A.6.2</b> <span>Section 6.2 Quantile Regression</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.7" data-path="index-and-code-links.html"><a href="index-and-code-links.html#optimization-links"><i class="fa fa-check"></i><b>A.7</b> Optimization links</a>
<ul>
<li class="chapter" data-level="A.7.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-7.1-bisectionbisection-links"><i class="fa fa-check"></i><b>A.7.1</b> <span>Section 7.1 Bisection</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.8" data-path="index-and-code-links.html"><a href="index-and-code-links.html#mathmatics-and-statistics-links"><i class="fa fa-check"></i><b>A.8</b> Mathmatics and Statistics links</a>
<ul>
<li class="chapter" data-level="A.8.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-8.1-distributionsdistributions-links"><i class="fa fa-check"></i><b>A.8.1</b> <span>Section 8.1 Distributions</span> links</a></li>
<li class="chapter" data-level="A.8.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-8.2-analytical-solutionsanalytical-solutions-links"><i class="fa fa-check"></i><b>A.8.2</b> <span>Section 8.2 Analytical Solutions</span> links</a></li>
<li class="chapter" data-level="A.8.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-8.3-inequality-modelsinequality-models-links"><i class="fa fa-check"></i><b>A.8.3</b> <span>Section 8.3 Inequality Models</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.9" data-path="index-and-code-links.html"><a href="index-and-code-links.html#tables-and-graphs-links"><i class="fa fa-check"></i><b>A.9</b> Tables and Graphs links</a>
<ul>
<li class="chapter" data-level="A.9.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-9.1-r-base-plotsr-base-plots-links"><i class="fa fa-check"></i><b>A.9.1</b> <span>Section 9.1 R Base Plots</span> links</a></li>
<li class="chapter" data-level="A.9.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-9.2-write-and-read-plotswrite-and-read-plots-links"><i class="fa fa-check"></i><b>A.9.2</b> <span>Section 9.2 Write and Read Plots</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.10" data-path="index-and-code-links.html"><a href="index-and-code-links.html#get-data-links"><i class="fa fa-check"></i><b>A.10</b> Get Data links</a>
<ul>
<li class="chapter" data-level="A.10.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-10.1-environmental-dataenvironmental-data-links"><i class="fa fa-check"></i><b>A.10.1</b> <span>Section 10.1 Environmental Data</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.11" data-path="index-and-code-links.html"><a href="index-and-code-links.html#code-and-development-links"><i class="fa fa-check"></i><b>A.11</b> Code and Development links</a>
<ul>
<li class="chapter" data-level="A.11.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-11.1-files-in-and-outfiles-in-and-out-links"><i class="fa fa-check"></i><b>A.11.1</b> <span>Section 11.1 Files In and Out</span> links</a></li>
<li class="chapter" data-level="A.11.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-11.2-python-with-rpython-with-r-links"><i class="fa fa-check"></i><b>A.11.2</b> <span>Section 11.2 Python with R</span> links</a></li>
<li class="chapter" data-level="A.11.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-11.3-command-linecommand-line-links"><i class="fa fa-check"></i><b>A.11.3</b> <span>Section 11.3 Command Line</span> links</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://fanwangecon.github.io/R4Econ/bookdown/index.html" target="blank">R4Econ Bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Structures, Estimation and Optimization with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="get-data" class="section level1" number="10">
<h1><span class="header-section-number">Chapter 10</span> Get Data</h1>

<div id="environmental-data" class="section level2" number="10.1">
<h2><span class="header-section-number">10.1</span> Environmental Data</h2>

<div id="ecmwf-era5-data" class="section level3" number="10.1.1">
<h3><span class="header-section-number">10.1.1</span> ECMWF ERA5 Data</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>â€™s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R Code Examples</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository (<a href="https://fanwangecon.github.io/Stat4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<p>This files uses R with the reticulate package to download ECMWF ERA5 data. See <a href="https://fanwangecon.github.io/pyfan/vig/getdata/envir/htmlpdfr/fs_ecmwf.html">this file</a> for instructions and tutorials for downloading the data.</p>
<div id="program-to-download-unzip-convert-to-combined-csv-derived-utci-historical-data" class="section level4" number="10.1.1.1">
<h4><span class="header-section-number">10.1.1.1</span> Program to Download, Unzip, Convert to combined CSV, derived-utci-historical data</h4>
<p>The data downloaded from CDS climate could become very large in size. We want to process parts of the data one part at a time, summarize and aggregate over each part, and generate a file output file with aggregate statistics over the entire time period of interest.</p>
<p>This code below accompalishes the following tasks:</p>
<ol style="list-style-type: decimal">
<li>download data from derived-utci-historical as ZIP</li>
<li>unzip</li>
<li>convert <em>nc</em> files to <em>csv</em> files</li>
<li>individual csv files are half year groups</li>
</ol>
<p>Parameter Control for the code below:</p>
<ol style="list-style-type: decimal">
<li><em>spt_root</em>: root folder where everything will be at</li>
<li><em>spth_conda_env</em>: the conda virtual environment python path, eccodes and cdsapi packages are installed in the conda virtual environment. In the example below, the first env is: wk_ecmwf</li>
<li><em>st_nc_prefix</em>: the downloaded individual nc files have dates and prefix before and after the date string in the nc file names. This is the string before that.</li>
<li><em>st_nc_suffix</em>: see (3), this is the suffix</li>
<li><em>ar_years</em>: array of years to download and aggregate over</li>
<li><em>ar_months_g1</em>: months to download in first half year</li>
<li><em>ar_months_g2</em>: months to download in second half year</li>
</ol>
<p>Note: <em>area</em> below corresponds to <em>North, West, South, East</em>.</p>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb473-1"><a href="get-data.html#cb473-1" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################</span></span>
<span id="cb473-2"><a href="get-data.html#cb473-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------ Parameters</span></span>
<span id="cb473-3"><a href="get-data.html#cb473-3" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################</span></span>
<span id="cb473-4"><a href="get-data.html#cb473-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-5"><a href="get-data.html#cb473-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Where to store everything</span></span>
<span id="cb473-6"><a href="get-data.html#cb473-6" aria-hidden="true" tabindex="-1"></a>spt_root <span class="ot">&lt;-</span> <span class="st">&quot;C:/Users/fan/Downloads/_data/&quot;</span></span>
<span id="cb473-7"><a href="get-data.html#cb473-7" aria-hidden="true" tabindex="-1"></a>spth_conda_env <span class="ot">&lt;-</span> <span class="st">&quot;C:/ProgramData/Anaconda3/envs/wk_ecmwf/python.exe&quot;</span></span>
<span id="cb473-8"><a href="get-data.html#cb473-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-9"><a href="get-data.html#cb473-9" aria-hidden="true" tabindex="-1"></a><span class="co"># nc name prefix</span></span>
<span id="cb473-10"><a href="get-data.html#cb473-10" aria-hidden="true" tabindex="-1"></a>st_nc_prefix <span class="ot">&lt;-</span> <span class="st">&quot;ECMWF_utci_&quot;</span></span>
<span id="cb473-11"><a href="get-data.html#cb473-11" aria-hidden="true" tabindex="-1"></a>st_nc_suffix <span class="ot">&lt;-</span> <span class="st">&quot;_v1.0_con.nc&quot;</span></span>
<span id="cb473-12"><a href="get-data.html#cb473-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-13"><a href="get-data.html#cb473-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Years list</span></span>
<span id="cb473-14"><a href="get-data.html#cb473-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ar_years &lt;- 2001:2019</span></span>
<span id="cb473-15"><a href="get-data.html#cb473-15" aria-hidden="true" tabindex="-1"></a>ar_years <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2005</span>, <span class="dv">2015</span>)</span>
<span id="cb473-16"><a href="get-data.html#cb473-16" aria-hidden="true" tabindex="-1"></a><span class="co"># ar_months_g1 &lt;- c(&#39;01&#39;,&#39;02&#39;,&#39;03&#39;,&#39;04&#39;,&#39;05&#39;,&#39;06&#39;)</span></span>
<span id="cb473-17"><a href="get-data.html#cb473-17" aria-hidden="true" tabindex="-1"></a>ar_months_g1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;01&#39;</span>, <span class="st">&#39;03&#39;</span>)</span>
<span id="cb473-18"><a href="get-data.html#cb473-18" aria-hidden="true" tabindex="-1"></a><span class="co"># ar_months_g2 &lt;- c(&#39;07&#39;,&#39;08&#39;,&#39;09&#39;,&#39;10&#39;,&#39;11&#39;,&#39;12&#39;)</span></span>
<span id="cb473-19"><a href="get-data.html#cb473-19" aria-hidden="true" tabindex="-1"></a>ar_months_g2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;07&#39;</span>, <span class="st">&#39;09&#39;</span>)</span>
<span id="cb473-20"><a href="get-data.html#cb473-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-21"><a href="get-data.html#cb473-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Area</span></span>
<span id="cb473-22"><a href="get-data.html#cb473-22" aria-hidden="true" tabindex="-1"></a><span class="co"># # China</span></span>
<span id="cb473-23"><a href="get-data.html#cb473-23" aria-hidden="true" tabindex="-1"></a><span class="co"># fl_area_north &lt;- 53.31</span></span>
<span id="cb473-24"><a href="get-data.html#cb473-24" aria-hidden="true" tabindex="-1"></a><span class="co"># fl_area_west &lt;- 73</span></span>
<span id="cb473-25"><a href="get-data.html#cb473-25" aria-hidden="true" tabindex="-1"></a><span class="co"># fl_area_south &lt;- 4.15</span></span>
<span id="cb473-26"><a href="get-data.html#cb473-26" aria-hidden="true" tabindex="-1"></a><span class="co"># fl_area_east &lt;- 135</span></span>
<span id="cb473-27"><a href="get-data.html#cb473-27" aria-hidden="true" tabindex="-1"></a>fl_area_north <span class="ot">&lt;-</span> <span class="dv">53</span></span>
<span id="cb473-28"><a href="get-data.html#cb473-28" aria-hidden="true" tabindex="-1"></a>fl_area_west <span class="ot">&lt;-</span> <span class="dv">73</span></span>
<span id="cb473-29"><a href="get-data.html#cb473-29" aria-hidden="true" tabindex="-1"></a>fl_area_south <span class="ot">&lt;-</span> <span class="dv">52</span></span>
<span id="cb473-30"><a href="get-data.html#cb473-30" aria-hidden="true" tabindex="-1"></a>fl_area_east <span class="ot">&lt;-</span> <span class="dv">74</span></span>
<span id="cb473-31"><a href="get-data.html#cb473-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-32"><a href="get-data.html#cb473-32" aria-hidden="true" tabindex="-1"></a><span class="co"># folder to download any nc zips to</span></span>
<span id="cb473-33"><a href="get-data.html#cb473-33" aria-hidden="true" tabindex="-1"></a>nczippath <span class="ot">&lt;-</span> spt_root</span>
<span id="cb473-34"><a href="get-data.html#cb473-34" aria-hidden="true" tabindex="-1"></a><span class="co"># we are changing the python api file with different requests stirngs and storing it here</span></span>
<span id="cb473-35"><a href="get-data.html#cb473-35" aria-hidden="true" tabindex="-1"></a>pyapipath <span class="ot">&lt;-</span> spt_root</span>
<span id="cb473-36"><a href="get-data.html#cb473-36" aria-hidden="true" tabindex="-1"></a><span class="co"># output directory for AGGREGATE CSV with all DATES from this search</span></span>
<span id="cb473-37"><a href="get-data.html#cb473-37" aria-hidden="true" tabindex="-1"></a>csvpath <span class="ot">&lt;-</span> spt_root</span>
<span id="cb473-38"><a href="get-data.html#cb473-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-39"><a href="get-data.html#cb473-39" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################</span></span>
<span id="cb473-40"><a href="get-data.html#cb473-40" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------ Packages</span></span>
<span id="cb473-41"><a href="get-data.html#cb473-41" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################</span></span>
<span id="cb473-42"><a href="get-data.html#cb473-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-43"><a href="get-data.html#cb473-43" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;ncdf4&quot;</span>)</span>
<span id="cb473-44"><a href="get-data.html#cb473-44" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;chron&quot;</span>)</span>
<span id="cb473-45"><a href="get-data.html#cb473-45" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;lattice&quot;</span>)</span>
<span id="cb473-46"><a href="get-data.html#cb473-46" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;RColorBrewer&quot;</span>)</span>
<span id="cb473-47"><a href="get-data.html#cb473-47" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;stringr&quot;</span>)</span>
<span id="cb473-48"><a href="get-data.html#cb473-48" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;tibble&quot;</span>)</span>
<span id="cb473-49"><a href="get-data.html#cb473-49" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb473-50"><a href="get-data.html#cb473-50" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">RETICULATE_PYTHON =</span> spth_conda_env)</span>
<span id="cb473-51"><a href="get-data.html#cb473-51" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;reticulate&quot;</span>)</span>
<span id="cb473-52"><a href="get-data.html#cb473-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-53"><a href="get-data.html#cb473-53" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################</span></span>
<span id="cb473-54"><a href="get-data.html#cb473-54" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------ Define Loops</span></span>
<span id="cb473-55"><a href="get-data.html#cb473-55" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################</span></span>
<span id="cb473-56"><a href="get-data.html#cb473-56" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (it_yr <span class="cf">in</span> ar_years) {</span>
<span id="cb473-57"><a href="get-data.html#cb473-57" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (it_mth_group <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)) {</span>
<span id="cb473-58"><a href="get-data.html#cb473-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(it_mth_group <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb473-59"><a href="get-data.html#cb473-59" aria-hidden="true" tabindex="-1"></a>      ar_months <span class="ot">=</span> ar_months_g1</span>
<span id="cb473-60"><a href="get-data.html#cb473-60" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb473-61"><a href="get-data.html#cb473-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(it_mth_group <span class="sc">==</span> <span class="dv">2</span>) {</span>
<span id="cb473-62"><a href="get-data.html#cb473-62" aria-hidden="true" tabindex="-1"></a>      ar_months <span class="ot">=</span> ar_months_g2</span>
<span id="cb473-63"><a href="get-data.html#cb473-63" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb473-64"><a href="get-data.html#cb473-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-65"><a href="get-data.html#cb473-65" aria-hidden="true" tabindex="-1"></a>    <span class="do">#################################################</span></span>
<span id="cb473-66"><a href="get-data.html#cb473-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ------------ Define Python API Call</span></span>
<span id="cb473-67"><a href="get-data.html#cb473-67" aria-hidden="true" tabindex="-1"></a>    <span class="do">#################################################</span></span>
<span id="cb473-68"><a href="get-data.html#cb473-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-69"><a href="get-data.html#cb473-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># name of zip file</span></span>
<span id="cb473-70"><a href="get-data.html#cb473-70" aria-hidden="true" tabindex="-1"></a>    nczipname <span class="ot">&lt;-</span> <span class="st">&quot;derived_utci_2010_2.zip&quot;</span></span>
<span id="cb473-71"><a href="get-data.html#cb473-71" aria-hidden="true" tabindex="-1"></a>    unzipfolder <span class="ot">&lt;-</span> <span class="st">&quot;derived_utci_2010_2&quot;</span></span>
<span id="cb473-72"><a href="get-data.html#cb473-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-73"><a href="get-data.html#cb473-73" aria-hidden="true" tabindex="-1"></a>    st_file <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;import cdsapi</span></span>
<span id="cb473-74"><a href="get-data.html#cb473-74" aria-hidden="true" tabindex="-1"></a><span class="st">import urllib.request</span></span>
<span id="cb473-75"><a href="get-data.html#cb473-75" aria-hidden="true" tabindex="-1"></a><span class="st"># download folder</span></span>
<span id="cb473-76"><a href="get-data.html#cb473-76" aria-hidden="true" tabindex="-1"></a><span class="st">spt_root = &#39;&quot;</span>, nczippath, <span class="st">&quot;&#39;</span></span>
<span id="cb473-77"><a href="get-data.html#cb473-77" aria-hidden="true" tabindex="-1"></a><span class="st">spn_dl_test_grib = spt_root + &#39;&quot;</span>, nczipname, <span class="st">&quot;&#39;</span></span>
<span id="cb473-78"><a href="get-data.html#cb473-78" aria-hidden="true" tabindex="-1"></a><span class="st"># request</span></span>
<span id="cb473-79"><a href="get-data.html#cb473-79" aria-hidden="true" tabindex="-1"></a><span class="st">c = cdsapi.Client()</span></span>
<span id="cb473-80"><a href="get-data.html#cb473-80" aria-hidden="true" tabindex="-1"></a><span class="st">res = c.retrieve(</span></span>
<span id="cb473-81"><a href="get-data.html#cb473-81" aria-hidden="true" tabindex="-1"></a><span class="st">    &#39;derived-utci-historical&#39;,</span></span>
<span id="cb473-82"><a href="get-data.html#cb473-82" aria-hidden="true" tabindex="-1"></a><span class="st">    {</span></span>
<span id="cb473-83"><a href="get-data.html#cb473-83" aria-hidden="true" tabindex="-1"></a><span class="st">        &#39;format&#39;: &#39;zip&#39;,</span></span>
<span id="cb473-84"><a href="get-data.html#cb473-84" aria-hidden="true" tabindex="-1"></a><span class="st">        &#39;variable&#39;: &#39;Universal thermal climate index&#39;,</span></span>
<span id="cb473-85"><a href="get-data.html#cb473-85" aria-hidden="true" tabindex="-1"></a><span class="st">        &#39;product_type&#39;: &#39;Consolidated dataset&#39;,</span></span>
<span id="cb473-86"><a href="get-data.html#cb473-86" aria-hidden="true" tabindex="-1"></a><span class="st">        &#39;year&#39;: &#39;&quot;</span>,it_yr, <span class="st">&quot;&#39;,</span></span>
<span id="cb473-87"><a href="get-data.html#cb473-87" aria-hidden="true" tabindex="-1"></a><span class="st">        &#39;month&#39;: [</span></span>
<span id="cb473-88"><a href="get-data.html#cb473-88" aria-hidden="true" tabindex="-1"></a><span class="st">            &quot;</span>, <span class="fu">paste</span>(<span class="st">&quot;&#39;&quot;</span>, ar_months, <span class="st">&quot;&#39;&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>, <span class="at">collapse =</span> <span class="st">&quot;, &quot;</span>), <span class="st">&quot;</span></span>
<span id="cb473-89"><a href="get-data.html#cb473-89" aria-hidden="true" tabindex="-1"></a><span class="st">        ],</span></span>
<span id="cb473-90"><a href="get-data.html#cb473-90" aria-hidden="true" tabindex="-1"></a><span class="st">        &#39;day&#39;: [</span></span>
<span id="cb473-91"><a href="get-data.html#cb473-91" aria-hidden="true" tabindex="-1"></a><span class="st">            &#39;01&#39;,&#39;03&#39;</span></span>
<span id="cb473-92"><a href="get-data.html#cb473-92" aria-hidden="true" tabindex="-1"></a><span class="st">        ],</span></span>
<span id="cb473-93"><a href="get-data.html#cb473-93" aria-hidden="true" tabindex="-1"></a><span class="st">        &#39;area&#39;  : [&quot;</span>, fl_area_north ,<span class="st">&quot;, &quot;</span>, fl_area_west ,<span class="st">&quot;, &quot;</span>, fl_area_south ,<span class="st">&quot;, &quot;</span>, fl_area_east ,<span class="st">&quot;],</span></span>
<span id="cb473-94"><a href="get-data.html#cb473-94" aria-hidden="true" tabindex="-1"></a><span class="st">        &#39;grid&#39;  : [0.25, 0.25],</span></span>
<span id="cb473-95"><a href="get-data.html#cb473-95" aria-hidden="true" tabindex="-1"></a><span class="st">    },</span></span>
<span id="cb473-96"><a href="get-data.html#cb473-96" aria-hidden="true" tabindex="-1"></a><span class="st">    spn_dl_test_grib)</span></span>
<span id="cb473-97"><a href="get-data.html#cb473-97" aria-hidden="true" tabindex="-1"></a><span class="st"># show results</span></span>
<span id="cb473-98"><a href="get-data.html#cb473-98" aria-hidden="true" tabindex="-1"></a><span class="st">print(&#39;print results&#39;)</span></span>
<span id="cb473-99"><a href="get-data.html#cb473-99" aria-hidden="true" tabindex="-1"></a><span class="st">print(res)</span></span>
<span id="cb473-100"><a href="get-data.html#cb473-100" aria-hidden="true" tabindex="-1"></a><span class="st">print(type(res))&quot;</span>)</span>
<span id="cb473-101"><a href="get-data.html#cb473-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-102"><a href="get-data.html#cb473-102" aria-hidden="true" tabindex="-1"></a>    <span class="co"># st_file = &quot;print(1+1)&quot;</span></span>
<span id="cb473-103"><a href="get-data.html#cb473-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-104"><a href="get-data.html#cb473-104" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store Python Api File</span></span>
<span id="cb473-105"><a href="get-data.html#cb473-105" aria-hidden="true" tabindex="-1"></a>    fl_test_tex <span class="ot">&lt;-</span> <span class="fu">paste0</span>(pyapipath, <span class="st">&quot;api.py&quot;</span>)</span>
<span id="cb473-106"><a href="get-data.html#cb473-106" aria-hidden="true" tabindex="-1"></a>    fileConn <span class="ot">&lt;-</span> <span class="fu">file</span>(fl_test_tex)</span>
<span id="cb473-107"><a href="get-data.html#cb473-107" aria-hidden="true" tabindex="-1"></a>    <span class="fu">writeLines</span>(st_file, fileConn)</span>
<span id="cb473-108"><a href="get-data.html#cb473-108" aria-hidden="true" tabindex="-1"></a>    <span class="fu">close</span>(fileConn)</span>
<span id="cb473-109"><a href="get-data.html#cb473-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-110"><a href="get-data.html#cb473-110" aria-hidden="true" tabindex="-1"></a>    <span class="do">#################################################</span></span>
<span id="cb473-111"><a href="get-data.html#cb473-111" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ------------ Run Python File</span></span>
<span id="cb473-112"><a href="get-data.html#cb473-112" aria-hidden="true" tabindex="-1"></a>    <span class="do">#################################################</span></span>
<span id="cb473-113"><a href="get-data.html#cb473-113" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set Path</span></span>
<span id="cb473-114"><a href="get-data.html#cb473-114" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setwd</span>(pyapipath)</span>
<span id="cb473-115"><a href="get-data.html#cb473-115" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Run py file, api.py name just defined</span></span>
<span id="cb473-116"><a href="get-data.html#cb473-116" aria-hidden="true" tabindex="-1"></a>    <span class="fu">use_python</span>(spth_conda_env)</span>
<span id="cb473-117"><a href="get-data.html#cb473-117" aria-hidden="true" tabindex="-1"></a>    <span class="fu">source_python</span>(<span class="st">&#39;api.py&#39;</span>)</span>
<span id="cb473-118"><a href="get-data.html#cb473-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-119"><a href="get-data.html#cb473-119" aria-hidden="true" tabindex="-1"></a>    <span class="do">#################################################</span></span>
<span id="cb473-120"><a href="get-data.html#cb473-120" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ------------ uNZIP</span></span>
<span id="cb473-121"><a href="get-data.html#cb473-121" aria-hidden="true" tabindex="-1"></a>    <span class="do">#################################################</span></span>
<span id="cb473-122"><a href="get-data.html#cb473-122" aria-hidden="true" tabindex="-1"></a>    spn_zip <span class="ot">&lt;-</span> <span class="fu">paste0</span>(nczippath, nczipname)</span>
<span id="cb473-123"><a href="get-data.html#cb473-123" aria-hidden="true" tabindex="-1"></a>    spn_unzip_folder <span class="ot">&lt;-</span> <span class="fu">paste0</span>(nczippath, unzipfolder)</span>
<span id="cb473-124"><a href="get-data.html#cb473-124" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unzip</span>(spn_zip, <span class="at">exdir=</span>spn_unzip_folder)</span>
<span id="cb473-125"><a href="get-data.html#cb473-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-126"><a href="get-data.html#cb473-126" aria-hidden="true" tabindex="-1"></a>    <span class="do">#################################################</span></span>
<span id="cb473-127"><a href="get-data.html#cb473-127" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ------------ Find All files</span></span>
<span id="cb473-128"><a href="get-data.html#cb473-128" aria-hidden="true" tabindex="-1"></a>    <span class="do">#################################################</span></span>
<span id="cb473-129"><a href="get-data.html#cb473-129" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get all files with nc suffix in folder</span></span>
<span id="cb473-130"><a href="get-data.html#cb473-130" aria-hidden="true" tabindex="-1"></a>    ncpath <span class="ot">&lt;-</span> <span class="fu">paste0</span>(nczippath, unzipfolder)</span>
<span id="cb473-131"><a href="get-data.html#cb473-131" aria-hidden="true" tabindex="-1"></a>    ls_sfls <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path=</span>ncpath, <span class="at">recursive=</span><span class="cn">TRUE</span>, <span class="at">pattern=</span><span class="st">&quot;.nc&quot;</span>, <span class="at">full.names=</span>T)</span>
<span id="cb473-132"><a href="get-data.html#cb473-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-133"><a href="get-data.html#cb473-133" aria-hidden="true" tabindex="-1"></a>    <span class="do">#################################################</span></span>
<span id="cb473-134"><a href="get-data.html#cb473-134" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ------------ Combine individual NC files to JOINT Dataframe</span></span>
<span id="cb473-135"><a href="get-data.html#cb473-135" aria-hidden="true" tabindex="-1"></a>    <span class="do">#################################################</span></span>
<span id="cb473-136"><a href="get-data.html#cb473-136" aria-hidden="true" tabindex="-1"></a>    <span class="co"># List to gather dataframes</span></span>
<span id="cb473-137"><a href="get-data.html#cb473-137" aria-hidden="true" tabindex="-1"></a>    ls_df <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;list&quot;</span>, <span class="at">length =</span> <span class="fu">length</span>(ls_sfls))</span>
<span id="cb473-138"><a href="get-data.html#cb473-138" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over files and convert nc to csv</span></span>
<span id="cb473-139"><a href="get-data.html#cb473-139" aria-hidden="true" tabindex="-1"></a>    it_df_ctr <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb473-140"><a href="get-data.html#cb473-140" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (spt_file <span class="cf">in</span> ls_sfls) {</span>
<span id="cb473-141"><a href="get-data.html#cb473-141" aria-hidden="true" tabindex="-1"></a>      it_df_ctr <span class="ot">&lt;-</span> it_df_ctr <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb473-142"><a href="get-data.html#cb473-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-143"><a href="get-data.html#cb473-143" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Get file name without Path</span></span>
<span id="cb473-144"><a href="get-data.html#cb473-144" aria-hidden="true" tabindex="-1"></a>      snm_file_date <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="fu">paste0</span>(<span class="st">&#39;</span><span class="sc">\\</span><span class="st">&#39;</span>,st_nc_suffix,<span class="st">&#39;$&#39;</span>), <span class="st">&#39;&#39;</span>, <span class="fu">basename</span>(spt_file))</span>
<span id="cb473-145"><a href="get-data.html#cb473-145" aria-hidden="true" tabindex="-1"></a>      snm_file_date <span class="ot">&lt;-</span> <span class="fu">sub</span>(st_nc_prefix, <span class="st">&#39;&#39;</span>, <span class="fu">basename</span>(snm_file_date))</span>
<span id="cb473-146"><a href="get-data.html#cb473-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-147"><a href="get-data.html#cb473-147" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Dates Start and End: list.files is auto sorted in ascending order</span></span>
<span id="cb473-148"><a href="get-data.html#cb473-148" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (it_df_ctr <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb473-149"><a href="get-data.html#cb473-149" aria-hidden="true" tabindex="-1"></a>        snm_start_date <span class="ot">&lt;-</span> snm_file_date</span>
<span id="cb473-150"><a href="get-data.html#cb473-150" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb473-151"><a href="get-data.html#cb473-151" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> {</span>
<span id="cb473-152"><a href="get-data.html#cb473-152" aria-hidden="true" tabindex="-1"></a>        <span class="co"># this will give the final date</span></span>
<span id="cb473-153"><a href="get-data.html#cb473-153" aria-hidden="true" tabindex="-1"></a>        snm_end_date <span class="ot">&lt;-</span> snm_file_date</span>
<span id="cb473-154"><a href="get-data.html#cb473-154" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb473-155"><a href="get-data.html#cb473-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-156"><a href="get-data.html#cb473-156" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Given this structure: ECMWF_utci_20100702_v1.0_con, sub out prefix and suffix</span></span>
<span id="cb473-157"><a href="get-data.html#cb473-157" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(spt_file)</span>
<span id="cb473-158"><a href="get-data.html#cb473-158" aria-hidden="true" tabindex="-1"></a>      ncin <span class="ot">&lt;-</span> <span class="fu">nc_open</span>(spt_file)</span>
<span id="cb473-159"><a href="get-data.html#cb473-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-160"><a href="get-data.html#cb473-160" aria-hidden="true" tabindex="-1"></a>      nchist <span class="ot">&lt;-</span> <span class="fu">ncatt_get</span>(ncin, <span class="dv">0</span>, <span class="st">&quot;history&quot;</span>)</span>
<span id="cb473-161"><a href="get-data.html#cb473-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-162"><a href="get-data.html#cb473-162" aria-hidden="true" tabindex="-1"></a>      <span class="co"># not using this missing value flag at the moment</span></span>
<span id="cb473-163"><a href="get-data.html#cb473-163" aria-hidden="true" tabindex="-1"></a>      missingval <span class="ot">&lt;-</span> <span class="fu">str_match</span>(nchist<span class="sc">$</span>value, <span class="st">&quot;setmisstoc,</span><span class="sc">\\</span><span class="st">s*(.*?)</span><span class="sc">\\</span><span class="st">s* &quot;</span>)[,<span class="dv">2</span>]</span>
<span id="cb473-164"><a href="get-data.html#cb473-164" aria-hidden="true" tabindex="-1"></a>      missingval <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(missingval)</span>
<span id="cb473-165"><a href="get-data.html#cb473-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-166"><a href="get-data.html#cb473-166" aria-hidden="true" tabindex="-1"></a>      lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(ncin, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb473-167"><a href="get-data.html#cb473-167" aria-hidden="true" tabindex="-1"></a>      lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(ncin, <span class="st">&quot;lat&quot;</span>)</span>
<span id="cb473-168"><a href="get-data.html#cb473-168" aria-hidden="true" tabindex="-1"></a>      tim <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(ncin, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb473-169"><a href="get-data.html#cb473-169" aria-hidden="true" tabindex="-1"></a>      tunits <span class="ot">&lt;-</span> <span class="fu">ncatt_get</span>(ncin, <span class="st">&quot;time&quot;</span>, <span class="st">&quot;units&quot;</span>)</span>
<span id="cb473-170"><a href="get-data.html#cb473-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-171"><a href="get-data.html#cb473-171" aria-hidden="true" tabindex="-1"></a>      nlon <span class="ot">&lt;-</span> <span class="fu">dim</span>(lon)</span>
<span id="cb473-172"><a href="get-data.html#cb473-172" aria-hidden="true" tabindex="-1"></a>      nlat <span class="ot">&lt;-</span> <span class="fu">dim</span>(lat)</span>
<span id="cb473-173"><a href="get-data.html#cb473-173" aria-hidden="true" tabindex="-1"></a>      ntim <span class="ot">&lt;-</span> <span class="fu">dim</span>(tim)</span>
<span id="cb473-174"><a href="get-data.html#cb473-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-175"><a href="get-data.html#cb473-175" aria-hidden="true" tabindex="-1"></a>      <span class="co"># convert time -- split the time units string into fields</span></span>
<span id="cb473-176"><a href="get-data.html#cb473-176" aria-hidden="true" tabindex="-1"></a>      <span class="co"># tustr &lt;- strsplit(tunits$value, &quot; &quot;)</span></span>
<span id="cb473-177"><a href="get-data.html#cb473-177" aria-hidden="true" tabindex="-1"></a>      <span class="co"># tdstr &lt;- strsplit(unlist(tustr)[3], &quot;-&quot;)</span></span>
<span id="cb473-178"><a href="get-data.html#cb473-178" aria-hidden="true" tabindex="-1"></a>      <span class="co"># tmonth &lt;- as.integer(unlist(tdstr)[2])</span></span>
<span id="cb473-179"><a href="get-data.html#cb473-179" aria-hidden="true" tabindex="-1"></a>      <span class="co"># tday &lt;- as.integer(unlist(tdstr)[3])</span></span>
<span id="cb473-180"><a href="get-data.html#cb473-180" aria-hidden="true" tabindex="-1"></a>      <span class="co"># tyear &lt;- as.integer(unlist(tdstr)[1])</span></span>
<span id="cb473-181"><a href="get-data.html#cb473-181" aria-hidden="true" tabindex="-1"></a>      <span class="co"># mytim &lt;- chron(tim, origin = c(tmonth, tday, tyear))</span></span>
<span id="cb473-182"><a href="get-data.html#cb473-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-183"><a href="get-data.html#cb473-183" aria-hidden="true" tabindex="-1"></a>      tmp_array <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(ncin, <span class="st">&quot;utci&quot;</span>)</span>
<span id="cb473-184"><a href="get-data.html#cb473-184" aria-hidden="true" tabindex="-1"></a>      tmp_array <span class="ot">&lt;-</span> tmp_array <span class="sc">-</span> <span class="fl">273.15</span></span>
<span id="cb473-185"><a href="get-data.html#cb473-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-186"><a href="get-data.html#cb473-186" aria-hidden="true" tabindex="-1"></a>      lonlat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">expand.grid</span>(<span class="at">lon =</span> lon, <span class="at">lat =</span> lat, <span class="at">hours =</span> tim))</span>
<span id="cb473-187"><a href="get-data.html#cb473-187" aria-hidden="true" tabindex="-1"></a>      temperature <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(tmp_array)</span>
<span id="cb473-188"><a href="get-data.html#cb473-188" aria-hidden="true" tabindex="-1"></a>      tmp_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(lonlat, temperature))</span>
<span id="cb473-189"><a href="get-data.html#cb473-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-190"><a href="get-data.html#cb473-190" aria-hidden="true" tabindex="-1"></a>      <span class="co"># extract a rectangle</span></span>
<span id="cb473-191"><a href="get-data.html#cb473-191" aria-hidden="true" tabindex="-1"></a>      eps <span class="ot">&lt;-</span> <span class="fl">1e-8</span></span>
<span id="cb473-192"><a href="get-data.html#cb473-192" aria-hidden="true" tabindex="-1"></a>      minlat <span class="ot">&lt;-</span> <span class="fl">22.25</span> <span class="sc">-</span> eps</span>
<span id="cb473-193"><a href="get-data.html#cb473-193" aria-hidden="true" tabindex="-1"></a>      maxlat <span class="ot">&lt;-</span> <span class="fl">23.50</span> <span class="sc">+</span> eps</span>
<span id="cb473-194"><a href="get-data.html#cb473-194" aria-hidden="true" tabindex="-1"></a>      minlon <span class="ot">&lt;-</span> <span class="fl">113.00</span> <span class="sc">-</span> eps</span>
<span id="cb473-195"><a href="get-data.html#cb473-195" aria-hidden="true" tabindex="-1"></a>      maxlon <span class="ot">&lt;-</span> <span class="fl">114.50</span> <span class="sc">+</span> eps</span>
<span id="cb473-196"><a href="get-data.html#cb473-196" aria-hidden="true" tabindex="-1"></a>      <span class="co"># subset data</span></span>
<span id="cb473-197"><a href="get-data.html#cb473-197" aria-hidden="true" tabindex="-1"></a>      subset_df <span class="ot">&lt;-</span> tmp_df[tmp_df<span class="sc">$</span>lat <span class="sc">&gt;=</span> minlat <span class="sc">&amp;</span> tmp_df<span class="sc">$</span>lat <span class="sc">&lt;=</span> maxlat <span class="sc">&amp;</span></span>
<span id="cb473-198"><a href="get-data.html#cb473-198" aria-hidden="true" tabindex="-1"></a>                            tmp_df<span class="sc">$</span>lon <span class="sc">&gt;=</span> minlon <span class="sc">&amp;</span> tmp_df<span class="sc">$</span>lon <span class="sc">&lt;=</span> maxlon, ]</span>
<span id="cb473-199"><a href="get-data.html#cb473-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-200"><a href="get-data.html#cb473-200" aria-hidden="true" tabindex="-1"></a>      <span class="co"># add Date</span></span>
<span id="cb473-201"><a href="get-data.html#cb473-201" aria-hidden="true" tabindex="-1"></a>      subset_df_date <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(subset_df) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">date =</span> snm_file_date)</span>
<span id="cb473-202"><a href="get-data.html#cb473-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-203"><a href="get-data.html#cb473-203" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Add to list</span></span>
<span id="cb473-204"><a href="get-data.html#cb473-204" aria-hidden="true" tabindex="-1"></a>      ls_df[[it_df_ctr]] <span class="ot">&lt;-</span> subset_df_date</span>
<span id="cb473-205"><a href="get-data.html#cb473-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-206"><a href="get-data.html#cb473-206" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Close NC</span></span>
<span id="cb473-207"><a href="get-data.html#cb473-207" aria-hidden="true" tabindex="-1"></a>      <span class="fu">nc_close</span>(ncin)</span>
<span id="cb473-208"><a href="get-data.html#cb473-208" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb473-209"><a href="get-data.html#cb473-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-210"><a href="get-data.html#cb473-210" aria-hidden="true" tabindex="-1"></a>    <span class="co"># List of DF to one DF</span></span>
<span id="cb473-211"><a href="get-data.html#cb473-211" aria-hidden="true" tabindex="-1"></a>    df_all_nc <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, ls_df)</span>
<span id="cb473-212"><a href="get-data.html#cb473-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-213"><a href="get-data.html#cb473-213" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save File</span></span>
<span id="cb473-214"><a href="get-data.html#cb473-214" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">paste0</span>(st_nc_prefix,</span>
<span id="cb473-215"><a href="get-data.html#cb473-215" aria-hidden="true" tabindex="-1"></a>                           snm_start_date, <span class="st">&quot;_to_&quot;</span>, snm_end_date,</span>
<span id="cb473-216"><a href="get-data.html#cb473-216" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;.csv&quot;</span>))</span>
<span id="cb473-217"><a href="get-data.html#cb473-217" aria-hidden="true" tabindex="-1"></a>    csvfile <span class="ot">&lt;-</span> <span class="fu">paste0</span>(csvpath, fname)</span>
<span id="cb473-218"><a href="get-data.html#cb473-218" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write.table</span>(<span class="fu">na.omit</span>(df_all_nc), csvfile, <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb473-219"><a href="get-data.html#cb473-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-220"><a href="get-data.html#cb473-220" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Delete folders</span></span>
<span id="cb473-221"><a href="get-data.html#cb473-221" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unlink</span>(spn_zip, <span class="at">recursive=</span><span class="cn">TRUE</span>, <span class="at">force=</span><span class="cn">TRUE</span>)</span>
<span id="cb473-222"><a href="get-data.html#cb473-222" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unlink</span>(spn_unzip_folder, <span class="at">recursive=</span><span class="cn">TRUE</span>, <span class="at">force=</span><span class="cn">TRUE</span>)</span>
<span id="cb473-223"><a href="get-data.html#cb473-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-224"><a href="get-data.html#cb473-224" aria-hidden="true" tabindex="-1"></a>  <span class="co"># end loop months groups</span></span>
<span id="cb473-225"><a href="get-data.html#cb473-225" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb473-226"><a href="get-data.html#cb473-226" aria-hidden="true" tabindex="-1"></a><span class="co"># end loop year</span></span>
<span id="cb473-227"><a href="get-data.html#cb473-227" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="tables-and-graphs.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="code-and-development.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": [["Panel-Data-and-Optimization-with-R.pdf", "PDF"]],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
