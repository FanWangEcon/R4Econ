<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 11 Get Data | Data Structures, Estimation and Optimization with R</title>
  <meta name="description" content="Running parallel code in R" />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 11 Get Data | Data Structures, Estimation and Optimization with R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Running parallel code in R" />
  <meta name="github-repo" content="fanwangecon/R4Econ" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 11 Get Data | Data Structures, Estimation and Optimization with R" />
  
  <meta name="twitter:description" content="Running parallel code in R" />
  

<meta name="author" content="Fan Wang" />


<meta name="date" content="2024-01-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="tables-and-graphs.html"/>
<link rel="next" href="coding-and-development.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-92953468-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-92953468-5');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Structures and Estimation with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html"><i class="fa fa-check"></i><b>1</b> Array, Matrix, Dataframe</a>
<ul>
<li class="chapter" data-level="1.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#list"><i class="fa fa-check"></i><b>1.1</b> List</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#lists"><i class="fa fa-check"></i><b>1.1.1</b> Lists</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#array"><i class="fa fa-check"></i><b>1.2</b> Array</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#array-basics"><i class="fa fa-check"></i><b>1.2.1</b> Array Basics</a></li>
<li class="chapter" data-level="1.2.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-arrays"><i class="fa fa-check"></i><b>1.2.2</b> Generate Arrays</a></li>
<li class="chapter" data-level="1.2.3" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#string-arrays"><i class="fa fa-check"></i><b>1.2.3</b> String Arrays</a></li>
<li class="chapter" data-level="1.2.4" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#mesh-matrices-arrays-and-scalars"><i class="fa fa-check"></i><b>1.2.4</b> Mesh Matrices, Arrays and Scalars</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#matrix"><i class="fa fa-check"></i><b>1.3</b> Matrix</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-matrixes"><i class="fa fa-check"></i><b>1.3.1</b> Generate Matrixes</a></li>
<li class="chapter" data-level="1.3.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#linear-algebra"><i class="fa fa-check"></i><b>1.3.2</b> Linear Algebra</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#regular-expression-date-etc."><i class="fa fa-check"></i><b>1.4</b> Regular Expression, Date, etc.</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#string-regular-expression"><i class="fa fa-check"></i><b>1.4.1</b> String Regular Expression</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html"><i class="fa fa-check"></i><b>2</b> Manipulate and Summarize Dataframes</a>
<ul>
<li class="chapter" data-level="2.1" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#variables-in-dataframes"><i class="fa fa-check"></i><b>2.1</b> Variables in Dataframes</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#generate-dataframe"><i class="fa fa-check"></i><b>2.1.1</b> Generate Dataframe</a></li>
<li class="chapter" data-level="2.1.2" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#generate-categorical-variables"><i class="fa fa-check"></i><b>2.1.2</b> Generate Categorical Variables</a></li>
<li class="chapter" data-level="2.1.3" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#drawly-random-rows"><i class="fa fa-check"></i><b>2.1.3</b> Drawly Random Rows</a></li>
<li class="chapter" data-level="2.1.4" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#generate-variables-conditional-on-others"><i class="fa fa-check"></i><b>2.1.4</b> Generate Variables Conditional On Others</a></li>
<li class="chapter" data-level="2.1.5" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#string-dataframes"><i class="fa fa-check"></i><b>2.1.5</b> String Dataframes</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#counting-observation"><i class="fa fa-check"></i><b>2.2</b> Counting Observation</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#counting-and-tabulations"><i class="fa fa-check"></i><b>2.2.1</b> Counting and Tabulations</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#sorting-indexing-slicing"><i class="fa fa-check"></i><b>2.3</b> Sorting, Indexing, Slicing</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#sorting-1"><i class="fa fa-check"></i><b>2.3.1</b> Sorting</a></li>
<li class="chapter" data-level="2.3.2" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#group-sort-and-slice"><i class="fa fa-check"></i><b>2.3.2</b> Group, Sort and Slice</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#advanced-group-aggregation"><i class="fa fa-check"></i><b>2.4</b> Advanced Group Aggregation</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#cumulative-statistics-within-group"><i class="fa fa-check"></i><b>2.4.1</b> Cumulative Statistics within Group</a></li>
<li class="chapter" data-level="2.4.2" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#groups-statistics"><i class="fa fa-check"></i><b>2.4.2</b> Groups Statistics</a></li>
<li class="chapter" data-level="2.4.3" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#one-variable-group-summary"><i class="fa fa-check"></i><b>2.4.3</b> One Variable Group Summary</a></li>
<li class="chapter" data-level="2.4.4" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#nested-within-group-stats"><i class="fa fa-check"></i><b>2.4.4</b> Nested within Group Stats</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#distributional-statistics"><i class="fa fa-check"></i><b>2.5</b> Distributional Statistics</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#histogram"><i class="fa fa-check"></i><b>2.5.1</b> Histogram</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#summarize-multiple-variables"><i class="fa fa-check"></i><b>2.6</b> Summarize Multiple Variables</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#apply-function-over-multiple-columns-and-rows"><i class="fa fa-check"></i><b>2.6.1</b> Apply Function Over Multiple Columns and Rows</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>3</b> Functions</a>
<ul>
<li class="chapter" data-level="3.1" data-path="functions.html"><a href="functions.html#dataframe-mutate"><i class="fa fa-check"></i><b>3.1</b> Dataframe Mutate</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="functions.html"><a href="functions.html#row-input-functions"><i class="fa fa-check"></i><b>3.1.1</b> Row Input Functions</a></li>
<li class="chapter" data-level="3.1.2" data-path="functions.html"><a href="functions.html#evaluate-choices-across-states"><i class="fa fa-check"></i><b>3.1.2</b> Evaluate Choices Across States</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="functions.html"><a href="functions.html#dataframe-do-anything"><i class="fa fa-check"></i><b>3.2</b> Dataframe Do Anything</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="functions.html"><a href="functions.html#mx1-by-n-to-mxq-by-n1"><i class="fa fa-check"></i><b>3.2.1</b> (Mx1 by N) to (MxQ by N+1)</a></li>
<li class="chapter" data-level="3.2.2" data-path="functions.html"><a href="functions.html#mxp-by-n-to-mx1-by-1"><i class="fa fa-check"></i><b>3.2.2</b> (MxP by N) to (Mx1 by 1)</a></li>
<li class="chapter" data-level="3.2.3" data-path="functions.html"><a href="functions.html#mxp-by-n-to-mxq-by-nz"><i class="fa fa-check"></i><b>3.2.3</b> (MxP by N) to (MxQ by N+Z)</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="functions.html"><a href="functions.html#apply-and-pmap"><i class="fa fa-check"></i><b>3.3</b> Apply and pmap</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="functions.html"><a href="functions.html#apply-and-sapply"><i class="fa fa-check"></i><b>3.3.1</b> Apply and Sapply</a></li>
<li class="chapter" data-level="3.3.2" data-path="functions.html"><a href="functions.html#mutate-evaluate-functions"><i class="fa fa-check"></i><b>3.3.2</b> Mutate Evaluate Functions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html"><i class="fa fa-check"></i><b>4</b> Multi-dimensional Data Structures</a>
<ul>
<li class="chapter" data-level="4.1" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#generate-gather-bind-and-join"><i class="fa fa-check"></i><b>4.1</b> Generate, Gather, Bind and Join</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#generate-panel-structure"><i class="fa fa-check"></i><b>4.1.1</b> Generate Panel Structure</a></li>
<li class="chapter" data-level="4.1.2" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#join-datasets"><i class="fa fa-check"></i><b>4.1.2</b> Join Datasets</a></li>
<li class="chapter" data-level="4.1.3" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#gather-files"><i class="fa fa-check"></i><b>4.1.3</b> Gather Files</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#wide-and-long"><i class="fa fa-check"></i><b>4.2</b> Wide and Long</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#long-table-to-wide-table"><i class="fa fa-check"></i><b>4.2.1</b> Long Table to Wide Table</a></li>
<li class="chapter" data-level="4.2.2" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#wide-to-long"><i class="fa fa-check"></i><b>4.2.2</b> Wide to Long</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#within-panel-comparisons-and-statistics"><i class="fa fa-check"></i><b>4.3</b> Within Panel Comparisons and Statistics</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#find-closest-neighbor-on-grid"><i class="fa fa-check"></i><b>4.3.1</b> Find Closest Neighbor on Grid</a></li>
<li class="chapter" data-level="4.3.2" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#within-panel-cross-time-and-cross-group-statistics"><i class="fa fa-check"></i><b>4.3.2</b> Within Panel Cross-time and Cross-group Statistics</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#join-and-merge-files-together-by-keys"><i class="fa fa-check"></i><b>4.4</b> Join and Merge Files Together by Keys</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#mesh-join"><i class="fa fa-check"></i><b>4.4.1</b> Mesh Join</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i><b>5</b> Linear Regression</a>
<ul>
<li class="chapter" data-level="5.1" data-path="linear-regression.html"><a href="linear-regression.html#linear-and-polynomial-fitting"><i class="fa fa-check"></i><b>5.1</b> Linear and Polynomial Fitting</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="linear-regression.html"><a href="linear-regression.html#fit-curves-through-points"><i class="fa fa-check"></i><b>5.1.1</b> Fit Curves Through Points</a></li>
<li class="chapter" data-level="5.1.2" data-path="linear-regression.html"><a href="linear-regression.html#polynomial-time-series"><i class="fa fa-check"></i><b>5.1.2</b> Polynomial Time Series</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="linear-regression.html"><a href="linear-regression.html#ols-and-iv"><i class="fa fa-check"></i><b>5.2</b> OLS and IV</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="linear-regression.html"><a href="linear-regression.html#ols-and-iv-regression"><i class="fa fa-check"></i><b>5.2.1</b> OLS and IV Regression</a></li>
<li class="chapter" data-level="5.2.2" data-path="linear-regression.html"><a href="linear-regression.html#iv-loop-over-rhs"><i class="fa fa-check"></i><b>5.2.2</b> IV Loop over RHS</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="linear-regression.html"><a href="linear-regression.html#decomposition"><i class="fa fa-check"></i><b>5.3</b> Decomposition</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="linear-regression.html"><a href="linear-regression.html#decompose-rhs"><i class="fa fa-check"></i><b>5.3.1</b> Decompose RHS</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html"><i class="fa fa-check"></i><b>6</b> Nonlinear and Other Regressions</a>
<ul>
<li class="chapter" data-level="6.1" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html#logit-regression"><i class="fa fa-check"></i><b>6.1</b> Logit Regression</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html#binary-logit"><i class="fa fa-check"></i><b>6.1.1</b> Binary Logit</a></li>
<li class="chapter" data-level="6.1.2" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html#logistic-choice-model-with-aggregate-shares"><i class="fa fa-check"></i><b>6.1.2</b> Logistic Choice Model with Aggregate Shares</a></li>
<li class="chapter" data-level="6.1.3" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html#prices-from-aggregate-shares-in-logistic-choice-model"><i class="fa fa-check"></i><b>6.1.3</b> Prices from Aggregate Shares in Logistic Choice Model</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html#quantile-regression"><i class="fa fa-check"></i><b>6.2</b> Quantile Regression</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html#quantile-regression-basics"><i class="fa fa-check"></i><b>6.2.1</b> Quantile Regression Basics</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="optimization.html"><a href="optimization.html"><i class="fa fa-check"></i><b>7</b> Optimization</a>
<ul>
<li class="chapter" data-level="7.1" data-path="optimization.html"><a href="optimization.html#grid-based-optimization"><i class="fa fa-check"></i><b>7.1</b> Grid Based Optimization</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="optimization.html"><a href="optimization.html#find-maximum-by-iterating-over-grids"><i class="fa fa-check"></i><b>7.1.1</b> Find Maximum By Iterating Over Grids</a></li>
<li class="chapter" data-level="7.1.2" data-path="optimization.html"><a href="optimization.html#bisection"><i class="fa fa-check"></i><b>7.1.2</b> Bisection</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="mathematics.html"><a href="mathematics.html"><i class="fa fa-check"></i><b>8</b> Mathematics</a>
<ul>
<li class="chapter" data-level="8.1" data-path="mathematics.html"><a href="mathematics.html#basics"><i class="fa fa-check"></i><b>8.1</b> Basics</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="mathematics.html"><a href="mathematics.html#polynomial-formulas-for-points"><i class="fa fa-check"></i><b>8.1.1</b> Polynomial Formulas for Points</a></li>
<li class="chapter" data-level="8.1.2" data-path="mathematics.html"><a href="mathematics.html#rescale-a-parameter-with-fixed-min-and-max"><i class="fa fa-check"></i><b>8.1.2</b> Rescale a Parameter with Fixed Min and Max</a></li>
<li class="chapter" data-level="8.1.3" data-path="mathematics.html"><a href="mathematics.html#log-with-different-bases-and-exponents"><i class="fa fa-check"></i><b>8.1.3</b> Log with Different Bases and Exponents</a></li>
<li class="chapter" data-level="8.1.4" data-path="mathematics.html"><a href="mathematics.html#find-nearest"><i class="fa fa-check"></i><b>8.1.4</b> Find Nearest</a></li>
<li class="chapter" data-level="8.1.5" data-path="mathematics.html"><a href="mathematics.html#linear-scalar-fx0-solutions"><i class="fa fa-check"></i><b>8.1.5</b> Linear Scalar f(x)=0 Solutions</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="mathematics.html"><a href="mathematics.html#production-functions"><i class="fa fa-check"></i><b>8.2</b> Production Functions</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="mathematics.html"><a href="mathematics.html#nested-ces-production-function"><i class="fa fa-check"></i><b>8.2.1</b> Nested CES Production Function</a></li>
<li class="chapter" data-level="8.2.2" data-path="mathematics.html"><a href="mathematics.html#latent-dynamic-health-production-function"><i class="fa fa-check"></i><b>8.2.2</b> Latent Dynamic Health Production Function</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="mathematics.html"><a href="mathematics.html#inequality-models"><i class="fa fa-check"></i><b>8.3</b> Inequality Models</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="mathematics.html"><a href="mathematics.html#gini-discrete-sample"><i class="fa fa-check"></i><b>8.3.1</b> GINI Discrete Sample</a></li>
<li class="chapter" data-level="8.3.2" data-path="mathematics.html"><a href="mathematics.html#gini-formula-for-discrete-random-varialbe"><i class="fa fa-check"></i><b>8.3.2</b> GINI Formula for Discrete Random Varialbe</a></li>
<li class="chapter" data-level="8.3.3" data-path="mathematics.html"><a href="mathematics.html#atkinson-inequality-index"><i class="fa fa-check"></i><b>8.3.3</b> Atkinson Inequality Index</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="statistics.html"><a href="statistics.html"><i class="fa fa-check"></i><b>9</b> Statistics</a>
<ul>
<li class="chapter" data-level="9.1" data-path="statistics.html"><a href="statistics.html#random-draws"><i class="fa fa-check"></i><b>9.1</b> Random Draws</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="statistics.html"><a href="statistics.html#randomly-perturbing-a-parameter"><i class="fa fa-check"></i><b>9.1.1</b> Randomly Perturbing a Parameter</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="statistics.html"><a href="statistics.html#distributions"><i class="fa fa-check"></i><b>9.2</b> Distributions</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="statistics.html"><a href="statistics.html#integrate-over-normal-guassian-process-shock"><i class="fa fa-check"></i><b>9.2.1</b> Integrate Over Normal Guassian Process Shock</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="statistics.html"><a href="statistics.html#discrete-random-variable"><i class="fa fa-check"></i><b>9.3</b> Discrete Random Variable</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="statistics.html"><a href="statistics.html#discrete-approximation-of-continuous-random-variables"><i class="fa fa-check"></i><b>9.3.1</b> Discrete Approximation of Continuous Random Variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html"><i class="fa fa-check"></i><b>10</b> Tables and Graphs</a>
<ul>
<li class="chapter" data-level="10.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#r-base-plots"><i class="fa fa-check"></i><b>10.1</b> R Base Plots</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#plot-curve-line-and-points"><i class="fa fa-check"></i><b>10.1.1</b> Plot Curve, Line and Points</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#ggplot-line-related-plots"><i class="fa fa-check"></i><b>10.2</b> ggplot Line Related Plots</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#ggplot-line-plot-basics"><i class="fa fa-check"></i><b>10.2.1</b> ggplot Line Plot Basics</a></li>
<li class="chapter" data-level="10.2.2" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#ggplot-line-advanced"><i class="fa fa-check"></i><b>10.2.2</b> ggplot Line Advanced</a></li>
<li class="chapter" data-level="10.2.3" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#time-series-plots-with-shaded-areas"><i class="fa fa-check"></i><b>10.2.3</b> Time-series Plots with Shaded Areas</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#ggplot-scatter-related-plots"><i class="fa fa-check"></i><b>10.3</b> ggplot Scatter Related Plots</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#ggplot-scatter-plot"><i class="fa fa-check"></i><b>10.3.1</b> ggplot Scatter Plot</a></li>
<li class="chapter" data-level="10.3.2" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#ggplot-multiple-scatter-lines-with-facet-wrap"><i class="fa fa-check"></i><b>10.3.2</b> ggplot Multiple Scatter-Lines with Facet Wrap</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#write-and-read-plots"><i class="fa fa-check"></i><b>10.4</b> Write and Read Plots</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#import-and-export-images"><i class="fa fa-check"></i><b>10.4.1</b> Import and Export Images</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="get-data.html"><a href="get-data.html"><i class="fa fa-check"></i><b>11</b> Get Data</a>
<ul>
<li class="chapter" data-level="11.1" data-path="get-data.html"><a href="get-data.html#environmental-data"><i class="fa fa-check"></i><b>11.1</b> Environmental Data</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="get-data.html"><a href="get-data.html#ecmwf-era5-data"><i class="fa fa-check"></i><b>11.1.1</b> ECMWF ERA5 Data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="coding-and-development.html"><a href="coding-and-development.html"><i class="fa fa-check"></i><b>12</b> Coding and Development</a>
<ul>
<li class="chapter" data-level="12.1" data-path="coding-and-development.html"><a href="coding-and-development.html#installation-and-packages"><i class="fa fa-check"></i><b>12.1</b> Installation and Packages</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="coding-and-development.html"><a href="coding-and-development.html#r-installation-and-set-up"><i class="fa fa-check"></i><b>12.1.1</b> R Installation and Set-Up</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="coding-and-development.html"><a href="coding-and-development.html#files-in-and-out"><i class="fa fa-check"></i><b>12.2</b> Files In and Out</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="coding-and-development.html"><a href="coding-and-development.html#file-path"><i class="fa fa-check"></i><b>12.2.1</b> File Path</a></li>
<li class="chapter" data-level="12.2.2" data-path="coding-and-development.html"><a href="coding-and-development.html#text-to-file"><i class="fa fa-check"></i><b>12.2.2</b> Text to File</a></li>
<li class="chapter" data-level="12.2.3" data-path="coding-and-development.html"><a href="coding-and-development.html#rmd-to-html"><i class="fa fa-check"></i><b>12.2.3</b> Rmd to HTML</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="coding-and-development.html"><a href="coding-and-development.html#python-with-r"><i class="fa fa-check"></i><b>12.3</b> Python with R</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="coding-and-development.html"><a href="coding-and-development.html#reticulate-basics"><i class="fa fa-check"></i><b>12.3.1</b> Reticulate Basics</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="coding-and-development.html"><a href="coding-and-development.html#command-line"><i class="fa fa-check"></i><b>12.4</b> Command Line</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="coding-and-development.html"><a href="coding-and-development.html#shell-and-system-commands"><i class="fa fa-check"></i><b>12.4.1</b> Shell and System Commands</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="coding-and-development.html"><a href="coding-and-development.html#run-code-in-parallel-in-r"><i class="fa fa-check"></i><b>12.5</b> Run Code in Parallel in R</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="coding-and-development.html"><a href="coding-and-development.html#parallel-loop-in-r"><i class="fa fa-check"></i><b>12.5.1</b> Parallel Loop in R</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="index-and-code-links.html"><a href="index-and-code-links.html"><i class="fa fa-check"></i><b>A</b> Index and Code Links</a>
<ul>
<li class="chapter" data-level="A.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#array-matrix-dataframe-links"><i class="fa fa-check"></i><b>A.1</b> Array, Matrix, Dataframe links</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.1-listlist-links"><i class="fa fa-check"></i><b>A.1.1</b> Section 1.1 List links</a></li>
<li class="chapter" data-level="A.1.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.2-arrayarray-links"><i class="fa fa-check"></i><b>A.1.2</b> Section 1.2 Array links</a></li>
<li class="chapter" data-level="A.1.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.3-matrixmatrix-links"><i class="fa fa-check"></i><b>A.1.3</b> Section 1.3 Matrix links</a></li>
<li class="chapter" data-level="A.1.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.4-regular-expression-date-etc.regular-expression-date-etc.-links"><i class="fa fa-check"></i><b>A.1.4</b> Section 1.4 Regular Expression, Date, etc. links</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#manipulate-and-summarize-dataframes-links"><i class="fa fa-check"></i><b>A.2</b> Manipulate and Summarize Dataframes links</a>
<ul>
<li class="chapter" data-level="A.2.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.1-variables-in-dataframesvariables-in-dataframes-links"><i class="fa fa-check"></i><b>A.2.1</b> Section 2.1 Variables in Dataframes links</a></li>
<li class="chapter" data-level="A.2.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.2-counting-observationcounting-observation-links"><i class="fa fa-check"></i><b>A.2.2</b> Section 2.2 Counting Observation links</a></li>
<li class="chapter" data-level="A.2.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.3-sorting-indexing-slicingsorting-indexing-slicing-links"><i class="fa fa-check"></i><b>A.2.3</b> Section 2.3 Sorting, Indexing, Slicing links</a></li>
<li class="chapter" data-level="A.2.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.4-advanced-group-aggregationadvanced-group-aggregation-links"><i class="fa fa-check"></i><b>A.2.4</b> Section 2.4 Advanced Group Aggregation links</a></li>
<li class="chapter" data-level="A.2.5" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.5-distributional-statisticsdistributional-statistics-links"><i class="fa fa-check"></i><b>A.2.5</b> Section 2.5 Distributional Statistics links</a></li>
<li class="chapter" data-level="A.2.6" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.6-summarize-multiple-variablessummarize-multiple-variables-links"><i class="fa fa-check"></i><b>A.2.6</b> Section 2.6 Summarize Multiple Variables links</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#functions-links"><i class="fa fa-check"></i><b>A.3</b> Functions links</a>
<ul>
<li class="chapter" data-level="A.3.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.1-dataframe-mutatedataframe-mutate-links"><i class="fa fa-check"></i><b>A.3.1</b> Section 3.1 Dataframe Mutate links</a></li>
<li class="chapter" data-level="A.3.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.2-dataframe-do-anythingdataframe-do-anything-links"><i class="fa fa-check"></i><b>A.3.2</b> Section 3.2 Dataframe Do Anything links</a></li>
<li class="chapter" data-level="A.3.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.3-apply-and-pmapapply-and-pmap-links"><i class="fa fa-check"></i><b>A.3.3</b> Section 3.3 Apply and pmap links</a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#multi-dimensional-data-structures-links"><i class="fa fa-check"></i><b>A.4</b> Multi-dimensional Data Structures links</a>
<ul>
<li class="chapter" data-level="A.4.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-4.1-generate-gather-bind-and-joingenerate-gather-bind-and-join-links"><i class="fa fa-check"></i><b>A.4.1</b> Section 4.1 Generate, Gather, Bind and Join links</a></li>
<li class="chapter" data-level="A.4.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-4.2-wide-and-longwide-and-long-links"><i class="fa fa-check"></i><b>A.4.2</b> Section 4.2 Wide and Long links</a></li>
<li class="chapter" data-level="A.4.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-4.3-within-panel-comparisons-and-statisticswithin-panel-comparisons-and-statistics-links"><i class="fa fa-check"></i><b>A.4.3</b> Section 4.3 Within Panel Comparisons and Statistics links</a></li>
<li class="chapter" data-level="A.4.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-4.4-join-and-merge-files-together-by-keysjoin-and-merge-files-together-by-keys-links"><i class="fa fa-check"></i><b>A.4.4</b> Section 4.4 Join and Merge Files Together by Keys links</a></li>
</ul></li>
<li class="chapter" data-level="A.5" data-path="index-and-code-links.html"><a href="index-and-code-links.html#linear-regression-links"><i class="fa fa-check"></i><b>A.5</b> Linear Regression links</a>
<ul>
<li class="chapter" data-level="A.5.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-5.1-linear-and-polynomial-fittinglinear-and-polynomial-fitting-links"><i class="fa fa-check"></i><b>A.5.1</b> Section 5.1 Linear and Polynomial Fitting links</a></li>
<li class="chapter" data-level="A.5.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-5.2-ols-and-ivols-and-iv-links"><i class="fa fa-check"></i><b>A.5.2</b> Section 5.2 OLS and IV links</a></li>
<li class="chapter" data-level="A.5.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-5.3-decompositiondecomposition-links"><i class="fa fa-check"></i><b>A.5.3</b> Section 5.3 Decomposition links</a></li>
</ul></li>
<li class="chapter" data-level="A.6" data-path="index-and-code-links.html"><a href="index-and-code-links.html#nonlinear-and-other-regressions-links"><i class="fa fa-check"></i><b>A.6</b> Nonlinear and Other Regressions links</a>
<ul>
<li class="chapter" data-level="A.6.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-6.1-logit-regressionlogit-regression-links"><i class="fa fa-check"></i><b>A.6.1</b> Section 6.1 Logit Regression links</a></li>
<li class="chapter" data-level="A.6.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-6.2-quantile-regressionquantile-regression-links"><i class="fa fa-check"></i><b>A.6.2</b> Section 6.2 Quantile Regression links</a></li>
</ul></li>
<li class="chapter" data-level="A.7" data-path="index-and-code-links.html"><a href="index-and-code-links.html#optimization-links"><i class="fa fa-check"></i><b>A.7</b> Optimization links</a>
<ul>
<li class="chapter" data-level="A.7.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-7.1-grid-based-optimizationgrid-based-optimization-links"><i class="fa fa-check"></i><b>A.7.1</b> Section 7.1 Grid Based Optimization links</a></li>
</ul></li>
<li class="chapter" data-level="A.8" data-path="index-and-code-links.html"><a href="index-and-code-links.html#mathematics-links"><i class="fa fa-check"></i><b>A.8</b> Mathematics links</a>
<ul>
<li class="chapter" data-level="A.8.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-8.1-basicsbasics-links"><i class="fa fa-check"></i><b>A.8.1</b> Section 8.1 Basics links</a></li>
<li class="chapter" data-level="A.8.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-8.2-production-functionsproduction-functions-links"><i class="fa fa-check"></i><b>A.8.2</b> Section 8.2 Production Functions links</a></li>
<li class="chapter" data-level="A.8.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-8.3-inequality-modelsinequality-models-links"><i class="fa fa-check"></i><b>A.8.3</b> Section 8.3 Inequality Models links</a></li>
</ul></li>
<li class="chapter" data-level="A.9" data-path="index-and-code-links.html"><a href="index-and-code-links.html#statistics-links"><i class="fa fa-check"></i><b>A.9</b> Statistics links</a>
<ul>
<li class="chapter" data-level="A.9.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-9.1-random-drawsrandom-draws-links"><i class="fa fa-check"></i><b>A.9.1</b> Section 9.1 Random Draws links</a></li>
<li class="chapter" data-level="A.9.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-9.2-distributionsdistributions-links"><i class="fa fa-check"></i><b>A.9.2</b> Section 9.2 Distributions links</a></li>
<li class="chapter" data-level="A.9.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-9.3-discrete-random-variablediscrete-random-variable-links"><i class="fa fa-check"></i><b>A.9.3</b> Section 9.3 Discrete Random Variable links</a></li>
</ul></li>
<li class="chapter" data-level="A.10" data-path="index-and-code-links.html"><a href="index-and-code-links.html#tables-and-graphs-links"><i class="fa fa-check"></i><b>A.10</b> Tables and Graphs links</a>
<ul>
<li class="chapter" data-level="A.10.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-10.1-r-base-plotsr-base-plots-links"><i class="fa fa-check"></i><b>A.10.1</b> Section 10.1 R Base Plots links</a></li>
<li class="chapter" data-level="A.10.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-10.2-ggplot-line-related-plotsggplot-line-related-plots-links"><i class="fa fa-check"></i><b>A.10.2</b> Section 10.2 ggplot Line Related Plots links</a></li>
<li class="chapter" data-level="A.10.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-10.3-ggplot-scatter-related-plotsggplot-scatter-related-plots-links"><i class="fa fa-check"></i><b>A.10.3</b> Section 10.3 ggplot Scatter Related Plots links</a></li>
<li class="chapter" data-level="A.10.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-10.4-write-and-read-plotswrite-and-read-plots-links"><i class="fa fa-check"></i><b>A.10.4</b> Section 10.4 Write and Read Plots links</a></li>
</ul></li>
<li class="chapter" data-level="A.11" data-path="index-and-code-links.html"><a href="index-and-code-links.html#get-data-links"><i class="fa fa-check"></i><b>A.11</b> Get Data links</a>
<ul>
<li class="chapter" data-level="A.11.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-11.1-environmental-dataenvironmental-data-links"><i class="fa fa-check"></i><b>A.11.1</b> Section 11.1 Environmental Data links</a></li>
</ul></li>
<li class="chapter" data-level="A.12" data-path="index-and-code-links.html"><a href="index-and-code-links.html#coding-and-development-links"><i class="fa fa-check"></i><b>A.12</b> Coding and Development links</a>
<ul>
<li class="chapter" data-level="A.12.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-12.1-installation-and-packagesinstallation-and-packages-links"><i class="fa fa-check"></i><b>A.12.1</b> Section 12.1 Installation and Packages links</a></li>
<li class="chapter" data-level="A.12.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-12.2-files-in-and-outfiles-in-and-out-links"><i class="fa fa-check"></i><b>A.12.2</b> Section 12.2 Files In and Out links</a></li>
<li class="chapter" data-level="A.12.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-12.3-python-with-rpython-with-r-links"><i class="fa fa-check"></i><b>A.12.3</b> Section 12.3 Python with R links</a></li>
<li class="chapter" data-level="A.12.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-12.4-command-linecommand-line-links"><i class="fa fa-check"></i><b>A.12.4</b> Section 12.4 Command Line links</a></li>
<li class="chapter" data-level="A.12.5" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-12.5-run-code-in-parallel-in-rrun-code-in-parallel-in-r-links"><i class="fa fa-check"></i><b>A.12.5</b> Section 12.5 Run Code in Parallel in R links</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://fanwangecon.github.io/R4Econ/bookdown/index.html" target="blank">R4Econ Bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Structures, Estimation and Optimization with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="get-data" class="section level1 hasAnchor" number="11">
<h1><span class="header-section-number">Chapter 11</span> Get Data<a href="get-data.html#get-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>

<div id="environmental-data" class="section level2 hasAnchor" number="11.1">
<h2><span class="header-section-number">11.1</span> Environmental Data<a href="get-data.html#environmental-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>

<div id="ecmwf-era5-data" class="section level3 hasAnchor" number="11.1.1">
<h3><span class="header-section-number">11.1.1</span> ECMWF ERA5 Data<a href="get-data.html#ecmwf-era5-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> research support package, <a href="https://fanwangecon.github.io/R4Econ/">R4Econ</a> examples page, <a href="https://fanwangecon.github.io/PkgTestR/">PkgTestR</a> packaging guide, or <a href="https://fanwangecon.github.io/Stat4Econ/">Stat4Econ</a> course page.</p>
</blockquote>
<p>This files uses R with the reticulate package to download ECMWF ERA5 data. See <a href="https://fanwangecon.github.io/pyfan/vig/getdata/envir/htmlpdfr/fs_ecmwf.html">this file</a> for instructions and tutorials for downloading the data.</p>
<div id="program-to-download-unzip-convert-to-combined-csv-derived-utci-historical-data" class="section level4 hasAnchor" number="11.1.1.1">
<h4><span class="header-section-number">11.1.1.1</span> Program to Download, Unzip, Convert to combined CSV, derived-utci-historical data<a href="get-data.html#program-to-download-unzip-convert-to-combined-csv-derived-utci-historical-data" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The data downloaded from CDS climate could become very large in size. We want to process parts of the data one part at a time, summarize and aggregate over each part, and generate a file output file with aggregate statistics over the entire time period of interest.</p>
<p>This code below accompalishes the following tasks:</p>
<ol style="list-style-type: decimal">
<li>download data from derived-utci-historical as ZIP</li>
<li>unzip</li>
<li>convert <em>nc</em> files to <em>csv</em> files</li>
<li>individual csv files are half year groups</li>
</ol>
<p>Parameter Control for the code below:</p>
<ol style="list-style-type: decimal">
<li><em>spt_root</em>: root folder where everything will be at</li>
<li><em>spth_conda_env</em>: the conda virtual environment python path, eccodes and cdsapi packages are installed in the conda virtual environment. In the example below, the first env is: wk_ecmwf</li>
<li><em>st_nc_prefix</em>: the downloaded individual nc files have dates and prefix before and after the date string in the nc file names. This is the string before that.</li>
<li><em>st_nc_suffix</em>: see (3), this is the suffix</li>
<li><em>ar_years</em>: array of years to download and aggregate over</li>
<li><em>ar_months_g1</em>: months to download in first half year</li>
<li><em>ar_months_g2</em>: months to download in second half year</li>
</ol>
<p>Note: <em>area</em> below corresponds to <em>North, West, South, East</em>.</p>
<div class="sourceCode" id="cb851"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb851-1"><a href="get-data.html#cb851-1" tabindex="-1"></a><span class="do">#################################################</span></span>
<span id="cb851-2"><a href="get-data.html#cb851-2" tabindex="-1"></a><span class="co"># ------------ Parameters</span></span>
<span id="cb851-3"><a href="get-data.html#cb851-3" tabindex="-1"></a><span class="do">#################################################</span></span>
<span id="cb851-4"><a href="get-data.html#cb851-4" tabindex="-1"></a></span>
<span id="cb851-5"><a href="get-data.html#cb851-5" tabindex="-1"></a><span class="co"># Where to store everything</span></span>
<span id="cb851-6"><a href="get-data.html#cb851-6" tabindex="-1"></a>spt_root <span class="ot">&lt;-</span> <span class="st">&quot;C:/Users/fan/Downloads/_data/&quot;</span></span>
<span id="cb851-7"><a href="get-data.html#cb851-7" tabindex="-1"></a>spth_conda_env <span class="ot">&lt;-</span> <span class="st">&quot;C:/ProgramData/Anaconda3/envs/wk_ecmwf/python.exe&quot;</span></span>
<span id="cb851-8"><a href="get-data.html#cb851-8" tabindex="-1"></a></span>
<span id="cb851-9"><a href="get-data.html#cb851-9" tabindex="-1"></a><span class="co"># nc name prefix</span></span>
<span id="cb851-10"><a href="get-data.html#cb851-10" tabindex="-1"></a>st_nc_prefix <span class="ot">&lt;-</span> <span class="st">&quot;ECMWF_utci_&quot;</span></span>
<span id="cb851-11"><a href="get-data.html#cb851-11" tabindex="-1"></a>st_nc_suffix <span class="ot">&lt;-</span> <span class="st">&quot;_v1.0_con.nc&quot;</span></span>
<span id="cb851-12"><a href="get-data.html#cb851-12" tabindex="-1"></a></span>
<span id="cb851-13"><a href="get-data.html#cb851-13" tabindex="-1"></a><span class="co"># Years list</span></span>
<span id="cb851-14"><a href="get-data.html#cb851-14" tabindex="-1"></a><span class="co"># ar_years &lt;- 2001:2019</span></span>
<span id="cb851-15"><a href="get-data.html#cb851-15" tabindex="-1"></a>ar_years <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2005</span>, <span class="dv">2015</span>)</span>
<span id="cb851-16"><a href="get-data.html#cb851-16" tabindex="-1"></a><span class="co"># ar_months_g1 &lt;- c(&#39;01&#39;,&#39;02&#39;,&#39;03&#39;,&#39;04&#39;,&#39;05&#39;,&#39;06&#39;)</span></span>
<span id="cb851-17"><a href="get-data.html#cb851-17" tabindex="-1"></a>ar_months_g1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;01&#39;</span>, <span class="st">&#39;03&#39;</span>)</span>
<span id="cb851-18"><a href="get-data.html#cb851-18" tabindex="-1"></a><span class="co"># ar_months_g2 &lt;- c(&#39;07&#39;,&#39;08&#39;,&#39;09&#39;,&#39;10&#39;,&#39;11&#39;,&#39;12&#39;)</span></span>
<span id="cb851-19"><a href="get-data.html#cb851-19" tabindex="-1"></a>ar_months_g2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;07&#39;</span>, <span class="st">&#39;09&#39;</span>)</span>
<span id="cb851-20"><a href="get-data.html#cb851-20" tabindex="-1"></a></span>
<span id="cb851-21"><a href="get-data.html#cb851-21" tabindex="-1"></a><span class="co"># Area</span></span>
<span id="cb851-22"><a href="get-data.html#cb851-22" tabindex="-1"></a><span class="co"># # China</span></span>
<span id="cb851-23"><a href="get-data.html#cb851-23" tabindex="-1"></a><span class="co"># fl_area_north &lt;- 53.31</span></span>
<span id="cb851-24"><a href="get-data.html#cb851-24" tabindex="-1"></a><span class="co"># fl_area_west &lt;- 73</span></span>
<span id="cb851-25"><a href="get-data.html#cb851-25" tabindex="-1"></a><span class="co"># fl_area_south &lt;- 4.15</span></span>
<span id="cb851-26"><a href="get-data.html#cb851-26" tabindex="-1"></a><span class="co"># fl_area_east &lt;- 135</span></span>
<span id="cb851-27"><a href="get-data.html#cb851-27" tabindex="-1"></a>fl_area_north <span class="ot">&lt;-</span> <span class="dv">53</span></span>
<span id="cb851-28"><a href="get-data.html#cb851-28" tabindex="-1"></a>fl_area_west <span class="ot">&lt;-</span> <span class="dv">73</span></span>
<span id="cb851-29"><a href="get-data.html#cb851-29" tabindex="-1"></a>fl_area_south <span class="ot">&lt;-</span> <span class="dv">52</span></span>
<span id="cb851-30"><a href="get-data.html#cb851-30" tabindex="-1"></a>fl_area_east <span class="ot">&lt;-</span> <span class="dv">74</span></span>
<span id="cb851-31"><a href="get-data.html#cb851-31" tabindex="-1"></a></span>
<span id="cb851-32"><a href="get-data.html#cb851-32" tabindex="-1"></a><span class="co"># folder to download any nc zips to</span></span>
<span id="cb851-33"><a href="get-data.html#cb851-33" tabindex="-1"></a>nczippath <span class="ot">&lt;-</span> spt_root</span>
<span id="cb851-34"><a href="get-data.html#cb851-34" tabindex="-1"></a><span class="co"># we are changing the python api file with different requests stirngs and storing it here</span></span>
<span id="cb851-35"><a href="get-data.html#cb851-35" tabindex="-1"></a>pyapipath <span class="ot">&lt;-</span> spt_root</span>
<span id="cb851-36"><a href="get-data.html#cb851-36" tabindex="-1"></a><span class="co"># output directory for AGGREGATE CSV with all DATES from this search</span></span>
<span id="cb851-37"><a href="get-data.html#cb851-37" tabindex="-1"></a>csvpath <span class="ot">&lt;-</span> spt_root</span>
<span id="cb851-38"><a href="get-data.html#cb851-38" tabindex="-1"></a></span>
<span id="cb851-39"><a href="get-data.html#cb851-39" tabindex="-1"></a><span class="do">#################################################</span></span>
<span id="cb851-40"><a href="get-data.html#cb851-40" tabindex="-1"></a><span class="co"># ------------ Packages</span></span>
<span id="cb851-41"><a href="get-data.html#cb851-41" tabindex="-1"></a><span class="do">#################################################</span></span>
<span id="cb851-42"><a href="get-data.html#cb851-42" tabindex="-1"></a></span>
<span id="cb851-43"><a href="get-data.html#cb851-43" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;ncdf4&quot;</span>)</span>
<span id="cb851-44"><a href="get-data.html#cb851-44" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;chron&quot;</span>)</span>
<span id="cb851-45"><a href="get-data.html#cb851-45" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;lattice&quot;</span>)</span>
<span id="cb851-46"><a href="get-data.html#cb851-46" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;RColorBrewer&quot;</span>)</span>
<span id="cb851-47"><a href="get-data.html#cb851-47" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;stringr&quot;</span>)</span>
<span id="cb851-48"><a href="get-data.html#cb851-48" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;tibble&quot;</span>)</span>
<span id="cb851-49"><a href="get-data.html#cb851-49" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb851-50"><a href="get-data.html#cb851-50" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">RETICULATE_PYTHON =</span> spth_conda_env)</span>
<span id="cb851-51"><a href="get-data.html#cb851-51" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;reticulate&quot;</span>)</span>
<span id="cb851-52"><a href="get-data.html#cb851-52" tabindex="-1"></a></span>
<span id="cb851-53"><a href="get-data.html#cb851-53" tabindex="-1"></a><span class="do">#################################################</span></span>
<span id="cb851-54"><a href="get-data.html#cb851-54" tabindex="-1"></a><span class="co"># ------------ Define Loops</span></span>
<span id="cb851-55"><a href="get-data.html#cb851-55" tabindex="-1"></a><span class="do">#################################################</span></span>
<span id="cb851-56"><a href="get-data.html#cb851-56" tabindex="-1"></a><span class="cf">for</span> (it_yr <span class="cf">in</span> ar_years) {</span>
<span id="cb851-57"><a href="get-data.html#cb851-57" tabindex="-1"></a>  <span class="cf">for</span> (it_mth_group <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)) {</span>
<span id="cb851-58"><a href="get-data.html#cb851-58" tabindex="-1"></a>    <span class="cf">if</span>(it_mth_group <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb851-59"><a href="get-data.html#cb851-59" tabindex="-1"></a>      ar_months <span class="ot">=</span> ar_months_g1</span>
<span id="cb851-60"><a href="get-data.html#cb851-60" tabindex="-1"></a>    }</span>
<span id="cb851-61"><a href="get-data.html#cb851-61" tabindex="-1"></a>    <span class="cf">if</span>(it_mth_group <span class="sc">==</span> <span class="dv">2</span>) {</span>
<span id="cb851-62"><a href="get-data.html#cb851-62" tabindex="-1"></a>      ar_months <span class="ot">=</span> ar_months_g2</span>
<span id="cb851-63"><a href="get-data.html#cb851-63" tabindex="-1"></a>    }</span>
<span id="cb851-64"><a href="get-data.html#cb851-64" tabindex="-1"></a></span>
<span id="cb851-65"><a href="get-data.html#cb851-65" tabindex="-1"></a>    <span class="do">#################################################</span></span>
<span id="cb851-66"><a href="get-data.html#cb851-66" tabindex="-1"></a>    <span class="co"># ------------ Define Python API Call</span></span>
<span id="cb851-67"><a href="get-data.html#cb851-67" tabindex="-1"></a>    <span class="do">#################################################</span></span>
<span id="cb851-68"><a href="get-data.html#cb851-68" tabindex="-1"></a></span>
<span id="cb851-69"><a href="get-data.html#cb851-69" tabindex="-1"></a>    <span class="co"># name of zip file</span></span>
<span id="cb851-70"><a href="get-data.html#cb851-70" tabindex="-1"></a>    nczipname <span class="ot">&lt;-</span> <span class="st">&quot;derived_utci_2010_2.zip&quot;</span></span>
<span id="cb851-71"><a href="get-data.html#cb851-71" tabindex="-1"></a>    unzipfolder <span class="ot">&lt;-</span> <span class="st">&quot;derived_utci_2010_2&quot;</span></span>
<span id="cb851-72"><a href="get-data.html#cb851-72" tabindex="-1"></a></span>
<span id="cb851-73"><a href="get-data.html#cb851-73" tabindex="-1"></a>    st_file <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;import cdsapi</span></span>
<span id="cb851-74"><a href="get-data.html#cb851-74" tabindex="-1"></a><span class="st">import urllib.request</span></span>
<span id="cb851-75"><a href="get-data.html#cb851-75" tabindex="-1"></a><span class="st"># download folder</span></span>
<span id="cb851-76"><a href="get-data.html#cb851-76" tabindex="-1"></a><span class="st">spt_root = &#39;&quot;</span>, nczippath, <span class="st">&quot;&#39;</span></span>
<span id="cb851-77"><a href="get-data.html#cb851-77" tabindex="-1"></a><span class="st">spn_dl_test_grib = spt_root + &#39;&quot;</span>, nczipname, <span class="st">&quot;&#39;</span></span>
<span id="cb851-78"><a href="get-data.html#cb851-78" tabindex="-1"></a><span class="st"># request</span></span>
<span id="cb851-79"><a href="get-data.html#cb851-79" tabindex="-1"></a><span class="st">c = cdsapi.Client()</span></span>
<span id="cb851-80"><a href="get-data.html#cb851-80" tabindex="-1"></a><span class="st">res = c.retrieve(</span></span>
<span id="cb851-81"><a href="get-data.html#cb851-81" tabindex="-1"></a><span class="st">    &#39;derived-utci-historical&#39;,</span></span>
<span id="cb851-82"><a href="get-data.html#cb851-82" tabindex="-1"></a><span class="st">    {</span></span>
<span id="cb851-83"><a href="get-data.html#cb851-83" tabindex="-1"></a><span class="st">        &#39;format&#39;: &#39;zip&#39;,</span></span>
<span id="cb851-84"><a href="get-data.html#cb851-84" tabindex="-1"></a><span class="st">        &#39;variable&#39;: &#39;Universal thermal climate index&#39;,</span></span>
<span id="cb851-85"><a href="get-data.html#cb851-85" tabindex="-1"></a><span class="st">        &#39;product_type&#39;: &#39;Consolidated dataset&#39;,</span></span>
<span id="cb851-86"><a href="get-data.html#cb851-86" tabindex="-1"></a><span class="st">        &#39;year&#39;: &#39;&quot;</span>,it_yr, <span class="st">&quot;&#39;,</span></span>
<span id="cb851-87"><a href="get-data.html#cb851-87" tabindex="-1"></a><span class="st">        &#39;month&#39;: [</span></span>
<span id="cb851-88"><a href="get-data.html#cb851-88" tabindex="-1"></a><span class="st">            &quot;</span>, <span class="fu">paste</span>(<span class="st">&quot;&#39;&quot;</span>, ar_months, <span class="st">&quot;&#39;&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>, <span class="at">collapse =</span> <span class="st">&quot;, &quot;</span>), <span class="st">&quot;</span></span>
<span id="cb851-89"><a href="get-data.html#cb851-89" tabindex="-1"></a><span class="st">        ],</span></span>
<span id="cb851-90"><a href="get-data.html#cb851-90" tabindex="-1"></a><span class="st">        &#39;day&#39;: [</span></span>
<span id="cb851-91"><a href="get-data.html#cb851-91" tabindex="-1"></a><span class="st">            &#39;01&#39;,&#39;03&#39;</span></span>
<span id="cb851-92"><a href="get-data.html#cb851-92" tabindex="-1"></a><span class="st">        ],</span></span>
<span id="cb851-93"><a href="get-data.html#cb851-93" tabindex="-1"></a><span class="st">        &#39;area&#39;  : [&quot;</span>, fl_area_north ,<span class="st">&quot;, &quot;</span>, fl_area_west ,<span class="st">&quot;, &quot;</span>, fl_area_south ,<span class="st">&quot;, &quot;</span>, fl_area_east ,<span class="st">&quot;],</span></span>
<span id="cb851-94"><a href="get-data.html#cb851-94" tabindex="-1"></a><span class="st">        &#39;grid&#39;  : [0.25, 0.25],</span></span>
<span id="cb851-95"><a href="get-data.html#cb851-95" tabindex="-1"></a><span class="st">    },</span></span>
<span id="cb851-96"><a href="get-data.html#cb851-96" tabindex="-1"></a><span class="st">    spn_dl_test_grib)</span></span>
<span id="cb851-97"><a href="get-data.html#cb851-97" tabindex="-1"></a><span class="st"># show results</span></span>
<span id="cb851-98"><a href="get-data.html#cb851-98" tabindex="-1"></a><span class="st">print(&#39;print results&#39;)</span></span>
<span id="cb851-99"><a href="get-data.html#cb851-99" tabindex="-1"></a><span class="st">print(res)</span></span>
<span id="cb851-100"><a href="get-data.html#cb851-100" tabindex="-1"></a><span class="st">print(type(res))&quot;</span>)</span>
<span id="cb851-101"><a href="get-data.html#cb851-101" tabindex="-1"></a></span>
<span id="cb851-102"><a href="get-data.html#cb851-102" tabindex="-1"></a>    <span class="co"># st_file = &quot;print(1+1)&quot;</span></span>
<span id="cb851-103"><a href="get-data.html#cb851-103" tabindex="-1"></a></span>
<span id="cb851-104"><a href="get-data.html#cb851-104" tabindex="-1"></a>    <span class="co"># Store Python Api File</span></span>
<span id="cb851-105"><a href="get-data.html#cb851-105" tabindex="-1"></a>    fl_test_tex <span class="ot">&lt;-</span> <span class="fu">paste0</span>(pyapipath, <span class="st">&quot;api.py&quot;</span>)</span>
<span id="cb851-106"><a href="get-data.html#cb851-106" tabindex="-1"></a>    fileConn <span class="ot">&lt;-</span> <span class="fu">file</span>(fl_test_tex)</span>
<span id="cb851-107"><a href="get-data.html#cb851-107" tabindex="-1"></a>    <span class="fu">writeLines</span>(st_file, fileConn)</span>
<span id="cb851-108"><a href="get-data.html#cb851-108" tabindex="-1"></a>    <span class="fu">close</span>(fileConn)</span>
<span id="cb851-109"><a href="get-data.html#cb851-109" tabindex="-1"></a></span>
<span id="cb851-110"><a href="get-data.html#cb851-110" tabindex="-1"></a>    <span class="do">#################################################</span></span>
<span id="cb851-111"><a href="get-data.html#cb851-111" tabindex="-1"></a>    <span class="co"># ------------ Run Python File</span></span>
<span id="cb851-112"><a href="get-data.html#cb851-112" tabindex="-1"></a>    <span class="do">#################################################</span></span>
<span id="cb851-113"><a href="get-data.html#cb851-113" tabindex="-1"></a>    <span class="co"># Set Path</span></span>
<span id="cb851-114"><a href="get-data.html#cb851-114" tabindex="-1"></a>    <span class="fu">setwd</span>(pyapipath)</span>
<span id="cb851-115"><a href="get-data.html#cb851-115" tabindex="-1"></a>    <span class="co"># Run py file, api.py name just defined</span></span>
<span id="cb851-116"><a href="get-data.html#cb851-116" tabindex="-1"></a>    <span class="fu">use_python</span>(spth_conda_env)</span>
<span id="cb851-117"><a href="get-data.html#cb851-117" tabindex="-1"></a>    <span class="fu">source_python</span>(<span class="st">&#39;api.py&#39;</span>)</span>
<span id="cb851-118"><a href="get-data.html#cb851-118" tabindex="-1"></a></span>
<span id="cb851-119"><a href="get-data.html#cb851-119" tabindex="-1"></a>    <span class="do">#################################################</span></span>
<span id="cb851-120"><a href="get-data.html#cb851-120" tabindex="-1"></a>    <span class="co"># ------------ uNZIP</span></span>
<span id="cb851-121"><a href="get-data.html#cb851-121" tabindex="-1"></a>    <span class="do">#################################################</span></span>
<span id="cb851-122"><a href="get-data.html#cb851-122" tabindex="-1"></a>    spn_zip <span class="ot">&lt;-</span> <span class="fu">paste0</span>(nczippath, nczipname)</span>
<span id="cb851-123"><a href="get-data.html#cb851-123" tabindex="-1"></a>    spn_unzip_folder <span class="ot">&lt;-</span> <span class="fu">paste0</span>(nczippath, unzipfolder)</span>
<span id="cb851-124"><a href="get-data.html#cb851-124" tabindex="-1"></a>    <span class="fu">unzip</span>(spn_zip, <span class="at">exdir=</span>spn_unzip_folder)</span>
<span id="cb851-125"><a href="get-data.html#cb851-125" tabindex="-1"></a></span>
<span id="cb851-126"><a href="get-data.html#cb851-126" tabindex="-1"></a>    <span class="do">#################################################</span></span>
<span id="cb851-127"><a href="get-data.html#cb851-127" tabindex="-1"></a>    <span class="co"># ------------ Find All files</span></span>
<span id="cb851-128"><a href="get-data.html#cb851-128" tabindex="-1"></a>    <span class="do">#################################################</span></span>
<span id="cb851-129"><a href="get-data.html#cb851-129" tabindex="-1"></a>    <span class="co"># Get all files with nc suffix in folder</span></span>
<span id="cb851-130"><a href="get-data.html#cb851-130" tabindex="-1"></a>    ncpath <span class="ot">&lt;-</span> <span class="fu">paste0</span>(nczippath, unzipfolder)</span>
<span id="cb851-131"><a href="get-data.html#cb851-131" tabindex="-1"></a>    ls_sfls <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path=</span>ncpath, <span class="at">recursive=</span><span class="cn">TRUE</span>, <span class="at">pattern=</span><span class="st">&quot;.nc&quot;</span>, <span class="at">full.names=</span>T)</span>
<span id="cb851-132"><a href="get-data.html#cb851-132" tabindex="-1"></a></span>
<span id="cb851-133"><a href="get-data.html#cb851-133" tabindex="-1"></a>    <span class="do">#################################################</span></span>
<span id="cb851-134"><a href="get-data.html#cb851-134" tabindex="-1"></a>    <span class="co"># ------------ Combine individual NC files to JOINT Dataframe</span></span>
<span id="cb851-135"><a href="get-data.html#cb851-135" tabindex="-1"></a>    <span class="do">#################################################</span></span>
<span id="cb851-136"><a href="get-data.html#cb851-136" tabindex="-1"></a>    <span class="co"># List to gather dataframes</span></span>
<span id="cb851-137"><a href="get-data.html#cb851-137" tabindex="-1"></a>    ls_df <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;list&quot;</span>, <span class="at">length =</span> <span class="fu">length</span>(ls_sfls))</span>
<span id="cb851-138"><a href="get-data.html#cb851-138" tabindex="-1"></a>    <span class="co"># Loop over files and convert nc to csv</span></span>
<span id="cb851-139"><a href="get-data.html#cb851-139" tabindex="-1"></a>    it_df_ctr <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb851-140"><a href="get-data.html#cb851-140" tabindex="-1"></a>    <span class="cf">for</span> (spt_file <span class="cf">in</span> ls_sfls) {</span>
<span id="cb851-141"><a href="get-data.html#cb851-141" tabindex="-1"></a>      it_df_ctr <span class="ot">&lt;-</span> it_df_ctr <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb851-142"><a href="get-data.html#cb851-142" tabindex="-1"></a></span>
<span id="cb851-143"><a href="get-data.html#cb851-143" tabindex="-1"></a>      <span class="co"># Get file name without Path</span></span>
<span id="cb851-144"><a href="get-data.html#cb851-144" tabindex="-1"></a>      snm_file_date <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="fu">paste0</span>(<span class="st">&#39;</span><span class="sc">\\</span><span class="st">&#39;</span>,st_nc_suffix,<span class="st">&#39;$&#39;</span>), <span class="st">&#39;&#39;</span>, <span class="fu">basename</span>(spt_file))</span>
<span id="cb851-145"><a href="get-data.html#cb851-145" tabindex="-1"></a>      snm_file_date <span class="ot">&lt;-</span> <span class="fu">sub</span>(st_nc_prefix, <span class="st">&#39;&#39;</span>, <span class="fu">basename</span>(snm_file_date))</span>
<span id="cb851-146"><a href="get-data.html#cb851-146" tabindex="-1"></a></span>
<span id="cb851-147"><a href="get-data.html#cb851-147" tabindex="-1"></a>      <span class="co"># Dates Start and End: list.files is auto sorted in ascending order</span></span>
<span id="cb851-148"><a href="get-data.html#cb851-148" tabindex="-1"></a>      <span class="cf">if</span> (it_df_ctr <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb851-149"><a href="get-data.html#cb851-149" tabindex="-1"></a>        snm_start_date <span class="ot">&lt;-</span> snm_file_date</span>
<span id="cb851-150"><a href="get-data.html#cb851-150" tabindex="-1"></a>      }</span>
<span id="cb851-151"><a href="get-data.html#cb851-151" tabindex="-1"></a>      <span class="cf">else</span> {</span>
<span id="cb851-152"><a href="get-data.html#cb851-152" tabindex="-1"></a>        <span class="co"># this will give the final date</span></span>
<span id="cb851-153"><a href="get-data.html#cb851-153" tabindex="-1"></a>        snm_end_date <span class="ot">&lt;-</span> snm_file_date</span>
<span id="cb851-154"><a href="get-data.html#cb851-154" tabindex="-1"></a>      }</span>
<span id="cb851-155"><a href="get-data.html#cb851-155" tabindex="-1"></a></span>
<span id="cb851-156"><a href="get-data.html#cb851-156" tabindex="-1"></a>      <span class="co"># Given this structure: ECMWF_utci_20100702_v1.0_con, sub out prefix and suffix</span></span>
<span id="cb851-157"><a href="get-data.html#cb851-157" tabindex="-1"></a>      <span class="fu">print</span>(spt_file)</span>
<span id="cb851-158"><a href="get-data.html#cb851-158" tabindex="-1"></a>      ncin <span class="ot">&lt;-</span> <span class="fu">nc_open</span>(spt_file)</span>
<span id="cb851-159"><a href="get-data.html#cb851-159" tabindex="-1"></a></span>
<span id="cb851-160"><a href="get-data.html#cb851-160" tabindex="-1"></a>      nchist <span class="ot">&lt;-</span> <span class="fu">ncatt_get</span>(ncin, <span class="dv">0</span>, <span class="st">&quot;history&quot;</span>)</span>
<span id="cb851-161"><a href="get-data.html#cb851-161" tabindex="-1"></a></span>
<span id="cb851-162"><a href="get-data.html#cb851-162" tabindex="-1"></a>      <span class="co"># not using this missing value flag at the moment</span></span>
<span id="cb851-163"><a href="get-data.html#cb851-163" tabindex="-1"></a>      missingval <span class="ot">&lt;-</span> <span class="fu">str_match</span>(nchist<span class="sc">$</span>value, <span class="st">&quot;setmisstoc,</span><span class="sc">\\</span><span class="st">s*(.*?)</span><span class="sc">\\</span><span class="st">s* &quot;</span>)[,<span class="dv">2</span>]</span>
<span id="cb851-164"><a href="get-data.html#cb851-164" tabindex="-1"></a>      missingval <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(missingval)</span>
<span id="cb851-165"><a href="get-data.html#cb851-165" tabindex="-1"></a></span>
<span id="cb851-166"><a href="get-data.html#cb851-166" tabindex="-1"></a>      lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(ncin, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb851-167"><a href="get-data.html#cb851-167" tabindex="-1"></a>      lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(ncin, <span class="st">&quot;lat&quot;</span>)</span>
<span id="cb851-168"><a href="get-data.html#cb851-168" tabindex="-1"></a>      tim <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(ncin, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb851-169"><a href="get-data.html#cb851-169" tabindex="-1"></a>      tunits <span class="ot">&lt;-</span> <span class="fu">ncatt_get</span>(ncin, <span class="st">&quot;time&quot;</span>, <span class="st">&quot;units&quot;</span>)</span>
<span id="cb851-170"><a href="get-data.html#cb851-170" tabindex="-1"></a></span>
<span id="cb851-171"><a href="get-data.html#cb851-171" tabindex="-1"></a>      nlon <span class="ot">&lt;-</span> <span class="fu">dim</span>(lon)</span>
<span id="cb851-172"><a href="get-data.html#cb851-172" tabindex="-1"></a>      nlat <span class="ot">&lt;-</span> <span class="fu">dim</span>(lat)</span>
<span id="cb851-173"><a href="get-data.html#cb851-173" tabindex="-1"></a>      ntim <span class="ot">&lt;-</span> <span class="fu">dim</span>(tim)</span>
<span id="cb851-174"><a href="get-data.html#cb851-174" tabindex="-1"></a></span>
<span id="cb851-175"><a href="get-data.html#cb851-175" tabindex="-1"></a>      <span class="co"># convert time -- split the time units string into fields</span></span>
<span id="cb851-176"><a href="get-data.html#cb851-176" tabindex="-1"></a>      <span class="co"># tustr &lt;- strsplit(tunits$value, &quot; &quot;)</span></span>
<span id="cb851-177"><a href="get-data.html#cb851-177" tabindex="-1"></a>      <span class="co"># tdstr &lt;- strsplit(unlist(tustr)[3], &quot;-&quot;)</span></span>
<span id="cb851-178"><a href="get-data.html#cb851-178" tabindex="-1"></a>      <span class="co"># tmonth &lt;- as.integer(unlist(tdstr)[2])</span></span>
<span id="cb851-179"><a href="get-data.html#cb851-179" tabindex="-1"></a>      <span class="co"># tday &lt;- as.integer(unlist(tdstr)[3])</span></span>
<span id="cb851-180"><a href="get-data.html#cb851-180" tabindex="-1"></a>      <span class="co"># tyear &lt;- as.integer(unlist(tdstr)[1])</span></span>
<span id="cb851-181"><a href="get-data.html#cb851-181" tabindex="-1"></a>      <span class="co"># mytim &lt;- chron(tim, origin = c(tmonth, tday, tyear))</span></span>
<span id="cb851-182"><a href="get-data.html#cb851-182" tabindex="-1"></a></span>
<span id="cb851-183"><a href="get-data.html#cb851-183" tabindex="-1"></a>      tmp_array <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(ncin, <span class="st">&quot;utci&quot;</span>)</span>
<span id="cb851-184"><a href="get-data.html#cb851-184" tabindex="-1"></a>      tmp_array <span class="ot">&lt;-</span> tmp_array <span class="sc">-</span> <span class="fl">273.15</span></span>
<span id="cb851-185"><a href="get-data.html#cb851-185" tabindex="-1"></a></span>
<span id="cb851-186"><a href="get-data.html#cb851-186" tabindex="-1"></a>      lonlat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">expand.grid</span>(<span class="at">lon =</span> lon, <span class="at">lat =</span> lat, <span class="at">hours =</span> tim))</span>
<span id="cb851-187"><a href="get-data.html#cb851-187" tabindex="-1"></a>      temperature <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(tmp_array)</span>
<span id="cb851-188"><a href="get-data.html#cb851-188" tabindex="-1"></a>      tmp_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(lonlat, temperature))</span>
<span id="cb851-189"><a href="get-data.html#cb851-189" tabindex="-1"></a></span>
<span id="cb851-190"><a href="get-data.html#cb851-190" tabindex="-1"></a>      <span class="co"># extract a rectangle</span></span>
<span id="cb851-191"><a href="get-data.html#cb851-191" tabindex="-1"></a>      eps <span class="ot">&lt;-</span> <span class="fl">1e-8</span></span>
<span id="cb851-192"><a href="get-data.html#cb851-192" tabindex="-1"></a>      minlat <span class="ot">&lt;-</span> <span class="fl">22.25</span> <span class="sc">-</span> eps</span>
<span id="cb851-193"><a href="get-data.html#cb851-193" tabindex="-1"></a>      maxlat <span class="ot">&lt;-</span> <span class="fl">23.50</span> <span class="sc">+</span> eps</span>
<span id="cb851-194"><a href="get-data.html#cb851-194" tabindex="-1"></a>      minlon <span class="ot">&lt;-</span> <span class="fl">113.00</span> <span class="sc">-</span> eps</span>
<span id="cb851-195"><a href="get-data.html#cb851-195" tabindex="-1"></a>      maxlon <span class="ot">&lt;-</span> <span class="fl">114.50</span> <span class="sc">+</span> eps</span>
<span id="cb851-196"><a href="get-data.html#cb851-196" tabindex="-1"></a>      <span class="co"># subset data</span></span>
<span id="cb851-197"><a href="get-data.html#cb851-197" tabindex="-1"></a>      subset_df <span class="ot">&lt;-</span> tmp_df[tmp_df<span class="sc">$</span>lat <span class="sc">&gt;=</span> minlat <span class="sc">&amp;</span> tmp_df<span class="sc">$</span>lat <span class="sc">&lt;=</span> maxlat <span class="sc">&amp;</span></span>
<span id="cb851-198"><a href="get-data.html#cb851-198" tabindex="-1"></a>                            tmp_df<span class="sc">$</span>lon <span class="sc">&gt;=</span> minlon <span class="sc">&amp;</span> tmp_df<span class="sc">$</span>lon <span class="sc">&lt;=</span> maxlon, ]</span>
<span id="cb851-199"><a href="get-data.html#cb851-199" tabindex="-1"></a></span>
<span id="cb851-200"><a href="get-data.html#cb851-200" tabindex="-1"></a>      <span class="co"># add Date</span></span>
<span id="cb851-201"><a href="get-data.html#cb851-201" tabindex="-1"></a>      subset_df_date <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(subset_df) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">date =</span> snm_file_date)</span>
<span id="cb851-202"><a href="get-data.html#cb851-202" tabindex="-1"></a></span>
<span id="cb851-203"><a href="get-data.html#cb851-203" tabindex="-1"></a>      <span class="co"># Add to list</span></span>
<span id="cb851-204"><a href="get-data.html#cb851-204" tabindex="-1"></a>      ls_df[[it_df_ctr]] <span class="ot">&lt;-</span> subset_df_date</span>
<span id="cb851-205"><a href="get-data.html#cb851-205" tabindex="-1"></a></span>
<span id="cb851-206"><a href="get-data.html#cb851-206" tabindex="-1"></a>      <span class="co"># Close NC</span></span>
<span id="cb851-207"><a href="get-data.html#cb851-207" tabindex="-1"></a>      <span class="fu">nc_close</span>(ncin)</span>
<span id="cb851-208"><a href="get-data.html#cb851-208" tabindex="-1"></a>    }</span>
<span id="cb851-209"><a href="get-data.html#cb851-209" tabindex="-1"></a></span>
<span id="cb851-210"><a href="get-data.html#cb851-210" tabindex="-1"></a>    <span class="co"># List of DF to one DF</span></span>
<span id="cb851-211"><a href="get-data.html#cb851-211" tabindex="-1"></a>    df_all_nc <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, ls_df)</span>
<span id="cb851-212"><a href="get-data.html#cb851-212" tabindex="-1"></a></span>
<span id="cb851-213"><a href="get-data.html#cb851-213" tabindex="-1"></a>    <span class="co"># Save File</span></span>
<span id="cb851-214"><a href="get-data.html#cb851-214" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">paste0</span>(st_nc_prefix,</span>
<span id="cb851-215"><a href="get-data.html#cb851-215" tabindex="-1"></a>                           snm_start_date, <span class="st">&quot;_to_&quot;</span>, snm_end_date,</span>
<span id="cb851-216"><a href="get-data.html#cb851-216" tabindex="-1"></a>                           <span class="st">&quot;.csv&quot;</span>))</span>
<span id="cb851-217"><a href="get-data.html#cb851-217" tabindex="-1"></a>    csvfile <span class="ot">&lt;-</span> <span class="fu">paste0</span>(csvpath, fname)</span>
<span id="cb851-218"><a href="get-data.html#cb851-218" tabindex="-1"></a>    <span class="fu">write.table</span>(<span class="fu">na.omit</span>(df_all_nc), csvfile, <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb851-219"><a href="get-data.html#cb851-219" tabindex="-1"></a></span>
<span id="cb851-220"><a href="get-data.html#cb851-220" tabindex="-1"></a>    <span class="co"># Delete folders</span></span>
<span id="cb851-221"><a href="get-data.html#cb851-221" tabindex="-1"></a>    <span class="fu">unlink</span>(spn_zip, <span class="at">recursive=</span><span class="cn">TRUE</span>, <span class="at">force=</span><span class="cn">TRUE</span>)</span>
<span id="cb851-222"><a href="get-data.html#cb851-222" tabindex="-1"></a>    <span class="fu">unlink</span>(spn_unzip_folder, <span class="at">recursive=</span><span class="cn">TRUE</span>, <span class="at">force=</span><span class="cn">TRUE</span>)</span>
<span id="cb851-223"><a href="get-data.html#cb851-223" tabindex="-1"></a></span>
<span id="cb851-224"><a href="get-data.html#cb851-224" tabindex="-1"></a>  <span class="co"># end loop months groups</span></span>
<span id="cb851-225"><a href="get-data.html#cb851-225" tabindex="-1"></a>  }</span>
<span id="cb851-226"><a href="get-data.html#cb851-226" tabindex="-1"></a><span class="co"># end loop year</span></span>
<span id="cb851-227"><a href="get-data.html#cb851-227" tabindex="-1"></a>}</span></code></pre></div>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="tables-and-graphs.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="coding-and-development.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": [["Panel-Data-and-Optimization-with-R.pdf", "PDF"]],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
