% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames*,x11names*}{xcolor}
%
\documentclass[
]{book}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Panel Data and Optimization with R},
  pdfauthor={Fan Wang},
  colorlinks=true,
  linkcolor=Maroon,
  filecolor=Maroon,
  citecolor=Blue,
  urlcolor=blue,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs}
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\usepackage{bbm}
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{array}
\usepackage{multirow}
\usepackage{wrapfig}
\usepackage{float}
% \floatplacement{figure}{H}
\usepackage[labelformat = empty]{caption}
\usepackage{colortbl}
\usepackage{pdflscape}
\usepackage{tabu}
\usepackage{threeparttable}
\usepackage{threeparttablex}
\usepackage[normalem]{ulem}
\usepackage{makecell}
\usepackage{xcolor}
\usepackage{geometry}
\geometry{
	a4paper,
	left=1.0in,
	right=1.0in,
	top=1.0in,
	bottom=1.0in,
}
\setcounter{secnumdepth}{5}
\setcounter{tocdepth}{5}
\usepackage[]{natbib}
\bibliographystyle{apalike}

\title{Panel Data and Optimization with R}
\author{Fan Wang}
\date{2020-05-16}

\begin{document}
\maketitle

{
\hypersetup{linkcolor=}
\setcounter{tocdepth}{1}
\tableofcontents
}
\hypertarget{preface}{%
\chapter*{Preface}\label{preface}}
\addcontentsline{toc}{chapter}{Preface}

This is a work-in-progress \href{https://fanwangecon.github.io/R4Econ/}{website} consisting of R panel data and optimization examples for Statistics/Econometrics/Economic Analysis. Materials gathered from various \href{https://fanwangecon.github.io/research}{projects} in which R code is used. Files are from \href{https://fanwangecon.github.io/}{\textbf{Fan}}'s \href{https://github.com/FanWangEcon/R4Econ}{R4Econ} repository. This is not a R package, but a list of examples in PDF/HTML/Rmd formats. \href{https://fanwangecon.github.io/REconTools/}{REconTools} is a package that can be installed with tools used in \href{https://fanwangecon.github.io/research}{projects} involving R.

Bullet points show which \href{https://www.rdocumentation.org/packages/base/versions/3.5.2}{base R}, \href{https://www.tidyverse.org/}{tidyverse} or other functions/commands are used to achieve various objectives. An effort is made to use only \href{https://www.rdocumentation.org/packages/base/versions/3.5.2}{base R} \citep{R-base} and \href{https://www.tidyverse.org/}{tidyverse} \citep{R-tidyverse} packages whenever possible to reduce dependencies. The goal of this repository is to make it easier to find/re-use codes produced for various projects. Some functions also rely on or correspond to functions from \href{https://fanwangecon.github.io/REconTools/}{REconTools} \citep{R-REconTools}.

From \href{https://fanwangecon.github.io/}{Fan}'s other repositories: For dynamic borrowing and savings problems, see \href{https://fanwangecon.github.io/CodeDynaAsset/}{Dynamic Asset Repository}; For code examples, see also \href{https://fanwangecon.github.io/M4Econ/}{Matlab Example Code} and \href{https://fanwangecon.github.io/Stata4Econ/}{Stata Example Code}; For intro econ with Matlab, see \href{https://fanwangecon.github.io/Math4Econ/}{Intro Mathematics for Economists}, and for intro stat with R, see \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Statistics for Undergraduates}. See \href{https://github.com/FanWangEcon}{here} for all of \href{https://fanwangecon.github.io/}{Fan}'s public repositories.

The site is built using \href{https://bookdown.org/}{Bookdown} \citep{R-bookdown}.

Please contact \href{https://fanwangecon.github.io/}{FanWangEcon} for issues or problems.

\hypertarget{array-matrix-dataframe}{%
\chapter{Array, Matrix, Dataframe}\label{array-matrix-dataframe}}

\hypertarget{list}{%
\section{List}\label{list}}

\hypertarget{multiple-dimensional-list}{%
\subsection{Multiple Dimensional List}\label{multiple-dimensional-list}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

\begin{itemize}
\tightlist
\item
  r list tutorial
\item
  r vector vs list
\item
  r initialize empty multiple element list
\item
  r name rows and columns of 2 dimensional list
\item
  r row and colum names of list
\item
  list dimnames
\item
  r named list to string
\end{itemize}

\hypertarget{one-dimensional-named-list}{%
\subsubsection{One Dimensional Named List}\label{one-dimensional-named-list}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  define list
\item
  slice list
\item
  print r named list as a single line string
\end{enumerate}

\begin{itemize}
\tightlist
\item
  \href{https://stackoverflow.com/a/55622024/8280804}{R Unlist named list into one string with preserving list names}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Define Lists}
\NormalTok{ls\_num \textless{}{-}}\StringTok{ }\KeywordTok{list}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{)}
\NormalTok{ls\_str \textless{}{-}}\StringTok{ }\KeywordTok{list}\NormalTok{(}\StringTok{\textquotesingle{}1\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}2\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}3\textquotesingle{}}\NormalTok{)}
\NormalTok{ls\_num\_str \textless{}{-}}\StringTok{ }\KeywordTok{list}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\StringTok{\textquotesingle{}3\textquotesingle{}}\NormalTok{)}

\CommentTok{\# Named Lists}
\NormalTok{ar\_st\_names \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}e1\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}e2\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}e3\textquotesingle{}}\NormalTok{)}
\NormalTok{ls\_num\_str\_named \textless{}{-}}\StringTok{ }\NormalTok{ls\_num\_str}
\KeywordTok{names}\NormalTok{(ls\_num\_str\_named) \textless{}{-}}\StringTok{ }\NormalTok{ar\_st\_names}

\CommentTok{\# Add Element to Named List}
\NormalTok{ls\_num\_str\_named}\OperatorTok{$}\NormalTok{e4 \textless{}{-}}\StringTok{ \textquotesingle{}this is added\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  r print input as string
\item
  r print parameter code as string
\item
  \href{https://stackoverflow.com/a/14577878/8280804}{How to convert variable (object) name into String}
\end{itemize}

The function below ffi\_lst2str is also a function in \href{https://fanwangecon.github.io/REconTools/index.html}{REconTools}: \href{https://fanwangecon.github.io/REconTools/reference/ff_sup_lst2str.html}{ff\_sup\_lst2str}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# list to String printing function}
\NormalTok{ffi\_lst2str \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(ls\_list, st\_desc, }\DataTypeTok{bl\_print=}\OtherTok{TRUE}\NormalTok{) \{}

  \CommentTok{\# string desc}
  \ControlFlowTok{if}\NormalTok{(}\KeywordTok{missing}\NormalTok{(st\_desc))\{}
\NormalTok{    st\_desc \textless{}{-}}\StringTok{ }\KeywordTok{deparse}\NormalTok{(}\KeywordTok{substitute}\NormalTok{(ls\_list))}
\NormalTok{  \}}

  \CommentTok{\# create string}
\NormalTok{  st\_string\_from\_list =}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(st\_desc, }\StringTok{\textquotesingle{}:\textquotesingle{}}\NormalTok{),}
                               \KeywordTok{paste}\NormalTok{(}\KeywordTok{names}\NormalTok{(ls\_list), ls\_list, }\DataTypeTok{sep=}\StringTok{"="}\NormalTok{, }\DataTypeTok{collapse=}\StringTok{";"}\NormalTok{ ))}

  \ControlFlowTok{if}\NormalTok{ (bl\_print)\{}
    \KeywordTok{print}\NormalTok{(st\_string\_from\_list)}
\NormalTok{  \}}
\NormalTok{\}}

\CommentTok{\# print full}
\KeywordTok{ffi\_lst2str}\NormalTok{(ls\_num)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "ls_num:=1;=2;=3"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ffi\_lst2str}\NormalTok{(ls\_str)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "ls_str:=1;=2;=3"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ffi\_lst2str}\NormalTok{(ls\_num\_str)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "ls_num_str:=1;=2;=3"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ffi\_lst2str}\NormalTok{(ls\_num\_str\_named)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "ls_num_str_named:e1=1;e2=2;e3=3;e4=this is added"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# print subset}
\KeywordTok{ffi\_lst2str}\NormalTok{(ls\_num[}\DecValTok{2}\OperatorTok{:}\DecValTok{3}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "ls_num[2:3]:=2;=3"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ffi\_lst2str}\NormalTok{(ls\_str[}\DecValTok{2}\OperatorTok{:}\DecValTok{3}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "ls_str[2:3]:=2;=3"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ffi\_lst2str}\NormalTok{(ls\_num\_str[}\DecValTok{2}\OperatorTok{:}\DecValTok{4}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "ls_num_str[2:4]:=2;=3;=NULL"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ffi\_lst2str}\NormalTok{(ls\_num\_str\_named[}\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}e2\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}e3\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}e4\textquotesingle{}}\NormalTok{)])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "ls_num_str_named[c(\"e2\", \"e3\", \"e4\")]:e2=2;e3=3;e4=this is added"
\end{verbatim}

\hypertarget{two-dimensional-unnamed-list}{%
\subsubsection{Two Dimensional Unnamed List}\label{two-dimensional-unnamed-list}}

Generate a multiple dimensional list:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Initiate with an N element empty list
\item
  Reshape list to M by Q
\item
  Fill list elements
\item
  Get list element by row and column number
\end{enumerate}

List allows for different data types to be stored together.

Note that element specific names in named list are not preserved when the list is reshaped to be two dimensional. Two dimensional list, however, could have row and column names.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Dimensions}
\NormalTok{it\_M \textless{}{-}}\StringTok{ }\DecValTok{2}
\NormalTok{it\_Q \textless{}{-}}\StringTok{ }\DecValTok{3}
\NormalTok{it\_N \textless{}{-}}\StringTok{ }\NormalTok{it\_M}\OperatorTok{*}\NormalTok{it\_Q}

\CommentTok{\# Initiate an Empty MxQ=N element list}
\NormalTok{ls\_2d\_flat \textless{}{-}}\StringTok{ }\KeywordTok{vector}\NormalTok{(}\DataTypeTok{mode =} \StringTok{"list"}\NormalTok{, }\DataTypeTok{length =}\NormalTok{ it\_N)}
\NormalTok{ls\_2d \textless{}{-}}\StringTok{ }\NormalTok{ls\_2d\_flat}

\CommentTok{\# Named flat}
\NormalTok{ls\_2d\_flat\_named \textless{}{-}}\StringTok{ }\NormalTok{ls\_2d\_flat}
\KeywordTok{names}\NormalTok{(ls\_2d\_flat\_named) \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}e\textquotesingle{}}\NormalTok{,}\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,it\_N))}
\NormalTok{ls\_2d\_named \textless{}{-}}\StringTok{ }\NormalTok{ls\_2d\_flat\_named}

\CommentTok{\# Reshape}
\KeywordTok{dim}\NormalTok{(ls\_2d) \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(it\_M, it\_Q)}
\CommentTok{\# named 2d list can not carry 1d name after reshape}
\KeywordTok{dim}\NormalTok{(ls\_2d\_named) \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(it\_M, it\_Q)}
\end{Highlighting}
\end{Shaded}

Print Various objects generated above, print list flattened.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# display}
\KeywordTok{ffi\_lst2str}\NormalTok{(ls\_2d\_flat\_named)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "ls_2d_flat_named:e1=NULL;e2=NULL;e3=NULL;e4=NULL;e5=NULL;e6=NULL"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# print(ls\_2d\_flat\_named)}
\KeywordTok{ffi\_lst2str}\NormalTok{(ls\_2d\_named)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "ls_2d_named:=NULL;=NULL;=NULL;=NULL;=NULL;=NULL"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(ls\_2d\_named)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      [,1] [,2] [,3]
## [1,] NULL NULL NULL
## [2,] NULL NULL NULL
\end{verbatim}

Select element from list:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Select Values, double bracket to select from 2dim list}
\KeywordTok{print}\NormalTok{(}\StringTok{\textquotesingle{}ls\_2d[[1,2]]\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "ls_2d[[1,2]]"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(ls\_2d[[}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{]])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## NULL
\end{verbatim}

\hypertarget{define-two-dimensional-named-list}{%
\subsubsection{Define Two Dimensional Named LIst}\label{define-two-dimensional-named-list}}

For naming two dimensional lists, \emph{rowname} and \emph{colname} does not work. Rather, we need to use \emph{dimnames}. Note that in addition to dimnames, we can continue to have element specific names. Both can co-exist. But note that the element specific names are not preserved after dimension transform, so need to be redefined afterwards.

How to select an element of a two dimensional list:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  row and column names: \emph{dimnames}, \emph{ls\_2d\_flat\_named{[}{[}`row2',`col2'{]}{]}}
\item
  named elements: \emph{names}, \emph{ls\_2d\_flat\_named{[}{[}`e5'{]}{]}}
\item
  select by index: \emph{index}, \emph{ls\_2d\_flat\_named{[}{[}5{]}{]}}
\item
  converted two dimensional named list to tibble/matrix
\end{enumerate}

Neither \emph{dimnames} nor \emph{names} are required, but both can be used to select elements.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Dimensions}
\NormalTok{it\_M \textless{}{-}}\StringTok{ }\DecValTok{3}
\NormalTok{it\_Q \textless{}{-}}\StringTok{ }\DecValTok{4}
\NormalTok{it\_N \textless{}{-}}\StringTok{ }\NormalTok{it\_M}\OperatorTok{*}\NormalTok{it\_Q}

\CommentTok{\# Initiate an Empty MxQ=N element list}
\NormalTok{ls\_2d\_flat\_named \textless{}{-}}\StringTok{ }\KeywordTok{vector}\NormalTok{(}\DataTypeTok{mode =} \StringTok{"list"}\NormalTok{, }\DataTypeTok{length =}\NormalTok{ it\_N)}
\KeywordTok{dim}\NormalTok{(ls\_2d\_flat\_named) \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(it\_M, it\_Q)}

\CommentTok{\# Fill with values}
\ControlFlowTok{for}\NormalTok{ (it\_Q\_ctr }\ControlFlowTok{in} \KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,it\_Q)) \{}
  \ControlFlowTok{for}\NormalTok{ (it\_M\_ctr }\ControlFlowTok{in} \KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,it\_M)) \{}
    \CommentTok{\# linear index}
\NormalTok{    ls\_2d\_flat\_named[[it\_M\_ctr, it\_Q\_ctr]] \textless{}{-}}\StringTok{ }\NormalTok{(it\_Q\_ctr}\DecValTok{{-}1}\NormalTok{)}\OperatorTok{*}\NormalTok{it\_M}\OperatorTok{+}\NormalTok{it\_M\_ctr}
\NormalTok{  \}}
\NormalTok{\}}

\CommentTok{\# Replace row names, note rownames does not work}
\KeywordTok{dimnames}\NormalTok{(ls\_2d\_flat\_named)[[}\DecValTok{1}\NormalTok{]] \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}row\textquotesingle{}}\NormalTok{,}\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,it\_M))}
\KeywordTok{dimnames}\NormalTok{(ls\_2d\_flat\_named)[[}\DecValTok{2}\NormalTok{]] \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}col\textquotesingle{}}\NormalTok{,}\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,it\_Q))}

\CommentTok{\# Element Specific Names}
\KeywordTok{names}\NormalTok{(ls\_2d\_flat\_named) \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}e\textquotesingle{}}\NormalTok{,}\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,it\_N))}

\CommentTok{\# Convert to Matrix}
\NormalTok{tb\_2d\_flat\_named \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(ls\_2d\_flat\_named) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{unnest}\NormalTok{()}
\NormalTok{mt\_2d\_flat\_named \textless{}{-}}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{(tb\_2d\_flat\_named)}
\end{Highlighting}
\end{Shaded}

Print various objects generated above:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# These are not element names, can still name each element}
\CommentTok{\# display}
\KeywordTok{print}\NormalTok{(}\StringTok{\textquotesingle{}ls\_2d\_flat\_named\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "ls_2d_flat_named"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(ls\_2d\_flat\_named)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      col1 col2 col3 col4
## row1 1    4    7    10  
## row2 2    5    8    11  
## row3 3    6    9    12  
## attr(,"names")
##  [1] "e1"  "e2"  "e3"  "e4"  "e5"  "e6"  "e7"  "e8"  "e9"  "e10" "e11" "e12"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(}\StringTok{\textquotesingle{}tb\_2d\_flat\_named\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "tb_2d_flat_named"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(tb\_2d\_flat\_named)}
\KeywordTok{print}\NormalTok{(}\StringTok{\textquotesingle{}mt\_2d\_flat\_named\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "mt_2d_flat_named"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(mt\_2d\_flat\_named)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      col1 col2 col3 col4
## [1,]    1    4    7   10
## [2,]    2    5    8   11
## [3,]    3    6    9   12
\end{verbatim}

Select elements from list:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Select elements with with dimnames}
\KeywordTok{ffi\_lst2str}\NormalTok{(ls\_2d\_flat\_named[[}\StringTok{\textquotesingle{}row2\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}col2\textquotesingle{}}\NormalTok{]])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "ls_2d_flat_named[[\"row2\", \"col2\"]]:=5"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Select elements with element names}
\KeywordTok{ffi\_lst2str}\NormalTok{(ls\_2d\_flat\_named[[}\StringTok{\textquotesingle{}e5\textquotesingle{}}\NormalTok{]])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "ls_2d_flat_named[[\"e5\"]]:=5"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Select elements with index}
\KeywordTok{ffi\_lst2str}\NormalTok{(ls\_2d\_flat\_named[[}\DecValTok{5}\NormalTok{]])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "ls_2d_flat_named[[5]]:=5"
\end{verbatim}

\hypertarget{array}{%
\section{Array}\label{array}}

\hypertarget{array-basics}{%
\subsection{Array Basics}\label{array-basics}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

\hypertarget{multidimesional-arrays}{%
\subsubsection{Multidimesional Arrays}\label{multidimesional-arrays}}

\hypertarget{repeat-one-number-by-the-size-of-an-array}{%
\paragraph{Repeat one Number by the Size of an Array}\label{repeat-one-number-by-the-size-of-an-array}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ar\_a \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{)}
\NormalTok{ar\_b \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\OperatorTok{/}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{)}
\KeywordTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{, }\KeywordTok{length}\NormalTok{(ar\_a))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0 0 0
\end{verbatim}

\hypertarget{generate-2-dimensional-array}{%
\paragraph{Generate 2 Dimensional Array}\label{generate-2-dimensional-array}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Multidimensional Array}
\CommentTok{\# 1 is r1c1t1, 1.5 in r2c1t1, 0 in r1c2t1, etc.}
\CommentTok{\# Three dimensions, row first, column second, and tensor third}
\NormalTok{x \textless{}{-}}\StringTok{ }\KeywordTok{array}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FloatTok{1.5}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{3}\NormalTok{), }\DataTypeTok{dim=}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{))}
\KeywordTok{dim}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2 2 2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## , , 1
## 
##      [,1] [,2]
## [1,]  1.0    0
## [2,]  1.5    2
## 
## , , 2
## 
##      [,1] [,2]
## [1,]    0    0
## [2,]    4    3
\end{verbatim}

\hypertarget{array-slicing}{%
\subsubsection{Array Slicing}\label{array-slicing}}

\hypertarget{remove-elements-of-array}{%
\paragraph{Remove Elements of Array}\label{remove-elements-of-array}}

Select elements with direct indexing, or with head and tail functions. Get the first two elements of three elements array.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Remove last element of array}
\NormalTok{vars.group.bydf \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}23\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}dfa\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}wer\textquotesingle{}}\NormalTok{)}
\NormalTok{vars.group.bydf[}\OperatorTok{{-}}\KeywordTok{length}\NormalTok{(vars.group.bydf)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "23"  "dfa"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Use the head function to remove last element}
\KeywordTok{head}\NormalTok{(vars.group.bydf, }\DecValTok{{-}1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "23"  "dfa"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(vars.group.bydf, }\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "23"  "dfa"
\end{verbatim}

Get last two elements of array.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Remove first element of array}
\NormalTok{vars.group.bydf \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}23\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}dfa\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}wer\textquotesingle{}}\NormalTok{)}
\NormalTok{vars.group.bydf[}\DecValTok{2}\OperatorTok{:}\KeywordTok{length}\NormalTok{(vars.group.bydf)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "dfa" "wer"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Use Tail function}
\KeywordTok{tail}\NormalTok{(vars.group.bydf, }\DecValTok{{-}1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "dfa" "wer"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tail}\NormalTok{(vars.group.bydf, }\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "dfa" "wer"
\end{verbatim}

\hypertarget{na-in-array}{%
\subsubsection{NA in Array}\label{na-in-array}}

\hypertarget{check-if-na-is-in-array}{%
\paragraph{Check if NA is in Array}\label{check-if-na-is-in-array}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Convert Inf and {-}Inf to NA}
\NormalTok{x \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{{-}1}\NormalTok{, }\OtherTok{Inf}\NormalTok{, }\DecValTok{10}\NormalTok{, }\OperatorTok{{-}}\OtherTok{Inf}\NormalTok{)}
\KeywordTok{na\_if}\NormalTok{(}\KeywordTok{na\_if}\NormalTok{(x, }\OperatorTok{{-}}\OtherTok{Inf}\NormalTok{), }\OtherTok{Inf}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  1 -1 NA 10 NA
\end{verbatim}

\hypertarget{generate-arrays}{%
\subsection{Generate Arrays}\label{generate-arrays}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

\hypertarget{generate-special-arrays}{%
\subsubsection{Generate Special Arrays}\label{generate-special-arrays}}

\hypertarget{log-space-arrays}{%
\paragraph{Log Space Arrays}\label{log-space-arrays}}

Often need to generate arrays on log rather than linear scale, below is log 10 scaled grid.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Parameters}
\NormalTok{it.lower.bd.inc.cnt \textless{}{-}}\StringTok{ }\DecValTok{3}
\NormalTok{fl.log.lower \textless{}{-}}\StringTok{ }\DecValTok{{-}10}
\NormalTok{fl.log.higher \textless{}{-}}\StringTok{ }\DecValTok{{-}9}
\NormalTok{fl.min.rescale \textless{}{-}}\StringTok{ }\FloatTok{0.01}
\NormalTok{it.log.count \textless{}{-}}\StringTok{ }\DecValTok{4}
\CommentTok{\# Generate}
\NormalTok{ar.fl.log.rescaled \textless{}{-}}\StringTok{ }\KeywordTok{exp}\NormalTok{(}\KeywordTok{log}\NormalTok{(}\DecValTok{10}\NormalTok{)}\OperatorTok{*}\KeywordTok{seq}\NormalTok{(}\KeywordTok{log10}\NormalTok{(fl.min.rescale),}
                                      \KeywordTok{log10}\NormalTok{(fl.min.rescale }\OperatorTok{+}
\StringTok{                                              }\NormalTok{(fl.log.higher}\OperatorTok{{-}}\NormalTok{fl.log.lower)),}
                                      \DataTypeTok{length.out=}\NormalTok{it.log.count))}
\NormalTok{ar.fl.log \textless{}{-}}\StringTok{ }\NormalTok{ar.fl.log.rescaled }\OperatorTok{+}\StringTok{ }\NormalTok{fl.log.lower }\OperatorTok{{-}}\StringTok{ }\NormalTok{fl.min.rescale}
\CommentTok{\# Print}
\NormalTok{ar.fl.log}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] -10.000000  -9.963430  -9.793123  -9.000000
\end{verbatim}

\hypertarget{string-arrays}{%
\subsection{String Arrays}\label{string-arrays}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

\hypertarget{string-replace}{%
\subsubsection{String Replace}\label{string-replace}}

\begin{itemize}
\tightlist
\item
  r string wildcard replace between regex
\item
  \href{https://stackoverflow.com/a/27246520/8280804}{R - replace part of a string using wildcards}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# String replacement}
\KeywordTok{gsub}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{paste0}\NormalTok{(}\KeywordTok{unique}\NormalTok{(df.slds.stats.perc}\OperatorTok{$}\NormalTok{it.inner.counter), }\StringTok{\textquotesingle{}:\textquotesingle{}}\NormalTok{,}
                \KeywordTok{unique}\NormalTok{(df.slds.stats.perc}\OperatorTok{$}\NormalTok{z\_n\_a\_n), }\DataTypeTok{collapse =} \StringTok{\textquotesingle{};\textquotesingle{}}\NormalTok{),}
     \DataTypeTok{pattern =} \StringTok{"}\CharTok{\textbackslash{}n}\StringTok{"}\NormalTok{,}
     \DataTypeTok{replacement =} \StringTok{""}\NormalTok{)}
\KeywordTok{gsub}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ var,  }\DataTypeTok{pattern =} \StringTok{"}\CharTok{\textbackslash{}n}\StringTok{"}\NormalTok{, }\DataTypeTok{replacement =} \StringTok{""}\NormalTok{)}
\KeywordTok{gsub}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ var.input,  }\DataTypeTok{pattern =} \StringTok{"}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{."}\NormalTok{, }\DataTypeTok{replacement =} \StringTok{"\_"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

String replaces a segment, search by wildcard. Given the string below, delete all text between carriage return and pound sign:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{st\_tex\_text \textless{}{-}}\StringTok{ "}\CharTok{\textbackslash{}n}\StringTok{\% Lat2ex Comments}\CharTok{\textbackslash{}n\textbackslash{}\textbackslash{}}\StringTok{newcommand\{}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{exa\}\{}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{text\{from external file: \} }\CharTok{\textbackslash{}\textbackslash{}}\StringTok{alpha + }\CharTok{\textbackslash{}\textbackslash{}}\StringTok{beta\}}\CharTok{\textbackslash{}n}\StringTok{\% More LaLatex Comments}\CharTok{\textbackslash{}n}\StringTok{"}
\NormalTok{st\_clean\_a1 \textless{}{-}}\StringTok{ }\KeywordTok{gsub}\NormalTok{(}\StringTok{"}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{\%.*?}\CharTok{\textbackslash{}\textbackslash{}\textbackslash{}n}\StringTok{"}\NormalTok{, }\StringTok{""}\NormalTok{, st\_tex\_text)}
\NormalTok{st\_clean\_a2 \textless{}{-}}\StringTok{ }\KeywordTok{gsub}\NormalTok{(}\StringTok{"L.*?x"}\NormalTok{, }\StringTok{"[LATEX]"}\NormalTok{, st\_tex\_text)}
\KeywordTok{print}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}st\_tex\_text:\textquotesingle{}}\NormalTok{, st\_tex\_text))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "st_tex_text:\n% Lat2ex Comments\n\\newcommand{\\exa}{\\text{from external file: } \\alpha + \\beta}\n% More LaLatex Comments\n"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}st\_clean\_a1:\textquotesingle{}}\NormalTok{, st\_clean\_a1))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "st_clean_a1:\n\\newcommand{\\exa}{\\text{from external file: } \\alpha + \\beta}\n"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}st\_clean\_a2:\textquotesingle{}}\NormalTok{, st\_clean\_a2))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "st_clean_a2:\n% [LATEX] Comments\n\\newcommand{\\exa}{\\text{from external file: } \\alpha + \\beta}\n% More [LATEX] Comments\n"
\end{verbatim}

String delete after a particular string:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{st\_tex\_text \textless{}{-}}\StringTok{ "}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{end\{equation\}}\CharTok{\textbackslash{}n}\StringTok{\}}\CharTok{\textbackslash{}n}\StringTok{\% Even more comments from Latex preamble"}
\NormalTok{st\_clean\_a1 \textless{}{-}}\StringTok{ }\KeywordTok{gsub}\NormalTok{(}\StringTok{"}\CharTok{\textbackslash{}\textbackslash{}\textbackslash{}n}\StringTok{\%.*"}\NormalTok{,}\StringTok{""}\NormalTok{, st\_tex\_text)}
\KeywordTok{print}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}st\_tex\_text:\textquotesingle{}}\NormalTok{, st\_tex\_text))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "st_tex_text:\\end{equation}\n}\n% Even more comments from Latex preamble"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}st\_clean\_a1:\textquotesingle{}}\NormalTok{, st\_clean\_a1))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "st_clean_a1:\\end{equation}\n}"
\end{verbatim}

\hypertarget{search-if-and-which-string-contains}{%
\paragraph{Search If and Which String Contains}\label{search-if-and-which-string-contains}}

\begin{itemize}
\tightlist
\item
  r if string contains
\item
  r if string contains either or grepl
\item
  \href{https://stackoverflow.com/a/26319765/8280804}{Use grepl to search either of multiple substrings in a text}
\end{itemize}

Search for a single substring in a single string:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{st\_example\_a \textless{}{-}}\StringTok{ \textquotesingle{}C:/Users/fan/R4Econ/amto/tibble/fs\_tib\_basics.Rmd\textquotesingle{}}
\NormalTok{st\_example\_b \textless{}{-}}\StringTok{ \textquotesingle{}C:/Users/fan/R4Econ/amto/tibble/\_main.html\textquotesingle{}}
\KeywordTok{grepl}\NormalTok{(}\StringTok{\textquotesingle{}\_main\textquotesingle{}}\NormalTok{, st\_example\_a)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{grepl}\NormalTok{(}\StringTok{\textquotesingle{}\_main\textquotesingle{}}\NormalTok{, st\_example\_b)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] TRUE
\end{verbatim}

Search for if one of a set of substring exists in a set of strings. In particular which one of the elements of \emph{ls\_spn} contains at least one of the elements of \emph{ls\_str\_if\_contains}. In the example below, only the first path does not contain either the word \emph{aggregate} or \emph{index} in the path. This can be used after all paths have been found recursively in some folder to select only desired paths from the full set of possibilities:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ls\_spn \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"C:/Users/fan/R4Econ//panel/basic/fs\_genpanel.Rmd"}\NormalTok{,}
            \StringTok{"C:/Users/fan/R4Econ//summarize/aggregate/main.Rmd"}\NormalTok{,}
            \StringTok{"C:/Users/fan/R4Econ//summarize/index/fs\_index\_populate.Rmd"}\NormalTok{)}
\NormalTok{ls\_str\_if\_contains \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"aggregate"}\NormalTok{, }\StringTok{"index"}\NormalTok{)}
\NormalTok{str\_if\_contains \textless{}{-}}\StringTok{ }\KeywordTok{paste}\NormalTok{(ls\_str\_if\_contains, }\DataTypeTok{collapse =} \StringTok{"|"}\NormalTok{)}
\KeywordTok{grepl}\NormalTok{(str\_if\_contains, ls\_spn)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE  TRUE  TRUE
\end{verbatim}

\hypertarget{string-concatenate}{%
\subsubsection{String Concatenate}\label{string-concatenate}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Simple Collapse}
\NormalTok{vars.group.by \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}abc\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}efg\textquotesingle{}}\NormalTok{)}
\KeywordTok{paste0}\NormalTok{(vars.group.by, }\DataTypeTok{collapse=}\StringTok{\textquotesingle{}|\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "abc|efg"
\end{verbatim}

\hypertarget{string-add-leading-zero}{%
\subsubsection{String Add Leading Zero}\label{string-add-leading-zero}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Add Leading zero for integer values to allow for sorting when}
\CommentTok{\# integers are combined into strings}
\NormalTok{it\_z\_n \textless{}{-}}\StringTok{ }\DecValTok{1}
\NormalTok{it\_a\_n \textless{}{-}}\StringTok{ }\DecValTok{192}
\KeywordTok{print}\NormalTok{(}\KeywordTok{sprintf}\NormalTok{(}\StringTok{"\%02d"}\NormalTok{, it\_z\_n))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "01"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(}\KeywordTok{sprintf}\NormalTok{(}\StringTok{"\%04d"}\NormalTok{, it\_a\_n))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "0192"
\end{verbatim}

\hypertarget{substring-and-file-name}{%
\subsubsection{Substring and File Name}\label{substring-and-file-name}}

From path, get file name without suffix.

\begin{itemize}
\tightlist
\item
  r string split
\item
  \href{https://stackoverflow.com/a/83222/8280804}{r list last element}
\item
  \href{https://stackoverflow.com/a/29114007/8280804}{r get file name from path}
\item
  \href{https://stackoverflow.com/a/47189541/8280804}{r get file path no name}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{st\_example \textless{}{-}}\StringTok{ \textquotesingle{}C:/Users/fan/R4Econ/amto/tibble/fs\_tib\_basics.Rmd\textquotesingle{}}
\NormalTok{st\_file\_wth\_suffix \textless{}{-}}\StringTok{ }\KeywordTok{tail}\NormalTok{(}\KeywordTok{strsplit}\NormalTok{(st\_example, }\StringTok{"/"}\NormalTok{)[[}\DecValTok{1}\NormalTok{]],}\DataTypeTok{n=}\DecValTok{1}\NormalTok{)}
\NormalTok{st\_file\_wno\_suffix \textless{}{-}}\StringTok{ }\KeywordTok{sub}\NormalTok{(}\StringTok{\textquotesingle{}}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{.Rmd$\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{, }\KeywordTok{basename}\NormalTok{(st\_example))}
\NormalTok{st\_fullpath\_nosufx \textless{}{-}}\StringTok{ }\KeywordTok{sub}\NormalTok{(}\StringTok{\textquotesingle{}}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{.Rmd$\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{, st\_example)}
\NormalTok{st\_lastpath\_noname \textless{}{-}}\StringTok{ }\NormalTok{(}\KeywordTok{dirname}\NormalTok{(st\_example))}
\NormalTok{st\_fullpath\_noname \textless{}{-}}\StringTok{ }\KeywordTok{dirname}\NormalTok{(st\_example)}

\KeywordTok{print}\NormalTok{(}\KeywordTok{strsplit}\NormalTok{(st\_example, }\StringTok{"/"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [[1]]
## [1] "C:"                "Users"             "fan"               "R4Econ"            "amto"              "tibble"            "fs_tib_basics.Rmd"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(st\_file\_wth\_suffix)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "fs_tib_basics.Rmd"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(st\_file\_wno\_suffix)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "fs_tib_basics"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(st\_fullpath\_nosufx)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "C:/Users/fan/R4Econ/amto/tibble/fs_tib_basics"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(st\_lastpath\_noname)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "C:/Users/fan/R4Econ/amto/tibble"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(st\_fullpath\_noname)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "C:/Users/fan/R4Econ/amto/tibble"
\end{verbatim}

\hypertarget{mesh-matrices-arrays-and-scalars}{%
\subsection{Mesh Matrices, Arrays and Scalars}\label{mesh-matrices-arrays-and-scalars}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

\begin{itemize}
\tightlist
\item
  r expand.grid meshed array to matrix
\item
  r meshgrid
\item
  r array to matrix
\item
  r reshape array to matrix
\item
  dplyr permuations rows of matrix and element of array
\item
  tidyr expand\_grid mesh matrix and vector
\end{itemize}

\hypertarget{mesh-two-or-more-vectors-with-expand_grid}{%
\subsubsection{Mesh Two or More Vectors with expand\_grid}\label{mesh-two-or-more-vectors-with-expand_grid}}

In the example below, we have a matrix that is 2 by 2 (endogenous states), a vector that is 3 by 1 (choices), and another matrix that is 4 by 3 (exogenous states shocks).

We want to generate a tibble dataset that meshes the matrix and the vector, so that all combinations show up. Additionally, we want to add some additional values that are common across all rows to the meshed dataframe.

Note \emph{expand\_grid} is a from tidyr 1.0.0.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# A. Generate the 5 by 2 Matrix (ENDO STATES)}
\CommentTok{\# it\_child\_count = N, the number of children}
\NormalTok{it\_N\_child\_cnt =}\StringTok{ }\DecValTok{2}
\CommentTok{\# P fixed parameters, nN is N dimensional, nP is P dimensional}
\NormalTok{ar\_nN\_A =}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\OperatorTok{{-}}\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DataTypeTok{length.out =}\NormalTok{ it\_N\_child\_cnt)}
\NormalTok{ar\_nN\_alpha =}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\FloatTok{0.1}\NormalTok{, }\FloatTok{0.9}\NormalTok{, }\DataTypeTok{length.out =}\NormalTok{ it\_N\_child\_cnt)}
\NormalTok{fl\_rho =}\StringTok{ }\FloatTok{0.1}
\NormalTok{fl\_lambda =}\StringTok{ }\FloatTok{1.1}
\NormalTok{mt\_nP\_A\_alpha =}\StringTok{ }\KeywordTok{cbind}\NormalTok{(ar\_nN\_A, ar\_nN\_alpha, fl\_rho, fl\_lambda)}
\NormalTok{ar\_st\_varnames \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}s\_A\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}s\_alpha\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}p\_rho\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}p\_lambda\textquotesingle{}}\NormalTok{)}
\NormalTok{tb\_states\_endo \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(mt\_nP\_A\_alpha) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{rename\_all}\NormalTok{(}\OperatorTok{\textasciitilde{}}\KeywordTok{c}\NormalTok{(ar\_st\_varnames)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{rowid\_to\_column}\NormalTok{(}\DataTypeTok{var =} \StringTok{"state\_id"}\NormalTok{) }

\CommentTok{\# B. Choice Grid}
\NormalTok{it\_N\_choice\_cnt =}\StringTok{ }\DecValTok{3}
\NormalTok{fl\_max =}\StringTok{ }\DecValTok{10}
\NormalTok{fl\_min =}\StringTok{ }\DecValTok{0}
\NormalTok{ar\_nN\_d =}\StringTok{ }\KeywordTok{seq}\NormalTok{(fl\_min, fl\_max, }\DataTypeTok{length.out =}\NormalTok{ it\_N\_choice\_cnt)}
\NormalTok{ar\_st\_varnames \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}c\_food\textquotesingle{}}\NormalTok{)}
\NormalTok{tb\_choices \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(ar\_nN\_d) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{rename\_all}\NormalTok{(}\OperatorTok{\textasciitilde{}}\KeywordTok{c}\NormalTok{(ar\_st\_varnames)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{rowid\_to\_column}\NormalTok{(}\DataTypeTok{var =} \StringTok{"choice\_id"}\NormalTok{) }

\CommentTok{\# C. Shock Grid}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{123}\NormalTok{)}
\NormalTok{it\_N\_shock\_cnt =}\StringTok{ }\DecValTok{4}
\NormalTok{ar\_nQ\_shocks =}\StringTok{ }\KeywordTok{exp}\NormalTok{(}\KeywordTok{rnorm}\NormalTok{(it\_N\_shock\_cnt, }\DataTypeTok{mean=}\DecValTok{0}\NormalTok{, }\DataTypeTok{sd=}\DecValTok{1}\NormalTok{))}
\NormalTok{ar\_st\_varnames \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}s\_eps\textquotesingle{}}\NormalTok{)}
\NormalTok{tb\_states\_exo \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(ar\_nQ\_shocks) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{rename\_all}\NormalTok{(}\OperatorTok{\textasciitilde{}}\KeywordTok{c}\NormalTok{(ar\_st\_varnames)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{rowid\_to\_column}\NormalTok{(}\DataTypeTok{var =} \StringTok{"shock\_id"}\NormalTok{) }

\CommentTok{\# dataframe expand with other non expanded variables}
\NormalTok{ar\_st\_varnames \textless{}{-}}\StringTok{ }
\NormalTok{tb\_states\_shk\_choices \textless{}{-}}\StringTok{ }\NormalTok{tb\_states\_endo }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{expand\_grid}\NormalTok{(tb\_choices) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{expand\_grid}\NormalTok{(tb\_states\_exo) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{select}\NormalTok{(state\_id, choice\_id, shock\_id, }
\NormalTok{         s\_A, s\_alpha, s\_eps, c\_food,}
\NormalTok{         p\_rho, p\_lambda)}
  
\CommentTok{\# display}
\KeywordTok{kable}\NormalTok{(tb\_states\_shk\_choices) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r|r|r|r|r|r|r}
\hline
state\_id & choice\_id & shock\_id & s\_A & s\_alpha & s\_eps & c\_food & p\_rho & p\_lambda\\
\hline
\rowcolor{gray!6}  1 & 1 & 1 & -2 & 0.1 & 0.5709374 & 0 & 0.1 & 1.1\\
\hline
1 & 1 & 2 & -2 & 0.1 & 0.7943926 & 0 & 0.1 & 1.1\\
\hline
\rowcolor{gray!6}  1 & 1 & 3 & -2 & 0.1 & 4.7526783 & 0 & 0.1 & 1.1\\
\hline
1 & 1 & 4 & -2 & 0.1 & 1.0730536 & 0 & 0.1 & 1.1\\
\hline
\rowcolor{gray!6}  1 & 2 & 1 & -2 & 0.1 & 0.5709374 & 5 & 0.1 & 1.1\\
\hline
1 & 2 & 2 & -2 & 0.1 & 0.7943926 & 5 & 0.1 & 1.1\\
\hline
\rowcolor{gray!6}  1 & 2 & 3 & -2 & 0.1 & 4.7526783 & 5 & 0.1 & 1.1\\
\hline
1 & 2 & 4 & -2 & 0.1 & 1.0730536 & 5 & 0.1 & 1.1\\
\hline
\rowcolor{gray!6}  1 & 3 & 1 & -2 & 0.1 & 0.5709374 & 10 & 0.1 & 1.1\\
\hline
1 & 3 & 2 & -2 & 0.1 & 0.7943926 & 10 & 0.1 & 1.1\\
\hline
\rowcolor{gray!6}  1 & 3 & 3 & -2 & 0.1 & 4.7526783 & 10 & 0.1 & 1.1\\
\hline
1 & 3 & 4 & -2 & 0.1 & 1.0730536 & 10 & 0.1 & 1.1\\
\hline
\rowcolor{gray!6}  2 & 1 & 1 & 2 & 0.9 & 0.5709374 & 0 & 0.1 & 1.1\\
\hline
2 & 1 & 2 & 2 & 0.9 & 0.7943926 & 0 & 0.1 & 1.1\\
\hline
\rowcolor{gray!6}  2 & 1 & 3 & 2 & 0.9 & 4.7526783 & 0 & 0.1 & 1.1\\
\hline
2 & 1 & 4 & 2 & 0.9 & 1.0730536 & 0 & 0.1 & 1.1\\
\hline
\rowcolor{gray!6}  2 & 2 & 1 & 2 & 0.9 & 0.5709374 & 5 & 0.1 & 1.1\\
\hline
2 & 2 & 2 & 2 & 0.9 & 0.7943926 & 5 & 0.1 & 1.1\\
\hline
\rowcolor{gray!6}  2 & 2 & 3 & 2 & 0.9 & 4.7526783 & 5 & 0.1 & 1.1\\
\hline
2 & 2 & 4 & 2 & 0.9 & 1.0730536 & 5 & 0.1 & 1.1\\
\hline
\rowcolor{gray!6}  2 & 3 & 1 & 2 & 0.9 & 0.5709374 & 10 & 0.1 & 1.1\\
\hline
2 & 3 & 2 & 2 & 0.9 & 0.7943926 & 10 & 0.1 & 1.1\\
\hline
\rowcolor{gray!6}  2 & 3 & 3 & 2 & 0.9 & 4.7526783 & 10 & 0.1 & 1.1\\
\hline
2 & 3 & 4 & 2 & 0.9 & 1.0730536 & 10 & 0.1 & 1.1\\
\hline
\end{tabular}
\end{table}

Using expand\_grid directly over arrays

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# expand grid with dplyr}
\KeywordTok{expand\_grid}\NormalTok{(}\DataTypeTok{x =} \DecValTok{1}\OperatorTok{:}\DecValTok{3}\NormalTok{, }\DataTypeTok{y =} \DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{, }\DataTypeTok{z =} \DecValTok{{-}3}\OperatorTok{:{-}}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{mesh-arrays-with-expand.grid}{%
\subsubsection{Mesh Arrays with expand.grid}\label{mesh-arrays-with-expand.grid}}

Given two arrays, mesh the two arrays together.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# use expand.grid to generate all combinations of two arrays}

\NormalTok{it\_ar\_A =}\StringTok{ }\DecValTok{5}
\NormalTok{it\_ar\_alpha =}\StringTok{ }\DecValTok{10}

\NormalTok{ar\_A =}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\OperatorTok{{-}}\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DataTypeTok{length.out=}\NormalTok{it\_ar\_A)}
\NormalTok{ar\_alpha =}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\FloatTok{0.1}\NormalTok{, }\FloatTok{0.9}\NormalTok{, }\DataTypeTok{length.out=}\NormalTok{it\_ar\_alpha)}

\NormalTok{mt\_A\_alpha =}\StringTok{ }\KeywordTok{expand.grid}\NormalTok{(}\DataTypeTok{A =}\NormalTok{ ar\_A, }\DataTypeTok{alpha =}\NormalTok{ ar\_alpha)}

\NormalTok{mt\_A\_meshed =}\StringTok{ }\NormalTok{mt\_A\_alpha[,}\DecValTok{1}\NormalTok{]}
\KeywordTok{dim}\NormalTok{(mt\_A\_meshed) =}\StringTok{ }\KeywordTok{c}\NormalTok{(it\_ar\_A, it\_ar\_alpha)}

\NormalTok{mt\_alpha\_meshed =}\StringTok{ }\NormalTok{mt\_A\_alpha[,}\DecValTok{2}\NormalTok{]}
\KeywordTok{dim}\NormalTok{(mt\_alpha\_meshed) =}\StringTok{ }\KeywordTok{c}\NormalTok{(it\_ar\_A, it\_ar\_alpha)}

\CommentTok{\# display}
\KeywordTok{kable}\NormalTok{(mt\_A\_meshed) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r|r|r|r|r|r|r|r}
\hline
-2 & -2 & -2 & -2 & -2 & -2 & -2 & -2 & -2 & -2\\
\hline
\rowcolor{gray!6}  -1 & -1 & -1 & -1 & -1 & -1 & -1 & -1 & -1 & -1\\
\hline
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\
\hline
\rowcolor{gray!6}  1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1\\
\hline
2 & 2 & 2 & 2 & 2 & 2 & 2 & 2 & 2 & 2\\
\hline
\end{tabular}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{kable}\NormalTok{(mt\_alpha\_meshed) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{r|r|r|r|r|r|r|r|r|r}
\hline
0.1 & 0.1888889 & 0.2777778 & 0.3666667 & 0.4555556 & 0.5444444 & 0.6333333 & 0.7222222 & 0.8111111 & \vphantom{4} 0.9\\
\hline
\rowcolor{gray!6}  0.1 & 0.1888889 & 0.2777778 & 0.3666667 & 0.4555556 & 0.5444444 & 0.6333333 & 0.7222222 & 0.8111111 & \vphantom{3} 0.9\\
\hline
0.1 & 0.1888889 & 0.2777778 & 0.3666667 & 0.4555556 & 0.5444444 & 0.6333333 & 0.7222222 & 0.8111111 & \vphantom{2} 0.9\\
\hline
\rowcolor{gray!6}  0.1 & 0.1888889 & 0.2777778 & 0.3666667 & 0.4555556 & 0.5444444 & 0.6333333 & 0.7222222 & 0.8111111 & \vphantom{1} 0.9\\
\hline
0.1 & 0.1888889 & 0.2777778 & 0.3666667 & 0.4555556 & 0.5444444 & 0.6333333 & 0.7222222 & 0.8111111 & 0.9\\
\hline
\end{tabular}}
\end{table}

Two Identical Arrays, individual attributes, each column is an individual for a matrix, and each row is also an individual.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# use expand.grid to generate all combinations of two arrays}

\NormalTok{it\_ar\_A =}\StringTok{ }\DecValTok{5}

\NormalTok{ar\_A =}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\OperatorTok{{-}}\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DataTypeTok{length.out=}\NormalTok{it\_ar\_A)}
\NormalTok{mt\_A\_A =}\StringTok{ }\KeywordTok{expand.grid}\NormalTok{(}\DataTypeTok{Arow =}\NormalTok{ ar\_A, }\DataTypeTok{Arow =}\NormalTok{ ar\_A)}
\NormalTok{mt\_Arow =}\StringTok{ }\NormalTok{mt\_A\_A[,}\DecValTok{1}\NormalTok{]}
\KeywordTok{dim}\NormalTok{(mt\_Arow) =}\StringTok{ }\KeywordTok{c}\NormalTok{(it\_ar\_A, it\_ar\_A)}
\NormalTok{mt\_Acol =}\StringTok{ }\NormalTok{mt\_A\_A[,}\DecValTok{2}\NormalTok{]}
\KeywordTok{dim}\NormalTok{(mt\_Acol) =}\StringTok{ }\KeywordTok{c}\NormalTok{(it\_ar\_A, it\_ar\_A)}

\CommentTok{\# display}
\KeywordTok{kable}\NormalTok{(mt\_Arow) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r|r|r}
\hline
-2 & -2 & -2 & -2 & -2\\
\hline
\rowcolor{gray!6}  -1 & -1 & -1 & -1 & -1\\
\hline
0 & 0 & 0 & 0 & 0\\
\hline
\rowcolor{gray!6}  1 & 1 & 1 & 1 & 1\\
\hline
2 & 2 & 2 & 2 & 2\\
\hline
\end{tabular}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{kable}\NormalTok{(mt\_Acol) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r|r|r}
\hline
-2 & -1 & 0 & 1 & \vphantom{4} 2\\
\hline
\rowcolor{gray!6}  -2 & -1 & 0 & 1 & \vphantom{3} 2\\
\hline
-2 & -1 & 0 & 1 & \vphantom{2} 2\\
\hline
\rowcolor{gray!6}  -2 & -1 & 0 & 1 & \vphantom{1} 2\\
\hline
-2 & -1 & 0 & 1 & 2\\
\hline
\end{tabular}
\end{table}

\hypertarget{matrix}{%
\section{Matrix}\label{matrix}}

\hypertarget{generate-matrixes}{%
\subsection{Generate Matrixes}\label{generate-matrixes}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

\hypertarget{create-a-n-by-2-matrix-from-3-arrays}{%
\subsubsection{Create a N by 2 Matrix from 3 arrays}\label{create-a-n-by-2-matrix-from-3-arrays}}

Names of each array become row names automatically.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ar\_row\_one \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\OperatorTok{{-}}\DecValTok{1}\NormalTok{,}\OperatorTok{+}\DecValTok{1}\NormalTok{)}
\NormalTok{ar\_row\_two \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\OperatorTok{{-}}\DecValTok{3}\NormalTok{,}\OperatorTok{{-}}\DecValTok{2}\NormalTok{)}
\NormalTok{ar\_row\_three \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\FloatTok{0.35}\NormalTok{,}\FloatTok{0.75}\NormalTok{)}

\NormalTok{mt\_n\_by\_}\DecValTok{2}\NormalTok{ \textless{}{-}}\StringTok{ }\KeywordTok{rbind}\NormalTok{(ar\_row\_one, ar\_row\_two, ar\_row\_three)}
\KeywordTok{kable}\NormalTok{(mt\_n\_by\_}\DecValTok{2}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{l|r|r}
\hline
ar\_row\_one & -1.00 & 1.00\\
\hline
\rowcolor{gray!6}  ar\_row\_two & -3.00 & -2.00\\
\hline
ar\_row\_three & 0.35 & 0.75\\
\hline
\end{tabular}
\end{table}

\hypertarget{name-matrix-columns-and-rows}{%
\subsubsection{Name Matrix Columns and Rows}\label{name-matrix-columns-and-rows}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# An empty matrix with Logical NA}
\NormalTok{mt\_named \textless{}{-}}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\DataTypeTok{data=}\OtherTok{NA}\NormalTok{, }\DataTypeTok{nrow=}\DecValTok{2}\NormalTok{, }\DataTypeTok{ncol=}\DecValTok{2}\NormalTok{)}
\KeywordTok{colnames}\NormalTok{(mt\_named) \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}c\textquotesingle{}}\NormalTok{, }\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{))}
\KeywordTok{rownames}\NormalTok{(mt\_named) \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}r\textquotesingle{}}\NormalTok{, }\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{))}
\NormalTok{mt\_named}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    c1 c2
## r1 NA NA
## r2 NA NA
\end{verbatim}

\hypertarget{generate-na-matrix}{%
\subsubsection{Generate NA Matrix}\label{generate-na-matrix}}

\begin{itemize}
\tightlist
\item
  \href{https://stackoverflow.com/a/26724451/8280804}{Best way to allocate matrix in R, NULL vs NA?}
\end{itemize}

Allocate with NA or NA\_real\_ or NA\_int\_. Clarity in type definition is preferred.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# An empty matrix with Logical NA}
\NormalTok{mt\_na \textless{}{-}}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\DataTypeTok{data=}\OtherTok{NA}\NormalTok{, }\DataTypeTok{nrow=}\DecValTok{2}\NormalTok{, }\DataTypeTok{ncol=}\DecValTok{2}\NormalTok{)}
\KeywordTok{str}\NormalTok{(mt\_na)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  logi [1:2, 1:2] NA NA NA NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# An empty matrix with numerica NA}
\NormalTok{mt\_fl\_na \textless{}{-}}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\DataTypeTok{data=}\OtherTok{NA\_real\_}\NormalTok{, }\DataTypeTok{nrow=}\DecValTok{2}\NormalTok{, }\DataTypeTok{ncol=}\DecValTok{2}\NormalTok{)}
\NormalTok{mt\_it\_na \textless{}{-}}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\DataTypeTok{data=}\OtherTok{NA\_integer\_}\NormalTok{, }\DataTypeTok{nrow=}\DecValTok{2}\NormalTok{, }\DataTypeTok{ncol=}\DecValTok{2}\NormalTok{)}

\KeywordTok{str}\NormalTok{(mt\_fl\_na)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  num [1:2, 1:2] NA NA NA NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{str}\NormalTok{(mt\_fl\_na)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  num [1:2, 1:2] NA NA NA NA
\end{verbatim}

\hypertarget{generate-random-matrixes}{%
\subsubsection{Generate Random Matrixes}\label{generate-random-matrixes}}

Random draw from the normal distribution, random draw from the uniform distribution, and combine resulting matrixes.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Generate 15 random normal, put in 5 rows, and 3 columns}
\NormalTok{mt\_rnorm \textless{}{-}}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\KeywordTok{rnorm}\NormalTok{(}\DecValTok{15}\NormalTok{,}\DataTypeTok{mean=}\DecValTok{0}\NormalTok{,}\DataTypeTok{sd=}\DecValTok{1}\NormalTok{), }\DataTypeTok{nrow=}\DecValTok{5}\NormalTok{, }\DataTypeTok{ncol=}\DecValTok{3}\NormalTok{)}

\CommentTok{\# Generate 15 random normal, put in 5 rows, and 3 columns}
\NormalTok{mt\_runif \textless{}{-}}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\KeywordTok{runif}\NormalTok{(}\DecValTok{15}\NormalTok{,}\DataTypeTok{min=}\DecValTok{0}\NormalTok{,}\DataTypeTok{max=}\DecValTok{1}\NormalTok{), }\DataTypeTok{nrow=}\DecValTok{5}\NormalTok{, }\DataTypeTok{ncol=}\DecValTok{5}\NormalTok{)}

\CommentTok{\# Combine}
\NormalTok{mt\_rnorm\_runif \textless{}{-}}\StringTok{ }\KeywordTok{cbind}\NormalTok{(mt\_rnorm, mt\_runif)}

\CommentTok{\# Display}
\KeywordTok{kable}\NormalTok{(mt\_rnorm\_runif) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{r|r|r|r|r|r|r|r}
\hline
0.1292877 & -0.4456620 & -0.5558411 & 0.3181810 & 0.3688455 & 0.2659726 & 0.3181810 & 0.3688455\\
\hline
\rowcolor{gray!6}  1.7150650 & 1.2240818 & 1.7869131 & 0.2316258 & 0.1524447 & 0.8578277 & 0.2316258 & 0.1524447\\
\hline
0.4609162 & 0.3598138 & 0.4978505 & 0.1428000 & 0.1388061 & 0.0458312 & 0.1428000 & 0.1388061\\
\hline
\rowcolor{gray!6}  -1.2650612 & 0.4007715 & -1.9666172 & 0.4145463 & 0.2330341 & 0.4422001 & 0.4145463 & 0.2330341\\
\hline
-0.6868529 & 0.1106827 & 0.7013559 & 0.4137243 & 0.4659625 & 0.7989248 & 0.4137243 & 0.4659625\\
\hline
\end{tabular}}
\end{table}

\hypertarget{linear-algebra}{%
\subsection{Linear Algebra}\label{linear-algebra}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

\hypertarget{matrix-multiplication}{%
\subsubsection{Matrix Multiplication}\label{matrix-multiplication}}

Multiply Together a 3 by 2 matrix and a 2 by 1 vector

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ar\_row\_one \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\OperatorTok{{-}}\DecValTok{1}\NormalTok{,}\OperatorTok{+}\DecValTok{1}\NormalTok{)}
\NormalTok{ar\_row\_two \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\OperatorTok{{-}}\DecValTok{3}\NormalTok{,}\OperatorTok{{-}}\DecValTok{2}\NormalTok{)}
\NormalTok{ar\_row\_three \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\FloatTok{0.35}\NormalTok{,}\FloatTok{0.75}\NormalTok{)}
\NormalTok{mt\_n\_by\_}\DecValTok{2}\NormalTok{ \textless{}{-}}\StringTok{ }\KeywordTok{rbind}\NormalTok{(ar\_row\_one, ar\_row\_two, ar\_row\_three)}

\NormalTok{ar\_row\_four \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{)}

\CommentTok{\# Matrix Multiplication}
\NormalTok{mt\_out \textless{}{-}}\StringTok{ }\NormalTok{mt\_n\_by\_}\DecValTok{2} \OperatorTok{\%*\%}\StringTok{ }\NormalTok{ar\_row\_four}
\KeywordTok{print}\NormalTok{(mt\_n\_by\_}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##               [,1]  [,2]
## ar_row_one   -1.00  1.00
## ar_row_two   -3.00 -2.00
## ar_row_three  0.35  0.75
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(ar\_row\_four)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 3 4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(mt\_out)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                [,1]
## ar_row_one     1.00
## ar_row_two   -17.00
## ar_row_three   4.05
\end{verbatim}

\hypertarget{variables-in-dataframes}{%
\section{Variables in Dataframes}\label{variables-in-dataframes}}

\hypertarget{generate-dataframe}{%
\subsection{Generate Dataframe}\label{generate-dataframe}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

\hypertarget{generate-tibble-given-matrixes-and-arrays}{%
\subsubsection{Generate Tibble given Matrixes and Arrays}\label{generate-tibble-given-matrixes-and-arrays}}

Given Arrays and Matrixes, Generate Tibble and Name Variables/Columns

\begin{itemize}
\tightlist
\item
  naming tibble columns
\item
  tibble variable names
\item
  dplyr rename tibble
\item
  dplyr rename tibble all variables
\item
  dplyr rename all columns by index
\item
  dplyr tibble add index column
\item
  see also: \href{https://stackoverflow.com/questions/45535157/difference-between-dplyrrename-and-dplyrrename-all}{SO-51205520}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Base Inputs}
\NormalTok{ar\_col \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\OperatorTok{{-}}\DecValTok{1}\NormalTok{,}\OperatorTok{+}\DecValTok{1}\NormalTok{)}
\NormalTok{mt\_rnorm\_a \textless{}{-}}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\KeywordTok{rnorm}\NormalTok{(}\DecValTok{4}\NormalTok{,}\DataTypeTok{mean=}\DecValTok{0}\NormalTok{,}\DataTypeTok{sd=}\DecValTok{1}\NormalTok{), }\DataTypeTok{nrow=}\DecValTok{2}\NormalTok{, }\DataTypeTok{ncol=}\DecValTok{2}\NormalTok{)}
\NormalTok{mt\_rnorm\_b \textless{}{-}}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\KeywordTok{rnorm}\NormalTok{(}\DecValTok{4}\NormalTok{,}\DataTypeTok{mean=}\DecValTok{0}\NormalTok{,}\DataTypeTok{sd=}\DecValTok{1}\NormalTok{), }\DataTypeTok{nrow=}\DecValTok{2}\NormalTok{, }\DataTypeTok{ncol=}\DecValTok{4}\NormalTok{)}

\CommentTok{\# Combine Matrix}
\NormalTok{mt\_combine \textless{}{-}}\StringTok{ }\KeywordTok{cbind}\NormalTok{(ar\_col, mt\_rnorm\_a, mt\_rnorm\_b)}
\KeywordTok{colnames}\NormalTok{(mt\_combine) \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}ar\_col\textquotesingle{}}\NormalTok{,}
                          \KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}matcolvar\_grpa\_\textquotesingle{}}\NormalTok{, }\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,}\KeywordTok{dim}\NormalTok{(mt\_rnorm\_a)[}\DecValTok{2}\NormalTok{])),}
                          \KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}matcolvar\_grpb\_\textquotesingle{}}\NormalTok{, }\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,}\KeywordTok{dim}\NormalTok{(mt\_rnorm\_b)[}\DecValTok{2}\NormalTok{])))}

\CommentTok{\# Variable Names}
\NormalTok{ar\_st\_varnames \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}var\_one\textquotesingle{}}\NormalTok{,}
                    \KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}tibcolvar\_ga\_\textquotesingle{}}\NormalTok{, }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{)),}
                    \KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}tibcolvar\_gb\_\textquotesingle{}}\NormalTok{, }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{)))}

\CommentTok{\# Combine to tibble, add name col1, col2, etc.}
\NormalTok{tb\_combine \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(mt\_combine) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{rename\_all}\NormalTok{(}\OperatorTok{\textasciitilde{}}\KeywordTok{c}\NormalTok{(ar\_st\_varnames))}

\CommentTok{\# Add an index column to the dataframe, ID column}
\NormalTok{tb\_combine \textless{}{-}}\StringTok{ }\NormalTok{tb\_combine }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{rowid\_to\_column}\NormalTok{(}\DataTypeTok{var =} \StringTok{"ID"}\NormalTok{)}

\CommentTok{\# Change all gb variable names}
\NormalTok{tb\_combine \textless{}{-}}\StringTok{ }\NormalTok{tb\_combine }\OperatorTok{\%\textgreater{}\%}
\StringTok{                  }\KeywordTok{rename\_at}\NormalTok{(}\KeywordTok{vars}\NormalTok{(}\KeywordTok{starts\_with}\NormalTok{(}\StringTok{"tibcolvar\_gb\_"}\NormalTok{)),}
                            \KeywordTok{funs}\NormalTok{(}\KeywordTok{str\_replace}\NormalTok{(., }\StringTok{"\_gb\_"}\NormalTok{, }\StringTok{"\_gbrenamed\_"}\NormalTok{)))}

\CommentTok{\# Tibble back to matrix}
\NormalTok{mt\_tb\_combine\_back \textless{}{-}}\StringTok{ }\KeywordTok{data.matrix}\NormalTok{(tb\_combine)}

\CommentTok{\# Display}
\KeywordTok{kable}\NormalTok{(mt\_combine) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{kable\_styling\_fc\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{r|r|r|r|r|r|r}
\hline
ar\_col & matcolvar\_grpa\_1 & matcolvar\_grpa\_2 & matcolvar\_grpb\_1 & matcolvar\_grpb\_2 & matcolvar\_grpb\_3 & matcolvar\_grpb\_4\\
\hline
\rowcolor{gray!6}  -1 & -1.1655448 & 0.6849361 & -1.3115224 & -0.1294107 & -1.3115224 & -0.1294107\\
\hline
1 & -0.8185157 & -0.3200564 & -0.5996083 & 0.8867361 & -0.5996083 & 0.8867361\\
\hline
\end{tabular}}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{kable}\NormalTok{(tb\_combine) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{kable\_styling\_fc\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{r|r|r|r|r|r|r|r}
\hline
ID & var\_one & tibcolvar\_ga\_1 & tibcolvar\_ga\_2 & tibcolvar\_gbrenamed\_1 & tibcolvar\_gbrenamed\_2 & tibcolvar\_gbrenamed\_3 & tibcolvar\_gbrenamed\_4\\
\hline
\rowcolor{gray!6}  1 & -1 & -1.1655448 & 0.6849361 & -1.3115224 & -0.1294107 & -1.3115224 & -0.1294107\\
\hline
2 & 1 & -0.8185157 & -0.3200564 & -0.5996083 & 0.8867361 & -0.5996083 & 0.8867361\\
\hline
\end{tabular}}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{kable}\NormalTok{(mt\_tb\_combine\_back) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{kable\_styling\_fc\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{r|r|r|r|r|r|r|r}
\hline
ID & var\_one & tibcolvar\_ga\_1 & tibcolvar\_ga\_2 & tibcolvar\_gbrenamed\_1 & tibcolvar\_gbrenamed\_2 & tibcolvar\_gbrenamed\_3 & tibcolvar\_gbrenamed\_4\\
\hline
\rowcolor{gray!6}  1 & -1 & -1.1655448 & 0.6849361 & -1.3115224 & -0.1294107 & -1.3115224 & -0.1294107\\
\hline
2 & 1 & -0.8185157 & -0.3200564 & -0.5996083 & 0.8867361 & -0.5996083 & 0.8867361\\
\hline
\end{tabular}}
\end{table}

\hypertarget{rename-tibble-with-numeric-column-names}{%
\subsubsection{Rename Tibble with Numeric Column Names}\label{rename-tibble-with-numeric-column-names}}

After reshaping, often could end up with variable names that are all numeric, intgers for example, how to rename these variables to add a common prefix for example.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Base Inputs}
\NormalTok{ar\_col \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\OperatorTok{{-}}\DecValTok{1}\NormalTok{,}\OperatorTok{+}\DecValTok{1}\NormalTok{)}
\NormalTok{mt\_rnorm\_c \textless{}{-}}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\KeywordTok{rnorm}\NormalTok{(}\DecValTok{4}\NormalTok{,}\DataTypeTok{mean=}\DecValTok{0}\NormalTok{,}\DataTypeTok{sd=}\DecValTok{1}\NormalTok{), }\DataTypeTok{nrow=}\DecValTok{5}\NormalTok{, }\DataTypeTok{ncol=}\DecValTok{10}\NormalTok{)}
\NormalTok{mt\_combine \textless{}{-}}\StringTok{ }\KeywordTok{cbind}\NormalTok{(ar\_col, mt\_rnorm\_c)}

\CommentTok{\# Variable Names}
\NormalTok{ar\_it\_cols\_ctr \textless{}{-}}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{, }\KeywordTok{dim}\NormalTok{(mt\_rnorm\_c)[}\DecValTok{2}\NormalTok{])}
\NormalTok{ar\_st\_varnames \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}var\_one\textquotesingle{}}\NormalTok{, ar\_it\_cols\_ctr)}

\CommentTok{\# Combine to tibble, add name col1, col2, etc.}
\NormalTok{tb\_combine \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(mt\_combine) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{rename\_all}\NormalTok{(}\OperatorTok{\textasciitilde{}}\KeywordTok{c}\NormalTok{(ar\_st\_varnames))}

\CommentTok{\# Add an index column to the dataframe, ID column}
\NormalTok{tb\_combine\_ori \textless{}{-}}\StringTok{ }\NormalTok{tb\_combine }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{rowid\_to\_column}\NormalTok{(}\DataTypeTok{var =} \StringTok{"ID"}\NormalTok{)}

\CommentTok{\# Change all gb variable names}
\NormalTok{tb\_combine \textless{}{-}}\StringTok{ }\NormalTok{tb\_combine\_ori }\OperatorTok{\%\textgreater{}\%}
\StringTok{                  }\KeywordTok{rename\_at}\NormalTok{(}
                    \KeywordTok{vars}\NormalTok{(}\KeywordTok{num\_range}\NormalTok{(}\StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{,ar\_it\_cols\_ctr)),}
                    \KeywordTok{funs}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{"rho"}\NormalTok{, . , }\StringTok{\textquotesingle{}var\textquotesingle{}}\NormalTok{))}
\NormalTok{                    )}

\CommentTok{\# Display}
\KeywordTok{kable}\NormalTok{(tb\_combine\_ori) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{kable\_styling\_fc\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{r|r|r|r|r|r|r|r|r|r|r|r}
\hline
ID & var\_one & 1 & 2 & 3 & 4 & 5 & 6 & 7 & 8 & 9 & 10\\
\hline
\rowcolor{gray!6}  1 & -1 & -0.1513960 & 0.3297912 & -3.2273228 & -0.7717918 & -0.1513960 & 0.3297912 & -3.2273228 & -0.7717918 & -0.1513960 & 0.3297912\\
\hline
2 & 1 & 0.3297912 & -3.2273228 & -0.7717918 & -0.1513960 & 0.3297912 & -3.2273228 & -0.7717918 & -0.1513960 & 0.3297912 & -3.2273228\\
\hline
\rowcolor{gray!6}  3 & -1 & -3.2273228 & -0.7717918 & -0.1513960 & 0.3297912 & -3.2273228 & -0.7717918 & -0.1513960 & 0.3297912 & -3.2273228 & -0.7717918\\
\hline
4 & 1 & -0.7717918 & -0.1513960 & 0.3297912 & -3.2273228 & -0.7717918 & -0.1513960 & 0.3297912 & -3.2273228 & -0.7717918 & -0.1513960\\
\hline
\rowcolor{gray!6}  5 & -1 & -0.1513960 & 0.3297912 & -3.2273228 & -0.7717918 & -0.1513960 & 0.3297912 & -3.2273228 & -0.7717918 & -0.1513960 & 0.3297912\\
\hline
\end{tabular}}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{kable}\NormalTok{(tb\_combine) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{kable\_styling\_fc\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{r|r|r|r|r|r|r|r|r|r|r|r}
\hline
ID & var\_one & rho1var & rho2var & rho3var & rho4var & rho5var & rho6var & rho7var & rho8var & rho9var & rho10var\\
\hline
\rowcolor{gray!6}  1 & -1 & -0.1513960 & 0.3297912 & -3.2273228 & -0.7717918 & -0.1513960 & 0.3297912 & -3.2273228 & -0.7717918 & -0.1513960 & 0.3297912\\
\hline
2 & 1 & 0.3297912 & -3.2273228 & -0.7717918 & -0.1513960 & 0.3297912 & -3.2273228 & -0.7717918 & -0.1513960 & 0.3297912 & -3.2273228\\
\hline
\rowcolor{gray!6}  3 & -1 & -3.2273228 & -0.7717918 & -0.1513960 & 0.3297912 & -3.2273228 & -0.7717918 & -0.1513960 & 0.3297912 & -3.2273228 & -0.7717918\\
\hline
4 & 1 & -0.7717918 & -0.1513960 & 0.3297912 & -3.2273228 & -0.7717918 & -0.1513960 & 0.3297912 & -3.2273228 & -0.7717918 & -0.1513960\\
\hline
\rowcolor{gray!6}  5 & -1 & -0.1513960 & 0.3297912 & -3.2273228 & -0.7717918 & -0.1513960 & 0.3297912 & -3.2273228 & -0.7717918 & -0.1513960 & 0.3297912\\
\hline
\end{tabular}}
\end{table}

\hypertarget{tibble-row-and-column-and-summarize}{%
\subsubsection{Tibble Row and Column and Summarize}\label{tibble-row-and-column-and-summarize}}

Show what is in the table: 1, column and row names; 2, contents inside table.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tb\_iris \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(iris)}
\KeywordTok{print}\NormalTok{(}\KeywordTok{rownames}\NormalTok{(tb\_iris))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   [1] "1"   "2"   "3"   "4"   "5"   "6"   "7"   "8"   "9"   "10"  "11"  "12"  "13"  "14"  "15"  "16"  "17"  "18"  "19"  "20"  "21"  "22"  "23"  "24" 
##  [25] "25"  "26"  "27"  "28"  "29"  "30"  "31"  "32"  "33"  "34"  "35"  "36"  "37"  "38"  "39"  "40"  "41"  "42"  "43"  "44"  "45"  "46"  "47"  "48" 
##  [49] "49"  "50"  "51"  "52"  "53"  "54"  "55"  "56"  "57"  "58"  "59"  "60"  "61"  "62"  "63"  "64"  "65"  "66"  "67"  "68"  "69"  "70"  "71"  "72" 
##  [73] "73"  "74"  "75"  "76"  "77"  "78"  "79"  "80"  "81"  "82"  "83"  "84"  "85"  "86"  "87"  "88"  "89"  "90"  "91"  "92"  "93"  "94"  "95"  "96" 
##  [97] "97"  "98"  "99"  "100" "101" "102" "103" "104" "105" "106" "107" "108" "109" "110" "111" "112" "113" "114" "115" "116" "117" "118" "119" "120"
## [121] "121" "122" "123" "124" "125" "126" "127" "128" "129" "130" "131" "132" "133" "134" "135" "136" "137" "138" "139" "140" "141" "142" "143" "144"
## [145] "145" "146" "147" "148" "149" "150"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{colnames}\NormalTok{(tb\_iris)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Sepal.Length" "Sepal.Width"  "Petal.Length" "Petal.Width"  "Species"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{colnames}\NormalTok{(tb\_iris)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Sepal.Length" "Sepal.Width"  "Petal.Length" "Petal.Width"  "Species"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(tb\_iris)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   Sepal.Length    Sepal.Width     Petal.Length    Petal.Width          Species  
##  Min.   :4.300   Min.   :2.000   Min.   :1.000   Min.   :0.100   setosa    :50  
##  1st Qu.:5.100   1st Qu.:2.800   1st Qu.:1.600   1st Qu.:0.300   versicolor:50  
##  Median :5.800   Median :3.000   Median :4.350   Median :1.300   virginica :50  
##  Mean   :5.843   Mean   :3.057   Mean   :3.758   Mean   :1.199                  
##  3rd Qu.:6.400   3rd Qu.:3.300   3rd Qu.:5.100   3rd Qu.:1.800                  
##  Max.   :7.900   Max.   :4.400   Max.   :6.900   Max.   :2.500
\end{verbatim}

\hypertarget{tibble-sorting}{%
\subsubsection{Tibble Sorting}\label{tibble-sorting}}

\begin{itemize}
\tightlist
\item
  dplyr arrange desc reverse
\item
  dplyr sort
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Sort in Ascending Order}
\NormalTok{tb\_iris }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{select}\NormalTok{(Species, Sepal.Length, }\KeywordTok{everything}\NormalTok{()) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(Species, Sepal.Length) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{head}\NormalTok{(}\DecValTok{10}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{l|r|r|r|r}
\hline
Species & Sepal.Length & Sepal.Width & Petal.Length & Petal.Width\\
\hline
\rowcolor{gray!6}  setosa & 4.3 & 3.0 & 1.1 & 0.1\\
\hline
setosa & 4.4 & 2.9 & 1.4 & 0.2\\
\hline
\rowcolor{gray!6}  setosa & 4.4 & 3.0 & 1.3 & 0.2\\
\hline
setosa & 4.4 & 3.2 & 1.3 & 0.2\\
\hline
\rowcolor{gray!6}  setosa & 4.5 & 2.3 & 1.3 & 0.3\\
\hline
setosa & 4.6 & 3.1 & 1.5 & 0.2\\
\hline
\rowcolor{gray!6}  setosa & 4.6 & 3.4 & 1.4 & 0.3\\
\hline
setosa & 4.6 & 3.6 & 1.0 & 0.2\\
\hline
\rowcolor{gray!6}  setosa & 4.6 & 3.2 & 1.4 & 0.2\\
\hline
setosa & 4.7 & 3.2 & 1.3 & 0.2\\
\hline
\end{tabular}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Sort in Descending Order}
\NormalTok{tb\_iris }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{select}\NormalTok{(Species, Sepal.Length, }\KeywordTok{everything}\NormalTok{()) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(}\KeywordTok{desc}\NormalTok{(Species), }\KeywordTok{desc}\NormalTok{(Sepal.Length)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{head}\NormalTok{(}\DecValTok{10}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{l|r|r|r|r}
\hline
Species & Sepal.Length & Sepal.Width & Petal.Length & Petal.Width\\
\hline
\rowcolor{gray!6}  virginica & 7.9 & 3.8 & 6.4 & 2.0\\
\hline
virginica & 7.7 & 3.8 & 6.7 & 2.2\\
\hline
\rowcolor{gray!6}  virginica & 7.7 & 2.6 & 6.9 & 2.3\\
\hline
virginica & 7.7 & 2.8 & 6.7 & 2.0\\
\hline
\rowcolor{gray!6}  virginica & 7.7 & 3.0 & 6.1 & 2.3\\
\hline
virginica & 7.6 & 3.0 & 6.6 & 2.1\\
\hline
\rowcolor{gray!6}  virginica & 7.4 & 2.8 & 6.1 & 1.9\\
\hline
virginica & 7.3 & 2.9 & 6.3 & 1.8\\
\hline
\rowcolor{gray!6}  virginica & 7.2 & 3.6 & 6.1 & 2.5\\
\hline
virginica & 7.2 & 3.2 & 6.0 & 1.8\\
\hline
\end{tabular}
\end{table}

\hypertarget{recontools-summarize-over-tible}{%
\subsubsection{REconTools Summarize over Tible}\label{recontools-summarize-over-tible}}

Use R4Econ's summary tool.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df\_summ\_stats \textless{}{-}}\StringTok{ }\KeywordTok{ff\_summ\_percentiles}\NormalTok{(tb\_iris)}
\KeywordTok{kable}\NormalTok{(}\KeywordTok{t}\NormalTok{(df\_summ\_stats)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{kable\_styling\_fc\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l}
\hline
stats & n & NAobs & ZEROobs & mean & sd & cv & min & p01 & p05 & p10 & p25 & p50 & p75 & p90 & p95 & p99 & max\\
\hline
\rowcolor{gray!6}  Petal.Length & 150 & 0 & 0 & 3.758000 & 1.7652982 & 0.4697441 & 1.0 & 1.149 & 1.300 & 1.4 & 1.6 & 4.35 & 5.1 & 5.80 & 6.100 & 6.700 & 6.9\\
\hline
Petal.Width & 150 & 0 & 0 & 1.199333 & 0.7622377 & 0.6355511 & 0.1 & 0.100 & 0.200 & 0.2 & 0.3 & 1.30 & 1.8 & 2.20 & 2.300 & 2.500 & 2.5\\
\hline
\rowcolor{gray!6}  Sepal.Length & 150 & 0 & 0 & 5.843333 & 0.8280661 & 0.1417113 & 4.3 & 4.400 & 4.600 & 4.8 & 5.1 & 5.80 & 6.4 & 6.90 & 7.255 & 7.700 & 7.9\\
\hline
Sepal.Width & 150 & 0 & 0 & 3.057333 & 0.4358663 & 0.1425642 & 2.0 & 2.200 & 2.345 & 2.5 & 2.8 & 3.00 & 3.3 & 3.61 & 3.800 & 4.151 & 4.4\\
\hline
\end{tabular}}
\end{table}

\hypertarget{factor-label-and-combine}{%
\subsection{Factor Label and Combine}\label{factor-label-and-combine}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

\hypertarget{factor-label-cross-and-graph}{%
\subsubsection{Factor, Label, Cross and Graph}\label{factor-label-cross-and-graph}}

Generate a Scatter plot with different colors representing different categories. There are multiple underlying factor/categorical variables, for example two binary variables. Generate scatter plot with colors for the combinations of these two binary variables.

We combine here the \emph{vs} and \emph{am} variables from the \emph{mtcars} dataset. \emph{vs} is engine shape, \emph{am} is auto or manual shift. We will generate a scatter plot of \emph{mpg} and \emph{qsec} over four categories with different colors.

\begin{itemize}
\tightlist
\item
  \emph{am}: Transmission (0 = automatic, 1 = manual)
\item
  \emph{vs}: Engine (0 = V-shaped, 1 = straight)
\item
  \emph{mpg}: miles per galon
\item
  \emph{qsec}: 1/4 mile time
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# First make sure these are factors}
\NormalTok{tb\_mtcars \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(mtcars) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{vs =} \KeywordTok{as\_factor}\NormalTok{(vs), }\DataTypeTok{am =} \KeywordTok{as\_factor}\NormalTok{(am))}

\CommentTok{\# Second Label the Factors}
\NormalTok{am\_levels \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DataTypeTok{auto\_shift =} \StringTok{"0"}\NormalTok{, }\DataTypeTok{manual\_shift =} \StringTok{"1"}\NormalTok{)}
\NormalTok{vs\_levels \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DataTypeTok{vshaped\_engine =} \StringTok{"0"}\NormalTok{, }\DataTypeTok{straight\_engine =} \StringTok{"1"}\NormalTok{)}
\NormalTok{tb\_mtcars \textless{}{-}}\StringTok{ }\NormalTok{tb\_mtcars }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{vs =} \KeywordTok{fct\_recode}\NormalTok{(vs, }\OperatorTok{!!!}\NormalTok{vs\_levels),}
         \DataTypeTok{am =} \KeywordTok{fct\_recode}\NormalTok{(am, }\OperatorTok{!!!}\NormalTok{am\_levels))}

\CommentTok{\# Third Combine Factors}
\NormalTok{tb\_mtcars\_selected \textless{}{-}}\StringTok{ }\NormalTok{tb\_mtcars }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{vs\_am =} \KeywordTok{fct\_cross}\NormalTok{(vs, am, }\DataTypeTok{sep=}\StringTok{\textquotesingle{}\_\textquotesingle{}}\NormalTok{, }\DataTypeTok{keep\_empty =} \OtherTok{FALSE}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(mpg, qsec, vs\_am)}
\KeywordTok{print}\NormalTok{(tb\_mtcars\_selected)}
\end{Highlighting}
\end{Shaded}

Now we generate scatter plot based on the combined factors

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Labeling}
\NormalTok{st\_title \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}Distribution of MPG and QSEC from mtcars\textquotesingle{}}\NormalTok{)}
\NormalTok{st\_subtitle \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}https://fanwangecon.github.io/\textquotesingle{}}\NormalTok{,}
                      \StringTok{\textquotesingle{}R4Econ/amto/tibble/htmlpdfr/fs\_tib\_factors.html\textquotesingle{}}\NormalTok{)}
\NormalTok{st\_caption \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}mtcars dataset, \textquotesingle{}}\NormalTok{,}
                     \StringTok{\textquotesingle{}https://fanwangecon.github.io/R4Econ/\textquotesingle{}}\NormalTok{)}
\NormalTok{st\_x\_label \textless{}{-}}\StringTok{ \textquotesingle{}MPG = Miles per Gallon\textquotesingle{}}
\NormalTok{st\_y\_label \textless{}{-}}\StringTok{ \textquotesingle{}QSEC = time for 1/4 Miles\textquotesingle{}}

\CommentTok{\# Graphing}
\NormalTok{plt\_mtcars\_scatter \textless{}{-}}\StringTok{ }
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(tb\_mtcars\_selected, }
         \KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{mpg, }\DataTypeTok{y=}\NormalTok{qsec, }\DataTypeTok{colour=}\NormalTok{vs\_am, }\DataTypeTok{shape=}\NormalTok{vs\_am)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom\_jitter}\NormalTok{(}\DataTypeTok{size=}\DecValTok{3}\NormalTok{, }\DataTypeTok{width =} \FloatTok{0.15}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{title =}\NormalTok{ st\_title, }\DataTypeTok{subtitle =}\NormalTok{ st\_subtitle,}
       \DataTypeTok{x =}\NormalTok{ st\_x\_label, }\DataTypeTok{y =}\NormalTok{ st\_y\_label, }\DataTypeTok{caption =}\NormalTok{ st\_caption) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme\_bw}\NormalTok{()}

\CommentTok{\# show}
\KeywordTok{print}\NormalTok{(plt\_mtcars\_scatter)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{Panel-Data-and-Optimization-with-R_files/figure-latex/unnamed-chunk-36-1} \end{center}

\hypertarget{drawly-random-rows}{%
\subsection{Drawly Random Rows}\label{drawly-random-rows}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

\hypertarget{draw-random-subset-of-sample}{%
\subsubsection{Draw Random Subset of Sample}\label{draw-random-subset-of-sample}}

\begin{itemize}
\tightlist
\item
  r random discrete
\end{itemize}

We have a sample of N individuals in some dataframe. Draw without replacement a subset \(M<N\) of rows.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# parameters, it\_M \textless{} it\_N}
\NormalTok{it\_N \textless{}{-}}\StringTok{ }\DecValTok{10}
\NormalTok{it\_M \textless{}{-}}\StringTok{ }\DecValTok{5}

\CommentTok{\# Draw it\_m from indexed list of it\_N}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{123}\NormalTok{)}
\NormalTok{ar\_it\_rand\_idx \textless{}{-}}\StringTok{ }\KeywordTok{sample}\NormalTok{(it\_N, it\_M, }\DataTypeTok{replace=}\OtherTok{FALSE}\NormalTok{)}

\CommentTok{\# dataframe}
\NormalTok{df\_full \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(}\KeywordTok{matrix}\NormalTok{(}\KeywordTok{rnorm}\NormalTok{(}\DecValTok{4}\NormalTok{,}\DataTypeTok{mean=}\DecValTok{0}\NormalTok{,}\DataTypeTok{sd=}\DecValTok{1}\NormalTok{), }\DataTypeTok{nrow=}\NormalTok{it\_N, }\DataTypeTok{ncol=}\DecValTok{4}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{rowid\_to\_column}\NormalTok{(}\DataTypeTok{var =} \StringTok{"ID"}\NormalTok{)}

\CommentTok{\# random Subset}
\NormalTok{df\_rand\_sub\_a \textless{}{-}}\StringTok{ }\NormalTok{df\_full[ar\_it\_rand\_idx,]}

\CommentTok{\# Random subset also}
\NormalTok{df\_rand\_sub\_b \textless{}{-}}\StringTok{ }\NormalTok{df\_full[}\KeywordTok{sample}\NormalTok{(}\KeywordTok{dim}\NormalTok{(df\_full)[}\DecValTok{1}\NormalTok{], it\_M, }\DataTypeTok{replace=}\OtherTok{FALSE}\NormalTok{),]}

\CommentTok{\# Print}
\CommentTok{\# Display}
\KeywordTok{kable}\NormalTok{(df\_full) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r|r|r}
\hline
ID & V1 & V2 & V3 & V4\\
\hline
\rowcolor{gray!6}  1 & 0.1292877 & 0.4609162 & 0.1292877 & 0.4609162\\
\hline
2 & 1.7150650 & -1.2650612 & 1.7150650 & -1.2650612\\
\hline
\rowcolor{gray!6}  3 & 0.4609162 & 0.1292877 & 0.4609162 & 0.1292877\\
\hline
4 & -1.2650612 & 1.7150650 & -1.2650612 & 1.7150650\\
\hline
\rowcolor{gray!6}  5 & 0.1292877 & 0.4609162 & 0.1292877 & 0.4609162\\
\hline
6 & 1.7150650 & -1.2650612 & 1.7150650 & -1.2650612\\
\hline
\rowcolor{gray!6}  7 & 0.4609162 & 0.1292877 & 0.4609162 & 0.1292877\\
\hline
8 & -1.2650612 & 1.7150650 & -1.2650612 & 1.7150650\\
\hline
\rowcolor{gray!6}  9 & 0.1292877 & 0.4609162 & 0.1292877 & 0.4609162\\
\hline
10 & 1.7150650 & -1.2650612 & 1.7150650 & -1.2650612\\
\hline
\end{tabular}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{kable}\NormalTok{(df\_rand\_sub\_a) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r|r|r}
\hline
ID & V1 & V2 & V3 & V4\\
\hline
\rowcolor{gray!6}  3 & 0.4609162 & 0.1292877 & 0.4609162 & 0.1292877\\
\hline
10 & 1.7150650 & -1.2650612 & 1.7150650 & -1.2650612\\
\hline
\rowcolor{gray!6}  2 & 1.7150650 & -1.2650612 & 1.7150650 & -1.2650612\\
\hline
8 & -1.2650612 & 1.7150650 & -1.2650612 & 1.7150650\\
\hline
\rowcolor{gray!6}  6 & 1.7150650 & -1.2650612 & 1.7150650 & -1.2650612\\
\hline
\end{tabular}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{kable}\NormalTok{(df\_rand\_sub\_b) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r|r|r}
\hline
ID & V1 & V2 & V3 & V4\\
\hline
\rowcolor{gray!6}  5 & 0.1292877 & 0.4609162 & 0.1292877 & 0.4609162\\
\hline
3 & 0.4609162 & 0.1292877 & 0.4609162 & 0.1292877\\
\hline
\rowcolor{gray!6}  9 & 0.1292877 & 0.4609162 & 0.1292877 & 0.4609162\\
\hline
1 & 0.1292877 & 0.4609162 & 0.1292877 & 0.4609162\\
\hline
\rowcolor{gray!6}  4 & -1.2650612 & 1.7150650 & -1.2650612 & 1.7150650\\
\hline
\end{tabular}
\end{table}

\hypertarget{random-subset-of-panel}{%
\subsubsection{Random Subset of Panel}\label{random-subset-of-panel}}

There are \(N\) individuals, each could be observed \(M\) times, but then select a subset of rows only, so each person is randomly observed only a subset of times. Specifically, there there are 3 unique students with student ids, and the second variable shows the random dates in which the student showed up in class, out of the 10 classes available.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Define}
\NormalTok{it\_N \textless{}{-}}\StringTok{ }\DecValTok{3}
\NormalTok{it\_M \textless{}{-}}\StringTok{ }\DecValTok{10}
\NormalTok{svr\_id \textless{}{-}}\StringTok{ \textquotesingle{}student\_id\textquotesingle{}}

\CommentTok{\# dataframe}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{123}\NormalTok{)}
\NormalTok{df\_panel\_rand \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(}\KeywordTok{matrix}\NormalTok{(it\_M, }\DataTypeTok{nrow=}\NormalTok{it\_N, }\DataTypeTok{ncol=}\DecValTok{1}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rowid\_to\_column}\NormalTok{(}\DataTypeTok{var =}\NormalTok{ svr\_id) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{uncount}\NormalTok{(V1) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{group\_by}\NormalTok{(}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_id)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{date =} \KeywordTok{row\_number}\NormalTok{()) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{ungroup}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{in\_class =} \KeywordTok{case\_when}\NormalTok{(}\KeywordTok{rnorm}\NormalTok{(}\KeywordTok{n}\NormalTok{(),}\DataTypeTok{mean=}\DecValTok{0}\NormalTok{,}\DataTypeTok{sd=}\DecValTok{1}\NormalTok{) }\OperatorTok{\textless{}}\StringTok{ }\DecValTok{0} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{1}\NormalTok{, }\OtherTok{TRUE} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{0}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(in\_class }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{select}\NormalTok{(}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_id), date) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{date\_in\_class =}\NormalTok{ date)}

\CommentTok{\# Print}
\KeywordTok{kable}\NormalTok{(df\_panel\_rand) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r}
\hline
student\_id & date\_in\_class\\
\hline
\rowcolor{gray!6}  1 & 1\\
\hline
1 & 2\\
\hline
\rowcolor{gray!6}  1 & 8\\
\hline
1 & 9\\
\hline
\rowcolor{gray!6}  1 & 10\\
\hline
2 & 5\\
\hline
\rowcolor{gray!6}  2 & 8\\
\hline
2 & 10\\
\hline
\rowcolor{gray!6}  3 & 1\\
\hline
3 & 2\\
\hline
\rowcolor{gray!6}  3 & 3\\
\hline
3 & 4\\
\hline
\rowcolor{gray!6}  3 & 5\\
\hline
3 & 6\\
\hline
\rowcolor{gray!6}  3 & 9\\
\hline
\end{tabular}
\end{table}

\hypertarget{generate-variables-conditional-on-others}{%
\subsection{Generate Variables Conditional On Others}\label{generate-variables-conditional-on-others}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

\hypertarget{case_when-basic-example}{%
\subsubsection{case\_when Basic Example}\label{case_when-basic-example}}

Given several other variables, and generate a new variable when these varaibles satisfy conditions. Note that case\_when are ifelse type statements. So below

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  group one is below 16 MPG
\item
  when do \emph{qsec \textgreater= 20} second line that is elseif, only those that are \emph{\textgreater=16} are considered here
\item
  then think about two dimensional mpg and qsec grid, the lower-right area, give another category to manual cars in that group
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Get mtcars}
\NormalTok{df\_mtcars \textless{}{-}}\StringTok{ }\NormalTok{mtcars}

\CommentTok{\# case\_when with mtcars}
\NormalTok{df\_mtcars \textless{}{-}}\StringTok{ }\NormalTok{df\_mtcars }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{mpg\_qsec\_am\_grp =} 
           \KeywordTok{case\_when}\NormalTok{(mpg }\OperatorTok{\textless{}}\StringTok{ }\DecValTok{16} \OperatorTok{\textasciitilde{}}\StringTok{ "\textless{} 16 MPG"}\NormalTok{,}
\NormalTok{                     qsec }\OperatorTok{\textgreater{}=}\StringTok{ }\DecValTok{20} \OperatorTok{\textasciitilde{}}\StringTok{ "\textgreater{} 16 MPG \& qsec \textgreater{}= 20"}\NormalTok{,}
\NormalTok{                     am }\OperatorTok{==}\StringTok{ }\DecValTok{1} \OperatorTok{\textasciitilde{}}\StringTok{ "\textgreater{} 16 MPG \& asec \textless{} 20 \& manual"}\NormalTok{,}
                     \OtherTok{TRUE} \OperatorTok{\textasciitilde{}}\StringTok{ "Others"}\NormalTok{))}

\CommentTok{\# \# For dataframe}
\CommentTok{\# df.reg \textless{}{-}df.reg \%\textgreater{}\% na\_if({-}Inf) \%\textgreater{}\% na\_if(Inf)}
\CommentTok{\# \# For a specific variable in dataframe}
\CommentTok{\# df.reg.use \%\textgreater{}\% mutate(!!(var.input) := na\_if(!!sym(var.input), 0))}
\CommentTok{\# }
\CommentTok{\# \# Setting to NA}
\CommentTok{\# df.reg.use \textless{}{-} df.reg.guat \%\textgreater{}\% filter(!!sym(var.mth) != 0)}
\CommentTok{\# df.reg.use.log \textless{}{-} df.reg.use}
\CommentTok{\# df.reg.use.log[which(is.nan(df.reg.use$prot.imputed.log)),] = NA}
\CommentTok{\# df.reg.use.log[which(df.reg.use$prot.imputed.log==Inf),] = NA}
\CommentTok{\# df.reg.use.log[which(df.reg.use$prot.imputed.log=={-}Inf),] = NA}
\CommentTok{\# df.reg.use.log \textless{}{-} df.reg.use.log \%\textgreater{}\% drop\_na(prot.imputed.log)}
\CommentTok{\# \# df.reg.use.log$prot.imputed.log}
\end{Highlighting}
\end{Shaded}

Now we generate scatter plot based on the combined factors

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Labeling}
\NormalTok{st\_title \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}Use case\_when To Generate ifelse Groupings\textquotesingle{}}\NormalTok{)}
\NormalTok{st\_subtitle \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}https://fanwangecon.github.io/\textquotesingle{}}\NormalTok{,}
                      \StringTok{\textquotesingle{}R4Econ/amto/tibble/htmlpdfr/fs\_tib\_na.html\textquotesingle{}}\NormalTok{)}
\NormalTok{st\_caption \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}mtcars dataset, \textquotesingle{}}\NormalTok{,}
                     \StringTok{\textquotesingle{}https://fanwangecon.github.io/R4Econ/\textquotesingle{}}\NormalTok{)}
\NormalTok{st\_x\_label \textless{}{-}}\StringTok{ \textquotesingle{}MPG = Miles per Gallon\textquotesingle{}}
\NormalTok{st\_y\_label \textless{}{-}}\StringTok{ \textquotesingle{}QSEC = time for 1/4 Miles\textquotesingle{}}

\CommentTok{\# Graphing}
\NormalTok{plt\_mtcars\_casewhen\_scatter \textless{}{-}}\StringTok{ }
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(df\_mtcars, }
         \KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{mpg, }\DataTypeTok{y=}\NormalTok{qsec, }
             \DataTypeTok{colour=}\NormalTok{mpg\_qsec\_am\_grp, }
             \DataTypeTok{shape=}\NormalTok{mpg\_qsec\_am\_grp)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom\_jitter}\NormalTok{(}\DataTypeTok{size=}\DecValTok{3}\NormalTok{, }\DataTypeTok{width =} \FloatTok{0.15}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{title =}\NormalTok{ st\_title, }\DataTypeTok{subtitle =}\NormalTok{ st\_subtitle,}
       \DataTypeTok{x =}\NormalTok{ st\_x\_label, }\DataTypeTok{y =}\NormalTok{ st\_y\_label, }\DataTypeTok{caption =}\NormalTok{ st\_caption) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme\_bw}\NormalTok{()}

\CommentTok{\# show}
\KeywordTok{print}\NormalTok{(plt\_mtcars\_casewhen\_scatter)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{Panel-Data-and-Optimization-with-R_files/figure-latex/unnamed-chunk-41-1} \end{center}

\hypertarget{generate-na-values-if-variables-have-certain-value}{%
\subsubsection{Generate NA values if Variables have Certain Value}\label{generate-na-values-if-variables-have-certain-value}}

In the example below, in one line:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  generate a random standard normal vector
\item
  two set na methods:

  \begin{itemize}
  \tightlist
  \item
    if the value of the standard normal is negative, set value to -999, otherwise MPG, replace the value \emph{-999} with \emph{NA}
  \item
    case\_when only with type specific NA values
  \item
    \href{https://github.com/tidyverse/dplyr/issues/3202\#issuecomment-343601409}{Assigning NA yields error in case\_when}
  \item
    note we need to conform NA to type
  \end{itemize}
\item
  generate new categorical variable based on NA condition using is.na with both string and numeric NAs jointly considered.

  \begin{itemize}
  \tightlist
  \item
    fake NA string to be printed on chart
  \end{itemize}
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Get mtcars}
\NormalTok{df\_mtcars \textless{}{-}}\StringTok{ }\NormalTok{mtcars}

\CommentTok{\# Make some values of mpg randomly NA}
\CommentTok{\# the NA has to conform to the type of the remaining values for the new variable}
\CommentTok{\# NA\_real\_, NA\_character\_, NA\_integer\_, NA\_complex\_}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{2341}\NormalTok{)}
\NormalTok{df\_mtcars \textless{}{-}}\StringTok{ }\NormalTok{df\_mtcars }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{mpg\_wth\_NA1 =} \KeywordTok{na\_if}\NormalTok{(}
    \KeywordTok{case\_when}\NormalTok{(}
      \KeywordTok{rnorm}\NormalTok{(}\KeywordTok{n}\NormalTok{(),}\DataTypeTok{mean=}\DecValTok{0}\NormalTok{,}\DataTypeTok{sd=}\DecValTok{1}\NormalTok{) }\OperatorTok{\textless{}}\StringTok{ }\DecValTok{0} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{{-}999}\NormalTok{, }
      \OtherTok{TRUE} \OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{mpg), }
    \DecValTok{{-}999}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{mpg\_wth\_NA2 =} \KeywordTok{case\_when}\NormalTok{(}
    \KeywordTok{rnorm}\NormalTok{(}\KeywordTok{n}\NormalTok{(),}\DataTypeTok{mean=}\DecValTok{0}\NormalTok{,}\DataTypeTok{sd=}\DecValTok{1}\NormalTok{) }\OperatorTok{\textless{}}\StringTok{ }\DecValTok{0} \OperatorTok{\textasciitilde{}}\StringTok{ }\OtherTok{NA\_real\_}\NormalTok{, }
    \OtherTok{TRUE} \OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{mpg)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{mpg\_wth\_NA3 =} \KeywordTok{case\_when}\NormalTok{(}
    \KeywordTok{rnorm}\NormalTok{(}\KeywordTok{n}\NormalTok{(),}\DataTypeTok{mean=}\DecValTok{0}\NormalTok{,}\DataTypeTok{sd=}\DecValTok{1}\NormalTok{) }\OperatorTok{\textless{}}\StringTok{ }\DecValTok{0} \OperatorTok{\textasciitilde{}}\StringTok{ }\OtherTok{NA\_character\_}\NormalTok{, }
    \OtherTok{TRUE} \OperatorTok{\textasciitilde{}}\StringTok{ "shock \textgreater{} 0 string"}\NormalTok{))}
  
\CommentTok{\# Generate New Variables based on if mpg\_wth\_NA is NA or not}
\CommentTok{\# same variable as above, but now first a category based on if NA}
\CommentTok{\# And we generate a fake string "NA" variable, this is not NA}
\CommentTok{\# the String NA allows for it to be printed on figure}
\NormalTok{df\_mtcars \textless{}{-}}\StringTok{ }\NormalTok{df\_mtcars }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{group\_with\_na =} 
           \KeywordTok{case\_when}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(mpg\_wth\_NA2) }\OperatorTok{\&}\StringTok{ }\KeywordTok{is.na}\NormalTok{(mpg\_wth\_NA3) }\OperatorTok{\textasciitilde{}}\StringTok{ }
\StringTok{                       "Rand String and Rand Numeric both NA"}\NormalTok{, }
\NormalTok{                     mpg }\OperatorTok{\textless{}}\StringTok{ }\DecValTok{16} \OperatorTok{\textasciitilde{}}\StringTok{ "\textless{} 16 MPG"}\NormalTok{,}
\NormalTok{                     qsec }\OperatorTok{\textgreater{}=}\StringTok{ }\DecValTok{20} \OperatorTok{\textasciitilde{}}\StringTok{ "\textgreater{} 16 MPG \& qsec \textgreater{}= 20"}\NormalTok{,}
\NormalTok{                     am }\OperatorTok{==}\StringTok{ }\DecValTok{1} \OperatorTok{\textasciitilde{}}\StringTok{ "\textgreater{} 16 MPG \& asec \textless{} 20 \& manual"}\NormalTok{,}
                     \OtherTok{TRUE} \OperatorTok{\textasciitilde{}}\StringTok{ "Fake String NA"}\NormalTok{))}

\CommentTok{\# show}
\KeywordTok{kable}\NormalTok{(}\KeywordTok{head}\NormalTok{(df\_mtcars }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{select}\NormalTok{(}\KeywordTok{starts\_with}\NormalTok{(}\StringTok{\textquotesingle{}mpg\textquotesingle{}}\NormalTok{)),}\DecValTok{13}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r|l}
\hline
mpg & mpg\_wth\_NA1 & mpg\_wth\_NA2 & mpg\_wth\_NA3\\
\hline
\rowcolor{gray!6}  21.0 & NA & NA & shock > 0 string\\
\hline
21.0 & 21.0 & 21.0 & NA\\
\hline
\rowcolor{gray!6}  22.8 & NA & NA & NA\\
\hline
21.4 & NA & 21.4 & NA\\
\hline
\rowcolor{gray!6}  18.7 & NA & 18.7 & NA\\
\hline
18.1 & 18.1 & NA & shock > 0 string\\
\hline
\rowcolor{gray!6}  14.3 & 14.3 & NA & shock > 0 string\\
\hline
24.4 & NA & 24.4 & NA\\
\hline
\rowcolor{gray!6}  22.8 & 22.8 & 22.8 & NA\\
\hline
19.2 & 19.2 & NA & NA\\
\hline
\rowcolor{gray!6}  17.8 & NA & NA & NA\\
\hline
16.4 & 16.4 & 16.4 & NA\\
\hline
\rowcolor{gray!6}  17.3 & NA & NA & shock > 0 string\\
\hline
\end{tabular}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# \# Setting to NA}
\CommentTok{\# df.reg.use \textless{}{-} df.reg.guat \%\textgreater{}\% filter(!!sym(var.mth) != 0)}
\CommentTok{\# df.reg.use.log \textless{}{-} df.reg.use}
\CommentTok{\# df.reg.use.log[which(is.nan(df.reg.use$prot.imputed.log)),] = NA}
\CommentTok{\# df.reg.use.log[which(df.reg.use$prot.imputed.log==Inf),] = NA}
\CommentTok{\# df.reg.use.log[which(df.reg.use$prot.imputed.log=={-}Inf),] = NA}
\CommentTok{\# df.reg.use.log \textless{}{-} df.reg.use.log \%\textgreater{}\% drop\_na(prot.imputed.log)}
\CommentTok{\# \# df.reg.use.log$prot.imputed.log}
\end{Highlighting}
\end{Shaded}

Now we generate scatter plot based on the combined factors, but now with the NA category

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Labeling}
\NormalTok{st\_title \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}Use na\_if and is.na to Generate and Distinguish NA Values}\CharTok{\textbackslash{}n}\StringTok{\textquotesingle{}}\NormalTok{,}
                   \StringTok{\textquotesingle{}NA\_real\_, NA\_character\_, NA\_integer\_, NA\_complex\_\textquotesingle{}}\NormalTok{)}
\NormalTok{st\_subtitle \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}https://fanwangecon.github.io/\textquotesingle{}}\NormalTok{,}
                      \StringTok{\textquotesingle{}R4Econ/amto/tibble/htmlpdfr/fs\_tib\_na.html\textquotesingle{}}\NormalTok{)}
\NormalTok{st\_caption \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}mtcars dataset, \textquotesingle{}}\NormalTok{,}
                     \StringTok{\textquotesingle{}https://fanwangecon.github.io/R4Econ/\textquotesingle{}}\NormalTok{)}
\NormalTok{st\_x\_label \textless{}{-}}\StringTok{ \textquotesingle{}MPG = Miles per Gallon\textquotesingle{}}
\NormalTok{st\_y\_label \textless{}{-}}\StringTok{ \textquotesingle{}QSEC = time for 1/4 Miles\textquotesingle{}}

\CommentTok{\# Graphing}
\NormalTok{plt\_mtcars\_ifisna\_scatter \textless{}{-}}\StringTok{ }
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(df\_mtcars, }
         \KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{mpg, }\DataTypeTok{y=}\NormalTok{qsec, }
             \DataTypeTok{colour=}\NormalTok{group\_with\_na, }
             \DataTypeTok{shape=}\NormalTok{group\_with\_na)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom\_jitter}\NormalTok{(}\DataTypeTok{size=}\DecValTok{3}\NormalTok{, }\DataTypeTok{width =} \FloatTok{0.15}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{title =}\NormalTok{ st\_title, }\DataTypeTok{subtitle =}\NormalTok{ st\_subtitle,}
       \DataTypeTok{x =}\NormalTok{ st\_x\_label, }\DataTypeTok{y =}\NormalTok{ st\_y\_label, }\DataTypeTok{caption =}\NormalTok{ st\_caption) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme\_bw}\NormalTok{()}

\CommentTok{\# show}
\KeywordTok{print}\NormalTok{(plt\_mtcars\_ifisna\_scatter)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{Panel-Data-and-Optimization-with-R_files/figure-latex/unnamed-chunk-43-1} \end{center}

\hypertarget{approximate-values-comparison}{%
\subsubsection{Approximate Values Comparison}\label{approximate-values-comparison}}

\begin{itemize}
\tightlist
\item
  r values almost the same
\item
  \href{https://stat.ethz.ch/R-manual/R-patched/library/base/html/all.equal.html}{all.equal}
\end{itemize}

From numeric approximation, often values are very close, and should be set to equal. Use \emph{isTRUE(all.equal)}. In the example below, we randomly generates four arrays. Two of the arrays have slightly higher variance, two arrays have slightly lower variance. They sd are to be 10 times below or 10 times above the tolerance comparison level. The values are not the same in any of the columns, but by allowing for almost true given some tolerance level, in the low standard deviation case, the values differences are within tolerance, so they are equal.

This is an essential issue when dealing with optimization results.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Set tolerance }
\NormalTok{tol\_lvl =}\StringTok{ }\FloatTok{1.5e{-}3}
\NormalTok{sd\_lower\_than\_tol =}\StringTok{ }\NormalTok{tol\_lvl}\OperatorTok{/}\DecValTok{10}
\NormalTok{sd\_higher\_than\_tol =}\StringTok{ }\NormalTok{tol\_lvl}\OperatorTok{*}\DecValTok{10}

\CommentTok{\# larger SD}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{123}\NormalTok{)}
\NormalTok{mt\_runif\_standard \textless{}{-}}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\KeywordTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{,}\DataTypeTok{mean=}\DecValTok{0}\NormalTok{,}\DataTypeTok{sd=}\NormalTok{sd\_higher\_than\_tol), }\DataTypeTok{nrow=}\DecValTok{5}\NormalTok{, }\DataTypeTok{ncol=}\DecValTok{2}\NormalTok{)}

\CommentTok{\# small SD}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{123}\NormalTok{)}
\NormalTok{mt\_rnorm\_small\_sd \textless{}{-}}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\KeywordTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{,}\DataTypeTok{mean=}\DecValTok{0}\NormalTok{,}\DataTypeTok{sd=}\NormalTok{sd\_lower\_than\_tol), }\DataTypeTok{nrow=}\DecValTok{5}\NormalTok{, }\DataTypeTok{ncol=}\DecValTok{2}\NormalTok{)}

\CommentTok{\# Generates Random Matirx}
\NormalTok{tb\_rnorm\_runif \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(mt\_rnorm\_small\_sd, mt\_runif\_standard))}

\CommentTok{\# Are Variables the same, not for strict comparison}
\NormalTok{tb\_rnorm\_runif\_approxi\_same \textless{}{-}}\StringTok{ }\NormalTok{tb\_rnorm\_runif }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{V1\_V2\_ALMOST\_SAME =} 
           \KeywordTok{case\_when}\NormalTok{(}\KeywordTok{isTRUE}\NormalTok{(}\KeywordTok{all.equal}\NormalTok{(V1, V2, }\DataTypeTok{tolerance=}\NormalTok{tol\_lvl)) }\OperatorTok{\textasciitilde{}}\StringTok{ }
\StringTok{                       }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}TOL=\textquotesingle{}}\NormalTok{,sd\_lower\_than\_tol,}\StringTok{\textquotesingle{}, SAME ALMOST\textquotesingle{}}\NormalTok{),}
                     \OtherTok{TRUE} \OperatorTok{\textasciitilde{}}\StringTok{ }
\StringTok{                       }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}TOL=\textquotesingle{}}\NormalTok{,sd\_lower\_than\_tol,}\StringTok{\textquotesingle{}, NOT SAME ALMOST\textquotesingle{}}\NormalTok{))) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{V3\_V4\_ALMOST\_SAME =}
           \KeywordTok{case\_when}\NormalTok{(}\KeywordTok{isTRUE}\NormalTok{(}\KeywordTok{all.equal}\NormalTok{(V3, V4, }\DataTypeTok{tolerance=}\NormalTok{tol\_lvl)) }\OperatorTok{\textasciitilde{}}\StringTok{ }
\StringTok{                       }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}TOL=\textquotesingle{}}\NormalTok{,sd\_higher\_than\_tol,}\StringTok{\textquotesingle{}, SAME ALMOST\textquotesingle{}}\NormalTok{),}
                     \OtherTok{TRUE} \OperatorTok{\textasciitilde{}}\StringTok{ }
\StringTok{                       }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}TOL=\textquotesingle{}}\NormalTok{,sd\_higher\_than\_tol,}\StringTok{\textquotesingle{}, NOT SAME ALMOST\textquotesingle{}}\NormalTok{)))}

\CommentTok{\# Pring}
\KeywordTok{kable}\NormalTok{(tb\_rnorm\_runif\_approxi\_same) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{kable\_styling\_fc\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{r|r|r|r|l|l}
\hline
V1 & V2 & V3 & V4 & V1\_V2\_ALMOST\_SAME & V3\_V4\_ALMOST\_SAME\\
\hline
\rowcolor{gray!6}  -0.0000841 & 0.0002573 & -0.0084071 & 0.0257260 & TOL=0.00015, SAME ALMOST & TOL=0.015, NOT SAME ALMOST\\
\hline
-0.0000345 & 0.0000691 & -0.0034527 & 0.0069137 & TOL=0.00015, SAME ALMOST & TOL=0.015, NOT SAME ALMOST\\
\hline
\rowcolor{gray!6}  0.0002338 & -0.0001898 & 0.0233806 & -0.0189759 & TOL=0.00015, SAME ALMOST & TOL=0.015, NOT SAME ALMOST\\
\hline
0.0000106 & -0.0001030 & 0.0010576 & -0.0103028 & TOL=0.00015, SAME ALMOST & TOL=0.015, NOT SAME ALMOST\\
\hline
\rowcolor{gray!6}  0.0000194 & -0.0000668 & 0.0019393 & -0.0066849 & TOL=0.00015, SAME ALMOST & TOL=0.015, NOT SAME ALMOST\\
\hline
\end{tabular}}
\end{table}

\hypertarget{string-values}{%
\subsection{String Values}\label{string-values}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

\hypertarget{find-and-replace}{%
\subsubsection{Find and Replace}\label{find-and-replace}}

Find and Replace in Dataframe.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# if string value is contained in variable}
\NormalTok{(}\StringTok{"bridex.B"} \OperatorTok{\%in\%}\StringTok{ }\NormalTok{(df.reg.out.all}\OperatorTok{$}\NormalTok{vars\_var.y))}
\CommentTok{\# if string value is not contained in variable:}
\CommentTok{\# 1. type is variable name}
\CommentTok{\# 2. Toyota|Mazda are strings to be excluded}
\KeywordTok{filter}\NormalTok{(mtcars, }\OperatorTok{!}\KeywordTok{grepl}\NormalTok{(}\StringTok{\textquotesingle{}Toyota|Mazda\textquotesingle{}}\NormalTok{, type))}

\CommentTok{\# filter does not contain string}
\NormalTok{rs\_hgt\_prot\_log\_tidy }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{str\_detect}\NormalTok{(term, }\StringTok{\textquotesingle{}prot\textquotesingle{}}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\hypertarget{summarize-data}{%
\chapter{Summarize Data}\label{summarize-data}}

\hypertarget{counting-observation}{%
\section{Counting Observation}\label{counting-observation}}

\hypertarget{uncount}{%
\subsection{Uncount}\label{uncount}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

In some panel, there are \(N\) individuals, each observed for \(Y_i\) years. Given a dataset with two variables, the individual index, and the \(Y_i\) variable, expand the dataframe so that there is a row for each individual index's each unique year in the survey.

\emph{Search}:

\begin{itemize}
\tightlist
\item
  r duplicate row by variable
\end{itemize}

\emph{Links}:

\begin{itemize}
\tightlist
\item
  see: \href{https://stackoverflow.com/questions/52498169/r-create-duplicate-rows-based-on-a-variable-dplyr-preferred}{Create duplicate rows based on a variable}
\end{itemize}

\emph{Algorithm}:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  generate testing frame, the individual attribute dataset with invariant information over panel
\item
  uncount, duplicate rows by years in survey
\item
  group and generate sorted index
\item
  add indiviual specific stat year to index
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# 1. Array of Years in the Survey}
\NormalTok{ar\_years\_in\_survey \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{10}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{5}\NormalTok{)}
\NormalTok{ar\_start\_yaer \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{)}
\NormalTok{ar\_end\_year \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{10}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{5}\NormalTok{)}
\NormalTok{mt\_combine \textless{}{-}}\StringTok{ }\KeywordTok{cbind}\NormalTok{(ar\_years\_in\_survey, ar\_start\_yaer, ar\_end\_year)}

\CommentTok{\# This is the individual attribute dataset, attributes that are invariant acrosss years}
\NormalTok{tb\_indi\_attributes \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(mt\_combine) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{rowid\_to\_column}\NormalTok{(}\DataTypeTok{var =} \StringTok{"ID"}\NormalTok{)}

\CommentTok{\# 2. Sort and generate variable equal to sorted index}
\NormalTok{tb\_indi\_panel \textless{}{-}}\StringTok{ }\NormalTok{tb\_indi\_attributes }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{uncount}\NormalTok{(ar\_years\_in\_survey)}

\CommentTok{\# 3. Panel now construct exactly which year in survey, note that all needed is sort index}
\CommentTok{\# Note sorting not needed, all rows identical now}
\NormalTok{tb\_indi\_panel \textless{}{-}}\StringTok{ }\NormalTok{tb\_indi\_panel }\OperatorTok{\%\textgreater{}\%}
\StringTok{                    }\KeywordTok{group\_by}\NormalTok{(ID) }\OperatorTok{\%\textgreater{}\%}
\StringTok{                    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{yr\_in\_survey =} \KeywordTok{row\_number}\NormalTok{())}

\NormalTok{tb\_indi\_panel \textless{}{-}}\StringTok{ }\NormalTok{tb\_indi\_panel }\OperatorTok{\%\textgreater{}\%}
\StringTok{                    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{calendar\_year =}\NormalTok{ yr\_in\_survey }\OperatorTok{+}\StringTok{ }\NormalTok{ar\_start\_yaer }\OperatorTok{{-}}\StringTok{ }\DecValTok{1}\NormalTok{)}

\CommentTok{\# Show results Head 10}
\NormalTok{tb\_indi\_panel }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{head}\NormalTok{(}\DecValTok{10}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r|r|r}
\hline
ID & ar\_start\_yaer & ar\_end\_year & yr\_in\_survey & calendar\_year\\
\hline
\rowcolor{gray!6}  1 & 1 & 2 & 1 & 1\\
\hline
1 & 1 & 2 & 2 & 2\\
\hline
\rowcolor{gray!6}  2 & 2 & 4 & 1 & 2\\
\hline
2 & 2 & 4 & 2 & 3\\
\hline
\rowcolor{gray!6}  2 & 2 & 4 & 3 & 4\\
\hline
3 & 3 & 3 & 1 & 3\\
\hline
\rowcolor{gray!6}  4 & 1 & 10 & 1 & 1\\
\hline
4 & 1 & 10 & 2 & 2\\
\hline
\rowcolor{gray!6}  4 & 1 & 10 & 3 & 3\\
\hline
4 & 1 & 10 & 4 & 4\\
\hline
\end{tabular}
\end{table}

\hypertarget{sorting-indexing-slicing}{%
\section{Sorting, Indexing, Slicing}\label{sorting-indexing-slicing}}

\hypertarget{sorting}{%
\subsection{Sorting}\label{sorting}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

\hypertarget{generate-sorted-index-within-group-with-repeating-values}{%
\subsubsection{Generate Sorted Index within Group with Repeating Values}\label{generate-sorted-index-within-group-with-repeating-values}}

There is a variable, sort by this variable, then generate index from 1 to N representing sorted values of this index. If there are repeating values, still assign index, different index each value.

\begin{itemize}
\tightlist
\item
  r generate index sort
\item
  dplyr mutate equals index
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Sort and generate variable equal to sorted index}
\NormalTok{df\_iris \textless{}{-}}\StringTok{ }\NormalTok{iris }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{arrange}\NormalTok{(Sepal.Length) }\OperatorTok{\%\textgreater{}\%}
\StringTok{              }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{Sepal.Len.Index =} \KeywordTok{row\_number}\NormalTok{()) }\OperatorTok{\%\textgreater{}\%}
\StringTok{              }\KeywordTok{select}\NormalTok{(Sepal.Length, Sepal.Len.Index, }\KeywordTok{everything}\NormalTok{())}

\CommentTok{\# Show results Head 10}
\NormalTok{df\_iris }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{head}\NormalTok{(}\DecValTok{10}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{r|r|r|r|r|l}
\hline
Sepal.Length & Sepal.Len.Index & Sepal.Width & Petal.Length & Petal.Width & Species\\
\hline
\rowcolor{gray!6}  4.3 & 1 & 3.0 & 1.1 & 0.1 & setosa\\
\hline
4.4 & 2 & 2.9 & 1.4 & 0.2 & setosa\\
\hline
\rowcolor{gray!6}  4.4 & 3 & 3.0 & 1.3 & 0.2 & setosa\\
\hline
4.4 & 4 & 3.2 & 1.3 & 0.2 & setosa\\
\hline
\rowcolor{gray!6}  4.5 & 5 & 2.3 & 1.3 & 0.3 & setosa\\
\hline
4.6 & 6 & 3.1 & 1.5 & 0.2 & setosa\\
\hline
\rowcolor{gray!6}  4.6 & 7 & 3.4 & 1.4 & 0.3 & setosa\\
\hline
4.6 & 8 & 3.6 & 1.0 & 0.2 & setosa\\
\hline
\rowcolor{gray!6}  4.6 & 9 & 3.2 & 1.4 & 0.2 & setosa\\
\hline
4.7 & 10 & 3.2 & 1.3 & 0.2 & setosa\\
\hline
\end{tabular}}
\end{table}

\hypertarget{populate-value-from-lowest-index-to-all-other-rows}{%
\subsubsection{Populate Value from Lowest Index to All other Rows}\label{populate-value-from-lowest-index-to-all-other-rows}}

We would like to calculate for example the ratio of each individual's highest to the the person with the lowest height in a dataset. We first need to generated sorted index from lowest to highest, and then populate the lowest height to all rows, and then divide.

\emph{Search Terms}:

\begin{itemize}
\tightlist
\item
  r spread value to all rows from one row
\item
  r other rows equal to the value of one row
\item
  Conditional assignment of one variable to the value of one of two other variables
\item
  dplyr mutate conditional
\item
  dplyr value from one row to all rows
\item
  dplyr mutate equal to value in another cell
\end{itemize}

\emph{Links}:

\begin{itemize}
\tightlist
\item
  see: dplyr \href{https://dplyr.tidyverse.org/reference/ranking.html}{rank}
\item
  see: dplyr \href{https://dplyr.tidyverse.org/reference/case_when.html}{case\_when}
\end{itemize}

\hypertarget{short-method-mutate-and-min}{%
\paragraph{Short Method: mutate and min}\label{short-method-mutate-and-min}}

We just want the lowest value to be in its own column, so that we can compute various statistics using the lowest value variable and the original variable.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# 1. Sort}
\NormalTok{df\_iris\_m1 \textless{}{-}}\StringTok{ }\NormalTok{iris }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{Sepal.Len.Lowest.all =} \KeywordTok{min}\NormalTok{(Sepal.Length)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{                }\KeywordTok{select}\NormalTok{(Sepal.Length, Sepal.Len.Lowest.all, }\KeywordTok{everything}\NormalTok{())}


\CommentTok{\# Show results Head 10}
\NormalTok{df\_iris\_m1 }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{head}\NormalTok{(}\DecValTok{10}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{r|r|r|r|r|l}
\hline
Sepal.Length & Sepal.Len.Lowest.all & Sepal.Width & Petal.Length & Petal.Width & Species\\
\hline
\rowcolor{gray!6}  5.1 & 4.3 & 3.5 & 1.4 & 0.2 & setosa\\
\hline
4.9 & 4.3 & 3.0 & 1.4 & 0.2 & setosa\\
\hline
\rowcolor{gray!6}  4.7 & 4.3 & 3.2 & 1.3 & 0.2 & setosa\\
\hline
4.6 & 4.3 & 3.1 & 1.5 & 0.2 & setosa\\
\hline
\rowcolor{gray!6}  5.0 & 4.3 & 3.6 & 1.4 & 0.2 & setosa\\
\hline
5.4 & 4.3 & 3.9 & 1.7 & 0.4 & setosa\\
\hline
\rowcolor{gray!6}  4.6 & 4.3 & 3.4 & 1.4 & 0.3 & setosa\\
\hline
5.0 & 4.3 & 3.4 & 1.5 & 0.2 & setosa\\
\hline
\rowcolor{gray!6}  4.4 & 4.3 & 2.9 & 1.4 & 0.2 & setosa\\
\hline
4.9 & 4.3 & 3.1 & 1.5 & 0.1 & setosa\\
\hline
\end{tabular}}
\end{table}

\hypertarget{long-method-row_number-and-case_when}{%
\paragraph{Long Method: row\_number and case\_when}\label{long-method-row_number-and-case_when}}

This is the long method, using row\_number, and case\_when. The benefit of this method is that it generates several intermediate variables that might be useful. And the key final step is to set a new variable (A=\emph{Sepal.Len.Lowest.all}) equal to another variable's (B=\emph{Sepal.Length}'s) value at the index that satisfies condition based a third variable (C=\emph{Sepal.Len.Index}).

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# 1. Sort}
\CommentTok{\# 2. generate index}
\CommentTok{\# 3. value at lowest index (case\_when)}
\CommentTok{\# 4. spread value from lowest index to other rows}
\CommentTok{\# Note step 4 does not require step 3}
\NormalTok{df\_iris\_m2 \textless{}{-}}\StringTok{ }\NormalTok{iris }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{arrange}\NormalTok{(Sepal.Length) }\OperatorTok{\%\textgreater{}\%}
\StringTok{              }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{Sepal.Len.Index =} \KeywordTok{row\_number}\NormalTok{()) }\OperatorTok{\%\textgreater{}\%}
\StringTok{              }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{Sepal.Len.Lowest.one =}
                       \KeywordTok{case\_when}\NormalTok{(}\KeywordTok{row\_number}\NormalTok{()}\OperatorTok{==}\DecValTok{1} \OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{Sepal.Length)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{              }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{Sepal.Len.Lowest.all =}
\NormalTok{                       Sepal.Length[Sepal.Len.Index}\OperatorTok{==}\DecValTok{1}\NormalTok{]) }\OperatorTok{\%\textgreater{}\%}
\StringTok{              }\KeywordTok{select}\NormalTok{(Sepal.Length, Sepal.Len.Index,}
\NormalTok{                     Sepal.Len.Lowest.one, Sepal.Len.Lowest.all)}


\CommentTok{\# Show results Head 10}
\NormalTok{df\_iris\_m2 }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{head}\NormalTok{(}\DecValTok{10}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{r|r|r|r}
\hline
Sepal.Length & Sepal.Len.Index & Sepal.Len.Lowest.one & Sepal.Len.Lowest.all\\
\hline
\rowcolor{gray!6}  4.3 & 1 & 4.3 & 4.3\\
\hline
4.4 & 2 & NA & 4.3\\
\hline
\rowcolor{gray!6}  4.4 & 3 & NA & 4.3\\
\hline
4.4 & 4 & NA & 4.3\\
\hline
\rowcolor{gray!6}  4.5 & 5 & NA & 4.3\\
\hline
4.6 & 6 & NA & 4.3\\
\hline
\rowcolor{gray!6}  4.6 & 7 & NA & 4.3\\
\hline
4.6 & 8 & NA & 4.3\\
\hline
\rowcolor{gray!6}  4.6 & 9 & NA & 4.3\\
\hline
4.7 & 10 & NA & 4.3\\
\hline
\end{tabular}}
\end{table}

\hypertarget{generate-sorted-index-based-on-deviations}{%
\subsubsection{Generate Sorted Index based on Deviations}\label{generate-sorted-index-based-on-deviations}}

Generate Positive and Negative Index based on Ordered Deviation from some Number.

There is a variable that is continuous, substract a number from this variable, and generate index based on deviations. Think of the index as generating intervals indicating where the value lies. 0th index indicates the largest value in sequence that is smaller than or equal to number \(x\), 1st index indicates the smallest value in sequence that is larger than number \(x\).

The solution below is a little bit convoluated and long, there is likely a much quicker way. The process below shows various intermediary outputs that help arrive at deviation index \emph{Sepal.Len.Devi.Index} from initial sorted index \emph{Sepal.Len.Index}.

\emph{search}:

\begin{itemize}
\tightlist
\item
  dplyr arrange ignore na
\item
  dplyr index deviation from order number sequence
\item
  dplyr index below above
\item
  dplyr index order below above value
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# 1. Sort and generate variable equal to sorted index}
\CommentTok{\# 2. Plus or minus deviations from some value}
\CommentTok{\# 3. Find the zero, which means, the number closests to zero including zero from the negative side}
\CommentTok{\# 4. Find the index at the highest zero and below deviation point}
\CommentTok{\# 5. Difference of zero index and original sorted index}
\NormalTok{sc\_val\_x \textless{}{-}}\StringTok{ }\FloatTok{4.65}
\NormalTok{df\_iris\_deviate \textless{}{-}}\StringTok{ }\NormalTok{iris }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{arrange}\NormalTok{(Sepal.Length) }\OperatorTok{\%\textgreater{}\%}
\StringTok{              }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{Sepal.Len.Index =} \KeywordTok{row\_number}\NormalTok{()) }\OperatorTok{\%\textgreater{}\%}
\StringTok{              }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{Sepal.Len.Devi =}\NormalTok{ (Sepal.Length }\OperatorTok{{-}}\StringTok{ }\NormalTok{sc\_val\_x)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{              }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{Sepal.Len.Devi.Neg =}
                       \KeywordTok{case\_when}\NormalTok{(Sepal.Len.Devi }\OperatorTok{\textless{}=}\StringTok{ }\DecValTok{0} \OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{(}\OperatorTok{{-}}\DecValTok{1}\NormalTok{)}\OperatorTok{*}\NormalTok{(Sepal.Len.Devi))) }\OperatorTok{\%\textgreater{}\%}
\StringTok{              }\KeywordTok{arrange}\NormalTok{((Sepal.Len.Devi.Neg), }\KeywordTok{desc}\NormalTok{(Sepal.Len.Index)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{              }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{Sepal.Len.Index.Zero =}
                       \KeywordTok{case\_when}\NormalTok{(}\KeywordTok{row\_number}\NormalTok{() }\OperatorTok{==}\StringTok{ }\DecValTok{1} \OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{Sepal.Len.Index)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{              }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{Sepal.Len.Devi.Index =}
\NormalTok{                       Sepal.Len.Index }\OperatorTok{{-}}\StringTok{ }\NormalTok{Sepal.Len.Index.Zero[}\KeywordTok{row\_number}\NormalTok{() }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{]) }\OperatorTok{\%\textgreater{}\%}
\StringTok{              }\KeywordTok{arrange}\NormalTok{(Sepal.Len.Index) }\OperatorTok{\%\textgreater{}\%}
\StringTok{              }\KeywordTok{select}\NormalTok{(Sepal.Length, Sepal.Len.Index, Sepal.Len.Devi,}
\NormalTok{                     Sepal.Len.Devi.Neg, Sepal.Len.Index.Zero, Sepal.Len.Devi.Index)}


\CommentTok{\# Show results Head 10}
\NormalTok{df\_iris\_deviate }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{head}\NormalTok{(}\DecValTok{20}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{r|r|r|r|r|r}
\hline
Sepal.Length & Sepal.Len.Index & Sepal.Len.Devi & Sepal.Len.Devi.Neg & Sepal.Len.Index.Zero & Sepal.Len.Devi.Index\\
\hline
\rowcolor{gray!6}  4.3 & 1 & -0.35 & 0.35 & NA & -8\\
\hline
4.4 & 2 & -0.25 & 0.25 & NA & -7\\
\hline
\rowcolor{gray!6}  4.4 & 3 & -0.25 & 0.25 & NA & -6\\
\hline
4.4 & 4 & -0.25 & 0.25 & NA & -5\\
\hline
\rowcolor{gray!6}  4.5 & 5 & -0.15 & 0.15 & NA & -4\\
\hline
4.6 & 6 & -0.05 & 0.05 & NA & -3\\
\hline
\rowcolor{gray!6}  4.6 & 7 & -0.05 & 0.05 & NA & -2\\
\hline
4.6 & 8 & -0.05 & 0.05 & NA & -1\\
\hline
\rowcolor{gray!6}  4.6 & 9 & -0.05 & 0.05 & 9 & 0\\
\hline
4.7 & 10 & 0.05 & NA & NA & 1\\
\hline
\rowcolor{gray!6}  4.7 & 11 & 0.05 & NA & NA & 2\\
\hline
4.8 & 12 & 0.15 & NA & NA & 3\\
\hline
\rowcolor{gray!6}  4.8 & 13 & 0.15 & NA & NA & 4\\
\hline
4.8 & 14 & 0.15 & NA & NA & 5\\
\hline
\rowcolor{gray!6}  4.8 & 15 & 0.15 & NA & NA & 6\\
\hline
4.8 & 16 & 0.15 & NA & NA & 7\\
\hline
\rowcolor{gray!6}  4.9 & 17 & 0.25 & NA & NA & 8\\
\hline
4.9 & 18 & 0.25 & NA & NA & 9\\
\hline
\rowcolor{gray!6}  4.9 & 19 & 0.25 & NA & NA & 10\\
\hline
4.9 & 20 & 0.25 & NA & NA & 11\\
\hline
\end{tabular}}
\end{table}

\hypertarget{group-statistics}{%
\section{Group Statistics}\label{group-statistics}}

\hypertarget{groups-statistics}{%
\subsection{Groups Statistics}\label{groups-statistics}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

\hypertarget{aggrgate-groups-only-unique-group-and-count}{%
\subsubsection{Aggrgate Groups only Unique Group and Count}\label{aggrgate-groups-only-unique-group-and-count}}

There are two variables that are numeric, we want to find all the unique groups of these two variables in a dataset and count how many times each unique group occurs

\begin{itemize}
\tightlist
\item
  r unique occurrence of numeric groups
\item
  How to add count of unique values by group to R data.frame
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Numeric value combinations unique Groups}
\NormalTok{vars.group \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}hgt0\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}wgt0\textquotesingle{}}\NormalTok{)}

\CommentTok{\# dataset subsetting}
\NormalTok{df\_use \textless{}{-}}\StringTok{ }\NormalTok{df\_hgt\_wgt }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{select}\NormalTok{(}\OperatorTok{!!!}\KeywordTok{syms}\NormalTok{(}\KeywordTok{c}\NormalTok{(vars.group))) }\OperatorTok{\%\textgreater{}\%}
\StringTok{            }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{hgt0 =} \KeywordTok{round}\NormalTok{(hgt0}\OperatorTok{/}\DecValTok{5}\NormalTok{)}\OperatorTok{*}\DecValTok{5}\NormalTok{, }\DataTypeTok{wgt0 =} \KeywordTok{round}\NormalTok{(wgt0}\OperatorTok{/}\DecValTok{2000}\NormalTok{)}\OperatorTok{*}\DecValTok{2000}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{            }\KeywordTok{drop\_na}\NormalTok{()}

\CommentTok{\# Group, count and generate means for each numeric variables}
\CommentTok{\# mutate\_at(vars.group, funs(as.factor(.))) \%\textgreater{}\%}
\NormalTok{df.group.count \textless{}{-}}\StringTok{ }\NormalTok{df\_use }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{group\_by}\NormalTok{(}\OperatorTok{!!!}\KeywordTok{syms}\NormalTok{(vars.group)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{                    }\KeywordTok{arrange}\NormalTok{(}\OperatorTok{!!!}\KeywordTok{syms}\NormalTok{(vars.group)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{                    }\KeywordTok{summarise}\NormalTok{(}\DataTypeTok{n\_obs\_group=}\KeywordTok{n}\NormalTok{())}

\CommentTok{\# Show results Head 10}
\NormalTok{df.group.count }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{kable}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r}
\hline
hgt0 & wgt0 & n\_obs\_group\\
\hline
\rowcolor{gray!6}  40 & 2000 & 122\\
\hline
45 & 2000 & 4586\\
\hline
\rowcolor{gray!6}  45 & 4000 & 470\\
\hline
50 & 2000 & 9691\\
\hline
\rowcolor{gray!6}  50 & 4000 & 13106\\
\hline
55 & 2000 & 126\\
\hline
\rowcolor{gray!6}  55 & 4000 & 1900\\
\hline
60 & 6000 & 18\\
\hline
\end{tabular}
\end{table}

\hypertarget{aggrgate-groups-only-unique-group-show-up-with-means}{%
\subsubsection{Aggrgate Groups only Unique Group Show up With Means}\label{aggrgate-groups-only-unique-group-show-up-with-means}}

Several variables that are grouping identifiers. Several variables that are values which mean be unique for each group members. For example, a Panel of income for N households over T years with also household education information that is invariant over time. Want to generate a dataset where the unit of observation are households, rather than household years. Take average of all numeric variables that are household and year specific.

A complicating factor potentially is that the number of observations differ within group, for example, income might be observed for all years for some households but not for other households.

\begin{itemize}
\tightlist
\item
  r dplyr aggregate group average
\item
  Aggregating and analyzing data with dplyr
\item
  column can't be modified because it is a grouping variable
\item
  see also: \href{https://datacarpentry.org/dc_zurich/R-ecology/04-dplyr.html}{Aggregating and analyzing data with dplyr}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# In the df\_hgt\_wgt from R4Econ, there is a country id, village id,}
\CommentTok{\# and individual id, and various other statistics}
\NormalTok{vars.group \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}S.country\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}vil.id\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}indi.id\textquotesingle{}}\NormalTok{)}
\NormalTok{vars.values \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}hgt\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}momEdu\textquotesingle{}}\NormalTok{)}

\CommentTok{\# dataset subsetting}
\NormalTok{df\_use \textless{}{-}}\StringTok{ }\NormalTok{df\_hgt\_wgt }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{select}\NormalTok{(}\OperatorTok{!!!}\KeywordTok{syms}\NormalTok{(}\KeywordTok{c}\NormalTok{(vars.group, vars.values)))}

\CommentTok{\# Group, count and generate means for each numeric variables}
\NormalTok{df.group \textless{}{-}}\StringTok{ }\NormalTok{df\_use }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{group\_by}\NormalTok{(}\OperatorTok{!!!}\KeywordTok{syms}\NormalTok{(vars.group)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{            }\KeywordTok{arrange}\NormalTok{(}\OperatorTok{!!!}\KeywordTok{syms}\NormalTok{(vars.group)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{            }\KeywordTok{summarise\_if}\NormalTok{(is.numeric,}
                         \KeywordTok{funs}\NormalTok{(}\DataTypeTok{mean =} \KeywordTok{mean}\NormalTok{(., }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{),}
                              \DataTypeTok{sd =} \KeywordTok{sd}\NormalTok{(., }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{),}
                              \DataTypeTok{n =} \KeywordTok{sum}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(.)}\OperatorTok{==}\DecValTok{0}\NormalTok{)))}

\CommentTok{\# Show results Head 10}
\NormalTok{df.group }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{head}\NormalTok{(}\DecValTok{10}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{l|r|r|r|r|r|r|r|r}
\hline
S.country & vil.id & indi.id & hgt\_mean & momEdu\_mean & hgt\_sd & momEdu\_sd & hgt\_n & momEdu\_n\\
\hline
\rowcolor{gray!6}  Cebu & 1 & 1 & 61.80000 & 5.3 & 9.520504 & 0 & 7 & 18\\
\hline
Cebu & 1 & 2 & 68.86154 & 7.1 & 9.058931 & 0 & 13 & 18\\
\hline
\rowcolor{gray!6}  Cebu & 1 & 3 & 80.45882 & 9.4 & 29.894231 & 0 & 17 & 18\\
\hline
Cebu & 1 & 4 & 88.10000 & 13.9 & 35.533166 & 0 & 18 & 18\\
\hline
\rowcolor{gray!6}  Cebu & 1 & 5 & 97.70556 & 11.3 & 41.090366 & 0 & 18 & 18\\
\hline
Cebu & 1 & 6 & 87.49444 & 7.3 & 35.586439 & 0 & 18 & 18\\
\hline
\rowcolor{gray!6}  Cebu & 1 & 7 & 90.79412 & 10.4 & 38.722385 & 0 & 17 & 18\\
\hline
Cebu & 1 & 8 & 68.45385 & 13.5 & 10.011961 & 0 & 13 & 18\\
\hline
\rowcolor{gray!6}  Cebu & 1 & 9 & 86.21111 & 10.4 & 35.126057 & 0 & 18 & 18\\
\hline
Cebu & 1 & 10 & 87.67222 & 10.5 & 36.508127 & 0 & 18 & 18\\
\hline
\end{tabular}}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Show results Head 10}
\NormalTok{df.group }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{tail}\NormalTok{(}\DecValTok{10}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{l|r|r|r|r|r|r|r|r}
\hline
S.country & vil.id & indi.id & hgt\_mean & momEdu\_mean & hgt\_sd & momEdu\_sd & hgt\_n & momEdu\_n\\
\hline
\rowcolor{gray!6}  Guatemala & 14 & 2014 & 66.97000 & NaN & 8.967974 & NaN & 10 & 0\\
\hline
Guatemala & 14 & 2015 & 71.71818 & NaN & 11.399984 & NaN & 11 & 0\\
\hline
\rowcolor{gray!6}  Guatemala & 14 & 2016 & 66.33000 & NaN & 9.490352 & NaN & 10 & 0\\
\hline
Guatemala & 14 & 2017 & 76.40769 & NaN & 14.827871 & NaN & 13 & 0\\
\hline
\rowcolor{gray!6}  Guatemala & 14 & 2018 & 74.55385 & NaN & 12.707846 & NaN & 13 & 0\\
\hline
Guatemala & 14 & 2019 & 70.47500 & NaN & 11.797390 & NaN & 12 & 0\\
\hline
\rowcolor{gray!6}  Guatemala & 14 & 2020 & 60.28750 & NaN & 7.060036 & NaN & 8 & 0\\
\hline
Guatemala & 14 & 2021 & 84.96000 & NaN & 15.446193 & NaN & 10 & 0\\
\hline
\rowcolor{gray!6}  Guatemala & 14 & 2022 & 79.38667 & NaN & 15.824749 & NaN & 15 & 0\\
\hline
Guatemala & 14 & 2023 & 66.50000 & NaN & 8.613113 & NaN & 8 & 0\\
\hline
\end{tabular}}
\end{table}

\hypertarget{one-variable-group-summary}{%
\subsection{One Variable Group Summary}\label{one-variable-group-summary}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

There is a categorical variable (based on one or the interaction of multiple variables), there is a continuous variable, obtain statistics for the continuous variable conditional on the categorical variable, but also unconditionally.

Store results in a matrix, but also flatten results wide to row with appropriate keys/variable-names for all group statistics.

Pick which statistics to be included in final wide row

\hypertarget{build-program}{%
\subsubsection{Build Program}\label{build-program}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Single Variable Group Statistics (also generate overall statistics)}
\NormalTok{ff\_summ\_by\_group\_summ\_one \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(}
\NormalTok{  df, vars.group, var.numeric, }\DataTypeTok{str.stats.group =} \StringTok{\textquotesingle{}main\textquotesingle{}}\NormalTok{,}
  \DataTypeTok{str.stats.specify =} \OtherTok{NULL}\NormalTok{, }\DataTypeTok{boo.overall.stats =} \OtherTok{TRUE}\NormalTok{)\{}
  
  \CommentTok{\# List of statistics}
  \CommentTok{\# https://rdrr.io/cran/dplyr/man/summarise.html}
\NormalTok{  strs.center \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}mean\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}median\textquotesingle{}}\NormalTok{)}
\NormalTok{  strs.spread \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}sd\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}IQR\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}mad\textquotesingle{}}\NormalTok{)}
\NormalTok{  strs.range \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}min\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}max\textquotesingle{}}\NormalTok{)}
\NormalTok{  strs.pos \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}first\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}last\textquotesingle{}}\NormalTok{)}
\NormalTok{  strs.count \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}n\_distinct\textquotesingle{}}\NormalTok{)}
  
  \CommentTok{\# Grouping of Statistics}
  \ControlFlowTok{if}\NormalTok{ (}\KeywordTok{missing}\NormalTok{(str.stats.specify)) \{}
    \ControlFlowTok{if}\NormalTok{ (str.stats.group }\OperatorTok{==}\StringTok{ \textquotesingle{}main\textquotesingle{}}\NormalTok{) \{}
\NormalTok{      strs.all \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}mean\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}min\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}max\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}sd\textquotesingle{}}\NormalTok{)}
\NormalTok{    \}}
    \ControlFlowTok{if}\NormalTok{ (str.stats.group }\OperatorTok{==}\StringTok{ \textquotesingle{}all\textquotesingle{}}\NormalTok{) \{}
\NormalTok{      strs.all \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(strs.center, strs.spread, strs.range, strs.pos, strs.count)}
\NormalTok{    \}}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{    strs.all \textless{}{-}}\StringTok{ }\NormalTok{str.stats.specify}
\NormalTok{  \}}
  
  \CommentTok{\# Start Transform}
\NormalTok{  df \textless{}{-}}\StringTok{ }\NormalTok{df }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{drop\_na}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\OperatorTok{!!}\NormalTok{(var.numeric) }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(var.numeric)))}
  
  \CommentTok{\# Overall Statistics}
  \ControlFlowTok{if}\NormalTok{ (boo.overall.stats) \{}
\NormalTok{    df.overall.stats \textless{}{-}}\StringTok{ }\NormalTok{df }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{      }\KeywordTok{summarize\_at}\NormalTok{(}\KeywordTok{vars}\NormalTok{(var.numeric), }\KeywordTok{funs}\NormalTok{(}\OperatorTok{!!!}\NormalTok{strs.all))}
    \ControlFlowTok{if}\NormalTok{ (}\KeywordTok{length}\NormalTok{(strs.all) }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{) \{}
      \CommentTok{\# give it a name, otherwise if only one stat, name of stat not saved}
\NormalTok{      df.overall.stats \textless{}{-}}\StringTok{ }\NormalTok{df.overall.stats }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{        }\KeywordTok{rename}\NormalTok{(}\OperatorTok{!!}\DataTypeTok{strs.all :=} \OperatorTok{!!}\KeywordTok{sym}\NormalTok{(var.numeric))}
\NormalTok{    \}}
    \KeywordTok{names}\NormalTok{(df.overall.stats) \textless{}{-}}\StringTok{ }
\StringTok{      }\KeywordTok{paste0}\NormalTok{(var.numeric, }\StringTok{\textquotesingle{}.\textquotesingle{}}\NormalTok{, }\KeywordTok{names}\NormalTok{(df.overall.stats))}
\NormalTok{  \}}
  
  \CommentTok{\# Group Sort}
\NormalTok{  df.select \textless{}{-}}\StringTok{ }\NormalTok{df }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{group\_by}\NormalTok{(}\OperatorTok{!!!}\KeywordTok{syms}\NormalTok{(vars.group)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{arrange}\NormalTok{(}\OperatorTok{!!!}\KeywordTok{syms}\NormalTok{(}\KeywordTok{c}\NormalTok{(vars.group, var.numeric)))}
  
  \CommentTok{\# Table of Statistics}
\NormalTok{  df.table.grp.stats \textless{}{-}}\StringTok{ }\NormalTok{df.select }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{    }\KeywordTok{summarize\_at}\NormalTok{(}\KeywordTok{vars}\NormalTok{(var.numeric), }\KeywordTok{funs}\NormalTok{(}\OperatorTok{!!!}\NormalTok{strs.all))}
  
  \CommentTok{\# Add Stat Name}
  \ControlFlowTok{if}\NormalTok{ (}\KeywordTok{length}\NormalTok{(strs.all) }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{) \{}
    \CommentTok{\# give it a name, otherwise if only one stat, name of stat not saved}
\NormalTok{    df.table.grp.stats \textless{}{-}}\StringTok{ }\NormalTok{df.table.grp.stats }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{      }\KeywordTok{rename}\NormalTok{(}\OperatorTok{!!}\DataTypeTok{strs.all :=} \OperatorTok{!!}\KeywordTok{sym}\NormalTok{(var.numeric))}
\NormalTok{  \}}
  
  
  \CommentTok{\# Row of Statistics}
\NormalTok{  str.vars.group.combine \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(vars.group, }\DataTypeTok{collapse=}\StringTok{\textquotesingle{}\_\textquotesingle{}}\NormalTok{)}
  \ControlFlowTok{if}\NormalTok{ (}\KeywordTok{length}\NormalTok{(vars.group) }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{) \{}
\NormalTok{    df.row.grp.stats \textless{}{-}}\StringTok{ }\NormalTok{df.table.grp.stats }\OperatorTok{\%\textgreater{}\%}
\StringTok{      }\KeywordTok{mutate}\NormalTok{(}\OperatorTok{!!}\NormalTok{(str.vars.group.combine) }\OperatorTok{:}\ErrorTok{=}\StringTok{ }
\StringTok{               }\KeywordTok{paste0}\NormalTok{(var.numeric, }\StringTok{\textquotesingle{}.\textquotesingle{}}\NormalTok{,}
\NormalTok{                      vars.group, }\StringTok{\textquotesingle{}.g\textquotesingle{}}\NormalTok{,}
\NormalTok{                      (}\OperatorTok{!!!}\KeywordTok{syms}\NormalTok{(vars.group)))) }\OperatorTok{\%\textgreater{}\%}
\StringTok{      }\KeywordTok{gather}\NormalTok{(variable, value, }\OperatorTok{{-}}\KeywordTok{one\_of}\NormalTok{(vars.group)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{      }\KeywordTok{unite}\NormalTok{(str.vars.group.combine, }\KeywordTok{c}\NormalTok{(str.vars.group.combine, }\StringTok{\textquotesingle{}variable\textquotesingle{}}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{      }\KeywordTok{spread}\NormalTok{(str.vars.group.combine, value)}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{    df.row.grp.stats \textless{}{-}}\StringTok{ }\NormalTok{df.table.grp.stats }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{      }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{vars.groups.combine :=} 
               \KeywordTok{paste0}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(vars.group, }\DataTypeTok{collapse=}\StringTok{\textquotesingle{}.\textquotesingle{}}\NormalTok{)),}
             \OperatorTok{!!}\NormalTok{(str.vars.group.combine) }\OperatorTok{:}\ErrorTok{=}\StringTok{ }
\StringTok{               }\KeywordTok{paste0}\NormalTok{(}\KeywordTok{interaction}\NormalTok{(}\OperatorTok{!!!}\NormalTok{(}\KeywordTok{syms}\NormalTok{(vars.group))))) }\OperatorTok{\%\textgreater{}\%}
\StringTok{      }\KeywordTok{mutate}\NormalTok{(}\OperatorTok{!!}\NormalTok{(str.vars.group.combine) }\OperatorTok{:}\ErrorTok{=}\StringTok{ }
\StringTok{               }\KeywordTok{paste0}\NormalTok{(var.numeric, }\StringTok{\textquotesingle{}.\textquotesingle{}}\NormalTok{, vars.groups.combine, }\StringTok{\textquotesingle{}.\textquotesingle{}}\NormalTok{,}
\NormalTok{                      (}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(str.vars.group.combine)))) }\OperatorTok{\%\textgreater{}\%}
\StringTok{      }\KeywordTok{ungroup}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{      }\KeywordTok{select}\NormalTok{(}\OperatorTok{{-}}\NormalTok{vars.groups.combine, }\OperatorTok{{-}}\KeywordTok{one\_of}\NormalTok{(vars.group)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{      }\KeywordTok{gather}\NormalTok{(variable, value, }\OperatorTok{{-}}\KeywordTok{one\_of}\NormalTok{(str.vars.group.combine)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{      }\KeywordTok{unite}\NormalTok{(str.vars.group.combine, }\KeywordTok{c}\NormalTok{(str.vars.group.combine, }\StringTok{\textquotesingle{}variable\textquotesingle{}}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{      }\KeywordTok{spread}\NormalTok{(str.vars.group.combine, value)}
\NormalTok{  \}}
  
  \CommentTok{\# Clean up name strings}
  \KeywordTok{names}\NormalTok{(df.table.grp.stats) \textless{}{-}}\StringTok{ }
\StringTok{    }\KeywordTok{gsub}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{names}\NormalTok{(df.table.grp.stats),}\DataTypeTok{pattern =} \StringTok{"\_"}\NormalTok{, }\DataTypeTok{replacement =} \StringTok{"}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{."}\NormalTok{)}
  \KeywordTok{names}\NormalTok{(df.row.grp.stats) \textless{}{-}}\StringTok{ }
\StringTok{    }\KeywordTok{gsub}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{names}\NormalTok{(df.row.grp.stats),}\DataTypeTok{pattern =} \StringTok{"\_"}\NormalTok{, }\DataTypeTok{replacement =} \StringTok{"}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{."}\NormalTok{)}
  
  \CommentTok{\# Return}
\NormalTok{  list.return \textless{}{-}}\StringTok{ }
\StringTok{    }\KeywordTok{list}\NormalTok{(}\DataTypeTok{df\_table\_grp\_stats =}\NormalTok{ df.table.grp.stats, }
         \DataTypeTok{df\_row\_grp\_stats =}\NormalTok{ df.row.grp.stats)}
  
  \CommentTok{\# Overall Statistics, without grouping}
  \ControlFlowTok{if}\NormalTok{ (boo.overall.stats) \{}
\NormalTok{    df.row.stats.all \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(df.row.grp.stats, df.overall.stats)}
\NormalTok{    list.return \textless{}{-}}\StringTok{ }\KeywordTok{append}\NormalTok{(list.return, }
                          \KeywordTok{list}\NormalTok{(}\DataTypeTok{df\_overall\_stats =}\NormalTok{ df.overall.stats,}
                               \DataTypeTok{df\_row\_stats\_all =}\NormalTok{ df.row.stats.all))}
\NormalTok{  \}}
  
  \CommentTok{\# Return}
  \KeywordTok{return}\NormalTok{(list.return)}
  
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{test}{%
\subsubsection{Test}\label{test}}

Load data and test

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Library}
\KeywordTok{library}\NormalTok{(tidyverse)}

\CommentTok{\# Load Sample Data}
\KeywordTok{setwd}\NormalTok{(}\StringTok{\textquotesingle{}C:/Users/fan/R4Econ/\_data/\textquotesingle{}}\NormalTok{)}
\NormalTok{df \textless{}{-}}\StringTok{ }\KeywordTok{read\_csv}\NormalTok{(}\StringTok{\textquotesingle{}height\_weight.csv\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{function-testing-by-gender-groups}{%
\paragraph{Function Testing By Gender Groups}\label{function-testing-by-gender-groups}}

Need two variables, a group variable that is a factor, and a numeric

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vars.group \textless{}{-}}\StringTok{ \textquotesingle{}sex\textquotesingle{}}
\NormalTok{var.numeric \textless{}{-}}\StringTok{ \textquotesingle{}hgt\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.select \textless{}{-}}\StringTok{ }\NormalTok{df }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{select}\NormalTok{(}\KeywordTok{one\_of}\NormalTok{(vars.group, var.numeric)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{drop\_na}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

Main Statistics:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Single Variable Group Statistics}
\KeywordTok{ff\_summ\_by\_group\_summ\_one}\NormalTok{(}
\NormalTok{  df.select, }\DataTypeTok{vars.group =}\NormalTok{ vars.group, }\DataTypeTok{var.numeric =}\NormalTok{ var.numeric, }
  \DataTypeTok{str.stats.group =} \StringTok{\textquotesingle{}main\textquotesingle{}}\NormalTok{)}\OperatorTok{$}\NormalTok{df\_table\_grp\_stats}
\end{Highlighting}
\end{Shaded}

Specify Two Specific Statistics:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ff\_summ\_by\_group\_summ\_one}\NormalTok{(}
\NormalTok{  df.select, }\DataTypeTok{vars.group =}\NormalTok{ vars.group, }\DataTypeTok{var.numeric =}\NormalTok{ var.numeric, }
  \DataTypeTok{str.stats.specify =} \KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}mean\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}sd\textquotesingle{}}\NormalTok{))}\OperatorTok{$}\NormalTok{df\_table\_grp\_stats}
\end{Highlighting}
\end{Shaded}

Specify One Specific Statistics:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ff\_summ\_by\_group\_summ\_one}\NormalTok{(}
\NormalTok{  df.select, }\DataTypeTok{vars.group =}\NormalTok{ vars.group, }\DataTypeTok{var.numeric =}\NormalTok{ var.numeric, }
  \DataTypeTok{str.stats.specify =} \KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}mean\textquotesingle{}}\NormalTok{))}\OperatorTok{$}\NormalTok{df\_table\_grp\_stats}
\end{Highlighting}
\end{Shaded}

\hypertarget{function-testing-by-country-and-gender-groups}{%
\paragraph{Function Testing By Country and Gender Groups}\label{function-testing-by-country-and-gender-groups}}

Need two variables, a group variable that is a factor, and a numeric. Now joint grouping variables.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vars.group \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}S.country\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}sex\textquotesingle{}}\NormalTok{)}
\NormalTok{var.numeric \textless{}{-}}\StringTok{ \textquotesingle{}hgt\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.select \textless{}{-}}\StringTok{ }\NormalTok{df }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{select}\NormalTok{(}\KeywordTok{one\_of}\NormalTok{(vars.group, var.numeric)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{drop\_na}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

Main Statistics:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ff\_summ\_by\_group\_summ\_one}\NormalTok{(}
\NormalTok{  df.select, }\DataTypeTok{vars.group =}\NormalTok{ vars.group, }\DataTypeTok{var.numeric =}\NormalTok{ var.numeric, }
  \DataTypeTok{str.stats.group =} \StringTok{\textquotesingle{}main\textquotesingle{}}\NormalTok{)}\OperatorTok{$}\NormalTok{df\_table\_grp\_stats}
\end{Highlighting}
\end{Shaded}

Specify Two Specific Statistics:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ff\_summ\_by\_group\_summ\_one}\NormalTok{(}
\NormalTok{  df.select, }\DataTypeTok{vars.group =}\NormalTok{ vars.group, }\DataTypeTok{var.numeric =}\NormalTok{ var.numeric, }
  \DataTypeTok{str.stats.specify =} \KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}mean\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}sd\textquotesingle{}}\NormalTok{))}\OperatorTok{$}\NormalTok{df\_table\_grp\_stats}
\end{Highlighting}
\end{Shaded}

Specify One Specific Statistics:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ff\_summ\_by\_group\_summ\_one}\NormalTok{(}
\NormalTok{  df.select, }\DataTypeTok{vars.group =}\NormalTok{ vars.group, }\DataTypeTok{var.numeric =}\NormalTok{ var.numeric, }
  \DataTypeTok{str.stats.specify =} \KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}mean\textquotesingle{}}\NormalTok{))}\OperatorTok{$}\NormalTok{df\_table\_grp\_stats}
\end{Highlighting}
\end{Shaded}

\hypertarget{nested-within-group-stats}{%
\subsection{Nested within Group Stats}\label{nested-within-group-stats}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

By Multiple within Individual Groups Variables, Averages for All Numeric Variables within All Groups of All Group Variables (Long to very Wide). Suppose you have an individual level final outcome. The individual is observed for N periods, where each period the inputs differ. What inputs impacted the final outcome?

Suppose we can divide N periods in which the individual is in the data into a number of years, a number of semi-years, a number of quarters, or uneven-staggered lengths. We might want to generate averages across individuals and within each of these different possible groups averages of inputs.

Then we want to version of the data where each row is an individual, one of the variables is the final outcome, and the other variables are these different averages: averages for the 1st, 2nd, 3rd year in which indivdiual is in data, averages for 1st, \ldots, final quarter in which indivdiual is in data.

\hypertarget{build-function}{%
\subsubsection{Build Function}\label{build-function}}

This function takes as inputs:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \textbf{vars.not.groups2avg}: a list of variables that are not the within-indivdiual or across-individual grouping variables, but the variables we want to average over. Withnin indivdiual grouping averages will be calculated for these variables using the not-listed variables as within indivdiual groups (excluding vars.indi.grp groups).
\item
  \textbf{vars.indi.grp}: a list or individual variables, and also perhaps villages, province, etc id variables that are higher than individual ID. Note the groups are are ACROSS individual higher level group variables.
\item
  the remaining variables are all within individual grouping variables.
\end{enumerate}

the function output is a dataframe:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  each row is an individual
\item
  initial variables individual ID and across individual groups from \emph{vars.indi.grp}.
\item
  other variables are all averages for the variables in \emph{vars.not.groups2avg}

  \begin{itemize}
  \tightlist
  \item
    if there are 2 within individual group variables, and the first has 3 groups (years), the second has 6 groups (semi-years), then there would be 9 average variables.
  \item
    each average variables has the original variable name from vars.not.groups2avg plus the name of the within individual grouping variable, and at the end `c\_x', where x is a integer representing the category within the group (if 3 years, x=1, 2, 3)
  \end{itemize}
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Data Function}
\CommentTok{\# https://fanwangecon.github.io/R4Econ/summarize/summ/ByGroupsSummWide.html}
\NormalTok{f.by.groups.summ.wide \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(df.groups.to.average,}
\NormalTok{                                  vars.not.groups2avg,}
                                  \DataTypeTok{vars.indi.grp =} \KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}S.country\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}ID\textquotesingle{}}\NormalTok{),}
                                  \DataTypeTok{display=}\OtherTok{TRUE}\NormalTok{) \{}

\CommentTok{\# 1. generate categoricals for full year (m.12), half year (m.6), quarter year (m.4)}
\CommentTok{\# 2. generate categoricals also for uneven years (m12t14) using }
\CommentTok{\#  stagger (+2 rather than {-}1)}
\CommentTok{\# 3. reshape wide to long, so that all categorical date groups appear in var=value,}
    \CommentTok{\# and categories in var=variable}
\CommentTok{\# 4. calculate mean for all numeric variables for all date groups}
\CommentTok{\# 5. combine date categorical variable and value, single var:}
    \CommentTok{\# m.12.c1= first year average from m.12 averaging}

\CommentTok{\#\#\#\#\#\#\#\# \#\#\#\#\#\#\#\# \#\#\#\#\#\#\#\# \#\#\#\#\#\#\#\# \#\#\#\#\#\#\#}
\CommentTok{\# Step 1}
\CommentTok{\#\#\#\#\#\#\#\# \#\#\#\#\#\#\#\# \#\#\#\#\#\#\#\# \#\#\#\#\#\#\#\# \#\#\#\#\#\#\#}
\CommentTok{\# 1. generate categoricals for full year (m.12), half year (m.6), quarter year (m.4)}
\CommentTok{\# 2. generate categoricals also for uneven years (m12t14) using stagger }
\CommentTok{\#  (+2 rather than {-}1)}

\CommentTok{\#\#\#\#\#\#\#\# \#\#\#\#\#\#\#\# \#\#\#\#\#\#\#\# \#\#\#\#\#\#\#\# \#\#\#\#\#\#\#}
\CommentTok{\# S2: reshape wide to long, so that all categorical date groups appear in var=value,}
\CommentTok{\# and categories in var=variable; calculate mean for all }
\CommentTok{\# numeric variables for all date groups}
\CommentTok{\#\#\#\#\#\#\#\# \#\#\#\#\#\#\#\# \#\#\#\#\#\#\#\# \#\#\#\#\#\#\#\# \#\#\#\#\#\#\#}
\NormalTok{df.avg.long \textless{}{-}}\StringTok{ }\NormalTok{df.groups.to.average }\OperatorTok{\%\textgreater{}\%}
\StringTok{       }\KeywordTok{gather}\NormalTok{(variable, value, }\OperatorTok{{-}}\KeywordTok{one\_of}\NormalTok{(}\KeywordTok{c}\NormalTok{(vars.indi.grp,}
\NormalTok{                                         vars.not.groups2avg))) }\OperatorTok{\%\textgreater{}\%}
\StringTok{       }\KeywordTok{group\_by}\NormalTok{(}\OperatorTok{!!!}\KeywordTok{syms}\NormalTok{(vars.indi.grp), variable, value) }\OperatorTok{\%\textgreater{}\%}
\StringTok{       }\KeywordTok{summarise\_if}\NormalTok{(is.numeric, }\KeywordTok{funs}\NormalTok{(}\KeywordTok{mean}\NormalTok{(., }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{)))}

\ControlFlowTok{if}\NormalTok{ (display)\{}
  \KeywordTok{dim}\NormalTok{(df.avg.long)}
  \KeywordTok{options}\NormalTok{(}\DataTypeTok{repr.matrix.max.rows=}\DecValTok{10}\NormalTok{, }\DataTypeTok{repr.matrix.max.cols=}\DecValTok{20}\NormalTok{)}
  \KeywordTok{print}\NormalTok{(df.avg.long)}
\NormalTok{\}}

\CommentTok{\#\#\#\#\#\#\#\# \#\#\#\#\#\#\#\# \#\#\#\#\#\#\#\# \#\#\#\#\#\#\#\# \#\#\#\#\#\#\#}
\CommentTok{\# S3 combine date categorical variable and value, single var:}
\CommentTok{\# m.12.c1= first year average from m.12 averaging; to do this make }
\CommentTok{\# data even longer first}
\CommentTok{\#\#\#\#\#\#\#\# \#\#\#\#\#\#\#\# \#\#\#\#\#\#\#\# \#\#\#\#\#\#\#\# \#\#\#\#\#\#\#}

\CommentTok{\# We already have the averages, but we want them to show up as variables,}
    \CommentTok{\# mean for each group of each variable.}
\NormalTok{df.avg.allvars.wide \textless{}{-}}\StringTok{ }\NormalTok{df.avg.long }\OperatorTok{\%\textgreater{}\%}
\StringTok{   }\KeywordTok{ungroup}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{   }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{all\_m\_cate =} \KeywordTok{paste0}\NormalTok{(variable, }\StringTok{\textquotesingle{}\_c\textquotesingle{}}\NormalTok{, value)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{   }\KeywordTok{select}\NormalTok{(all\_m\_cate, }\KeywordTok{everything}\NormalTok{(), }\OperatorTok{{-}}\NormalTok{variable, }\OperatorTok{{-}}\NormalTok{value) }\OperatorTok{\%\textgreater{}\%}
\StringTok{   }\KeywordTok{gather}\NormalTok{(variable, value, }\OperatorTok{{-}}\KeywordTok{one\_of}\NormalTok{(vars.indi.grp), }\OperatorTok{{-}}\NormalTok{all\_m\_cate) }\OperatorTok{\%\textgreater{}\%}
\StringTok{   }\KeywordTok{unite}\NormalTok{(}\StringTok{\textquotesingle{}var\_mcate\textquotesingle{}}\NormalTok{, variable, all\_m\_cate) }\OperatorTok{\%\textgreater{}\%}
\StringTok{   }\KeywordTok{spread}\NormalTok{(var\_mcate, value)}

\ControlFlowTok{if}\NormalTok{ (display)\{}
  \KeywordTok{dim}\NormalTok{(df.avg.allvars.wide)}
  \KeywordTok{options}\NormalTok{(}\DataTypeTok{repr.matrix.max.rows=}\DecValTok{10}\NormalTok{, }\DataTypeTok{repr.matrix.max.cols=}\DecValTok{10}\NormalTok{)}
  \KeywordTok{print}\NormalTok{(df.avg.allvars.wide)}
\NormalTok{\}}

\KeywordTok{return}\NormalTok{(df.avg.allvars.wide)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{test-program}{%
\subsubsection{Test Program}\label{test-program}}

In our sample dataset, the number of nutrition/height/income etc information observed within each country and month of age group are different. We have a panel dataset for children observed over different months of age.

We have two key grouping variables:
1. country: data are observed for guatemala and cebu
2. month-age (survey month round=svymthRound): different months of age at which each individual child is observed

A child could be observed for many months, or just a few months. A child's height information could be observed for more months-of-age than nutritional intake information. We eventually want to run regressions where the outcome is height/weight and the input is nutrition. The regressions will be at the month-of-age level. We need to know how many times different variables are observed at the month-of-age level.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Library}
\KeywordTok{library}\NormalTok{(tidyverse)}

\CommentTok{\# Load Sample Data}
\KeywordTok{setwd}\NormalTok{(}\StringTok{\textquotesingle{}C:/Users/fan/R4Econ/\_data/\textquotesingle{}}\NormalTok{)}
\NormalTok{df \textless{}{-}}\StringTok{ }\KeywordTok{read\_csv}\NormalTok{(}\StringTok{\textquotesingle{}height\_weight.csv\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{generate-within-individual-groups}{%
\paragraph{Generate Within Individual Groups}\label{generate-within-individual-groups}}

In the data, children are observed for different number of months since birth. We want to calculate quarterly, semi-year, annual, etc average nutritional intakes. First generate these within-individual grouping variables. We can also generate uneven-staggered calendar groups as shown below.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mth.var \textless{}{-}}\StringTok{ \textquotesingle{}svymthRound\textquotesingle{}}
\NormalTok{df.groups.to.average\textless{}{-}}\StringTok{ }\NormalTok{df }\OperatorTok{\%\textgreater{}\%}
\StringTok{        }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(mth.var) }\OperatorTok{\textgreater{}=}\StringTok{ }\DecValTok{0} \OperatorTok{\&}\StringTok{ }\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(mth.var) }\OperatorTok{\textless{}=}\StringTok{ }\DecValTok{24}\NormalTok{)  }\OperatorTok{\%\textgreater{}\%}
\StringTok{        }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{m12t24=}\NormalTok{(}\KeywordTok{floor}\NormalTok{((}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(mth.var) }\OperatorTok{{-}}\StringTok{ }\DecValTok{12}\NormalTok{) }\OperatorTok{\%/\%}\StringTok{ }\DecValTok{14}\NormalTok{) }\OperatorTok{+}\StringTok{ }\DecValTok{1}\NormalTok{),}
               \DataTypeTok{m8t24=}\NormalTok{(}\KeywordTok{floor}\NormalTok{((}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(mth.var) }\OperatorTok{{-}}\StringTok{ }\DecValTok{8}\NormalTok{) }\OperatorTok{\%/\%}\StringTok{ }\DecValTok{18}\NormalTok{) }\OperatorTok{+}\StringTok{ }\DecValTok{1}\NormalTok{),}
               \DataTypeTok{m12 =} \KeywordTok{pmax}\NormalTok{((}\KeywordTok{floor}\NormalTok{((}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(mth.var)}\OperatorTok{{-}}\DecValTok{1}\NormalTok{) }\OperatorTok{\%/\%}\StringTok{ }\DecValTok{12}\NormalTok{) }\OperatorTok{+}\StringTok{ }\DecValTok{1}\NormalTok{), }\DecValTok{1}\NormalTok{),}
               \DataTypeTok{m6 =} \KeywordTok{pmax}\NormalTok{((}\KeywordTok{floor}\NormalTok{((}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(mth.var)}\OperatorTok{{-}}\DecValTok{1}\NormalTok{) }\OperatorTok{\%/\%}\StringTok{ }\DecValTok{6}\NormalTok{) }\OperatorTok{+}\StringTok{ }\DecValTok{1}\NormalTok{), }\DecValTok{1}\NormalTok{),}
               \DataTypeTok{m3 =} \KeywordTok{pmax}\NormalTok{((}\KeywordTok{floor}\NormalTok{((}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(mth.var)}\OperatorTok{{-}}\DecValTok{1}\NormalTok{) }\OperatorTok{\%/\%}\StringTok{ }\DecValTok{3}\NormalTok{) }\OperatorTok{+}\StringTok{ }\DecValTok{1}\NormalTok{), }\DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Show Results}
\KeywordTok{options}\NormalTok{(}\DataTypeTok{repr.matrix.max.rows=}\DecValTok{30}\NormalTok{, }\DataTypeTok{repr.matrix.max.cols=}\DecValTok{20}\NormalTok{)}
\NormalTok{vars.arrange \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}S.country\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}indi.id\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}svymthRound\textquotesingle{}}\NormalTok{)}
\NormalTok{vars.groups.within.indi \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}m12t24\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}m8t24\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}m12\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}m6\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}m3\textquotesingle{}}\NormalTok{)}
\KeywordTok{as.tibble}\NormalTok{(df.groups.to.average }\OperatorTok{\%\textgreater{}\%}
\StringTok{          }\KeywordTok{group\_by}\NormalTok{(}\OperatorTok{!!!}\KeywordTok{syms}\NormalTok{(vars.arrange)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{          }\KeywordTok{arrange}\NormalTok{(}\OperatorTok{!!!}\KeywordTok{syms}\NormalTok{(vars.arrange)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{          }\KeywordTok{select}\NormalTok{(}\OperatorTok{!!!}\KeywordTok{syms}\NormalTok{(vars.arrange), }\OperatorTok{!!!}\KeywordTok{syms}\NormalTok{(vars.groups.within.indi)))}
\end{Highlighting}
\end{Shaded}

\hypertarget{within-group-averages}{%
\paragraph{Within Group Averages}\label{within-group-averages}}

With the within-group averages created, we can generate averages for all variables within these groups.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vars.not.groups2avg \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}prot\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}cal\textquotesingle{}}\NormalTok{)}
\NormalTok{vars.indi.grp \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}S.country\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}indi.id\textquotesingle{}}\NormalTok{)}
\NormalTok{vars.groups.within.indi \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}m12t24\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}m8t24\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}m12\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}m6\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}m3\textquotesingle{}}\NormalTok{)}

\NormalTok{df.groups.to.average.select \textless{}{-}}\StringTok{ }\NormalTok{df.groups.to.average }\OperatorTok{\%\textgreater{}\%}
\StringTok{                        }\KeywordTok{select}\NormalTok{(}\KeywordTok{one\_of}\NormalTok{(}\KeywordTok{c}\NormalTok{(vars.indi.grp,}
\NormalTok{                                        vars.not.groups2avg,}
\NormalTok{                                        vars.groups.within.indi)))}
\NormalTok{df.avg.allvars.wide \textless{}{-}}\StringTok{ }\KeywordTok{f.by.groups.summ.wide}\NormalTok{(df.groups.to.average.select,}
\NormalTok{                                             vars.not.groups2avg,}
\NormalTok{                                             vars.indi.grp, }\DataTypeTok{display=}\OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

This is the tabular version of results

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{dim}\NormalTok{(df.avg.allvars.wide)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2023   38
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{names}\NormalTok{(df.avg.allvars.wide)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "S.country"      "indi.id"        "cal_m12_c1"     "cal_m12_c2"     "cal_m12t24_c0"  "cal_m12t24_c1"  "cal_m3_c1"      "cal_m3_c2"     
##  [9] "cal_m3_c3"      "cal_m3_c4"      "cal_m3_c5"      "cal_m3_c6"      "cal_m3_c7"      "cal_m3_c8"      "cal_m6_c1"      "cal_m6_c2"     
## [17] "cal_m6_c3"      "cal_m6_c4"      "cal_m8t24_c0"   "cal_m8t24_c1"   "prot_m12_c1"    "prot_m12_c2"    "prot_m12t24_c0" "prot_m12t24_c1"
## [25] "prot_m3_c1"     "prot_m3_c2"     "prot_m3_c3"     "prot_m3_c4"     "prot_m3_c5"     "prot_m3_c6"     "prot_m3_c7"     "prot_m3_c8"    
## [33] "prot_m6_c1"     "prot_m6_c2"     "prot_m6_c3"     "prot_m6_c4"     "prot_m8t24_c0"  "prot_m8t24_c1"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.avg.allvars.wide[}\DecValTok{1}\OperatorTok{:}\DecValTok{20}\NormalTok{,] }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{kable}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{kable\_styling\_fc\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{l|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r}
\hline
S.country & indi.id & cal\_m12\_c1 & cal\_m12\_c2 & cal\_m12t24\_c0 & cal\_m12t24\_c1 & cal\_m3\_c1 & cal\_m3\_c2 & cal\_m3\_c3 & cal\_m3\_c4 & cal\_m3\_c5 & cal\_m3\_c6 & cal\_m3\_c7 & cal\_m3\_c8 & cal\_m6\_c1 & cal\_m6\_c2 & cal\_m6\_c3 & cal\_m6\_c4 & cal\_m8t24\_c0 & cal\_m8t24\_c1 & prot\_m12\_c1 & prot\_m12\_c2 & prot\_m12t24\_c0 & prot\_m12t24\_c1 & prot\_m3\_c1 & prot\_m3\_c2 & prot\_m3\_c3 & prot\_m3\_c4 & prot\_m3\_c5 & prot\_m3\_c6 & prot\_m3\_c7 & prot\_m3\_c8 & prot\_m6\_c1 & prot\_m6\_c2 & prot\_m6\_c3 & prot\_m6\_c4 & prot\_m8t24\_c0 & prot\_m8t24\_c1\\
\hline
\rowcolor{gray!6}  Cebu & 1 & 132.15714 & NaN & 97.08333 & 342.6000 & 9.10 & 95.50 & 85.3 & 315.30 & NaN & NaN & NaN & NaN & 52.300 & 238.63333 & NaN & NaN & 52.300 & 238.6333 & 5.3571429 & NaN & 4.3666667 & 11.300000 & 0.65 & 3.65 & 2.6 & 13.15 & NaN & NaN & NaN & NaN & 2.150 & 9.6333333 & NaN & NaN & 2.150 & 9.633333\\
\hline
Cebu & 2 & 90.72857 & 255.6500 & 81.46667 & 240.0286 & 83.35 & 12.30 & 155.1 & 144.35 & 228.0 & 152.85 & 305.0 & 347.60 & 47.825 & 147.93333 & 177.9000 & 333.4000 & 47.825 & 219.7444 & 3.1857143 & 8.550000 & 2.7333333 & 8.171429 & 3.20 & 1.25 & 5.2 & 4.10 & 5.4 & 5.15 & 7.7 & 13.95 & 2.225 & 4.4666667 & 5.233333 & 11.866667 & 2.225 & 7.188889\\
\hline
\rowcolor{gray!6}  Cebu & 3 & 96.80000 & 658.8167 & 31.56667 & 634.4429 & 0.50 & 28.85 & 57.0 & 280.95 & 459.3 & 549.95 & 612.0 & 890.85 & 14.675 & 206.30000 & 519.7333 & 797.9000 & 14.675 & 507.9778 & 4.5000000 & 21.116667 & 1.6833333 & 21.157143 & 1.05 & 2.15 & 2.3 & 11.40 & 18.5 & 18.05 & 18.0 & 27.05 & 1.600 & 8.3666667 & 18.200000 & 24.033333 & 1.600 & 16.866667\\
\hline
Cebu & 4 & 27.45714 & 371.7000 & 24.55000 & 325.0143 & 4.50 & 25.95 & 39.4 & 45.95 & 221.2 & 271.00 & 581.3 & 442.85 & 15.225 & 43.76667 & 254.4000 & 489.0000 & 15.225 & 262.3889 & 0.8714286 & 6.850000 & 0.9000000 & 5.971429 & 0.75 & 1.10 & 1.2 & 0.60 & 1.8 & 4.85 & 10.1 & 9.75 & 0.925 & 0.8000000 & 3.833333 & 9.866667 & 0.925 & 4.833333\\
\hline
\rowcolor{gray!6}  Cebu & 5 & 101.34286 & 1080.8500 & 79.15000 & 959.9429 & 14.10 & 143.80 & 71.3 & 161.15 & 452.6 & 1345.20 & 1178.1 & 1082.00 & 78.950 & 131.20000 & 1047.6667 & 1114.0333 & 78.950 & 764.3000 & 2.4000000 & 19.483333 & 2.3166667 & 17.114286 & 1.35 & 3.00 & 3.4 & 2.35 & 7.1 & 23.15 & 24.5 & 19.50 & 2.175 & 2.7000000 & 17.800000 & 21.166667 & 2.175 & 13.888889\\
\hline
Cebu & 6 & 185.35714 & 521.5333 & 162.23333 & 493.3286 & 23.85 & 184.70 & 169.1 & 355.65 & 653.4 & 506.50 & 416.8 & 523.00 & 104.275 & 293.46667 & 555.4667 & 487.6000 & 104.275 & 445.5111 & 8.4000000 & 15.116667 & 7.3833333 & 15.028571 & 0.85 & 7.40 & 9.8 & 16.25 & 26.8 & 14.10 & 11.4 & 12.15 & 4.125 & 14.1000000 & 18.333333 & 11.900000 & 4.125 & 14.777778\\
\hline
\rowcolor{gray!6}  Cebu & 7 & 157.25714 & 570.9800 & 145.50000 & 513.7833 & 8.30 & 137.80 & 407.8 & 200.40 & 390.6 & 637.10 & 688.1 & 569.55 & 73.050 & 269.53333 & 513.8500 & 609.0667 & 73.050 & 457.9375 & 3.3000000 & 20.440000 & 2.7833333 & 18.100000 & 0.95 & 1.70 & 8.6 & 4.60 & 16.4 & 23.00 & 21.5 & 20.65 & 1.325 & 5.9333333 & 19.700000 & 20.933333 & 1.325 & 15.000000\\
\hline
Cebu & 8 & 471.92857 & 844.8333 & 379.20000 & 871.0429 & 158.95 & 423.00 & 417.5 & 861.05 & 691.3 & 897.95 & 637.1 & 972.35 & 290.975 & 713.20000 & 829.0667 & 860.6000 & 290.975 & 800.9556 & 13.6857143 & 32.716667 & 11.0166667 & 32.285714 & 3.90 & 11.35 & 10.8 & 27.25 & 42.7 & 26.45 & 25.8 & 37.45 & 7.625 & 21.7666667 & 31.866667 & 33.566667 & 7.625 & 29.066667\\
\hline
\rowcolor{gray!6}  Cebu & 9 & 32.27143 & 415.2167 & 16.58333 & 373.9571 & 5.05 & 10.40 & 15.1 & 89.95 & 142.4 & 203.60 & 753.2 & 594.25 & 7.725 & 65.00000 & 183.2000 & 647.2333 & 7.725 & 298.4778 & 0.9571429 & 18.283333 & 0.9166667 & 15.842857 & 0.50 & 0.50 & 0.5 & 2.10 & 4.2 & 10.85 & 39.5 & 22.15 & 0.500 & 1.5666667 & 8.633333 & 27.933333 & 0.500 & 12.711111\\
\hline
Cebu & 10 & 67.18571 & 395.2500 & 68.58333 & 347.1857 & 9.55 & 26.40 & 164.6 & 116.90 & 296.6 & 303.00 & 385.1 & 541.90 & 17.975 & 132.80000 & 300.8667 & 489.6333 & 17.975 & 307.7667 & 2.0428571 & 8.466667 & 1.9333333 & 7.642857 & 0.85 & 0.50 & 4.9 & 3.35 & 7.5 & 6.05 & 9.2 & 11.00 & 0.675 & 3.8666667 & 6.533333 & 10.400000 & 0.675 & 6.933333\\
\hline
\rowcolor{gray!6}  Cebu & 11 & 14.90000 & 245.3833 & 11.80000 & 215.1143 & 0.50 & 5.20 & 30.0 & 31.45 & 126.2 & 223.05 & 239.6 & 330.20 & 2.850 & 30.96667 & 190.7667 & 300.0000 & 2.850 & 173.9111 & 1.0285714 & 6.833333 & 1.1166667 & 5.928571 & 0.80 & 1.70 & 1.2 & 0.50 & 3.6 & 6.35 & 7.3 & 8.70 & 1.250 & 0.7333333 & 5.433333 & 8.233333 & 1.250 & 4.800000\\
\hline
Cebu & 12 & 453.61429 & 745.6833 & 419.51667 & 733.1857 & 325.60 & 483.65 & 463.0 & 546.90 & 766.8 & 676.85 & 998.5 & 677.55 & 404.625 & 518.93333 & 706.8333 & 784.5333 & 404.625 & 670.1000 & 14.7714286 & 22.133333 & 14.1666667 & 21.600000 & 7.40 & 13.60 & 26.6 & 17.40 & 18.6 & 20.35 & 25.6 & 23.95 & 10.500 & 20.4666667 & 19.766667 & 24.500000 & 10.500 & 21.577778\\
\hline
\rowcolor{gray!6}  Cebu & 13 & 47.51429 & 210.2500 & 36.81667 & 196.1714 & 17.45 & 40.00 & 28.5 & 94.60 & 216.9 & 195.15 & 281.3 & 186.50 & 28.725 & 72.56667 & 202.4000 & 218.1000 & 28.725 & 164.3556 & 1.9571429 & 6.800000 & 1.6666667 & 6.357143 & 0.70 & 1.50 & 2.1 & 3.60 & 8.3 & 4.75 & 6.2 & 8.40 & 1.100 & 3.1000000 & 5.933333 & 7.666667 & 1.100 & 5.566667\\
\hline
Cebu & 14 & 608.85714 & 924.5833 & 527.30000 & 949.3857 & 259.05 & 554.30 & 688.1 & 973.60 & 525.5 & 1039.60 & 800.0 & 1071.40 & 406.675 & 878.43333 & 868.2333 & 980.9333 & 406.675 & 909.2000 & 24.6714286 & 28.050000 & 23.0833333 & 28.928571 & 15.05 & 28.85 & 32.6 & 26.15 & 12.7 & 29.75 & 29.5 & 33.30 & 21.950 & 28.3000000 & 24.066667 & 32.033333 & 21.950 & 28.133333\\
\hline
\rowcolor{gray!6}  Cebu & 15 & 74.67143 & 440.0833 & 64.21667 & 396.8429 & 62.40 & 39.60 & 80.1 & 119.30 & 292.5 & 237.45 & 607.8 & 632.65 & 51.000 & 106.23333 & 255.8000 & 624.3667 & 51.000 & 328.8000 & 2.2571429 & 10.633333 & 1.6333333 & 9.971429 & 1.65 & 0.90 & 1.5 & 4.60 & 9.4 & 5.80 & 13.6 & 14.60 & 1.275 & 3.5666667 & 7.000000 & 14.266667 & 1.275 & 8.277778\\
\hline
Cebu & 16 & 128.45714 & 519.9333 & 90.50000 & 496.5429 & 4.80 & 11.00 & 205.3 & 331.15 & 290.8 & 354.50 & 563.3 & 778.25 & 7.900 & 289.20000 & 333.2667 & 706.6000 & 7.900 & 443.0222 & 4.6857143 & 18.083333 & 4.1000000 & 16.671429 & 0.65 & 2.70 & 8.7 & 8.70 & 7.8 & 12.95 & 25.9 & 24.45 & 1.675 & 8.7000000 & 11.233333 & 24.933333 & 1.675 & 14.955556\\
\hline
\rowcolor{gray!6}  Cebu & 17 & 130.78571 & 718.8667 & 97.48333 & 663.4000 & 5.50 & 7.80 & 249.9 & 319.50 & 774.6 & 892.90 & 551.9 & 600.45 & 6.650 & 296.30000 & 853.4667 & 584.2667 & 6.650 & 578.0111 & 2.8142857 & 19.716667 & 2.2166667 & 17.814286 & 0.60 & 0.50 & 6.1 & 5.70 & 20.1 & 21.55 & 24.9 & 15.10 & 0.550 & 5.8333333 & 21.066667 & 18.366667 & 0.550 & 15.088889\\
\hline
Cebu & 18 & 172.64000 & 497.9500 & 172.64000 & 497.9500 & 29.60 & 234.40 & NaN & 335.20 & NaN & NaN & NaN & 497.95 & 132.000 & 335.20000 & NaN & 497.9500 & 132.000 & 443.7000 & 11.7000000 & 19.100000 & 11.7000000 & 19.100000 & 2.95 & 17.90 & NaN & 16.80 & NaN & NaN & NaN & 19.10 & 10.425 & 16.8000000 & NaN & 19.100000 & 10.425 & 18.333333\\
\hline
\rowcolor{gray!6}  Cebu & 19 & 74.45714 & 314.7333 & 80.10000 & 275.5714 & 3.65 & 95.70 & 171.3 & 75.60 & 131.3 & 350.50 & 304.6 & 375.75 & 49.675 & 107.50000 & 277.4333 & 352.0333 & 49.675 & 245.6556 & 2.5428571 & 10.466667 & 2.8833333 & 9.042857 & 0.50 & 2.95 & 6.7 & 2.10 & 3.4 & 11.40 & 12.3 & 12.15 & 1.725 & 3.6333333 & 8.733333 & 12.200000 & 1.725 & 8.188889\\
\hline
Cebu & 20 & 110.90000 & 583.2000 & 80.51667 & 541.7714 & 7.30 & 120.65 & 77.8 & 221.30 & 391.2 & 582.10 & 466.1 & 738.85 & 63.975 & 173.46667 & 518.4667 & 647.9333 & 63.975 & 446.6222 & 3.2000000 & 16.966667 & 2.1833333 & 15.871429 & 0.50 & 3.85 & 2.7 & 5.50 & 7.9 & 20.15 & 11.8 & 20.90 & 2.175 & 4.5666667 & 16.066667 & 17.866667 & 2.175 & 12.833333\\
\hline
\end{tabular}}
\end{table}

\hypertarget{distributional-statistics}{%
\section{Distributional Statistics}\label{distributional-statistics}}

\hypertarget{histogram}{%
\subsection{Histogram}\label{histogram}}

\hypertarget{generate-test-score-dataset}{%
\subsubsection{Generate Test Score Dataset}\label{generate-test-score-dataset}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

\begin{itemize}
\tightlist
\item
  r generate text string as csv
\item
  r tibble matrix hand input
\end{itemize}

First, we will generate a test score dataset, directly from string. Below we type line by line a dataset with four variables in comma separated (csv) format, where the first row includes the variables names. These texts could be stored in a separate file, or they could be directly included in code and read in as csv

\hypertarget{a-dataset-with-only-two-continuous-variable}{%
\paragraph{A Dataset with only Two Continuous Variable}\label{a-dataset-with-only-two-continuous-variable}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ar\_test\_scores\_ec3 \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\FloatTok{107.72}\NormalTok{,}\FloatTok{101.28}\NormalTok{,}\FloatTok{105.92}\NormalTok{,}\FloatTok{109.31}\NormalTok{,}\FloatTok{104.27}\NormalTok{,}\FloatTok{110.27}\NormalTok{,}\FloatTok{91.92846154}\NormalTok{,}\FloatTok{81.8}\NormalTok{,}\FloatTok{109.0071429}\NormalTok{,}\FloatTok{103.07}\NormalTok{,}\FloatTok{98.97923077}\NormalTok{,}\FloatTok{101.91}\NormalTok{,}\FloatTok{96.49}\NormalTok{,}\FloatTok{97.79923077}\NormalTok{,}\FloatTok{99.07846154}\NormalTok{,}\FloatTok{99.17}\NormalTok{,}\FloatTok{103.51}\NormalTok{,}\FloatTok{112.2225}\NormalTok{,}\FloatTok{101.2964286}\NormalTok{,}\FloatTok{94.5}\NormalTok{,}\FloatTok{98.92}\NormalTok{,}\FloatTok{97.09}\NormalTok{,}\FloatTok{93.83989011}\NormalTok{,}\FloatTok{97.36304945}\NormalTok{,}\FloatTok{80.34}\NormalTok{,}\FloatTok{65.74}\NormalTok{,}\FloatTok{85.275}\NormalTok{,}\FloatTok{82.19708791}\NormalTok{,}\FloatTok{86.53758242}\NormalTok{,}\FloatTok{86.2025}\NormalTok{,}\FloatTok{86.63}\NormalTok{,}\FloatTok{82.57392857}\NormalTok{,}\FloatTok{83.66}\NormalTok{,}\FloatTok{79.76}\NormalTok{,}\FloatTok{75.55642857}\NormalTok{,}\FloatTok{86.32571429}\NormalTok{,}\FloatTok{66.41}\NormalTok{,}\FloatTok{76.06}\NormalTok{,}\FloatTok{44.225}\NormalTok{,}\FloatTok{82.28}\NormalTok{,}\FloatTok{47.77392857}\NormalTok{,}\FloatTok{70.005}\NormalTok{,}\FloatTok{69.13769231}\NormalTok{,}\FloatTok{73.52571429}\NormalTok{,}\FloatTok{60.51}\NormalTok{,}\FloatTok{56.04}\NormalTok{)}
\NormalTok{ar\_test\_scores\_ec1 \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\FloatTok{101.72}\NormalTok{,}\FloatTok{101.28}\NormalTok{,}\FloatTok{99.92}\NormalTok{,}\FloatTok{103.31}\NormalTok{,}\FloatTok{100.27}\NormalTok{,}\FloatTok{104.27}\NormalTok{,}\FloatTok{90.23615385}\NormalTok{,}\FloatTok{77.8}\NormalTok{,}\FloatTok{103.4357143}\NormalTok{,}\FloatTok{97.07}\NormalTok{,}\FloatTok{93.13307692}\NormalTok{,}\FloatTok{95.91}\NormalTok{,}\FloatTok{92.49}\NormalTok{,}\FloatTok{93.95307692}\NormalTok{,}\FloatTok{95.38615385}\NormalTok{,}\FloatTok{97.17}\NormalTok{,}\FloatTok{99.51}\NormalTok{,}\FloatTok{100.3475}\NormalTok{,}\FloatTok{95.83214286}\NormalTok{,}\FloatTok{92.5}\NormalTok{,}\FloatTok{94.92}\NormalTok{,}\FloatTok{91.09}\NormalTok{,}\FloatTok{90.4332967}\NormalTok{,}\FloatTok{93.52101648}\NormalTok{,}\FloatTok{80.34}\NormalTok{,}\FloatTok{59.74}\NormalTok{,}\FloatTok{79.525}\NormalTok{,}\FloatTok{77.67236264}\NormalTok{,}\FloatTok{81.59252747}\NormalTok{,}\FloatTok{82.3275}\NormalTok{,}\FloatTok{80.63}\NormalTok{,}\FloatTok{76.98464286}\NormalTok{,}\FloatTok{81.66}\NormalTok{,}\FloatTok{79.76}\NormalTok{,}\FloatTok{70.59214286}\NormalTok{,}\FloatTok{82.46857143}\NormalTok{,}\FloatTok{66.41}\NormalTok{,}\FloatTok{74.06}\NormalTok{,}\FloatTok{40.475}\NormalTok{,}\FloatTok{76.28}\NormalTok{,}\FloatTok{44.18464286}\NormalTok{,}\FloatTok{66.255}\NormalTok{,}\FloatTok{65.59923077}\NormalTok{,}\FloatTok{69.66857143}\NormalTok{,}\FloatTok{60.51}\NormalTok{,}\FloatTok{56.04}\NormalTok{)}
\NormalTok{mt\_test\_scores \textless{}{-}}\StringTok{ }\KeywordTok{cbind}\NormalTok{(ar\_test\_scores\_ec1, ar\_test\_scores\_ec3)}
\NormalTok{ar\_st\_varnames \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}course\_total\_ec1p\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}course\_total\_ec3p\textquotesingle{}}\NormalTok{)}
\NormalTok{tb\_final\_twovar \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(mt\_test\_scores) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{rename\_all}\NormalTok{(}\OperatorTok{\textasciitilde{}}\KeywordTok{c}\NormalTok{(ar\_st\_varnames))}
\KeywordTok{summary}\NormalTok{(tb\_final\_twovar)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  course_total_ec1p course_total_ec3p
##  Min.   : 40.48    Min.   : 44.23   
##  1st Qu.: 76.46    1st Qu.: 79.91   
##  Median : 86.35    Median : 89.28   
##  Mean   : 83.88    Mean   : 87.90   
##  3rd Qu.: 95.89    3rd Qu.:100.75   
##  Max.   :104.27    Max.   :112.22
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ff\_summ\_percentiles}\NormalTok{(}\DataTypeTok{df =}\NormalTok{ tb\_final\_twovar, }\DataTypeTok{bl\_statsasrows =} \OtherTok{TRUE}\NormalTok{, }\DataTypeTok{col2varname =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{a-dataset-with-one-continuous-variable-and-histogram}{%
\paragraph{A Dataset with one Continuous Variable and Histogram}\label{a-dataset-with-one-continuous-variable-and-histogram}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ar\_final\_scores \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\FloatTok{94.28442509}\NormalTok{,}\FloatTok{95.68817475}\NormalTok{,}\FloatTok{97.25219512}\NormalTok{,}\FloatTok{77.89268293}\NormalTok{,}\FloatTok{95.08795497}\NormalTok{,}\FloatTok{93.27380863}\NormalTok{,}\FloatTok{92.3}\NormalTok{,}\FloatTok{84.25317073}\NormalTok{,}\FloatTok{86.08642991}\NormalTok{,}\FloatTok{84.69219512}\NormalTok{,}\FloatTok{71.43634146}\NormalTok{,}\FloatTok{76.21365854}\NormalTok{,}\FloatTok{71.68878049}\NormalTok{,}\FloatTok{77.46142589}\NormalTok{,}\FloatTok{79.29579268}\NormalTok{,}\FloatTok{43.7285453}\NormalTok{,}\FloatTok{63.80634146}\NormalTok{,}\FloatTok{67.92994774}\NormalTok{,}\FloatTok{100.8980488}\NormalTok{,}\FloatTok{100.0857143}\NormalTok{,}\FloatTok{99.93073171}\NormalTok{,}\FloatTok{98.4102439}\NormalTok{,}\FloatTok{97.93}\NormalTok{,}\FloatTok{97.10359756}\NormalTok{,}\FloatTok{96.97121951}\NormalTok{,}\FloatTok{96.60292683}\NormalTok{,}\FloatTok{96.23317073}\NormalTok{,}\FloatTok{93.92243902}\NormalTok{,}\FloatTok{93.82243902}\NormalTok{,}\FloatTok{92.75390244}\NormalTok{,}\FloatTok{92.65775261}\NormalTok{,}\FloatTok{92.20444653}\NormalTok{,}\FloatTok{91.73463415}\NormalTok{,}\FloatTok{90.38321161}\NormalTok{,}\FloatTok{89.37414634}\NormalTok{,}\FloatTok{86.95932458}\NormalTok{,}\FloatTok{79.58686411}\NormalTok{,}\FloatTok{78.70878049}\NormalTok{,}\FloatTok{77.2497561}\NormalTok{,}\FloatTok{76.88195122}\NormalTok{,}\FloatTok{76.52987805}\NormalTok{,}\FloatTok{74.72114313}\NormalTok{,}\FloatTok{74.27488676}\NormalTok{,}\FloatTok{71.30268293}\NormalTok{,}\FloatTok{63.70256098}\NormalTok{,}\FloatTok{37.90426829}\NormalTok{,}\FloatTok{2.292682927}\NormalTok{)}
\NormalTok{mt\_test\_scores \textless{}{-}}\StringTok{ }\KeywordTok{cbind}\NormalTok{(}\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,}\KeywordTok{length}\NormalTok{(ar\_final\_scores)), ar\_final\_scores)}
\NormalTok{ar\_st\_varnames \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}index\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}course\_final\textquotesingle{}}\NormalTok{)}
\NormalTok{tb\_onevar \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(mt\_test\_scores) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{rename\_all}\NormalTok{(}\OperatorTok{\textasciitilde{}}\KeywordTok{c}\NormalTok{(ar\_st\_varnames))}
\KeywordTok{summary}\NormalTok{(tb\_onevar)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      index       course_final    
##  Min.   : 1.0   Min.   :  2.293  
##  1st Qu.:12.5   1st Qu.: 76.372  
##  Median :24.0   Median : 86.959  
##  Mean   :24.0   Mean   : 82.415  
##  3rd Qu.:35.5   3rd Qu.: 94.686  
##  Max.   :47.0   Max.   :100.898
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ff\_summ\_percentiles}\NormalTok{(}\DataTypeTok{df =}\NormalTok{ tb\_onevar, }\DataTypeTok{bl\_statsasrows =} \OtherTok{TRUE}\NormalTok{, }\DataTypeTok{col2varname =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{a-dataset-with-multiple-variables}{%
\paragraph{A Dataset with Multiple Variables}\label{a-dataset-with-multiple-variables}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#load in data empirically by hand}
\NormalTok{txt\_test\_data \textless{}{-}}\StringTok{ "init\_prof, later\_prof, class\_id, exam\_score}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 102}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 102}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 101}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 100}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 100}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 99}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 98.5}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 98.5}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 97}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 95}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 94}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 91}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 91}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 90}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 89}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 88.5}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 88}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 87}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 87}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 87}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 86}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 86}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 84}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 82}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 78.5}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 76}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 72}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 70.5}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 67.5}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 67.5}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 67}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 63.5}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 60}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 59}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 44.5}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 44}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 42.5}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 40.5}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 40.5}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 36.5}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 35.5}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 21.5}
\StringTok{ \textquotesingle{}SW\textquotesingle{}, \textquotesingle{}SW\textquotesingle{}, 1, 4}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 105}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 103}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 102}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 101}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 101}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 100.5}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 100}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 99}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 97}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 97}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 97}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 97}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 96}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 95}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 91}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 89}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 85}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 84}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 84}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 84}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 83.5}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 82.5}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 81.5}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 80.5}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 80}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 77}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 77}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 75}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 75}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 71}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 70}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 68}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 63}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 56}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 56}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 55.5}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 49.5}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 48.5}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 47.5}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 44.5}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 34.5}
\StringTok{ \textquotesingle{}MP\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 2, 29.5}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 3, 103}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 3, 103}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 3, 101}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 3, 96.5}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 3, 93.5}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 3, 93}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 3, 93}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 3, 92}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 3, 90}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 3, 90}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 3, 89}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 3, 86.5}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 3, 84.5}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 3, 83}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 3, 83}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 3, 82}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 3, 78}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 3, 75}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 3, 74.5}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 3, 70}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 3, 54.5}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 3, 52}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 3, 50}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 3, 42}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 3, 36.5}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 3, 28}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 3, 26}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}MP\textquotesingle{}, 3, 11}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 103}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 103}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 102}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 102}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 101}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 100}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 98}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 98}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 98}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 95}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 95}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 92.5}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 92}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 91}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 90}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 85.5}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 84}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 82.5}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 81}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 77.5}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 77}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 72}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 71.5}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 69}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 68.5}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 68}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 67}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 65.5}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 62.5}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 62}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 61.5}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 61}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 57.5}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 54}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 52.5}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 51}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 50.5}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 50}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 49}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 43}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 39.5}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 32.5}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 25.5}
\StringTok{ \textquotesingle{}CA\textquotesingle{}, \textquotesingle{}SN\textquotesingle{}, 4, 18"}

\NormalTok{csv\_test\_data =}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\DataTypeTok{text=}\NormalTok{txt\_test\_data, }\DataTypeTok{header=}\OtherTok{TRUE}\NormalTok{)}
\NormalTok{ar\_st\_varnames \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}first\_half\_professor\textquotesingle{}}\NormalTok{,}
                    \StringTok{\textquotesingle{}second\_half\_professor\textquotesingle{}}\NormalTok{,}
                    \StringTok{\textquotesingle{}course\_id\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}exam\_score\textquotesingle{}}\NormalTok{)}
\NormalTok{tb\_test\_data \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(csv\_test\_data) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{rename\_all}\NormalTok{(}\OperatorTok{\textasciitilde{}}\KeywordTok{c}\NormalTok{(ar\_st\_varnames))}
\KeywordTok{summary}\NormalTok{(tb\_test\_data)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  first_half_professor second_half_professor   course_id       exam_score    
##  Length:157           Length:157            Min.   :1.000   Min.   :  4.00  
##  Class :character     Class :character      1st Qu.:1.000   1st Qu.: 60.00  
##  Mode  :character     Mode  :character      Median :2.000   Median : 82.00  
##                                             Mean   :2.465   Mean   : 75.08  
##                                             3rd Qu.:4.000   3rd Qu.: 94.00  
##                                             Max.   :4.000   Max.   :105.00
\end{verbatim}

\hypertarget{test-score-distributions}{%
\subsubsection{Test Score Distributions}\label{test-score-distributions}}

\hypertarget{histogram-1}{%
\paragraph{Histogram}\label{histogram-1}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(tb\_final\_twovar, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{ar\_test\_scores\_ec3)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom\_histogram}\NormalTok{(}\DataTypeTok{bins=}\DecValTok{25}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{title =} \KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}Sandbox: Final Distribution (Econ 2370, FW)\textquotesingle{}}\NormalTok{),}
       \DataTypeTok{caption =} \KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}FW Section, formula:\textquotesingle{}}\NormalTok{,}
                        \StringTok{\textquotesingle{}0.3*exam1Perc + 0.3*exam2Perc + \textquotesingle{}}\NormalTok{,}
                        \StringTok{\textquotesingle{}0.42*HWtotalPerc + 0.03*AttendancePerc }\CharTok{\textbackslash{}n}\StringTok{\textquotesingle{}}\NormalTok{,}
                        \StringTok{\textquotesingle{}+ perfect attendance + 0.03 per Extra Credit\textquotesingle{}}\NormalTok{)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{Panel-Data-and-Optimization-with-R_files/figure-latex/unnamed-chunk-81-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(tb\_test\_data, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{exam\_score)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom\_histogram}\NormalTok{(}\DataTypeTok{bins=}\DecValTok{16}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{title =} \KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}Exam Distribution\textquotesingle{}}\NormalTok{),}
       \DataTypeTok{caption =} \StringTok{\textquotesingle{}All Sections\textquotesingle{}}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{Panel-Data-and-Optimization-with-R_files/figure-latex/unnamed-chunk-82-1} \end{center}

\hypertarget{summarize-multiple-variables}{%
\section{Summarize Multiple Variables}\label{summarize-multiple-variables}}

\hypertarget{generate-replace-variables}{%
\subsection{Generate Replace Variables}\label{generate-replace-variables}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

\hypertarget{replace-na-for-multiple-variables}{%
\subsubsection{Replace NA for Multiple Variables}\label{replace-na-for-multiple-variables}}

Replace some variables NA by some values, and other variables' NAs by other values.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Define}
\NormalTok{it\_N \textless{}{-}}\StringTok{ }\DecValTok{3}
\NormalTok{it\_M \textless{}{-}}\StringTok{ }\DecValTok{5}
\NormalTok{svr\_id \textless{}{-}}\StringTok{ \textquotesingle{}date\textquotesingle{}}

\CommentTok{\# NA dataframe}
\NormalTok{df\_NA \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(}\KeywordTok{matrix}\NormalTok{(}\OtherTok{NA}\NormalTok{, }\DataTypeTok{nrow=}\NormalTok{it\_N, }\DataTypeTok{ncol=}\NormalTok{it\_M)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rowid\_to\_column}\NormalTok{(}\DataTypeTok{var =}\NormalTok{ svr\_id) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rename\_at}\NormalTok{(}\KeywordTok{vars}\NormalTok{(}\KeywordTok{starts\_with}\NormalTok{(}\StringTok{"V"}\NormalTok{)),}
            \KeywordTok{funs}\NormalTok{(}\KeywordTok{str\_replace}\NormalTok{(., }\StringTok{"V"}\NormalTok{, }\StringTok{"var"}\NormalTok{)))}
\KeywordTok{kable}\NormalTok{(df\_NA) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|l|l|l|l|l}
\hline
date & var1 & var2 & var3 & var4 & var5\\
\hline
\rowcolor{gray!6}  1 & NA & NA & NA & NA & NA\\
\hline
2 & NA & NA & NA & NA & NA\\
\hline
\rowcolor{gray!6}  3 & NA & NA & NA & NA & NA\\
\hline
\end{tabular}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Replace NA}
\NormalTok{df\_NA\_replace \textless{}{-}}\StringTok{ }\NormalTok{df\_NA }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate\_at}\NormalTok{(}\KeywordTok{vars}\NormalTok{(}\KeywordTok{one\_of}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}var1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}var2\textquotesingle{}}\NormalTok{))), }\KeywordTok{list}\NormalTok{(}\OperatorTok{\textasciitilde{}}\KeywordTok{replace\_na}\NormalTok{(., }\DecValTok{0}\NormalTok{))) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate\_at}\NormalTok{(}\KeywordTok{vars}\NormalTok{(}\KeywordTok{one\_of}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}var3\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}var5\textquotesingle{}}\NormalTok{))), }\KeywordTok{list}\NormalTok{(}\OperatorTok{\textasciitilde{}}\KeywordTok{replace\_na}\NormalTok{(., }\DecValTok{99}\NormalTok{)))}
\KeywordTok{kable}\NormalTok{(df\_NA\_replace) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r|r|l|r}
\hline
date & var1 & var2 & var3 & var4 & var5\\
\hline
\rowcolor{gray!6}  1 & 0 & 0 & 99 & NA & 99\\
\hline
2 & 0 & 0 & 99 & NA & 99\\
\hline
\rowcolor{gray!6}  3 & 0 & 0 & 99 & NA & 99\\
\hline
\end{tabular}
\end{table}

\hypertarget{cumulative-sum-multiple-variables}{%
\subsubsection{Cumulative Sum Multiple Variables}\label{cumulative-sum-multiple-variables}}

Each row is a different date, each column is the profit a firms earns on a date, we want to compute cumulatively how much a person is earning. Also renames variable names below jointly.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Define}
\NormalTok{it\_N \textless{}{-}}\StringTok{ }\DecValTok{3}
\NormalTok{it\_M \textless{}{-}}\StringTok{ }\DecValTok{5}
\NormalTok{svr\_id \textless{}{-}}\StringTok{ \textquotesingle{}date\textquotesingle{}}

\CommentTok{\# random dataframe, daily profit of firms}
\CommentTok{\# dp\_fx: daily profit firm ID something}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{123}\NormalTok{)}
\NormalTok{df\_daily\_profit \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(}\KeywordTok{matrix}\NormalTok{(}\KeywordTok{rnorm}\NormalTok{(it\_N}\OperatorTok{*}\NormalTok{it\_M), }\DataTypeTok{nrow=}\NormalTok{it\_N, }\DataTypeTok{ncol=}\NormalTok{it\_M)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rowid\_to\_column}\NormalTok{(}\DataTypeTok{var =}\NormalTok{ svr\_id) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rename\_at}\NormalTok{(}\KeywordTok{vars}\NormalTok{(}\KeywordTok{starts\_with}\NormalTok{(}\StringTok{"V"}\NormalTok{)),}
            \KeywordTok{funs}\NormalTok{(}\KeywordTok{str\_replace}\NormalTok{(., }\StringTok{"V"}\NormalTok{, }\StringTok{"dp\_f"}\NormalTok{)))}
\KeywordTok{kable}\NormalTok{(df\_daily\_profit) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r|r|r|r}
\hline
date & dp\_f1 & dp\_f2 & dp\_f3 & dp\_f4 & dp\_f5\\
\hline
\rowcolor{gray!6}  1 & -0.5604756 & 0.0705084 & 0.4609162 & -0.4456620 & 0.4007715\\
\hline
2 & -0.2301775 & 0.1292877 & -1.2650612 & 1.2240818 & 0.1106827\\
\hline
\rowcolor{gray!6}  3 & 1.5587083 & 1.7150650 & -0.6868529 & 0.3598138 & -0.5558411\\
\hline
\end{tabular}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# cumulative sum with suffix}
\NormalTok{df\_cumu\_profit\_suffix \textless{}{-}}\StringTok{ }\NormalTok{df\_daily\_profit }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate\_at}\NormalTok{(}\KeywordTok{vars}\NormalTok{(}\KeywordTok{contains}\NormalTok{(}\StringTok{\textquotesingle{}dp\_f\textquotesingle{}}\NormalTok{)), }\DataTypeTok{.funs =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{cumu =} \OperatorTok{\textasciitilde{}}\KeywordTok{cumsum}\NormalTok{(.)))}
\KeywordTok{kable}\NormalTok{(df\_cumu\_profit\_suffix) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{r|r|r|r|r|r|r|r|r|r|r}
\hline
date & dp\_f1 & dp\_f2 & dp\_f3 & dp\_f4 & dp\_f5 & dp\_f1\_cumu & dp\_f2\_cumu & dp\_f3\_cumu & dp\_f4\_cumu & dp\_f5\_cumu\\
\hline
\rowcolor{gray!6}  1 & -0.5604756 & 0.0705084 & 0.4609162 & -0.4456620 & 0.4007715 & -0.5604756 & 0.0705084 & 0.4609162 & -0.4456620 & 0.4007715\\
\hline
2 & -0.2301775 & 0.1292877 & -1.2650612 & 1.2240818 & 0.1106827 & -0.7906531 & 0.1997961 & -0.8041450 & 0.7784198 & 0.5114542\\
\hline
\rowcolor{gray!6}  3 & 1.5587083 & 1.7150650 & -0.6868529 & 0.3598138 & -0.5558411 & 0.7680552 & 1.9148611 & -1.4909979 & 1.1382337 & -0.0443870\\
\hline
\end{tabular}}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# cumulative sum variables naming to prefix}
\NormalTok{df\_cumu\_profit \textless{}{-}}\StringTok{ }\NormalTok{df\_cumu\_profit\_suffix }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rename\_at}\NormalTok{(}\KeywordTok{vars}\NormalTok{(}\KeywordTok{contains}\NormalTok{( }\StringTok{"\_cumu"}\NormalTok{) ), }\KeywordTok{list}\NormalTok{(}\OperatorTok{\textasciitilde{}}\KeywordTok{paste}\NormalTok{(}\StringTok{"cp\_f"}\NormalTok{, }\KeywordTok{gsub}\NormalTok{(}\StringTok{"\_cumu"}\NormalTok{, }\StringTok{""}\NormalTok{, .), }\DataTypeTok{sep =} \StringTok{""}\NormalTok{))) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rename\_at}\NormalTok{(}\KeywordTok{vars}\NormalTok{(}\KeywordTok{contains}\NormalTok{( }\StringTok{"cp\_f"}\NormalTok{) ), }\KeywordTok{list}\NormalTok{(}\OperatorTok{\textasciitilde{}}\KeywordTok{gsub}\NormalTok{(}\StringTok{"dp\_f"}\NormalTok{, }\StringTok{""}\NormalTok{, .)))}
\KeywordTok{kable}\NormalTok{(df\_cumu\_profit) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{r|r|r|r|r|r|r|r|r|r|r}
\hline
date & dp\_f1 & dp\_f2 & dp\_f3 & dp\_f4 & dp\_f5 & cp\_f1 & cp\_f2 & cp\_f3 & cp\_f4 & cp\_f5\\
\hline
\rowcolor{gray!6}  1 & -0.5604756 & 0.0705084 & 0.4609162 & -0.4456620 & 0.4007715 & -0.5604756 & 0.0705084 & 0.4609162 & -0.4456620 & 0.4007715\\
\hline
2 & -0.2301775 & 0.1292877 & -1.2650612 & 1.2240818 & 0.1106827 & -0.7906531 & 0.1997961 & -0.8041450 & 0.7784198 & 0.5114542\\
\hline
\rowcolor{gray!6}  3 & 1.5587083 & 1.7150650 & -0.6868529 & 0.3598138 & -0.5558411 & 0.7680552 & 1.9148611 & -1.4909979 & 1.1382337 & -0.0443870\\
\hline
\end{tabular}}
\end{table}

\hypertarget{functions}{%
\chapter{Functions}\label{functions}}

\hypertarget{dataframe-mutate}{%
\section{Dataframe Mutate}\label{dataframe-mutate}}

\hypertarget{row-input-functions}{%
\subsection{Row Input Functions}\label{row-input-functions}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

We want evaluate nonlinear function f(Q\_i, y\_i, ar\_x, ar\_y, c, d), where c and d are constants, and ar\_x and ar\_y are arrays, both fixed. x\_i and y\_i vary over each row of matrix. We would like to evaluate this nonlinear function concurrently across \(N\) individuals. The eventual goal is to find the \(i\) specific \(Q\) that solves the nonlinear equations.

This is a continuation of \href{https://fanwangecon.github.io/R4Econ/function/noloop/fs_applysapplymutate.html}{R use Apply, Sapply and dplyr Mutate to Evaluate one Function Across Rows of a Matrix}

\hypertarget{set-up-input-arrays}{%
\subsubsection{Set up Input Arrays}\label{set-up-input-arrays}}

There is a function that takes \(M=Q+P\) inputs, we want to evaluate this function \(N\) times. Each time, there are \(M\) inputs, where all but \(Q\) of the \(M\) inputs, meaning \(P\) of the \(M\) inputs, are the same. In particular, \(P=Q*N\).

\[M = Q+P = Q + Q*N\]

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# it\_child\_count = N, the number of children}
\NormalTok{it\_N\_child\_cnt =}\StringTok{ }\DecValTok{5}
\CommentTok{\# it\_heter\_param = Q, number of parameters that are heterogeneous across children}
\NormalTok{it\_Q\_hetpa\_cnt =}\StringTok{ }\DecValTok{2}

\CommentTok{\# P fixed parameters, nN is N dimensional, nP is P dimensional}
\NormalTok{ar\_nN\_A =}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\OperatorTok{{-}}\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DataTypeTok{length.out =}\NormalTok{ it\_N\_child\_cnt)}
\NormalTok{ar\_nN\_alpha =}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\FloatTok{0.1}\NormalTok{, }\FloatTok{0.9}\NormalTok{, }\DataTypeTok{length.out =}\NormalTok{ it\_N\_child\_cnt)}
\NormalTok{ar\_nP\_A\_alpha =}\StringTok{ }\KeywordTok{c}\NormalTok{(ar\_nN\_A, ar\_nN\_alpha)}
\NormalTok{ar\_nN\_N\_choice =}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,it\_N\_child\_cnt)}\OperatorTok{/}\KeywordTok{sum}\NormalTok{(}\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,it\_N\_child\_cnt))}

\CommentTok{\# N by Q varying parameters}
\NormalTok{mt\_nN\_by\_nQ\_A\_alpha =}\StringTok{ }\KeywordTok{cbind}\NormalTok{(ar\_nN\_A, ar\_nN\_alpha, ar\_nN\_N\_choice)}
\CommentTok{\# Show}
\KeywordTok{kable}\NormalTok{(mt\_nN\_by\_nQ\_A\_alpha) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r}
\hline
ar\_nN\_A & ar\_nN\_alpha & ar\_nN\_N\_choice\\
\hline
\rowcolor{gray!6}  -2 & 0.1 & 0.0666667\\
\hline
-1 & 0.3 & 0.1333333\\
\hline
\rowcolor{gray!6}  0 & 0.5 & 0.2000000\\
\hline
1 & 0.7 & 0.2666667\\
\hline
\rowcolor{gray!6}  2 & 0.9 & 0.3333333\\
\hline
\end{tabular}
\end{table}

\hypertarget{testing-function}{%
\subsubsection{Testing Function}\label{testing-function}}

Test non-linear Equation.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Test Parameters}
\NormalTok{fl\_N\_agg =}\StringTok{ }\DecValTok{100}
\NormalTok{fl\_rho =}\StringTok{ }\DecValTok{{-}1}
\NormalTok{fl\_N\_q =}\StringTok{ }\NormalTok{ar\_nN\_N\_choice[}\DecValTok{4}\NormalTok{]}\OperatorTok{*}\NormalTok{fl\_N\_agg}
\NormalTok{ar\_A\_alpha =}\StringTok{ }\NormalTok{mt\_nN\_by\_nQ\_A\_alpha[}\DecValTok{4}\NormalTok{,]}
\CommentTok{\# Apply Function}
\NormalTok{ar\_p1\_s1 =}\StringTok{ }\KeywordTok{exp}\NormalTok{((ar\_A\_alpha[}\DecValTok{1}\NormalTok{] }\OperatorTok{{-}}\StringTok{ }\NormalTok{ar\_nN\_A)}\OperatorTok{*}\NormalTok{fl\_rho)}
\NormalTok{ar\_p1\_s2 =}\StringTok{ }\NormalTok{(ar\_A\_alpha[}\DecValTok{2}\NormalTok{]}\OperatorTok{/}\NormalTok{ar\_nN\_alpha)}
\NormalTok{ar\_p1\_s3 =}\StringTok{ }\NormalTok{(}\DecValTok{1}\OperatorTok{/}\NormalTok{(ar\_nN\_alpha}\OperatorTok{*}\NormalTok{fl\_rho }\OperatorTok{{-}}\StringTok{ }\DecValTok{1}\NormalTok{))}
\NormalTok{ar\_p1 =}\StringTok{ }\NormalTok{(ar\_p1\_s1}\OperatorTok{*}\NormalTok{ar\_p1\_s2)}\OperatorTok{\^{}}\NormalTok{ar\_p1\_s3}
\NormalTok{ar\_p2 =}\StringTok{ }\NormalTok{fl\_N\_q}\OperatorTok{\^{}}\NormalTok{((ar\_A\_alpha[}\DecValTok{2}\NormalTok{]}\OperatorTok{*}\NormalTok{fl\_rho}\DecValTok{{-}1}\NormalTok{)}\OperatorTok{/}\NormalTok{(ar\_nN\_alpha}\OperatorTok{*}\NormalTok{fl\_rho}\DecValTok{{-}1}\NormalTok{))}
\NormalTok{ar\_overall =}\StringTok{ }\NormalTok{ar\_p1}\OperatorTok{*}\NormalTok{ar\_p2}
\NormalTok{fl\_overall =}\StringTok{ }\NormalTok{fl\_N\_agg }\OperatorTok{{-}}\StringTok{ }\KeywordTok{sum}\NormalTok{(ar\_overall)}
\KeywordTok{print}\NormalTok{(fl\_overall)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] -598.2559
\end{verbatim}

Implement the non-linear problem's evaluation using apply over all \(N\) individuals.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Define Implicit Function}
\NormalTok{ffi\_nonlin\_dplyrdo \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(fl\_A, fl\_alpha, fl\_N, ar\_A, ar\_alpha, fl\_N\_agg, fl\_rho)\{}
  \CommentTok{\# ar\_A\_alpha[1] is A}
  \CommentTok{\# ar\_A\_alpha[2] is alpha}

  \CommentTok{\# \# Test Parameters}
  \CommentTok{\# fl\_N = 100}
  \CommentTok{\# fl\_rho = {-}1}
  \CommentTok{\# fl\_N\_q = 10}

  \CommentTok{\# Apply Function}
\NormalTok{  ar\_p1\_s1 =}\StringTok{ }\KeywordTok{exp}\NormalTok{((fl\_A }\OperatorTok{{-}}\StringTok{ }\NormalTok{ar\_A)}\OperatorTok{*}\NormalTok{fl\_rho)}
\NormalTok{  ar\_p1\_s2 =}\StringTok{ }\NormalTok{(fl\_alpha}\OperatorTok{/}\NormalTok{ar\_alpha)}
\NormalTok{  ar\_p1\_s3 =}\StringTok{ }\NormalTok{(}\DecValTok{1}\OperatorTok{/}\NormalTok{(ar\_alpha}\OperatorTok{*}\NormalTok{fl\_rho }\OperatorTok{{-}}\StringTok{ }\DecValTok{1}\NormalTok{))}
\NormalTok{  ar\_p1 =}\StringTok{ }\NormalTok{(ar\_p1\_s1}\OperatorTok{*}\NormalTok{ar\_p1\_s2)}\OperatorTok{\^{}}\NormalTok{ar\_p1\_s3}
\NormalTok{  ar\_p2 =}\StringTok{ }\NormalTok{fl\_N}\OperatorTok{\^{}}\NormalTok{((fl\_alpha}\OperatorTok{*}\NormalTok{fl\_rho}\DecValTok{{-}1}\NormalTok{)}\OperatorTok{/}\NormalTok{(ar\_alpha}\OperatorTok{*}\NormalTok{fl\_rho}\DecValTok{{-}1}\NormalTok{))}
\NormalTok{  ar\_overall =}\StringTok{ }\NormalTok{ar\_p1}\OperatorTok{*}\NormalTok{ar\_p2}
\NormalTok{  fl\_overall =}\StringTok{ }\NormalTok{fl\_N\_agg }\OperatorTok{{-}}\StringTok{ }\KeywordTok{sum}\NormalTok{(ar\_overall)}

  \KeywordTok{return}\NormalTok{(fl\_overall)}
\NormalTok{\}}

\CommentTok{\# Parameters}
\NormalTok{fl\_rho =}\StringTok{ }\DecValTok{{-}1}

\CommentTok{\# Evaluate Function}
\KeywordTok{print}\NormalTok{(}\KeywordTok{ffi\_nonlin\_dplyrdo}\NormalTok{(mt\_nN\_by\_nQ\_A\_alpha[}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{],}
\NormalTok{                         mt\_nN\_by\_nQ\_A\_alpha[}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{],}
\NormalTok{                         mt\_nN\_by\_nQ\_A\_alpha[}\DecValTok{1}\NormalTok{,}\DecValTok{3}\NormalTok{]}\OperatorTok{*}\NormalTok{fl\_N\_agg,}
\NormalTok{                         ar\_nN\_A, ar\_nN\_alpha, fl\_N\_agg, fl\_rho))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 81.86645
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,}\KeywordTok{dim}\NormalTok{(mt\_nN\_by\_nQ\_A\_alpha)[}\DecValTok{1}\NormalTok{]))\{}
\NormalTok{  fl\_eval =}\StringTok{ }\KeywordTok{ffi\_nonlin\_dplyrdo}\NormalTok{(mt\_nN\_by\_nQ\_A\_alpha[i,}\DecValTok{1}\NormalTok{],}
\NormalTok{                               mt\_nN\_by\_nQ\_A\_alpha[i,}\DecValTok{2}\NormalTok{],}
\NormalTok{                               mt\_nN\_by\_nQ\_A\_alpha[i,}\DecValTok{3}\NormalTok{]}\OperatorTok{*}\NormalTok{fl\_N\_agg,}
\NormalTok{                               ar\_nN\_A, ar\_nN\_alpha, fl\_N\_agg, fl\_rho)}
  \KeywordTok{print}\NormalTok{(fl\_eval)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 81.86645
## [1] 54.48885
## [1] -65.5619
## [1] -598.2559
## [1] -3154.072
\end{verbatim}

\hypertarget{evaluate-nonlinear-function-using-dplyr-mutate}{%
\subsubsection{Evaluate Nonlinear Function using dplyr mutate}\label{evaluate-nonlinear-function-using-dplyr-mutate}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Convert Matrix to Tibble}
\NormalTok{ar\_st\_col\_names =}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}fl\_A\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}fl\_alpha\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}fl\_N\textquotesingle{}}\NormalTok{)}
\NormalTok{tb\_nN\_by\_nQ\_A\_alpha \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(mt\_nN\_by\_nQ\_A\_alpha) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{rename\_all}\NormalTok{(}\OperatorTok{\textasciitilde{}}\KeywordTok{c}\NormalTok{(ar\_st\_col\_names))}

\CommentTok{\# Define Implicit Function}
\NormalTok{ffi\_nonlin\_dplyrdo \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(fl\_A, fl\_alpha, fl\_N, ar\_A, ar\_alpha, fl\_N\_agg, fl\_rho)\{}

  \CommentTok{\# Test Parameters}
  \CommentTok{\# ar\_A = ar\_nN\_A}
  \CommentTok{\# ar\_alpha = ar\_nN\_alpha}
  \CommentTok{\# fl\_N = 100}
  \CommentTok{\# fl\_rho = {-}1}
  \CommentTok{\# fl\_N\_q = 10}

  \CommentTok{\# Apply Function}
\NormalTok{  ar\_p1\_s1 =}\StringTok{ }\KeywordTok{exp}\NormalTok{((fl\_A }\OperatorTok{{-}}\StringTok{ }\NormalTok{ar\_A)}\OperatorTok{*}\NormalTok{fl\_rho)}
\NormalTok{  ar\_p1\_s2 =}\StringTok{ }\NormalTok{(fl\_alpha}\OperatorTok{/}\NormalTok{ar\_alpha)}
\NormalTok{  ar\_p1\_s3 =}\StringTok{ }\NormalTok{(}\DecValTok{1}\OperatorTok{/}\NormalTok{(ar\_alpha}\OperatorTok{*}\NormalTok{fl\_rho }\OperatorTok{{-}}\StringTok{ }\DecValTok{1}\NormalTok{))}
\NormalTok{  ar\_p1 =}\StringTok{ }\NormalTok{(ar\_p1\_s1}\OperatorTok{*}\NormalTok{ar\_p1\_s2)}\OperatorTok{\^{}}\NormalTok{ar\_p1\_s3}
\NormalTok{  ar\_p2 =}\StringTok{ }\NormalTok{(fl\_N}\OperatorTok{*}\NormalTok{fl\_N\_agg)}\OperatorTok{\^{}}\NormalTok{((fl\_alpha}\OperatorTok{*}\NormalTok{fl\_rho}\DecValTok{{-}1}\NormalTok{)}\OperatorTok{/}\NormalTok{(ar\_alpha}\OperatorTok{*}\NormalTok{fl\_rho}\DecValTok{{-}1}\NormalTok{))}
\NormalTok{  ar\_overall =}\StringTok{ }\NormalTok{ar\_p1}\OperatorTok{*}\NormalTok{ar\_p2}
\NormalTok{  fl\_overall =}\StringTok{ }\NormalTok{fl\_N\_agg }\OperatorTok{{-}}\StringTok{ }\KeywordTok{sum}\NormalTok{(ar\_overall)}

  \KeywordTok{return}\NormalTok{(fl\_overall)}
\NormalTok{\}}

\CommentTok{\# fl\_A, fl\_alpha are from columns of tb\_nN\_by\_nQ\_A\_alpha}
\NormalTok{tb\_nN\_by\_nQ\_A\_alpha =}\StringTok{ }\NormalTok{tb\_nN\_by\_nQ\_A\_alpha }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{rowwise}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{                        }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{dplyr\_eval =} \KeywordTok{ffi\_nonlin\_dplyrdo}\NormalTok{(fl\_A, fl\_alpha, fl\_N,}
\NormalTok{                                                               ar\_nN\_A, ar\_nN\_alpha,}
\NormalTok{                                                               fl\_N\_agg, fl\_rho))}
\CommentTok{\# Show}
\KeywordTok{kable}\NormalTok{(tb\_nN\_by\_nQ\_A\_alpha) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r|r}
\hline
fl\_A & fl\_alpha & fl\_N & dplyr\_eval\\
\hline
\rowcolor{gray!6}  -2 & 0.1 & 0.0666667 & 81.86645\\
\hline
-1 & 0.3 & 0.1333333 & 54.48885\\
\hline
\rowcolor{gray!6}  0 & 0.5 & 0.2000000 & -65.56190\\
\hline
1 & 0.7 & 0.2666667 & -598.25595\\
\hline
\rowcolor{gray!6}  2 & 0.9 & 0.3333333 & -3154.07226\\
\hline
\end{tabular}
\end{table}

\hypertarget{evaluate-choices-across-states}{%
\subsection{Evaluate Choices Across States}\label{evaluate-choices-across-states}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

See the \href{https://fanwangecon.github.io/REconTools/reference/ff_opti_bisect_pmap_multi.html}{ff\_opti\_bisect\_pmap\_multi} function from \href{https://fanwangecon.github.io/}{Fan}'s \emph{\href{https://fanwangecon.github.io/REconTools/}{REconTools}} Package, which provides a resuable function based on the algorithm worked out here.

We want evaluate linear function \(0=f(z_{ij}, x_i, y_i, \textbf{X}, \textbf{Y}, c, d)\). There are \(i\) functions that have \(i\) specific \(x\) and \(y\). For each \(i\) function, we evaluate along a grid of feasible values for \(z\), over \(j\in J\) grid points, potentially looking for the \(j\) that is closest to the root. \(\textbf{X}\) and \(\textbf{Y}\) are arrays common across the \(i\) equations, and \(c\) and \(d\) are constants.

The evaluation strategy is the following, given min and max for \(z\) that are specific for each \(j\), and given common number of grid points, generate a matrix of \(z_{ij}\). Suppose there the number of \(i\) is \(I\), and the number of grid points for \(j\) is \(J\).

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Generate a \(J \cdot I\) by \(3\) matrix where the columns are \(z,x,y\) as tibble
\item
  Follow \href{https://fanwangecon.github.io/R4Econ/function/mutatef/fs_funceval.html}{this} Mutate to evaluate the \(f(\cdot)\) function.
\item
  Add two categorical columns for grid levels and wich \(i\), \(i\) and \(j\) index. Plot Mutate output evaluated column categorized by \(i\) as color and \(j\) as x-axis.
\end{enumerate}

\hypertarget{set-up-input-arrays-1}{%
\subsubsection{Set up Input Arrays}\label{set-up-input-arrays-1}}

There is a function that takes \(M=Q+P\) inputs, we want to evaluate this function \(N\) times. Each time, there are \(M\) inputs, where all but \(Q\) of the \(M\) inputs, meaning \(P\) of the \(M\) inputs, are the same. In particular, \(P=Q*N\).

\[M = Q+P = Q + Q*N\]

Now we need to expand this by the number of choice grid. Each row, representing one equation, is expanded by the number of choice grids. We are graphically searching, or rather brute force searching, which means if we have 100 individuals, we want to plot out the nonlinear equation for each of these lines, and show graphically where each line crosses zero. We achieve this, by evaluating the equation for each of the 100 individuals along a grid of feasible choices.

In this problem here, the feasible choices are shared across individuals.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Parameters}
\NormalTok{fl\_rho =}\StringTok{ }\FloatTok{0.20}
\NormalTok{svr\_id\_var =}\StringTok{ \textquotesingle{}INDI\_ID\textquotesingle{}}

\CommentTok{\# it\_child\_count = N, the number of children}
\NormalTok{it\_N\_child\_cnt =}\StringTok{ }\DecValTok{4}
\CommentTok{\# it\_heter\_param = Q, number of parameters that are heterogeneous across children}
\NormalTok{it\_Q\_hetpa\_cnt =}\StringTok{ }\DecValTok{2}

\CommentTok{\# P fixed parameters, nN is N dimensional, nP is P dimensional}
\NormalTok{ar\_nN\_A =}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\OperatorTok{{-}}\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DataTypeTok{length.out =}\NormalTok{ it\_N\_child\_cnt)}
\NormalTok{ar\_nN\_alpha =}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\FloatTok{0.1}\NormalTok{, }\FloatTok{0.9}\NormalTok{, }\DataTypeTok{length.out =}\NormalTok{ it\_N\_child\_cnt)}
\NormalTok{ar\_nP\_A\_alpha =}\StringTok{ }\KeywordTok{c}\NormalTok{(ar\_nN\_A, ar\_nN\_alpha)}

\CommentTok{\# N by Q varying parameters}
\NormalTok{mt\_nN\_by\_nQ\_A\_alpha =}\StringTok{ }\KeywordTok{cbind}\NormalTok{(ar\_nN\_A, ar\_nN\_alpha)}

\CommentTok{\# Choice Grid for nutritional feasible choices for each}
\NormalTok{fl\_N\_agg =}\StringTok{ }\DecValTok{100}
\NormalTok{fl\_N\_min =}\StringTok{ }\DecValTok{0}
\NormalTok{it\_N\_choice\_cnt\_ttest =}\StringTok{ }\DecValTok{3}
\NormalTok{it\_N\_choice\_cnt\_dense =}\StringTok{ }\DecValTok{100}
\NormalTok{ar\_N\_choices\_ttest =}\StringTok{ }\KeywordTok{seq}\NormalTok{(fl\_N\_min, fl\_N\_agg, }\DataTypeTok{length.out =}\NormalTok{ it\_N\_choice\_cnt\_ttest)}
\NormalTok{ar\_N\_choices\_dense =}\StringTok{ }\KeywordTok{seq}\NormalTok{(fl\_N\_min, fl\_N\_agg, }\DataTypeTok{length.out =}\NormalTok{ it\_N\_choice\_cnt\_dense)}

\CommentTok{\# Mesh Expand}
\NormalTok{tb\_states\_choices \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(mt\_nN\_by\_nQ\_A\_alpha) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{rowid\_to\_column}\NormalTok{(}\DataTypeTok{var=}\NormalTok{svr\_id\_var)}
\NormalTok{tb\_states\_choices\_ttest \textless{}{-}}\StringTok{ }\NormalTok{tb\_states\_choices }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{expand\_grid}\NormalTok{(}\DataTypeTok{choices =}\NormalTok{ ar\_N\_choices\_ttest)}
\NormalTok{tb\_states\_choices\_dense \textless{}{-}}\StringTok{ }\NormalTok{tb\_states\_choices }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{expand\_grid}\NormalTok{(}\DataTypeTok{choices =}\NormalTok{ ar\_N\_choices\_dense)}

\CommentTok{\# display}
\KeywordTok{summary}\NormalTok{(tb\_states\_choices\_dense)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##     INDI_ID        ar_nN_A    ar_nN_alpha     choices   
##  Min.   :1.00   Min.   :-2   Min.   :0.1   Min.   :  0  
##  1st Qu.:1.75   1st Qu.:-1   1st Qu.:0.3   1st Qu.: 25  
##  Median :2.50   Median : 0   Median :0.5   Median : 50  
##  Mean   :2.50   Mean   : 0   Mean   :0.5   Mean   : 50  
##  3rd Qu.:3.25   3rd Qu.: 1   3rd Qu.:0.7   3rd Qu.: 75  
##  Max.   :4.00   Max.   : 2   Max.   :0.9   Max.   :100
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{kable}\NormalTok{(tb\_states\_choices\_ttest) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r|r}
\hline
INDI\_ID & ar\_nN\_A & ar\_nN\_alpha & choices\\
\hline
\rowcolor{gray!6}  1 & -2.0000000 & 0.1000000 & 0\\
\hline
1 & -2.0000000 & 0.1000000 & 50\\
\hline
\rowcolor{gray!6}  1 & -2.0000000 & 0.1000000 & 100\\
\hline
2 & -0.6666667 & 0.3666667 & 0\\
\hline
\rowcolor{gray!6}  2 & -0.6666667 & 0.3666667 & 50\\
\hline
2 & -0.6666667 & 0.3666667 & 100\\
\hline
\rowcolor{gray!6}  3 & 0.6666667 & 0.6333333 & 0\\
\hline
3 & 0.6666667 & 0.6333333 & 50\\
\hline
\rowcolor{gray!6}  3 & 0.6666667 & 0.6333333 & 100\\
\hline
4 & 2.0000000 & 0.9000000 & 0\\
\hline
\rowcolor{gray!6}  4 & 2.0000000 & 0.9000000 & 50\\
\hline
4 & 2.0000000 & 0.9000000 & 100\\
\hline
\end{tabular}
\end{table}

\hypertarget{apply-same-function-all-rows-some-inputs-row-specific-other-shared}{%
\subsubsection{Apply Same Function all Rows, Some Inputs Row-specific, other Shared}\label{apply-same-function-all-rows-some-inputs-row-specific-other-shared}}

There are two types of inputs, row-specific inputs, and inputs that should be applied for each row. The Function just requires all of these inputs, it does not know what is row-specific and what is common for all row. Dplyr recognizes which parameter inputs already existing in the piped dataframe/tibble, given rowwise, those will be row-specific inputs. Additional function parameters that do not exist in dataframe as variable names, but that are pre-defined scalars or arrays will be applied to all rows.

\begin{itemize}
\tightlist
\item
  \citet{param} string variable name of input where functions are evaluated, these are already contained in the dataframe, existing variable names, row specific, rowwise computation over these, each rowwise calculation using different rows: \emph{fl\_A}, \emph{fl\_alpha}, \emph{fl\_N}
\item
  \citet{param} scalar and array values that are applied to every rowwise calculation, all rowwise calculations using the same scalars and arrays:\emph{ar\_A}, \emph{ar\_alpha}, \emph{fl\_N\_agg}, \emph{fl\_rho}
\item
  \citet{param} string output variable name
\end{itemize}

The function looks within group, finds min/max etc that are relevant.

\hypertarget{points-and-denser-dataframs-and-define-function}{%
\paragraph{3 Points and Denser Dataframs and Define Function}\label{points-and-denser-dataframs-and-define-function}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Convert Matrix to Tibble}
\NormalTok{ar\_st\_col\_names =}\StringTok{ }\KeywordTok{c}\NormalTok{(svr\_id\_var,}\StringTok{\textquotesingle{}fl\_A\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}fl\_alpha\textquotesingle{}}\NormalTok{)}
\NormalTok{tb\_states\_choices \textless{}{-}}\StringTok{ }\NormalTok{tb\_states\_choices }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{rename\_all}\NormalTok{(}\OperatorTok{\textasciitilde{}}\KeywordTok{c}\NormalTok{(ar\_st\_col\_names))}
\NormalTok{ar\_st\_col\_names =}\StringTok{ }\KeywordTok{c}\NormalTok{(svr\_id\_var,}\StringTok{\textquotesingle{}fl\_A\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}fl\_alpha\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}fl\_N\textquotesingle{}}\NormalTok{)}
\NormalTok{tb\_states\_choices\_ttest \textless{}{-}}\StringTok{ }\NormalTok{tb\_states\_choices\_ttest }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{rename\_all}\NormalTok{(}\OperatorTok{\textasciitilde{}}\KeywordTok{c}\NormalTok{(ar\_st\_col\_names))}
\NormalTok{tb\_states\_choices\_dense \textless{}{-}}\StringTok{ }\NormalTok{tb\_states\_choices\_dense }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{rename\_all}\NormalTok{(}\OperatorTok{\textasciitilde{}}\KeywordTok{c}\NormalTok{(ar\_st\_col\_names))}

\CommentTok{\# Define Implicit Function}
\NormalTok{ffi\_nonlin\_dplyrdo \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(fl\_A, fl\_alpha, fl\_N, ar\_A, ar\_alpha, fl\_N\_agg, fl\_rho)\{}
  \CommentTok{\# scalar value that are row{-}specific, in dataframe already: *fl\_A*, *fl\_alpha*, *fl\_N*}
  \CommentTok{\# array and scalars not in dataframe, common all rows: *ar\_A*, *ar\_alpha*, *fl\_N\_agg*, *fl\_rho*}

  \CommentTok{\# Test Parameters}
  \CommentTok{\# ar\_A = ar\_nN\_A}
  \CommentTok{\# ar\_alpha = ar\_nN\_alpha}
  \CommentTok{\# fl\_N = 100}
  \CommentTok{\# fl\_rho = {-}1}
  \CommentTok{\# fl\_N\_q = 10}

  \CommentTok{\# Apply Function}
\NormalTok{  ar\_p1\_s1 =}\StringTok{ }\KeywordTok{exp}\NormalTok{((fl\_A }\OperatorTok{{-}}\StringTok{ }\NormalTok{ar\_A)}\OperatorTok{*}\NormalTok{fl\_rho)}
\NormalTok{  ar\_p1\_s2 =}\StringTok{ }\NormalTok{(fl\_alpha}\OperatorTok{/}\NormalTok{ar\_alpha)}
\NormalTok{  ar\_p1\_s3 =}\StringTok{ }\NormalTok{(}\DecValTok{1}\OperatorTok{/}\NormalTok{(ar\_alpha}\OperatorTok{*}\NormalTok{fl\_rho }\OperatorTok{{-}}\StringTok{ }\DecValTok{1}\NormalTok{))}
\NormalTok{  ar\_p1 =}\StringTok{ }\NormalTok{(ar\_p1\_s1}\OperatorTok{*}\NormalTok{ar\_p1\_s2)}\OperatorTok{\^{}}\NormalTok{ar\_p1\_s3}
\NormalTok{  ar\_p2 =}\StringTok{ }\NormalTok{fl\_N}\OperatorTok{\^{}}\NormalTok{((fl\_alpha}\OperatorTok{*}\NormalTok{fl\_rho}\DecValTok{{-}1}\NormalTok{)}\OperatorTok{/}\NormalTok{(ar\_alpha}\OperatorTok{*}\NormalTok{fl\_rho}\DecValTok{{-}1}\NormalTok{))}
\NormalTok{  ar\_overall =}\StringTok{ }\NormalTok{ar\_p1}\OperatorTok{*}\NormalTok{ar\_p2}
\NormalTok{  fl\_overall =}\StringTok{ }\NormalTok{fl\_N\_agg }\OperatorTok{{-}}\StringTok{ }\KeywordTok{sum}\NormalTok{(ar\_overall)}

  \KeywordTok{return}\NormalTok{(fl\_overall)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{evaluate-at-three-choice-points-and-show-table}{%
\paragraph{Evaluate at Three Choice Points and Show Table}\label{evaluate-at-three-choice-points-and-show-table}}

In the example below, just show results evaluating over three choice points and show table.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# fl\_A, fl\_alpha are from columns of tb\_nN\_by\_nQ\_A\_alpha}
\NormalTok{tb\_states\_choices\_ttest\_eval =}\StringTok{ }\NormalTok{tb\_states\_choices\_ttest }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{rowwise}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{                        }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{dplyr\_eval =} \KeywordTok{ffi\_nonlin\_dplyrdo}\NormalTok{(fl\_A, fl\_alpha, fl\_N,}
\NormalTok{                                                               ar\_nN\_A, ar\_nN\_alpha,}
\NormalTok{                                                               fl\_N\_agg, fl\_rho))}
\CommentTok{\# Show}
\KeywordTok{kable}\NormalTok{(tb\_states\_choices\_ttest\_eval) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r|r|r}
\hline
INDI\_ID & fl\_A & fl\_alpha & fl\_N & dplyr\_eval\\
\hline
\rowcolor{gray!6}  1 & -2.0000000 & 0.1000000 & 0 & 100.00000\\
\hline
1 & -2.0000000 & 0.1000000 & 50 & -5666.95576\\
\hline
\rowcolor{gray!6}  1 & -2.0000000 & 0.1000000 & 100 & -12880.28392\\
\hline
2 & -0.6666667 & 0.3666667 & 0 & 100.00000\\
\hline
\rowcolor{gray!6}  2 & -0.6666667 & 0.3666667 & 50 & -595.73454\\
\hline
2 & -0.6666667 & 0.3666667 & 100 & -1394.70698\\
\hline
\rowcolor{gray!6}  3 & 0.6666667 & 0.6333333 & 0 & 100.00000\\
\hline
3 & 0.6666667 & 0.6333333 & 50 & -106.51058\\
\hline
\rowcolor{gray!6}  3 & 0.6666667 & 0.6333333 & 100 & -323.94216\\
\hline
4 & 2.0000000 & 0.9000000 & 0 & 100.00000\\
\hline
\rowcolor{gray!6}  4 & 2.0000000 & 0.9000000 & 50 & 22.55577\\
\hline
4 & 2.0000000 & 0.9000000 & 100 & -51.97161\\
\hline
\end{tabular}
\end{table}

\hypertarget{evaluate-at-many-choice-points-and-show-graphically}{%
\paragraph{Evaluate at Many Choice Points and Show Graphically}\label{evaluate-at-many-choice-points-and-show-graphically}}

Same as above, but now we evaluate the function over the individuals at many choice points so that we can graph things out.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# fl\_A, fl\_alpha are from columns of tb\_nN\_by\_nQ\_A\_alpha}
\NormalTok{tb\_states\_choices\_dense\_eval =}\StringTok{ }\NormalTok{tb\_states\_choices\_dense }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{rowwise}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{                        }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{dplyr\_eval =} \KeywordTok{ffi\_nonlin\_dplyrdo}\NormalTok{(fl\_A, fl\_alpha, fl\_N,}
\NormalTok{                                                               ar\_nN\_A, ar\_nN\_alpha,}
\NormalTok{                                                               fl\_N\_agg, fl\_rho))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Labeling}
\NormalTok{st\_title \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}Evaluate Non{-}Linear Functions to Search for Roots\textquotesingle{}}\NormalTok{)}
\NormalTok{st\_subtitle \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}https://fanwangecon.github.io/\textquotesingle{}}\NormalTok{,}
                      \StringTok{\textquotesingle{}R4Econ/function/mutatef/htmlpdfr/fs\_func\_choice\_states.html\textquotesingle{}}\NormalTok{)}
\NormalTok{st\_caption \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}Evaluating the function, \textquotesingle{}}\NormalTok{,}
                     \StringTok{\textquotesingle{}https://fanwangecon.github.io/R4Econ/\textquotesingle{}}\NormalTok{)}
\NormalTok{st\_x\_label \textless{}{-}}\StringTok{ \textquotesingle{}x values\textquotesingle{}}
\NormalTok{st\_y\_label \textless{}{-}}\StringTok{ \textquotesingle{}f(x)\textquotesingle{}}

\CommentTok{\# Show}
\KeywordTok{dim}\NormalTok{(tb\_states\_choices\_dense\_eval)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 400   5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(tb\_states\_choices\_dense\_eval)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##     INDI_ID          fl_A       fl_alpha        fl_N       dplyr_eval       
##  Min.   :1.00   Min.   :-2   Min.   :0.1   Min.   :  0   Min.   :-12880.28  
##  1st Qu.:1.75   1st Qu.:-1   1st Qu.:0.3   1st Qu.: 25   1st Qu.: -1167.29  
##  Median :2.50   Median : 0   Median :0.5   Median : 50   Median :  -202.42  
##  Mean   :2.50   Mean   : 0   Mean   :0.5   Mean   : 50   Mean   : -1645.65  
##  3rd Qu.:3.25   3rd Qu.: 1   3rd Qu.:0.7   3rd Qu.: 75   3rd Qu.:     0.96  
##  Max.   :4.00   Max.   : 2   Max.   :0.9   Max.   :100   Max.   :   100.00
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lineplot \textless{}{-}}\StringTok{ }\NormalTok{tb\_states\_choices\_dense\_eval }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{fl\_N, }\DataTypeTok{y=}\NormalTok{dplyr\_eval)) }\OperatorTok{+}
\StringTok{        }\KeywordTok{geom\_line}\NormalTok{() }\OperatorTok{+}
\StringTok{        }\KeywordTok{facet\_wrap}\NormalTok{( . }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{INDI\_ID, }\DataTypeTok{scales =} \StringTok{"free"}\NormalTok{) }\OperatorTok{+}
\StringTok{        }\KeywordTok{geom\_hline}\NormalTok{(}\DataTypeTok{yintercept=}\DecValTok{0}\NormalTok{, }\DataTypeTok{linetype=}\StringTok{"dashed"}\NormalTok{,}
                \DataTypeTok{color =} \StringTok{"red"}\NormalTok{, }\DataTypeTok{size=}\DecValTok{1}\NormalTok{) }\OperatorTok{+}
\StringTok{        }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{title =}\NormalTok{ st\_title,}
             \DataTypeTok{subtitle =}\NormalTok{ st\_subtitle,}
             \DataTypeTok{x =}\NormalTok{ st\_x\_label,}
             \DataTypeTok{y =}\NormalTok{ st\_y\_label,}
             \DataTypeTok{caption =}\NormalTok{ st\_caption)}
\KeywordTok{print}\NormalTok{(lineplot)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{Panel-Data-and-Optimization-with-R_files/figure-latex/graph many evaluations-1} \end{center}

\hypertarget{dataframe-do-anything}{%
\section{Dataframe Do Anything}\label{dataframe-do-anything}}

\hypertarget{mxq-to-mxp-rows}{%
\subsection{MxQ to MxP Rows}\label{mxq-to-mxp-rows}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

\hypertarget{mxq-to-mx1-rows-within-group-gini}{%
\subsubsection{MxQ to Mx1 Rows: Within Group Gini}\label{mxq-to-mx1-rows-within-group-gini}}

There is a Panel with \(M\) individuals and each individual has \(Q\) records/rows. A function generate an individual specific outcome given the \(Q\) individual specific inputs, along with shared parameters and arrays across the \(M\) individuals.

For example, suppose we have a dataframe of individual wage information from different countries, each row is an individual from one country. We want to generate country specific gini based on the individual data for each country in the dataframe. But additionally, perhaps the gini formula requires not just individual income but some additional parameters or shared dataframes as inputs.

Given the within \(m\) income observations, we can compute gini statistics that are individual specific based on the observed distribution of incomes. For this, we will use the \href{https://fanwangecon.github.io/REconTools/reference/ff_dist_gini_vector_pos.html}{ff\_dist\_gini\_vector\_pos.html} function from \href{https://fanwangecon.github.io/REconTools/}{REconTools}.

To make this more interesting, we will generate large dataframe with more \(M\) and more \(Q\) each \(m\).

\hypertarget{large-dataframe}{%
\paragraph{Large Dataframe}\label{large-dataframe}}

There are up to ten thousand income observation per person. And there are ten people.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Parameter Setups}
\NormalTok{it\_M \textless{}{-}}\StringTok{ }\DecValTok{10}
\NormalTok{it\_Q\_max \textless{}{-}}\StringTok{ }\DecValTok{10000}
\NormalTok{fl\_rnorm\_mu \textless{}{-}}\StringTok{ }\DecValTok{1}
\NormalTok{ar\_rnorm\_sd \textless{}{-}}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\FloatTok{0.01}\NormalTok{, }\FloatTok{0.2}\NormalTok{, }\DataTypeTok{length.out=}\NormalTok{it\_M)}
\NormalTok{ar\_it\_q \textless{}{-}}\StringTok{ }\KeywordTok{sample.int}\NormalTok{(it\_Q\_max, it\_M, }\DataTypeTok{replace=}\OtherTok{TRUE}\NormalTok{)}

\CommentTok{\# N by Q varying parameters}
\NormalTok{mt\_data =}\StringTok{ }\KeywordTok{cbind}\NormalTok{(ar\_it\_q, ar\_rnorm\_sd)}
\NormalTok{tb\_M \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(mt\_data) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{rowid\_to\_column}\NormalTok{(}\DataTypeTok{var =} \StringTok{"ID"}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{                }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{sd =}\NormalTok{ ar\_rnorm\_sd, }\DataTypeTok{Q =}\NormalTok{ ar\_it\_q) }\OperatorTok{\%\textgreater{}\%}
\StringTok{                }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{mean =}\NormalTok{ fl\_rnorm\_mu)}
\end{Highlighting}
\end{Shaded}

\hypertarget{compute-group-specific-gini-normal}{%
\paragraph{Compute Group specific gini, NORMAL}\label{compute-group-specific-gini-normal}}

There is only one input for the gini function \emph{ar\_pos}. Note that the gini are not very large even with large SD, because these are normal distributions. By Construction, most peple are in the middle. So with almost zero standard deviation, we have perfect equality, as standard deviation increases, inequality increases, but still pretty equal overall, there is no fat upper tail.

Note that there are three ways of referring to variable names with dot, which are all shown below:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  We can explicitly refer to names
\item
  We can use the \href{https://stackoverflow.com/a/18228613/8280804}{dollar dot structure} to use string variable names in do anything.
\item
  We can use dot bracket, this is the only option that works with string variable names
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# A. Normal Draw Expansion, Explicitly Name}
\KeywordTok{set.seed}\NormalTok{(}\StringTok{\textquotesingle{}123\textquotesingle{}}\NormalTok{)}
\NormalTok{tb\_income\_norm\_dot\_dollar \textless{}{-}}\StringTok{ }\NormalTok{tb\_M }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{group\_by}\NormalTok{(ID) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{do}\NormalTok{(}\DataTypeTok{income =} \KeywordTok{rnorm}\NormalTok{(.}\OperatorTok{$}\NormalTok{Q,}
                    \DataTypeTok{mean=}\NormalTok{.}\OperatorTok{$}\NormalTok{mean,}
                    \DataTypeTok{sd=}\NormalTok{.}\OperatorTok{$}\NormalTok{sd)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{unnest}\NormalTok{(}\KeywordTok{c}\NormalTok{(income)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(tb\_M, }\DataTypeTok{by=}\StringTok{"ID"}\NormalTok{)}

\CommentTok{\# Normal Draw Expansion again, dot dollar differently with string variable name}
\KeywordTok{set.seed}\NormalTok{(}\StringTok{\textquotesingle{}123\textquotesingle{}}\NormalTok{)}
\NormalTok{tb\_income\_norm\_dollar\_dot \textless{}{-}}\StringTok{ }\NormalTok{tb\_M }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{group\_by}\NormalTok{(ID) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{do}\NormalTok{(}\DataTypeTok{income =} \KeywordTok{rnorm}\NormalTok{(}\StringTok{\textasciigrave{}}\DataTypeTok{$}\StringTok{\textasciigrave{}}\NormalTok{(., }\StringTok{\textquotesingle{}Q\textquotesingle{}}\NormalTok{),}
                    \DataTypeTok{mean =} \StringTok{\textasciigrave{}}\DataTypeTok{$}\StringTok{\textasciigrave{}}\NormalTok{(., }\StringTok{\textquotesingle{}mean\textquotesingle{}}\NormalTok{),}
                    \DataTypeTok{sd =} \StringTok{\textasciigrave{}}\DataTypeTok{$}\StringTok{\textasciigrave{}}\NormalTok{(., }\StringTok{\textquotesingle{}sd\textquotesingle{}}\NormalTok{))) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{unnest}\NormalTok{(}\KeywordTok{c}\NormalTok{(income)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(tb\_M, }\DataTypeTok{by=}\StringTok{"ID"}\NormalTok{)}

\CommentTok{\# Normal Draw Expansion again, dot double bracket}
\KeywordTok{set.seed}\NormalTok{(}\StringTok{\textquotesingle{}123\textquotesingle{}}\NormalTok{)}
\NormalTok{svr\_mean \textless{}{-}}\StringTok{ \textquotesingle{}mean\textquotesingle{}}
\NormalTok{svr\_sd \textless{}{-}}\StringTok{ \textquotesingle{}sd\textquotesingle{}}
\NormalTok{svr\_Q \textless{}{-}}\StringTok{ \textquotesingle{}Q\textquotesingle{}}
\NormalTok{tb\_income\_norm\_dot\_bracket\_db \textless{}{-}}\StringTok{ }\NormalTok{tb\_M }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{group\_by}\NormalTok{(ID) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{do}\NormalTok{(}\DataTypeTok{income =} \KeywordTok{rnorm}\NormalTok{(.[[svr\_Q]],}
                    \DataTypeTok{mean =}\NormalTok{ .[[svr\_mean]],}
                    \DataTypeTok{sd =}\NormalTok{ .[[svr\_sd]])) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{unnest}\NormalTok{(}\KeywordTok{c}\NormalTok{(income)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(tb\_M, }\DataTypeTok{by=}\StringTok{"ID"}\NormalTok{)}

\CommentTok{\# display}
\KeywordTok{sum}\NormalTok{(}\KeywordTok{sum}\NormalTok{(tb\_income\_norm\_dollar\_dot }\OperatorTok{{-}}\StringTok{ }\NormalTok{tb\_income\_norm\_dot\_dollar }\OperatorTok{{-}}\StringTok{ }\NormalTok{tb\_income\_norm\_dot\_bracket\_db))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] -463785175
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# display}
\KeywordTok{head}\NormalTok{(tb\_income\_norm\_dot\_dollar, }\DecValTok{20}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Gini by Group}
\NormalTok{tb\_gini\_norm \textless{}{-}}\StringTok{ }\NormalTok{tb\_income\_norm\_dollar\_dot }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{group\_by}\NormalTok{(ID) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{do}\NormalTok{(}\DataTypeTok{inc\_gini\_norm =} \KeywordTok{ff\_dist\_gini\_vector\_pos}\NormalTok{(.}\OperatorTok{$}\NormalTok{income)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{unnest}\NormalTok{(}\KeywordTok{c}\NormalTok{(inc\_gini\_norm)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(tb\_M, }\DataTypeTok{by=}\StringTok{"ID"}\NormalTok{)}

\CommentTok{\# display}
\KeywordTok{kable}\NormalTok{(tb\_gini\_norm) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r|r|r}
\hline
ID & inc\_gini\_norm & Q & sd & mean\\
\hline
\rowcolor{gray!6}  1 & 0.0056337 & 9982 & 0.0100000 & 1\\
\hline
2 & 0.0175280 & 2980 & 0.0311111 & 1\\
\hline
\rowcolor{gray!6}  3 & 0.0293986 & 1614 & 0.0522222 & 1\\
\hline
4 & 0.0422304 & 555 & 0.0733333 & 1\\
\hline
\rowcolor{gray!6}  5 & 0.0535146 & 4469 & 0.0944444 & 1\\
\hline
6 & 0.0653938 & 9359 & 0.1155556 & 1\\
\hline
\rowcolor{gray!6}  7 & 0.0769135 & 7789 & 0.1366667 & 1\\
\hline
8 & 0.0894165 & 9991 & 0.1577778 & 1\\
\hline
\rowcolor{gray!6}  9 & 0.1010982 & 9097 & 0.1788889 & 1\\
\hline
10 & 0.1124019 & 1047 & 0.2000000 & 1\\
\hline
\end{tabular}
\end{table}

\hypertarget{mx1-to-mxq-rows}{%
\subsection{Mx1 to MxQ Rows}\label{mx1-to-mxq-rows}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

\textbf{Case One}: There is a dataframe with \(M\) rows, based on these \(m\) specific information, generate dataframes for each \(m\). Stack these indivdiual dataframes together and merge original \(m\) specific information in as well. The number of rows for each \(m\) is \(Q_m\), each \(m\) could have different number of expansion rows.

Generate a panel with \(M\) individuals, each individual is observed for different spans of times (\emph{uncount}). Before expanding, generate individual specific normal distribution standard deviation. All individuals share the same mean, but have increasing standard deviations.

\hypertarget{generate-dataframe-with-m-rows.}{%
\subsubsection{Generate Dataframe with M Rows.}\label{generate-dataframe-with-m-rows.}}

This is the first step, generate \(M\) rows of data, to be expanded. Each row contains the number of normal draws to make and the mean and the standard deviation for normal daraws that are \(m\) specific.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Parameter Setups}
\NormalTok{it\_M \textless{}{-}}\StringTok{ }\DecValTok{3}
\NormalTok{it\_Q\_max \textless{}{-}}\StringTok{ }\DecValTok{5}
\NormalTok{fl\_rnorm\_mu \textless{}{-}}\StringTok{ }\DecValTok{1000}
\NormalTok{ar\_rnorm\_sd \textless{}{-}}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\FloatTok{0.01}\NormalTok{, }\DecValTok{200}\NormalTok{, }\DataTypeTok{length.out=}\NormalTok{it\_M)}
\NormalTok{ar\_it\_q \textless{}{-}}\StringTok{ }\KeywordTok{sample.int}\NormalTok{(it\_Q\_max, it\_M, }\DataTypeTok{replace=}\OtherTok{TRUE}\NormalTok{)}

\CommentTok{\# N by Q varying parameters}
\NormalTok{mt\_data =}\StringTok{ }\KeywordTok{cbind}\NormalTok{(ar\_it\_q, ar\_rnorm\_sd)}
\NormalTok{tb\_M \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(mt\_data) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{rowid\_to\_column}\NormalTok{(}\DataTypeTok{var =} \StringTok{"ID"}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{                }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{sd =}\NormalTok{ ar\_rnorm\_sd, }\DataTypeTok{Q =}\NormalTok{ ar\_it\_q) }\OperatorTok{\%\textgreater{}\%}
\StringTok{                }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{mean =}\NormalTok{ fl\_rnorm\_mu)}

\CommentTok{\# display}
\KeywordTok{kable}\NormalTok{(tb\_M) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r|r}
\hline
ID & Q & sd & mean\\
\hline
\rowcolor{gray!6}  1 & 3 & 0.010 & 1000\\
\hline
2 & 3 & 100.005 & 1000\\
\hline
\rowcolor{gray!6}  3 & 1 & 200.000 & 1000\\
\hline
\end{tabular}
\end{table}

\hypertarget{random-normal-draw-expansion}{%
\subsubsection{Random Normal Draw Expansion}\label{random-normal-draw-expansion}}

The steps are:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \href{https://dplyr.tidyverse.org/reference/do.html}{do anything}
\item
  use ``.\$'' sign to refer to variable names, or {[}{[}`name'{]}{]}
\item
  unnest
\item
  left\_join expanded and original
\end{enumerate}

Note these all give the same results

Use dot dollar to get variables

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Generate $Q\_m$ individual specific incomes, expanded different number of times for each m}
\NormalTok{tb\_income \textless{}{-}}\StringTok{ }\NormalTok{tb\_M }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{group\_by}\NormalTok{(ID) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{do}\NormalTok{(}\DataTypeTok{income =} \KeywordTok{rnorm}\NormalTok{(.}\OperatorTok{$}\NormalTok{Q, }\DataTypeTok{mean=}\NormalTok{.}\OperatorTok{$}\NormalTok{mean, }\DataTypeTok{sd=}\NormalTok{.}\OperatorTok{$}\NormalTok{sd)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{unnest}\NormalTok{(}\KeywordTok{c}\NormalTok{(income))}

\CommentTok{\# Merge back with tb\_M}
\NormalTok{tb\_income\_full\_dd \textless{}{-}}\StringTok{ }\NormalTok{tb\_income }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(tb\_M)}

\CommentTok{\# display}
\KeywordTok{kable}\NormalTok{(tb\_income) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r}
\hline
ID & income\\
\hline
\rowcolor{gray!6}  1 & 1000.0183\\
\hline
1 & 999.9943\\
\hline
\rowcolor{gray!6}  1 & 999.9822\\
\hline
2 & 1033.7465\\
\hline
\rowcolor{gray!6}  2 & 1093.1374\\
\hline
2 & 862.1896\\
\hline
\rowcolor{gray!6}  3 & 988.7742\\
\hline
\end{tabular}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{kable}\NormalTok{(tb\_income\_full\_dd) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r|r|r}
\hline
ID & income & Q & sd & mean\\
\hline
\rowcolor{gray!6}  1 & 1000.0183 & 3 & 0.010 & 1000\\
\hline
1 & 999.9943 & 3 & 0.010 & 1000\\
\hline
\rowcolor{gray!6}  1 & 999.9822 & 3 & 0.010 & 1000\\
\hline
2 & 1033.7465 & 3 & 100.005 & 1000\\
\hline
\rowcolor{gray!6}  2 & 1093.1374 & 3 & 100.005 & 1000\\
\hline
2 & 862.1896 & 3 & 100.005 & 1000\\
\hline
\rowcolor{gray!6}  3 & 988.7742 & 1 & 200.000 & 1000\\
\hline
\end{tabular}
\end{table}

\hypertarget{apply-and-pmap}{%
\section{Apply and pmap}\label{apply-and-pmap}}

\hypertarget{apply-sapply-mutate}{%
\subsection{Apply, Sapply, Mutate}\label{apply-sapply-mutate}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

\begin{itemize}
\tightlist
\item
  r apply matrix to function row by row
\item
  r evaluate function on grid
\item
  \href{https://stackoverflow.com/questions/4236368/apply-a-function-to-every-row-of-a-matrix-or-a-data-frame}{Apply a function to every row of a matrix or a data frame}
\item
  r apply
\item
  r sapply
\item
  sapply over matrix row by row
\item
  apply dplyr vectorize
\item
  function as parameters using formulas
\item
  do
\end{itemize}

We want evaluate linear function f(x\_i, y\_i, ar\_x, ar\_y, c, d), where c and d are constants, and ar\_x and ar\_y are arrays, both fixed. x\_i and y\_i vary over each row of matrix. More specifically, we have a functions, this function takes inputs that are individual specific. We would like to evaluate this function concurrently across \(N\) individuals.

The function is such that across the \(N\) individuals, some of the function parameter inputs are the same, but others are different. If we are looking at demand for a particular product, the prices of all products enter the demand equation for each product, but the product's own price enters also in a different way.

The objective is either to just evaluate this function across \(N\) individuals, or this is a part of a nonlinear solution system.

What is the relationship between apply, lapply and vectorization? see \href{https://stackoverflow.com/a/29006276/8280804}{Is the ``*apply'' family really not vectorized?}.

\hypertarget{set-up-input-arrays-2}{%
\subsubsection{Set up Input Arrays}\label{set-up-input-arrays-2}}

There is a function that takes \(M=Q+P\) inputs, we want to evaluate this function \(N\) times. Each time, there are \(M\) inputs, where all but \(Q\) of the \(M\) inputs, meaning \(P\) of the \(M\) inputs, are the same. In particular, \(P=Q*N\).

\[M = Q+P = Q + Q*N\]

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# it\_child\_count = N, the number of children}
\NormalTok{it\_N\_child\_cnt =}\StringTok{ }\DecValTok{5}
\CommentTok{\# it\_heter\_param = Q, number of parameters that are}
\CommentTok{\# heterogeneous across children}
\NormalTok{it\_Q\_hetpa\_cnt =}\StringTok{ }\DecValTok{2}

\CommentTok{\# P fixed parameters, nN is N dimensional, nP is P dimensional}
\NormalTok{ar\_nN\_A =}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\OperatorTok{{-}}\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DataTypeTok{length.out =}\NormalTok{ it\_N\_child\_cnt)}
\NormalTok{ar\_nN\_alpha =}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\FloatTok{0.1}\NormalTok{, }\FloatTok{0.9}\NormalTok{, }\DataTypeTok{length.out =}\NormalTok{ it\_N\_child\_cnt)}
\NormalTok{ar\_nP\_A\_alpha =}\StringTok{ }\KeywordTok{c}\NormalTok{(ar\_nN\_A, ar\_nN\_alpha)}

\CommentTok{\# N by Q varying parameters}
\NormalTok{mt\_nN\_by\_nQ\_A\_alpha =}\StringTok{ }\KeywordTok{cbind}\NormalTok{(ar\_nN\_A, ar\_nN\_alpha)}

\CommentTok{\# display}
\KeywordTok{kable}\NormalTok{(mt\_nN\_by\_nQ\_A\_alpha) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r}
\hline
ar\_nN\_A & ar\_nN\_alpha\\
\hline
\rowcolor{gray!6}  -2 & 0.1\\
\hline
-1 & 0.3\\
\hline
\rowcolor{gray!6}  0 & 0.5\\
\hline
1 & 0.7\\
\hline
\rowcolor{gray!6}  2 & 0.9\\
\hline
\end{tabular}
\end{table}

\hypertarget{using-apply}{%
\subsubsection{Using apply}\label{using-apply}}

\hypertarget{apply-with-named-function}{%
\paragraph{Apply with Named Function}\label{apply-with-named-function}}

First we use the apply function, we have to hard-code the arrays that are fixed for each of the \(N\) individuals. Then apply allows us to loop over the matrix that is \(N\) by \(Q\), each row one at a time, from \(1\) to \(N\).

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Define Implicit Function}
\NormalTok{ffi\_linear\_hardcode \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(ar\_A\_alpha)\{}
  \CommentTok{\# ar\_A\_alpha[1] is A}
  \CommentTok{\# ar\_A\_alpha[2] is alpha}

\NormalTok{  fl\_out =}\StringTok{ }\KeywordTok{sum}\NormalTok{(ar\_A\_alpha[}\DecValTok{1}\NormalTok{]}\OperatorTok{*}\NormalTok{ar\_nN\_A }\OperatorTok{+}
\StringTok{                 }\DecValTok{1}\OperatorTok{/}\NormalTok{(ar\_A\_alpha[}\DecValTok{2}\NormalTok{] }\OperatorTok{+}\StringTok{ }\DecValTok{1}\OperatorTok{/}\NormalTok{ar\_nN\_alpha))}

  \KeywordTok{return}\NormalTok{(fl\_out)}
\NormalTok{\}}

\CommentTok{\# Evaluate function row by row}
\NormalTok{ar\_func\_apply =}\StringTok{ }\KeywordTok{apply}\NormalTok{(mt\_nN\_by\_nQ\_A\_alpha, }\DecValTok{1}\NormalTok{, ffi\_linear\_hardcode)}
\end{Highlighting}
\end{Shaded}

\hypertarget{apply-using-anonymous-function}{%
\paragraph{Apply using Anonymous Function}\label{apply-using-anonymous-function}}

\begin{itemize}
\tightlist
\item
  apply over matrix
\end{itemize}

Apply with anonymous function generating a list of arrays of different lengths. In the example below, we want to drawn \(N\) sets of random uniform numbers, but for each set the number of draws we want to have is \(Q_i\). Furthermore, we want to rescale the random uniform draws so that they all become proportions that sum u pto one for each \(i\), but then we multply each row's values by the row specific aggregates.

The anonymous function has hard coded parameters. Using an anonymous function here allows for parameters to be provided inside the function that are shared across each looped evaluation. This is perhaps more convenient than sapply with additional parameters.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{1039}\NormalTok{)}

\CommentTok{\# Define the number of draws each row and total amount}
\NormalTok{it\_N \textless{}{-}}\StringTok{ }\DecValTok{4}
\NormalTok{fl\_unif\_min \textless{}{-}}\StringTok{ }\DecValTok{1}
\NormalTok{fl\_unif\_max \textless{}{-}}\StringTok{ }\DecValTok{2}
\NormalTok{mt\_draw\_define \textless{}{-}}\StringTok{ }\KeywordTok{cbind}\NormalTok{(}\KeywordTok{sample}\NormalTok{(it\_N, it\_N, }\DataTypeTok{replace=}\OtherTok{TRUE}\NormalTok{),}
                        \KeywordTok{runif}\NormalTok{(it\_N, }\DataTypeTok{min=}\DecValTok{1}\NormalTok{, }\DataTypeTok{max=}\DecValTok{10}\NormalTok{))}
\NormalTok{tb\_draw\_define \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(mt\_draw\_define) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rowid\_to\_column}\NormalTok{(}\DataTypeTok{var =} \StringTok{"draw\_group"}\NormalTok{)}
\KeywordTok{print}\NormalTok{(tb\_draw\_define)}

\CommentTok{\# apply row by row, anonymous function has hard}
\CommentTok{\# coded min and max}
\NormalTok{ls\_ar\_draws\_shares\_lvls =}
\StringTok{  }\KeywordTok{apply}\NormalTok{(tb\_draw\_define,}
        \DecValTok{1}\NormalTok{,}
        \ControlFlowTok{function}\NormalTok{(row) \{}
\NormalTok{          it\_draw \textless{}{-}}\StringTok{ }\NormalTok{row[}\DecValTok{2}\NormalTok{]}
\NormalTok{          fl\_sum \textless{}{-}}\StringTok{ }\NormalTok{row[}\DecValTok{3}\NormalTok{]}
\NormalTok{          ar\_unif \textless{}{-}}\StringTok{ }\KeywordTok{runif}\NormalTok{(it\_draw,}
                           \DataTypeTok{min=}\NormalTok{fl\_unif\_min,}
                           \DataTypeTok{max=}\NormalTok{fl\_unif\_max)}
\NormalTok{          ar\_share \textless{}{-}}\StringTok{ }\NormalTok{ar\_unif}\OperatorTok{/}\KeywordTok{sum}\NormalTok{(ar\_unif)}
\NormalTok{          ar\_levels \textless{}{-}}\StringTok{ }\NormalTok{ar\_share}\OperatorTok{*}\NormalTok{fl\_sum}
          \KeywordTok{return}\NormalTok{(}\KeywordTok{list}\NormalTok{(}\DataTypeTok{ar\_share=}\NormalTok{ar\_share,}
                      \DataTypeTok{ar\_levels=}\NormalTok{ar\_levels))}
\NormalTok{        \})}

\CommentTok{\# Show Results}
\KeywordTok{print}\NormalTok{(ls\_ar\_draws\_shares\_lvls)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [[1]]
## [[1]]$ar_share
## [1] 0.2783638 0.2224140 0.2797840 0.2194381
## 
## [[1]]$ar_levels
## [1] 1.492414 1.192446 1.500028 1.176491
## 
## 
## [[2]]
## [[2]]$ar_share
## [1] 0.5052919 0.4947081
## 
## [[2]]$ar_levels
## [1] 3.866528 3.785541
## 
## 
## [[3]]
## [[3]]$ar_share
## [1] 1
## 
## [[3]]$ar_levels
##       V2 
## 9.572211 
## 
## 
## [[4]]
## [[4]]$ar_share
## [1] 0.4211426 0.2909812 0.2878762
## 
## [[4]]$ar_levels
## [1] 4.051971 2.799640 2.769765
\end{verbatim}

We will try to do the same thing as above, but now the output will be a stacked dataframe. Note that within each element of the apply row by row loop, we are generating two variables \emph{ar\_share} and \emph{ar\_levels}. We will not generate a dataframe with multiple columns, storing \emph{ar\_share}, \emph{ar\_levels} as well as information on \emph{min}, \emph{max}, number of draws and rescale total sum.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{1039}\NormalTok{)}
\CommentTok{\# apply row by row, anonymous function has hard coded min and max}
\NormalTok{ls\_mt\_draws\_shares\_lvls =}
\StringTok{  }\KeywordTok{apply}\NormalTok{(tb\_draw\_define, }\DecValTok{1}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(row) \{}

\NormalTok{    it\_draw\_group \textless{}{-}}\StringTok{ }\NormalTok{row[}\DecValTok{1}\NormalTok{]}
\NormalTok{    it\_draw \textless{}{-}}\StringTok{ }\NormalTok{row[}\DecValTok{2}\NormalTok{]}
\NormalTok{    fl\_sum \textless{}{-}}\StringTok{ }\NormalTok{row[}\DecValTok{3}\NormalTok{]}

\NormalTok{    ar\_unif \textless{}{-}}\StringTok{ }\KeywordTok{runif}\NormalTok{(it\_draw,}
                     \DataTypeTok{min=}\NormalTok{fl\_unif\_min,}
                     \DataTypeTok{max=}\NormalTok{fl\_unif\_max)}
\NormalTok{    ar\_share \textless{}{-}}\StringTok{ }\NormalTok{ar\_unif}\OperatorTok{/}\KeywordTok{sum}\NormalTok{(ar\_unif)}
\NormalTok{    ar\_levels \textless{}{-}}\StringTok{ }\NormalTok{ar\_share}\OperatorTok{*}\NormalTok{fl\_sum}

\NormalTok{    mt\_all\_res \textless{}{-}}\StringTok{ }\KeywordTok{cbind}\NormalTok{(it\_draw\_group, it\_draw, fl\_sum,}
\NormalTok{                        ar\_unif, ar\_share, ar\_levels)}
    \KeywordTok{colnames}\NormalTok{(mt\_all\_res) \textless{}{-}}
\StringTok{      }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}draw\_group\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}draw\_count\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}sum\textquotesingle{}}\NormalTok{,}
        \StringTok{\textquotesingle{}unif\_draw\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}share\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}rescale\textquotesingle{}}\NormalTok{)}
    \KeywordTok{rownames}\NormalTok{(mt\_all\_res) \textless{}{-}}\StringTok{ }\OtherTok{NULL}

    \KeywordTok{return}\NormalTok{(mt\_all\_res)}
\NormalTok{  \})}
\NormalTok{mt\_draws\_shares\_lvls\_all \textless{}{-}}\StringTok{ }\KeywordTok{do.call}\NormalTok{(rbind, ls\_mt\_draws\_shares\_lvls)}
\CommentTok{\# Show Results}
\KeywordTok{kable}\NormalTok{(mt\_draws\_shares\_lvls\_all) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r|r|r|r}
\hline
draw\_group & draw\_count & sum & unif\_draw & share & rescale\\
\hline
\rowcolor{gray!6}  1 & 4 & 5.361378 & 1.125668 & 0.1988606 & 1.066167\\
\hline
1 & 4 & 5.361378 & 1.668536 & 0.2947638 & 1.580340\\
\hline
\rowcolor{gray!6}  1 & 4 & 5.361378 & 1.419382 & 0.2507483 & 1.344356\\
\hline
1 & 4 & 5.361378 & 1.447001 & 0.2556274 & 1.370515\\
\hline
\rowcolor{gray!6}  2 & 2 & 7.652069 & 1.484598 & 0.4605236 & 3.523959\\
\hline
2 & 2 & 7.652069 & 1.739119 & 0.5394764 & 4.128110\\
\hline
\rowcolor{gray!6}  3 & 1 & 9.572211 & 1.952468 & 1.0000000 & 9.572211\\
\hline
4 & 3 & 9.621375 & 1.957931 & 0.3609352 & 3.472693\\
\hline
\rowcolor{gray!6}  4 & 3 & 9.621375 & 1.926995 & 0.3552324 & 3.417824\\
\hline
4 & 3 & 9.621375 & 1.539678 & 0.2838324 & 2.730858\\
\hline
\end{tabular}
\end{table}

\hypertarget{using-sapply}{%
\subsubsection{Using sapply}\label{using-sapply}}

\hypertarget{sapply-with-named-function}{%
\paragraph{sapply with named function}\label{sapply-with-named-function}}

\begin{itemize}
\tightlist
\item
  r convert matrix to list
\item
  Convert a matrix to a list of vectors in R
\end{itemize}

Sapply allows us to not have tohard code in the A and alpha arrays. But Sapply works over List or Vector, not Matrix. So we have to convert the \(N\) by \(Q\) matrix to a N element list
Now update the function with sapply.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ls\_ar\_nN\_by\_nQ\_A\_alpha =}\StringTok{ }\KeywordTok{as.list}\NormalTok{(}\KeywordTok{data.frame}\NormalTok{(}\KeywordTok{t}\NormalTok{(mt\_nN\_by\_nQ\_A\_alpha)))}

\CommentTok{\# Define Implicit Function}
\NormalTok{ffi\_linear\_sapply \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(ar\_A\_alpha, ar\_A, ar\_alpha)\{}
  \CommentTok{\# ar\_A\_alpha[1] is A}
  \CommentTok{\# ar\_A\_alpha[2] is alpha}

\NormalTok{  fl\_out =}\StringTok{ }\KeywordTok{sum}\NormalTok{(ar\_A\_alpha[}\DecValTok{1}\NormalTok{]}\OperatorTok{*}\NormalTok{ar\_nN\_A }\OperatorTok{+}
\StringTok{                 }\DecValTok{1}\OperatorTok{/}\NormalTok{(ar\_A\_alpha[}\DecValTok{2}\NormalTok{] }\OperatorTok{+}\StringTok{ }\DecValTok{1}\OperatorTok{/}\NormalTok{ar\_nN\_alpha))}

  \KeywordTok{return}\NormalTok{(fl\_out)}
\NormalTok{\}}

\CommentTok{\# Evaluate function row by row}
\NormalTok{ar\_func\_sapply =}\StringTok{ }\KeywordTok{sapply}\NormalTok{(ls\_ar\_nN\_by\_nQ\_A\_alpha, ffi\_linear\_sapply,}
                        \DataTypeTok{ar\_A=}\NormalTok{ar\_nN\_A, }\DataTypeTok{ar\_alpha=}\NormalTok{ar\_nN\_alpha)}
\end{Highlighting}
\end{Shaded}

\hypertarget{sapply-using-anonymous-function}{%
\paragraph{sapply using anonymous function}\label{sapply-using-anonymous-function}}

\begin{itemize}
\tightlist
\item
  sapply anonymous function
\item
  r anoymous function multiple lines
\end{itemize}

Sapply with anonymous function generating a list of arrays of different lengths. In the example below, we want to drawn \(N\) sets of random uniform numbers, but for each set the number of draws we want to have is \(Q_i\). Furthermore, we want to rescale the random uniform draws so that they all become proportions that sum u pto one for each \(i\).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{it\_N \textless{}{-}}\StringTok{ }\DecValTok{4}
\NormalTok{fl\_unif\_min \textless{}{-}}\StringTok{ }\DecValTok{1}
\NormalTok{fl\_unif\_max \textless{}{-}}\StringTok{ }\DecValTok{2}

\CommentTok{\# Generate using runif without anonymous function}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{1039}\NormalTok{)}
\NormalTok{ls\_ar\_draws =}\StringTok{ }\KeywordTok{sapply}\NormalTok{(}\KeywordTok{seq}\NormalTok{(it\_N),}
\NormalTok{                     runif,}
                     \DataTypeTok{min=}\NormalTok{fl\_unif\_min, }\DataTypeTok{max=}\NormalTok{fl\_unif\_max)}
\KeywordTok{print}\NormalTok{(ls\_ar\_draws)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [[1]]
## [1] 1.125668
## 
## [[2]]
## [1] 1.668536 1.419382
## 
## [[3]]
## [1] 1.447001 1.484598 1.739119
## 
## [[4]]
## [1] 1.952468 1.957931 1.926995 1.539678
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Generate Using Anonymous Function}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{1039}\NormalTok{)}
\NormalTok{ls\_ar\_draws\_shares =}\StringTok{ }\KeywordTok{sapply}\NormalTok{(}\KeywordTok{seq}\NormalTok{(it\_N),}
                            \ControlFlowTok{function}\NormalTok{(n, min, max) \{}
\NormalTok{                              ar\_unif \textless{}{-}}\StringTok{ }\KeywordTok{runif}\NormalTok{(n,min,max)}
\NormalTok{                              ar\_share \textless{}{-}}\StringTok{ }\NormalTok{ar\_unif}\OperatorTok{/}\KeywordTok{sum}\NormalTok{(ar\_unif)}
                              \KeywordTok{return}\NormalTok{(ar\_share)}
\NormalTok{                            \},}
                            \DataTypeTok{min=}\NormalTok{fl\_unif\_min, }\DataTypeTok{max=}\NormalTok{fl\_unif\_max)}
\CommentTok{\# Print Share}
\KeywordTok{print}\NormalTok{(ls\_ar\_draws\_shares)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [[1]]
## [1] 1
## 
## [[2]]
## [1] 0.5403432 0.4596568
## 
## [[3]]
## [1] 0.3098027 0.3178522 0.3723451
## 
## [[4]]
## [1] 0.2646671 0.2654076 0.2612141 0.2087113
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Sapply with anonymous function to check sums}
\KeywordTok{sapply}\NormalTok{(}\KeywordTok{seq}\NormalTok{(it\_N), }\ControlFlowTok{function}\NormalTok{(x) \{}\KeywordTok{sum}\NormalTok{(ls\_ar\_draws[[x]])\})}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1.125668 3.087918 4.670717 7.377071
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sapply}\NormalTok{(}\KeywordTok{seq}\NormalTok{(it\_N), }\ControlFlowTok{function}\NormalTok{(x) \{}\KeywordTok{sum}\NormalTok{(ls\_ar\_draws\_shares[[x]])\})}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1 1 1 1
\end{verbatim}

\hypertarget{using-dplyr-mutate-rowwise}{%
\subsubsection{Using dplyr mutate rowwise}\label{using-dplyr-mutate-rowwise}}

\begin{itemize}
\tightlist
\item
  dplyr mutate own function
\item
  dplyr all row function
\item
  dplyr do function
\item
  apply function each row dplyr
\item
  applying a function to every row of a table using dplyr
\item
  dplyr rowwise
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Convert Matrix to Tibble}
\NormalTok{ar\_st\_col\_names =}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}fl\_A\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}fl\_alpha\textquotesingle{}}\NormalTok{)}
\NormalTok{tb\_nN\_by\_nQ\_A\_alpha \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(mt\_nN\_by\_nQ\_A\_alpha) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rename\_all}\NormalTok{(}\OperatorTok{\textasciitilde{}}\KeywordTok{c}\NormalTok{(ar\_st\_col\_names))}
\CommentTok{\# Show}
\KeywordTok{kable}\NormalTok{(tb\_nN\_by\_nQ\_A\_alpha) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r}
\hline
fl\_A & fl\_alpha\\
\hline
\rowcolor{gray!6}  -2 & 0.1\\
\hline
-1 & 0.3\\
\hline
\rowcolor{gray!6}  0 & 0.5\\
\hline
1 & 0.7\\
\hline
\rowcolor{gray!6}  2 & 0.9\\
\hline
\end{tabular}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Define Implicit Function}
\NormalTok{ffi\_linear\_dplyrdo \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(fl\_A, fl\_alpha, ar\_nN\_A, ar\_nN\_alpha)\{}
  \CommentTok{\# ar\_A\_alpha[1] is A}
  \CommentTok{\# ar\_A\_alpha[2] is alpha}

  \KeywordTok{print}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}cur row, fl\_A=\textquotesingle{}}\NormalTok{, fl\_A, }\StringTok{\textquotesingle{}, fl\_alpha=\textquotesingle{}}\NormalTok{, fl\_alpha))}
\NormalTok{  fl\_out =}\StringTok{ }\KeywordTok{sum}\NormalTok{(fl\_A}\OperatorTok{*}\NormalTok{ar\_nN\_A }\OperatorTok{+}\StringTok{ }\DecValTok{1}\OperatorTok{/}\NormalTok{(fl\_alpha }\OperatorTok{+}\StringTok{ }\DecValTok{1}\OperatorTok{/}\NormalTok{ar\_nN\_alpha))}

  \KeywordTok{return}\NormalTok{(fl\_out)}
\NormalTok{\}}

\CommentTok{\# Evaluate function row by row of tibble}
\CommentTok{\# fl\_A, fl\_alpha are from columns of tb\_nN\_by\_nQ\_A\_alpha}
\NormalTok{tb\_nN\_by\_nQ\_A\_alpha\_show \textless{}{-}}\StringTok{ }\NormalTok{tb\_nN\_by\_nQ\_A\_alpha }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rowwise}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{dplyr\_eval =}
           \KeywordTok{ffi\_linear\_dplyrdo}\NormalTok{(fl\_A, fl\_alpha, ar\_nN\_A, ar\_nN\_alpha))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "cur row, fl_A=-2, fl_alpha=0.1"
## [1] "cur row, fl_A=-1, fl_alpha=0.3"
## [1] "cur row, fl_A=0, fl_alpha=0.5"
## [1] "cur row, fl_A=1, fl_alpha=0.7"
## [1] "cur row, fl_A=2, fl_alpha=0.9"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Show}
\KeywordTok{kable}\NormalTok{(tb\_nN\_by\_nQ\_A\_alpha\_show) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r}
\hline
fl\_A & fl\_alpha & dplyr\_eval\\
\hline
\rowcolor{gray!6}  -2 & 0.1 & 2.346356\\
\hline
-1 & 0.3 & 2.094273\\
\hline
\rowcolor{gray!6}  0 & 0.5 & 1.895316\\
\hline
1 & 0.7 & 1.733708\\
\hline
\rowcolor{gray!6}  2 & 0.9 & 1.599477\\
\hline
\end{tabular}
\end{table}

same as before, still rowwise, but hard code some inputs:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Define function, fixed inputs are not parameters, but}
\CommentTok{\# defined earlier as a part of the function}
\CommentTok{\# ar\_nN\_A, ar\_nN\_alpha are fixed, not parameters}
\NormalTok{ffi\_linear\_dplyrdo\_func \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(fl\_A, fl\_alpha)\{}
\NormalTok{  fl\_out \textless{}{-}}\StringTok{ }\KeywordTok{sum}\NormalTok{(fl\_A}\OperatorTok{*}\NormalTok{ar\_nN\_A }\OperatorTok{+}\StringTok{ }\DecValTok{1}\OperatorTok{/}\NormalTok{(fl\_alpha }\OperatorTok{+}\StringTok{ }\DecValTok{1}\OperatorTok{/}\NormalTok{ar\_nN\_alpha))}
  \KeywordTok{return}\NormalTok{(fl\_out)}
\NormalTok{\}}

\CommentTok{\# Evaluate function row by row of tibble}
\NormalTok{tbfunc\_A\_nN\_by\_nQ\_A\_alpha\_rowwise =}\StringTok{ }\NormalTok{tb\_nN\_by\_nQ\_A\_alpha }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{rowwise}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{dplyr\_eval =} \KeywordTok{ffi\_linear\_dplyrdo\_func}\NormalTok{(fl\_A, fl\_alpha))}
\CommentTok{\# Show}
\KeywordTok{kable}\NormalTok{(tbfunc\_A\_nN\_by\_nQ\_A\_alpha\_rowwise) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r}
\hline
fl\_A & fl\_alpha & dplyr\_eval\\
\hline
\rowcolor{gray!6}  -2 & 0.1 & 2.346356\\
\hline
-1 & 0.3 & 2.094273\\
\hline
\rowcolor{gray!6}  0 & 0.5 & 1.895316\\
\hline
1 & 0.7 & 1.733708\\
\hline
\rowcolor{gray!6}  2 & 0.9 & 1.599477\\
\hline
\end{tabular}
\end{table}

\hypertarget{using-dplyr-mutate-with-pmap}{%
\subsubsection{Using Dplyr Mutate with Pmap}\label{using-dplyr-mutate-with-pmap}}

Apparantly \emph{rowwise()} is not a good idea, and \emph{pmap} should be used, below is the \emph{pmap} solution to the problem. Which does seem nicer. Crucially, don't have to define input parameter names, automatically I think they are matching up to the names in the function

\begin{itemize}
\tightlist
\item
  dplyr mutate pass function
\item
  r function quosure string multiple
\item
  r function multiple parameters as one string
\item
  dplyr mutate anonymous function
\item
  quosure style lambda
\item
  pmap tibble rows
\item
  dplyr pwalk
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Define function, fixed inputs are not parameters, but defined}
\CommentTok{\# earlier as a part of the function Rorate fl\_alpha and fl\_A name}
\CommentTok{\# compared to before to make sure pmap tracks by names}
\NormalTok{ffi\_linear\_dplyrdo\_func \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(fl\_alpha, fl\_A)\{}
\NormalTok{  fl\_out \textless{}{-}}\StringTok{ }\KeywordTok{sum}\NormalTok{(fl\_A}\OperatorTok{*}\NormalTok{ar\_nN\_A }\OperatorTok{+}\StringTok{ }\DecValTok{1}\OperatorTok{/}\NormalTok{(fl\_alpha }\OperatorTok{+}\StringTok{ }\DecValTok{1}\OperatorTok{/}\NormalTok{ar\_nN\_alpha))}
  \KeywordTok{return}\NormalTok{(fl\_out)}
\NormalTok{\}}

\CommentTok{\# Evaluate a function row by row of dataframe, generate list,}
\CommentTok{\# then to vector}
\NormalTok{tb\_nN\_by\_nQ\_A\_alpha }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{pmap}\NormalTok{(ffi\_linear\_dplyrdo\_func) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{unlist}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2.346356 2.094273 1.895316 1.733708 1.599477
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Same as above, but in line line and save output as new column}
\CommentTok{\# in dataframe note this ONLY works if the tibble only has variables}
\CommentTok{\# that are inputs for the function if tibble contains additional}
\CommentTok{\#  variables, those should be droppd, or only the ones needed selected,}
\CommentTok{\# inside the pmap call below.}
\NormalTok{tbfunc\_A\_nN\_by\_nQ\_A\_alpha\_pmap \textless{}{-}}\StringTok{ }\NormalTok{tb\_nN\_by\_nQ\_A\_alpha }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{dplyr\_eval\_pmap =}
           \KeywordTok{unlist}\NormalTok{(}
             \KeywordTok{pmap}\NormalTok{(tb\_nN\_by\_nQ\_A\_alpha, ffi\_linear\_dplyrdo\_func)}
\NormalTok{           )}
\NormalTok{  )}

\CommentTok{\# Show}
\KeywordTok{kable}\NormalTok{(tbfunc\_A\_nN\_by\_nQ\_A\_alpha\_pmap) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r}
\hline
fl\_A & fl\_alpha & dplyr\_eval\_pmap\\
\hline
\rowcolor{gray!6}  -2 & 0.1 & 2.346356\\
\hline
-1 & 0.3 & 2.094273\\
\hline
\rowcolor{gray!6}  0 & 0.5 & 1.895316\\
\hline
1 & 0.7 & 1.733708\\
\hline
\rowcolor{gray!6}  2 & 0.9 & 1.599477\\
\hline
\end{tabular}
\end{table}

\hypertarget{dplyr-three-types-of-inputs-rowwise}{%
\subsubsection{DPLYR Three Types of Inputs ROWWISE}\label{dplyr-three-types-of-inputs-rowwise}}

Now, we have three types of parameters, for something like a bisection type calculation. We will supply the program with a function with some hard-coded value inside, and as parameters, we will have one parameter which is a row in the current matrix, and another parameter which is a sclar values. The three types of parameters are dealt with sparately:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  parameters that are fixed for all bisection iterations, but differ for each row
\end{enumerate}

\begin{itemize}
\tightlist
\item
  these are hard-coded into the function
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  parameters that are fixed for all bisection iterations, but are shared across rows
\end{enumerate}

\begin{itemize}
\tightlist
\item
  these are the first parameter of the function, a list
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  parameters that differ for each iteration, but differ acoss iterations
\end{enumerate}

\begin{itemize}
\item
  second scalar value parameter for the function
\item
  dplyr mutate function applow to each row dot notation
\item
  note \href{https://community.rstudio.com/t/dplyr-alternatives-to-rowwise/8071}{rowwise might be bad} according to Hadley, should use pmap?
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ffi\_linear\_dplyrdo\_fdot \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(ls\_row, fl\_param)\{}
  \CommentTok{\# Type 1 Param = ar\_nN\_A, ar\_nN\_alpha}
  \CommentTok{\# Type 2 Param = ls\_row$fl\_A, ls\_row$fl\_alpha}
  \CommentTok{\# Type 3 Param = fl\_param}

\NormalTok{  fl\_out \textless{}{-}}\StringTok{ }\NormalTok{(}\KeywordTok{sum}\NormalTok{(ls\_row}\OperatorTok{$}\NormalTok{fl\_A}\OperatorTok{*}\NormalTok{ar\_nN\_A }\OperatorTok{+}
\StringTok{                   }\DecValTok{1}\OperatorTok{/}\NormalTok{(ls\_row}\OperatorTok{$}\NormalTok{fl\_alpha }\OperatorTok{+}\StringTok{ }\DecValTok{1}\OperatorTok{/}\NormalTok{ar\_nN\_alpha))) }\OperatorTok{+}\StringTok{ }\NormalTok{fl\_param}
  \KeywordTok{return}\NormalTok{(fl\_out)}
\NormalTok{\}}

\NormalTok{cur\_func \textless{}{-}}\StringTok{ }\NormalTok{ffi\_linear\_dplyrdo\_fdot}
\NormalTok{fl\_param \textless{}{-}}\StringTok{ }\DecValTok{0}
\NormalTok{dplyr\_eval\_flex \textless{}{-}}\StringTok{ }\NormalTok{tb\_nN\_by\_nQ\_A\_alpha }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{rowwise}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{do}\NormalTok{(}\DataTypeTok{dplyr\_eval\_flex =} \KeywordTok{cur\_func}\NormalTok{(., fl\_param)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{unnest}\NormalTok{(dplyr\_eval\_flex)}
\NormalTok{tbfunc\_B\_nN\_by\_nQ\_A\_alpha \textless{}{-}}\StringTok{ }\NormalTok{tb\_nN\_by\_nQ\_A\_alpha }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{add\_column}\NormalTok{(dplyr\_eval\_flex)}
\CommentTok{\# Show}
\KeywordTok{kable}\NormalTok{(tbfunc\_B\_nN\_by\_nQ\_A\_alpha) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r}
\hline
fl\_A & fl\_alpha & dplyr\_eval\_flex\\
\hline
\rowcolor{gray!6}  -2 & 0.1 & 2.346356\\
\hline
-1 & 0.3 & 2.094273\\
\hline
\rowcolor{gray!6}  0 & 0.5 & 1.895316\\
\hline
1 & 0.7 & 1.733708\\
\hline
\rowcolor{gray!6}  2 & 0.9 & 1.599477\\
\hline
\end{tabular}
\end{table}

\hypertarget{compare-apply-and-mutate-results}{%
\subsubsection{Compare Apply and Mutate Results}\label{compare-apply-and-mutate-results}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Show overall Results}
\NormalTok{mt\_results \textless{}{-}}\StringTok{ }\KeywordTok{cbind}\NormalTok{(ar\_func\_apply, ar\_func\_sapply,}
\NormalTok{                    tb\_nN\_by\_nQ\_A\_alpha\_show[}\StringTok{\textquotesingle{}dplyr\_eval\textquotesingle{}}\NormalTok{],}
\NormalTok{                    tbfunc\_A\_nN\_by\_nQ\_A\_alpha\_rowwise[}\StringTok{\textquotesingle{}dplyr\_eval\textquotesingle{}}\NormalTok{],}
\NormalTok{                    tbfunc\_A\_nN\_by\_nQ\_A\_alpha\_pmap[}\StringTok{\textquotesingle{}dplyr\_eval\_pmap\textquotesingle{}}\NormalTok{],}
\NormalTok{                    tbfunc\_B\_nN\_by\_nQ\_A\_alpha[}\StringTok{\textquotesingle{}dplyr\_eval\_flex\textquotesingle{}}\NormalTok{],}
\NormalTok{                    mt\_nN\_by\_nQ\_A\_alpha)}
\KeywordTok{colnames}\NormalTok{(mt\_results) \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}eval\_lin\_apply\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}eval\_lin\_sapply\textquotesingle{}}\NormalTok{,}
                          \StringTok{\textquotesingle{}eval\_dplyr\_mutate\textquotesingle{}}\NormalTok{,}
                          \StringTok{\textquotesingle{}eval\_dplyr\_mutate\_hcode\textquotesingle{}}\NormalTok{,}
                          \StringTok{\textquotesingle{}eval\_dplyr\_mutate\_pmap\textquotesingle{}}\NormalTok{,}
                          \StringTok{\textquotesingle{}eval\_dplyr\_mutate\_flex\textquotesingle{}}\NormalTok{,}
                          \StringTok{\textquotesingle{}A\_child\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}alpha\_child\textquotesingle{}}\NormalTok{)}
\KeywordTok{kable}\NormalTok{(mt\_results) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{l|r|r|r|r|r|r|r|r}
\hline
  & eval\_lin\_apply & eval\_lin\_sapply & eval\_dplyr\_mutate & eval\_dplyr\_mutate\_hcode & eval\_dplyr\_mutate\_pmap & eval\_dplyr\_mutate\_flex & A\_child & alpha\_child\\
\hline
\rowcolor{gray!6}  X1 & 2.346356 & 2.346356 & 2.346356 & 2.346356 & 2.346356 & 2.346356 & -2 & 0.1\\
\hline
X2 & 2.094273 & 2.094273 & 2.094273 & 2.094273 & 2.094273 & 2.094273 & -1 & 0.3\\
\hline
\rowcolor{gray!6}  X3 & 1.895316 & 1.895316 & 1.895316 & 1.895316 & 1.895316 & 1.895316 & 0 & 0.5\\
\hline
X4 & 1.733708 & 1.733708 & 1.733708 & 1.733708 & 1.733708 & 1.733708 & 1 & 0.7\\
\hline
\rowcolor{gray!6}  X5 & 1.599477 & 1.599477 & 1.599477 & 1.599477 & 1.599477 & 1.599477 & 2 & 0.9\\
\hline
\end{tabular}}
\end{table}

\hypertarget{panel}{%
\chapter{Panel}\label{panel}}

\hypertarget{generate-and-join}{%
\section{Generate and Join}\label{generate-and-join}}

\hypertarget{generate-panel-structure}{%
\subsection{Generate Panel Structure}\label{generate-panel-structure}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

\hypertarget{balanced-panel-skeleton}{%
\subsubsection{Balanced Panel Skeleton}\label{balanced-panel-skeleton}}

There are \(N\) individuals, each could be observed \(M\) times. In the example below, there are 3 students, each observed over 4 dates. This just uses the \href{https://tidyr.tidyverse.org/reference/uncount.html}{uncount} function from \emph{tidyr}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Define}
\NormalTok{it\_N \textless{}{-}}\StringTok{ }\DecValTok{3}
\NormalTok{it\_M \textless{}{-}}\StringTok{ }\DecValTok{5}
\NormalTok{svr\_id \textless{}{-}}\StringTok{ \textquotesingle{}student\_id\textquotesingle{}}
\NormalTok{svr\_date \textless{}{-}}\StringTok{ \textquotesingle{}class\_day\textquotesingle{}}

\CommentTok{\# dataframe}
\NormalTok{df\_panel\_skeleton \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(}\KeywordTok{matrix}\NormalTok{(it\_M, }\DataTypeTok{nrow=}\NormalTok{it\_N, }\DataTypeTok{ncol=}\DecValTok{1}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rowid\_to\_column}\NormalTok{(}\DataTypeTok{var =}\NormalTok{ svr\_id) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{uncount}\NormalTok{(V1) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{group\_by}\NormalTok{(}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_id)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_date) }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\KeywordTok{row\_number}\NormalTok{()) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{ungroup}\NormalTok{()}

\CommentTok{\# Print}
\KeywordTok{kable}\NormalTok{(df\_panel\_skeleton) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r}
\hline
student\_id & class\_day\\
\hline
\rowcolor{gray!6}  1 & 1\\
\hline
1 & 2\\
\hline
\rowcolor{gray!6}  1 & 3\\
\hline
1 & 4\\
\hline
\rowcolor{gray!6}  1 & 5\\
\hline
2 & 1\\
\hline
\rowcolor{gray!6}  2 & 2\\
\hline
2 & 3\\
\hline
\rowcolor{gray!6}  2 & 4\\
\hline
2 & 5\\
\hline
\rowcolor{gray!6}  3 & 1\\
\hline
3 & 2\\
\hline
\rowcolor{gray!6}  3 & 3\\
\hline
3 & 4\\
\hline
\rowcolor{gray!6}  3 & 5\\
\hline
\end{tabular}
\end{table}

\hypertarget{join-datasets}{%
\subsection{Join Datasets}\label{join-datasets}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

\hypertarget{join-panel-with-multiple-keys}{%
\subsubsection{Join Panel with Multiple Keys}\label{join-panel-with-multiple-keys}}

We have two datasets, one for student enrollment, panel over time, but some students do not show up on some dates. The other is a skeleton panel with all student ID and all dates. Often we need to join dataframes together, and we need to join by the student ID and the panel time Key at the same time. When students show up, there is a quiz score for that day, so the joined panel should have as data column quiz score

Student count is \(N\), total dates are \(M\). First we generate two panels below, then we join by both keys using \emph{left\_join}. First, define dataframes:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Define}
\NormalTok{it\_N \textless{}{-}}\StringTok{ }\DecValTok{4}
\NormalTok{it\_M \textless{}{-}}\StringTok{ }\DecValTok{3}
\NormalTok{svr\_id \textless{}{-}}\StringTok{ \textquotesingle{}sid\textquotesingle{}}
\NormalTok{svr\_date \textless{}{-}}\StringTok{ \textquotesingle{}classday\textquotesingle{}}
\NormalTok{svr\_attend \textless{}{-}}\StringTok{ \textquotesingle{}date\_in\_class\textquotesingle{}}

\CommentTok{\# Panel Skeleton}
\NormalTok{df\_panel\_balanced\_skeleton \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(}\KeywordTok{matrix}\NormalTok{(it\_M, }\DataTypeTok{nrow=}\NormalTok{it\_N, }\DataTypeTok{ncol=}\DecValTok{1}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rowid\_to\_column}\NormalTok{(}\DataTypeTok{var =}\NormalTok{ svr\_id) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{uncount}\NormalTok{(V1) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{group\_by}\NormalTok{(}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_id)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_date) }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\KeywordTok{row\_number}\NormalTok{()) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{ungroup}\NormalTok{()}
\CommentTok{\# Print}
\KeywordTok{kable}\NormalTok{(df\_panel\_balanced\_skeleton) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r}
\hline
sid & classday\\
\hline
\rowcolor{gray!6}  1 & 1\\
\hline
1 & 2\\
\hline
\rowcolor{gray!6}  1 & 3\\
\hline
2 & 1\\
\hline
\rowcolor{gray!6}  2 & 2\\
\hline
2 & 3\\
\hline
\rowcolor{gray!6}  3 & 1\\
\hline
3 & 2\\
\hline
\rowcolor{gray!6}  3 & 3\\
\hline
4 & 1\\
\hline
\rowcolor{gray!6}  4 & 2\\
\hline
4 & 3\\
\hline
\end{tabular}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Smaller Panel of Random Days in School}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{456}\NormalTok{)}
\NormalTok{df\_panel\_attend \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(}\KeywordTok{matrix}\NormalTok{(it\_M, }\DataTypeTok{nrow=}\NormalTok{it\_N, }\DataTypeTok{ncol=}\DecValTok{1}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rowid\_to\_column}\NormalTok{(}\DataTypeTok{var =}\NormalTok{ svr\_id) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{uncount}\NormalTok{(V1) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{group\_by}\NormalTok{(}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_id)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_date) }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\KeywordTok{row\_number}\NormalTok{()) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{ungroup}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{in\_class =} \KeywordTok{case\_when}\NormalTok{(}\KeywordTok{rnorm}\NormalTok{(}\KeywordTok{n}\NormalTok{(),}\DataTypeTok{mean=}\DecValTok{0}\NormalTok{,}\DataTypeTok{sd=}\DecValTok{1}\NormalTok{) }\OperatorTok{\textless{}}\StringTok{ }\DecValTok{0} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{1}\NormalTok{, }\OtherTok{TRUE} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{0}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(in\_class }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{select}\NormalTok{(}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_id), }\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_date)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rename}\NormalTok{(}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_attend) }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_date)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{dayquizscore =} \KeywordTok{rnorm}\NormalTok{(}\KeywordTok{n}\NormalTok{(),}\DataTypeTok{mean=}\DecValTok{80}\NormalTok{,}\DataTypeTok{sd=}\DecValTok{10}\NormalTok{))}
\CommentTok{\# Print}
\KeywordTok{kable}\NormalTok{(df\_panel\_attend) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r}
\hline
sid & date\_in\_class & dayquizscore\\
\hline
\rowcolor{gray!6}  1 & 1 & 89.88726\\
\hline
2 & 1 & 96.53929\\
\hline
\rowcolor{gray!6}  2 & 2 & 65.59195\\
\hline
2 & 3 & 99.47356\\
\hline
\rowcolor{gray!6}  4 & 2 & 97.36936\\
\hline
\end{tabular}
\end{table}

Second, now join dataframes:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Join with explicit names}
\NormalTok{df\_quiz\_joined\_multikey \textless{}{-}}\StringTok{ }\NormalTok{df\_panel\_balanced\_skeleton }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(df\_panel\_attend,}
            \DataTypeTok{by=}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}sid\textquotesingle{}}\NormalTok{=}\StringTok{\textquotesingle{}sid\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}classday\textquotesingle{}}\NormalTok{=}\StringTok{\textquotesingle{}date\_in\_class\textquotesingle{}}\NormalTok{)))}

\CommentTok{\# Join with setname strings}
\NormalTok{df\_quiz\_joined\_multikey\_setnames \textless{}{-}}\StringTok{ }\NormalTok{df\_panel\_balanced\_skeleton }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(df\_panel\_attend, }\DataTypeTok{by=}\KeywordTok{setNames}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}sid\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}date\_in\_class\textquotesingle{}}\NormalTok{), }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}sid\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}classday\textquotesingle{}}\NormalTok{)))}

\CommentTok{\# Print}
\KeywordTok{kable}\NormalTok{(df\_quiz\_joined\_multikey) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r}
\hline
sid & classday & dayquizscore\\
\hline
\rowcolor{gray!6}  1 & 1 & 89.88726\\
\hline
1 & 2 & NA\\
\hline
\rowcolor{gray!6}  1 & 3 & NA\\
\hline
2 & 1 & 96.53929\\
\hline
\rowcolor{gray!6}  2 & 2 & 65.59195\\
\hline
2 & 3 & 99.47356\\
\hline
\rowcolor{gray!6}  3 & 1 & NA\\
\hline
3 & 2 & NA\\
\hline
\rowcolor{gray!6}  3 & 3 & NA\\
\hline
4 & 1 & NA\\
\hline
\rowcolor{gray!6}  4 & 2 & 97.36936\\
\hline
4 & 3 & NA\\
\hline
\end{tabular}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{kable}\NormalTok{(df\_quiz\_joined\_multikey\_setnames) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r}
\hline
sid & classday & dayquizscore\\
\hline
\rowcolor{gray!6}  1 & 1 & 89.88726\\
\hline
1 & 2 & NA\\
\hline
\rowcolor{gray!6}  1 & 3 & NA\\
\hline
2 & 1 & 96.53929\\
\hline
\rowcolor{gray!6}  2 & 2 & 65.59195\\
\hline
2 & 3 & 99.47356\\
\hline
\rowcolor{gray!6}  3 & 1 & NA\\
\hline
3 & 2 & NA\\
\hline
\rowcolor{gray!6}  3 & 3 & NA\\
\hline
4 & 1 & NA\\
\hline
\rowcolor{gray!6}  4 & 2 & 97.36936\\
\hline
4 & 3 & NA\\
\hline
\end{tabular}
\end{table}

\hypertarget{stack-panel-frames-together}{%
\subsubsection{Stack Panel Frames Together}\label{stack-panel-frames-together}}

There are multiple panel dataframe, each for different subsets of dates. All variable names and units of observations are identical. Use DPLYR \href{https://dplyr.tidyverse.org/reference/bind.html}{bind\_rows}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Define}
\NormalTok{it\_N \textless{}{-}}\StringTok{ }\DecValTok{2} \CommentTok{\# Number of individuals}
\NormalTok{it\_M \textless{}{-}}\StringTok{ }\DecValTok{3} \CommentTok{\# Number of Months}
\NormalTok{svr\_id \textless{}{-}}\StringTok{ \textquotesingle{}sid\textquotesingle{}}
\NormalTok{svr\_date \textless{}{-}}\StringTok{ \textquotesingle{}date\textquotesingle{}}

\CommentTok{\# Panel First Half of Year}
\NormalTok{df\_panel\_m1tom3 \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(}\KeywordTok{matrix}\NormalTok{(it\_M, }\DataTypeTok{nrow=}\NormalTok{it\_N, }\DataTypeTok{ncol=}\DecValTok{1}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rowid\_to\_column}\NormalTok{(}\DataTypeTok{var =}\NormalTok{ svr\_id) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{uncount}\NormalTok{(V1) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{group\_by}\NormalTok{(}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_id)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_date) }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\KeywordTok{row\_number}\NormalTok{()) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{ungroup}\NormalTok{()}

\CommentTok{\# Panel Second Half of Year}
\NormalTok{df\_panel\_m4tom6 \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(}\KeywordTok{matrix}\NormalTok{(it\_M, }\DataTypeTok{nrow=}\NormalTok{it\_N, }\DataTypeTok{ncol=}\DecValTok{1}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rowid\_to\_column}\NormalTok{(}\DataTypeTok{var =}\NormalTok{ svr\_id) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{uncount}\NormalTok{(V1) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{group\_by}\NormalTok{(}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_id)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_date) }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\KeywordTok{row\_number}\NormalTok{() }\OperatorTok{+}\StringTok{ }\DecValTok{3}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{ungroup}\NormalTok{()}

\CommentTok{\# Bind Rows}
\NormalTok{df\_panel\_m1tm6 \textless{}{-}}\StringTok{ }\KeywordTok{bind\_rows}\NormalTok{(df\_panel\_m1tom3, df\_panel\_m4tom6) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{arrange}\NormalTok{(}\OperatorTok{!!!}\KeywordTok{syms}\NormalTok{(}\KeywordTok{c}\NormalTok{(svr\_id, svr\_date)))}

\CommentTok{\# Print}
\KeywordTok{kable}\NormalTok{(df\_panel\_m1tom3) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r}
\hline
sid & date\\
\hline
\rowcolor{gray!6}  1 & 1\\
\hline
1 & 2\\
\hline
\rowcolor{gray!6}  1 & 3\\
\hline
2 & 1\\
\hline
\rowcolor{gray!6}  2 & 2\\
\hline
2 & 3\\
\hline
\end{tabular}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{kable}\NormalTok{(df\_panel\_m4tom6) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r}
\hline
sid & date\\
\hline
\rowcolor{gray!6}  1 & 4\\
\hline
1 & 5\\
\hline
\rowcolor{gray!6}  1 & 6\\
\hline
2 & 4\\
\hline
\rowcolor{gray!6}  2 & 5\\
\hline
2 & 6\\
\hline
\end{tabular}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{kable}\NormalTok{(df\_panel\_m1tm6) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r}
\hline
sid & date\\
\hline
\rowcolor{gray!6}  1 & 1\\
\hline
1 & 2\\
\hline
\rowcolor{gray!6}  1 & 3\\
\hline
1 & 4\\
\hline
\rowcolor{gray!6}  1 & 5\\
\hline
1 & 6\\
\hline
\rowcolor{gray!6}  2 & 1\\
\hline
2 & 2\\
\hline
\rowcolor{gray!6}  2 & 3\\
\hline
2 & 4\\
\hline
\rowcolor{gray!6}  2 & 5\\
\hline
2 & 6\\
\hline
\end{tabular}
\end{table}

\hypertarget{wide-and-long}{%
\section{Wide and Long}\label{wide-and-long}}

\hypertarget{long-to-wide}{%
\subsection{Long to Wide}\label{long-to-wide}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

Using the \href{https://tidyr.tidyverse.org/reference/pivot_wider.html}{pivot\_wider} function in tidyr to reshape panel or other data structures

\hypertarget{panel-long-attendance-roster-to-wide}{%
\subsubsection{Panel Long Attendance Roster to Wide}\label{panel-long-attendance-roster-to-wide}}

There are \(N\) students in class, but only a subset of them attend class each day. If student \(id_i\) is in class on day \(Q\), the teacher records on a sheet the date and the student ID. So if the student has been in class 10 times, the teacher has ten rows of recorded data for the student with two columns: column one is the student ID, and column two is the date on which the student was in class. Suppose there were 50 students, who on average attended exactly 10 classes each during the semester, this means we have \(10 \cdot 50\) rows of data, with differing numbers of rows for each student. This is shown as \emph{df\_panel\_attend\_date} generated below.

Now we want to generate a new dataframe, where each row is a date, and each column is a student. The values in the new dataframe shows, at the \(Q^{th}\) day, how many classes student \(i\) has attended so far. The following results is also in a REconTools Function. This is shown as \emph{df\_attend\_cumu\_by\_day} generated below.

\textbf{First}, generate the raw data structure, \emph{df\_panel\_attend\_date}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Define}
\NormalTok{it\_N \textless{}{-}}\StringTok{ }\DecValTok{3}
\NormalTok{it\_M \textless{}{-}}\StringTok{ }\DecValTok{5}
\NormalTok{svr\_id \textless{}{-}}\StringTok{ \textquotesingle{}student\_id\textquotesingle{}}

\CommentTok{\# from : support/rand/fs\_rand\_draws.Rmd}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{222}\NormalTok{)}
\NormalTok{df\_panel\_attend\_date \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(}\KeywordTok{matrix}\NormalTok{(it\_M, }\DataTypeTok{nrow=}\NormalTok{it\_N, }\DataTypeTok{ncol=}\DecValTok{1}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rowid\_to\_column}\NormalTok{(}\DataTypeTok{var =}\NormalTok{ svr\_id) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{uncount}\NormalTok{(V1) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{group\_by}\NormalTok{(}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_id)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{date =} \KeywordTok{row\_number}\NormalTok{()) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{ungroup}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{in\_class =} \KeywordTok{case\_when}\NormalTok{(}\KeywordTok{rnorm}\NormalTok{(}\KeywordTok{n}\NormalTok{(),}\DataTypeTok{mean=}\DecValTok{0}\NormalTok{,}\DataTypeTok{sd=}\DecValTok{1}\NormalTok{) }\OperatorTok{\textless{}}\StringTok{ }\DecValTok{0} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{1}\NormalTok{, }\OtherTok{TRUE} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{0}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(in\_class }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{select}\NormalTok{(}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_id), date) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{date\_in\_class =}\NormalTok{ date)}

\CommentTok{\# Print}
\KeywordTok{kable}\NormalTok{(df\_panel\_attend\_date) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r}
\hline
student\_id & date\_in\_class\\
\hline
\rowcolor{gray!6}  1 & 2\\
\hline
1 & 4\\
\hline
\rowcolor{gray!6}  2 & 1\\
\hline
2 & 2\\
\hline
\rowcolor{gray!6}  2 & 5\\
\hline
3 & 2\\
\hline
\rowcolor{gray!6}  3 & 3\\
\hline
3 & 5\\
\hline
\end{tabular}
\end{table}

\textbf{Second}, generate wider data structure, \emph{df\_attend\_cumu\_by\_day}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Define}
\NormalTok{svr\_id \textless{}{-}}\StringTok{ \textquotesingle{}student\_id\textquotesingle{}}
\NormalTok{svr\_date \textless{}{-}}\StringTok{ \textquotesingle{}date\_in\_class\textquotesingle{}}
\NormalTok{st\_idcol\_prefix \textless{}{-}}\StringTok{ \textquotesingle{}sid\_\textquotesingle{}}

\CommentTok{\# Generate cumulative enrollment counts by date}
\NormalTok{df\_panel\_attend\_date\_addone \textless{}{-}}\StringTok{ }\NormalTok{df\_panel\_attend\_date }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{attended =} \DecValTok{1}\NormalTok{)}
\KeywordTok{kable}\NormalTok{(df\_panel\_attend\_date\_addone) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r}
\hline
student\_id & date\_in\_class & attended\\
\hline
\rowcolor{gray!6}  1 & 2 & 1\\
\hline
1 & 4 & 1\\
\hline
\rowcolor{gray!6}  2 & 1 & 1\\
\hline
2 & 2 & 1\\
\hline
\rowcolor{gray!6}  2 & 5 & 1\\
\hline
3 & 2 & 1\\
\hline
\rowcolor{gray!6}  3 & 3 & 1\\
\hline
3 & 5 & 1\\
\hline
\end{tabular}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Pivot Wide}
\NormalTok{df\_panel\_attend\_date\_wider \textless{}{-}}\StringTok{ }\NormalTok{df\_panel\_attend\_date\_addone }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{pivot\_wider}\NormalTok{(}\DataTypeTok{names\_from =}\NormalTok{ svr\_id,}
              \DataTypeTok{values\_from =}\NormalTok{ attended)}
\KeywordTok{kable}\NormalTok{(df\_panel\_attend\_date\_wider) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r|r}
\hline
date\_in\_class & 1 & 2 & 3\\
\hline
\rowcolor{gray!6}  2 & 1 & 1 & 1\\
\hline
4 & 1 & NA & NA\\
\hline
\rowcolor{gray!6}  1 & NA & 1 & NA\\
\hline
5 & NA & 1 & 1\\
\hline
\rowcolor{gray!6}  3 & NA & NA & 1\\
\hline
\end{tabular}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Sort and rename}
\CommentTok{\# rename see: https://fanwangecon.github.io/R4Econ/amto/tibble/fs\_tib\_basics.html}
\NormalTok{ar\_unique\_ids \textless{}{-}}\StringTok{ }\KeywordTok{sort}\NormalTok{(}\KeywordTok{unique}\NormalTok{(df\_panel\_attend\_date }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{pull}\NormalTok{(}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_id))))}
\NormalTok{df\_panel\_attend\_date\_wider\_sort \textless{}{-}}\StringTok{ }\NormalTok{df\_panel\_attend\_date\_wider }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{arrange}\NormalTok{(}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_date)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{rename\_at}\NormalTok{(}\KeywordTok{vars}\NormalTok{(}\KeywordTok{num\_range}\NormalTok{(}\StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{,ar\_unique\_ids))}
\NormalTok{              , }\KeywordTok{list}\NormalTok{(}\OperatorTok{\textasciitilde{}}\KeywordTok{paste0}\NormalTok{(st\_idcol\_prefix, . , }\StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{))}
\NormalTok{              )}
\KeywordTok{kable}\NormalTok{(df\_panel\_attend\_date\_wider\_sort) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r|r}
\hline
date\_in\_class & sid\_1 & sid\_2 & sid\_3\\
\hline
\rowcolor{gray!6}  1 & NA & 1 & NA\\
\hline
2 & 1 & 1 & 1\\
\hline
\rowcolor{gray!6}  3 & NA & NA & 1\\
\hline
4 & 1 & NA & NA\\
\hline
\rowcolor{gray!6}  5 & NA & 1 & 1\\
\hline
\end{tabular}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# replace NA and cumusum again}
\CommentTok{\# see: R4Econ/support/function/fs\_func\_multivar for renaming and replacing}
\NormalTok{df\_attend\_cumu\_by\_day \textless{}{-}}\StringTok{ }\NormalTok{df\_panel\_attend\_date\_wider\_sort }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate\_at}\NormalTok{(}\KeywordTok{vars}\NormalTok{(}\KeywordTok{contains}\NormalTok{(st\_idcol\_prefix)), }\KeywordTok{list}\NormalTok{(}\OperatorTok{\textasciitilde{}}\KeywordTok{replace\_na}\NormalTok{(., }\DecValTok{0}\NormalTok{))) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate\_at}\NormalTok{(}\KeywordTok{vars}\NormalTok{(}\KeywordTok{contains}\NormalTok{(st\_idcol\_prefix)), }\KeywordTok{list}\NormalTok{(}\OperatorTok{\textasciitilde{}}\KeywordTok{cumsum}\NormalTok{(.)))}

\KeywordTok{kable}\NormalTok{(df\_attend\_cumu\_by\_day) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r|r}
\hline
date\_in\_class & sid\_1 & sid\_2 & sid\_3\\
\hline
\rowcolor{gray!6}  1 & 0 & 1 & 0\\
\hline
2 & 1 & 2 & 1\\
\hline
\rowcolor{gray!6}  3 & 1 & 2 & 2\\
\hline
4 & 2 & 2 & 2\\
\hline
\rowcolor{gray!6}  5 & 2 & 3 & 3\\
\hline
\end{tabular}
\end{table}

The structure above is also a function in Fan's \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, here the function is tested:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Parameters}
\NormalTok{df \textless{}{-}}\StringTok{ }\NormalTok{df\_panel\_attend\_date}
\NormalTok{svr\_id\_i \textless{}{-}}\StringTok{ \textquotesingle{}student\_id\textquotesingle{}}
\NormalTok{svr\_id\_t \textless{}{-}}\StringTok{ \textquotesingle{}date\_in\_class\textquotesingle{}}
\NormalTok{st\_idcol\_prefix \textless{}{-}}\StringTok{ \textquotesingle{}sid\_\textquotesingle{}}

\CommentTok{\# Invoke Function}
\NormalTok{ls\_df\_rosterwide \textless{}{-}}\StringTok{ }\KeywordTok{ff\_panel\_expand\_longrosterwide}\NormalTok{(df, svr\_id\_t, svr\_id\_i, st\_idcol\_prefix)}
\NormalTok{df\_roster\_wide\_func \textless{}{-}}\StringTok{ }\NormalTok{ls\_df\_rosterwide}\OperatorTok{$}\NormalTok{df\_roster\_wide}
\NormalTok{df\_roster\_wide\_cumu\_func \textless{}{-}}\StringTok{ }\NormalTok{ls\_df\_rosterwide}\OperatorTok{$}\NormalTok{df\_roster\_wide\_cumu}

\CommentTok{\# Print}
\KeywordTok{print}\NormalTok{(df\_roster\_wide\_func)}
\KeywordTok{print}\NormalTok{(df\_roster\_wide\_cumu\_func)}
\end{Highlighting}
\end{Shaded}

\hypertarget{wide-to-long}{%
\subsection{Wide to Long}\label{wide-to-long}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

Using the \href{https://tidyr.tidyverse.org/reference/pivot_wider.html}{pivot\_wider} function in tidyr to reshape panel or other data structures

\hypertarget{generated-matrix-by-states-to-long-table}{%
\subsubsection{Generated Matrix by States to Long Table}\label{generated-matrix-by-states-to-long-table}}

A matrix of ev given states, rows are states and cols are shocks. Convert to Long table with shock and state values and ev.

Generated Matrix by States to Long Table where state values are stored as variables, with correct value labels for states:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Generate a matrix
\item
  Convert matrix to tibble
\item
  Tibble make longer, and store column and row id var names
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Generate A Matrix}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{123}\NormalTok{)}
\NormalTok{ar\_a \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\FloatTok{1.2}\NormalTok{, }\FloatTok{22.2}\NormalTok{, }\FloatTok{33.33}\NormalTok{)}
\NormalTok{ar\_z \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\OperatorTok{{-}}\FloatTok{2.5}\NormalTok{,  }\DecValTok{{-}1}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\FloatTok{2.53}\NormalTok{)}
\NormalTok{mt\_ev =}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\KeywordTok{rnorm}\NormalTok{(ar\_a}\OperatorTok{*}\NormalTok{ar\_z), }\DataTypeTok{nrow=}\KeywordTok{length}\NormalTok{(ar\_a), }\DataTypeTok{ncol=}\KeywordTok{length}\NormalTok{(ar\_z))}

\CommentTok{\# Name Matrix}
\KeywordTok{rownames}\NormalTok{(mt\_ev) \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}ai\textquotesingle{}}\NormalTok{, }\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(ar\_a)))}
\KeywordTok{colnames}\NormalTok{(mt\_ev) \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}zi\textquotesingle{}}\NormalTok{, }\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(ar\_z)))}

\CommentTok{\# to tibble}
\NormalTok{tb\_ev \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(mt\_ev) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{rowid\_to\_column}\NormalTok{(}\DataTypeTok{var =} \StringTok{"ai"}\NormalTok{)}

\CommentTok{\# longer }
\NormalTok{tb\_ev\_long \textless{}{-}}\StringTok{ }\NormalTok{tb\_ev }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{pivot\_longer}\NormalTok{(}\DataTypeTok{cols =} \KeywordTok{starts\_with}\NormalTok{(}\StringTok{\textquotesingle{}zi\textquotesingle{}}\NormalTok{), }
               \DataTypeTok{names\_to =} \KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}zi\textquotesingle{}}\NormalTok{),}
               \DataTypeTok{names\_pattern =} \KeywordTok{paste0}\NormalTok{(}\StringTok{"zi(.)"}\NormalTok{),}
               \DataTypeTok{values\_to =} \StringTok{"ev"}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{zi =} \KeywordTok{as.numeric}\NormalTok{(zi))}

\CommentTok{\# Merge with a and z values}
\NormalTok{tb\_ev\_long \textless{}{-}}\StringTok{ }\NormalTok{tb\_ev\_long }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(}\KeywordTok{as\_tibble}\NormalTok{(ar\_a) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{              }\KeywordTok{rowid\_to\_column}\NormalTok{(}\DataTypeTok{var =} \StringTok{"ai"}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{              }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{a =}\NormalTok{ value)}
\NormalTok{              , }\DataTypeTok{by =} \StringTok{\textquotesingle{}ai\textquotesingle{}}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(}\KeywordTok{as\_tibble}\NormalTok{(ar\_z) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{              }\KeywordTok{rowid\_to\_column}\NormalTok{(}\DataTypeTok{var =} \StringTok{"zi"}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{              }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{z =}\NormalTok{ value), }
            \DataTypeTok{by =} \StringTok{\textquotesingle{}zi\textquotesingle{}}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(a,ai,z,zi,ev)}

\CommentTok{\# Display}
\KeywordTok{kable}\NormalTok{(tb\_ev) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{kable\_styling\_fc}\NormalTok{()  }
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r|r|r|r}
\hline
ai & zi1 & zi2 & zi3 & zi4 & zi5\\
\hline
\rowcolor{gray!6}  1 & -0.5604756 & 0.0705084 & -0.2301775 & 0.1292877 & 1.5587083\\
\hline
2 & -0.2301775 & 0.1292877 & 1.5587083 & -0.5604756 & 0.0705084\\
\hline
\rowcolor{gray!6}  3 & 1.5587083 & -0.5604756 & 0.0705084 & -0.2301775 & 0.1292877\\
\hline
\end{tabular}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{kable}\NormalTok{(tb\_ev\_long) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{kable\_styling\_fc}\NormalTok{()  }
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r|r|r}
\hline
a & ai & z & zi & ev\\
\hline
\rowcolor{gray!6}  1.20 & 1 & -2.50 & 1 & -0.5604756\\
\hline
1.20 & 1 & -1.00 & 2 & 0.0705084\\
\hline
\rowcolor{gray!6}  1.20 & 1 & 0.00 & 3 & -0.2301775\\
\hline
1.20 & 1 & 1.00 & 4 & 0.1292877\\
\hline
\rowcolor{gray!6}  1.20 & 1 & 2.53 & 5 & 1.5587083\\
\hline
22.20 & 2 & -2.50 & 1 & -0.2301775\\
\hline
\rowcolor{gray!6}  22.20 & 2 & -1.00 & 2 & 0.1292877\\
\hline
22.20 & 2 & 0.00 & 3 & 1.5587083\\
\hline
\rowcolor{gray!6}  22.20 & 2 & 1.00 & 4 & -0.5604756\\
\hline
22.20 & 2 & 2.53 & 5 & 0.0705084\\
\hline
\rowcolor{gray!6}  33.33 & 3 & -2.50 & 1 & 1.5587083\\
\hline
33.33 & 3 & -1.00 & 2 & -0.5604756\\
\hline
\rowcolor{gray!6}  33.33 & 3 & 0.00 & 3 & 0.0705084\\
\hline
33.33 & 3 & 1.00 & 4 & -0.2301775\\
\hline
\rowcolor{gray!6}  33.33 & 3 & 2.53 & 5 & 0.1292877\\
\hline
\end{tabular}
\end{table}

\hypertarget{linear-regression}{%
\chapter{Linear Regression}\label{linear-regression}}

\hypertarget{ols-and-iv}{%
\section{OLS and IV}\label{ols-and-iv}}

Back to \textbf{\href{https://fanwangecon.github.io/}{Fan}}'s R4Econ Homepage \textbf{\href{https://fanwangecon.github.io/R4Econ/}{Table of Content}}

\hypertarget{ols-and-iv-regression}{%
\subsection{OLS and IV Regression}\label{ols-and-iv-regression}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

IV regression using AER package. Option to store all results in dataframe row for combining results from other estimations together. Produce Row Statistics.

\hypertarget{construct-program}{%
\subsubsection{Construct Program}\label{construct-program}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# IV regression function}
\CommentTok{\# The code below uses the AER library\textquotesingle{}s regresison function}
\CommentTok{\# All results are stored in a single row as data\_frame}
\CommentTok{\# This functoin could work with dplyr do}
\CommentTok{\# var.y is single outcome, vars.x, vars.c and vars.z are vectors of endogenous variables, controls and instruments.}
\NormalTok{regf.iv \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(var.y, vars.x, }
\NormalTok{                    vars.c, vars.z, df, }\DataTypeTok{transpose=}\OtherTok{TRUE}\NormalTok{) \{}
  
  \CommentTok{\# A. Set{-}Up Equation}
\NormalTok{  str.vars.x \textless{}{-}}\StringTok{ }\KeywordTok{paste}\NormalTok{(vars.x, }\DataTypeTok{collapse=}\StringTok{\textquotesingle{}+\textquotesingle{}}\NormalTok{)}
\NormalTok{  str.vars.c \textless{}{-}}\StringTok{ }\KeywordTok{paste}\NormalTok{(vars.c, }\DataTypeTok{collapse=}\StringTok{\textquotesingle{}+\textquotesingle{}}\NormalTok{)}
  
\NormalTok{  df \textless{}{-}}\StringTok{ }\NormalTok{df }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{    }\KeywordTok{select}\NormalTok{(}\KeywordTok{one\_of}\NormalTok{(var.y, vars.x, vars.c, vars.z)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{    }\KeywordTok{drop\_na}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{filter\_all}\NormalTok{(}\KeywordTok{all\_vars}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.infinite}\NormalTok{(.)))}
  
  \ControlFlowTok{if}\NormalTok{ (}\KeywordTok{length}\NormalTok{(vars.z) }\OperatorTok{\textgreater{}=}\StringTok{ }\DecValTok{1}\NormalTok{) \{}
    \CommentTok{\#     library(AER)}
\NormalTok{    str.vars.z \textless{}{-}}\StringTok{ }\KeywordTok{paste}\NormalTok{(vars.z, }\DataTypeTok{collapse=}\StringTok{\textquotesingle{}+\textquotesingle{}}\NormalTok{)}
\NormalTok{    equa.iv \textless{}{-}}\StringTok{ }\KeywordTok{paste}\NormalTok{(var.y,}
                     \KeywordTok{paste}\NormalTok{(}\KeywordTok{paste}\NormalTok{(str.vars.x, str.vars.c, }\DataTypeTok{sep=}\StringTok{\textquotesingle{}+\textquotesingle{}}\NormalTok{),}
                           \KeywordTok{paste}\NormalTok{(str.vars.z, str.vars.c, }\DataTypeTok{sep=}\StringTok{\textquotesingle{}+\textquotesingle{}}\NormalTok{),}
                           \DataTypeTok{sep=}\StringTok{\textquotesingle{}|\textquotesingle{}}\NormalTok{),}
                     \DataTypeTok{sep=}\StringTok{\textquotesingle{}\textasciitilde{}\textquotesingle{}}\NormalTok{)}
    \CommentTok{\#     print(equa.iv)}
    
    \CommentTok{\# B. IV Regression}
\NormalTok{    ivreg.summ \textless{}{-}}\StringTok{ }\KeywordTok{summary}\NormalTok{(}\KeywordTok{ivreg}\NormalTok{(}\KeywordTok{as.formula}\NormalTok{(equa.iv), }\DataTypeTok{data=}\NormalTok{df),}
                          \DataTypeTok{vcov =}\NormalTok{ sandwich, }\DataTypeTok{df =} \OtherTok{Inf}\NormalTok{, }\DataTypeTok{diagnostics =} \OtherTok{TRUE}\NormalTok{)}
    
    \CommentTok{\# C. Statistics from IV Regression}
    \CommentTok{\#     ivreg.summ$coef}
    \CommentTok{\#     ivreg.summ$diagnostics}
    
    \CommentTok{\# D. Combine Regression Results into a Matrix}
\NormalTok{    df.results \textless{}{-}}\StringTok{ }\KeywordTok{suppressWarnings}\NormalTok{(}\KeywordTok{suppressMessages}\NormalTok{(}
      \KeywordTok{as\_tibble}\NormalTok{(ivreg.summ}\OperatorTok{$}\NormalTok{coef, }\DataTypeTok{rownames=}\StringTok{\textquotesingle{}rownames\textquotesingle{}}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{        }\KeywordTok{full\_join}\NormalTok{(}\KeywordTok{as\_tibble}\NormalTok{(ivreg.summ}\OperatorTok{$}\NormalTok{diagnostics, }\DataTypeTok{rownames=}\StringTok{\textquotesingle{}rownames\textquotesingle{}}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{        }\KeywordTok{full\_join}\NormalTok{(}\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{rownames=}\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}vars\textquotesingle{}}\NormalTok{),}
                         \DataTypeTok{var.y=}\NormalTok{var.y,}
                         \DataTypeTok{vars.x=}\NormalTok{str.vars.x,}
                         \DataTypeTok{vars.z=}\NormalTok{str.vars.z,}
                         \DataTypeTok{vars.c=}\NormalTok{str.vars.c))))}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
    
    \CommentTok{\# OLS regression}
\NormalTok{    equa.ols \textless{}{-}}\StringTok{ }\KeywordTok{paste}\NormalTok{(var.y,}
                      \KeywordTok{paste}\NormalTok{(}\KeywordTok{paste}\NormalTok{(vars.x, }\DataTypeTok{collapse=}\StringTok{\textquotesingle{}+\textquotesingle{}}\NormalTok{),}
                            \KeywordTok{paste}\NormalTok{(vars.c, }\DataTypeTok{collapse=}\StringTok{\textquotesingle{}+\textquotesingle{}}\NormalTok{), }\DataTypeTok{sep=}\StringTok{\textquotesingle{}+\textquotesingle{}}\NormalTok{),}
                      \DataTypeTok{sep=}\StringTok{\textquotesingle{}\textasciitilde{}\textquotesingle{}}\NormalTok{)}
    
\NormalTok{    lmreg.summ \textless{}{-}}\StringTok{ }\KeywordTok{summary}\NormalTok{(}\KeywordTok{lm}\NormalTok{(}\KeywordTok{as.formula}\NormalTok{(equa.ols), }\DataTypeTok{data=}\NormalTok{df))}
    
\NormalTok{    lm.diagnostics \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(}
      \KeywordTok{list}\NormalTok{(}\DataTypeTok{df1=}\NormalTok{lmreg.summ}\OperatorTok{$}\NormalTok{df[[}\DecValTok{1}\NormalTok{]],}
           \DataTypeTok{df2=}\NormalTok{lmreg.summ}\OperatorTok{$}\NormalTok{df[[}\DecValTok{2}\NormalTok{]],}
           \DataTypeTok{df3=}\NormalTok{lmreg.summ}\OperatorTok{$}\NormalTok{df[[}\DecValTok{3}\NormalTok{]],}
           \DataTypeTok{sigma=}\NormalTok{lmreg.summ}\OperatorTok{$}\NormalTok{sigma,}
           \DataTypeTok{r.squared=}\NormalTok{lmreg.summ}\OperatorTok{$}\NormalTok{r.squared,}
           \DataTypeTok{adj.r.squared=}\NormalTok{lmreg.summ}\OperatorTok{$}\NormalTok{adj.r.squared)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{      }\KeywordTok{gather}\NormalTok{(variable, value) }\OperatorTok{\%\textgreater{}\%}
\StringTok{      }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{rownames =}\NormalTok{ variable) }\OperatorTok{\%\textgreater{}\%}
\StringTok{      }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{v =}\NormalTok{ value)}
    
\NormalTok{    df.results \textless{}{-}}\StringTok{ }\KeywordTok{suppressWarnings}\NormalTok{(}\KeywordTok{suppressMessages}\NormalTok{(}
      \KeywordTok{as\_tibble}\NormalTok{(lmreg.summ}\OperatorTok{$}\NormalTok{coef, }\DataTypeTok{rownames=}\StringTok{\textquotesingle{}rownames\textquotesingle{}}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{        }\KeywordTok{full\_join}\NormalTok{(lm.diagnostics) }\OperatorTok{\%\textgreater{}\%}
\StringTok{        }\KeywordTok{full\_join}\NormalTok{(}\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{rownames=}\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}vars\textquotesingle{}}\NormalTok{),}
                         \DataTypeTok{var.y=}\NormalTok{var.y,}
                         \DataTypeTok{vars.x=}\NormalTok{str.vars.x,}
                         \DataTypeTok{vars.c=}\NormalTok{str.vars.c))))}
\NormalTok{  \}}
  
  \CommentTok{\# E. Flatten Matrix, All IV results as a single tibble }
  \CommentTok{\# row to be combined with other IV results}
\NormalTok{  df.row.results \textless{}{-}}\StringTok{ }\NormalTok{df.results }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{gather}\NormalTok{(variable, value, }\OperatorTok{{-}}\NormalTok{rownames) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{drop\_na}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{unite}\NormalTok{(esti.val, rownames, variable) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{esti.val =} \KeywordTok{gsub}\NormalTok{(}\StringTok{\textquotesingle{} \textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{, esti.val))}
  
  \ControlFlowTok{if}\NormalTok{ (transpose) \{}
\NormalTok{    df.row.results \textless{}{-}}\StringTok{ }\NormalTok{df.row.results }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{spread}\NormalTok{(esti.val, value)}
\NormalTok{  \}}
  
  \CommentTok{\# F. Return}
  \KeywordTok{return}\NormalTok{(}\KeywordTok{data.frame}\NormalTok{(df.row.results))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{program-testing}{%
\subsubsection{Program Testing}\label{program-testing}}

Load Data

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Library}
\KeywordTok{library}\NormalTok{(tidyverse)}
\KeywordTok{library}\NormalTok{(AER)}

\CommentTok{\# Load Sample Data}
\KeywordTok{setwd}\NormalTok{(}\StringTok{\textquotesingle{}C:/Users/fan/R4Econ/\_data/\textquotesingle{}}\NormalTok{)}
\NormalTok{df \textless{}{-}}\StringTok{ }\KeywordTok{read\_csv}\NormalTok{(}\StringTok{\textquotesingle{}height\_weight.csv\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{example-no-instrument-ols}{%
\paragraph{Example No Instrument, OLS}\label{example-no-instrument-ols}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# One Instrucments}
\NormalTok{var.y \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}hgt\textquotesingle{}}\NormalTok{)}
\NormalTok{vars.x \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}prot\textquotesingle{}}\NormalTok{)}
\NormalTok{vars.z \textless{}{-}}\StringTok{ }\OtherTok{NULL}
\NormalTok{vars.c \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}sex\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}hgt0\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}wgt0\textquotesingle{}}\NormalTok{)}
\CommentTok{\# Regression}
\KeywordTok{regf.iv}\NormalTok{(var.y, vars.x, vars.c, vars.z, df, }\DataTypeTok{transpose=}\OtherTok{FALSE}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{l|l}
\hline
esti.val & value\\
\hline
\rowcolor{gray!6}  (Intercept)\_Estimate & 52.1186286658651\\
\hline
prot\_Estimate & 0.374472386357917\\
\hline
\rowcolor{gray!6}  sexMale\_Estimate & 0.611043720578292\\
\hline
hgt0\_Estimate & 0.148513781160842\\
\hline
\rowcolor{gray!6}  wgt0\_Estimate & 0.00150560230505631\\
\hline
(Intercept)\_Std.Error & 1.57770483608693\\
\hline
\rowcolor{gray!6}  prot\_Std.Error & 0.00418121191133815\\
\hline
sexMale\_Std.Error & 0.118396259120659\\
\hline
\rowcolor{gray!6}  hgt0\_Std.Error & 0.0393807494783186\\
\hline
wgt0\_Std.Error & 0.000187123663624397\\
\hline
\rowcolor{gray!6}  (Intercept)\_tvalue & 33.0344608660332\\
\hline
prot\_tvalue & 89.5607288744356\\
\hline
\rowcolor{gray!6}  sexMale\_tvalue & 5.16100529794248\\
\hline
hgt0\_tvalue & 3.77122790013449\\
\hline
\rowcolor{gray!6}  wgt0\_tvalue & 8.04602836377991\\
\hline
(Intercept)\_Pr(>|t|) & 9.92126150975783e-233\\
\hline
\rowcolor{gray!6}  prot\_Pr(>|t|) & 0\\
\hline
sexMale\_Pr(>|t|) & 2.48105505495642e-07\\
\hline
\rowcolor{gray!6}  hgt0\_Pr(>|t|) & 0.000162939618371183\\
\hline
wgt0\_Pr(>|t|) & 9.05257561534111e-16\\
\hline
\rowcolor{gray!6}  df1\_v & 5\\
\hline
df2\_v & 18958\\
\hline
\rowcolor{gray!6}  df3\_v & 5\\
\hline
sigma\_v & 8.06197784622979\\
\hline
\rowcolor{gray!6}  r.squared\_v & 0.319078711001325\\
\hline
adj.r.squared\_v & 0.318935041565942\\
\hline
\rowcolor{gray!6}  vars\_var.y & hgt\\
\hline
vars\_vars.x & prot\\
\hline
\rowcolor{gray!6}  vars\_vars.c & sex+hgt0+wgt0\\
\hline
\end{tabular}
\end{table}

\hypertarget{example-1-insturment}{%
\paragraph{Example 1 Insturment}\label{example-1-insturment}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# One Instrucments}
\NormalTok{var.y \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}hgt\textquotesingle{}}\NormalTok{)}
\NormalTok{vars.x \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}prot\textquotesingle{}}\NormalTok{)}
\NormalTok{vars.z \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}momEdu\textquotesingle{}}\NormalTok{)}
\NormalTok{vars.c \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}sex\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}hgt0\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}wgt0\textquotesingle{}}\NormalTok{)}
\CommentTok{\# Regression}
\KeywordTok{regf.iv}\NormalTok{(var.y, vars.x, vars.c, vars.z, df, }\DataTypeTok{transpose=}\OtherTok{FALSE}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{l|l}
\hline
esti.val & value\\
\hline
\rowcolor{gray!6}  (Intercept)\_Estimate & 43.4301969117558\\
\hline
prot\_Estimate & 0.130833343849446\\
\hline
\rowcolor{gray!6}  sexMale\_Estimate & 0.868121847262411\\
\hline
hgt0\_Estimate & 0.412093881817148\\
\hline
\rowcolor{gray!6}  wgt0\_Estimate & 0.000858630042617921\\
\hline
(Intercept)\_Std.Error & 1.82489550971182\\
\hline
\rowcolor{gray!6}  prot\_Std.Error & 0.0192036220809189\\
\hline
sexMale\_Std.Error & 0.13373016700542\\
\hline
\rowcolor{gray!6}  hgt0\_Std.Error & 0.0459431912927002\\
\hline
wgt0\_Std.Error & 0.00022691057702563\\
\hline
\rowcolor{gray!6}  (Intercept)\_zvalue & 23.798730766023\\
\hline
prot\_zvalue & 6.81295139521853\\
\hline
\rowcolor{gray!6}  sexMale\_zvalue & 6.49159323361366\\
\hline
hgt0\_zvalue & 8.96963990141069\\
\hline
\rowcolor{gray!6}  wgt0\_zvalue & 3.7840018472164\\
\hline
(Intercept)\_Pr(>|z|) & 3.4423766196876e-125\\
\hline
\rowcolor{gray!6}  prot\_Pr(>|z|) & 9.56164541643828e-12\\
\hline
sexMale\_Pr(>|z|) & 8.49333228172763e-11\\
\hline
\rowcolor{gray!6}  hgt0\_Pr(>|z|) & 2.97485394526792e-19\\
\hline
wgt0\_Pr(>|z|) & 0.000154326676608523\\
\hline
\rowcolor{gray!6}  Weakinstruments\_df1 & 1\\
\hline
Wu-Hausman\_df1 & 1\\
\hline
\rowcolor{gray!6}  Sargan\_df1 & 0\\
\hline
Weakinstruments\_df2 & 16394\\
\hline
\rowcolor{gray!6}  Wu-Hausman\_df2 & 16393\\
\hline
Weakinstruments\_statistic & 935.817456612075\\
\hline
\rowcolor{gray!6}  Wu-Hausman\_statistic & 123.595856606729\\
\hline
Weakinstruments\_p-value & 6.39714929178024e-200\\
\hline
\rowcolor{gray!6}  Wu-Hausman\_p-value & 1.30703637796748e-28\\
\hline
vars\_var.y & hgt\\
\hline
\rowcolor{gray!6}  vars\_vars.x & prot\\
\hline
vars\_vars.z & momEdu\\
\hline
\rowcolor{gray!6}  vars\_vars.c & sex+hgt0+wgt0\\
\hline
\end{tabular}
\end{table}

\hypertarget{example-multiple-instrucments}{%
\paragraph{Example Multiple Instrucments}\label{example-multiple-instrucments}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Multiple Instrucments}
\NormalTok{var.y \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}hgt\textquotesingle{}}\NormalTok{)}
\NormalTok{vars.x \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}prot\textquotesingle{}}\NormalTok{)}
\NormalTok{vars.z \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}momEdu\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}wealthIdx\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}p.A.prot\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}p.A.nProt\textquotesingle{}}\NormalTok{)}
\NormalTok{vars.c \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}sex\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}hgt0\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}wgt0\textquotesingle{}}\NormalTok{)}
\CommentTok{\# Regression}
\KeywordTok{regf.iv}\NormalTok{(var.y, vars.x, vars.c, vars.z, df, }\DataTypeTok{transpose=}\OtherTok{FALSE}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{l|l}
\hline
esti.val & value\\
\hline
\rowcolor{gray!6}  (Intercept)\_Estimate & 42.2437613555242\\
\hline
prot\_Estimate & 0.26699945194704\\
\hline
\rowcolor{gray!6}  sexMale\_Estimate & 0.695548488812932\\
\hline
hgt0\_Estimate & 0.424954881263031\\
\hline
\rowcolor{gray!6}  wgt0\_Estimate & 0.000486951420329484\\
\hline
(Intercept)\_Std.Error & 1.85356686789642\\
\hline
\rowcolor{gray!6}  prot\_Std.Error & 0.0154939347964083\\
\hline
sexMale\_Std.Error & 0.133157977814374\\
\hline
\rowcolor{gray!6}  hgt0\_Std.Error & 0.0463195803786233\\
\hline
wgt0\_Std.Error & 0.000224867994873235\\
\hline
\rowcolor{gray!6}  (Intercept)\_zvalue & 22.7905246296649\\
\hline
prot\_zvalue & 17.2325142357597\\
\hline
\rowcolor{gray!6}  sexMale\_zvalue & 5.22348341593581\\
\hline
hgt0\_zvalue & 9.17441129192849\\
\hline
\rowcolor{gray!6}  wgt0\_zvalue & 2.16549901022595\\
\hline
(Intercept)\_Pr(>|z|) & 5.69294074735747e-115\\
\hline
\rowcolor{gray!6}  prot\_Pr(>|z|) & 1.51424021931607e-66\\
\hline
sexMale\_Pr(>|z|) & 1.75588197502565e-07\\
\hline
\rowcolor{gray!6}  hgt0\_Pr(>|z|) & 4.54048595587756e-20\\
\hline
wgt0\_Pr(>|z|) & 0.030349491114332\\
\hline
\rowcolor{gray!6}  Weakinstruments\_df1 & 4\\
\hline
Wu-Hausman\_df1 & 1\\
\hline
\rowcolor{gray!6}  Sargan\_df1 & 3\\
\hline
Weakinstruments\_df2 & 14914\\
\hline
\rowcolor{gray!6}  Wu-Hausman\_df2 & 14916\\
\hline
Weakinstruments\_statistic & 274.147084958343\\
\hline
\rowcolor{gray!6}  Wu-Hausman\_statistic & 17.7562545747101\\
\hline
Sargan\_statistic & 463.729664547249\\
\hline
\rowcolor{gray!6}  Weakinstruments\_p-value & 8.61731956233366e-228\\
\hline
Wu-Hausman\_p-value & 2.52567249124181e-05\\
\hline
\rowcolor{gray!6}  Sargan\_p-value & 3.45452874915475e-100\\
\hline
vars\_var.y & hgt\\
\hline
\rowcolor{gray!6}  vars\_vars.x & prot\\
\hline
vars\_vars.z & momEdu+wealthIdx+p.A.prot+p.A.nProt\\
\hline
\rowcolor{gray!6}  vars\_vars.c & sex+hgt0+wgt0\\
\hline
\end{tabular}
\end{table}

\hypertarget{example-multiple-endogenous-variables}{%
\paragraph{Example Multiple Endogenous Variables}\label{example-multiple-endogenous-variables}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Multiple Instrucments}
\NormalTok{var.y \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}hgt\textquotesingle{}}\NormalTok{)}
\NormalTok{vars.x \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}prot\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}cal\textquotesingle{}}\NormalTok{)}
\NormalTok{vars.z \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}momEdu\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}wealthIdx\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}p.A.prot\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}p.A.nProt\textquotesingle{}}\NormalTok{)}
\NormalTok{vars.c \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}sex\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}hgt0\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}wgt0\textquotesingle{}}\NormalTok{)}
\CommentTok{\# Regression}
\KeywordTok{regf.iv}\NormalTok{(var.y, vars.x, vars.c, vars.z, df, }\DataTypeTok{transpose=}\OtherTok{FALSE}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{l|l}
\hline
esti.val & value\\
\hline
\rowcolor{gray!6}  (Intercept)\_Estimate & 44.0243196254297\\
\hline
prot\_Estimate & -1.4025623247106\\
\hline
\rowcolor{gray!6}  cal\_Estimate & 0.065104895750151\\
\hline
sexMale\_Estimate & 0.120832787571818\\
\hline
\rowcolor{gray!6}  hgt0\_Estimate & 0.286525437984517\\
\hline
wgt0\_Estimate & 0.000850481389651033\\
\hline
\rowcolor{gray!6}  (Intercept)\_Std.Error & 2.75354847244082\\
\hline
prot\_Std.Error & 0.198640060273635\\
\hline
\rowcolor{gray!6}  cal\_Std.Error & 0.00758881298880996\\
\hline
sexMale\_Std.Error & 0.209984580636303\\
\hline
\rowcolor{gray!6}  hgt0\_Std.Error & 0.0707828182888255\\
\hline
wgt0\_Std.Error & 0.00033711210444429\\
\hline
\rowcolor{gray!6}  (Intercept)\_zvalue & 15.9882130516502\\
\hline
prot\_zvalue & -7.06082309267581\\
\hline
\rowcolor{gray!6}  cal\_zvalue & 8.57906181719737\\
\hline
sexMale\_zvalue & 0.575436478267434\\
\hline
\rowcolor{gray!6}  hgt0\_zvalue & 4.04795181812859\\
\hline
wgt0\_zvalue & 2.52284441418383\\
\hline
\rowcolor{gray!6}  (Intercept)\_Pr(>|z|) & 1.54396598126854e-57\\
\hline
prot\_Pr(>|z|) & 1.65519210848649e-12\\
\hline
\rowcolor{gray!6}  cal\_Pr(>|z|) & 9.56500648203187e-18\\
\hline
sexMale\_Pr(>|z|) & 0.564996139463599\\
\hline
\rowcolor{gray!6}  hgt0\_Pr(>|z|) & 5.16677787108928e-05\\
\hline
wgt0\_Pr(>|z|) & 0.0116409892837831\\
\hline
\rowcolor{gray!6}  Weakinstruments(prot)\_df1 & 4\\
\hline
Weakinstruments(cal)\_df1 & 4\\
\hline
\rowcolor{gray!6}  Wu-Hausman\_df1 & 2\\
\hline
Sargan\_df1 & 2\\
\hline
\rowcolor{gray!6}  Weakinstruments(prot)\_df2 & 14914\\
\hline
Weakinstruments(cal)\_df2 & 14914\\
\hline
\rowcolor{gray!6}  Wu-Hausman\_df2 & 14914\\
\hline
Weakinstruments(prot)\_statistic & 274.147084958343\\
\hline
\rowcolor{gray!6}  Weakinstruments(cal)\_statistic & 315.036848606231\\
\hline
Wu-Hausman\_statistic & 94.7020085425169\\
\hline
\rowcolor{gray!6}  Sargan\_statistic & 122.081979628898\\
\hline
Weakinstruments(prot)\_p-value & 8.61731956233366e-228\\
\hline
\rowcolor{gray!6}  Weakinstruments(cal)\_p-value & 1.18918641220866e-260\\
\hline
Wu-Hausman\_p-value & 1.35024050408262e-41\\
\hline
\rowcolor{gray!6}  Sargan\_p-value & 3.09196773720398e-27\\
\hline
vars\_var.y & hgt\\
\hline
\rowcolor{gray!6}  vars\_vars.x & prot+cal\\
\hline
vars\_vars.z & momEdu+wealthIdx+p.A.prot+p.A.nProt\\
\hline
\rowcolor{gray!6}  vars\_vars.c & sex+hgt0+wgt0\\
\hline
\end{tabular}
\end{table}

\hypertarget{examples-line-by-line}{%
\paragraph{Examples Line by Line}\label{examples-line-by-line}}

The examples are just to test the code with different types of variables.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Selecting Variables}
\NormalTok{var.y \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}hgt\textquotesingle{}}\NormalTok{)}
\NormalTok{vars.x \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}prot\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}cal\textquotesingle{}}\NormalTok{)}
\NormalTok{vars.z \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}momEdu\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}wealthIdx\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}p.A.prot\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}p.A.nProt\textquotesingle{}}\NormalTok{)}
\NormalTok{vars.c \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}sex\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}hgt0\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}wgt0\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# A. create Equation}
\NormalTok{str.vars.x \textless{}{-}}\StringTok{ }\KeywordTok{paste}\NormalTok{(vars.x, }\DataTypeTok{collapse=}\StringTok{\textquotesingle{}+\textquotesingle{}}\NormalTok{)}
\NormalTok{str.vars.c \textless{}{-}}\StringTok{ }\KeywordTok{paste}\NormalTok{(vars.c, }\DataTypeTok{collapse=}\StringTok{\textquotesingle{}+\textquotesingle{}}\NormalTok{)}
\NormalTok{str.vars.z \textless{}{-}}\StringTok{ }\KeywordTok{paste}\NormalTok{(vars.z, }\DataTypeTok{collapse=}\StringTok{\textquotesingle{}+\textquotesingle{}}\NormalTok{)}
\KeywordTok{print}\NormalTok{(str.vars.x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "prot+cal"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(str.vars.c)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "sex+hgt0+wgt0"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(str.vars.z)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "momEdu+wealthIdx+p.A.prot+p.A.nProt"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{equa.iv \textless{}{-}}\StringTok{ }\KeywordTok{paste}\NormalTok{(var.y,}
                 \KeywordTok{paste}\NormalTok{(}\KeywordTok{paste}\NormalTok{(str.vars.x, str.vars.c, }\DataTypeTok{sep=}\StringTok{\textquotesingle{}+\textquotesingle{}}\NormalTok{),}
                       \KeywordTok{paste}\NormalTok{(str.vars.z, str.vars.c, }\DataTypeTok{sep=}\StringTok{\textquotesingle{}+\textquotesingle{}}\NormalTok{),}
                       \DataTypeTok{sep=}\StringTok{\textquotesingle{}|\textquotesingle{}}\NormalTok{),}
                 \DataTypeTok{sep=}\StringTok{\textquotesingle{}\textasciitilde{}\textquotesingle{}}\NormalTok{)}
\KeywordTok{print}\NormalTok{(equa.iv)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "hgt~prot+cal+sex+hgt0+wgt0|momEdu+wealthIdx+p.A.prot+p.A.nProt+sex+hgt0+wgt0"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# B. regression}
\NormalTok{res.ivreg \textless{}{-}}\StringTok{ }\KeywordTok{ivreg}\NormalTok{(}\KeywordTok{as.formula}\NormalTok{(equa.iv), }\DataTypeTok{data=}\NormalTok{df)}
\KeywordTok{coef}\NormalTok{(res.ivreg)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   (Intercept)          prot           cal       sexMale          hgt0          wgt0 
## 44.0243196254 -1.4025623247  0.0651048958  0.1208327876  0.2865254380  0.0008504814
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# C. Regression Summary}
\NormalTok{ivreg.summ \textless{}{-}}\StringTok{ }\KeywordTok{summary}\NormalTok{(res.ivreg, }\DataTypeTok{vcov =}\NormalTok{ sandwich, }\DataTypeTok{df =} \OtherTok{Inf}\NormalTok{, }\DataTypeTok{diagnostics =} \OtherTok{TRUE}\NormalTok{)}

\NormalTok{ivreg.summ}\OperatorTok{$}\NormalTok{coef}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                  Estimate   Std. Error    z value     Pr(>|z|)
## (Intercept) 44.0243196254 2.7535484724 15.9882131 1.543966e-57
## prot        -1.4025623247 0.1986400603 -7.0608231 1.655192e-12
## cal          0.0651048958 0.0075888130  8.5790618 9.565006e-18
## sexMale      0.1208327876 0.2099845806  0.5754365 5.649961e-01
## hgt0         0.2865254380 0.0707828183  4.0479518 5.166778e-05
## wgt0         0.0008504814 0.0003371121  2.5228444 1.164099e-02
## attr(,"df")
## [1] 0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ivreg.summ}\OperatorTok{$}\NormalTok{diagnostics}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                         df1   df2 statistic       p-value
## Weak instruments (prot)   4 14914 274.14708 8.617320e-228
## Weak instruments (cal)    4 14914 315.03685 1.189186e-260
## Wu-Hausman                2 14914  94.70201  1.350241e-41
## Sargan                    2    NA 122.08198  3.091968e-27
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# D. Combine Regression Results into a Matrix}
\NormalTok{df.results \textless{}{-}}\StringTok{ }\KeywordTok{suppressMessages}\NormalTok{(}\KeywordTok{as\_tibble}\NormalTok{(ivreg.summ}\OperatorTok{$}\NormalTok{coef, }\DataTypeTok{rownames=}\StringTok{\textquotesingle{}rownames\textquotesingle{}}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{full\_join}\NormalTok{(}\KeywordTok{as\_tibble}\NormalTok{(ivreg.summ}\OperatorTok{$}\NormalTok{diagnostics, }\DataTypeTok{rownames=}\StringTok{\textquotesingle{}rownames\textquotesingle{}}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{full\_join}\NormalTok{(}\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{rownames=}\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}vars\textquotesingle{}}\NormalTok{),}
                     \DataTypeTok{var.y=}\NormalTok{var.y,}
                     \DataTypeTok{vars.x=}\NormalTok{str.vars.x,}
                     \DataTypeTok{vars.z=}\NormalTok{str.vars.z,}
                     \DataTypeTok{vars.c=}\NormalTok{str.vars.c)))}
\CommentTok{\# E. Flatten Matrix, All IV results as a single tibble row to be combined with other IV results}
\NormalTok{df.row.results \textless{}{-}}\StringTok{ }\NormalTok{df.results }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{gather}\NormalTok{(variable, value, }\OperatorTok{{-}}\NormalTok{rownames) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{drop\_na}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{unite}\NormalTok{(esti.val, rownames, variable) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{esti.val =} \KeywordTok{gsub}\NormalTok{(}\StringTok{\textquotesingle{} \textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{, esti.val))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# F. Results as Single Colum}
\CommentTok{\# df.row.results}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# G. Results as Single Row}
\CommentTok{\# df.row.results}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# t(df.row.results \%\textgreater{}\% spread(esti.val, value)) \%\textgreater{}\%}
\CommentTok{\#   kable() \%\textgreater{}\%}
\CommentTok{\#   kable\_styling\_fc\_wide()}
\end{Highlighting}
\end{Shaded}

\hypertarget{iv-loop-over-rhs}{%
\subsection{IV Loop over RHS}\label{iv-loop-over-rhs}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

Regression with a Variety of Outcome Variables and Right Hand Side Variables. There are M outcome variables, and there are N alternative right hand side variables. Regress each M outcome variable and each N alternative right hand side variable, with some common sets of controls and perhaps shared instruments. The output file is a M by N matrix of coefficients, with proper variable names and row names. The matrix stores coefficients for this key endogenous variable.

\begin{itemize}
\tightlist
\item
  Dependency: \emph{R4Econ/linreg/ivreg/ivregdfrow.R}
\end{itemize}

\hypertarget{construct-program-1}{%
\subsubsection{Construct Program}\label{construct-program-1}}

The program relies on double lapply. lapply is used for convenience, not speed.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ff\_reg\_mbyn \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(list.vars.y, list.vars.x,}
\NormalTok{                        vars.c, vars.z, df,}
                        \DataTypeTok{return\_all =} \OtherTok{FALSE}\NormalTok{,}
                        \DataTypeTok{stats\_ends =} \StringTok{\textquotesingle{}value\textquotesingle{}}\NormalTok{, }\DataTypeTok{time =} \OtherTok{FALSE}\NormalTok{) \{}

  \CommentTok{\# regf.iv() function is from C:\textbackslash{}Users\textbackslash{}fan\textbackslash{}R4Econ\textbackslash{}linreg\textbackslash{}ivreg\textbackslash{}ivregdfrow.R}
  \ControlFlowTok{if}\NormalTok{ (time) \{}
\NormalTok{    start\_time \textless{}{-}}\StringTok{ }\KeywordTok{Sys.time}\NormalTok{()}
\NormalTok{  \}}

  \ControlFlowTok{if}\NormalTok{ (return\_all) \{}
\NormalTok{    df.reg.out.all \textless{}{-}}
\StringTok{      }\KeywordTok{bind\_rows}\NormalTok{(}\KeywordTok{lapply}\NormalTok{(list.vars.x,}
                       \ControlFlowTok{function}\NormalTok{(x) (}
                         \KeywordTok{bind\_rows}\NormalTok{(}
                           \KeywordTok{lapply}\NormalTok{(list.vars.y, regf.iv,}
                                  \DataTypeTok{vars.x=}\NormalTok{x, }\DataTypeTok{vars.c=}\NormalTok{vars.c, }\DataTypeTok{vars.z=}\NormalTok{vars.z, }\DataTypeTok{df=}\NormalTok{df))}
\NormalTok{                       )))}

\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{    df.reg.out.all \textless{}{-}}
\StringTok{      }\NormalTok{(}\KeywordTok{lapply}\NormalTok{(list.vars.x,}
              \ControlFlowTok{function}\NormalTok{(x) (}
                \KeywordTok{bind\_rows}\NormalTok{(}
                  \KeywordTok{lapply}\NormalTok{(list.vars.y, regf.iv,}
                         \DataTypeTok{vars.x=}\NormalTok{x, }\DataTypeTok{vars.c=}\NormalTok{vars.c, }\DataTypeTok{vars.z=}\NormalTok{vars.z, }\DataTypeTok{df=}\NormalTok{df)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{                  }\KeywordTok{select}\NormalTok{(vars\_var.y, }\KeywordTok{starts\_with}\NormalTok{(x)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{                  }\KeywordTok{select}\NormalTok{(vars\_var.y, }\KeywordTok{ends\_with}\NormalTok{(stats\_ends))}
\NormalTok{              ))) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{reduce}\NormalTok{(full\_join)}
\NormalTok{  \}}

  \ControlFlowTok{if}\NormalTok{ (time) \{}
\NormalTok{    end\_time \textless{}{-}}\StringTok{ }\KeywordTok{Sys.time}\NormalTok{()}
    \KeywordTok{print}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}Estimation for all ys and xs took (seconds):\textquotesingle{}}\NormalTok{,}
\NormalTok{                 end\_time }\OperatorTok{{-}}\StringTok{ }\NormalTok{start\_time))}
\NormalTok{  \}}

  \KeywordTok{return}\NormalTok{(df.reg.out.all)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{prepare-data}{%
\subsubsection{Prepare Data}\label{prepare-data}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Library}
\KeywordTok{library}\NormalTok{(tidyverse)}
\KeywordTok{library}\NormalTok{(AER)}

\CommentTok{\# Load Sample Data}
\KeywordTok{setwd}\NormalTok{(}\StringTok{\textquotesingle{}C:/Users/fan/R4Econ/\_data/\textquotesingle{}}\NormalTok{)}
\NormalTok{df \textless{}{-}}\StringTok{ }\KeywordTok{read\_csv}\NormalTok{(}\StringTok{\textquotesingle{}height\_weight.csv\textquotesingle{}}\NormalTok{)}

\CommentTok{\# Source Dependency}
\KeywordTok{source}\NormalTok{(}\StringTok{\textquotesingle{}C:/Users/fan/R4Econ/linreg/ivreg/ivregdfrow.R\textquotesingle{}}\NormalTok{)}

\CommentTok{\# Setting}
\KeywordTok{options}\NormalTok{(}\DataTypeTok{repr.matrix.max.rows=}\DecValTok{50}\NormalTok{, }\DataTypeTok{repr.matrix.max.cols=}\DecValTok{50}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Parameters.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{var.y1 \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}hgt\textquotesingle{}}\NormalTok{)}
\NormalTok{var.y2 \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}wgt\textquotesingle{}}\NormalTok{)}
\NormalTok{var.y3 \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}vil.id\textquotesingle{}}\NormalTok{)}
\NormalTok{list.vars.y \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(var.y1, var.y2, var.y3)}

\NormalTok{var.x1 \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}prot\textquotesingle{}}\NormalTok{)}
\NormalTok{var.x2 \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}cal\textquotesingle{}}\NormalTok{)}
\NormalTok{var.x3 \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}wealthIdx\textquotesingle{}}\NormalTok{)}
\NormalTok{var.x4 \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}p.A.prot\textquotesingle{}}\NormalTok{)}
\NormalTok{var.x5 \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}p.A.nProt\textquotesingle{}}\NormalTok{)}
\NormalTok{list.vars.x \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(var.x1, var.x2, var.x3, var.x4, var.x5)}

\NormalTok{vars.z \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}indi.id\textquotesingle{}}\NormalTok{)}
\NormalTok{vars.c \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}sex\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}wgt0\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}hgt0\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}svymthRound\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{program-testing-1}{%
\subsubsection{Program Testing}\label{program-testing-1}}

\hypertarget{test-program-ols-z-stat}{%
\paragraph{Test Program OLS Z-Stat}\label{test-program-ols-z-stat}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vars.z \textless{}{-}}\StringTok{ }\OtherTok{NULL}
\KeywordTok{suppressWarnings}\NormalTok{(}\KeywordTok{suppressMessages}\NormalTok{(}
  \KeywordTok{ff\_reg\_mbyn}\NormalTok{(list.vars.y, list.vars.x,}
\NormalTok{              vars.c, vars.z, df,}
              \DataTypeTok{return\_all =} \OtherTok{FALSE}\NormalTok{,}
              \DataTypeTok{stats\_ends =} \StringTok{\textquotesingle{}value\textquotesingle{}}\NormalTok{))) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{l|l|l|l|l|l}
\hline
vars\_var.y & prot\_tvalue & cal\_tvalue & wealthIdx\_tvalue & p.A.prot\_tvalue & p.A.nProt\_tvalue\\
\hline
\rowcolor{gray!6}  hgt & 18.8756010031786 & 23.4421863484661 & 13.508899618216 & 3.83682180045518 & 32.5448257554855\\
\hline
wgt & 16.3591125056062 & 17.3686031309332 & 14.1390521528113 & 1.36958319982295 & 12.0961557911467\\
\hline
\rowcolor{gray!6}  vil.id & -14.9385580468907 & -19.6150110809452 & 34.0972558327347 & 8.45943342783186 & 17.7801422421419\\
\hline
\end{tabular}}
\end{table}

\hypertarget{test-program-iv-t-stat}{%
\paragraph{Test Program IV T-stat}\label{test-program-iv-t-stat}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vars.z \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}indi.id\textquotesingle{}}\NormalTok{)}
\KeywordTok{suppressWarnings}\NormalTok{(}\KeywordTok{suppressMessages}\NormalTok{(}
  \KeywordTok{ff\_reg\_mbyn}\NormalTok{(list.vars.y, list.vars.x,}
\NormalTok{              vars.c, vars.z, df,}
              \DataTypeTok{return\_all =} \OtherTok{FALSE}\NormalTok{,}
              \DataTypeTok{stats\_ends =} \StringTok{\textquotesingle{}value\textquotesingle{}}\NormalTok{))) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{l|l|l|l|l|l}
\hline
vars\_var.y & prot\_zvalue & cal\_zvalue & wealthIdx\_zvalue & p.A.prot\_zvalue & p.A.nProt\_zvalue\\
\hline
\rowcolor{gray!6}  hgt & 8.87674929300964 & 12.0739764947235 & 4.62589553677969 & 26.6373587567312 & 32.1162192385744\\
\hline
wgt & 5.60385871756365 & 6.1225187008946 & 5.17869536991717 & 11.9295584469998 & 12.3509307017263\\
\hline
\rowcolor{gray!6}  vil.id & -9.22106223347162 & -13.0586007975839 & -51.5866689219593 & -29.9627476577329 & -38.3528894620707\\
\hline
\end{tabular}}
\end{table}

\hypertarget{test-program-ols-coefficient}{%
\paragraph{Test Program OLS Coefficient}\label{test-program-ols-coefficient}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vars.z \textless{}{-}}\StringTok{ }\OtherTok{NULL}
\KeywordTok{suppressWarnings}\NormalTok{(}\KeywordTok{suppressMessages}\NormalTok{(}
  \KeywordTok{ff\_reg\_mbyn}\NormalTok{(list.vars.y, list.vars.x,}
\NormalTok{              vars.c, vars.z, df,}
              \DataTypeTok{return\_all =} \OtherTok{FALSE}\NormalTok{,}
              \DataTypeTok{stats\_ends =} \StringTok{\textquotesingle{}Estimate\textquotesingle{}}\NormalTok{))) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{l|l|l|l|l|l}
\hline
vars\_var.y & prot\_Estimate & cal\_Estimate & wealthIdx\_Estimate & p.A.prot\_Estimate & p.A.nProt\_Estimate\\
\hline
\rowcolor{gray!6}  hgt & 0.049431093806755 & 0.00243408846205622 & 0.21045655488185 & 3.86952250259526e-05 & 0.00542428867316449\\
\hline
wgt & 16.5557424523585 & 0.699072500364623 & 106.678721085969 & 0.00521731297924587 & 0.779514232050632\\
\hline
\rowcolor{gray!6}  vil.id & -0.0758835879205584 & -0.00395676177098486 & 0.451733304543324 & 0.000149388430455142 & 0.00526237555581024\\
\hline
\end{tabular}}
\end{table}

\hypertarget{test-program-iv-coefficient}{%
\paragraph{Test Program IV coefficient}\label{test-program-iv-coefficient}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vars.z \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}indi.id\textquotesingle{}}\NormalTok{)}
\KeywordTok{suppressWarnings}\NormalTok{(}\KeywordTok{suppressMessages}\NormalTok{(}
  \KeywordTok{ff\_reg\_mbyn}\NormalTok{(list.vars.y, list.vars.x,}
\NormalTok{              vars.c, vars.z, df,}
              \DataTypeTok{return\_all =} \OtherTok{FALSE}\NormalTok{,}
              \DataTypeTok{stats\_ends =} \StringTok{\textquotesingle{}Estimate\textquotesingle{}}\NormalTok{))) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{l|l|l|l|l|l}
\hline
vars\_var.y & prot\_Estimate & cal\_Estimate & wealthIdx\_Estimate & p.A.prot\_Estimate & p.A.nProt\_Estimate\\
\hline
\rowcolor{gray!6}  hgt & 0.859205733632614 & 0.0238724384575419 & 0.144503490136948 & 0.00148073028434642 & 0.0141317656200726\\
\hline
wgt & 98.9428234201406 & 2.71948246216953 & 69.1816142883022 & 0.221916473012486 & 2.11856940494335\\
\hline
\rowcolor{gray!6}  vil.id & -6.02451379136132 & -0.168054407187466 & -1.91414470908345 & -0.00520794333267238 & -0.0494468877742109\\
\hline
\end{tabular}}
\end{table}

\hypertarget{test-program-ols-return-all}{%
\paragraph{Test Program OLS Return All}\label{test-program-ols-return-all}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vars.z \textless{}{-}}\StringTok{ }\OtherTok{NULL}
\KeywordTok{t}\NormalTok{(}\KeywordTok{suppressWarnings}\NormalTok{(}\KeywordTok{suppressMessages}\NormalTok{(}
  \KeywordTok{ff\_reg\_mbyn}\NormalTok{(list.vars.y, list.vars.x,}
\NormalTok{            vars.c, vars.z, df,}
            \DataTypeTok{return\_all =} \OtherTok{TRUE}\NormalTok{,}
            \DataTypeTok{stats\_ends =} \StringTok{\textquotesingle{}Estimate\textquotesingle{}}\NormalTok{)))) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l}
\hline
X.Intercept.\_Estimate & 27.3528514188608 & 99.873884728925 & 31.4646660224049 & 27.9038445914729 & 219.626705179399 & 30.5103987898551 & 35.7840188807906 & -2662.74787734003 & 29.2381039651127 & 23.9948407749744 & -547.959546430028 & 22.3367814226238 & 24.4904444950827 & -476.703973630552 & 22.7781908464511\\
\hline
\rowcolor{gray!6}  X.Intercept.\_Pr...t.. & 5.68247182214952e-231 & 0.75529705553815 & 6.78164655340399e-84 & 8.24252673989353e-242 & 0.493216914827181 & 1.62608789535248e-79 & 2.26726906489443e-145 & 7.13318862990131e-05 & 1.53578035267873e-124 & 2.11912344053336e-165 & 0.0941551350855875 & 3.04337266226599e-49 & 2.34941965806705e-181 & 0.143844033032183 & 9.58029450711211e-52\\
\hline
X.Intercept.\_Std.Error & 0.831272666092284 & 320.450650378664 & 1.61328519718754 & 0.828072565159449 & 320.522532223672 & 1.60831193651104 & 1.38461348429899 & 670.301542938561 & 1.22602177264147 & 0.86658104216672 & 327.343126852912 & 1.5098937308759 & 0.843371070670838 & 326.132837036936 & 1.5004526558957\\
\hline
\rowcolor{gray!6}  X.Intercept.\_tvalue & 32.9047886867776 & 0.31166697465244 & 19.503474077155 & 33.6973421962119 & 0.685214557790078 & 18.9704485163756 & 25.8440491058106 & -3.97246270039407 & 23.8479483950102 & 27.6890903532576 & -1.6739607509042 & 14.7936116071335 & 29.0387533397398 & -1.46168652614567 & 15.1808794212527\\
\hline
adj.r.squared\_v & 0.814249026159781 & 0.60716936506893 & 0.0373247512680971 & 0.81608922805658 & 0.607863678511207 & 0.0453498711076042 & 0.935014931990565 & 0.92193683733695 & 0.059543122812776 & 0.814690803458616 & 0.617300597776144 & 0.0261131074199838 & 0.824542352656376 & 0.620250730454724 & 0.0385437355117917\\
\hline
\rowcolor{gray!6}  df1\_v & 6 & 6 & 6 & 6 & 6 & 6 & 6 & 6 & 6 & 6 & 6 & 6 & 6 & 6 & 6\\
\hline
df2\_v & 18957 & 18962 & 18999 & 18957 & 18962 & 18999 & 25092 & 25102 & 30013 & 18587 & 18591 & 18845 & 18587 & 18591 & 18845\\
\hline
\rowcolor{gray!6}  df3\_v & 6 & 6 & 6 & 6 & 6 & 6 & 6 & 6 & 6 & 6 & 6 & 6 & 6 & 6 & 6\\
\hline
hgt0\_Estimate & 0.60391817340617 & 56.3852027199184 & -0.296844389234445 & 0.589847843438394 & 52.9707041800704 & -0.273219210757899 & 0.439374451256039 & 47.176969664749 & -0.35908163982046 & 0.687269209411865 & 72.105560623359 & -0.108789161111504 & 0.622395388389206 & 62.7336220289257 & -0.157811627494693\\
\hline
\rowcolor{gray!6}  hgt0\_Pr...t.. & 1.14533314566771e-183 & 1.52417506966835e-12 & 1.40290395213743e-13 & 7.79174951119325e-177 & 3.05720143843395e-11 & 8.49149153665126e-12 & 2.71000479249152e-36 & 0.00520266507060071 & 2.41020063623865e-31 & 1.31914432912869e-220 & 4.78613024244006e-19 & 0.0034801146146182 & 1.11511327164938e-190 & 8.38546282719268e-15 & 2.13723119924676e-05\\
\hline
hgt0\_Std.Error & 0.0206657538633713 & 7.96735224000553 & 0.0401060913799595 & 0.0205836398278421 & 7.96822145797115 & 0.0399777363511633 & 0.0348701896610764 & 16.8823489375743 & 0.0307984635553859 & 0.0213841849324282 & 8.07744906400683 & 0.0372288594891345 & 0.0208846437570215 & 8.07589192978212 & 0.0371223237183417\\
\hline
\rowcolor{gray!6}  hgt0\_tvalue & 29.2231378249683 & 7.0770314931977 & -7.40147890309685 & 28.6561486875877 & 6.64774497790599 & -6.83428417151858 & 12.6002885423502 & 2.79445531182864 & -11.659076407325 & 32.1391351404584 & 8.92677379355593 & -2.92217281443323 & 29.8015803204665 & 7.76801157994423 & -4.25112470577158\\
\hline
prot\_Estimate & 0.049431093806755 & 16.5557424523585 & -0.0758835879205584 & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA\\
\hline
\rowcolor{gray!6}  prot\_Pr...t.. & 9.54769322304645e-79 & 9.61203373222183e-60 & 3.56396093562335e-50 & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA\\
\hline
prot\_Std.Error & 0.00261878251179557 & 1.01201959743751 & 0.00507971302734622 & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA\\
\hline
\rowcolor{gray!6}  prot\_tvalue & 18.8756010031786 & 16.3591125056062 & -14.9385580468907 & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA\\
\hline
r.squared\_v & 0.814298005954592 & 0.607272921412825 & 0.0375780335372857 & 0.816137722617266 & 0.60796705182314 & 0.0456010419476623 & 0.93502787877066 & 0.921952383432195 & 0.0596997716363463 & 0.814740639193486 & 0.617403496088206 & 0.0263714328556815 & 0.824589538985803 & 0.620352835549783 & 0.0387987636986586\\
\hline
\rowcolor{gray!6}  sexMale\_Estimate & 0.935177182449406 & 415.163616765357 & -0.254089999175318 & 0.893484662055608 & 405.534891838028 & -0.181389489610951 & 1.80682463132073 & 999.926876716707 & -0.33436777751525 & 0.932686930233136 & 397.141948675354 & -0.445232370681998 & 0.96466980500711 & 401.59056368102 & -0.423829627017582\\
\hline
sexMale\_Pr...t.. & 2.36432111724607e-51 & 2.48252880290814e-67 & 0.0343768259467621 & 2.08765935335877e-47 & 2.51355675686752e-64 & 0.129768754080748 & 1.26527362032354e-66 & 2.64630894140004e-86 & 0.000311174554787706 & 7.90489020586094e-47 & 6.19449742677662e-59 & 7.93666802281971e-05 & 1.24556615236597e-52 & 1.18469030741261e-60 & 0.00015644693636154\\
\hline
\rowcolor{gray!6}  sexMale\_Std.Error & 0.0618482294097262 & 23.8518341439675 & 0.120093045309631 & 0.0616078355613525 & 23.8567507583516 & 0.11972270545355 & 0.104475287357902 & 50.5879876531386 & 0.0927193334338799 & 0.0647209948973267 & 24.4473730956481 & 0.112797805327952 & 0.0629827627260302 & 24.3549086073387 & 0.112083516545945\\
\hline
sexMale\_tvalue & 15.1205166481668 & 17.4059409544552 & -2.11577613441484 & 14.5027763743757 & 16.9987478993157 & -1.51508010885476 & 17.2942776901016 & 19.7660931597596 & -3.60623577771614 & 14.4108867873979 & 16.2447698213453 & -3.94717228218682 & 15.316409812052 & 16.4891016491029 & -3.78137339083082\\
\hline
\rowcolor{gray!6}  sigma\_v & 4.21029844914315 & 1623.77111076428 & 8.18491760066961 & 4.18939119979502 & 1622.33549880859 & 8.15073036560541 & 8.18607049768594 & 3964.45339913597 & 7.93450742809862 & 4.35662621773428 & 1645.77655955938 & 7.6435668370875 & 4.23923961592693 & 1639.42085007515 & 7.59462918474114\\
\hline
svymthRound\_Estimate & 0.87166589100565 & 189.04290688382 & -0.0154759587993917 & 0.851989049736817 & 185.318286001897 & 0.0201471237605442 & 0.432815253441723 & 189.877994795061 & 0.00215144302579706 & 0.91961467696139 & 205.597385664745 & -0.0509574460702806 & 0.921894094780682 & 205.945143306004 & -0.0557204455206461\\
\hline
\rowcolor{gray!6}  svymthRound\_Pr...t.. & 0 & 0 & 0.0397984032097113 & 0 & 0 & 0.0117151185126433 & 0 & 0 & 0.000447277200167272 & 0 & 0 & 1.37139389802397e-18 & 0 & 0 & 7.79141497751766e-23\\
\hline
svymthRound\_Std.Error & 0.00387681209575621 & 1.4955473831309 & 0.00752730297891317 & 0.00411253488213795 & 1.59266949679221 & 0.00799217807522278 & 0.000728323735328998 & 0.352701518968252 & 0.000612792699568233 & 0.00331108017589107 & 1.25083486490652 & 0.00578476859618168 & 0.00317113547025635 & 1.22639878616071 & 0.00565696328562864\\
\hline
\rowcolor{gray!6}  svymthRound\_tvalue & 224.840892330022 & 126.403823119306 & -2.05597660181154 & 207.168832400006 & 116.357025971267 & 2.52085521254888 & 594.262183761197 & 538.353209678558 & 3.51088227277012 & 277.738571133786 & 164.368128386085 & -8.80889965139067 & 290.714194782148 & 167.926734460268 & -9.84988636256528\\
\hline
vars\_var.y & hgt & wgt & vil.id & hgt & wgt & vil.id & hgt & wgt & vil.id & hgt & wgt & vil.id & hgt & wgt & vil.id\\
\hline
\rowcolor{gray!6}  vars\_vars.c & sex+wgt0+hgt0+svymthRound & sex+wgt0+hgt0+svymthRound & sex+wgt0+hgt0+svymthRound & sex+wgt0+hgt0+svymthRound & sex+wgt0+hgt0+svymthRound & sex+wgt0+hgt0+svymthRound & sex+wgt0+hgt0+svymthRound & sex+wgt0+hgt0+svymthRound & sex+wgt0+hgt0+svymthRound & sex+wgt0+hgt0+svymthRound & sex+wgt0+hgt0+svymthRound & sex+wgt0+hgt0+svymthRound & sex+wgt0+hgt0+svymthRound & sex+wgt0+hgt0+svymthRound & sex+wgt0+hgt0+svymthRound\\
\hline
vars\_vars.x & prot & prot & prot & cal & cal & cal & wealthIdx & wealthIdx & wealthIdx & p.A.prot & p.A.prot & p.A.prot & p.A.nProt & p.A.nProt & p.A.nProt\\
\hline
\rowcolor{gray!6}  wgt0\_Estimate & -0.000146104685986986 & 0.637023553461055 & -0.000903390591533867 & -0.000116898230009949 & 0.649394003614758 & -0.000941137072743919 & 0.00122231975126219 & 1.32870822160235 & -0.000845938526704796 & -0.000489534836079617 & 0.580023505722658 & -0.00156196911156061 & 3.23596154259101e-05 & 0.65551206304675 & -0.00115432723977403\\
\hline
wgt0\_Pr...t.. & 0.136011583497549 & 2.96480083692757e-63 & 2.05763549729273e-06 & 0.230228828649018 & 7.43034302413852e-66 & 6.66901196231733e-07 & 1.22269348058816e-13 & 6.75367630221077e-62 & 4.32675510884621e-09 & 7.77000489086602e-07 & 7.42419220783427e-54 & 1.40362012201826e-19 & 0.740027016459552 & 4.09082062947785e-67 & 2.75472781728448e-11\\
\hline
\rowcolor{gray!6}  wgt0\_Std.Error & 9.79994437486573e-05 & 0.0378027371614794 & 0.000190221503167431 & 9.74307633896921e-05 & 0.037739875283113 & 0.000189270503626621 & 0.000164767846917989 & 0.0798131859486402 & 0.000144040382619518 & 9.90410500454311e-05 & 0.0374185042114355 & 0.000172365145002826 & 9.75208524392668e-05 & 0.0377202854835204 & 0.000173241059789276\\
\hline
wgt0\_tvalue & -1.49087260496811 & 16.8512547316329 & -4.74915073475531 & -1.19980821193398 & 17.2071051836606 & -4.97244448929308 & 7.41843614592224 & 16.6477281392748 & -5.872926128913 & -4.94274682926991 & 15.5009805428138 & -9.0619777654873 & 0.331822524275644 & 17.3782370584956 & -6.66312732777158\\
\hline
\rowcolor{gray!6}  cal\_Estimate & NA & NA & NA & 0.00243408846205622 & 0.699072500364623 & -0.00395676177098486 & NA & NA & NA & NA & NA & NA & NA & NA & NA\\
\hline
cal\_Pr...t.. & NA & NA & NA & 8.01672708877986e-120 & 4.71331900885298e-67 & 7.94646124029527e-85 & NA & NA & NA & NA & NA & NA & NA & NA & NA\\
\hline
\rowcolor{gray!6}  cal\_Std.Error & NA & NA & NA & 0.000103833679413418 & 0.0402492068645167 & 0.000201721108117477 & NA & NA & NA & NA & NA & NA & NA & NA & NA\\
\hline
cal\_tvalue & NA & NA & NA & 23.4421863484661 & 17.3686031309332 & -19.6150110809452 & NA & NA & NA & NA & NA & NA & NA & NA & NA\\
\hline
\rowcolor{gray!6}  wealthIdx\_Estimate & NA & NA & NA & NA & NA & NA & 0.21045655488185 & 106.678721085969 & 0.451733304543324 & NA & NA & NA & NA & NA & NA\\
\hline
wealthIdx\_Pr...t.. & NA & NA & NA & NA & NA & NA & 1.93494257274268e-41 & 3.2548345535026e-45 & 4.82890644822007e-250 & NA & NA & NA & NA & NA & NA\\
\hline
\rowcolor{gray!6}  wealthIdx\_Std.Error & NA & NA & NA & NA & NA & NA & 0.0155791042075745 & 7.54496977117083 & 0.0132483771350785 & NA & NA & NA & NA & NA & NA\\
\hline
wealthIdx\_tvalue & NA & NA & NA & NA & NA & NA & 13.508899618216 & 14.1390521528113 & 34.0972558327347 & NA & NA & NA & NA & NA & NA\\
\hline
\rowcolor{gray!6}  p.A.prot\_Estimate & NA & NA & NA & NA & NA & NA & NA & NA & NA & 3.86952250259526e-05 & 0.00521731297924587 & 0.000149388430455142 & NA & NA & NA\\
\hline
p.A.prot\_Pr...t.. & NA & NA & NA & NA & NA & NA & NA & NA & NA & 0.000125048896903791 & 0.170833589209346 & 2.88060045451681e-17 & NA & NA & NA\\
\hline
\rowcolor{gray!6}  p.A.prot\_Std.Error & NA & NA & NA & NA & NA & NA & NA & NA & NA & 1.00852286184785e-05 & 0.00380941660201464 & 1.76593895713687e-05 & NA & NA & NA\\
\hline
p.A.prot\_tvalue & NA & NA & NA & NA & NA & NA & NA & NA & NA & 3.83682180045518 & 1.36958319982295 & 8.45943342783186 & NA & NA & NA\\
\hline
\rowcolor{gray!6}  p.A.nProt\_Estimate & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & 0.00542428867316449 & 0.779514232050632 & 0.00526237555581024\\
\hline
p.A.nProt\_Pr...t.. & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & 5.25341325077391e-226 & 1.47950939943836e-33 & 3.7685780281174e-70\\
\hline
\rowcolor{gray!6}  p.A.nProt\_Std.Error & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & 0.000166671307872964 & 0.06444313759758 & 0.000295969260771016\\
\hline
p.A.nProt\_tvalue & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & 32.5448257554855 & 12.0961557911467 & 17.7801422421419\\
\hline
\end{tabular}}
\end{table}

\hypertarget{test-program-iv-return-all}{%
\paragraph{Test Program IV Return All}\label{test-program-iv-return-all}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vars.z \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}indi.id\textquotesingle{}}\NormalTok{)}
\KeywordTok{t}\NormalTok{(}\KeywordTok{suppressWarnings}\NormalTok{(}\KeywordTok{suppressMessages}\NormalTok{(}
  \KeywordTok{ff\_reg\_mbyn}\NormalTok{(list.vars.y, list.vars.x,}
\NormalTok{            vars.c, vars.z, df,}
            \DataTypeTok{return\_all =} \OtherTok{TRUE}\NormalTok{,}
            \DataTypeTok{stats\_ends =} \StringTok{\textquotesingle{}Estimate\textquotesingle{}}\NormalTok{)))) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l}
\hline
X.Intercept.\_Estimate & 40.2173991882938 & 1408.1626637032 & -64.490636067872 & 39.6732302990235 & 1325.54736576331 & -59.8304089440729 & 35.5561817357046 & -2791.221534909 & 21.8005242861645 & 24.3009261707644 & -499.067024090554 & 21.4632286881661 & 25.299209739617 & -352.278518334717 & 17.9359211844992\\
\hline
\rowcolor{gray!6}  X.Intercept.\_Pr...z.. & 3.69748206920405e-59 & 0.00217397545504963 & 0.000109756271656929 & 1.30030240177373e-103 & 0.00138952700443324 & 3.75547414421179e-07 & 2.01357089467444e-142 & 1.95034793045284e-05 & 1.17899313785408e-34 & 1.97968607369592e-84 & 0.155922992163314 & 1.84405333738942e-09 & 1.29388565624566e-157 & 0.287184942021997 & 1.13855583530306e-12\\
\hline
X.Intercept.\_Std.Error & 2.47963650430699 & 459.377029874119 & 16.673099250727 & 1.83545587849039 & 414.645900526211 & 11.7754321198995 & 1.39936229104453 & 653.605248808641 & 1.77547715237629 & 1.2481331128579 & 351.723712333143 & 3.57067054655531 & 0.945826571474308 & 330.990098562619 & 2.52170174723203\\
\hline
\rowcolor{gray!6}  X.Intercept.\_zvalue & 16.2190704639323 & 3.06537456626657 & -3.86794531107106 & 21.6149190857443 & 3.19681772828602 & -5.08095230263053 & 25.4088465605032 & -4.27050048939585 & 12.2786847788984 & 19.4698193008609 & -1.41891776582254 & 6.01097984491234 & 26.748254386829 & -1.0643173915611 & 7.11262590993832\\
\hline
hgt0\_Estimate & 0.403139725681418 & 35.5765914326678 & 1.20995060148712 & 0.357976348180876 & 31.0172706497394 & 1.5037447089682 & 0.460434521499963 & 59.1545587745268 & 0.412512139031067 & 0.515794899569023 & 46.2591615803265 & 0.520812513246773 & 0.510868687340428 & 45.5654716961559 & 0.534362107844268\\
\hline
\rowcolor{gray!6}  hgt0\_Pr...z.. & 1.25009876641748e-13 & 0.000445802636381424 & 0.00097112649404847 & 2.82141265004339e-17 & 0.0013100303315764 & 3.70002169470828e-08 & 2.98739737280869e-37 & 0.000542570320022534 & 3.02226357947691e-20 & 8.57492956381676e-59 & 2.8561488738123e-07 & 1.10039023747789e-08 & 3.24936430168307e-102 & 6.3454545304127e-08 & 3.42500501176006e-17\\
\hline
hgt0\_Std.Error & 0.0543948312973965 & 10.1318250572006 & 0.366789440587685 & 0.0423453726223874 & 9.65135595900306 & 0.273179527952317 & 0.0361031059207763 & 17.1025823111635 & 0.0447499166716409 & 0.0319035514861838 & 9.01263684093548 & 0.0911390672920558 & 0.0237991645877977 & 8.42434865398195 & 0.063380058773461\\
\hline
\rowcolor{gray!6}  hgt0\_zvalue & 7.41136089709158 & 3.51137048180512 & 3.29876072644971 & 8.45373003027063 & 3.21377335801252 & 5.50460248701607 & 12.7533216258548 & 3.45880859967647 & 9.21816552325528 & 16.1673191711084 & 5.13270005180026 & 5.71448149208973 & 21.4658243761363 & 5.40878275196011 & 8.4310762436216\\
\hline
prot\_Estimate & 0.859205733632614 & 98.9428234201406 & -6.02451379136132 & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA\\
\hline
\rowcolor{gray!6}  prot\_Pr...z.. & 6.88427338202428e-19 & 2.09631602352917e-08 & 2.94171378745816e-20 & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA\\
\hline
prot\_Std.Error & 0.0967928354481331 & 17.6561952052848 & 0.653342710289155 & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA\\
\hline
\rowcolor{gray!6}  prot\_zvalue & 8.87674929300964 & 5.60385871756365 & -9.22106223347162 & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA\\
\hline
Sargan\_df1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\
\hline
\rowcolor{gray!6}  sexMale\_Estimate & 0.154043421788007 & 333.799680049259 & 5.41175429817609 & 0.106307556057668 & 330.452608866758 & 5.83118942788808 & 1.80283907885782 & 997.747599807148 & -0.452827875182598 & 1.02741625216018 & 411.365911332896 & -0.789122421167432 & 1.02009164592608 & 409.820707458838 & -0.746032636368145\\
\hline
sexMale\_Pr...z.. & 0.38807812932888 & 5.06413216642981e-24 & 5.80077629932476e-06 & 0.423490075745117 & 2.52735690930834e-27 & 6.12283824664132e-12 & 1.1689328480129e-65 & 2.02347084785411e-89 & 0.000647195788038449 & 1.69796551008584e-27 & 2.05327249429949e-54 & 0.00428270841484855 & 1.70848440093529e-51 & 2.36314216739034e-62 & 6.57521045473888e-05\\
\hline
\rowcolor{gray!6}  sexMale\_Std.Error & 0.178475271469781 & 33.0216035385405 & 1.19371921154418 & 0.132821186086547 & 30.5174257711927 & 0.847955715223327 & 0.105343525210948 & 49.7632792630648 & 0.132754263303719 & 0.0945646985181925 & 26.4822313532216 & 0.276250047248363 & 0.0675715533063635 & 24.5920104216267 & 0.18692145837209\\
\hline
sexMale\_zvalue & 0.86310792817082 & 10.1085242471545 & 4.53352366774387 & 0.800381017440976 & 10.8283251459136 & 6.87676174970095 & 17.113904962338 & 20.0498764266063 & -3.41102322376347 & 10.8646912458831 & 15.5336574870174 & -2.85655126226267 & 15.0964658352764 & 16.6647907361992 & -3.99115565898846\\
\hline
\rowcolor{gray!6}  svymthRound\_Estimate & 0.20990165085783 & 121.78985943172 & 4.84745570027424 & 0.322893837128574 & 135.494858749214 & 4.07024693316581 & 0.433164820953121 & 190.07735139541 & 0.0137438264666969 & 1.00582859923509 & 218.549980922774 & -0.369567838754916 & 0.929266902426869 & 207.078222946319 & -0.0985678389223824\\
\hline
svymthRound\_Pr...z.. & 0.00846239710392287 & 5.96047652813855e-17 & 2.07373887977152e-19 & 9.66146445882893e-11 & 4.48931446042076e-34 & 5.64723572160763e-36 & 0 & 0 & 1.57416908709431e-66 & 0 & 0 & 2.42696379701225e-102 & 0 & 0 & 1.84569897952709e-27\\
\hline
\rowcolor{gray!6}  svymthRound\_Std.Error & 0.0797183179471441 & 14.5577085129475 & 0.538050140685815 & 0.0498896912188091 & 11.133488331472 & 0.325043349284718 & 0.00120472816008751 & 0.739269879490032 & 0.000797655931686456 & 0.00746867714609297 & 1.9315711781906 & 0.0172056989832505 & 0.00539330635998817 & 1.46167854745858 & 0.00907867488118012\\
\hline
svymthRound\_zvalue & 2.63304164291327 & 8.36600480930094 & 9.00930105527994 & 6.47215545416802 & 12.1700274626596 & 12.5221664806331 & 359.553993426746 & 257.11496798237 & 17.2302692435808 & 134.672925279848 & 113.146221785884 & -21.4793853545086 & 172.300040161061 & 141.671520941705 & -10.8570733297996\\
\hline
\rowcolor{gray!6}  vars\_var.y & hgt & wgt & vil.id & hgt & wgt & vil.id & hgt & wgt & vil.id & hgt & wgt & vil.id & hgt & wgt & vil.id\\
\hline
vars\_vars.c & sex+wgt0+hgt0+svymthRound & sex+wgt0+hgt0+svymthRound & sex+wgt0+hgt0+svymthRound & sex+wgt0+hgt0+svymthRound & sex+wgt0+hgt0+svymthRound & sex+wgt0+hgt0+svymthRound & sex+wgt0+hgt0+svymthRound & sex+wgt0+hgt0+svymthRound & sex+wgt0+hgt0+svymthRound & sex+wgt0+hgt0+svymthRound & sex+wgt0+hgt0+svymthRound & sex+wgt0+hgt0+svymthRound & sex+wgt0+hgt0+svymthRound & sex+wgt0+hgt0+svymthRound & sex+wgt0+hgt0+svymthRound\\
\hline
\rowcolor{gray!6}  vars\_vars.x & prot & prot & prot & cal & cal & cal & wealthIdx & wealthIdx & wealthIdx & p.A.prot & p.A.prot & p.A.prot & p.A.nProt & p.A.nProt & p.A.nProt\\
\hline
vars\_vars.z & indi.id & indi.id & indi.id & indi.id & indi.id & indi.id & indi.id & indi.id & indi.id & indi.id & indi.id & indi.id & indi.id & indi.id & indi.id\\
\hline
\rowcolor{gray!6}  Weakinstruments\_df1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1\\
\hline
Weakinstruments\_df2 & 18957 & 18962 & 18999 & 18957 & 18962 & 18999 & 25092 & 25102 & 30013 & 18587 & 18591 & 18845 & 18587 & 18591 & 18845\\
\hline
\rowcolor{gray!6}  Weakinstruments\_p.value & 1.42153759923994e-19 & 4.45734829676713e-19 & 5.72345606957941e-20 & 1.77770827184424e-37 & 4.03760292920738e-37 & 5.47447735093002e-38 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\
\hline
Weakinstruments\_statistic & 82.0931934821266 & 79.8251182827386 & 83.8989817367586 & 164.392129625299 & 162.747072038429 & 166.75260665498 & 7029.47383089383 & 7038.38467113128 & 12942.6315513372 & 1710.98122418591 & 1715.15052113399 & 1725.71954882902 & 5097.88462603711 & 5110.7741807338 & 5136.55662964887\\
\hline
\rowcolor{gray!6}  wgt0\_Estimate & -0.00163274724538111 & 0.492582112313709 & 0.00999798623641602 & -0.000658938519302931 & 0.601258436431587 & 0.00326074237566435 & 0.00112485055604169 & 1.27282038539707 & -0.00512158791392237 & 0.000716628918444932 & 0.761704518610475 & -0.00601345031606092 & 0.000922100117259348 & 0.792700893714085 & -0.00668277875606482\\
\hline
wgt0\_Pr...z.. & 4.88365163639597e-08 & 2.33136555228405e-20 & 7.95432753711715e-07 & 0.00032843149807424 & 2.0921134733036e-48 & 0.00667886646012294 & 2.26123807446765e-11 & 6.67525280062144e-56 & 6.51923753120087e-127 & 2.43477572076212e-06 & 8.2201479288098e-69 & 5.19751747217521e-44 & 1.68237436753105e-15 & 4.81415543564975e-82 & 2.54848840100353e-105\\
\hline
\rowcolor{gray!6}  wgt0\_Std.Error & 0.00029928487659495 & 0.0532753838702833 & 0.00202532507408065 & 0.000183457551985601 & 0.0411255751282477 & 0.00120214094164169 & 0.000168187467853553 & 0.08080475140115 & 0.000213715312589078 & 0.000152036990658929 & 0.0434474820359048 & 0.00043218241369976 & 0.00011580150512068 & 0.0413159097814445 & 0.000306609919182859\\
\hline
wgt0\_zvalue & -5.45549532591606 & 9.24596082710666 & 4.93648469787221 & -3.59177647456371 & 14.6200614716414 & 2.71244598924594 & 6.68807593334564 & 15.7518012657231 & -23.9645341827701 & 4.71351685756907 & 17.531614789115 & -13.9141485757875 & 7.96276452796019 & 19.1863351892132 & -21.7957030675165\\
\hline
\rowcolor{gray!6}  Wu.Hausman\_df1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1\\
\hline
Wu.Hausman\_df2 & 18956 & 18961 & 18998 & 18956 & 18961 & 18998 & 25091 & 25101 & 30012 & 18586 & 18590 & 18844 & 18586 & 18590 & 18844\\
\hline
\rowcolor{gray!6}  Wu.Hausman\_p.value & 1.53929570343279e-118 & 3.13415891402799e-08 & 0 & 2.88592507054107e-108 & 7.6495944085204e-07 & 0 & 0.0221987672063003 & 0.0099360023036833 & 0 & 1.80909125272768e-238 & 2.14946499922491e-35 & 0 & 3.15182965429765e-108 & 1.7681125741529e-17 & 0\\
\hline
Wu.Hausman\_statistic & 543.467268879953 & 30.6481856102772 & 5652.51924792859 & 494.955883488045 & 24.4605456760994 & 5583.56513052781 & 5.23078768861684 & 6.6473469952822 & 25949.7118056025 & 1119.87022468742 & 154.793296861581 & 4826.92242730041 & 494.903094649183 & 72.530787010352 & 7607.83405438193\\
\hline
\rowcolor{gray!6}  cal\_Estimate & NA & NA & NA & 0.0238724384575419 & 2.71948246216953 & -0.168054407187466 & NA & NA & NA & NA & NA & NA & NA & NA & NA\\
\hline
cal\_Pr...z.. & NA & NA & NA & 1.44956616452661e-33 & 9.21076021290446e-10 & 5.67614501764414e-39 & NA & NA & NA & NA & NA & NA & NA & NA & NA\\
\hline
\rowcolor{gray!6}  cal\_Std.Error & NA & NA & NA & 0.00197718112735887 & 0.444177077282291 & 0.0128692506794877 & NA & NA & NA & NA & NA & NA & NA & NA & NA\\
\hline
cal\_zvalue & NA & NA & NA & 12.0739764947235 & 6.1225187008946 & -13.0586007975839 & NA & NA & NA & NA & NA & NA & NA & NA & NA\\
\hline
\rowcolor{gray!6}  wealthIdx\_Estimate & NA & NA & NA & NA & NA & NA & 0.144503490136948 & 69.1816142883022 & -1.91414470908345 & NA & NA & NA & NA & NA & NA\\
\hline
wealthIdx\_Pr...z.. & NA & NA & NA & NA & NA & NA & 3.72983264926432e-06 & 2.23442991281176e-07 & 0 & NA & NA & NA & NA & NA & NA\\
\hline
\rowcolor{gray!6}  wealthIdx\_Std.Error & NA & NA & NA & NA & NA & NA & 0.0312379492766376 & 13.358888551386 & 0.0371054140359243 & NA & NA & NA & NA & NA & NA\\
\hline
wealthIdx\_zvalue & NA & NA & NA & NA & NA & NA & 4.62589553677969 & 5.17869536991717 & -51.5866689219593 & NA & NA & NA & NA & NA & NA\\
\hline
\rowcolor{gray!6}  p.A.prot\_Estimate & NA & NA & NA & NA & NA & NA & NA & NA & NA & 0.00148073028434642 & 0.221916473012486 & -0.00520794333267238 & NA & NA & NA\\
\hline
p.A.prot\_Pr...z.. & NA & NA & NA & NA & NA & NA & NA & NA & NA & 2.50759287066563e-156 & 8.30126393398654e-33 & 3.00201194005694e-197 & NA & NA & NA\\
\hline
\rowcolor{gray!6}  p.A.prot\_Std.Error & NA & NA & NA & NA & NA & NA & NA & NA & NA & 5.55884799941827e-05 & 0.0186022369560791 & 0.000173813943639721 & NA & NA & NA\\
\hline
p.A.prot\_zvalue & NA & NA & NA & NA & NA & NA & NA & NA & NA & 26.6373587567312 & 11.9295584469998 & -29.9627476577329 & NA & NA & NA\\
\hline
\rowcolor{gray!6}  p.A.nProt\_Estimate & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & 0.0141317656200726 & 2.11856940494335 & -0.0494468877742109\\
\hline
p.A.nProt\_Pr...z.. & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & 2.61782083774363e-226 & 4.81511329043196e-35 & 0\\
\hline
\rowcolor{gray!6}  p.A.nProt\_Std.Error & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & 0.000440019589949091 & 0.17153115470458 & 0.00128926108222202\\
\hline
p.A.nProt\_zvalue & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & 32.1162192385744 & 12.3509307017263 & -38.3528894620707\\
\hline
\end{tabular}}
\end{table}

\hypertarget{program-line-by-line}{%
\subsubsection{Program Line by Line}\label{program-line-by-line}}

Set Up Parameters

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vars.z \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}indi.id\textquotesingle{}}\NormalTok{)}
\NormalTok{vars.z \textless{}{-}}\StringTok{ }\OtherTok{NULL}
\NormalTok{vars.c \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}sex\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}wgt0\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}hgt0\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}svymthRound\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{lapply}{%
\paragraph{Lapply}\label{lapply}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.reg.out \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(}
  \KeywordTok{bind\_rows}\NormalTok{(}\KeywordTok{lapply}\NormalTok{(list.vars.y, regf.iv,}
                   \DataTypeTok{vars.x=}\NormalTok{var.x1, }\DataTypeTok{vars.c=}\NormalTok{vars.c, }\DataTypeTok{vars.z=}\NormalTok{vars.z, }\DataTypeTok{df=}\NormalTok{df)))}
\end{Highlighting}
\end{Shaded}

\hypertarget{nested-lapply-test}{%
\paragraph{Nested Lapply Test}\label{nested-lapply-test}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{lapply}\NormalTok{(list.vars.y, }\ControlFlowTok{function}\NormalTok{(y) (}\KeywordTok{mean}\NormalTok{(df[[var.x1]], }\DataTypeTok{na.rm=}\OtherTok{TRUE}\NormalTok{) }\OperatorTok{+}
\StringTok{                                   }\KeywordTok{mean}\NormalTok{(df[[y]], }\DataTypeTok{na.rm=}\OtherTok{TRUE}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [[1]]
## [1] 98.3272
## 
## [[2]]
## [1] 13626.51
## 
## [[3]]
## [1] 26.11226
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lapplytwice \textless{}{-}}\StringTok{ }\KeywordTok{lapply}\NormalTok{(}
\NormalTok{  list.vars.x, }\ControlFlowTok{function}\NormalTok{(x) (}
    \KeywordTok{lapply}\NormalTok{(list.vars.y, }\ControlFlowTok{function}\NormalTok{(y) (}\KeywordTok{mean}\NormalTok{(df[[x]], }\DataTypeTok{na.rm=}\OtherTok{TRUE}\NormalTok{) }\OperatorTok{+}
\StringTok{                                       }\KeywordTok{mean}\NormalTok{(df[[y]], }\DataTypeTok{na.rm=}\OtherTok{TRUE}\NormalTok{)))))}
\CommentTok{\# lapplytwice}
\end{Highlighting}
\end{Shaded}

\hypertarget{nested-lapply-all}{%
\paragraph{Nested Lapply All}\label{nested-lapply-all}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.reg.out.all \textless{}{-}}\StringTok{ }\KeywordTok{bind\_rows}\NormalTok{(}
  \KeywordTok{lapply}\NormalTok{(list.vars.x,}
         \ControlFlowTok{function}\NormalTok{(x) (}
           \KeywordTok{bind\_rows}\NormalTok{(}
             \KeywordTok{lapply}\NormalTok{(list.vars.y, regf.iv,}
                    \DataTypeTok{vars.x=}\NormalTok{x, }\DataTypeTok{vars.c=}\NormalTok{vars.c, }\DataTypeTok{vars.z=}\NormalTok{vars.z, }\DataTypeTok{df=}\NormalTok{df))}
\NormalTok{         )))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# df.reg.out.all \%\textgreater{}\%}
\CommentTok{\#   kable() \%\textgreater{}\%}
\CommentTok{\#   kable\_styling\_fc\_wide()}
\end{Highlighting}
\end{Shaded}

\hypertarget{nested-lapply-select}{%
\paragraph{Nested Lapply Select}\label{nested-lapply-select}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.reg.out.all \textless{}{-}}
\StringTok{  }\NormalTok{(}\KeywordTok{lapply}\NormalTok{(list.vars.x,}
          \ControlFlowTok{function}\NormalTok{(x) (}
            \KeywordTok{bind\_rows}\NormalTok{(}\KeywordTok{lapply}\NormalTok{(list.vars.y, regf.iv,}
                             \DataTypeTok{vars.x=}\NormalTok{x, }\DataTypeTok{vars.c=}\NormalTok{vars.c, }\DataTypeTok{vars.z=}\NormalTok{vars.z, }\DataTypeTok{df=}\NormalTok{df)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{              }\KeywordTok{select}\NormalTok{(vars\_var.y, }\KeywordTok{starts\_with}\NormalTok{(x)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{              }\KeywordTok{select}\NormalTok{(vars\_var.y, }\KeywordTok{ends\_with}\NormalTok{(}\StringTok{\textquotesingle{}value\textquotesingle{}}\NormalTok{))}
\NormalTok{          ))) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{reduce}\NormalTok{(full\_join)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.reg.out.all }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{l|l|l|l|l|l}
\hline
vars\_var.y & prot\_tvalue & cal\_tvalue & wealthIdx\_tvalue & p.A.prot\_tvalue & p.A.nProt\_tvalue\\
\hline
\rowcolor{gray!6}  hgt & 18.8756010031786 & 23.4421863484661 & 13.508899618216 & 3.83682180045518 & 32.5448257554855\\
\hline
wgt & 16.3591125056062 & 17.3686031309332 & 14.1390521528113 & 1.36958319982295 & 12.0961557911467\\
\hline
\rowcolor{gray!6}  vil.id & -14.9385580468907 & -19.6150110809452 & 34.0972558327347 & 8.45943342783186 & 17.7801422421419\\
\hline
\end{tabular}}
\end{table}

\hypertarget{decomposition}{%
\section{Decomposition}\label{decomposition}}

\hypertarget{decompose-rhs}{%
\subsection{Decompose RHS}\label{decompose-rhs}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

One runs a number of regressions. With different outcomes, and various right hand side variables.

What is the remaining variation in the left hand side variable if right hand side variable one by one is set to the average of the observed values.

\begin{itemize}
\tightlist
\item
  Dependency: \emph{R4Econ/linreg/ivreg/ivregdfrow.R}
\end{itemize}

The code below does not work with categorical variables (except for dummies). Dummy variable inputs need to be converted to zero/one first. The examples are just to test the code with different types of variables.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Library}
\KeywordTok{library}\NormalTok{(tidyverse)}
\KeywordTok{library}\NormalTok{(AER)}

\CommentTok{\# Load Sample Data}
\KeywordTok{setwd}\NormalTok{(}\StringTok{\textquotesingle{}C:/Users/fan/R4Econ/\_data/\textquotesingle{}}\NormalTok{)}
\NormalTok{df \textless{}{-}}\StringTok{ }\KeywordTok{read\_csv}\NormalTok{(}\StringTok{\textquotesingle{}height\_weight.csv\textquotesingle{}}\NormalTok{)}

\CommentTok{\# Source Dependency}
\KeywordTok{source}\NormalTok{(}\StringTok{\textquotesingle{}C:/Users/fan/R4Econ/linreg/ivreg/ivregdfrow.R\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Data Cleaning.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Convert Variable for Sex which is categorical to Numeric}
\NormalTok{df \textless{}{-}}\StringTok{ }\NormalTok{df}
\NormalTok{df}\OperatorTok{$}\NormalTok{male \textless{}{-}}\StringTok{ }\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{factor}\NormalTok{(df}\OperatorTok{$}\NormalTok{sex)) }\OperatorTok{{-}}\StringTok{ }\DecValTok{1}\NormalTok{)}
\KeywordTok{summary}\NormalTok{(}\KeywordTok{factor}\NormalTok{(df}\OperatorTok{$}\NormalTok{sex))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Female   Male 
##  16446  18619
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(df}\OperatorTok{$}\NormalTok{male)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   0.000   0.000   1.000   0.531   1.000   1.000
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.use \textless{}{-}}\StringTok{ }\NormalTok{df }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{filter}\NormalTok{(S.country }\OperatorTok{==}\StringTok{ \textquotesingle{}Guatemala\textquotesingle{}}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(svymthRound }\OperatorTok{\%in\%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{12}\NormalTok{, }\DecValTok{18}\NormalTok{, }\DecValTok{24}\NormalTok{))}
\KeywordTok{dim}\NormalTok{(df.use)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2022   16
\end{verbatim}

Setting Up Parameters.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Define Left Hand Side Variab les}
\NormalTok{var.y1 \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}hgt\textquotesingle{}}\NormalTok{)}
\NormalTok{var.y2 \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}wgt\textquotesingle{}}\NormalTok{)}
\NormalTok{vars.y \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(var.y1, var.y2)}
\CommentTok{\# Define Right Hand Side Variables}
\NormalTok{vars.x \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}prot\textquotesingle{}}\NormalTok{)}
\NormalTok{vars.c \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}male\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}wgt0\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}hgt0\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}svymthRound\textquotesingle{}}\NormalTok{)}
\CommentTok{\# vars.z \textless{}{-} c(\textquotesingle{}p.A.prot\textquotesingle{})}
\NormalTok{vars.z \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}vil.id\textquotesingle{}}\NormalTok{)}
\CommentTok{\# vars.z \textless{}{-} NULL}
\NormalTok{vars.xc \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(vars.x, vars.c)}

\CommentTok{\# Other variables to keep}
\NormalTok{vars.other.keep \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}S.country\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}vil.id\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}indi.id\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}svymthRound\textquotesingle{}}\NormalTok{)}

\CommentTok{\# Decompose sequence}
\NormalTok{vars.tomean.first \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}male\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}hgt0\textquotesingle{}}\NormalTok{)}
\NormalTok{var.tomean.first.name.suffix \textless{}{-}}\StringTok{ \textquotesingle{}\_mh02m\textquotesingle{}}
\NormalTok{vars.tomean.second \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(vars.tomean.first, }\StringTok{\textquotesingle{}hgt0\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}wgt0\textquotesingle{}}\NormalTok{)}
\NormalTok{var.tomean.second.name.suffix \textless{}{-}}\StringTok{ \textquotesingle{}\_mh0me2m\textquotesingle{}}
\NormalTok{vars.tomean.third \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(vars.tomean.second, }\StringTok{\textquotesingle{}prot\textquotesingle{}}\NormalTok{)}
\NormalTok{var.tomean.third.name.suffix \textless{}{-}}\StringTok{ \textquotesingle{}\_mh0mep2m\textquotesingle{}}
\NormalTok{vars.tomean.fourth \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(vars.tomean.third, }\StringTok{\textquotesingle{}svymthRound\textquotesingle{}}\NormalTok{)}
\NormalTok{var.tomean.fourth.name.suffix \textless{}{-}}\StringTok{ \textquotesingle{}\_mh0mepm2m\textquotesingle{}}
\NormalTok{list.vars.tomean =}\StringTok{ }\KeywordTok{list}\NormalTok{(}
\CommentTok{\#                         vars.tomean.first,}
\NormalTok{                        vars.tomean.second,}
\NormalTok{                        vars.tomean.third,}
\NormalTok{                        vars.tomean.fourth}
\NormalTok{                        )}
\NormalTok{list.vars.tomean.name.suffix \textless{}{-}}\StringTok{ }\KeywordTok{list}\NormalTok{(}
\CommentTok{\#                                     var.tomean.first.name.suffix,}
\NormalTok{                                     var.tomean.second.name.suffix,}
\NormalTok{                                     var.tomean.third.name.suffix,}
\NormalTok{                                     var.tomean.fourth.name.suffix}
\NormalTok{                                    )}
\end{Highlighting}
\end{Shaded}

\hypertarget{obtain-regression-coefficients-from-somewhere}{%
\subsubsection{Obtain Regression Coefficients from somewhere}\label{obtain-regression-coefficients-from-somewhere}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Regressions}
\CommentTok{\# regf.iv from C:\textbackslash{}Users\textbackslash{}fan\textbackslash{}R4Econ\textbackslash{}linreg\textbackslash{}ivreg\textbackslash{}ivregdfrow.R}
\NormalTok{df.reg.out \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(}
  \KeywordTok{bind\_rows}\NormalTok{(}\KeywordTok{lapply}\NormalTok{(vars.y, regf.iv,}
                   \DataTypeTok{vars.x=}\NormalTok{vars.x, }\DataTypeTok{vars.c=}\NormalTok{vars.c, }\DataTypeTok{vars.z=}\NormalTok{vars.z, }\DataTypeTok{df=}\NormalTok{df)))}
\CommentTok{\# Regressions}
\CommentTok{\# reg1 \textless{}{-} regf.iv(var.y = var.y1, vars.x, vars.c, vars.z, df.use)}
\CommentTok{\# reg2 \textless{}{-} regf.iv(var.y = var.y2, vars.x, vars.c, vars.z, df.use)}
\CommentTok{\# df.reg.out \textless{}{-} as\_tibble(bind\_rows(reg1, reg2))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# df.reg.out}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Select Variables}
\NormalTok{str.esti.suffix \textless{}{-}}\StringTok{ \textquotesingle{}\_Estimate\textquotesingle{}}
\NormalTok{arr.esti.name \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(vars.xc, str.esti.suffix)}
\NormalTok{str.outcome.name \textless{}{-}}\StringTok{ \textquotesingle{}vars\_var.y\textquotesingle{}}
\NormalTok{arr.columns2select \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(arr.esti.name, str.outcome.name)}
\NormalTok{arr.columns2select}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "prot_Estimate"        "male_Estimate"        "wgt0_Estimate"        "hgt0_Estimate"        "svymthRound_Estimate" "vars_var.y"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Generate dataframe for coefficients}
\NormalTok{df.coef \textless{}{-}}\StringTok{ }\NormalTok{df.reg.out[,}\KeywordTok{c}\NormalTok{(arr.columns2select)] }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate\_at}\NormalTok{(}\KeywordTok{vars}\NormalTok{(arr.esti.name), as.numeric) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{column\_to\_rownames}\NormalTok{(str.outcome.name)}
\NormalTok{df.coef }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{l|r|r|r|r|r}
\hline
  & prot\_Estimate & male\_Estimate & wgt0\_Estimate & hgt0\_Estimate & svymthRound\_Estimate\\
\hline
\rowcolor{gray!6}  hgt & -0.2714772 & 1.244735 & 0.0004430 & 0.6834853 & 1.133919\\
\hline
wgt & -59.0727542 & 489.852902 & 0.7696158 & 75.4867897 & 250.778883\\
\hline
\end{tabular}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{str}\NormalTok{(df.coef)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 'data.frame':    2 obs. of  5 variables:
##  $ prot_Estimate       : num  -0.271 -59.073
##  $ male_Estimate       : num  1.24 489.85
##  $ wgt0_Estimate       : num  0.000443 0.769616
##  $ hgt0_Estimate       : num  0.683 75.487
##  $ svymthRound_Estimate: num  1.13 250.78
\end{verbatim}

\hypertarget{decomposition-step-1}{%
\subsubsection{Decomposition Step 1}\label{decomposition-step-1}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Decomposition Step 1: gather}
\NormalTok{df.decompose\_step1 \textless{}{-}}\StringTok{ }\NormalTok{df.use }\OperatorTok{\%\textgreater{}\%}
\StringTok{                        }\KeywordTok{filter}\NormalTok{(svymthRound }\OperatorTok{\%in\%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{12}\NormalTok{, }\DecValTok{18}\NormalTok{, }\DecValTok{24}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{                        }\KeywordTok{select}\NormalTok{(}\KeywordTok{one\_of}\NormalTok{(}\KeywordTok{c}\NormalTok{(vars.other.keep, vars.xc, vars.y))) }\OperatorTok{\%\textgreater{}\%}
\StringTok{                        }\KeywordTok{drop\_na}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{                        }\KeywordTok{gather}\NormalTok{(variable, value, }\OperatorTok{{-}}\KeywordTok{one\_of}\NormalTok{(}\KeywordTok{c}\NormalTok{(vars.other.keep, vars.xc)))}
\KeywordTok{options}\NormalTok{(}\DataTypeTok{repr.matrix.max.rows=}\DecValTok{20}\NormalTok{, }\DataTypeTok{repr.matrix.max.cols=}\DecValTok{20}\NormalTok{)}
\KeywordTok{dim}\NormalTok{(df.decompose\_step1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1382   10
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(df.decompose\_step1, }\DecValTok{10}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{l|r|r|r|r|r|r|r|l|r}
\hline
S.country & vil.id & indi.id & svymthRound & prot & male & wgt0 & hgt0 & variable & value\\
\hline
\rowcolor{gray!6}  Guatemala & 3 & 1352 & 18 & 13.3 & 1 & 2545.2 & 47.4 & hgt & 70.2\\
\hline
Guatemala & 3 & 1352 & 24 & 46.3 & 1 & 2545.2 & 47.4 & hgt & 75.8\\
\hline
\rowcolor{gray!6}  Guatemala & 3 & 1354 & 12 & 1.0 & 1 & 3634.3 & 51.2 & hgt & 66.3\\
\hline
Guatemala & 3 & 1354 & 18 & 9.8 & 1 & 3634.3 & 51.2 & hgt & 69.2\\
\hline
\rowcolor{gray!6}  Guatemala & 3 & 1354 & 24 & 15.4 & 1 & 3634.3 & 51.2 & hgt & 75.3\\
\hline
Guatemala & 3 & 1356 & 12 & 8.6 & 1 & 3911.8 & 51.9 & hgt & 68.1\\
\hline
\rowcolor{gray!6}  Guatemala & 3 & 1356 & 18 & 17.8 & 1 & 3911.8 & 51.9 & hgt & 74.1\\
\hline
Guatemala & 3 & 1356 & 24 & 30.5 & 1 & 3911.8 & 51.9 & hgt & 77.1\\
\hline
\rowcolor{gray!6}  Guatemala & 3 & 1357 & 12 & 1.0 & 1 & 3791.4 & 52.6 & hgt & 71.5\\
\hline
Guatemala & 3 & 1357 & 18 & 12.7 & 1 & 3791.4 & 52.6 & hgt & 77.8\\
\hline
\end{tabular}
\end{table}

\hypertarget{decomposition-step-2}{%
\subsubsection{Decomposition Step 2}\label{decomposition-step-2}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Decomposition Step 2: mutate\_at(vars, funs(mean = mean(.)))}
\CommentTok{\# the xc averaging could have taken place earlier, no difference in mean across variables}
\NormalTok{df.decompose\_step2 \textless{}{-}}\StringTok{ }\NormalTok{df.decompose\_step1 }\OperatorTok{\%\textgreater{}\%}
\StringTok{                        }\KeywordTok{group\_by}\NormalTok{(variable) }\OperatorTok{\%\textgreater{}\%}
\StringTok{                        }\KeywordTok{mutate\_at}\NormalTok{(}\KeywordTok{vars}\NormalTok{(}\KeywordTok{c}\NormalTok{(vars.xc, }\StringTok{\textquotesingle{}value\textquotesingle{}}\NormalTok{)), }\KeywordTok{funs}\NormalTok{(}\DataTypeTok{mean =} \KeywordTok{mean}\NormalTok{(.))) }\OperatorTok{\%\textgreater{}\%}
\StringTok{                        }\KeywordTok{ungroup}\NormalTok{()}

\KeywordTok{options}\NormalTok{(}\DataTypeTok{repr.matrix.max.rows=}\DecValTok{20}\NormalTok{, }\DataTypeTok{repr.matrix.max.cols=}\DecValTok{20}\NormalTok{)}
\KeywordTok{dim}\NormalTok{(df.decompose\_step2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1382   16
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(df.decompose\_step2,}\DecValTok{10}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{l|r|r|r|r|r|r|r|l|r|r|r|r|r|r|r}
\hline
S.country & vil.id & indi.id & svymthRound & prot & male & wgt0 & hgt0 & variable & value & prot\_mean & male\_mean & wgt0\_mean & hgt0\_mean & svymthRound\_mean & value\_mean\\
\hline
\rowcolor{gray!6}  Guatemala & 3 & 1352 & 18 & 13.3 & 1 & 2545.2 & 47.4 & hgt & 70.2 & 20.64819 & 0.5499276 & 3312.297 & 49.75137 & 18.42547 & 73.41216\\
\hline
Guatemala & 3 & 1352 & 24 & 46.3 & 1 & 2545.2 & 47.4 & hgt & 75.8 & 20.64819 & 0.5499276 & 3312.297 & 49.75137 & 18.42547 & 73.41216\\
\hline
\rowcolor{gray!6}  Guatemala & 3 & 1354 & 12 & 1.0 & 1 & 3634.3 & 51.2 & hgt & 66.3 & 20.64819 & 0.5499276 & 3312.297 & 49.75137 & 18.42547 & 73.41216\\
\hline
Guatemala & 3 & 1354 & 18 & 9.8 & 1 & 3634.3 & 51.2 & hgt & 69.2 & 20.64819 & 0.5499276 & 3312.297 & 49.75137 & 18.42547 & 73.41216\\
\hline
\rowcolor{gray!6}  Guatemala & 3 & 1354 & 24 & 15.4 & 1 & 3634.3 & 51.2 & hgt & 75.3 & 20.64819 & 0.5499276 & 3312.297 & 49.75137 & 18.42547 & 73.41216\\
\hline
Guatemala & 3 & 1356 & 12 & 8.6 & 1 & 3911.8 & 51.9 & hgt & 68.1 & 20.64819 & 0.5499276 & 3312.297 & 49.75137 & 18.42547 & 73.41216\\
\hline
\rowcolor{gray!6}  Guatemala & 3 & 1356 & 18 & 17.8 & 1 & 3911.8 & 51.9 & hgt & 74.1 & 20.64819 & 0.5499276 & 3312.297 & 49.75137 & 18.42547 & 73.41216\\
\hline
Guatemala & 3 & 1356 & 24 & 30.5 & 1 & 3911.8 & 51.9 & hgt & 77.1 & 20.64819 & 0.5499276 & 3312.297 & 49.75137 & 18.42547 & 73.41216\\
\hline
\rowcolor{gray!6}  Guatemala & 3 & 1357 & 12 & 1.0 & 1 & 3791.4 & 52.6 & hgt & 71.5 & 20.64819 & 0.5499276 & 3312.297 & 49.75137 & 18.42547 & 73.41216\\
\hline
Guatemala & 3 & 1357 & 18 & 12.7 & 1 & 3791.4 & 52.6 & hgt & 77.8 & 20.64819 & 0.5499276 & 3312.297 & 49.75137 & 18.42547 & 73.41216\\
\hline
\end{tabular}}
\end{table}

\hypertarget{decomposition-step-3-non-loop}{%
\subsubsection{Decomposition Step 3 Non-Loop}\label{decomposition-step-3-non-loop}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ff\_lr\_decompose\_valadj \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(df, df.coef, vars.tomean, str.esti.suffix) \{}
\NormalTok{  new\_value \textless{}{-}}\StringTok{ }\NormalTok{(df}\OperatorTok{$}\NormalTok{value }\OperatorTok{+}
\StringTok{                  }\KeywordTok{rowSums}\NormalTok{((df[}\KeywordTok{paste0}\NormalTok{(vars.tomean, }\StringTok{\textquotesingle{}\_mean\textquotesingle{}}\NormalTok{)] }\OperatorTok{{-}}\StringTok{ }\NormalTok{df[vars.tomean])}
                          \OperatorTok{*}\NormalTok{df.coef[df}\OperatorTok{$}\NormalTok{variable, }\KeywordTok{paste0}\NormalTok{(vars.tomean, str.esti.suffix)]))}
  \KeywordTok{return}\NormalTok{(new\_value)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{decomposition-step-3-with-loop}{%
\subsubsection{Decomposition Step 3 With Loop}\label{decomposition-step-3-with-loop}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.decompose\_step3 \textless{}{-}}\StringTok{ }\NormalTok{df.decompose\_step2}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(list.vars.tomean)) \{}
\NormalTok{    var.decomp.cur \textless{}{-}}\StringTok{ }\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}value\textquotesingle{}}\NormalTok{, list.vars.tomean.name.suffix[[i]]))}
\NormalTok{    vars.tomean \textless{}{-}}\StringTok{ }\NormalTok{list.vars.tomean[[i]]}
\NormalTok{    var.decomp.cur}
\NormalTok{    df.decompose\_step3 \textless{}{-}}\StringTok{ }\NormalTok{df.decompose\_step3 }\OperatorTok{\%\textgreater{}\%}
\StringTok{      }\KeywordTok{mutate}\NormalTok{((}\OperatorTok{!!}\NormalTok{var.decomp.cur) }\OperatorTok{:}\ErrorTok{=}
\StringTok{               }\KeywordTok{ff\_lr\_decompose\_valadj}\NormalTok{(., df.coef, vars.tomean, str.esti.suffix))}

\NormalTok{\}}

\KeywordTok{dim}\NormalTok{(df.decompose\_step3)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1382   19
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(df.decompose\_step3, }\DecValTok{10}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{l|r|r|r|r|r|r|r|l|r|r|r|r|r|r|r|r|r|r}
\hline
S.country & vil.id & indi.id & svymthRound & prot & male & wgt0 & hgt0 & variable & value & prot\_mean & male\_mean & wgt0\_mean & hgt0\_mean & svymthRound\_mean & value\_mean & value\_mh0me2m & value\_mh0mep2m & value\_mh0mepm2m\\
\hline
\rowcolor{gray!6}  Guatemala & 3 & 1352 & 18 & 13.3 & 1 & 2545.2 & 47.4 & hgt & 70.2 & 20.64819 & 0.5499276 & 3312.297 & 49.75137 & 18.42547 & 73.41216 & 73.19390 & 71.19903 & 71.68148\\
\hline
Guatemala & 3 & 1352 & 24 & 46.3 & 1 & 2545.2 & 47.4 & hgt & 75.8 & 20.64819 & 0.5499276 & 3312.297 & 49.75137 & 18.42547 & 73.41216 & 78.79390 & 85.75778 & 79.43671\\
\hline
\rowcolor{gray!6}  Guatemala & 3 & 1354 & 12 & 1.0 & 1 & 3634.3 & 51.2 & hgt & 66.3 & 20.64819 & 0.5499276 & 3312.297 & 49.75137 & 18.42547 & 73.41216 & 63.61689 & 58.28285 & 65.56882\\
\hline
Guatemala & 3 & 1354 & 18 & 9.8 & 1 & 3634.3 & 51.2 & hgt & 69.2 & 20.64819 & 0.5499276 & 3312.297 & 49.75137 & 18.42547 & 73.41216 & 66.51689 & 63.57185 & 64.05430\\
\hline
\rowcolor{gray!6}  Guatemala & 3 & 1354 & 24 & 15.4 & 1 & 3634.3 & 51.2 & hgt & 75.3 & 20.64819 & 0.5499276 & 3312.297 & 49.75137 & 18.42547 & 73.41216 & 72.61689 & 71.19213 & 64.87106\\
\hline
Guatemala & 3 & 1356 & 12 & 8.6 & 1 & 3911.8 & 51.9 & hgt & 68.1 & 20.64819 & 0.5499276 & 3312.297 & 49.75137 & 18.42547 & 73.41216 & 64.33707 & 61.06626 & 68.35222\\
\hline
\rowcolor{gray!6}  Guatemala & 3 & 1356 & 18 & 17.8 & 1 & 3911.8 & 51.9 & hgt & 74.1 & 20.64819 & 0.5499276 & 3312.297 & 49.75137 & 18.42547 & 73.41216 & 70.33707 & 69.56385 & 70.04630\\
\hline
Guatemala & 3 & 1356 & 24 & 30.5 & 1 & 3911.8 & 51.9 & hgt & 77.1 & 20.64819 & 0.5499276 & 3312.297 & 49.75137 & 18.42547 & 73.41216 & 73.33707 & 76.01161 & 69.69055\\
\hline
\rowcolor{gray!6}  Guatemala & 3 & 1357 & 12 & 1.0 & 1 & 3791.4 & 52.6 & hgt & 71.5 & 20.64819 & 0.5499276 & 3312.297 & 49.75137 & 18.42547 & 73.41216 & 66.83353 & 61.49949 & 68.78545\\
\hline
Guatemala & 3 & 1357 & 18 & 12.7 & 1 & 3791.4 & 52.6 & hgt & 77.8 & 20.64819 & 0.5499276 & 3312.297 & 49.75137 & 18.42547 & 73.41216 & 73.13353 & 70.97578 & 71.45823\\
\hline
\end{tabular}}
\end{table}

\hypertarget{decomposition-step-4-variance}{%
\subsubsection{Decomposition Step 4 Variance}\label{decomposition-step-4-variance}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.decompose\_step3 }\OperatorTok{\%\textgreater{}\%}
\StringTok{        }\KeywordTok{select}\NormalTok{(variable, }\KeywordTok{contains}\NormalTok{(}\StringTok{\textquotesingle{}value\textquotesingle{}}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{        }\KeywordTok{group\_by}\NormalTok{(variable) }\OperatorTok{\%\textgreater{}\%}
\StringTok{        }\KeywordTok{summarize\_all}\NormalTok{(}\KeywordTok{funs}\NormalTok{(}\DataTypeTok{mean =}\NormalTok{ mean, }\DataTypeTok{var =}\NormalTok{ var)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{        }\KeywordTok{select}\NormalTok{(}\KeywordTok{matches}\NormalTok{(}\StringTok{\textquotesingle{}value\textquotesingle{}}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{select}\NormalTok{(}\KeywordTok{ends\_with}\NormalTok{(}\StringTok{"\_var"}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{        }\KeywordTok{mutate\_if}\NormalTok{(is.numeric, }\KeywordTok{funs}\NormalTok{( }\DataTypeTok{frac =}\NormalTok{ (.}\OperatorTok{/}\NormalTok{value\_var))) }\OperatorTok{\%\textgreater{}\%}
\StringTok{        }\KeywordTok{mutate\_if}\NormalTok{(is.numeric, round, }\DecValTok{3}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{r|r|r|r|r|r|r|r|r|r}
\hline
value\_var & value\_mean\_var & value\_mh0me2m\_var & value\_mh0mep2m\_var & value\_mh0mepm2m\_var & value\_var\_frac & value\_mean\_var\_frac & value\_mh0me2m\_var\_frac & value\_mh0mep2m\_var\_frac & value\_mh0mepm2m\_var\_frac\\
\hline
\rowcolor{gray!6}  21.864 & NA & 25.35 & 49.047 & 23.06 & 1 & NA & 1.159 & 2.243 & 1.055\\
\hline
2965693.245 & NA & 2949187.64 & 4192769.518 & 3147506.60 & 1 & NA & 0.994 & 1.414 & 1.061\\
\hline
\end{tabular}}
\end{table}

\hypertarget{graphical-results}{%
\subsubsection{Graphical Results}\label{graphical-results}}

Graphically, difficult to pick up exact differences in variance, a 50 percent reduction in variance visually does not look like 50 percent. Intuitively, we are kind of seeing standard deviation, not variance on the graph if we think abou the x-scale.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(df.decompose\_step3 }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{select}\NormalTok{(variable, }\KeywordTok{contains}\NormalTok{(}\StringTok{\textquotesingle{}value\textquotesingle{}}\NormalTok{), }\OperatorTok{{-}}\NormalTok{value\_mean), }\DecValTok{10}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{l|r|r|r|r}
\hline
variable & value & value\_mh0me2m & value\_mh0mep2m & value\_mh0mepm2m\\
\hline
\rowcolor{gray!6}  hgt & 70.2 & 73.19390 & 71.19903 & 71.68148\\
\hline
hgt & 75.8 & 78.79390 & 85.75778 & 79.43671\\
\hline
\rowcolor{gray!6}  hgt & 66.3 & 63.61689 & 58.28285 & 65.56882\\
\hline
hgt & 69.2 & 66.51689 & 63.57185 & 64.05430\\
\hline
\rowcolor{gray!6}  hgt & 75.3 & 72.61689 & 71.19213 & 64.87106\\
\hline
hgt & 68.1 & 64.33707 & 61.06626 & 68.35222\\
\hline
\rowcolor{gray!6}  hgt & 74.1 & 70.33707 & 69.56385 & 70.04630\\
\hline
hgt & 77.1 & 73.33707 & 76.01161 & 69.69055\\
\hline
\rowcolor{gray!6}  hgt & 71.5 & 66.83353 & 61.49949 & 68.78545\\
\hline
hgt & 77.8 & 73.13353 & 70.97578 & 71.45823\\
\hline
\end{tabular}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.decompose\_step3 }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{select}\NormalTok{(variable, }\KeywordTok{contains}\NormalTok{(}\StringTok{\textquotesingle{}value\textquotesingle{}}\NormalTok{), }\OperatorTok{{-}}\NormalTok{value\_mean) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{outcome =}\NormalTok{ variable) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{gather}\NormalTok{(variable, value, }\OperatorTok{{-}}\NormalTok{outcome) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{value, }\DataTypeTok{color =}\NormalTok{ variable, }\DataTypeTok{fill =}\NormalTok{ variable)) }\OperatorTok{+}
\StringTok{        }\KeywordTok{geom\_line}\NormalTok{(}\DataTypeTok{stat =} \StringTok{"density"}\NormalTok{) }\OperatorTok{+}
\StringTok{        }\KeywordTok{facet\_wrap}\NormalTok{(}\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{outcome, }\DataTypeTok{scales=}\StringTok{\textquotesingle{}free\textquotesingle{}}\NormalTok{, }\DataTypeTok{nrow=}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{Panel-Data-and-Optimization-with-R_files/figure-latex/unnamed-chunk-153-1} \end{center}

\hypertarget{additional-decomposition-testings}{%
\subsubsection{Additional Decomposition Testings}\label{additional-decomposition-testings}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(df.decompose\_step2[vars.tomean.first],}\DecValTok{3}\NormalTok{)}
\KeywordTok{head}\NormalTok{(df.decompose\_step2[}\KeywordTok{paste0}\NormalTok{(vars.tomean.first, }\StringTok{\textquotesingle{}\_mean\textquotesingle{}}\NormalTok{)], }\DecValTok{3}\NormalTok{)}
\KeywordTok{head}\NormalTok{(df.coef[df.decompose\_step2}\OperatorTok{$}\NormalTok{variable,}
             \KeywordTok{paste0}\NormalTok{(vars.tomean.first, str.esti.suffix)], }\DecValTok{3}\NormalTok{)}
\NormalTok{df.decompose.tomean.first \textless{}{-}}\StringTok{ }\NormalTok{df.decompose\_step2 }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{pred\_new =}\NormalTok{ df.decompose\_step2}\OperatorTok{$}\NormalTok{value }\OperatorTok{+}
\StringTok{        }\KeywordTok{rowSums}\NormalTok{((df.decompose\_step2[}\KeywordTok{paste0}\NormalTok{(vars.tomean.first, }\StringTok{\textquotesingle{}\_mean\textquotesingle{}}\NormalTok{)]}
                 \OperatorTok{{-}}\StringTok{ }\NormalTok{df.decompose\_step2[vars.tomean.first])}
            \OperatorTok{*}\NormalTok{df.coef[df.decompose\_step2}\OperatorTok{$}\NormalTok{variable,}
                     \KeywordTok{paste0}\NormalTok{(vars.tomean.first, str.esti.suffix)])) }\OperatorTok{\%\textgreater{}\%}
\StringTok{        }\KeywordTok{select}\NormalTok{(variable, value, pred\_new)}
\KeywordTok{head}\NormalTok{(df.decompose.tomean.first, }\DecValTok{10}\NormalTok{)}
\NormalTok{df.decompose.tomean.first }\OperatorTok{\%\textgreater{}\%}
\StringTok{        }\KeywordTok{group\_by}\NormalTok{(variable) }\OperatorTok{\%\textgreater{}\%}
\StringTok{        }\KeywordTok{summarize\_all}\NormalTok{(}\KeywordTok{funs}\NormalTok{(}\DataTypeTok{mean =}\NormalTok{ mean, }\DataTypeTok{sd =}\NormalTok{ sd))  }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{l|r|r|r|r}
\hline
variable & value\_mean & pred\_new\_mean & value\_sd & pred\_new\_sd\\
\hline
\rowcolor{gray!6}  hgt & 73.41216 & 73.41216 & 4.675867 & 4.534947\\
\hline
wgt & 8807.87656 & 8807.87656 & 1722.118824 & 1695.221845\\
\hline
\end{tabular}
\end{table}

Note the r-square from regression above matches up with the 1 - ratio below. This is the proper decomposition method that is equivalent to r2.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.decompose\_step2 }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{pred\_new =}\NormalTok{ df.decompose\_step2}\OperatorTok{$}\NormalTok{value }\OperatorTok{+}
\StringTok{        }\KeywordTok{rowSums}\NormalTok{((df.decompose\_step2[}\KeywordTok{paste0}\NormalTok{(vars.tomean.second, }\StringTok{\textquotesingle{}\_mean\textquotesingle{}}\NormalTok{)]}
                 \OperatorTok{{-}}\StringTok{ }\NormalTok{df.decompose\_step2[vars.tomean.second])}
            \OperatorTok{*}\NormalTok{df.coef[df.decompose\_step2}\OperatorTok{$}\NormalTok{variable,}
                     \KeywordTok{paste0}\NormalTok{(vars.tomean.second, str.esti.suffix)])) }\OperatorTok{\%\textgreater{}\%}
\StringTok{        }\KeywordTok{select}\NormalTok{(variable, value, pred\_new) }\OperatorTok{\%\textgreater{}\%}
\StringTok{        }\KeywordTok{group\_by}\NormalTok{(variable) }\OperatorTok{\%\textgreater{}\%}
\StringTok{        }\KeywordTok{summarize\_all}\NormalTok{(}\KeywordTok{funs}\NormalTok{(}\DataTypeTok{mean =}\NormalTok{ mean, }\DataTypeTok{var =}\NormalTok{ var)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{        }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{ratio =}\NormalTok{ (pred\_new\_var}\OperatorTok{/}\NormalTok{value\_var))  }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{l|r|r|r|r|r}
\hline
variable & value\_mean & pred\_new\_mean & value\_var & pred\_new\_var & ratio\\
\hline
\rowcolor{gray!6}  hgt & 73.41216 & 73.41216 & 2.186374e+01 & 25.3504 & 1.1594724\\
\hline
wgt & 8807.87656 & 8807.87656 & 2.965693e+06 & 2949187.6357 & 0.9944345\\
\hline
\end{tabular}
\end{table}

\hypertarget{nonlinear-regression}{%
\chapter{Nonlinear Regression}\label{nonlinear-regression}}

\hypertarget{logit-regression}{%
\section{Logit Regression}\label{logit-regression}}

\hypertarget{binary-logit}{%
\subsection{Binary Logit}\label{binary-logit}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

\emph{Data Preparation}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df\_mtcars \textless{}{-}}\StringTok{ }\NormalTok{mtcars}

\CommentTok{\# X{-}variables to use on RHS}
\NormalTok{ls\_st\_xs \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}mpg\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}qsec\textquotesingle{}}\NormalTok{)}
\NormalTok{ls\_st\_xs \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}mpg\textquotesingle{}}\NormalTok{)}
\NormalTok{ls\_st\_xs \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}qsec\textquotesingle{}}\NormalTok{)}
\NormalTok{ls\_st\_xs \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}wt\textquotesingle{}}\NormalTok{)}
\NormalTok{ls\_st\_xs \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}mpg\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}wt\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}vs\textquotesingle{}}\NormalTok{)}

\NormalTok{svr\_binary \textless{}{-}}\StringTok{ \textquotesingle{}hpLowHigh\textquotesingle{}}
\NormalTok{svr\_binary\_lb0 \textless{}{-}}\StringTok{ \textquotesingle{}LowHP\textquotesingle{}}
\NormalTok{svr\_binary\_lb1 \textless{}{-}}\StringTok{ \textquotesingle{}HighHP\textquotesingle{}}
\NormalTok{svr\_outcome \textless{}{-}}\StringTok{ \textquotesingle{}am\textquotesingle{}}
\NormalTok{sdt\_name \textless{}{-}}\StringTok{ \textquotesingle{}mtcars\textquotesingle{}}

\CommentTok{\# Discretize hp}
\NormalTok{df\_mtcars \textless{}{-}}\StringTok{ }\NormalTok{df\_mtcars }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_binary) }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\KeywordTok{cut}\NormalTok{(hp,}
                           \DataTypeTok{breaks=}\KeywordTok{c}\NormalTok{(}\OperatorTok{{-}}\OtherTok{Inf}\NormalTok{, }\DecValTok{210}\NormalTok{, }\OtherTok{Inf}\NormalTok{),}
                           \DataTypeTok{labels=}\KeywordTok{c}\NormalTok{(svr\_binary\_lb0, svr\_binary\_lb1)))}
\end{Highlighting}
\end{Shaded}

\hypertarget{logit-regresion-and-prediction}{%
\subsubsection{Logit Regresion and Prediction}\label{logit-regresion-and-prediction}}

logit regression with glm, and predict using estimation data. Prediction and estimation with one variable.

\begin{itemize}
\tightlist
\item
  \href{https://stats.idre.ucla.edu/r/dae/logit-regression/}{LOGIT REGRESSION R DATA ANALYSIS EXAMPLES}
\item
  \href{https://www.statmethods.net/advstats/glm.html}{Generalized Linear Models}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Regress}
\NormalTok{rs\_logit \textless{}{-}}\StringTok{ }\KeywordTok{glm}\NormalTok{(}\KeywordTok{as.formula}\NormalTok{(}\KeywordTok{paste}\NormalTok{(svr\_outcome, }\StringTok{"\textasciitilde{}"}\NormalTok{, }\KeywordTok{paste}\NormalTok{(ls\_st\_xs, }\DataTypeTok{collapse=}\StringTok{"+"}\NormalTok{)))}
\NormalTok{                ,}\DataTypeTok{data =}\NormalTok{ df\_mtcars, }\DataTypeTok{family =} \StringTok{"binomial"}\NormalTok{)}
\KeywordTok{summary}\NormalTok{(rs\_logit)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## glm(formula = as.formula(paste(svr_outcome, "~", paste(ls_st_xs, 
##     collapse = "+"))), family = "binomial", data = df_mtcars)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -1.73603  -0.25477  -0.04891   0.13402   1.90321  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(>|z|)  
## (Intercept) 22.69008   13.95112   1.626   0.1039  
## mpg         -0.01786    0.33957  -0.053   0.9581  
## wt          -6.73804    3.01400  -2.236   0.0254 *
## vs          -4.44046    2.84247  -1.562   0.1182  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 43.230  on 31  degrees of freedom
## Residual deviance: 13.092  on 28  degrees of freedom
## AIC: 21.092
## 
## Number of Fisher Scoring iterations: 7
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Predcit Using Regression Data}
\NormalTok{df\_mtcars}\OperatorTok{$}\NormalTok{p\_mpg \textless{}{-}}\StringTok{ }\KeywordTok{predict}\NormalTok{(rs\_logit, }\DataTypeTok{newdata =}\NormalTok{ df\_mtcars, }\DataTypeTok{type =} \StringTok{"response"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{prediction-with-observed-binary-input}{%
\paragraph{Prediction with Observed Binary Input}\label{prediction-with-observed-binary-input}}

Logit regression with a continuous variable and a binary variable. Predict outcome with observed continuous variable as well as observed binary input variable.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Regress}
\NormalTok{rs\_logit\_bi \textless{}{-}}\StringTok{ }\KeywordTok{glm}\NormalTok{(}\KeywordTok{as.formula}\NormalTok{(}\KeywordTok{paste}\NormalTok{(svr\_outcome,}
                                    \StringTok{"\textasciitilde{} factor("}\NormalTok{, svr\_binary,}\StringTok{") + "}\NormalTok{,}
                                    \KeywordTok{paste}\NormalTok{(ls\_st\_xs, }\DataTypeTok{collapse=}\StringTok{"+"}\NormalTok{)))}
\NormalTok{                   , }\DataTypeTok{data =}\NormalTok{ df\_mtcars, }\DataTypeTok{family =} \StringTok{"binomial"}\NormalTok{)}
\KeywordTok{summary}\NormalTok{(rs\_logit\_bi)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## glm(formula = as.formula(paste(svr_outcome, "~ factor(", svr_binary, 
##     ") + ", paste(ls_st_xs, collapse = "+"))), family = "binomial", 
##     data = df_mtcars)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -1.45771  -0.09563  -0.00875   0.00555   1.87612  
## 
## Coefficients:
##                         Estimate Std. Error z value Pr(>|z|)  
## (Intercept)               3.8285    18.0390   0.212   0.8319  
## factor(hpLowHigh)HighHP   6.9907     5.5176   1.267   0.2052  
## mpg                       0.8985     0.8906   1.009   0.3131  
## wt                       -6.7291     3.3166  -2.029   0.0425 *
## vs                       -5.9206     4.1908  -1.413   0.1577  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 43.2297  on 31  degrees of freedom
## Residual deviance:  8.9777  on 27  degrees of freedom
## AIC: 18.978
## 
## Number of Fisher Scoring iterations: 9
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Predcit Using Regresion Data}
\NormalTok{df\_mtcars}\OperatorTok{$}\NormalTok{p\_mpg\_hp \textless{}{-}}\StringTok{ }\KeywordTok{predict}\NormalTok{(rs\_logit\_bi, }\DataTypeTok{newdata =}\NormalTok{ df\_mtcars, }\DataTypeTok{type =} \StringTok{"response"}\NormalTok{)}

\CommentTok{\# Predicted Probabilities am on mgp with or without hp binary}
\NormalTok{scatter \textless{}{-}}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(df\_mtcars, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{p\_mpg\_hp, }\DataTypeTok{y=}\NormalTok{p\_mpg)) }\OperatorTok{+}
\StringTok{      }\KeywordTok{geom\_point}\NormalTok{(}\DataTypeTok{size=}\DecValTok{1}\NormalTok{) }\OperatorTok{+}
\StringTok{      }\CommentTok{\# geom\_smooth(method=lm) + \# Trend line}
\StringTok{      }\KeywordTok{geom\_abline}\NormalTok{(}\DataTypeTok{intercept =} \DecValTok{0}\NormalTok{, }\DataTypeTok{slope =} \DecValTok{1}\NormalTok{) }\OperatorTok{+}\StringTok{ }\CommentTok{\# 45 degree line}
\StringTok{      }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{title =} \KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}Predicted Probabilities \textquotesingle{}}\NormalTok{, svr\_outcome, }\StringTok{\textquotesingle{} on \textquotesingle{}}\NormalTok{, ls\_st\_xs, }\StringTok{\textquotesingle{} with or without hp binary\textquotesingle{}}\NormalTok{),}
           \DataTypeTok{x =} \KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}prediction with \textquotesingle{}}\NormalTok{, ls\_st\_xs, }\StringTok{\textquotesingle{} and binary \textquotesingle{}}\NormalTok{, svr\_binary, }\StringTok{\textquotesingle{} indicator, 1 is high\textquotesingle{}}\NormalTok{),}
           \DataTypeTok{y =} \KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}prediction with only \textquotesingle{}}\NormalTok{, ls\_st\_xs),}
           \DataTypeTok{caption =} \StringTok{\textquotesingle{}mtcars; prediction based on observed data\textquotesingle{}}\NormalTok{) }\OperatorTok{+}
\StringTok{      }\KeywordTok{theme\_bw}\NormalTok{()}
\KeywordTok{print}\NormalTok{(scatter)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{Panel-Data-and-Optimization-with-R_files/figure-latex/logit with binary and continuous RHS-1} \end{center}

\hypertarget{prediction-with-binary-set-to-0-and-1}{%
\paragraph{Prediction with Binary set to 0 and 1}\label{prediction-with-binary-set-to-0-and-1}}

Now generate two predictions. One set where binary input is equal to 0, and another where the binary inputs are equal to 1. Ignore whether in data binary input is equal to 0 or 1. Use the same regression results as what was just derived.

Note that given the example here, the probability changes a lot when we

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Previous regression results}
\KeywordTok{summary}\NormalTok{(rs\_logit\_bi)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## glm(formula = as.formula(paste(svr_outcome, "~ factor(", svr_binary, 
##     ") + ", paste(ls_st_xs, collapse = "+"))), family = "binomial", 
##     data = df_mtcars)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -1.45771  -0.09563  -0.00875   0.00555   1.87612  
## 
## Coefficients:
##                         Estimate Std. Error z value Pr(>|z|)  
## (Intercept)               3.8285    18.0390   0.212   0.8319  
## factor(hpLowHigh)HighHP   6.9907     5.5176   1.267   0.2052  
## mpg                       0.8985     0.8906   1.009   0.3131  
## wt                       -6.7291     3.3166  -2.029   0.0425 *
## vs                       -5.9206     4.1908  -1.413   0.1577  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 43.2297  on 31  degrees of freedom
## Residual deviance:  8.9777  on 27  degrees of freedom
## AIC: 18.978
## 
## Number of Fisher Scoring iterations: 9
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Two different dataframes, mutate the binary regressor}
\NormalTok{df\_mtcars\_bi0 \textless{}{-}}\StringTok{ }\NormalTok{df\_mtcars }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_binary) }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\NormalTok{svr\_binary\_lb0)}
\NormalTok{df\_mtcars\_bi1 \textless{}{-}}\StringTok{ }\NormalTok{df\_mtcars }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_binary) }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\NormalTok{svr\_binary\_lb1)}

\CommentTok{\# Predcit Using Regresion Data}
\NormalTok{df\_mtcars}\OperatorTok{$}\NormalTok{p\_mpg\_hp\_bi0 \textless{}{-}}\StringTok{ }\KeywordTok{predict}\NormalTok{(rs\_logit\_bi, }\DataTypeTok{newdata =}\NormalTok{ df\_mtcars\_bi0, }\DataTypeTok{type =} \StringTok{"response"}\NormalTok{)}
\NormalTok{df\_mtcars}\OperatorTok{$}\NormalTok{p\_mpg\_hp\_bi1 \textless{}{-}}\StringTok{ }\KeywordTok{predict}\NormalTok{(rs\_logit\_bi, }\DataTypeTok{newdata =}\NormalTok{ df\_mtcars\_bi1, }\DataTypeTok{type =} \StringTok{"response"}\NormalTok{)}

\CommentTok{\# Predicted Probabilities and Binary Input}
\NormalTok{scatter \textless{}{-}}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(df\_mtcars, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{p\_mpg\_hp\_bi0)) }\OperatorTok{+}
\StringTok{      }\KeywordTok{geom\_point}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{y=}\NormalTok{p\_mpg\_hp), }\DataTypeTok{size=}\DecValTok{4}\NormalTok{, }\DataTypeTok{shape=}\DecValTok{4}\NormalTok{, }\DataTypeTok{color=}\StringTok{"red"}\NormalTok{) }\OperatorTok{+}
\StringTok{      }\KeywordTok{geom\_point}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{y=}\NormalTok{p\_mpg\_hp\_bi1), }\DataTypeTok{size=}\DecValTok{2}\NormalTok{, }\DataTypeTok{shape=}\DecValTok{8}\NormalTok{) }\OperatorTok{+}
\StringTok{      }\CommentTok{\# geom\_smooth(method=lm) + \# Trend line}
\StringTok{      }\KeywordTok{geom\_abline}\NormalTok{(}\DataTypeTok{intercept =} \DecValTok{0}\NormalTok{, }\DataTypeTok{slope =} \DecValTok{1}\NormalTok{) }\OperatorTok{+}\StringTok{ }\CommentTok{\# 45 degree line}
\StringTok{      }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{title =} \KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}Predicted Probabilities and Binary Input\textquotesingle{}}\NormalTok{,}
                          \StringTok{\textquotesingle{}}\CharTok{\textbackslash{}n}\StringTok{cross(shape=4)/red is predict actual binary data\textquotesingle{}}\NormalTok{,}
                          \StringTok{\textquotesingle{}}\CharTok{\textbackslash{}n}\StringTok{star(shape=8)/black is predict set binary = 1 for all\textquotesingle{}}\NormalTok{),}
            \DataTypeTok{x =} \KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}prediction with \textquotesingle{}}\NormalTok{, ls\_st\_xs, }\StringTok{\textquotesingle{} and binary \textquotesingle{}}\NormalTok{, svr\_binary, }\StringTok{\textquotesingle{} = 0 for all\textquotesingle{}}\NormalTok{),}
            \DataTypeTok{y =} \KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}prediction with \textquotesingle{}}\NormalTok{, ls\_st\_xs, }\StringTok{\textquotesingle{} and binary \textquotesingle{}}\NormalTok{, svr\_binary, }\StringTok{\textquotesingle{} = 1\textquotesingle{}}\NormalTok{),}
           \DataTypeTok{caption =} \KeywordTok{paste0}\NormalTok{(sdt\_name)) }\OperatorTok{+}
\StringTok{      }\KeywordTok{theme\_bw}\NormalTok{()}
\KeywordTok{print}\NormalTok{(scatter)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{Panel-Data-and-Optimization-with-R_files/figure-latex/logit prediction 0 vs 1-1} \end{center}

\hypertarget{prediction-with-binary-set-to-0-and-1-difference}{%
\paragraph{Prediction with Binary set to 0 and 1 Difference}\label{prediction-with-binary-set-to-0-and-1-difference}}

What is the difference in probability between binary = 0 vs binary = 1. How does that relate to the probability of outcome of interest when binary = 0 for all.

In the binary logit case, the relationship will be hump--shaped by construction between \(A_i\) and \(\alpha_i\). In the exponential wage cases, the relationship is convex upwards.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Generate Gap Variable}
\NormalTok{df\_mtcars \textless{}{-}}\StringTok{ }\NormalTok{df\_mtcars }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{alpha\_i =}\NormalTok{ p\_mpg\_hp\_bi1 }\OperatorTok{{-}}\StringTok{ }\NormalTok{p\_mpg\_hp\_bi0) }\OperatorTok{\%\textgreater{}\%}
\StringTok{                }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{A\_i =}\NormalTok{ p\_mpg\_hp\_bi0)}

\CommentTok{\# Binary Marginal Effects and Prediction without Binary}
\NormalTok{scatter \textless{}{-}}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(df\_mtcars, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{A\_i)) }\OperatorTok{+}
\StringTok{      }\KeywordTok{geom\_point}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{y=}\NormalTok{alpha\_i), }\DataTypeTok{size=}\DecValTok{4}\NormalTok{, }\DataTypeTok{shape=}\DecValTok{4}\NormalTok{, }\DataTypeTok{color=}\StringTok{"red"}\NormalTok{) }\OperatorTok{+}
\StringTok{      }\KeywordTok{geom\_abline}\NormalTok{(}\DataTypeTok{intercept =} \DecValTok{0}\NormalTok{, }\DataTypeTok{slope =} \DecValTok{1}\NormalTok{) }\OperatorTok{+}\StringTok{ }\CommentTok{\# 45 degree line}
\StringTok{      }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{title =} \KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}Binary Marginal Effects and Prediction without Binary\textquotesingle{}}\NormalTok{),}
           \DataTypeTok{x =} \StringTok{\textquotesingle{}P(binary=0) for all\textquotesingle{}}\NormalTok{,}
           \DataTypeTok{y =} \StringTok{\textquotesingle{}P(binary=1) {-} P(binary=0) gap\textquotesingle{}}\NormalTok{,}
           \DataTypeTok{caption =} \KeywordTok{paste0}\NormalTok{(sdt\_name)) }\OperatorTok{+}
\StringTok{      }\KeywordTok{theme\_bw}\NormalTok{()}
\KeywordTok{print}\NormalTok{(scatter)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{Panel-Data-and-Optimization-with-R_files/figure-latex/logit prediction marginal vs base-1} \end{center}

\hypertarget{x-variables-and-a-and-alpha}{%
\paragraph{X variables and A and alpha}\label{x-variables-and-a-and-alpha}}

Given the x-variables included in the logit regression, how do they relate to A\_i and alpha\_i

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Generate Gap Variable}
\NormalTok{df\_mtcars \textless{}{-}}\StringTok{ }\NormalTok{df\_mtcars }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{alpha\_i =}\NormalTok{ p\_mpg\_hp\_bi1 }\OperatorTok{{-}}\StringTok{ }\NormalTok{p\_mpg\_hp\_bi0) }\OperatorTok{\%\textgreater{}\%}
\StringTok{                }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{A\_i =}\NormalTok{ p\_mpg\_hp\_bi0)}

\CommentTok{\# Binary Marginal Effects and Prediction without Binary}
\NormalTok{ggplot.A.alpha.x \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(svr\_x, df,}
                             \DataTypeTok{svr\_alpha =} \StringTok{\textquotesingle{}alpha\_i\textquotesingle{}}\NormalTok{, }\DataTypeTok{svr\_A =} \StringTok{"A\_i"}\NormalTok{)\{}

\NormalTok{  scatter \textless{}{-}}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(df, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_x))) }\OperatorTok{+}
\StringTok{        }\KeywordTok{geom\_point}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{y=}\NormalTok{alpha\_i), }\DataTypeTok{size=}\DecValTok{4}\NormalTok{, }\DataTypeTok{shape=}\DecValTok{4}\NormalTok{, }\DataTypeTok{color=}\StringTok{"red"}\NormalTok{) }\OperatorTok{+}
\StringTok{        }\KeywordTok{geom\_point}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{y=}\NormalTok{A\_i), }\DataTypeTok{size=}\DecValTok{2}\NormalTok{, }\DataTypeTok{shape=}\DecValTok{8}\NormalTok{, }\DataTypeTok{color=}\StringTok{"blue"}\NormalTok{) }\OperatorTok{+}
\StringTok{        }\KeywordTok{geom\_abline}\NormalTok{(}\DataTypeTok{intercept =} \DecValTok{0}\NormalTok{, }\DataTypeTok{slope =} \DecValTok{1}\NormalTok{) }\OperatorTok{+}\StringTok{ }\CommentTok{\# 45 degree line}
\StringTok{        }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{title =} \KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}A (blue) and alpha (red) vs x variables=\textquotesingle{}}\NormalTok{, svr\_x),}
             \DataTypeTok{x =}\NormalTok{ svr\_x,}
             \DataTypeTok{y =} \StringTok{\textquotesingle{}Probabilities\textquotesingle{}}\NormalTok{,}
             \DataTypeTok{caption =} \KeywordTok{paste0}\NormalTok{(sdt\_name)) }\OperatorTok{+}
\StringTok{        }\KeywordTok{theme\_bw}\NormalTok{()}

\KeywordTok{return}\NormalTok{(scatter)}
\NormalTok{\}}

\CommentTok{\# Plot over multiple}
\KeywordTok{lapply}\NormalTok{(ls\_st\_xs,}
\NormalTok{       ggplot.A.alpha.x,}
       \DataTypeTok{df =}\NormalTok{ df\_mtcars)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [[1]]
\end{verbatim}

\begin{center}\includegraphics{Panel-Data-and-Optimization-with-R_files/figure-latex/unnamed-chunk-157-1} \end{center}

\begin{verbatim}
## 
## [[2]]
\end{verbatim}

\begin{center}\includegraphics{Panel-Data-and-Optimization-with-R_files/figure-latex/unnamed-chunk-157-2} \end{center}

\begin{verbatim}
## 
## [[3]]
\end{verbatim}

\begin{center}\includegraphics{Panel-Data-and-Optimization-with-R_files/figure-latex/unnamed-chunk-157-3} \end{center}

\hypertarget{optimization}{%
\chapter{Optimization}\label{optimization}}

\hypertarget{bisection}{%
\section{Bisection}\label{bisection}}

\hypertarget{bisection-1}{%
\subsection{Bisection}\label{bisection-1}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

See the \href{https://fanwangecon.github.io/REconTools/reference/ff_opti_bisect_pmap_multi.html}{ff\_opti\_bisect\_pmap\_multi} function from \href{https://fanwangecon.github.io/}{Fan}'s \emph{\href{https://fanwangecon.github.io/REconTools/}{REconTools}} Package, which provides a resuable function based on the algorithm worked out here.

The bisection specific code does not need to do much.

\begin{itemize}
\tightlist
\item
  list variables in file for grouping, each group is an individual for whom we want to calculate optimal choice for using bisection.
\item
  string variable name of input where functions are evaluated, these are already contained in the dataframe, existing variable names, row specific, rowwise computation over these, each rowwise calculation using different rows.
\item
  scalar and array values that are applied to every rowwise calculation, all rowwise calculations using the same scalars and arrays.
\item
  string output variable name
\end{itemize}

This is how I implement the bisection algorithm, when we know the bounding minimum and maximum to be below and above zero already.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Evaluate \(f^0_a = f(a^0)\) and \(f^0_b = f(b^0)\), min and max points.
\item
  Evaluate at \(f^0_p = f(p^0)\), where \(p_0 = \frac{a^0+b^0}{2}\).
\item
  if \(f^i_a \cdot f^i_p < 0\), then \(b_{i+1} = p_i\), else, \(a_{i+1} = p_i\) and \(f^{i+1}_a = p_i\).
\item
  iteratre until convergence.
\end{enumerate}

Generate New columns of a and b as we iteratre, do not need to store p, p is temporary. Evaluate the function below which we have already tested, but now, in the dataframe before generating all permutations, \emph{tb\_states\_choices}, now the \emph{fl\_N} element will be changing with each iteration, it will be row specific. \emph{fl\_N} are first min and max, then each subsequent ps.

\hypertarget{initialize-matrix}{%
\subsubsection{Initialize Matrix}\label{initialize-matrix}}

Prepare Input Data:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Parameters}
\NormalTok{fl\_rho =}\StringTok{ }\FloatTok{0.20}
\NormalTok{svr\_id\_var =}\StringTok{ \textquotesingle{}INDI\_ID\textquotesingle{}}

\CommentTok{\# P fixed parameters, nN is N dimensional, nP is P dimensional}
\NormalTok{ar\_nN\_A =}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\OperatorTok{{-}}\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DataTypeTok{length.out =} \DecValTok{4}\NormalTok{)}
\NormalTok{ar\_nN\_alpha =}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\FloatTok{0.1}\NormalTok{, }\FloatTok{0.9}\NormalTok{, }\DataTypeTok{length.out =} \DecValTok{4}\NormalTok{)}

\CommentTok{\# Choice Grid for nutritional feasible choices for each}
\NormalTok{fl\_N\_agg =}\StringTok{ }\DecValTok{100}
\NormalTok{fl\_N\_min =}\StringTok{ }\DecValTok{0}

\CommentTok{\# Mesh Expand}
\NormalTok{tb\_states\_choices \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(ar\_nN\_A, ar\_nN\_alpha)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{rowid\_to\_column}\NormalTok{(}\DataTypeTok{var=}\NormalTok{svr\_id\_var)}

\CommentTok{\# Convert Matrix to Tibble}
\NormalTok{ar\_st\_col\_names =}\StringTok{ }\KeywordTok{c}\NormalTok{(svr\_id\_var,}\StringTok{\textquotesingle{}fl\_A\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}fl\_alpha\textquotesingle{}}\NormalTok{)}
\NormalTok{tb\_states\_choices \textless{}{-}}\StringTok{ }\NormalTok{tb\_states\_choices }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{rename\_all}\NormalTok{(}\OperatorTok{\textasciitilde{}}\KeywordTok{c}\NormalTok{(ar\_st\_col\_names))}
\end{Highlighting}
\end{Shaded}

Prepare Function:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Define Implicit Function}
\NormalTok{ffi\_nonlin\_dplyrdo \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(fl\_A, fl\_alpha, fl\_N, ar\_A, ar\_alpha, fl\_N\_agg, fl\_rho)\{}

\NormalTok{  ar\_p1\_s1 =}\StringTok{ }\KeywordTok{exp}\NormalTok{((fl\_A }\OperatorTok{{-}}\StringTok{ }\NormalTok{ar\_A)}\OperatorTok{*}\NormalTok{fl\_rho)}
\NormalTok{  ar\_p1\_s2 =}\StringTok{ }\NormalTok{(fl\_alpha}\OperatorTok{/}\NormalTok{ar\_alpha)}
\NormalTok{  ar\_p1\_s3 =}\StringTok{ }\NormalTok{(}\DecValTok{1}\OperatorTok{/}\NormalTok{(ar\_alpha}\OperatorTok{*}\NormalTok{fl\_rho }\OperatorTok{{-}}\StringTok{ }\DecValTok{1}\NormalTok{))}
\NormalTok{  ar\_p1 =}\StringTok{ }\NormalTok{(ar\_p1\_s1}\OperatorTok{*}\NormalTok{ar\_p1\_s2)}\OperatorTok{\^{}}\NormalTok{ar\_p1\_s3}
\NormalTok{  ar\_p2 =}\StringTok{ }\NormalTok{fl\_N}\OperatorTok{\^{}}\NormalTok{((fl\_alpha}\OperatorTok{*}\NormalTok{fl\_rho}\DecValTok{{-}1}\NormalTok{)}\OperatorTok{/}\NormalTok{(ar\_alpha}\OperatorTok{*}\NormalTok{fl\_rho}\DecValTok{{-}1}\NormalTok{))}
\NormalTok{  ar\_overall =}\StringTok{ }\NormalTok{ar\_p1}\OperatorTok{*}\NormalTok{ar\_p2}
\NormalTok{  fl\_overall =}\StringTok{ }\NormalTok{fl\_N\_agg }\OperatorTok{{-}}\StringTok{ }\KeywordTok{sum}\NormalTok{(ar\_overall)}

  \KeywordTok{return}\NormalTok{(fl\_overall)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Initialize the matrix with \(a_0\) and \(b_0\), the initial min and max points:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# common prefix to make reshaping easier}
\NormalTok{st\_bisec\_prefix \textless{}{-}}\StringTok{ \textquotesingle{}bisec\_\textquotesingle{}}
\NormalTok{svr\_a\_lst \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(st\_bisec\_prefix, }\StringTok{\textquotesingle{}a\_0\textquotesingle{}}\NormalTok{)}
\NormalTok{svr\_b\_lst \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(st\_bisec\_prefix, }\StringTok{\textquotesingle{}b\_0\textquotesingle{}}\NormalTok{)}
\NormalTok{svr\_fa\_lst \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(st\_bisec\_prefix, }\StringTok{\textquotesingle{}fa\_0\textquotesingle{}}\NormalTok{)}
\NormalTok{svr\_fb\_lst \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(st\_bisec\_prefix, }\StringTok{\textquotesingle{}fb\_0\textquotesingle{}}\NormalTok{)}

\CommentTok{\# Add initial a and b}
\NormalTok{tb\_states\_choices\_bisec \textless{}{-}}\StringTok{ }\NormalTok{tb\_states\_choices }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_a\_lst) }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\NormalTok{fl\_N\_min, }\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_b\_lst) }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\NormalTok{fl\_N\_agg)}

\CommentTok{\# Evaluate function f(a\_0) and f(b\_0)}
\NormalTok{tb\_states\_choices\_bisec \textless{}{-}}\StringTok{ }\NormalTok{tb\_states\_choices\_bisec }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rowwise}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_fa\_lst) }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\KeywordTok{ffi\_nonlin\_dplyrdo}\NormalTok{(fl\_A, fl\_alpha, }\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_a\_lst),}
\NormalTok{                                                ar\_nN\_A, ar\_nN\_alpha,}
\NormalTok{                                                fl\_N\_agg, fl\_rho),}
         \OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_fb\_lst) }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\KeywordTok{ffi\_nonlin\_dplyrdo}\NormalTok{(fl\_A, fl\_alpha, }\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_b\_lst),}
\NormalTok{                                                ar\_nN\_A, ar\_nN\_alpha,}
\NormalTok{                                                fl\_N\_agg, fl\_rho))}
\CommentTok{\# Summarize}
\KeywordTok{dim}\NormalTok{(tb\_states\_choices\_bisec)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 4 7
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# summary(tb\_states\_choices\_bisec)}
\end{Highlighting}
\end{Shaded}

\hypertarget{iterate-and-solve-for-fp-update-fa-and-fb}{%
\subsubsection{Iterate and Solve for f(p), update f(a) and f(b)}\label{iterate-and-solve-for-fp-update-fa-and-fb}}

Implement the DPLYR based Concurrent bisection algorithm.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# fl\_tol = float tolerance criteria}
\CommentTok{\# it\_tol = number of interations to allow at most}
\NormalTok{fl\_tol \textless{}{-}}\StringTok{ }\DecValTok{10}\OperatorTok{\^{}{-}}\DecValTok{2}
\NormalTok{it\_tol \textless{}{-}}\StringTok{ }\DecValTok{100}

\CommentTok{\# fl\_p\_dist2zr = distance to zero to initalize}
\NormalTok{fl\_p\_dist2zr \textless{}{-}}\StringTok{ }\DecValTok{1000}
\NormalTok{it\_cur \textless{}{-}}\StringTok{ }\DecValTok{0}
\ControlFlowTok{while}\NormalTok{ (it\_cur }\OperatorTok{\textless{}=}\StringTok{ }\NormalTok{it\_tol }\OperatorTok{\&\&}\StringTok{ }\NormalTok{fl\_p\_dist2zr }\OperatorTok{\textgreater{}=}\StringTok{ }\NormalTok{fl\_tol ) \{}

\NormalTok{  it\_cur \textless{}{-}}\StringTok{ }\NormalTok{it\_cur }\OperatorTok{+}\StringTok{ }\DecValTok{1}

  \CommentTok{\# New Variables}
\NormalTok{  svr\_a\_cur \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(st\_bisec\_prefix, }\StringTok{\textquotesingle{}a\_\textquotesingle{}}\NormalTok{, it\_cur)}
\NormalTok{  svr\_b\_cur \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(st\_bisec\_prefix, }\StringTok{\textquotesingle{}b\_\textquotesingle{}}\NormalTok{, it\_cur)}
\NormalTok{  svr\_fa\_cur \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(st\_bisec\_prefix, }\StringTok{\textquotesingle{}fa\_\textquotesingle{}}\NormalTok{, it\_cur)}
\NormalTok{  svr\_fb\_cur \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(st\_bisec\_prefix, }\StringTok{\textquotesingle{}fb\_\textquotesingle{}}\NormalTok{, it\_cur)}

  \CommentTok{\# Evaluate function f(a\_0) and f(b\_0)}
  \CommentTok{\# 1. generate p}
  \CommentTok{\# 2. generate f\_p}
  \CommentTok{\# 3. generate f\_p*f\_a}
\NormalTok{  tb\_states\_choices\_bisec \textless{}{-}}\StringTok{ }\NormalTok{tb\_states\_choices\_bisec }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{rowwise}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{p =}\NormalTok{ ((}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_a\_lst) }\OperatorTok{+}\StringTok{ }\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_b\_lst))}\OperatorTok{/}\DecValTok{2}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{f\_p =} \KeywordTok{ffi\_nonlin\_dplyrdo}\NormalTok{(fl\_A, fl\_alpha, p,}
\NormalTok{                                    ar\_nN\_A, ar\_nN\_alpha,}
\NormalTok{                                    fl\_N\_agg, fl\_rho)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{f\_p\_t\_f\_a =}\NormalTok{ f\_p}\OperatorTok{*!!}\KeywordTok{sym}\NormalTok{(svr\_fa\_lst))}
  \CommentTok{\# fl\_p\_dist2zr = sum(abs(p))}
\NormalTok{  fl\_p\_dist2zr \textless{}{-}}\StringTok{ }\KeywordTok{mean}\NormalTok{(}\KeywordTok{abs}\NormalTok{(tb\_states\_choices\_bisec }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{pull}\NormalTok{(f\_p)))}

  \CommentTok{\# Update a and b}
\NormalTok{  tb\_states\_choices\_bisec \textless{}{-}}\StringTok{ }\NormalTok{tb\_states\_choices\_bisec }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_a\_cur) }\OperatorTok{:}\ErrorTok{=}
\StringTok{             }\KeywordTok{case\_when}\NormalTok{(f\_p\_t\_f\_a }\OperatorTok{\textless{}}\StringTok{ }\DecValTok{0} \OperatorTok{\textasciitilde{}}\StringTok{ }\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_a\_lst),}
                       \OtherTok{TRUE} \OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{p)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_b\_cur) }\OperatorTok{:}\ErrorTok{=}
\StringTok{             }\KeywordTok{case\_when}\NormalTok{(f\_p\_t\_f\_a }\OperatorTok{\textless{}}\StringTok{ }\DecValTok{0} \OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{p,}
                       \OtherTok{TRUE} \OperatorTok{\textasciitilde{}}\StringTok{ }\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_b\_lst)))}
  \CommentTok{\# Update f(a) and f(b)}
\NormalTok{  tb\_states\_choices\_bisec \textless{}{-}}\StringTok{ }\NormalTok{tb\_states\_choices\_bisec }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_fa\_cur) }\OperatorTok{:}\ErrorTok{=}
\StringTok{             }\KeywordTok{case\_when}\NormalTok{(f\_p\_t\_f\_a }\OperatorTok{\textless{}}\StringTok{ }\DecValTok{0} \OperatorTok{\textasciitilde{}}\StringTok{ }\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_fa\_lst),}
                       \OtherTok{TRUE} \OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{f\_p)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_fb\_cur) }\OperatorTok{:}\ErrorTok{=}
\StringTok{             }\KeywordTok{case\_when}\NormalTok{(f\_p\_t\_f\_a }\OperatorTok{\textless{}}\StringTok{ }\DecValTok{0} \OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{f\_p,}
                       \OtherTok{TRUE} \OperatorTok{\textasciitilde{}}\StringTok{ }\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_fb\_lst)))}
  \CommentTok{\# Save from last}
\NormalTok{  svr\_a\_lst \textless{}{-}}\StringTok{ }\NormalTok{svr\_a\_cur}
\NormalTok{  svr\_b\_lst \textless{}{-}}\StringTok{ }\NormalTok{svr\_b\_cur}
\NormalTok{  svr\_fa\_lst \textless{}{-}}\StringTok{ }\NormalTok{svr\_fa\_cur}
\NormalTok{  svr\_fb\_lst \textless{}{-}}\StringTok{ }\NormalTok{svr\_fb\_cur}

  \CommentTok{\# Summar current round}
  \KeywordTok{print}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}it\_cur:\textquotesingle{}}\NormalTok{, it\_cur, }\StringTok{\textquotesingle{}, fl\_p\_dist2zr:\textquotesingle{}}\NormalTok{, fl\_p\_dist2zr))}
  \KeywordTok{summary}\NormalTok{(tb\_states\_choices\_bisec }\OperatorTok{\%\textgreater{}\%}
\StringTok{            }\KeywordTok{select}\NormalTok{(}\KeywordTok{one\_of}\NormalTok{(svr\_a\_cur, svr\_b\_cur, svr\_fa\_cur, svr\_fb\_cur)))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "it_cur:1, fl_p_dist2zr:1597.93916362849"
## [1] "it_cur:2, fl_p_dist2zr:676.06602535902"
## [1] "it_cur:3, fl_p_dist2zr:286.850590132782"
## [1] "it_cur:4, fl_p_dist2zr:117.225493866655"
## [1] "it_cur:5, fl_p_dist2zr:37.570593471664"
## [1] "it_cur:6, fl_p_dist2zr:4.60826664896022"
## [1] "it_cur:7, fl_p_dist2zr:14.4217689135683"
## [1] "it_cur:8, fl_p_dist2zr:8.38950830086659"
## [1] "it_cur:9, fl_p_dist2zr:3.93347761455868"
## [1] "it_cur:10, fl_p_dist2zr:1.88261338941038"
## [1] "it_cur:11, fl_p_dist2zr:0.744478952222305"
## [1] "it_cur:12, fl_p_dist2zr:0.187061801237917"
## [1] "it_cur:13, fl_p_dist2zr:0.117844913432613"
## [1] "it_cur:14, fl_p_dist2zr:0.0275365951418891"
## [1] "it_cur:15, fl_p_dist2zr:0.0515488156908255"
## [1] "it_cur:16, fl_p_dist2zr:0.0191152349149135"
## [1] "it_cur:17, fl_p_dist2zr:0.00385372194545752"
\end{verbatim}

\hypertarget{reshape-wide-to-long-to-wide}{%
\subsubsection{Reshape Wide to long to Wide}\label{reshape-wide-to-long-to-wide}}

To view results easily, how iterations improved to help us find the roots, convert table from wide to long. Pivot twice. This allows us to easily graph out how bisection is working out iterationby iteration.

Here, we will first show what the raw table looks like, the wide only table, and then show the long version, and finally the version that is medium wide.

\hypertarget{table-onevery-wide}{%
\paragraph{Table One--Very Wide}\label{table-onevery-wide}}

Show what the \emph{tb\_states\_choices\_bisec} looks like.

Variables are formatted like: \emph{bisec\_xx\_yy}, where yy is the iteration indicator, and xx is either a, b, fa, or fb.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{kable}\NormalTok{(}\KeywordTok{head}\NormalTok{(}\KeywordTok{t}\NormalTok{(tb\_states\_choices\_bisec), }\DecValTok{25}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{l|r|r|r|r}
\hline
INDI\_ID & 1.000000e+00 & 2.0000000 & 3.0000000 & 4.0000000\\
\hline
\rowcolor{gray!6}  fl\_A & -2.000000e+00 & -0.6666667 & 0.6666667 & 2.0000000\\
\hline
fl\_alpha & 1.000000e-01 & 0.3666667 & 0.6333333 & 0.9000000\\
\hline
\rowcolor{gray!6}  bisec\_a\_0 & 0.000000e+00 & 0.0000000 & 0.0000000 & 0.0000000\\
\hline
bisec\_b\_0 & 1.000000e+02 & 100.0000000 & 100.0000000 & 100.0000000\\
\hline
\rowcolor{gray!6}  bisec\_fa\_0 & 1.000000e+02 & 100.0000000 & 100.0000000 & 100.0000000\\
\hline
bisec\_fb\_0 & -1.288028e+04 & -1394.7069782 & -323.9421599 & -51.9716069\\
\hline
\rowcolor{gray!6}  p & 1.544952e+00 & 8.5838318 & 24.8359680 & 65.0367737\\
\hline
f\_p & -7.637200e-03 & -0.0052211 & -0.0016162 & -0.0009405\\
\hline
\rowcolor{gray!6}  f\_p\_t\_f\_a & -3.800000e-04 & -0.0000237 & -0.0000025 & -0.0000002\\
\hline
bisec\_a\_1 & 0.000000e+00 & 0.0000000 & 0.0000000 & 50.0000000\\
\hline
\rowcolor{gray!6}  bisec\_b\_1 & 5.000000e+01 & 50.0000000 & 50.0000000 & 100.0000000\\
\hline
bisec\_fa\_1 & 1.000000e+02 & 100.0000000 & 100.0000000 & 22.5557704\\
\hline
\rowcolor{gray!6}  bisec\_fb\_1 & -5.666956e+03 & -595.7345364 & -106.5105843 & -51.9716069\\
\hline
bisec\_a\_2 & 0.000000e+00 & 0.0000000 & 0.0000000 & 50.0000000\\
\hline
\rowcolor{gray!6}  bisec\_b\_2 & 2.500000e+01 & 25.0000000 & 25.0000000 & 75.0000000\\
\hline
bisec\_fa\_2 & 1.000000e+02 & 100.0000000 & 100.0000000 & 22.5557704\\
\hline
\rowcolor{gray!6}  bisec\_fb\_2 & -2.464562e+03 & -224.1460032 & -0.6857375 & -14.8701831\\
\hline
bisec\_a\_3 & 0.000000e+00 & 0.0000000 & 12.5000000 & 62.5000000\\
\hline
\rowcolor{gray!6}  bisec\_b\_3 & 1.250000e+01 & 12.5000000 & 25.0000000 & 75.0000000\\
\hline
bisec\_fa\_3 & 1.000000e+02 & 100.0000000 & 50.8640414 & 3.7940196\\
\hline
\rowcolor{gray!6}  bisec\_fb\_3 & -1.041574e+03 & -51.1700464 & -0.6857375 & -14.8701831\\
\hline
bisec\_a\_4 & 0.000000e+00 & 6.2500000 & 18.7500000 & 62.5000000\\
\hline
\rowcolor{gray!6}  bisec\_b\_4 & 6.250000e+00 & 12.5000000 & 25.0000000 & 68.7500000\\
\hline
bisec\_fa\_4 & 1.000000e+02 & 29.4271641 & 25.2510409 & 3.7940196\\
\hline
\end{tabular}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# str(tb\_states\_choices\_bisec)}
\end{Highlighting}
\end{Shaded}

\hypertarget{table-twovery-wide-to-very-long}{%
\paragraph{Table Two--Very Wide to Very Long}\label{table-twovery-wide-to-very-long}}

We want to treat the iteration count information that is the suffix of variable names as a variable by itself. Additionally, we want to treat the a,b,fa,fb as a variable. Structuring the data very long like this allows for easy graphing and other types of analysis. Rather than dealing with many many variables, we have only 3 core variables that store bisection iteration information.

Here we use the very nice \emph{pivot\_longer} function. Note that to achieve this, we put a common prefix in front of the variables we wanted to convert to long. THis is helpful, because we can easily identify which variables need to be reshaped.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# New variables}
\NormalTok{svr\_bisect\_iter \textless{}{-}}\StringTok{ \textquotesingle{}biseciter\textquotesingle{}}
\NormalTok{svr\_abfafb\_long\_name \textless{}{-}}\StringTok{ \textquotesingle{}varname\textquotesingle{}}
\NormalTok{svr\_number\_col \textless{}{-}}\StringTok{ \textquotesingle{}value\textquotesingle{}}
\NormalTok{svr\_id\_bisect\_iter \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(svr\_id\_var, }\StringTok{\textquotesingle{}\_bisect\_ier\textquotesingle{}}\NormalTok{)}

\CommentTok{\# Pivot wide to very long}
\NormalTok{tb\_states\_choices\_bisec\_long \textless{}{-}}\StringTok{ }\NormalTok{tb\_states\_choices\_bisec }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{pivot\_longer}\NormalTok{(}
    \DataTypeTok{cols =} \KeywordTok{starts\_with}\NormalTok{(st\_bisec\_prefix),}
    \DataTypeTok{names\_to =} \KeywordTok{c}\NormalTok{(svr\_abfafb\_long\_name, svr\_bisect\_iter),}
    \DataTypeTok{names\_pattern =} \KeywordTok{paste0}\NormalTok{(st\_bisec\_prefix, }\StringTok{"(.*)\_(.*)"}\NormalTok{),}
    \DataTypeTok{values\_to =}\NormalTok{ svr\_number\_col}
\NormalTok{  )}

\CommentTok{\# Print}
\CommentTok{\# summary(tb\_states\_choices\_bisec\_long)}
\KeywordTok{kable}\NormalTok{(}\KeywordTok{head}\NormalTok{(tb\_states\_choices\_bisec\_long }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{             }\KeywordTok{select}\NormalTok{(}\OperatorTok{{-}}\KeywordTok{one\_of}\NormalTok{(}\StringTok{\textquotesingle{}p\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}f\_p\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}f\_p\_t\_f\_a\textquotesingle{}}\NormalTok{)), }\DecValTok{15}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r|l|l|r}
\hline
INDI\_ID & fl\_A & fl\_alpha & varname & biseciter & value\\
\hline
\rowcolor{gray!6}  1 & -2 & 0.1 & a & 0 & 0.000\\
\hline
1 & -2 & 0.1 & b & 0 & 100.000\\
\hline
\rowcolor{gray!6}  1 & -2 & 0.1 & fa & 0 & 100.000\\
\hline
1 & -2 & 0.1 & fb & 0 & -12880.284\\
\hline
\rowcolor{gray!6}  1 & -2 & 0.1 & a & 1 & 0.000\\
\hline
1 & -2 & 0.1 & b & 1 & 50.000\\
\hline
\rowcolor{gray!6}  1 & -2 & 0.1 & fa & 1 & 100.000\\
\hline
1 & -2 & 0.1 & fb & 1 & -5666.956\\
\hline
\rowcolor{gray!6}  1 & -2 & 0.1 & a & 2 & 0.000\\
\hline
1 & -2 & 0.1 & b & 2 & 25.000\\
\hline
\rowcolor{gray!6}  1 & -2 & 0.1 & fa & 2 & 100.000\\
\hline
1 & -2 & 0.1 & fb & 2 & -2464.562\\
\hline
\rowcolor{gray!6}  1 & -2 & 0.1 & a & 3 & 0.000\\
\hline
1 & -2 & 0.1 & b & 3 & 12.500\\
\hline
\rowcolor{gray!6}  1 & -2 & 0.1 & fa & 3 & 100.000\\
\hline
\end{tabular}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{kable}\NormalTok{(}\KeywordTok{tail}\NormalTok{(tb\_states\_choices\_bisec\_long }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{             }\KeywordTok{select}\NormalTok{(}\OperatorTok{{-}}\KeywordTok{one\_of}\NormalTok{(}\StringTok{\textquotesingle{}p\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}f\_p\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}f\_p\_t\_f\_a\textquotesingle{}}\NormalTok{)), }\DecValTok{15}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{kable\_styling\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\begin{tabular}{r|r|r|l|l|r}
\hline
INDI\_ID & fl\_A & fl\_alpha & varname & biseciter & value\\
\hline
\rowcolor{gray!6}  4 & 2 & 0.9 & b & 14 & 65.0390625\\
\hline
4 & 2 & 0.9 & fa & 14 & 0.0047633\\
\hline
\rowcolor{gray!6}  4 & 2 & 0.9 & fb & 14 & -0.0043628\\
\hline
4 & 2 & 0.9 & a & 15 & 65.0360107\\
\hline
\rowcolor{gray!6}  4 & 2 & 0.9 & b & 15 & 65.0390625\\
\hline
4 & 2 & 0.9 & fa & 15 & 0.0002003\\
\hline
\rowcolor{gray!6}  4 & 2 & 0.9 & fb & 15 & -0.0043628\\
\hline
4 & 2 & 0.9 & a & 16 & 65.0360107\\
\hline
\rowcolor{gray!6}  4 & 2 & 0.9 & b & 16 & 65.0375366\\
\hline
4 & 2 & 0.9 & fa & 16 & 0.0002003\\
\hline
\rowcolor{gray!6}  4 & 2 & 0.9 & fb & 16 & -0.0020812\\
\hline
4 & 2 & 0.9 & a & 17 & 65.0360107\\
\hline
\rowcolor{gray!6}  4 & 2 & 0.9 & b & 17 & 65.0367737\\
\hline
4 & 2 & 0.9 & fa & 17 & 0.0002003\\
\hline
\rowcolor{gray!6}  4 & 2 & 0.9 & fb & 17 & -0.0009405\\
\hline
\end{tabular}
\end{table}

\hypertarget{table-twovery-very-long-to-wider-again}{%
\paragraph{Table Two--Very Very Long to Wider Again}\label{table-twovery-very-long-to-wider-again}}

But the previous results are too long, with the a, b, fa, and fb all in one column as different categories, they are really not different categories, they are in fact different types of variables. So we want to spread those four categories of this variable into four columns, each one representing the a, b, fa, and fb values. The rows would then be uniquly identified by the iteration counter and individual ID.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Pivot wide to very long to a little wide}
\NormalTok{tb\_states\_choices\_bisec\_wider \textless{}{-}}\StringTok{ }\NormalTok{tb\_states\_choices\_bisec\_long }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{pivot\_wider}\NormalTok{(}
    \DataTypeTok{names\_from =} \OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_abfafb\_long\_name),}
    \DataTypeTok{values\_from =}\NormalTok{ svr\_number\_col}
\NormalTok{  )}

\CommentTok{\# Print}
\CommentTok{\# summary(tb\_states\_choices\_bisec\_wider)}
\KeywordTok{kable}\NormalTok{(}\KeywordTok{head}\NormalTok{(tb\_states\_choices\_bisec\_wider }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{              }\KeywordTok{select}\NormalTok{(}\OperatorTok{{-}}\KeywordTok{one\_of}\NormalTok{(}\StringTok{\textquotesingle{}p\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}f\_p\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}f\_p\_t\_f\_a\textquotesingle{}}\NormalTok{)), }\DecValTok{10}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{kable\_styling\_fc\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{r|r|r|l|r|r|r|r}
\hline
INDI\_ID & fl\_A & fl\_alpha & biseciter & a & b & fa & fb\\
\hline
\rowcolor{gray!6}  1 & -2 & 0.1 & 0 & 0.000000 & 100.0000 & 100.00000 & -12880.283918\\
\hline
1 & -2 & 0.1 & 1 & 0.000000 & 50.0000 & 100.00000 & -5666.955763\\
\hline
\rowcolor{gray!6}  1 & -2 & 0.1 & 2 & 0.000000 & 25.0000 & 100.00000 & -2464.562178\\
\hline
1 & -2 & 0.1 & 3 & 0.000000 & 12.5000 & 100.00000 & -1041.574253\\
\hline
\rowcolor{gray!6}  1 & -2 & 0.1 & 4 & 0.000000 & 6.2500 & 100.00000 & -408.674764\\
\hline
1 & -2 & 0.1 & 5 & 0.000000 & 3.1250 & 100.00000 & -126.904283\\
\hline
\rowcolor{gray!6}  1 & -2 & 0.1 & 6 & 0.000000 & 1.5625 & 100.00000 & -1.328965\\
\hline
1 & -2 & 0.1 & 7 & 0.781250 & 1.5625 & 54.69612 & -1.328965\\
\hline
\rowcolor{gray!6}  1 & -2 & 0.1 & 8 & 1.171875 & 1.5625 & 27.46061 & -1.328965\\
\hline
1 & -2 & 0.1 & 9 & 1.367188 & 1.5625 & 13.23495 & -1.328965\\
\hline
\end{tabular}}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{kable}\NormalTok{(}\KeywordTok{head}\NormalTok{(tb\_states\_choices\_bisec\_wider }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{              }\KeywordTok{select}\NormalTok{(}\OperatorTok{{-}}\KeywordTok{one\_of}\NormalTok{(}\StringTok{\textquotesingle{}p\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}f\_p\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}f\_p\_t\_f\_a\textquotesingle{}}\NormalTok{)), }\DecValTok{10}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{kable\_styling\_fc\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{r|r|r|l|r|r|r|r}
\hline
INDI\_ID & fl\_A & fl\_alpha & biseciter & a & b & fa & fb\\
\hline
\rowcolor{gray!6}  1 & -2 & 0.1 & 0 & 0.000000 & 100.0000 & 100.00000 & -12880.283918\\
\hline
1 & -2 & 0.1 & 1 & 0.000000 & 50.0000 & 100.00000 & -5666.955763\\
\hline
\rowcolor{gray!6}  1 & -2 & 0.1 & 2 & 0.000000 & 25.0000 & 100.00000 & -2464.562178\\
\hline
1 & -2 & 0.1 & 3 & 0.000000 & 12.5000 & 100.00000 & -1041.574253\\
\hline
\rowcolor{gray!6}  1 & -2 & 0.1 & 4 & 0.000000 & 6.2500 & 100.00000 & -408.674764\\
\hline
1 & -2 & 0.1 & 5 & 0.000000 & 3.1250 & 100.00000 & -126.904283\\
\hline
\rowcolor{gray!6}  1 & -2 & 0.1 & 6 & 0.000000 & 1.5625 & 100.00000 & -1.328965\\
\hline
1 & -2 & 0.1 & 7 & 0.781250 & 1.5625 & 54.69612 & -1.328965\\
\hline
\rowcolor{gray!6}  1 & -2 & 0.1 & 8 & 1.171875 & 1.5625 & 27.46061 & -1.328965\\
\hline
1 & -2 & 0.1 & 9 & 1.367188 & 1.5625 & 13.23495 & -1.328965\\
\hline
\end{tabular}}
\end{table}

\hypertarget{graph-bisection-iteration-results}{%
\subsubsection{Graph Bisection Iteration Results}\label{graph-bisection-iteration-results}}

Actually we want to graph based on the long results, not the wider. Wider easier to view in table.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Graph results}
\NormalTok{lineplot \textless{}{-}}\StringTok{ }\NormalTok{tb\_states\_choices\_bisec\_long }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_bisect\_iter) }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_bisect\_iter))) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_abfafb\_long\_name) }\OperatorTok{\%in\%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}a\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}b\textquotesingle{}}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_bisect\_iter), }\DataTypeTok{y=}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_number\_col),}
               \DataTypeTok{colour=}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_abfafb\_long\_name),}
               \DataTypeTok{linetype=}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_abfafb\_long\_name),}
               \DataTypeTok{shape=}\OperatorTok{!!}\KeywordTok{sym}\NormalTok{(svr\_abfafb\_long\_name))) }\OperatorTok{+}
\StringTok{        }\KeywordTok{facet\_wrap}\NormalTok{( }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{INDI\_ID) }\OperatorTok{+}
\StringTok{        }\KeywordTok{geom\_line}\NormalTok{() }\OperatorTok{+}
\StringTok{        }\KeywordTok{geom\_point}\NormalTok{() }\OperatorTok{+}
\StringTok{        }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{title =} \StringTok{\textquotesingle{}Bisection Iteration over individuals Until Convergence\textquotesingle{}}\NormalTok{,}
             \DataTypeTok{x =} \StringTok{\textquotesingle{}Bisection Iteration\textquotesingle{}}\NormalTok{,}
             \DataTypeTok{y =} \StringTok{\textquotesingle{}a (left side point) and b (right side point) values\textquotesingle{}}\NormalTok{,}
             \DataTypeTok{caption =} \StringTok{\textquotesingle{}DPLYR concurrent bisection nonlinear multple individuals\textquotesingle{}}\NormalTok{) }\OperatorTok{+}
\StringTok{      }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{axis.text.x =} \KeywordTok{element\_text}\NormalTok{(}\DataTypeTok{angle =} \DecValTok{90}\NormalTok{, }\DataTypeTok{hjust =} \DecValTok{1}\NormalTok{))}
\KeywordTok{print}\NormalTok{(lineplot)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{Panel-Data-and-Optimization-with-R_files/figure-latex/reshape solution for graphing-1} \end{center}

\hypertarget{mathmatics-and-statistics}{%
\chapter{Mathmatics and Statistics}\label{mathmatics-and-statistics}}

\hypertarget{distributions}{%
\section{Distributions}\label{distributions}}

\hypertarget{integrate-over-normal-guassian-process-shock}{%
\subsection{Integrate Over Normal Guassian Process Shock}\label{integrate-over-normal-guassian-process-shock}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

Some Common parameters

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fl\_eps\_mean =}\StringTok{ }\DecValTok{10}
\NormalTok{fl\_eps\_sd =}\StringTok{ }\DecValTok{50}
\NormalTok{fl\_cdf\_min =}\StringTok{ }\FloatTok{0.000001}
\NormalTok{fl\_cdf\_max =}\StringTok{ }\FloatTok{0.999999}
\NormalTok{ar\_it\_draws \textless{}{-}}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{1000}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{randomly-sample-and-integrate-monte-carlo-integration}{%
\subsubsection{Randomly Sample and Integrate (Monte Carlo Integration)}\label{randomly-sample-and-integrate-monte-carlo-integration}}

Compare randomly drawn normal shock mean and known mean. How does simulated mean change with draws. Actual integral equals to \(10\), as sample size increases, the sample mean approaches the integration results, but this is expensive, even with ten thousand draws, not very exact.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Simulate Draws}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{123}\NormalTok{)}
\NormalTok{ar\_fl\_means \textless{}{-}}
\StringTok{  }\KeywordTok{sapply}\NormalTok{(ar\_it\_draws, }\ControlFlowTok{function}\NormalTok{(x)}
    \KeywordTok{return}\NormalTok{(}\KeywordTok{mean}\NormalTok{(}\KeywordTok{rnorm}\NormalTok{(x[}\DecValTok{1}\NormalTok{], }\DataTypeTok{mean=}\NormalTok{fl\_eps\_mean, }\DataTypeTok{sd=}\NormalTok{fl\_eps\_sd))))}
\NormalTok{ar\_fl\_sd \textless{}{-}}
\StringTok{  }\KeywordTok{sapply}\NormalTok{(ar\_it\_draws, }\ControlFlowTok{function}\NormalTok{(x)}
    \KeywordTok{return}\NormalTok{(}\KeywordTok{sd}\NormalTok{(}\KeywordTok{rnorm}\NormalTok{(x[}\DecValTok{1}\NormalTok{], }\DataTypeTok{mean=}\NormalTok{fl\_eps\_mean, }\DataTypeTok{sd=}\NormalTok{fl\_eps\_sd))))}

\NormalTok{mt\_sample\_means \textless{}{-}}\StringTok{ }\KeywordTok{cbind}\NormalTok{(ar\_it\_draws, ar\_fl\_means, ar\_fl\_sd)}
\KeywordTok{colnames}\NormalTok{(mt\_sample\_means) \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}draw\_count\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}mean\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}sd\textquotesingle{}}\NormalTok{)}
\NormalTok{tb\_sample\_means \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(mt\_sample\_means)}

\CommentTok{\# Graph}
\CommentTok{\# x{-}labels}
\NormalTok{x.labels \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}n=1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}n=10\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}n=100\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}n=1000\textquotesingle{}}\NormalTok{)}
\NormalTok{x.breaks \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{100}\NormalTok{, }\DecValTok{1000}\NormalTok{)}

\CommentTok{\# Shared Subtitle}
\NormalTok{st\_subtitle \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}https://fanwangecon.github.io/\textquotesingle{}}\NormalTok{,}
                      \StringTok{\textquotesingle{}R4Econ/math/integration/htmlpdfr/fs\_integrate\_normal.html\textquotesingle{}}\NormalTok{)}

\CommentTok{\# Shared Labels}
\NormalTok{slb\_title\_shr =}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}as Sample Size Increases}\CharTok{\textbackslash{}n}\StringTok{\textquotesingle{}}\NormalTok{,}
                       \StringTok{\textquotesingle{}True Mean=\textquotesingle{}}\NormalTok{, fl\_eps\_mean,}\StringTok{\textquotesingle{}, sd=\textquotesingle{}}\NormalTok{,fl\_eps\_sd)}
\NormalTok{slb\_xtitle =}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}Sample Size\textquotesingle{}}\NormalTok{)}

\CommentTok{\# Graph Results{-}{-}Draw}
\NormalTok{plt\_mean \textless{}{-}}\StringTok{ }\NormalTok{tb\_sample\_means }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{draw\_count, }\DataTypeTok{y=}\NormalTok{mean)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom\_line}\NormalTok{(}\DataTypeTok{size=}\FloatTok{0.75}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{title =} \KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}Sample Mean \textquotesingle{}}\NormalTok{, slb\_title\_shr),}
       \DataTypeTok{subtitle =}\NormalTok{ st\_subtitle,}
       \DataTypeTok{x =}\NormalTok{ slb\_xtitle,}
       \DataTypeTok{y =} \StringTok{\textquotesingle{}Sample Mean\textquotesingle{}}\NormalTok{,}
       \DataTypeTok{caption =} \StringTok{\textquotesingle{}Mean of Sample Integrates to True Mean\textquotesingle{}}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale\_x\_continuous}\NormalTok{(}\DataTypeTok{trans=}\StringTok{\textquotesingle{}log10\textquotesingle{}}\NormalTok{, }\DataTypeTok{labels =}\NormalTok{ x.labels, }\DataTypeTok{breaks =}\NormalTok{ x.breaks) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme\_bw}\NormalTok{()}
\KeywordTok{print}\NormalTok{(plt\_mean)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{Panel-Data-and-Optimization-with-R_files/figure-latex/unnamed-chunk-165-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{plt\_sd \textless{}{-}}\StringTok{ }\NormalTok{tb\_sample\_means }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{draw\_count, }\DataTypeTok{y=}\NormalTok{sd)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom\_line}\NormalTok{(}\DataTypeTok{size=}\FloatTok{0.75}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{title =} \KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}Sample Standard Deviation \textquotesingle{}}\NormalTok{, slb\_title\_shr),}
       \DataTypeTok{subtitle =}\NormalTok{ st\_subtitle,}
       \DataTypeTok{x =}\NormalTok{ slb\_xtitle,}
       \DataTypeTok{y =} \StringTok{\textquotesingle{}Sample Standard Deviation\textquotesingle{}}\NormalTok{,}
       \DataTypeTok{caption =} \StringTok{\textquotesingle{}Standard Deviation of Sample Integrates to True SD\textquotesingle{}}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale\_x\_continuous}\NormalTok{(}\DataTypeTok{trans=}\StringTok{\textquotesingle{}log10\textquotesingle{}}\NormalTok{, }\DataTypeTok{labels =}\NormalTok{ x.labels, }\DataTypeTok{breaks =}\NormalTok{ x.breaks) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme\_bw}\NormalTok{()}
\KeywordTok{print}\NormalTok{(plt\_sd)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{Panel-Data-and-Optimization-with-R_files/figure-latex/unnamed-chunk-165-2} \end{center}

\hypertarget{integration-by-symmetric-uneven-rectangle}{%
\subsubsection{Integration By Symmetric Uneven Rectangle}\label{integration-by-symmetric-uneven-rectangle}}

Draw on even grid from close to 0 to close to 1. Get the corresponding x points to these quantile levels. Distance between x points are not equi-distance but increasing and symmetric away from the mean. Under this approach, each rectangle aims to approximate the same area.

Resulting integration is rectangle based, but rectangle width differ. The rectangles have wider width as they move away from the mean, and thinner width close to the mean. This is much more stable than the random draw method, but note that it converges somewhat slowly to true values as well.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mt\_fl\_means \textless{}{-}}
\StringTok{  }\KeywordTok{sapply}\NormalTok{(ar\_it\_draws, }\ControlFlowTok{function}\NormalTok{(x) \{}

\NormalTok{    fl\_prob\_break =}\StringTok{ }\NormalTok{(fl\_cdf\_max }\OperatorTok{{-}}\StringTok{ }\NormalTok{fl\_cdf\_min)}\OperatorTok{/}\NormalTok{(x[}\DecValTok{1}\NormalTok{])}
\NormalTok{    ar\_eps\_bounds \textless{}{-}}\StringTok{ }\KeywordTok{qnorm}\NormalTok{(}\KeywordTok{seq}\NormalTok{(fl\_cdf\_min, fl\_cdf\_max,}
                               \DataTypeTok{by=}\NormalTok{(fl\_cdf\_max }\OperatorTok{{-}}\StringTok{ }\NormalTok{fl\_cdf\_min)}\OperatorTok{/}\NormalTok{(x[}\DecValTok{1}\NormalTok{])),}
                           \DataTypeTok{mean =}\NormalTok{ fl\_eps\_mean, }\DataTypeTok{sd =}\NormalTok{ fl\_eps\_sd)}
\NormalTok{    ar\_eps\_val \textless{}{-}}\StringTok{ }\NormalTok{(}\KeywordTok{tail}\NormalTok{(ar\_eps\_bounds, }\DecValTok{{-}1}\NormalTok{) }\OperatorTok{+}\StringTok{ }\KeywordTok{head}\NormalTok{(ar\_eps\_bounds, }\DecValTok{{-}1}\NormalTok{))}\OperatorTok{/}\DecValTok{2}
\NormalTok{    ar\_eps\_prb \textless{}{-}}\StringTok{ }\KeywordTok{rep}\NormalTok{(fl\_prob\_break}\OperatorTok{/}\NormalTok{(fl\_cdf\_max }\OperatorTok{{-}}\StringTok{ }\NormalTok{fl\_cdf\_min), x[}\DecValTok{1}\NormalTok{])}
\NormalTok{    ar\_eps\_fev \textless{}{-}}\StringTok{ }\KeywordTok{dnorm}\NormalTok{(ar\_eps\_val,}
                        \DataTypeTok{mean =}\NormalTok{ fl\_eps\_mean, }\DataTypeTok{sd =}\NormalTok{ fl\_eps\_sd)}

\NormalTok{    fl\_cdf\_total\_approx \textless{}{-}}\StringTok{ }\KeywordTok{sum}\NormalTok{(ar\_eps\_fev}\OperatorTok{*}\KeywordTok{diff}\NormalTok{(ar\_eps\_bounds))}
\NormalTok{    fl\_mean\_approx \textless{}{-}}\StringTok{ }\KeywordTok{sum}\NormalTok{(ar\_eps\_val}\OperatorTok{*}\NormalTok{(ar\_eps\_fev}\OperatorTok{*}\KeywordTok{diff}\NormalTok{(ar\_eps\_bounds)))}
\NormalTok{    fl\_sd\_approx \textless{}{-}}\StringTok{ }\KeywordTok{sqrt}\NormalTok{(}\KeywordTok{sum}\NormalTok{((ar\_eps\_val}\OperatorTok{{-}}\NormalTok{fl\_mean\_approx)}\OperatorTok{\^{}}\DecValTok{2}\OperatorTok{*}\NormalTok{(ar\_eps\_fev}\OperatorTok{*}\KeywordTok{diff}\NormalTok{(ar\_eps\_bounds))))}

    \KeywordTok{return}\NormalTok{(}\KeywordTok{list}\NormalTok{(}\DataTypeTok{cdf=}\NormalTok{fl\_cdf\_total\_approx, }\DataTypeTok{mean=}\NormalTok{fl\_mean\_approx, }\DataTypeTok{sd=}\NormalTok{fl\_sd\_approx))}
\NormalTok{  \})}

\NormalTok{mt\_sample\_means \textless{}{-}}\StringTok{ }\KeywordTok{cbind}\NormalTok{(ar\_it\_draws, }\KeywordTok{as\_tibble}\NormalTok{(}\KeywordTok{t}\NormalTok{(mt\_fl\_means)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{unnest}\NormalTok{())}
\KeywordTok{colnames}\NormalTok{(mt\_sample\_means) \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}draw\_count\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}cdf\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}mean\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}sd\textquotesingle{}}\NormalTok{)}
\NormalTok{tb\_sample\_means \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(mt\_sample\_means)}

\CommentTok{\# Graph}
\CommentTok{\# x{-}labels}
\NormalTok{x.labels \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}n=1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}n=10\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}n=100\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}n=1000\textquotesingle{}}\NormalTok{)}
\NormalTok{x.breaks \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{100}\NormalTok{, }\DecValTok{1000}\NormalTok{)}

\CommentTok{\# Shared Labels}
\NormalTok{slb\_title\_shr =}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}as Uneven Rectangle Count Increases}\CharTok{\textbackslash{}n}\StringTok{\textquotesingle{}}\NormalTok{,}
                       \StringTok{\textquotesingle{}True Mean=\textquotesingle{}}\NormalTok{, fl\_eps\_mean,}\StringTok{\textquotesingle{}, sd=\textquotesingle{}}\NormalTok{,fl\_eps\_sd)}
\NormalTok{slb\_xtitle =}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}Number of Quantile Bins for Uneven Rectangles Approximation\textquotesingle{}}\NormalTok{)}

\CommentTok{\# Graph Results{-}{-}Draw}
\NormalTok{plt\_mean \textless{}{-}}\StringTok{ }\NormalTok{tb\_sample\_means }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{draw\_count, }\DataTypeTok{y=}\NormalTok{mean)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom\_line}\NormalTok{(}\DataTypeTok{size=}\FloatTok{0.75}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{title =} \KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}Average \textquotesingle{}}\NormalTok{, slb\_title\_shr),}
       \DataTypeTok{subtitle =}\NormalTok{ st\_subtitle,}
       \DataTypeTok{x =}\NormalTok{ slb\_xtitle,}
       \DataTypeTok{y =} \StringTok{\textquotesingle{}Approximated Mean\textquotesingle{}}\NormalTok{,}
       \DataTypeTok{caption =} \StringTok{\textquotesingle{}Integral Approximation as Uneven Rectangle Count Increases\textquotesingle{}}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale\_x\_continuous}\NormalTok{(}\DataTypeTok{trans=}\StringTok{\textquotesingle{}log10\textquotesingle{}}\NormalTok{, }\DataTypeTok{labels =}\NormalTok{ x.labels, }\DataTypeTok{breaks =}\NormalTok{ x.breaks) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme\_bw}\NormalTok{()}
\KeywordTok{print}\NormalTok{(plt\_mean)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{Panel-Data-and-Optimization-with-R_files/figure-latex/unnamed-chunk-166-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{plt\_sd \textless{}{-}}\StringTok{ }\NormalTok{tb\_sample\_means }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{draw\_count, }\DataTypeTok{y=}\NormalTok{sd)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom\_line}\NormalTok{(}\DataTypeTok{size=}\FloatTok{0.75}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{title =} \KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}Standard Deviation \textquotesingle{}}\NormalTok{, slb\_title\_shr),}
       \DataTypeTok{subtitle =}\NormalTok{ st\_subtitle,}
       \DataTypeTok{x =}\NormalTok{ slb\_xtitle,}
       \DataTypeTok{y =} \StringTok{\textquotesingle{}Approximated Standard Deviation\textquotesingle{}}\NormalTok{,}
       \DataTypeTok{caption =} \StringTok{\textquotesingle{}Integral Approximation as Uneven Rectangle Count Increases\textquotesingle{}}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale\_x\_continuous}\NormalTok{(}\DataTypeTok{trans=}\StringTok{\textquotesingle{}log10\textquotesingle{}}\NormalTok{, }\DataTypeTok{labels =}\NormalTok{ x.labels, }\DataTypeTok{breaks =}\NormalTok{ x.breaks) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme\_bw}\NormalTok{()}
\KeywordTok{print}\NormalTok{(plt\_sd)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{Panel-Data-and-Optimization-with-R_files/figure-latex/unnamed-chunk-166-2} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{plt\_cdf \textless{}{-}}\StringTok{ }\NormalTok{tb\_sample\_means }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{draw\_count, }\DataTypeTok{y=}\NormalTok{cdf)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom\_line}\NormalTok{(}\DataTypeTok{size=}\FloatTok{0.75}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{title =} \KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}Aggregate Probability \textquotesingle{}}\NormalTok{, slb\_title\_shr),}
       \DataTypeTok{subtitle =}\NormalTok{ st\_subtitle,}
       \DataTypeTok{x =}\NormalTok{ slb\_xtitle,}
       \DataTypeTok{y =} \StringTok{\textquotesingle{}Sum of Uneven Rectangles\textquotesingle{}}\NormalTok{,}
       \DataTypeTok{caption =} \StringTok{\textquotesingle{}Sum of Approx. Probability as Uneven Rectangle Count Increases\textquotesingle{}}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale\_x\_continuous}\NormalTok{(}\DataTypeTok{trans=}\StringTok{\textquotesingle{}log10\textquotesingle{}}\NormalTok{, }\DataTypeTok{labels =}\NormalTok{ x.labels, }\DataTypeTok{breaks =}\NormalTok{ x.breaks) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme\_bw}\NormalTok{()}
\KeywordTok{print}\NormalTok{(plt\_cdf)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{Panel-Data-and-Optimization-with-R_files/figure-latex/unnamed-chunk-166-3} \end{center}

\hypertarget{integration-by-constant-width-rectangle-trapezoidal-rule}{%
\subsubsection{Integration By Constant Width Rectangle (Trapezoidal rule)}\label{integration-by-constant-width-rectangle-trapezoidal-rule}}

This is implementing even width recentagle, even along x-axix. Rectangle width are the same, height is \(f(x)\). This is even width, but uneven area. Note that this method approximates the true answer much better and more quickly than the prior methods.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mt\_fl\_means \textless{}{-}}
\StringTok{  }\KeywordTok{sapply}\NormalTok{(ar\_it\_draws, }\ControlFlowTok{function}\NormalTok{(x) \{}

\NormalTok{    fl\_eps\_min \textless{}{-}}\StringTok{ }\KeywordTok{qnorm}\NormalTok{(fl\_cdf\_min, }\DataTypeTok{mean =}\NormalTok{ fl\_eps\_mean, }\DataTypeTok{sd =}\NormalTok{ fl\_eps\_sd)}
\NormalTok{    fl\_eps\_max \textless{}{-}}\StringTok{ }\KeywordTok{qnorm}\NormalTok{(fl\_cdf\_max, }\DataTypeTok{mean =}\NormalTok{ fl\_eps\_mean, }\DataTypeTok{sd =}\NormalTok{ fl\_eps\_sd)}
\NormalTok{    fl\_gap \textless{}{-}}\StringTok{ }\NormalTok{(fl\_eps\_max}\OperatorTok{{-}}\NormalTok{fl\_eps\_min)}\OperatorTok{/}\NormalTok{(x[}\DecValTok{1}\NormalTok{])}
\NormalTok{    ar\_eps\_bounds \textless{}{-}}\StringTok{ }\KeywordTok{seq}\NormalTok{(fl\_eps\_min, fl\_eps\_max, }\DataTypeTok{by=}\NormalTok{fl\_gap)}
\NormalTok{    ar\_eps\_val \textless{}{-}}\StringTok{ }\NormalTok{(}\KeywordTok{tail}\NormalTok{(ar\_eps\_bounds, }\DecValTok{{-}1}\NormalTok{) }\OperatorTok{+}\StringTok{ }\KeywordTok{head}\NormalTok{(ar\_eps\_bounds, }\DecValTok{{-}1}\NormalTok{))}\OperatorTok{/}\DecValTok{2}
\NormalTok{    ar\_eps\_prb \textless{}{-}}\StringTok{ }\KeywordTok{dnorm}\NormalTok{(ar\_eps\_val, }\DataTypeTok{mean =}\NormalTok{ fl\_eps\_mean, }\DataTypeTok{sd =}\NormalTok{ fl\_eps\_sd)}\OperatorTok{*}\NormalTok{fl\_gap}

\NormalTok{    fl\_cdf\_total\_approx \textless{}{-}}\StringTok{ }\KeywordTok{sum}\NormalTok{(ar\_eps\_prb)}
\NormalTok{    fl\_mean\_approx \textless{}{-}}\StringTok{ }\KeywordTok{sum}\NormalTok{(ar\_eps\_val}\OperatorTok{*}\NormalTok{ar\_eps\_prb)}
\NormalTok{    fl\_sd\_approx \textless{}{-}}\StringTok{ }\KeywordTok{sqrt}\NormalTok{(}\KeywordTok{sum}\NormalTok{((ar\_eps\_val}\OperatorTok{{-}}\NormalTok{fl\_mean\_approx)}\OperatorTok{\^{}}\DecValTok{2}\OperatorTok{*}\NormalTok{ar\_eps\_prb))}

    \KeywordTok{return}\NormalTok{(}\KeywordTok{list}\NormalTok{(}\DataTypeTok{cdf=}\NormalTok{fl\_cdf\_total\_approx, }\DataTypeTok{mean=}\NormalTok{fl\_mean\_approx, }\DataTypeTok{sd=}\NormalTok{fl\_sd\_approx))}
\NormalTok{  \})}

\NormalTok{mt\_sample\_means \textless{}{-}}\StringTok{ }\KeywordTok{cbind}\NormalTok{(ar\_it\_draws, }\KeywordTok{as\_tibble}\NormalTok{(}\KeywordTok{t}\NormalTok{(mt\_fl\_means)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{unnest}\NormalTok{())}
\KeywordTok{colnames}\NormalTok{(mt\_sample\_means) \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}draw\_count\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}cdf\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}mean\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}sd\textquotesingle{}}\NormalTok{)}
\NormalTok{tb\_sample\_means \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(mt\_sample\_means)}

\CommentTok{\# Graph}
\CommentTok{\# x{-}labels}
\NormalTok{x.labels \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}n=1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}n=10\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}n=100\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}n=1000\textquotesingle{}}\NormalTok{)}
\NormalTok{x.breaks \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{100}\NormalTok{, }\DecValTok{1000}\NormalTok{)}

\CommentTok{\# Shared Labels}
\NormalTok{slb\_title\_shr =}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}as Even Rectangle Count Increases}\CharTok{\textbackslash{}n}\StringTok{\textquotesingle{}}\NormalTok{,}
                       \StringTok{\textquotesingle{}True Mean=\textquotesingle{}}\NormalTok{, fl\_eps\_mean,}\StringTok{\textquotesingle{}, sd=\textquotesingle{}}\NormalTok{,fl\_eps\_sd)}
\NormalTok{slb\_xtitle =}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}Number Equi{-}distance Rectangles Bins\textquotesingle{}}\NormalTok{)}

\CommentTok{\# Graph Results{-}{-}Draw}
\NormalTok{plt\_mean \textless{}{-}}\StringTok{ }\NormalTok{tb\_sample\_means }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{draw\_count, }\DataTypeTok{y=}\NormalTok{mean)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom\_line}\NormalTok{(}\DataTypeTok{size=}\FloatTok{0.75}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{title =} \KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}Average \textquotesingle{}}\NormalTok{, slb\_title\_shr),}
       \DataTypeTok{subtitle =}\NormalTok{ st\_subtitle,}
       \DataTypeTok{x =}\NormalTok{ slb\_xtitle,}
       \DataTypeTok{y =} \StringTok{\textquotesingle{}Integrated Mean\textquotesingle{}}\NormalTok{,}
       \DataTypeTok{caption =} \StringTok{\textquotesingle{}Integral Approximation as Even Rectangle width decreases\textquotesingle{}}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale\_x\_continuous}\NormalTok{(}\DataTypeTok{trans=}\StringTok{\textquotesingle{}log10\textquotesingle{}}\NormalTok{, }\DataTypeTok{labels =}\NormalTok{ x.labels, }\DataTypeTok{breaks =}\NormalTok{ x.breaks) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme\_bw}\NormalTok{()}
\KeywordTok{print}\NormalTok{(plt\_mean)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{Panel-Data-and-Optimization-with-R_files/figure-latex/unnamed-chunk-167-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{plt\_sd \textless{}{-}}\StringTok{ }\NormalTok{tb\_sample\_means }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{draw\_count, }\DataTypeTok{y=}\NormalTok{sd)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom\_line}\NormalTok{(}\DataTypeTok{size=}\FloatTok{0.75}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{title =} \KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}Standard Deviation \textquotesingle{}}\NormalTok{, slb\_title\_shr),}
       \DataTypeTok{subtitle =}\NormalTok{ st\_subtitle,}
       \DataTypeTok{x =}\NormalTok{ slb\_xtitle,}
       \DataTypeTok{y =} \StringTok{\textquotesingle{}Standard Deviation\textquotesingle{}}\NormalTok{,}
       \DataTypeTok{caption =} \StringTok{\textquotesingle{}Integral Approximation as Even Rectangle width decreases\textquotesingle{}}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale\_x\_continuous}\NormalTok{(}\DataTypeTok{trans=}\StringTok{\textquotesingle{}log10\textquotesingle{}}\NormalTok{, }\DataTypeTok{labels =}\NormalTok{ x.labels, }\DataTypeTok{breaks =}\NormalTok{ x.breaks) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme\_bw}\NormalTok{()}
\KeywordTok{print}\NormalTok{(plt\_sd)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{Panel-Data-and-Optimization-with-R_files/figure-latex/unnamed-chunk-167-2} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{plt\_cdf \textless{}{-}}\StringTok{ }\NormalTok{tb\_sample\_means }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{draw\_count, }\DataTypeTok{y=}\NormalTok{cdf)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom\_line}\NormalTok{(}\DataTypeTok{size=}\FloatTok{0.75}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{title =} \KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}Aggregate Probability \textquotesingle{}}\NormalTok{, slb\_title\_shr),}
       \DataTypeTok{subtitle =}\NormalTok{ st\_subtitle,}
       \DataTypeTok{x =}\NormalTok{ slb\_xtitle,}
       \DataTypeTok{y =} \StringTok{\textquotesingle{}Sum of Equi{-}Dist Rectangles\textquotesingle{}}\NormalTok{,}
       \DataTypeTok{caption =} \StringTok{\textquotesingle{}Sum of Approx. Probability as Equi{-}Dist Rectangle width decreases\textquotesingle{}}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale\_x\_continuous}\NormalTok{(}\DataTypeTok{trans=}\StringTok{\textquotesingle{}log10\textquotesingle{}}\NormalTok{, }\DataTypeTok{labels =}\NormalTok{ x.labels, }\DataTypeTok{breaks =}\NormalTok{ x.breaks) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme\_bw}\NormalTok{()}
\KeywordTok{print}\NormalTok{(plt\_cdf)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{Panel-Data-and-Optimization-with-R_files/figure-latex/unnamed-chunk-167-3} \end{center}

\hypertarget{analytical-solutions}{%
\section{Analytical Solutions}\label{analytical-solutions}}

\hypertarget{linear-scalar-fx0-solutions}{%
\subsection{Linear Scalar f(x)=0 Solutions}\label{linear-scalar-fx0-solutions}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

\hypertarget{ratio}{%
\subsubsection{Ratio}\label{ratio}}

Here are some common ratios.

\hypertarget{unif-draw-min-and-max-ratio}{%
\paragraph{Unif Draw Min and Max Ratio}\label{unif-draw-min-and-max-ratio}}

We want to draw numbers such that we have some mean \(b\), and that the possible maximum and minimum value drawn are at most \(a\) times apart. Given \(b\) and \(a\), solve for \(x\).

\[
f(x) = \frac{b+x}{b-x} - a = 0
\]

\[
b \cdot a - x \cdot a = b + x \\
b \cdot a - b = x + x \cdot a  \\
b \left(a - 1\right) = x \left( a+ 1\right)  \\
x = \frac{b\left(a-1\right)}{a+1}\\
\]

Uniformly draw

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{b \textless{}{-}}\StringTok{ }\DecValTok{100}
\NormalTok{a \textless{}{-}}\StringTok{ }\DecValTok{2}
\NormalTok{x \textless{}{-}}\StringTok{ }\NormalTok{(b}\OperatorTok{*}\NormalTok{(a}\DecValTok{{-}1}\NormalTok{))}\OperatorTok{/}\NormalTok{(a}\OperatorTok{+}\DecValTok{1}\NormalTok{)}
\NormalTok{ar\_unif\_draws \textless{}{-}}\StringTok{ }\KeywordTok{runif}\NormalTok{(}\DecValTok{100}\NormalTok{, }\DataTypeTok{min=}\NormalTok{b}\OperatorTok{{-}}\NormalTok{x, }\DataTypeTok{max=}\NormalTok{b}\OperatorTok{+}\NormalTok{x)}
\NormalTok{fl\_max\_min\_ratio \textless{}{-}}\StringTok{ }\KeywordTok{max}\NormalTok{(ar\_unif\_draws)}\OperatorTok{/}\KeywordTok{min}\NormalTok{(ar\_unif\_draws)}
\KeywordTok{cat}\NormalTok{(}\StringTok{\textquotesingle{}fl\_max\_min\_ratio =\textquotesingle{}}\NormalTok{, fl\_max\_min\_ratio, }\StringTok{\textquotesingle{}is close to a =\textquotesingle{}}\NormalTok{, a, }\StringTok{\textquotesingle{}}\CharTok{\textbackslash{}n}\StringTok{\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## fl_max_min_ratio = 1.965882 is close to a = 2
\end{verbatim}

\hypertarget{inequality-models}{%
\section{Inequality Models}\label{inequality-models}}

\hypertarget{gini-discrete-sample}{%
\subsection{Gini Discrete Sample}\label{gini-discrete-sample}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

This works out how the \href{https://fanwangecon.github.io/REconTools/reference/ff_dist_gini_vector_pos.html}{ff\_dist\_gini\_vector\_pos} function works from \href{https://fanwangecon.github.io/}{Fan}'s \emph{\href{https://fanwangecon.github.io/REconTools/}{REconTools}} Package.

\hypertarget{gini-formula-for-discrete-sample}{%
\subsubsection{Gini Formula for Discrete Sample}\label{gini-formula-for-discrete-sample}}

There is an vector values (all positive). This could be height information for N individuals. It could also be income information for N individuals. Calculate the \href{https://en.wikipedia.org/wiki/Gini_coefficient}{GINI} coefficient treating the given vector as population. This is not an estimation exercise where we want to estimate population gini based on a sample. The given array is the population. The population is discrete, and only has these N individuals in the length n vector.

Note that when the sample size is small, there is a limit to inequality using the formula defined below given each \(N\). So for small \(N\), can not really compare inequality across arrays with different \(N\), can only compare arrays with the same \(N\).

The GINI formula used here is:
\[
 GINI =
  1 - \frac{2}{N+1}
  \cdot
  \left(\sum_{i=1}^N \sum_{j=1}^{i} x_j\right)
  \cdot
  \left(
    \sum_{i=1}^N x_i
  \right)^{-1}
\]

Derive the formula in the steps below.

\emph{Step 1 Area Formula}

\[
 \Gamma = \sum_{i=1}^N \frac{1}{N} \cdot \left(
     \sum_{j=1}^{i} \left(
      \frac{x_j}{\sum_{\widehat{j}=1}^N x_{\widehat{j}} }
      \right)
  \right)
\]

\emph{Step 2 Total Area Given Perfect equality}

With perfect equality \(x_i=a\) for all \(i\), so need to divide by that.

\[
 \Gamma^{\text{equal}} = \sum_{i=1}^N \frac{1}{N} \cdot \left(
     \sum_{j=1}^{i} \left(
      \frac{a}{\sum_{\widehat{j}=1}^N a }
      \right)
  \right)
  = \frac{N+1}{N}\cdot\frac{1}{2}
\]

As the number of elements of the vecotr increases:
\[
 \lim_{N \rightarrow \infty}\Gamma^{\text{equal}}
  = \lim_{N \rightarrow \infty} \frac{N+1}{N}\cdot\frac{1}{2}
  = \frac{1}{2}
\]

\emph{Step 3 Arriving at Finite Vector Gini Formula}

Given what we have from above, we obtain the gini formula, divide by total area below 45 degree line.

\[
 GINI =
  1 -
  \left(\sum_{i=1}^N \sum_{j=1}^{i} x_j\right)
  \cdot
  \left(
    N \cdot \sum_{i=1}^N x_i
  \right)^{-1}
  \cdot
  \left( \frac{N+1}{N}\cdot\frac{1}{2} \right)^{-1}
  =
  1 - \frac{2}{N+1}
  \cdot
  \left(\sum_{i=1}^N \sum_{j=1}^{i} x_j\right)
  \cdot
  \left(
    \sum_{i=1}^N x_i
  \right)^{-1}
\]

\emph{Step 4 Maximum Inequality given N}

Suppose \(x_i=0\) for all \(i<N\), then:

\[
 GINI^{x_i = 0 \text{ except } i=N}
 =
  1 - \frac{2}{N+1}
  \cdot
  X_N
  \cdot
  \left(
    X_N
  \right)^{-1}
 =
 1 - \frac{2}{N+1}
\]

\[
 \lim_{N \rightarrow \infty} GINI^{x_i = 0 \text{ except } i=N}
 =
 1 -
 \lim_{N \rightarrow \infty}
 \frac{2}{N+1}
 = 1
\]

Note that for small N, for example if \(N=10\), even when one person holds all income, all others have 0 income, the formula will not produce gini is zero, but that gini is equal to \(\frac{2}{11}\approx 0.1818\). If \(N=2\), inequality is at most, \(\frac{2}{3}\approx 0.667\).

\[
 MostUnequalGINI\left(N\right) = 1 - \frac{2}{N+1} = \frac{N-1}{N+1}
\]

\hypertarget{implement-gini-formula}{%
\subsubsection{Implement GINI Formula}\label{implement-gini-formula}}

The \textbf{GINI} formula just derived is trivial to compute.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  scalar: \(\frac{2}{N+1}\)
\item
  cumsum: \(\sum_{j=1}^{i} x_j\)
\item
  sum of cumsum: \(\left(\sum_{i=1}^N \sum_{j=1}^{i} x_j\right)\)
\item
  sum: \(\sum_{i=1}^N X_i\)
\end{enumerate}

There are no package dependencies. Define the formula here:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Formula, directly implement the GINI formula Following Step 4 above}
\NormalTok{fv\_dist\_gini\_vector\_pos\_test \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(ar\_pos) \{}
  \CommentTok{\# Check length and given warning}
\NormalTok{  it\_n \textless{}{-}}\StringTok{ }\KeywordTok{length}\NormalTok{(ar\_pos)}
  \ControlFlowTok{if}\NormalTok{ (it\_n }\OperatorTok{\textless{}=}\StringTok{ }\DecValTok{100}\NormalTok{)  }\KeywordTok{warning}\NormalTok{(}\StringTok{\textquotesingle{}Data vector has n=\textquotesingle{}}\NormalTok{,it\_n,}\StringTok{\textquotesingle{}, max{-}inequality/max{-}gini=\textquotesingle{}}\NormalTok{,(it\_n}\DecValTok{{-}1}\NormalTok{)}\OperatorTok{/}\NormalTok{(it\_n }\OperatorTok{+}\StringTok{ }\DecValTok{1}\NormalTok{))}
  \CommentTok{\# Sort}
\NormalTok{  ar\_pos \textless{}{-}}\StringTok{ }\KeywordTok{sort}\NormalTok{(ar\_pos)}
  \CommentTok{\# formula implement}
\NormalTok{  fl\_gini \textless{}{-}}\StringTok{ }\DecValTok{1} \OperatorTok{{-}}\StringTok{ }\NormalTok{((}\DecValTok{2}\OperatorTok{/}\NormalTok{(it\_n}\OperatorTok{+}\DecValTok{1}\NormalTok{)) }\OperatorTok{*}\StringTok{ }\KeywordTok{sum}\NormalTok{(}\KeywordTok{cumsum}\NormalTok{(ar\_pos))}\OperatorTok{*}\NormalTok{(}\KeywordTok{sum}\NormalTok{(ar\_pos))}\OperatorTok{\^{}}\NormalTok{(}\OperatorTok{{-}}\DecValTok{1}\NormalTok{))}
  \KeywordTok{return}\NormalTok{(fl\_gini)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Generate a number of examples Arrays for testing

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Example Arrays of data}
\NormalTok{ar\_equal\_n1 =}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{)}
\NormalTok{ar\_ineql\_n1 =}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{100}\NormalTok{)}

\NormalTok{ar\_equal\_n2 =}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{)}
\NormalTok{ar\_ineql\_alittle\_n2 =}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{)}
\NormalTok{ar\_ineql\_somewht\_n2 =}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\OperatorTok{\^{}}\DecValTok{3}\NormalTok{)}
\NormalTok{ar\_ineql\_alotine\_n2 =}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\OperatorTok{\^{}}\DecValTok{5}\NormalTok{)}
\NormalTok{ar\_ineql\_veryvry\_n2 =}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\OperatorTok{\^{}}\DecValTok{8}\NormalTok{)}
\NormalTok{ar\_ineql\_mostmst\_n2 =}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\OperatorTok{\^{}}\DecValTok{13}\NormalTok{)}

\NormalTok{ar\_equal\_n10 =}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{)}
\NormalTok{ar\_ineql\_some\_n10 =}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{5}\NormalTok{,}\DecValTok{8}\NormalTok{,}\DecValTok{13}\NormalTok{,}\DecValTok{21}\NormalTok{,}\DecValTok{34}\NormalTok{,}\DecValTok{55}\NormalTok{,}\DecValTok{89}\NormalTok{)}
\NormalTok{ar\_ineql\_very\_n10 =}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\OperatorTok{\^{}}\DecValTok{2}\NormalTok{,}\DecValTok{3}\OperatorTok{\^{}}\DecValTok{2}\NormalTok{,}\DecValTok{5}\OperatorTok{\^{}}\DecValTok{2}\NormalTok{,}\DecValTok{8}\OperatorTok{\^{}}\DecValTok{2}\NormalTok{,}\DecValTok{13}\OperatorTok{\^{}}\DecValTok{2}\NormalTok{,}\DecValTok{21}\OperatorTok{\^{}}\DecValTok{2}\NormalTok{,}\DecValTok{34}\OperatorTok{\^{}}\DecValTok{2}\NormalTok{,}\DecValTok{55}\OperatorTok{\^{}}\DecValTok{2}\NormalTok{,}\DecValTok{89}\OperatorTok{\^{}}\DecValTok{2}\NormalTok{)}
\NormalTok{ar\_ineql\_extr\_n10 =}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\OperatorTok{\^{}}\DecValTok{2}\NormalTok{,}\DecValTok{3}\OperatorTok{\^{}}\DecValTok{3}\NormalTok{,}\DecValTok{5}\OperatorTok{\^{}}\DecValTok{4}\NormalTok{,}\DecValTok{8}\OperatorTok{\^{}}\DecValTok{5}\NormalTok{,}\DecValTok{13}\OperatorTok{\^{}}\DecValTok{6}\NormalTok{,}\DecValTok{21}\OperatorTok{\^{}}\DecValTok{7}\NormalTok{,}\DecValTok{34}\OperatorTok{\^{}}\DecValTok{8}\NormalTok{,}\DecValTok{55}\OperatorTok{\^{}}\DecValTok{9}\NormalTok{,}\DecValTok{89}\OperatorTok{\^{}}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Now test the example arrays above using the function based no our formula:

\begin{verbatim}
## 
## Small N=1 Hard-Code
\end{verbatim}

\begin{verbatim}
## ar_equal_n1: 0
\end{verbatim}

\begin{verbatim}
## ar_ineql_n1: 0
\end{verbatim}

\begin{verbatim}
## 
## Small N=2 Hard-Code, converge to 1/3, see formula above
\end{verbatim}

\begin{verbatim}
## ar_ineql_alittle_n2: 0.1111111
\end{verbatim}

\begin{verbatim}
## ar_ineql_somewht_n2: 0.2592593
\end{verbatim}

\begin{verbatim}
## ar_ineql_alotine_n2: 0.3131313
\end{verbatim}

\begin{verbatim}
## ar_ineql_veryvry_n2: 0.3307393
\end{verbatim}

\begin{verbatim}
## 
## Small N=10 Hard-Code, convege to 9/11=0.8181, see formula above
\end{verbatim}

\begin{verbatim}
## ar_equal_n10: 0
\end{verbatim}

\begin{verbatim}
## ar_ineql_some_n10: 0.5395514
\end{verbatim}

\begin{verbatim}
## ar_ineql_very_n10: 0.7059554
\end{verbatim}

\begin{verbatim}
## ar_ineql_extr_n10: 0.8181549
\end{verbatim}

\hypertarget{atkinson-family-utility}{%
\subsection{Atkinson Family Utility}\label{atkinson-family-utility}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

\hypertarget{individual-outcomes-and-preference}{%
\subsubsection{Individual Outcomes and Preference}\label{individual-outcomes-and-preference}}

How does the Aktinson Family utility function work? THe Atkinson Family Utility has the following functional form.

\[
V^{\text{social}}
=
\left(
\alpha
\cdot
A^{\lambda}
+
\beta
\cdot
B^{\lambda}
\right)^{\frac{1}{\lambda}}
\]

Several key issues here:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \(V^{\text{social}}\) is the utility of some social planner
\item
  \(A\) and \(B\) are allocations for Alex and Ben.
\item
  \(\alpha\) and \(\beta\) are biases that a social planner has for Alex and Ben: \(\alpha+\beta=1\), \(\alpha>0\), and \(\beta>0\)
\item
  \(-\infty < \lambda \le 1\) is a measure of inequality aversion

  \begin{itemize}
  \tightlist
  \item
    \(\lambda=1\) is when the planner cares about weighted total allocations (efficient, Utilitarian)
  \item
    \(\lambda=-\infty\) is when the planner cares about only the minimum between \(A\) and \(B\) allocations (equality, Rawlsian)
  \end{itemize}
\end{enumerate}

What if only care about Alex? Clearly, if the planner only cares about Ben, \(\beta=1\), then:

\[
V^{\text{social}}
=
\left(
B^{\lambda}
\right)^{\frac{1}{\lambda}}
= B
\]

Clearly, regardless of the value of \(\lambda\), as \(B\) increases \(V\) increases. What Happens to V when A or B increases? What is the derivative of \(V\) with respect to \(A\) or \(B\)?

\[
    \frac{\partial V}{\partial A}
    =
    \frac{1}{\lambda}
    \left(
    \alpha
    A^{\lambda}
    +
    \beta
    B^{\lambda}
    \right)^{\frac{1}{\lambda}-1}
    \cdot
    \lambda
    \alpha
    A^{\lambda -1}
\]

\[
    \frac{\partial V}{\partial A}
    =
    \left(
    \alpha
    A^{\lambda}
    +
    \beta
    B^{\lambda}
    \right)^{\frac{1-\lambda}{\lambda}}
    \cdot
    \alpha
    A^{\lambda -1}
    >0
\]

Note that \(\frac{\partial V}{\partial A}>0\). When \(\lambda <0\), \(Z^{\lambda}>0\). For example \(10^{-2}=\frac{1}{100}\). And For example \(0.1^{\frac{3}{-2}}=\frac{1}{0.1^{1.5}}\). Still Positive.

While the overall \(V\) increases with increasing \(A\), but if we did not have the outter power term, the situation is different. In particular, when \(\lambda < 0\):
\[
\text{ if } \lambda <0
\thinspace\thinspace
\text{ then }
\thinspace\thinspace
\frac{d \left(\alpha A^{\lambda} + \beta B^{\lambda}\right)}{dA}=\alpha\lambda A^{\lambda -1}<0
\]
Without the outter \(\frac{1}{\lambda}\) power, negative \(\lambda\) would lead to decreasing weighted sum. But:
\[
\text{ if } \lambda <0
\thinspace\thinspace
\text{ then }
\thinspace\thinspace
\frac{dG^{\frac{1}{\lambda}}}{dG}=\frac{1}{\lambda}\cdot G^{\frac{1-\lambda}{\lambda}}<0
\]
so when \(G\) is increasing and \(\lambda <0\), \(V\) would decrease. But when \(G\left(A,B\right)\) is decreasing, as is the case with increasing \(A\) when \(\lambda <0\), \(V\) will actually increase. This confirms that \(\frac{\partial V}{\partial A}>0\) for \(\lambda <0\). The result is symmetric for \(\lambda >0\).

\hypertarget{indifference-curve-graph}{%
\subsubsection{Indifference Curve Graph}\label{indifference-curve-graph}}

Given \(V^{\ast}\), we can show the combinations of \(A\) and \(B\) points that provide the same utility. We want to be able to potentially draw multiple indifference curves at the same time. Note that indifference curves are defined by \(\alpha\), \(\lambda\) only. Each indifference curve is a set of \(A\) and \(B\) coordinates. So to generate multiple indifference curves means to generate many sets of \(A\), \(B\) associated with different planner preferences, and then these could be graphed out.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# A as x{-}axis, need bounds on A}
\NormalTok{fl\_A\_min =}\StringTok{ }\FloatTok{0.01}
\NormalTok{fl\_A\_max =}\StringTok{ }\DecValTok{3}
\NormalTok{it\_A\_grid =}\StringTok{ }\DecValTok{10000}

\CommentTok{\# Define parameters}
\CommentTok{\# ar\_lambda \textless{}{-} 1 {-} (10\^{}(c(seq({-}2,2, length.out=3))))}
\NormalTok{ar\_lambda \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FloatTok{0.6}\NormalTok{, }\FloatTok{0.06}\NormalTok{, }\DecValTok{{-}6}\NormalTok{)}
\NormalTok{ar\_beta \textless{}{-}}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\FloatTok{0.25}\NormalTok{, }\FloatTok{0.75}\NormalTok{, }\DataTypeTok{length.out =} \DecValTok{3}\NormalTok{)}
\NormalTok{ar\_beta \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\FloatTok{0.3}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\FloatTok{0.7}\NormalTok{)}
\NormalTok{ar\_v\_star \textless{}{-}}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DataTypeTok{length.out =} \DecValTok{1}\NormalTok{)}
\NormalTok{tb\_pref \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(ar\_lambda)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{expand\_grid}\NormalTok{(ar\_beta) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{expand\_grid}\NormalTok{(ar\_v\_star) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{rename\_all}\NormalTok{(}\OperatorTok{\textasciitilde{}}\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}lambda\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}beta\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}vstar\textquotesingle{}}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{rowid\_to\_column}\NormalTok{(}\DataTypeTok{var =} \StringTok{"indiff\_id"}\NormalTok{)}

\CommentTok{\# Generate indifference points with apply and anonymous function}
\CommentTok{\# tb\_pref, whatever is selected from it, must be all numeric}
\CommentTok{\# if there are strings, would cause conversion error.}
\NormalTok{ls\_df\_indiff \textless{}{-}}\StringTok{ }\KeywordTok{apply}\NormalTok{(tb\_pref, }\DecValTok{1}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(x)\{}
\NormalTok{  indiff\_id \textless{}{-}}\StringTok{ }\NormalTok{x[}\DecValTok{1}\NormalTok{]}
\NormalTok{  lambda \textless{}{-}}\StringTok{ }\NormalTok{x[}\DecValTok{2}\NormalTok{]}
\NormalTok{  beta \textless{}{-}}\StringTok{ }\NormalTok{x[}\DecValTok{3}\NormalTok{]}
\NormalTok{  vstar \textless{}{-}}\StringTok{ }\NormalTok{x[}\DecValTok{4}\NormalTok{]}
\NormalTok{  ar\_fl\_A\_indiff \textless{}{-}}\StringTok{ }\KeywordTok{seq}\NormalTok{(fl\_A\_min, fl\_A\_max, }\DataTypeTok{length.out=}\NormalTok{it\_A\_grid)}
\NormalTok{  ar\_fl\_B\_indiff \textless{}{-}}\StringTok{ }\NormalTok{(((vstar}\OperatorTok{\^{}}\NormalTok{lambda) }\OperatorTok{{-}}\StringTok{ }
\StringTok{                        }\NormalTok{(beta}\OperatorTok{*}\NormalTok{ar\_fl\_A\_indiff}\OperatorTok{\^{}}\NormalTok{(lambda)))}\OperatorTok{/}\NormalTok{(}\DecValTok{1}\OperatorTok{{-}}\NormalTok{beta))}\OperatorTok{\^{}}\NormalTok{(}\DecValTok{1}\OperatorTok{/}\NormalTok{lambda)}
\NormalTok{  mt\_A\_B\_indiff \textless{}{-}}\StringTok{ }\KeywordTok{cbind}\NormalTok{(indiff\_id, lambda, beta, vstar,}
\NormalTok{                         ar\_fl\_A\_indiff, ar\_fl\_B\_indiff)}
  \KeywordTok{colnames}\NormalTok{(mt\_A\_B\_indiff) \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}indiff\_id\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}lambda\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}beta\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}vstar\textquotesingle{}}\NormalTok{,}
                               \StringTok{\textquotesingle{}indiff\_A\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}indiff\_B\textquotesingle{}}\NormalTok{)}
\NormalTok{  tb\_A\_B\_indiff \textless{}{-}}\StringTok{ }\KeywordTok{as\_tibble}\NormalTok{(mt\_A\_B\_indiff) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{    }\KeywordTok{rowid\_to\_column}\NormalTok{(}\DataTypeTok{var =} \StringTok{"A\_grid\_id"}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{    }\KeywordTok{filter}\NormalTok{(indiff\_B }\OperatorTok{\textgreater{}=}\StringTok{ }\DecValTok{0} \OperatorTok{\&}\StringTok{ }\NormalTok{indiff\_B }\OperatorTok{\textless{}=}\StringTok{ }\KeywordTok{max}\NormalTok{(ar\_fl\_A\_indiff))}
  \KeywordTok{return}\NormalTok{(tb\_A\_B\_indiff)}
\NormalTok{\})}
\NormalTok{df\_indiff \textless{}{-}}\StringTok{ }\KeywordTok{do.call}\NormalTok{(rbind, ls\_df\_indiff) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{drop\_na}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

Note that many more A grid points are needed to fully plot out the leontief line.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Labeling}
\NormalTok{st\_title \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}Indifference Curves Aktinson Atkinson Utility (CES)\textquotesingle{}}\NormalTok{)}
\NormalTok{st\_subtitle \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}Each Panel Different beta=A}\CharTok{\textbackslash{}\textquotesingle{}}\StringTok{s Weight lambda=inequality aversion}\CharTok{\textbackslash{}n}\StringTok{\textquotesingle{}}\NormalTok{,}
                      \StringTok{\textquotesingle{}https://fanwangecon.github.io/\textquotesingle{}}\NormalTok{,}
                      \StringTok{\textquotesingle{}R4Econ/math/func\_ineq/htmlpdfr/fs\_atkinson\_ces.html\textquotesingle{}}\NormalTok{)}
\NormalTok{st\_caption \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}Indifference Curve 2 Individuals, \textquotesingle{}}\NormalTok{,}
                     \StringTok{\textquotesingle{}https://fanwangecon.github.io/R4Econ/\textquotesingle{}}\NormalTok{)}
\NormalTok{st\_x\_label \textless{}{-}}\StringTok{ \textquotesingle{}A\textquotesingle{}}
\NormalTok{st\_y\_label \textless{}{-}}\StringTok{ \textquotesingle{}B\textquotesingle{}}

\CommentTok{\# Graphing}
\NormalTok{plt\_indiff \textless{}{-}}\StringTok{ }
\StringTok{  }\NormalTok{df\_indiff }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{lambda =} \KeywordTok{as\_factor}\NormalTok{(lambda),}
                       \DataTypeTok{beta =} \KeywordTok{as\_factor}\NormalTok{(beta),}
                       \DataTypeTok{vstar =} \KeywordTok{as\_factor}\NormalTok{(vstar)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{indiff\_A, }\DataTypeTok{y=}\NormalTok{indiff\_B,}
             \DataTypeTok{colour=}\NormalTok{lambda)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{facet\_wrap}\NormalTok{( }\OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{beta) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom\_line}\NormalTok{(}\DataTypeTok{size=}\DecValTok{1}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{title =}\NormalTok{ st\_title, }\DataTypeTok{subtitle =}\NormalTok{ st\_subtitle,}
       \DataTypeTok{x =}\NormalTok{ st\_x\_label, }\DataTypeTok{y =}\NormalTok{ st\_y\_label, }\DataTypeTok{caption =}\NormalTok{ st\_caption) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme\_bw}\NormalTok{()}

\CommentTok{\# show}
\KeywordTok{print}\NormalTok{(plt\_indiff)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{Panel-Data-and-Optimization-with-R_files/figure-latex/unnamed-chunk-175-1} \end{center}

\hypertarget{tables-and-graphs}{%
\chapter{Tables and Graphs}\label{tables-and-graphs}}

\hypertarget{r-base-plots}{%
\section{R Base Plots}\label{r-base-plots}}

\hypertarget{plot-curve-line-and-points}{%
\subsection{Plot Curve, Line and Points}\label{plot-curve-line-and-points}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

Work with the R plot function.

\hypertarget{one-point-one-line-and-two-curves}{%
\subsubsection{One Point, One Line and Two Curves}\label{one-point-one-line-and-two-curves}}

\begin{itemize}
\tightlist
\item
  r curve on top of plot
\item
  r plot specify pch lty both scatter and line
\item
  r legend outside
\end{itemize}

Jointly plot:

\begin{itemize}
\tightlist
\item
  1 scatter plot
\item
  1 line plot
\item
  2 function curve plots
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\CommentTok{\# First, Some common Labels:}
\CommentTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\CommentTok{\# Labeling}
\NormalTok{st\_title \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}Scatter, Line and Curve Joint Ploting Example Using Base R}\CharTok{\textbackslash{}n}\StringTok{\textquotesingle{}}\NormalTok{,}
                   \StringTok{\textquotesingle{}plot() + curve(): x*sin(x), cos(x), sin(x)*cos(x), sin(x)+tan(x)+cos(x)\textquotesingle{}}\NormalTok{)}
\NormalTok{st\_subtitle \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}https://fanwangecon.github.io/\textquotesingle{}}\NormalTok{,}
                      \StringTok{\textquotesingle{}R4Econ/tabgraph/inout/htmlpdfr/fs\_base\_curve.html\textquotesingle{}}\NormalTok{)}
\NormalTok{st\_x\_label \textless{}{-}}\StringTok{ \textquotesingle{}x\textquotesingle{}}
\NormalTok{st\_y\_label \textless{}{-}}\StringTok{ \textquotesingle{}f(x)\textquotesingle{}}

\CommentTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\CommentTok{\# Second, Generate the Graphs Functions and data points:}
\CommentTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\CommentTok{\# x only used for Point 1 and Line 1}
\NormalTok{x \textless{}{-}}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\OperatorTok{{-}}\DecValTok{1}\OperatorTok{*}\NormalTok{pi, }\DecValTok{1}\OperatorTok{*}\NormalTok{pi, }\DataTypeTok{length.out=}\DecValTok{25}\NormalTok{)}
\CommentTok{\# Line (Point) 1: Generate X and Y}
\NormalTok{y1 \textless{}{-}}\StringTok{ }\NormalTok{x}\OperatorTok{*}\KeywordTok{sin}\NormalTok{(x)}
\NormalTok{st\_point\_}\DecValTok{1}\NormalTok{\_y\_legend \textless{}{-}}\StringTok{ \textquotesingle{}x*sin(x)\textquotesingle{}}
\CommentTok{\# Line 2: Line Plot}
\NormalTok{y2 \textless{}{-}}\StringTok{ }\KeywordTok{cos}\NormalTok{(x)}
\NormalTok{st\_line\_}\DecValTok{2}\NormalTok{\_y\_legend \textless{}{-}}\StringTok{ \textquotesingle{}cos(x)\textquotesingle{}}
\CommentTok{\# Line 3: Function}
\NormalTok{fc\_sin\_cos\_diff \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) }\KeywordTok{sin}\NormalTok{(x)}\OperatorTok{*}\KeywordTok{cos}\NormalTok{(x)}
\NormalTok{st\_line\_}\DecValTok{3}\NormalTok{\_y\_legend \textless{}{-}}\StringTok{ \textquotesingle{}sin(x)*cos(x)\textquotesingle{}}
\CommentTok{\# Line 4: Function}
\NormalTok{fc\_sin\_cos\_tan \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) }\KeywordTok{sin}\NormalTok{(x) }\OperatorTok{+}\StringTok{ }\KeywordTok{cos}\NormalTok{(x) }\OperatorTok{+}\StringTok{ }\KeywordTok{tan}\NormalTok{(x)}
\NormalTok{st\_line\_}\DecValTok{4}\NormalTok{\_y\_legend \textless{}{-}}\StringTok{ \textquotesingle{}sin(x) + tan(x) + cos(x)\textquotesingle{}}

\CommentTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\CommentTok{\# Third, set:}
\CommentTok{\# {-} point shape and size: *pch* and *cex*}
\CommentTok{\# {-} line type and width: *lty* and *lwd*}
\CommentTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\CommentTok{\# http://www.sthda.com/english/wiki/r{-}plot{-}pch{-}symbols{-}the{-}different{-}point{-}shapes{-}available{-}in{-}r}
\CommentTok{\# http://www.sthda.com/english/wiki/line{-}types{-}in{-}r{-}lty}
\CommentTok{\# for colors, see: https://fanwangecon.github.io/M4Econ/graph/tools/fs\_color.html}
\NormalTok{st\_point\_}\DecValTok{1}\NormalTok{\_blue \textless{}{-}}\StringTok{ }\KeywordTok{rgb}\NormalTok{(}\DecValTok{57}\OperatorTok{/}\DecValTok{255}\NormalTok{,}\DecValTok{106}\OperatorTok{/}\DecValTok{255}\NormalTok{,}\DecValTok{177}\OperatorTok{/}\DecValTok{255}\NormalTok{)}
\NormalTok{st\_line\_}\DecValTok{2}\NormalTok{\_red \textless{}{-}}\StringTok{ }\KeywordTok{rgb}\NormalTok{(}\DecValTok{204}\OperatorTok{/}\DecValTok{255}\NormalTok{, }\DecValTok{37}\OperatorTok{/}\DecValTok{255}\NormalTok{, }\DecValTok{41}\OperatorTok{/}\DecValTok{255}\NormalTok{,)}
\NormalTok{st\_line\_}\DecValTok{3}\NormalTok{\_black \textless{}{-}}\StringTok{ \textquotesingle{}black\textquotesingle{}}
\NormalTok{st\_line\_}\DecValTok{4}\NormalTok{\_purple \textless{}{-}}\StringTok{ \textquotesingle{}orange\textquotesingle{}}

\CommentTok{\# point type}
\NormalTok{st\_point\_}\DecValTok{1}\NormalTok{\_pch \textless{}{-}}\StringTok{ }\DecValTok{10}
\CommentTok{\# point size}
\NormalTok{st\_point\_}\DecValTok{1}\NormalTok{\_cex \textless{}{-}}\StringTok{ }\DecValTok{2}

\CommentTok{\# line type}
\NormalTok{st\_line\_}\DecValTok{2}\NormalTok{\_lty \textless{}{-}}\StringTok{ \textquotesingle{}dashed\textquotesingle{}}
\NormalTok{st\_line\_}\DecValTok{3}\NormalTok{\_lty \textless{}{-}}\StringTok{ \textquotesingle{}dotted\textquotesingle{}}
\NormalTok{st\_line\_}\DecValTok{4}\NormalTok{\_lty \textless{}{-}}\StringTok{ \textquotesingle{}dotdash\textquotesingle{}}
\CommentTok{\# line width}
\NormalTok{st\_line\_}\DecValTok{2}\NormalTok{\_lwd \textless{}{-}}\StringTok{ }\DecValTok{3}
\NormalTok{st\_line\_}\DecValTok{3}\NormalTok{\_lwd \textless{}{-}}\StringTok{ }\FloatTok{2.5}
\NormalTok{st\_line\_}\DecValTok{4}\NormalTok{\_lwd \textless{}{-}}\StringTok{ }\FloatTok{3.5}

\CommentTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\CommentTok{\# Fourth: Share xlim and ylim}
\CommentTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ar\_xlim =}\StringTok{ }\KeywordTok{c}\NormalTok{(}\KeywordTok{min}\NormalTok{(x), }\KeywordTok{max}\NormalTok{(x))}
\NormalTok{ar\_ylim =}\StringTok{ }\KeywordTok{c}\NormalTok{(}\OperatorTok{{-}}\FloatTok{3.5}\NormalTok{, }\FloatTok{3.5}\NormalTok{)}

\CommentTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\CommentTok{\# Fifth: the legend will be long, will place it to the right of figure,}
\CommentTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\KeywordTok{par}\NormalTok{(}\DataTypeTok{new=}\OtherTok{FALSE}\NormalTok{, }\DataTypeTok{mar=}\KeywordTok{c}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{10}\NormalTok{))}

\CommentTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\CommentTok{\# Sixth, the four objects and do not print yet:}
\CommentTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\CommentTok{\# pdf(NULL)}
\CommentTok{\# Graph Scatter 1}
\KeywordTok{plot}\NormalTok{(x, y1, }\DataTypeTok{type=}\StringTok{"p"}\NormalTok{,}
     \DataTypeTok{col =}\NormalTok{ st\_point\_}\DecValTok{1}\NormalTok{\_blue,}
     \DataTypeTok{pch =}\NormalTok{ st\_point\_}\DecValTok{1}\NormalTok{\_pch, }\DataTypeTok{cex =}\NormalTok{ st\_point\_}\DecValTok{1}\NormalTok{\_cex,}
     \DataTypeTok{xlim =}\NormalTok{ ar\_xlim, }\DataTypeTok{ylim =}\NormalTok{ ar\_ylim,}
     \DataTypeTok{panel.first =} \KeywordTok{grid}\NormalTok{(),}
     \DataTypeTok{ylab =} \StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{, }\DataTypeTok{xlab =} \StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{, }\DataTypeTok{yaxt=}\StringTok{\textquotesingle{}n\textquotesingle{}}\NormalTok{, }\DataTypeTok{xaxt=}\StringTok{\textquotesingle{}n\textquotesingle{}}\NormalTok{, }\DataTypeTok{ann=}\OtherTok{FALSE}\NormalTok{)}
\NormalTok{pl\_scatter\_}\DecValTok{1}\NormalTok{ \textless{}{-}}\StringTok{ }\KeywordTok{recordPlot}\NormalTok{()}

\CommentTok{\# Graph Line 2}
\KeywordTok{par}\NormalTok{(}\DataTypeTok{new=}\NormalTok{T)}
\KeywordTok{plot}\NormalTok{(x, y2, }\DataTypeTok{type=}\StringTok{"l"}\NormalTok{,}
     \DataTypeTok{col =}\NormalTok{ st\_line\_}\DecValTok{2}\NormalTok{\_red,}
     \DataTypeTok{lwd =}\NormalTok{ st\_line\_}\DecValTok{2}\NormalTok{\_lwd, }\DataTypeTok{lty =}\NormalTok{ st\_line\_}\DecValTok{2}\NormalTok{\_lty,}
     \DataTypeTok{xlim =}\NormalTok{ ar\_xlim, }\DataTypeTok{ylim =}\NormalTok{ ar\_ylim,}
     \DataTypeTok{ylab =} \StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{, }\DataTypeTok{xlab =} \StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{, }\DataTypeTok{yaxt=}\StringTok{\textquotesingle{}n\textquotesingle{}}\NormalTok{, }\DataTypeTok{xaxt=}\StringTok{\textquotesingle{}n\textquotesingle{}}\NormalTok{, }\DataTypeTok{ann=}\OtherTok{FALSE}\NormalTok{)}
\NormalTok{pl\_}\DecValTok{12}\NormalTok{ \textless{}{-}}\StringTok{ }\KeywordTok{recordPlot}\NormalTok{()}

\CommentTok{\# Graph Curve 3}
\KeywordTok{par}\NormalTok{(}\DataTypeTok{new=}\NormalTok{T)}
\KeywordTok{curve}\NormalTok{(fc\_sin\_cos\_diff,}
      \DataTypeTok{col =}\NormalTok{ st\_line\_}\DecValTok{3}\NormalTok{\_black,}
      \DataTypeTok{lwd =}\NormalTok{ st\_line\_}\DecValTok{3}\NormalTok{\_lwd, }\DataTypeTok{lty =}\NormalTok{ st\_line\_}\DecValTok{3}\NormalTok{\_lty,}
      \DataTypeTok{from =}\NormalTok{ ar\_xlim[}\DecValTok{1}\NormalTok{], }\DataTypeTok{to =}\NormalTok{ ar\_xlim[}\DecValTok{2}\NormalTok{], }\DataTypeTok{ylim =}\NormalTok{ ar\_ylim,}
      \DataTypeTok{ylab =} \StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{, }\DataTypeTok{xlab =} \StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{, }\DataTypeTok{yaxt=}\StringTok{\textquotesingle{}n\textquotesingle{}}\NormalTok{, }\DataTypeTok{xaxt=}\StringTok{\textquotesingle{}n\textquotesingle{}}\NormalTok{, }\DataTypeTok{ann=}\OtherTok{FALSE}\NormalTok{)}
\NormalTok{pl\_}\DecValTok{123}\NormalTok{ \textless{}{-}}\StringTok{ }\KeywordTok{recordPlot}\NormalTok{()}

\CommentTok{\# Graph Curve 4}
\KeywordTok{par}\NormalTok{(}\DataTypeTok{new=}\NormalTok{T)}
\KeywordTok{curve}\NormalTok{(fc\_sin\_cos\_tan,}
      \DataTypeTok{col =}\NormalTok{ st\_line\_}\DecValTok{4}\NormalTok{\_purple,}
      \DataTypeTok{lwd =}\NormalTok{ st\_line\_}\DecValTok{4}\NormalTok{\_lwd, }\DataTypeTok{lty =}\NormalTok{ st\_line\_}\DecValTok{4}\NormalTok{\_lty,}
      \DataTypeTok{from =}\NormalTok{ ar\_xlim[}\DecValTok{1}\NormalTok{], }\DataTypeTok{to =}\NormalTok{ ar\_xlim[}\DecValTok{2}\NormalTok{], }\DataTypeTok{ylim =}\NormalTok{ ar\_ylim,}
      \DataTypeTok{ylab =} \StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{, }\DataTypeTok{xlab =} \StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{, }\DataTypeTok{yaxt=}\StringTok{\textquotesingle{}n\textquotesingle{}}\NormalTok{, }\DataTypeTok{xaxt=}\StringTok{\textquotesingle{}n\textquotesingle{}}\NormalTok{, }\DataTypeTok{ann=}\OtherTok{FALSE}\NormalTok{)}
\NormalTok{pl\_}\DecValTok{1234}\NormalTok{ \textless{}{-}}\StringTok{ }\KeywordTok{recordPlot}\NormalTok{()}
\CommentTok{\# invisible(dev.off())}

\CommentTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\CommentTok{\# Seventh, Set Title and Legend and Plot Jointly}
\CommentTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\CommentTok{\# CEX sizing Contorl Titling and Legend Sizes}
\NormalTok{fl\_ces\_fig\_reg =}\StringTok{ }\DecValTok{1}
\NormalTok{fl\_ces\_fig\_small =}\StringTok{ }\FloatTok{0.75}

\CommentTok{\# R Legend}
\KeywordTok{title}\NormalTok{(}\DataTypeTok{main =}\NormalTok{ st\_title, }\DataTypeTok{sub =}\NormalTok{ st\_subtitle, }\DataTypeTok{xlab =}\NormalTok{ st\_x\_label, }\DataTypeTok{ylab =}\NormalTok{ st\_y\_label,}
      \DataTypeTok{cex.lab=}\NormalTok{fl\_ces\_fig\_reg,}
      \DataTypeTok{cex.main=}\NormalTok{fl\_ces\_fig\_reg,}
      \DataTypeTok{cex.sub=}\NormalTok{fl\_ces\_fig\_small)}
\KeywordTok{axis}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DataTypeTok{cex.axis=}\NormalTok{fl\_ces\_fig\_reg)}
\KeywordTok{axis}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DataTypeTok{cex.axis=}\NormalTok{fl\_ces\_fig\_reg)}
\KeywordTok{grid}\NormalTok{()}

\CommentTok{\# Legend sizing CEX}
\KeywordTok{legend}\NormalTok{(}\StringTok{"topright"}\NormalTok{,}
       \DataTypeTok{inset=}\KeywordTok{c}\NormalTok{(}\OperatorTok{{-}}\FloatTok{0.4}\NormalTok{,}\DecValTok{0}\NormalTok{),}
       \DataTypeTok{xpd=}\OtherTok{TRUE}\NormalTok{,}
       \KeywordTok{c}\NormalTok{(st\_point\_}\DecValTok{1}\NormalTok{\_y\_legend, st\_line\_}\DecValTok{2}\NormalTok{\_y\_legend, st\_line\_}\DecValTok{3}\NormalTok{\_y\_legend, st\_line\_}\DecValTok{4}\NormalTok{\_y\_legend),}
       \DataTypeTok{col =} \KeywordTok{c}\NormalTok{(st\_point\_}\DecValTok{1}\NormalTok{\_blue, st\_line\_}\DecValTok{2}\NormalTok{\_red, st\_line\_}\DecValTok{3}\NormalTok{\_black, st\_line\_}\DecValTok{4}\NormalTok{\_purple),}
       \DataTypeTok{pch =} \KeywordTok{c}\NormalTok{(st\_point\_}\DecValTok{1}\NormalTok{\_pch, }\OtherTok{NA}\NormalTok{, }\OtherTok{NA}\NormalTok{, }\OtherTok{NA}\NormalTok{),}
       \DataTypeTok{cex =}\NormalTok{ fl\_ces\_fig\_small,}
       \DataTypeTok{lty =} \KeywordTok{c}\NormalTok{(}\OtherTok{NA}\NormalTok{, st\_line\_}\DecValTok{2}\NormalTok{\_lty, st\_line\_}\DecValTok{3}\NormalTok{\_lty, st\_line\_}\DecValTok{4}\NormalTok{\_lty),}
       \DataTypeTok{lwd =} \KeywordTok{c}\NormalTok{(}\OtherTok{NA}\NormalTok{, st\_line\_}\DecValTok{2}\NormalTok{\_lwd, st\_line\_}\DecValTok{3}\NormalTok{\_lwd,st\_line\_}\DecValTok{4}\NormalTok{\_lwd),}
       \DataTypeTok{title =} \StringTok{\textquotesingle{}Legends\textquotesingle{}}\NormalTok{,}
       \DataTypeTok{y.intersp=}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{Panel-Data-and-Optimization-with-R_files/figure-latex/unnamed-chunk-177-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# record final plot}
\NormalTok{pl\_}\DecValTok{1234}\NormalTok{\_final \textless{}{-}}\StringTok{ }\KeywordTok{recordPlot}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

We used recordplot() earlier. So now we can print just the first two constructed plots.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\CommentTok{\# Eighth, Plot just the first two saved lines}
\CommentTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\CommentTok{\# mar: margin, bottom, left, top, right}
\NormalTok{pl\_}\DecValTok{12}
\CommentTok{\# R Legend}
\KeywordTok{par}\NormalTok{(}\DataTypeTok{new=}\NormalTok{T)}
\KeywordTok{title}\NormalTok{(}\DataTypeTok{main =}\NormalTok{ st\_title, }\DataTypeTok{sub =}\NormalTok{ st\_subtitle, }\DataTypeTok{xlab =}\NormalTok{ st\_x\_label, }\DataTypeTok{ylab =}\NormalTok{ st\_y\_label,}
      \DataTypeTok{cex.lab =}\NormalTok{ fl\_ces\_fig\_reg,}
      \DataTypeTok{cex.main =}\NormalTok{ fl\_ces\_fig\_reg,}
      \DataTypeTok{cex.sub =}\NormalTok{ fl\_ces\_fig\_small)}

\CommentTok{\# Legend sizing CEX}
\KeywordTok{par}\NormalTok{(}\DataTypeTok{new=}\NormalTok{T)}
\KeywordTok{legend}\NormalTok{(}\StringTok{"topright"}\NormalTok{,}
       \DataTypeTok{inset=}\KeywordTok{c}\NormalTok{(}\OperatorTok{{-}}\FloatTok{0.4}\NormalTok{,}\DecValTok{0}\NormalTok{),}
       \DataTypeTok{xpd=}\OtherTok{TRUE}\NormalTok{,}
       \KeywordTok{c}\NormalTok{(st\_point\_}\DecValTok{1}\NormalTok{\_y\_legend, st\_line\_}\DecValTok{2}\NormalTok{\_y\_legend),}
       \DataTypeTok{col =} \KeywordTok{c}\NormalTok{(st\_point\_}\DecValTok{1}\NormalTok{\_blue, st\_line\_}\DecValTok{2}\NormalTok{\_red),}
       \DataTypeTok{pch =} \KeywordTok{c}\NormalTok{(st\_point\_}\DecValTok{1}\NormalTok{\_pch, }\OtherTok{NA}\NormalTok{),}
       \DataTypeTok{cex =}\NormalTok{ fl\_ces\_fig\_small,}
       \DataTypeTok{lty =} \KeywordTok{c}\NormalTok{(}\OtherTok{NA}\NormalTok{, st\_line\_}\DecValTok{2}\NormalTok{\_lty),}
       \DataTypeTok{lwd =} \KeywordTok{c}\NormalTok{(}\OtherTok{NA}\NormalTok{, st\_line\_}\DecValTok{2}\NormalTok{\_lwd),}
       \DataTypeTok{title =} \StringTok{\textquotesingle{}Legends\textquotesingle{}}\NormalTok{,}
       \DataTypeTok{y.intersp=}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{Panel-Data-and-Optimization-with-R_files/figure-latex/unnamed-chunk-178-1} \end{center}

\hypertarget{write-and-read-plots}{%
\section{Write and Read Plots}\label{write-and-read-plots}}

\hypertarget{import-and-export-images}{%
\subsection{Import and Export Images}\label{import-and-export-images}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

Work with the R plot function.

\hypertarget{export-images-different-formats-with-plot}{%
\subsubsection{Export Images Different Formats with Plot()}\label{export-images-different-formats-with-plot}}

\hypertarget{generate-and-record-a-plot}{%
\paragraph{Generate and Record A Plot}\label{generate-and-record-a-plot}}

Generate a graph and recordPlot() it. The generated graph does not have legends Yet. Crucially, there are no titles, legends, axis, labels in the figures. As we stack the figures together, do not add those. Only add at the end jointly for all figure elements together to control at one spot things.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\CommentTok{\# First, Strings}
\CommentTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\CommentTok{\# Labeling}
\NormalTok{st\_title \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}Scatter, Line and Curve Joint Ploting Example Using Base R}\CharTok{\textbackslash{}n}\StringTok{\textquotesingle{}}\NormalTok{,}
                   \StringTok{\textquotesingle{}plot() + curve():sin(x)*cos(x), sin(x)+tan(x)+cos(x)\textquotesingle{}}\NormalTok{)}
\NormalTok{st\_subtitle \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}https://fanwangecon.github.io/\textquotesingle{}}\NormalTok{,}
                      \StringTok{\textquotesingle{}R4Econ/tabgraph/inout/htmlpdfr/fs\_base\_curve.html\textquotesingle{}}\NormalTok{)}
\NormalTok{st\_x\_label \textless{}{-}}\StringTok{ \textquotesingle{}x\textquotesingle{}}
\NormalTok{st\_y\_label \textless{}{-}}\StringTok{ \textquotesingle{}f(x)\textquotesingle{}}

\CommentTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\CommentTok{\# Second, functions}
\CommentTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{fc\_sin\_cos\_diff \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) }\KeywordTok{sin}\NormalTok{(x)}\OperatorTok{*}\KeywordTok{cos}\NormalTok{(x)}
\NormalTok{st\_line\_}\DecValTok{3}\NormalTok{\_y\_legend \textless{}{-}}\StringTok{ \textquotesingle{}sin(x)*cos(x)\textquotesingle{}}
\NormalTok{fc\_sin\_cos\_tan \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) }\KeywordTok{sin}\NormalTok{(x) }\OperatorTok{+}\StringTok{ }\KeywordTok{cos}\NormalTok{(x) }\OperatorTok{+}\StringTok{ }\KeywordTok{tan}\NormalTok{(x)}
\NormalTok{st\_line\_}\DecValTok{4}\NormalTok{\_y\_legend \textless{}{-}}\StringTok{ \textquotesingle{}sin(x) + tan(x) + cos(x)\textquotesingle{}}

\CommentTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\CommentTok{\# Third, patterns}
\CommentTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{st\_line\_}\DecValTok{3}\NormalTok{\_black \textless{}{-}}\StringTok{ \textquotesingle{}black\textquotesingle{}}
\NormalTok{st\_line\_}\DecValTok{4}\NormalTok{\_purple \textless{}{-}}\StringTok{ \textquotesingle{}orange\textquotesingle{}}
\CommentTok{\# line type}
\NormalTok{st\_line\_}\DecValTok{3}\NormalTok{\_lty \textless{}{-}}\StringTok{ \textquotesingle{}dotted\textquotesingle{}}
\NormalTok{st\_line\_}\DecValTok{4}\NormalTok{\_lty \textless{}{-}}\StringTok{ \textquotesingle{}dotdash\textquotesingle{}}
\CommentTok{\# line width}
\NormalTok{st\_line\_}\DecValTok{3}\NormalTok{\_lwd \textless{}{-}}\StringTok{ }\FloatTok{2.5}
\NormalTok{st\_line\_}\DecValTok{4}\NormalTok{\_lwd \textless{}{-}}\StringTok{ }\FloatTok{3.5}

\CommentTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\CommentTok{\# Fourth: Share xlim and ylim}
\CommentTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ar\_xlim =}\StringTok{ }\KeywordTok{c}\NormalTok{(}\OperatorTok{{-}}\DecValTok{3}\NormalTok{, }\DecValTok{3}\NormalTok{)}
\NormalTok{ar\_ylim =}\StringTok{ }\KeywordTok{c}\NormalTok{(}\OperatorTok{{-}}\FloatTok{3.5}\NormalTok{, }\FloatTok{3.5}\NormalTok{)}

\CommentTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\CommentTok{\# Fifth: Even margins}
\CommentTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\KeywordTok{par}\NormalTok{(}\DataTypeTok{new=}\OtherTok{FALSE}\NormalTok{)}

\CommentTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\CommentTok{\# Sixth, the four objects and do not print yet:}
\CommentTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\CommentTok{\# Graph Curve 3}
\KeywordTok{par}\NormalTok{(}\DataTypeTok{new=}\NormalTok{T)}
\KeywordTok{curve}\NormalTok{(fc\_sin\_cos\_diff,}
      \DataTypeTok{col =}\NormalTok{ st\_line\_}\DecValTok{3}\NormalTok{\_black,}
      \DataTypeTok{lwd =}\NormalTok{ st\_line\_}\DecValTok{3}\NormalTok{\_lwd, }\DataTypeTok{lty =}\NormalTok{ st\_line\_}\DecValTok{3}\NormalTok{\_lty,}
      \DataTypeTok{from =}\NormalTok{ ar\_xlim[}\DecValTok{1}\NormalTok{], }\DataTypeTok{to =}\NormalTok{ ar\_xlim[}\DecValTok{2}\NormalTok{], }\DataTypeTok{ylim =}\NormalTok{ ar\_ylim,}
      \DataTypeTok{ylab =} \StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{, }\DataTypeTok{xlab =} \StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{, }\DataTypeTok{yaxt=}\StringTok{\textquotesingle{}n\textquotesingle{}}\NormalTok{, }\DataTypeTok{xaxt=}\StringTok{\textquotesingle{}n\textquotesingle{}}\NormalTok{, }\DataTypeTok{ann=}\OtherTok{FALSE}\NormalTok{)}
\CommentTok{\# Graph Curve 4}
\KeywordTok{par}\NormalTok{(}\DataTypeTok{new=}\NormalTok{T)}
\KeywordTok{curve}\NormalTok{(fc\_sin\_cos\_tan,}
      \DataTypeTok{col =}\NormalTok{ st\_line\_}\DecValTok{4}\NormalTok{\_purple,}
      \DataTypeTok{lwd =}\NormalTok{ st\_line\_}\DecValTok{4}\NormalTok{\_lwd, }\DataTypeTok{lty =}\NormalTok{ st\_line\_}\DecValTok{4}\NormalTok{\_lty,}
      \DataTypeTok{from =}\NormalTok{ ar\_xlim[}\DecValTok{1}\NormalTok{], }\DataTypeTok{to =}\NormalTok{ ar\_xlim[}\DecValTok{2}\NormalTok{], }\DataTypeTok{ylim =}\NormalTok{ ar\_ylim,}
      \DataTypeTok{ylab =} \StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{, }\DataTypeTok{xlab =} \StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{, }\DataTypeTok{yaxt=}\StringTok{\textquotesingle{}n\textquotesingle{}}\NormalTok{, }\DataTypeTok{xaxt=}\StringTok{\textquotesingle{}n\textquotesingle{}}\NormalTok{, }\DataTypeTok{ann=}\OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pl\_curves\_save \textless{}{-}}\StringTok{ }\KeywordTok{recordPlot}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\hypertarget{generate-large-font-and-small-font-versions-of-plot}{%
\paragraph{Generate Large Font and Small Font Versions of PLot}\label{generate-large-font-and-small-font-versions-of-plot}}

Generate larger font version:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Replay}
\NormalTok{pl\_curves\_save}

\CommentTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\CommentTok{\# Seventh, Set Title and Legend and Plot Jointly}
\CommentTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\CommentTok{\# CEX sizing Contorl Titling and Legend Sizes}
\NormalTok{fl\_ces\_fig\_reg =}\StringTok{ }\FloatTok{0.75}
\NormalTok{fl\_ces\_fig\_leg =}\StringTok{ }\FloatTok{0.75}
\NormalTok{fl\_ces\_fig\_small =}\StringTok{ }\FloatTok{0.65}

\CommentTok{\# R Legend}
\KeywordTok{title}\NormalTok{(}\DataTypeTok{main =}\NormalTok{ st\_title, }\DataTypeTok{sub =}\NormalTok{ st\_subtitle, }\DataTypeTok{xlab =}\NormalTok{ st\_x\_label, }\DataTypeTok{ylab =}\NormalTok{ st\_y\_label,}
      \DataTypeTok{cex.lab=}\NormalTok{fl\_ces\_fig\_reg,}
      \DataTypeTok{cex.main=}\NormalTok{fl\_ces\_fig\_reg,}
      \DataTypeTok{cex.sub=}\NormalTok{fl\_ces\_fig\_small)}
\KeywordTok{axis}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DataTypeTok{cex.axis=}\NormalTok{fl\_ces\_fig\_reg)}
\KeywordTok{axis}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DataTypeTok{cex.axis=}\NormalTok{fl\_ces\_fig\_reg)}
\KeywordTok{grid}\NormalTok{()}

\CommentTok{\# Legend sizing CEX}
\KeywordTok{legend}\NormalTok{(}\StringTok{"topleft"}\NormalTok{,}
       \DataTypeTok{bg=}\StringTok{"transparent"}\NormalTok{,}
       \DataTypeTok{bty =} \StringTok{"n"}\NormalTok{,}
       \KeywordTok{c}\NormalTok{(st\_line\_}\DecValTok{3}\NormalTok{\_y\_legend, st\_line\_}\DecValTok{4}\NormalTok{\_y\_legend),}
       \DataTypeTok{col =} \KeywordTok{c}\NormalTok{(st\_line\_}\DecValTok{3}\NormalTok{\_black, st\_line\_}\DecValTok{4}\NormalTok{\_purple),}
       \DataTypeTok{pch =} \KeywordTok{c}\NormalTok{(}\OtherTok{NA}\NormalTok{, }\OtherTok{NA}\NormalTok{),}
       \DataTypeTok{cex =}\NormalTok{ fl\_ces\_fig\_leg,}
       \DataTypeTok{lty =} \KeywordTok{c}\NormalTok{(st\_line\_}\DecValTok{3}\NormalTok{\_lty, st\_line\_}\DecValTok{4}\NormalTok{\_lty),}
       \DataTypeTok{lwd =} \KeywordTok{c}\NormalTok{(st\_line\_}\DecValTok{3}\NormalTok{\_lwd,st\_line\_}\DecValTok{4}\NormalTok{\_lwd),}
       \DataTypeTok{y.intersp=}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# record final plot}
\NormalTok{pl\_curves\_large \textless{}{-}}\StringTok{ }\KeywordTok{recordPlot}\NormalTok{()}
\KeywordTok{dev.off}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

Generate smaller font version:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Replay}
\NormalTok{pl\_curves\_save}

\CommentTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\CommentTok{\# Seventh, Set Title and Legend and Plot Jointly}
\CommentTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\CommentTok{\# CEX sizing Contorl Titling and Legend Sizes}
\NormalTok{fl\_ces\_fig\_reg =}\StringTok{ }\FloatTok{0.45}
\NormalTok{fl\_ces\_fig\_leg =}\StringTok{ }\FloatTok{0.45}
\NormalTok{fl\_ces\_fig\_small =}\StringTok{ }\FloatTok{0.25}

\CommentTok{\# R Legend}
\KeywordTok{title}\NormalTok{(}\DataTypeTok{main =}\NormalTok{ st\_title, }\DataTypeTok{sub =}\NormalTok{ st\_subtitle, }\DataTypeTok{xlab =}\NormalTok{ st\_x\_label, }\DataTypeTok{ylab =}\NormalTok{ st\_y\_label,}
      \DataTypeTok{cex.lab=}\NormalTok{fl\_ces\_fig\_reg,}
      \DataTypeTok{cex.main=}\NormalTok{fl\_ces\_fig\_reg,}
      \DataTypeTok{cex.sub=}\NormalTok{fl\_ces\_fig\_small)}
\KeywordTok{axis}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DataTypeTok{cex.axis=}\NormalTok{fl\_ces\_fig\_reg)}
\KeywordTok{axis}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DataTypeTok{cex.axis=}\NormalTok{fl\_ces\_fig\_reg)}
\KeywordTok{grid}\NormalTok{()}

\CommentTok{\# Legend sizing CEX}
\KeywordTok{legend}\NormalTok{(}\StringTok{"topleft"}\NormalTok{,}
       \DataTypeTok{bg=}\StringTok{"transparent"}\NormalTok{,}
       \DataTypeTok{bty =} \StringTok{"n"}\NormalTok{,}
       \KeywordTok{c}\NormalTok{(st\_line\_}\DecValTok{3}\NormalTok{\_y\_legend, st\_line\_}\DecValTok{4}\NormalTok{\_y\_legend),}
       \DataTypeTok{col =} \KeywordTok{c}\NormalTok{(st\_line\_}\DecValTok{3}\NormalTok{\_black, st\_line\_}\DecValTok{4}\NormalTok{\_purple),}
       \DataTypeTok{pch =} \KeywordTok{c}\NormalTok{(}\OtherTok{NA}\NormalTok{, }\OtherTok{NA}\NormalTok{),}
       \DataTypeTok{cex =}\NormalTok{ fl\_ces\_fig\_leg,}
       \DataTypeTok{lty =} \KeywordTok{c}\NormalTok{(st\_line\_}\DecValTok{3}\NormalTok{\_lty, st\_line\_}\DecValTok{4}\NormalTok{\_lty),}
       \DataTypeTok{lwd =} \KeywordTok{c}\NormalTok{(st\_line\_}\DecValTok{3}\NormalTok{\_lwd,st\_line\_}\DecValTok{4}\NormalTok{\_lwd),}
       \DataTypeTok{y.intersp=}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# record final plot}
\NormalTok{pl\_curves\_small \textless{}{-}}\StringTok{ }\KeywordTok{recordPlot}\NormalTok{()}
\KeywordTok{dev.off}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\hypertarget{save-plot-with-varying-resolutions-and-heights}{%
\paragraph{Save Plot with Varying Resolutions and Heights}\label{save-plot-with-varying-resolutions-and-heights}}

Export recorded plot.

A4 paper is 8.3 x 11.7, with 1 inch margins, the remaining area is 6.3 x 9.7. For figures that should take half of the page, the height should be 4.8 inch. One third of a page should be 3.2 inch. 6.3 inch is 160mm and 3 inch is 76 mm. In the example below, use

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Store both in within folder directory and root image directory:}
\CommentTok{\# C:\textbackslash{}Users\textbackslash{}fan\textbackslash{}R4Econ\textbackslash{}tabgraph\textbackslash{}inout\textbackslash{}\_img}
\CommentTok{\# C:\textbackslash{}Users\textbackslash{}fan\textbackslash{}R4Econ\textbackslash{}\_img}
\CommentTok{\# need to store in both because bookdown and indi pdf path differ.}
\CommentTok{\# Wrap in try because will not work underbookdown, but images already created}

\NormalTok{ls\_spt\_root \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}..//..//\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{)}
\NormalTok{spt\_prefix \textless{}{-}}\StringTok{ \textquotesingle{}\_img/fs\_img\_io\_2curve\textquotesingle{}}

\ControlFlowTok{for}\NormalTok{ (spt\_root }\ControlFlowTok{in}\NormalTok{ ls\_spt\_root) \{}
  \CommentTok{\# Changing pointsize will not change font sizes inside, just rescale}
  \CommentTok{\# PNG 72}
  \KeywordTok{try}\NormalTok{(}\KeywordTok{png}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(spt\_root, spt\_prefix, }\StringTok{"\_w135h76\_res72.png"}\NormalTok{),}
      \DataTypeTok{width =} \DecValTok{135}\NormalTok{ , }\DataTypeTok{height =} \DecValTok{76}\NormalTok{, }\DataTypeTok{units=}\StringTok{\textquotesingle{}mm\textquotesingle{}}\NormalTok{, }\DataTypeTok{res =} \DecValTok{72}\NormalTok{, }\DataTypeTok{pointsize=}\DecValTok{7}\NormalTok{))}
  \KeywordTok{print}\NormalTok{(pl\_curves\_large)}
  \KeywordTok{dev.off}\NormalTok{()}
  \CommentTok{\# PNG 300}
  \KeywordTok{try}\NormalTok{(}\KeywordTok{png}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(spt\_root, spt\_prefix, }\StringTok{"\_w135h76\_res300.png"}\NormalTok{),}
      \DataTypeTok{width =} \DecValTok{135}\NormalTok{, }\DataTypeTok{height =} \DecValTok{76}\NormalTok{, }\DataTypeTok{units=}\StringTok{\textquotesingle{}mm\textquotesingle{}}\NormalTok{, }\DataTypeTok{res =} \DecValTok{300}\NormalTok{, }\DataTypeTok{pointsize=}\DecValTok{7}\NormalTok{))}
  \KeywordTok{print}\NormalTok{(pl\_curves\_large)}
  \KeywordTok{dev.off}\NormalTok{()}
  \CommentTok{\# PNG 300, SMALL, POINT SIZE LOWER}
  \KeywordTok{try}\NormalTok{(}\KeywordTok{png}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(spt\_root, spt\_prefix, }\StringTok{"\_w80h48\_res300.png"}\NormalTok{),}
      \DataTypeTok{width =} \DecValTok{80}\NormalTok{, }\DataTypeTok{height =} \DecValTok{48}\NormalTok{, }\DataTypeTok{units=}\StringTok{\textquotesingle{}mm\textquotesingle{}}\NormalTok{, }\DataTypeTok{res =} \DecValTok{300}\NormalTok{, }\DataTypeTok{pointsize=}\DecValTok{7}\NormalTok{))}
  \KeywordTok{print}\NormalTok{(pl\_curves\_small)}
  \KeywordTok{dev.off}\NormalTok{()}
  \CommentTok{\# PNG 300}
  \KeywordTok{try}\NormalTok{(}\KeywordTok{png}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(spt\_root, spt\_prefix, }\StringTok{"\_w160h100\_res300.png"}\NormalTok{),}
      \DataTypeTok{width =} \DecValTok{160}\NormalTok{, }\DataTypeTok{height =} \DecValTok{100}\NormalTok{, }\DataTypeTok{units=}\StringTok{\textquotesingle{}mm\textquotesingle{}}\NormalTok{, }\DataTypeTok{res =} \DecValTok{300}\NormalTok{))}
  \KeywordTok{print}\NormalTok{(pl\_curves\_large)}
  \KeywordTok{dev.off}\NormalTok{()}

  \CommentTok{\# EPS}
  \KeywordTok{setEPS}\NormalTok{()}
  \KeywordTok{try}\NormalTok{(}\KeywordTok{postscript}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(spt\_root, spt\_prefix, }\StringTok{"\_fs\_2curve.eps"}\NormalTok{)))}
  \KeywordTok{print}\NormalTok{(pl\_curves\_large)}
  \KeywordTok{dev.off}\NormalTok{()}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Error in png(paste0(spt_root, spt_prefix, "_w135h76_res72.png"), width = 135,  : 
##   unable to start png() device
## Error in png(paste0(spt_root, spt_prefix, "_w135h76_res300.png"), width = 135,  : 
##   unable to start png() device
## Error in png(paste0(spt_root, spt_prefix, "_w80h48_res300.png"), width = 80,  : 
##   unable to start png() device
## Error in png(paste0(spt_root, spt_prefix, "_w160h100_res300.png"), width = 160,  : 
##   unable to start png() device
## Error in postscript(paste0(spt_root, spt_prefix, "_fs_2curve.eps")) : 
##   cannot open file '..//..//_img/fs_img_io_2curve_fs_2curve.eps'
\end{verbatim}

\hypertarget{low-and-high-resolution-figure}{%
\paragraph{Low and High Resolution Figure}\label{low-and-high-resolution-figure}}

The standard resolution often produces very low quality images. Resolution should be increased. See figure comparison.

\begin{figure}
\centering
\caption{RES=72 (DEFAULT R) TOP, RES=300 Bottom, (Width=160, Height=81, PNG)}
\includegraphics[width=\linewidth]{_img/fs_img_io_2curve_w135h76_res72.png}
\hfill
\centering
\includegraphics[width=\linewidth]{_img/fs_img_io_2curve_w135h76_res300.png}
\end{figure}

\hypertarget{smaller-and-larger-figures}{%
\paragraph{Smaller and Larger Figures}\label{smaller-and-larger-figures}}

Smaller and larger figures with different font size comparison. Note that earlier, we generated the figure without legends, labels, etc first, recorded the figure. Then we associated the same underlying figure with differently sized titles, legends, axis, labels.

\begin{figure}
\centering
\caption{Top Small (small font saved), Bottom Large, PNG}
\includegraphics[width=\linewidth]{_img/fs_img_io_2curve_w80h48_res300.png}
\hfill
\centering
\includegraphics[width=\linewidth]{_img/fs_img_io_2curve_w160h100_res300.png}
\end{figure}

\hypertarget{programming}{%
\chapter{Programming}\label{programming}}

\hypertarget{file-in-and-out}{%
\section{File in and Out}\label{file-in-and-out}}

\hypertarget{text-to-file}{%
\subsection{Text to File}\label{text-to-file}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

\hypertarget{latex-table-to-file}{%
\subsubsection{Latex Table to File}\label{latex-table-to-file}}

Tabular outputs, text outputs, etc are saved as variables, which could be printed in console. They can also be saved to file for future re-used. For example, latex outputs need to be saved to file.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Load Data}
\NormalTok{dt \textless{}{-}}\StringTok{ }\NormalTok{mtcars[}\DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{, }\DecValTok{1}\OperatorTok{:}\DecValTok{6}\NormalTok{]}
\CommentTok{\# Generate latex string variable}
\NormalTok{st\_out\_tex \textless{}{-}}\StringTok{ }\KeywordTok{kable}\NormalTok{(dt, }\StringTok{"latex"}\NormalTok{)}
\KeywordTok{print}\NormalTok{(st\_out\_tex)}
\CommentTok{\# File out}
\CommentTok{\# fileConn \textless{}{-} file("./../../\_file/tex/tex\_sample\_a\_tab.tex")}
\NormalTok{fileConn \textless{}{-}}\StringTok{ }\KeywordTok{file}\NormalTok{(}\StringTok{"\_file/tex/tex\_sample\_a\_tab.tex"}\NormalTok{)}
\KeywordTok{writeLines}\NormalTok{(st\_out\_tex, fileConn)}
\KeywordTok{close}\NormalTok{(fileConn)}
\end{Highlighting}
\end{Shaded}

\hypertarget{create-a-text-file-from-strings}{%
\subsubsection{Create a Text File from Strings}\label{create-a-text-file-from-strings}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{st\_file \textless{}{-}}\StringTok{ "}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{documentclass[12pt,english]\{article\}}
\CharTok{\textbackslash{}\textbackslash{}}\StringTok{usepackage[bottom]\{footmisc\}}
\CharTok{\textbackslash{}\textbackslash{}}\StringTok{usepackage[urlcolor=blue]\{hyperref\}}
\CharTok{\textbackslash{}\textbackslash{}}\StringTok{begin\{document\}}
\CharTok{\textbackslash{}\textbackslash{}}\StringTok{title\{A Latex Testing File\}}
\CharTok{\textbackslash{}\textbackslash{}}\StringTok{author\{}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{href\{http://fanwangecon.github.io/\}\{Fan Wang\} }\CharTok{\textbackslash{}\textbackslash{}}\StringTok{thanks\{See information }\CharTok{\textbackslash{}\textbackslash{}}\StringTok{href\{https://fanwangecon.github.io/Tex4Econ/\}\{Tex4Econ\} for more.\}\}}
\CharTok{\textbackslash{}\textbackslash{}}\StringTok{maketitle}
\StringTok{Ipsum information dolor sit amet, consectetur adipiscing elit. Integer Latex placerat nunc orci.}
\CharTok{\textbackslash{}\textbackslash{}}\StringTok{paragraph\{}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{href\{https://papers.ssrn.com/sol3/papers.cfm?abstract\_id=3140132\}\{Data\}\}}
\StringTok{Village closure information is taken from a village head survey.}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{footnote\{Generally students went to schools.\}}
\StringTok{output:}
\StringTok{  pdf\_document:}
\StringTok{    pandoc\_args: \textquotesingle{}..//..//\_output\_kniti\_pdf.yaml\textquotesingle{}}
\StringTok{    includes:}
\StringTok{      in\_header: \textquotesingle{}..//..//preamble.tex\textquotesingle{}}
\StringTok{  html\_document:}
\StringTok{    pandoc\_args: \textquotesingle{}..//..//\_output\_kniti\_html.yaml\textquotesingle{}}
\StringTok{    includes:}
\StringTok{      in\_header: \textquotesingle{}..//..//hdga.html\textquotesingle{}}
\CharTok{\textbackslash{}\textbackslash{}}\StringTok{end\{document\}"}

\KeywordTok{print}\NormalTok{(st\_file)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "\\documentclass[12pt,english]{article}\n\\usepackage[bottom]{footmisc}\n\\usepackage[urlcolor=blue]{hyperref}\n\\begin{document}\n\\title{A Latex Testing File}\n\\author{\\href{http://fanwangecon.github.io/}{Fan Wang} \\thanks{See information \\href{https://fanwangecon.github.io/Tex4Econ/}{Tex4Econ} for more.}}\n\\maketitle\nIpsum information dolor sit amet, consectetur adipiscing elit. Integer Latex placerat nunc orci.\n\\paragraph{\\href{https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3140132}{Data}}\nVillage closure information is taken from a village head survey.\\footnote{Generally students went to schools.}\noutput:\n  pdf_document:\n    pandoc_args: '..//..//_output_kniti_pdf.yaml'\n    includes:\n      in_header: '..//..//preamble.tex'\n  html_document:\n    pandoc_args: '..//..//_output_kniti_html.yaml'\n    includes:\n      in_header: '..//..//hdga.html'\n\\end{document}"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fl\_test\_tex \textless{}{-}}\StringTok{ "\_file/tex/test\_fan.tex"}
\NormalTok{fileConn \textless{}{-}}\StringTok{ }\KeywordTok{file}\NormalTok{(fl\_test\_tex)}
\KeywordTok{writeLines}\NormalTok{(st\_file, fileConn)}
\KeywordTok{close}\NormalTok{(fileConn)}
\end{Highlighting}
\end{Shaded}

\hypertarget{open-a-file-and-read-lines}{%
\subsubsection{Open A File and Read Lines}\label{open-a-file-and-read-lines}}

Open and Replace Text in File:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fileConn \textless{}{-}}\StringTok{ }\KeywordTok{file}\NormalTok{(fl\_test\_tex, }\StringTok{"r"}\NormalTok{)}
\NormalTok{st\_file\_read \textless{}{-}}\StringTok{ }\KeywordTok{readLines}\NormalTok{(fileConn)}
\KeywordTok{print}\NormalTok{(st\_file\_read)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "\\documentclass[12pt,english]{article}"                                                                                                                 
##  [2] "\\usepackage[bottom]{footmisc}"                                                                                                                         
##  [3] "\\usepackage[urlcolor=blue]{hyperref}"                                                                                                                  
##  [4] "\\begin{document}"                                                                                                                                      
##  [5] "\\title{A Latex Testing File}"                                                                                                                          
##  [6] "\\author{\\href{http://fanwangecon.github.io/}{Fan Wang} \\thanks{See information \\href{https://fanwangecon.github.io/Tex4Econ/}{Tex4Econ} for more.}}"
##  [7] "\\maketitle"                                                                                                                                            
##  [8] "Ipsum information dolor sit amet, consectetur adipiscing elit. Integer Latex placerat nunc orci."                                                       
##  [9] "\\paragraph{\\href{https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3140132}{Data}}"                                                                 
## [10] "Village closure information is taken from a village head survey.\\footnote{Generally students went to schools.}"                                        
## [11] "output:"                                                                                                                                                
## [12] "  pdf_document:"                                                                                                                                        
## [13] "    pandoc_args: '..//..//_output_kniti_pdf.yaml'"                                                                                                      
## [14] "    includes:"                                                                                                                                          
## [15] "      in_header: '..//..//preamble.tex'"                                                                                                                
## [16] "  html_document:"                                                                                                                                       
## [17] "    pandoc_args: '..//..//_output_kniti_html.yaml'"                                                                                                     
## [18] "    includes:"                                                                                                                                          
## [19] "      in_header: '..//..//hdga.html'"                                                                                                                   
## [20] "\\end{document}"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{close}\NormalTok{(fileConn)}
\end{Highlighting}
\end{Shaded}

\hypertarget{open-a-file-and-replace-some-lines}{%
\subsubsection{Open a File and Replace Some Lines}\label{open-a-file-and-replace-some-lines}}

Append additional strings into the file after \emph{html\_document} with proper spacings:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Read in Lines from existing file}
\NormalTok{fileConn \textless{}{-}}\StringTok{ }\KeywordTok{file}\NormalTok{(fl\_test\_tex, }\StringTok{"r"}\NormalTok{)}
\NormalTok{st\_file\_read \textless{}{-}}\StringTok{ }\KeywordTok{readLines}\NormalTok{(fileConn)}
\KeywordTok{close}\NormalTok{(fileConn)}

\CommentTok{\# Search and Replace String}
\NormalTok{st\_search \textless{}{-}}\StringTok{ "html\_document:"}
\NormalTok{st\_replace \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{"html\_document:}\CharTok{\textbackslash{}r\textbackslash{}n}\StringTok{"}\NormalTok{,}
                     \StringTok{"    toc: true}\CharTok{\textbackslash{}r\textbackslash{}n}\StringTok{"}\NormalTok{,}
                     \StringTok{"    number\_sections: true}\CharTok{\textbackslash{}r\textbackslash{}n}\StringTok{"}\NormalTok{,}
                     \StringTok{"    toc\_float:}\CharTok{\textbackslash{}r\textbackslash{}n}\StringTok{"}\NormalTok{,}
                     \StringTok{"      collapsed: false}\CharTok{\textbackslash{}r\textbackslash{}n}\StringTok{"}\NormalTok{,}
                     \StringTok{"      smooth\_scroll: false}\CharTok{\textbackslash{}r\textbackslash{}n}\StringTok{"}\NormalTok{,}
                     \StringTok{"      toc\_depth: 3"}\NormalTok{)}

\CommentTok{\# Search and Replace}
\NormalTok{st\_file\_updated \textless{}{-}}\StringTok{ }\KeywordTok{gsub}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ st\_file\_read,}
                        \DataTypeTok{pattern =}\NormalTok{ st\_search,}
                        \DataTypeTok{replacement =}\NormalTok{ st\_replace)}

\CommentTok{\# Print}
\KeywordTok{print}\NormalTok{(st\_file\_updated)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "\\documentclass[12pt,english]{article}"                                                                                                                        
##  [2] "\\usepackage[bottom]{footmisc}"                                                                                                                                
##  [3] "\\usepackage[urlcolor=blue]{hyperref}"                                                                                                                         
##  [4] "\\begin{document}"                                                                                                                                             
##  [5] "\\title{A Latex Testing File}"                                                                                                                                 
##  [6] "\\author{\\href{http://fanwangecon.github.io/}{Fan Wang} \\thanks{See information \\href{https://fanwangecon.github.io/Tex4Econ/}{Tex4Econ} for more.}}"       
##  [7] "\\maketitle"                                                                                                                                                   
##  [8] "Ipsum information dolor sit amet, consectetur adipiscing elit. Integer Latex placerat nunc orci."                                                              
##  [9] "\\paragraph{\\href{https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3140132}{Data}}"                                                                        
## [10] "Village closure information is taken from a village head survey.\\footnote{Generally students went to schools.}"                                               
## [11] "output:"                                                                                                                                                       
## [12] "  pdf_document:"                                                                                                                                               
## [13] "    pandoc_args: '..//..//_output_kniti_pdf.yaml'"                                                                                                             
## [14] "    includes:"                                                                                                                                                 
## [15] "      in_header: '..//..//preamble.tex'"                                                                                                                       
## [16] "  html_document:\r\n    toc: true\r\n    number_sections: true\r\n    toc_float:\r\n      collapsed: false\r\n      smooth_scroll: false\r\n      toc_depth: 3"
## [17] "    pandoc_args: '..//..//_output_kniti_html.yaml'"                                                                                                            
## [18] "    includes:"                                                                                                                                                 
## [19] "      in_header: '..//..//hdga.html'"                                                                                                                          
## [20] "\\end{document}"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Save Updated File}
\NormalTok{fl\_srcrep\_tex \textless{}{-}}\StringTok{ "\_file/tex/test\_fan\_search\_replace.tex"}
\NormalTok{fileConn\_sr \textless{}{-}}\StringTok{ }\KeywordTok{file}\NormalTok{(fl\_srcrep\_tex)}
\KeywordTok{writeLines}\NormalTok{(st\_file\_updated, fileConn\_sr)}
\KeywordTok{close}\NormalTok{(fileConn\_sr)}
\end{Highlighting}
\end{Shaded}

\hypertarget{rmd-to-html}{%
\subsection{Rmd to HTML}\label{rmd-to-html}}

\begin{quote}
Go back to \href{http://fanwangecon.github.io/}{fan}'s \href{https://fanwangecon.github.io/REconTools/}{REconTools} Package, \href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository (\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}), or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R} Repository (\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown site}).
\end{quote}

\hypertarget{search-and-find-all-files-in-repository}{%
\subsubsection{Search and Find all Files in Repository}\label{search-and-find-all-files-in-repository}}

Search inside directories, for all files in a repository that have a particular suffix and that don't contain skip pattern list string items.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Serch Folder and skip list}
\NormalTok{spt\_roots \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}C:/Users/fan/R4Econ/amto\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}C:/Users/fan/R4Econ/summarize\textquotesingle{}}\NormalTok{)}
\NormalTok{spn\_skip \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}summarize\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}panel\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}support\textquotesingle{}}\NormalTok{)}

\CommentTok{\# Search and get all Path}
\NormalTok{ls\_sfls \textless{}{-}}\StringTok{ }\KeywordTok{list.files}\NormalTok{(}\DataTypeTok{path=}\NormalTok{spt\_roots, }\DataTypeTok{recursive=}\NormalTok{T, }\DataTypeTok{pattern=}\StringTok{".Rmd"}\NormalTok{, }\DataTypeTok{full.names=}\NormalTok{T)}

\CommentTok{\# Skip path if contains words in skip list}
\ControlFlowTok{if}\NormalTok{(}\OperatorTok{!}\KeywordTok{missing}\NormalTok{(spn\_skip)) \{}
\NormalTok{  ls\_sfls \textless{}{-}}\StringTok{ }\NormalTok{ls\_sfls[}\OperatorTok{!}\KeywordTok{grepl}\NormalTok{(}\KeywordTok{paste}\NormalTok{(spn\_skip, }\DataTypeTok{collapse =} \StringTok{"|"}\NormalTok{), ls\_sfls)]}
\NormalTok{\}}

\CommentTok{\# Loop and print}
\ControlFlowTok{for}\NormalTok{ (spt\_file }\ControlFlowTok{in}\NormalTok{ ls\_sfls) \{}
\NormalTok{    st\_fullpath\_nosufx \textless{}{-}}\StringTok{ }\KeywordTok{tail}\NormalTok{(}\KeywordTok{strsplit}\NormalTok{(spt\_file, }\StringTok{"/"}\NormalTok{)[[}\DecValTok{1}\NormalTok{]],}\DataTypeTok{n=}\DecValTok{1}\NormalTok{)}
    \KeywordTok{print}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(spt\_file, }\StringTok{\textquotesingle{}{-}{-}{-}\textquotesingle{}}\NormalTok{, st\_fullpath\_nosufx))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "C:/Users/fan/R4Econ/amto/array/fs_ary_basics.Rmd---fs_ary_basics.Rmd"
## [1] "C:/Users/fan/R4Econ/amto/array/fs_ary_generate.Rmd---fs_ary_generate.Rmd"
## [1] "C:/Users/fan/R4Econ/amto/array/fs_ary_mesh.Rmd---fs_ary_mesh.Rmd"
## [1] "C:/Users/fan/R4Econ/amto/array/fs_ary_string.Rmd---fs_ary_string.Rmd"
## [1] "C:/Users/fan/R4Econ/amto/array/main.Rmd---main.Rmd"
## [1] "C:/Users/fan/R4Econ/amto/list/fs_lst_basics.Rmd---fs_lst_basics.Rmd"
## [1] "C:/Users/fan/R4Econ/amto/list/main.Rmd---main.Rmd"
## [1] "C:/Users/fan/R4Econ/amto/main.Rmd---main.Rmd"
## [1] "C:/Users/fan/R4Econ/amto/matrix/fs_mat_generate.Rmd---fs_mat_generate.Rmd"
## [1] "C:/Users/fan/R4Econ/amto/matrix/fs_mat_linear_algebra.Rmd---fs_mat_linear_algebra.Rmd"
## [1] "C:/Users/fan/R4Econ/amto/matrix/main.Rmd---main.Rmd"
## [1] "C:/Users/fan/R4Econ/amto/tibble/fs_tib_basics.Rmd---fs_tib_basics.Rmd"
## [1] "C:/Users/fan/R4Econ/amto/tibble/fs_tib_factors.Rmd---fs_tib_factors.Rmd"
## [1] "C:/Users/fan/R4Econ/amto/tibble/fs_tib_na.Rmd---fs_tib_na.Rmd"
## [1] "C:/Users/fan/R4Econ/amto/tibble/fs_tib_random_draws.Rmd---fs_tib_random_draws.Rmd"
## [1] "C:/Users/fan/R4Econ/amto/tibble/fs_tib_string.Rmd---fs_tib_string.Rmd"
## [1] "C:/Users/fan/R4Econ/amto/tibble/main.Rmd---main.Rmd"
\end{verbatim}

\hypertarget{search-and-find-all-git-modified-or-new-rmd}{%
\subsubsection{Search and Find all Git Modified or New Rmd}\label{search-and-find-all-git-modified-or-new-rmd}}

Search inside directories, for all files in a git repo folder that are new or have been modified. Ignore possible subset of file based on string search.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Serch Folder and skip list}
\NormalTok{spt\_roots \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}C:/Users/fan/R4Econ/amto\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}C:/Users/fan/R4Econ/development\textquotesingle{}}\NormalTok{)}
\NormalTok{spn\_skip \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}summarize\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}panel\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}support\textquotesingle{}}\NormalTok{)}
\NormalTok{ls\_sfls \textless{}{-}}\StringTok{ }\KeywordTok{list.files}\NormalTok{(}\DataTypeTok{path=}\NormalTok{spt\_roots, }\DataTypeTok{recursive=}\NormalTok{T, }\DataTypeTok{pattern=}\StringTok{".Rmd"}\NormalTok{, }\DataTypeTok{full.names=}\NormalTok{T)}
\ControlFlowTok{if}\NormalTok{(}\OperatorTok{!}\KeywordTok{missing}\NormalTok{(spn\_skip)) \{}
\NormalTok{  ls\_sfls \textless{}{-}}\StringTok{ }\NormalTok{ls\_sfls[}\OperatorTok{!}\KeywordTok{grepl}\NormalTok{(}\KeywordTok{paste}\NormalTok{(spn\_skip, }\DataTypeTok{collapse =} \StringTok{"|"}\NormalTok{), ls\_sfls)]}
\NormalTok{\}}

\CommentTok{\# Loop and print}
\ControlFlowTok{for}\NormalTok{ (spt\_file }\ControlFlowTok{in}\NormalTok{ ls\_sfls) \{}
\NormalTok{  spg\_check\_git\_status \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}git status {-}s \textquotesingle{}}\NormalTok{, spt\_file)}
\NormalTok{  st\_git\_status \textless{}{-}}\StringTok{ }\KeywordTok{toString}\NormalTok{(}\KeywordTok{system}\NormalTok{(spg\_check\_git\_status, }\DataTypeTok{intern=}\OtherTok{TRUE}\NormalTok{))}
\NormalTok{  bl\_modified \textless{}{-}}\StringTok{ }\KeywordTok{grepl}\NormalTok{(}\StringTok{\textquotesingle{} M \textquotesingle{}}\NormalTok{, st\_git\_status, }\DataTypeTok{fixed=}\OtherTok{TRUE}\NormalTok{)}
\NormalTok{  bl\_anewfile \textless{}{-}}\StringTok{ }\KeywordTok{grepl}\NormalTok{(}\StringTok{\textquotesingle{}?? \textquotesingle{}}\NormalTok{, st\_git\_status, }\DataTypeTok{fixed=}\OtherTok{TRUE}\NormalTok{)}
\NormalTok{  bl\_nochange \textless{}{-}}\StringTok{ }\NormalTok{(st\_git\_status }\OperatorTok{==}\StringTok{ ""}\NormalTok{)}

  \ControlFlowTok{if}\NormalTok{ (bl\_modified }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{) \{}
    \KeywordTok{print}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}MODIFIED: \textquotesingle{}}\NormalTok{, spt\_file))}
\NormalTok{  \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (bl\_anewfile }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{) \{}
    \KeywordTok{print}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}A NEW FL: \textquotesingle{}}\NormalTok{, spt\_file))}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
    \KeywordTok{print}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}NO CHNGE: \textquotesingle{}}\NormalTok{, spt\_file))}
\NormalTok{  \}}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "NO CHNGE: C:/Users/fan/R4Econ/amto/array/fs_ary_basics.Rmd"
## [1] "NO CHNGE: C:/Users/fan/R4Econ/amto/array/fs_ary_generate.Rmd"
## [1] "NO CHNGE: C:/Users/fan/R4Econ/amto/array/fs_ary_mesh.Rmd"
## [1] "NO CHNGE: C:/Users/fan/R4Econ/amto/array/fs_ary_string.Rmd"
## [1] "NO CHNGE: C:/Users/fan/R4Econ/amto/array/main.Rmd"
## [1] "NO CHNGE: C:/Users/fan/R4Econ/amto/list/fs_lst_basics.Rmd"
## [1] "NO CHNGE: C:/Users/fan/R4Econ/amto/list/main.Rmd"
## [1] "NO CHNGE: C:/Users/fan/R4Econ/amto/main.Rmd"
## [1] "NO CHNGE: C:/Users/fan/R4Econ/amto/matrix/fs_mat_generate.Rmd"
## [1] "NO CHNGE: C:/Users/fan/R4Econ/amto/matrix/fs_mat_linear_algebra.Rmd"
## [1] "NO CHNGE: C:/Users/fan/R4Econ/amto/matrix/main.Rmd"
## [1] "NO CHNGE: C:/Users/fan/R4Econ/amto/tibble/fs_tib_basics.Rmd"
## [1] "NO CHNGE: C:/Users/fan/R4Econ/amto/tibble/fs_tib_factors.Rmd"
## [1] "NO CHNGE: C:/Users/fan/R4Econ/amto/tibble/fs_tib_na.Rmd"
## [1] "NO CHNGE: C:/Users/fan/R4Econ/amto/tibble/fs_tib_random_draws.Rmd"
## [1] "NO CHNGE: C:/Users/fan/R4Econ/amto/tibble/fs_tib_string.Rmd"
## [1] "NO CHNGE: C:/Users/fan/R4Econ/amto/tibble/main.Rmd"
## [1] "NO CHNGE: C:/Users/fan/R4Econ/development/inout/_file/rmd/fs_rmd_pdf_html_mod.Rmd"
## [1] "NO CHNGE: C:/Users/fan/R4Econ/development/inout/_file/rmd/fs_text_save_mod.Rmd"
## [1] "NO CHNGE: C:/Users/fan/R4Econ/development/inout/_file/rmd/main_mod.Rmd"
## [1] "NO CHNGE: C:/Users/fan/R4Econ/development/inout/fs_rmd_pdf_html.Rmd"
## [1] "NO CHNGE: C:/Users/fan/R4Econ/development/inout/fs_text_save.Rmd"
## [1] "NO CHNGE: C:/Users/fan/R4Econ/development/inout/main.Rmd"
## [1] "NO CHNGE: C:/Users/fan/R4Econ/development/main.Rmd"
\end{verbatim}

\hypertarget{resave-an-existing-file-with-different-name-different-folder}{%
\subsubsection{Resave an Existing File with Different Name Different Folder}\label{resave-an-existing-file-with-different-name-different-folder}}

Given an existing Rmd File, Resave it with a different name (add to name suffix), and then save in a different folder:

\begin{itemize}
\tightlist
\item
  old file: \emph{/R4Econ/development/fs\_rmd\_pdf\_html.Rmd}
\item
  new file: *R4Econ/development/inout/\_file/rmd/fs\_rmd\_pdf\_html\_mod.Rmd*
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Serch Folder and skip list}
\NormalTok{spt\_roots \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}C:/Users/fan/R4Econ/development/inout/\textquotesingle{}}\NormalTok{)}
\NormalTok{spn\_skip \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}\_main\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}\_file\textquotesingle{}}\NormalTok{)}
\NormalTok{ls\_sfls \textless{}{-}}\StringTok{ }\KeywordTok{list.files}\NormalTok{(}\DataTypeTok{path=}\NormalTok{spt\_roots, }\DataTypeTok{recursive=}\NormalTok{T, }\DataTypeTok{pattern=}\StringTok{".Rmd"}\NormalTok{, }\DataTypeTok{full.names=}\NormalTok{T)}
\ControlFlowTok{if}\NormalTok{(}\OperatorTok{!}\KeywordTok{missing}\NormalTok{(spn\_skip)) \{}
\NormalTok{  ls\_sfls \textless{}{-}}\StringTok{ }\NormalTok{ls\_sfls[}\OperatorTok{!}\KeywordTok{grepl}\NormalTok{(}\KeywordTok{paste}\NormalTok{(spn\_skip, }\DataTypeTok{collapse =} \StringTok{"|"}\NormalTok{), ls\_sfls)]}
\NormalTok{\}}

\CommentTok{\# Loop and print}
\ControlFlowTok{for}\NormalTok{ (spt\_file }\ControlFlowTok{in}\NormalTok{ ls\_sfls) \{}
\NormalTok{  spt\_new \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}\_file/rmd/\textquotesingle{}}\NormalTok{)}
\NormalTok{  spn\_new \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(spt\_new, }\KeywordTok{sub}\NormalTok{(}\StringTok{\textquotesingle{}}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{.Rmd$\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{, }\KeywordTok{basename}\NormalTok{(spt\_file)), }\StringTok{\textquotesingle{}\_mod.Rmd\textquotesingle{}}\NormalTok{)}
  \KeywordTok{print}\NormalTok{(spt\_new)}
  \KeywordTok{print}\NormalTok{(spn\_new)}

\NormalTok{  fileConn\_rd \textless{}{-}}\StringTok{ }\KeywordTok{file}\NormalTok{(spt\_file, }\StringTok{"r"}\NormalTok{)}
\NormalTok{  st\_file\_read \textless{}{-}}\StringTok{ }\KeywordTok{readLines}\NormalTok{(fileConn\_rd)}

\NormalTok{  fileConn\_sr \textless{}{-}}\StringTok{ }\KeywordTok{file}\NormalTok{(spn\_new)}
  \KeywordTok{writeLines}\NormalTok{(st\_file\_read, fileConn\_sr)}

  \KeywordTok{close}\NormalTok{(fileConn\_rd)}
  \KeywordTok{close}\NormalTok{(fileConn\_sr)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "_file/rmd/"
## [1] "_file/rmd/fs_rmd_pdf_html_mod.Rmd"
## [1] "_file/rmd/"
## [1] "_file/rmd/fs_text_save_mod.Rmd"
## [1] "_file/rmd/"
## [1] "_file/rmd/main_mod.Rmd"
\end{verbatim}

\hypertarget{replacment-function-change-markdown-hierarchy-and-add-to-yaml}{%
\paragraph{Replacment Function Change Markdown Hierarchy and Add to YAML}\label{replacment-function-change-markdown-hierarchy-and-add-to-yaml}}

Given an existing Rmd File, Resave it with a different name, and replace (add in) additional yaml contents.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{spn\_file =}\StringTok{ \textquotesingle{}\_file/rmd/fs\_rmd\_pdf\_html\_mod.Rmd\textquotesingle{}}
\NormalTok{fileConn\_sr \textless{}{-}}\StringTok{ }\KeywordTok{file}\NormalTok{(spn\_file)}
\NormalTok{st\_file \textless{}{-}}\StringTok{ }\KeywordTok{readLines}\NormalTok{(fileConn\_sr)}
\CommentTok{\# print(st\_file)}

\NormalTok{st\_search \textless{}{-}}\StringTok{ "html\_document:}
\StringTok{    toc: true}
\StringTok{    number\_sections: true}
\StringTok{    toc\_float:}
\StringTok{      collapsed: false}
\StringTok{      smooth\_scroll: false}
\StringTok{      toc\_depth: 3"}
\NormalTok{st\_replace \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{"html\_document:}
\StringTok{    toc: true}
\StringTok{    number\_sections: true}
\StringTok{    toc\_float:}
\StringTok{      collapsed: false}
\StringTok{      smooth\_scroll: false}
\StringTok{      toc\_depth: 3}\CharTok{\textbackslash{}n}\StringTok{"}\NormalTok{,}
                     \StringTok{"    toc: true}\CharTok{\textbackslash{}n}\StringTok{"}\NormalTok{,}
                     \StringTok{"    number\_sections: true}\CharTok{\textbackslash{}n}\StringTok{"}\NormalTok{,}
                     \StringTok{"    toc\_float:}\CharTok{\textbackslash{}n}\StringTok{"}\NormalTok{,}
                     \StringTok{"      collapsed: false}\CharTok{\textbackslash{}n}\StringTok{"}\NormalTok{,}
                     \StringTok{"      smooth\_scroll: false}\CharTok{\textbackslash{}n}\StringTok{"}\NormalTok{,}
                     \StringTok{"      toc\_depth: 3"}\NormalTok{)}
\NormalTok{st\_file\_updated \textless{}{-}}\StringTok{ }\KeywordTok{gsub}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ st\_file,}
                        \DataTypeTok{pattern =}\NormalTok{ st\_search,}
                        \DataTypeTok{replacement =}\NormalTok{ st\_replace)}

\NormalTok{st\_search \textless{}{-}}\StringTok{ "../../"}
\NormalTok{st\_replace \textless{}{-}}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{"../../../../"}\NormalTok{)}
\NormalTok{st\_file\_updated \textless{}{-}}\StringTok{ }\KeywordTok{gsub}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ st\_file\_updated,}
                        \DataTypeTok{pattern =}\NormalTok{ st\_search,}
                        \DataTypeTok{replacement =}\NormalTok{ st\_replace)}

\NormalTok{st\_file\_updated \textless{}{-}}\StringTok{ }\KeywordTok{gsub}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ st\_file\_updated, }\DataTypeTok{pattern =} \StringTok{\textquotesingle{}\# \textquotesingle{}}\NormalTok{, }\DataTypeTok{replacement =} \StringTok{\textquotesingle{}\# \textquotesingle{}}\NormalTok{)}
\NormalTok{st\_file\_updated \textless{}{-}}\StringTok{ }\KeywordTok{gsub}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ st\_file\_updated, }\DataTypeTok{pattern =} \StringTok{\textquotesingle{}\#\# \textquotesingle{}}\NormalTok{, }\DataTypeTok{replacement =} \StringTok{\textquotesingle{}\#\# \textquotesingle{}}\NormalTok{)}
\NormalTok{st\_file\_updated \textless{}{-}}\StringTok{ }\KeywordTok{gsub}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ st\_file\_updated, }\DataTypeTok{pattern =} \StringTok{\textquotesingle{}\#\#\# \textquotesingle{}}\NormalTok{, }\DataTypeTok{replacement =} \StringTok{\textquotesingle{}\# \textquotesingle{}}\NormalTok{)}

\NormalTok{spn\_file =}\StringTok{ \textquotesingle{}\_file/rmd/fs\_rmd\_pdf\_html\_mod.Rmd\textquotesingle{}}
\NormalTok{fileConn\_sr \textless{}{-}}\StringTok{ }\KeywordTok{file}\NormalTok{(spn\_file)}
\NormalTok{st\_file \textless{}{-}}\StringTok{ }\KeywordTok{writeLines}\NormalTok{(st\_file\_updated, fileConn\_sr)}
\end{Highlighting}
\end{Shaded}

\hypertarget{appendix-appendix}{%
\appendix}


\hypertarget{index-and-code-links}{%
\chapter{Index and Code Links}\label{index-and-code-links}}

\hypertarget{array-matrix-dataframe-links}{%
\section{Array, Matrix, Dataframe links}\label{array-matrix-dataframe-links}}

\hypertarget{section-1.1-listlist-links}{%
\subsection{\texorpdfstring{\protect\hyperlink{list}{Section 1.1 List} links}{Section 1.1 List links}}\label{section-1.1-listlist-links}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \href{https://fanwangecon.github.io/R4Econ/amto/list/htmlpdfr/fs_lst_basics.html}{Multi-dimensional Named Lists}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/list//fs_lst_basics.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/list/htmlpdfr/fs_lst_basics.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/list/htmlpdfr/fs_lst_basics.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/amto/list/htmlpdfr/fs_lst_basics.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    Initiate Empty List. Named one and two dimensional lists.
  \item
    Collapse named and unamed list to string and print input code.
  \item
    \textbf{r}: \emph{deparse(substitute()) + vector(mode = ``list'', length = it\_N) + names(list) \textless- paste0(`e',seq()) + dimnames(ls2d){[}{[}1{]}{]} \textless- paste0(`r',seq()) + dimnames(ls2d){[}{[}2{]}{]} \textless- paste0(`c',seq())}
  \item
    \textbf{tidyr}: \emph{unnest()}
  \end{itemize}
\end{enumerate}

\hypertarget{section-1.2-arrayarray-links}{%
\subsection{\texorpdfstring{\protect\hyperlink{array}{Section 1.2 Array} links}{Section 1.2 Array links}}\label{section-1.2-arrayarray-links}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \href{https://fanwangecon.github.io/R4Econ/amto/array/htmlpdfr/fs_ary_basics.html}{Arrays Operations in R}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/array//fs_ary_basics.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/array/htmlpdfr/fs_ary_basics.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/array/htmlpdfr/fs_ary_basics.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/amto/array/htmlpdfr/fs_ary_basics.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    Basic array operations in R, rep, head, tail, na, etc.
  \item
    \textbf{r}: \emph{rep() + head() + tail() + na\_if()}
  \end{itemize}
\item
  \href{https://fanwangecon.github.io/R4Econ/amto/array/htmlpdfr/fs_ary_generate.html}{Generate Special Arrays}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/array//fs_ary_generate.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/array/htmlpdfr/fs_ary_generate.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/array/htmlpdfr/fs_ary_generate.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/amto/array/htmlpdfr/fs_ary_generate.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    Generate special arrays: log spaced array
  \item
    \textbf{r}: \emph{seq()}
  \end{itemize}
\item
  \href{https://fanwangecon.github.io/R4Econ/amto/array/htmlpdfr/fs_ary_string.html}{String Operations}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/array//fs_ary_string.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/array/htmlpdfr/fs_ary_string.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/array/htmlpdfr/fs_ary_string.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/amto/array/htmlpdfr/fs_ary_string.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    Split, concatenate, subset strings
  \item
    \textbf{r}: \emph{paste0() + sub() + gsub() + grepl() + sprintf() + tail() + strsplit() + basename() + dirname()}
  \end{itemize}
\item
  \href{https://fanwangecon.github.io/R4Econ/amto/array/htmlpdfr/fs_ary_mesh.html}{Meshgrid Matrices, Arrays and Scalars}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/array//fs_ary_mesh.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/array/htmlpdfr/fs_ary_mesh.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/array/htmlpdfr/fs_ary_mesh.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/amto/array/htmlpdfr/fs_ary_mesh.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    Meshgrid Matrices, Arrays and Scalars to form all combination dataframe.
  \item
    \textbf{tidyr}: \emph{expand\_grid() + expand.grid()}
  \end{itemize}
\end{enumerate}

\hypertarget{section-1.3-matrixmatrix-links}{%
\subsection{\texorpdfstring{\protect\hyperlink{matrix}{Section 1.3 Matrix} links}{Section 1.3 Matrix links}}\label{section-1.3-matrixmatrix-links}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \href{https://fanwangecon.github.io/R4Econ/amto/matrix/htmlpdfr/fs_mat_generate.html}{Matrix Basics}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/matrix//fs_mat_generate.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/matrix/htmlpdfr/fs_mat_generate.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/matrix/htmlpdfr/fs_mat_generate.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/amto/matrix/htmlpdfr/fs_mat_generate.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    Generate and combine NA, fixed and random matrixes. Name columns and rows.
  \item
    \textbf{R}: \emph{rbind() + matrix(NA) + matrix(NA\_real\_) + matrix(NA\_integer\_) + colnames() + rownames()}
  \end{itemize}
\item
  \href{https://fanwangecon.github.io/R4Econ/amto/matrix/htmlpdfr/fs_mat_linear_algebra.html}{Linear Algebra Operations}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/matrix//fs_mat_linear_algebra.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/matrix/htmlpdfr/fs_mat_linear_algebra.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/matrix/htmlpdfr/fs_mat_linear_algebra.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/amto/matrix/htmlpdfr/fs_mat_linear_algebra.html}{\textbf{html}}
\end{enumerate}

\hypertarget{section-1.4-variables-in-dataframesvariables-in-dataframes-links}{%
\subsection{\texorpdfstring{\protect\hyperlink{variables-in-dataframes}{Section 1.4 Variables in Dataframes} links}{Section 1.4 Variables in Dataframes links}}\label{section-1.4-variables-in-dataframesvariables-in-dataframes-links}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \href{https://fanwangecon.github.io/R4Econ/amto/tibble/htmlpdfr/fs_tib_basics.html}{Tibble Basics}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/tibble//fs_tib_basics.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/tibble/htmlpdfr/fs_tib_basics.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/tibble/htmlpdfr/fs_tib_basics.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/amto/tibble/htmlpdfr/fs_tib_basics.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    generate tibbles, rename tibble variables, tibble row and column names
  \item
    rename numeric sequential columns with string prefix and suffix
  \item
    \textbf{dplyr}: \emph{as\_tibble(mt) + rename\_all(\textasciitilde c(ar\_names)) + rename\_at(vars(starts\_with(``xx'')), funs(str\_replace(., ``yy'', ``yyyy'')) + rename\_at(vars(num\_range('\,',ar\_it)), funs(paste0(st,.))) + rowid\_to\_column() + colnames + rownames}
  \end{itemize}
\item
  \href{https://fanwangecon.github.io/R4Econ/amto/tibble/htmlpdfr/fs_tib_factors.html}{Label and Combine Factor Variables}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/tibble//fs_tib_factors.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/tibble/htmlpdfr/fs_tib_factors.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/tibble/htmlpdfr/fs_tib_factors.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/amto/tibble/htmlpdfr/fs_tib_factors.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    Convert numeric variables to factor variables, generate joint factors, and label factors.
  \item
    Graph MPG and 1/4 Miles Time (qsec) from the mtcars dataset over joint shift-type (am) and engine-type (vs) categories.
  \item
    \textbf{forcats}: \emph{as\_factor() + fct\_recode() + fct\_cross()}
  \end{itemize}
\item
  \href{https://fanwangecon.github.io/R4Econ/amto/tibble/htmlpdfr/fs_tib_random_draws.html}{Randomly Draw Subsets of Rows from Matrix}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/tibble//fs_tib_random_draws.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/tibble/htmlpdfr/fs_tib_random_draws.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/tibble/htmlpdfr/fs_tib_random_draws.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/amto/tibble/htmlpdfr/fs_tib_random_draws.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    Given matrix, randomly sample rows, or select if random value is below threshold.
  \item
    \textbf{r}: \emph{rnorm() + sample() + df{[}sample(dim(df){[}1{]}, it\_M, replace=FALSE),{]}}
  \item
    \textbf{dplyr}: \emph{case\_when() + mutate(var = case\_when(rnorm(n(),mean=0,sd=1) \textless{} 0 \textasciitilde{} 1, TRUE \textasciitilde{} 0)) \%\textgreater\% filter(var == 1)}
  \end{itemize}
\item
  \href{https://fanwangecon.github.io/R4Econ/amto/tibble/htmlpdfr/fs_tib_na.html}{Generate Variables Conditional on Other Variables}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/tibble//fs_tib_na.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/tibble/htmlpdfr/fs_tib_na.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/tibble/htmlpdfr/fs_tib_na.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/amto/tibble/htmlpdfr/fs_tib_na.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    Use case\_when to generate elseif conditional variables: NA, approximate difference, etc.
  \item
    \textbf{dplyr}: \emph{case\_when() + na\_if() + mutate(var = na\_if(case\_when(rnorm(n())\textless{} 0 \textasciitilde{} -99, TRUE \textasciitilde{} mpg), -99))}
  \item
    \textbf{r}: \emph{e-notation + all.equal() + isTRUE(all.equal(a,b,tol)) + is.na() + NA\_real\_ + NA\_character\_ + NA\_integer\_}
  \end{itemize}
\item
  \href{https://fanwangecon.github.io/R4Econ/amto/tibble/htmlpdfr/fs_tib_string.html}{R Tibble Dataframe String Manipulations}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/tibble//fs_tib_string.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/tibble/htmlpdfr/fs_tib_string.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/amto/tibble/htmlpdfr/fs_tib_string.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/amto/tibble/htmlpdfr/fs_tib_string.html}{\textbf{html}}
\end{enumerate}

\hypertarget{summarize-data-links}{%
\section{Summarize Data links}\label{summarize-data-links}}

\hypertarget{section-2.1-counting-observationcounting-observation-links}{%
\subsection{\texorpdfstring{\protect\hyperlink{counting-observation}{Section 2.1 Counting Observation} links}{Section 2.1 Counting Observation links}}\label{section-2.1-counting-observationcounting-observation-links}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \href{https://fanwangecon.github.io/R4Econ/summarize/count/htmlpdfr/fs_count_basics.html}{Counting Basics}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/summarize/count//fs_count_basics.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/summarize/count/htmlpdfr/fs_count_basics.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/summarize/count/htmlpdfr/fs_count_basics.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/summarize/count/htmlpdfr/fs_count_basics.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    uncount to generate panel skeleton from years in survey
  \item
    \textbf{dplyr}: \emph{uncount(yr\_n) + group\_by() + mutate(yr = row\_number() + start\_yr)}
  \end{itemize}
\end{enumerate}

\hypertarget{section-2.2-sorting-indexing-slicingsorting-indexing-slicing-links}{%
\subsection{\texorpdfstring{\protect\hyperlink{sorting-indexing-slicing}{Section 2.2 Sorting, Indexing, Slicing} links}{Section 2.2 Sorting, Indexing, Slicing links}}\label{section-2.2-sorting-indexing-slicingsorting-indexing-slicing-links}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \href{https://fanwangecon.github.io/R4Econ/summarize/index/htmlpdfr/fs_index_populate.html}{Sorted Index, Interval Index and Expand Value from One Row}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/summarize/index//fs_index_populate.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/summarize/index/htmlpdfr/fs_index_populate.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/summarize/index/htmlpdfr/fs_index_populate.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/summarize/index/htmlpdfr/fs_index_populate.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    Sort and generate index for rows
  \item
    Generate negative and positive index based on deviations
  \item
    Populate Values from one row to other rows
  \item
    \textbf{dplyr}: \emph{arrange() + row\_number() + mutate(lowest = min(Sepal.Length)) + case\_when(row\_number()==x \textasciitilde{} Septal.Length) + mutate(Sepal.New = Sepal.Length{[}Sepal.Index == 1{]})}
  \end{itemize}
\end{enumerate}

\hypertarget{section-2.3-group-statisticsgroup-statistics-links}{%
\subsection{\texorpdfstring{\protect\hyperlink{group-statistics}{Section 2.3 Group Statistics} links}{Section 2.3 Group Statistics links}}\label{section-2.3-group-statisticsgroup-statistics-links}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \href{https://fanwangecon.github.io/R4Econ/summarize/aggregate/htmlpdfr/fs_group_unique_agg.html}{Count Unique Groups and Mean within Groups}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/summarize/aggregate//fs_group_unique_agg.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/summarize/aggregate/htmlpdfr/fs_group_unique_agg.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/summarize/aggregate/htmlpdfr/fs_group_unique_agg.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/summarize/aggregate/htmlpdfr/fs_group_unique_agg.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    Unique groups defined by multiple values and count obs within group.
  \item
    Mean, sd, observation count for non-NA within unique groups.
  \item
    \textbf{dplyr}: \emph{group\_by() + summarise(n()) + summarise\_if(is.numeric, funs(mean = mean(., na.rm = TRUE), n = sum(is.na(.)==0)))}
  \end{itemize}
\item
  \href{https://fanwangecon.github.io/R4Econ/summarize/aggregate/htmlpdfr/fs_group_summ_one.html}{By Groups, One Variable All Statistics}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/summarize/aggregate//fs_group_summ_one.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/summarize/aggregate/htmlpdfr/fs_group_summ_one.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/summarize/aggregate/htmlpdfr/fs_group_summ_one.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/summarize/aggregate/htmlpdfr/fs_group_summ_one.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    Pick stats, overall, and by multiple groups, stats as matrix or wide row with name=(ctsvar + catevar + catelabel).
  \item
    \textbf{tidyr}: \emph{group\_by() + summarize\_at(, funs()) + rename(!!var := !!sym(var)) + mutate(!!var := paste0(var,`str',!!!syms(vars))) + gather() + unite() + spread(varcates, value)}
  \end{itemize}
\item
  \href{https://fanwangecon.github.io/R4Econ/summarize/aggregate/htmlpdfr/fs_group_summ_wide.html}{By within Individual Groups Variables, Averages}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/summarize/aggregate//fs_group_summ_wide.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/summarize/aggregate/htmlpdfr/fs_group_summ_wide.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/summarize/aggregate/htmlpdfr/fs_group_summ_wide.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/summarize/aggregate/htmlpdfr/fs_group_summ_wide.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    By Multiple within Individual Groups Variables.
  \item
    Averages for all numeric variables within all groups of all group variables. Long to Wide to very Wide.
  \item
    \textbf{tidyr}: *gather() + group\_by() + summarise\_if(is.numeric, funs(mean(., na.rm = TRUE))) + mutate(all\_m\_cate = paste0(variable, '\_c', value)) + unite() + spread()*
  \end{itemize}
\end{enumerate}

\hypertarget{section-2.4-distributional-statisticsdistributional-statistics-links}{%
\subsection{\texorpdfstring{\protect\hyperlink{distributional-statistics}{Section 2.4 Distributional Statistics} links}{Section 2.4 Distributional Statistics links}}\label{section-2.4-distributional-statisticsdistributional-statistics-links}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \href{https://fanwangecon.github.io/R4Econ/summarize/dist/htmlpdfr/fst_hist_onevar.html}{Tibble Basics}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/summarize/dist//fst_hist_onevar.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/summarize/dist/htmlpdfr/fst_hist_onevar.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/summarize/dist/htmlpdfr/fst_hist_onevar.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/summarize/dist/htmlpdfr/fst_hist_onevar.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    input multiple variables with comma separated text strings
  \item
    quantitative/continuous and categorical/discrete variables
  \item
    histogram and summary statistics
  \item
    \textbf{tibble}: \emph{ar\_one \textless- c(107.72,101.28) + ar\_two \textless- c(101.72,101.28) + mt\_data \textless- cbind(ar\_one, ar\_two) + as\_tibble(mt\_data)}
  \end{itemize}
\end{enumerate}

\hypertarget{section-2.5-summarize-multiple-variablessummarize-multiple-variables-links}{%
\subsection{\texorpdfstring{\protect\hyperlink{summarize-multiple-variables}{Section 2.5 Summarize Multiple Variables} links}{Section 2.5 Summarize Multiple Variables links}}\label{section-2.5-summarize-multiple-variablessummarize-multiple-variables-links}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \href{https://fanwangecon.github.io/R4Econ/summarize/multivar/htmlpdfr/fs_func_multivar.html}{Apply the Same Function over Columns of Matrix}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/summarize/multivar//fs_func_multivar.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/summarize/multivar/htmlpdfr/fs_func_multivar.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/summarize/multivar/htmlpdfr/fs_func_multivar.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/summarize/multivar/htmlpdfr/fs_func_multivar.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    Replace NA values in selected columns by alternative values.
  \item
    Cumulative sum over multiple variables.
  \item
    Rename various various with common prefix and suffix appended.
  \item
    \textbf{r}: \emph{cumsum() + gsub() + mutate\_at(vars(contains(`V')), .funs = list(cumu = \textasciitilde cumsum(.))) + rename\_at(vars(contains(``V'') ), list(\textasciitilde gsub(``M'', "", .)))}
  \item
    \textbf{dplyr}: \emph{rename\_at() + mutate\_at() + rename\_at(vars(starts\_with(``V'')), funs(str\_replace(., ``V'', ``var''))) + mutate\_at(vars(one\_of(c(`var1', `var2'))), list(\textasciitilde replace\_na(., 99)))}
  \end{itemize}
\end{enumerate}

\hypertarget{functions-links}{%
\section{Functions links}\label{functions-links}}

\hypertarget{section-3.1-dataframe-mutatedataframe-mutate-links}{%
\subsection{\texorpdfstring{\protect\hyperlink{dataframe-mutate}{Section 3.1 Dataframe Mutate} links}{Section 3.1 Dataframe Mutate links}}\label{section-3.1-dataframe-mutatedataframe-mutate-links}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \href{https://fanwangecon.github.io/R4Econ/function/mutatef/htmlpdfr/fs_funceval.html}{Nonlinear Function over Rows}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/function/mutatef//fs_funceval.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/function/mutatef/htmlpdfr/fs_funceval.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/function/mutatef/htmlpdfr/fs_funceval.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/function/mutatef/htmlpdfr/fs_funceval.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    Evaluate nonlinear function f(x\_i, y\_i, ar\_x, ar\_y, c, d), where c and d are constants, and ar\_x and ar\_y are arrays, both fixed. x\_i and y\_i vary over each row of matrix.
  \item
    \textbf{dplyr}: \emph{rowwise() + mutate(out = funct(inputs))}
  \end{itemize}
\item
  \href{https://fanwangecon.github.io/R4Econ/function/mutatef/htmlpdfr/fs_func_choice_states.html}{Evaluate Functions over Rows of Meshes Matrices}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/function/mutatef//fs_func_choice_states.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/function/mutatef/htmlpdfr/fs_func_choice_states.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/function/mutatef/htmlpdfr/fs_func_choice_states.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/function/mutatef/htmlpdfr/fs_func_choice_states.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    Mesh states and choices together and rowwise evaluate many matrixes.
  \item
    Cumulative sum over multiple variables.
  \item
    Rename various various with common prefix and suffix appended.
  \item
    \textbf{r}: \emph{ffi \textless- function(fl\_A, ar\_B)}
  \item
    \textbf{tidyr}: \emph{expand\_grid() + rowwise() + df \%\textgreater\% rowwise() \%\textgreater\% mutate(var = ffi(fl\_A, ar\_B))}
  \item
    \textbf{ggplot2}: \emph{geom\_line() + facet\_wrap() + geom\_hline() + facet\_wrap(. \textasciitilde{} var\_id, scales = `free') + geom\_hline(yintercept=0, linetype=``dashed'', color=``red'', size=1) +}
  \end{itemize}
\end{enumerate}

\hypertarget{section-3.2-dataframe-do-anythingdataframe-do-anything-links}{%
\subsection{\texorpdfstring{\protect\hyperlink{dataframe-do-anything}{Section 3.2 Dataframe Do Anything} links}{Section 3.2 Dataframe Do Anything links}}\label{section-3.2-dataframe-do-anythingdataframe-do-anything-links}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \href{https://fanwangecon.github.io/R4Econ/function/dof/htmlpdfr/fs_funceval_group.html}{Evaluate Function Do Anything Group Stack Results}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/function/dof//fs_funceval_group.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/function/dof/htmlpdfr/fs_funceval_group.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/function/dof/htmlpdfr/fs_funceval_group.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/function/dof/htmlpdfr/fs_funceval_group.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    Group dataframe by categories, compute category specific output scalar or arrays based on within category variable information.
  \item
    \textbf{dplyr}: \emph{group\_by(ID) + do(inc = rnorm(.\(N, mean=.\)mn, sd=.\$sd)) + unnest(c(inc)) + left\_join(df, by=``ID'')}
  \end{itemize}
\item
  \href{https://fanwangecon.github.io/R4Econ/function/dof/htmlpdfr/fs_funceval_expand.html}{Expand Each Dataframe Row into More Rows}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/function/dof//fs_funceval_expand.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/function/dof/htmlpdfr/fs_funceval_expand.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/function/dof/htmlpdfr/fs_funceval_expand.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/function/dof/htmlpdfr/fs_funceval_expand.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    Generate row value specific arrays of varying Length, and stack expanded dataframe.
  \item
    \textbf{dplyr}: \emph{do() + unnest() + left\_join() + df \%\textgreater\% group\_by(ID) \%\textgreater\% do(inc = rnorm(.\(Q, mean=.\)mean, sd=.\$sd)) \%\textgreater\% unnest(c(inc))}
  \end{itemize}
\end{enumerate}

\hypertarget{section-3.3-apply-and-pmapapply-and-pmap-links}{%
\subsection{\texorpdfstring{\protect\hyperlink{apply-and-pmap}{Section 3.3 Apply and pmap} links}{Section 3.3 Apply and pmap links}}\label{section-3.3-apply-and-pmapapply-and-pmap-links}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \href{https://fanwangecon.github.io/R4Econ/function/noloop/htmlpdfr/fs_applysapplymutate.html}{Apply and Mutate over Rows}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/function/noloop//fs_applysapplymutate.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/function/noloop/htmlpdfr/fs_applysapplymutate.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/function/noloop/htmlpdfr/fs_applysapplymutate.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/function/noloop/htmlpdfr/fs_applysapplymutate.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    Evaluate function f(x\_i,y\_i,c), where c is a constant and x and y vary over each row of a matrix, with index i indicating rows.
  \item
    Get same results using apply, sapply, and dplyr mutate.
  \item
    \textbf{r}: \emph{do.call() + apply(mt, 1, func) + sapply(ls\_ar, func, ar1, ar2)}
  \item
    \textbf{purrr}: \emph{rowwise() + unnest(out) + pmap(func) + unlist()}
  \end{itemize}
\end{enumerate}

\hypertarget{panel-links}{%
\section{Panel links}\label{panel-links}}

\hypertarget{section-4.1-generate-and-joingenerate-and-join-links}{%
\subsection{\texorpdfstring{\protect\hyperlink{generate-and-join}{Section 4.1 Generate and Join} links}{Section 4.1 Generate and Join links}}\label{section-4.1-generate-and-joingenerate-and-join-links}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \href{https://fanwangecon.github.io/R4Econ/panel/basic/htmlpdfr/fs_genpanel.html}{TIDYVERSE Generate Panel Data Structures}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/panel/basic//fs_genpanel.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/panel/basic/htmlpdfr/fs_genpanel.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/panel/basic/htmlpdfr/fs_genpanel.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/panel/basic/htmlpdfr/fs_genpanel.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    Build skeleton panel frame with N observations and T periods.
  \item
    \textbf{tidyr}: \emph{rowid\_to\_column() + uncount() + group\_by() + row\_number() + ungroup()}
  \end{itemize}
\item
  \href{https://fanwangecon.github.io/R4Econ/panel/basic/htmlpdfr/fs_joining.html}{R DPLYR Join Multiple Dataframes Together}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/panel/basic//fs_joining.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/panel/basic/htmlpdfr/fs_joining.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/panel/basic/htmlpdfr/fs_joining.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/panel/basic/htmlpdfr/fs_joining.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    Join dataframes together with one or multiple keys. Stack dataframes together.
  \item
    \textbf{dplyr}: \emph{filter() + rename(!!sym(vsta) := !!sym(vstb)) + mutate(var = rnom(n())) + left\_join(df, by=(c(`id'=`id', `vt'=`vt'))) + left\_join(df, by=setNames(c(`id', `vt'), c(`id', `vt'))) + bind\_rows()}
  \end{itemize}
\end{enumerate}

\hypertarget{section-4.2-wide-and-longwide-and-long-links}{%
\subsection{\texorpdfstring{\protect\hyperlink{wide-and-long}{Section 4.2 Wide and Long} links}{Section 4.2 Wide and Long links}}\label{section-4.2-wide-and-longwide-and-long-links}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \href{https://fanwangecon.github.io/R4Econ/panel/widelong/htmlpdfr/fs_pivotwider.html}{TIDYR Pivot Wider and Pivot Longer Examples}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/panel/widelong//fs_pivotwider.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/panel/widelong/htmlpdfr/fs_pivotwider.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/panel/widelong/htmlpdfr/fs_pivotwider.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/panel/widelong/htmlpdfr/fs_pivotwider.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    Long roster to wide roster and cumulative sum attendance by date.
  \item
    \textbf{dplyr}: \emph{mutate(var = case\_when(rnorm(n()) \textless{} 0 \textasciitilde{} 1, TRUE \textasciitilde{} 0)) + rename\_at(vars(num\_range('`, ar\_it)), list(\textasciitilde paste0(st\_prefix, . ,''))) + mutate\_at(vars(contains(str)), list(\textasciitilde replace\_na(., 0))) + mutate\_at(vars(contains(str)), list(\textasciitilde cumsum(.)))}
  \end{itemize}
\item
  \href{https://fanwangecon.github.io/R4Econ/panel/widelong/htmlpdfr/fs_pivotlonger.html}{R Wide Data to Long Data Example (TIDYR Pivot Longer)}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/panel/widelong//fs_pivotlonger.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/panel/widelong/htmlpdfr/fs_pivotlonger.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/panel/widelong/htmlpdfr/fs_pivotlonger.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/panel/widelong/htmlpdfr/fs_pivotlonger.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    A matrix of ev given states, rows are states and cols are shocks. Convert to Long table with shock and state values and ev.
  \item
    \textbf{dplyr}: \emph{left\_join() + pivot\_longer(cols = starts\_with(`zi'), names\_to = c(`zi'), names\_pattern = paste0(``zi(.)''), values\_to = ``ev'')}
  \end{itemize}
\end{enumerate}

\hypertarget{linear-regression-links}{%
\section{Linear Regression links}\label{linear-regression-links}}

\hypertarget{section-5.1-ols-and-ivols-and-iv-links}{%
\subsection{\texorpdfstring{\protect\hyperlink{ols-and-iv}{Section 5.1 OLS and IV} links}{Section 5.1 OLS and IV links}}\label{section-5.1-ols-and-ivols-and-iv-links}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \href{https://fanwangecon.github.io/R4Econ/linreg/ivreg/htmlpdfr/fs_lin_ivregrow.html}{IV/OLS Regression}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/linreg/ivreg//fs_lin_ivregrow.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/linreg/ivreg/htmlpdfr/fs_lin_ivregrow.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/linreg/ivreg/htmlpdfr/fs_lin_ivregrow.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/linreg/ivreg/htmlpdfr/fs_lin_ivregrow.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    R Instrumental Variables and Ordinary Least Square Regression store all Coefficients and Diagnostics as Dataframe Row.
  \item
    \textbf{aer}: \emph{library(aer) + ivreg(as.formula, diagnostics = TRUE) }
  \end{itemize}
\item
  \href{https://fanwangecon.github.io/R4Econ/linreg/ivreg/htmlpdfr/fs_lin_ivloop.html}{M Outcomes and N RHS Alternatives}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/linreg/ivreg//fs_lin_ivloop.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/linreg/ivreg/htmlpdfr/fs_lin_ivloop.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/linreg/ivreg/htmlpdfr/fs_lin_ivloop.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/linreg/ivreg/htmlpdfr/fs_lin_ivloop.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    There are M outcome variables and N alternative explanatory variables. Regress all M outcome variables on N endogenous/independent right hand side variables one by one, with controls and/or IVs, collect coefficients.
  \item
    \textbf{dplyr}: \emph{bind\_rows(lapply(listx, function(x)(bind\_rows(lapply(listy, regf.iv))) + starts\_with() + ends\_with() + reduce(full\_join)}
  \end{itemize}
\end{enumerate}

\hypertarget{section-5.2-decompositiondecomposition-links}{%
\subsection{\texorpdfstring{\protect\hyperlink{decomposition}{Section 5.2 Decomposition} links}{Section 5.2 Decomposition links}}\label{section-5.2-decompositiondecomposition-links}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \href{https://fanwangecon.github.io/R4Econ/linreg/decompose/htmlpdfr/fs_lin_decompose.html}{Regression Decomposition}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/linreg/decompose//fs_lin_decompose.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/linreg/decompose/htmlpdfr/fs_lin_decompose.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/linreg/decompose/htmlpdfr/fs_lin_decompose.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/linreg/decompose/htmlpdfr/fs_lin_decompose.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    Post multiple regressions, fraction of outcome variables' variances explained by multiple subsets of right hand side variables.
  \item
    \textbf{dplyr}: \emph{gather() + group\_by(var) + mutate\_at(vars, funs(mean = mean(.))) + rowSums(mat}mat) + mutate\_if(is.numeric, funs(frac = (./value\_var)))*
  \end{itemize}
\end{enumerate}

\hypertarget{nonlinear-regression-links}{%
\section{Nonlinear Regression links}\label{nonlinear-regression-links}}

\hypertarget{section-6.1-logit-regressionlogit-regression-links}{%
\subsection{\texorpdfstring{\protect\hyperlink{logit-regression}{Section 6.1 Logit Regression} links}{Section 6.1 Logit Regression links}}\label{section-6.1-logit-regressionlogit-regression-links}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \href{https://fanwangecon.github.io/R4Econ/regnonlin/logit/htmlpdfr/fs_logit_birhs.html}{Logit Regression}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/regnonlin/logit//fs_logit_birhs.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/regnonlin/logit/htmlpdfr/fs_logit_birhs.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/regnonlin/logit/htmlpdfr/fs_logit_birhs.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/regnonlin/logit/htmlpdfr/fs_logit_birhs.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    Logit regression testing and prediction.
  \item
    \textbf{stats}: \emph{glm(as.formula(), data, family=`binomial') + predict(rs, newdata, type = ``response'')}
  \end{itemize}
\end{enumerate}

\hypertarget{optimization-links}{%
\section{Optimization links}\label{optimization-links}}

\hypertarget{section-7.1-bisectionbisection-links}{%
\subsection{\texorpdfstring{\protect\hyperlink{bisection-1}{Section 7.1 Bisection} links}{Section 7.1 Bisection links}}\label{section-7.1-bisectionbisection-links}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \href{https://fanwangecon.github.io/R4Econ/optimization/root_bisect/htmlpdfr/fs_bisec_joint.html}{Concurrent Bisection over Dataframe Rows}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/optimization/root_bisect//fs_bisec_joint.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/optimization/root_bisect/htmlpdfr/fs_bisec_joint.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/optimization/root_bisect/htmlpdfr/fs_bisec_joint.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/optimization/root_bisect/htmlpdfr/fs_bisec_joint.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    Post multiple regressions, fraction of outcome variables' variances explained by multiple subsets of right hand side variables.
  \item
    \textbf{tidyr}: *pivot\_longer(cols = starts\_with(`abc'), names\_to = c(`a', `b'), names\_pattern = paste0(`prefix', "(.)\_(.)"), values\_to = val) + pivot\_wider(names\_from = !!sym(name), values\_from = val) + mutate(!!sym(abc) := case\_when(efg \textless{} 0 \textasciitilde{} !!sym(opq), TRUE \textasciitilde{} iso))*
  \item
    \textbf{gglot2}: \emph{geom\_line() + facet\_wrap() + geom\_hline()}
  \end{itemize}
\end{enumerate}

\hypertarget{mathmatics-and-statistics-links}{%
\section{Mathmatics and Statistics links}\label{mathmatics-and-statistics-links}}

\hypertarget{section-8.1-distributionsdistributions-links}{%
\subsection{\texorpdfstring{\protect\hyperlink{distributions}{Section 8.1 Distributions} links}{Section 8.1 Distributions links}}\label{section-8.1-distributionsdistributions-links}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \href{https://fanwangecon.github.io/R4Econ/math/integration/htmlpdfr/fs_integrate_normal.html}{Integrate Normal Shocks}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/math/integration//fs_integrate_normal.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/math/integration/htmlpdfr/fs_integrate_normal.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/math/integration/htmlpdfr/fs_integrate_normal.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/math/integration/htmlpdfr/fs_integrate_normal.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    Random Sampling (Monte Carlo) integrate shocks.
  \item
    Trapezoidal rule (symmetric rectangles) integrate normal shock.
  \end{itemize}
\end{enumerate}

\hypertarget{section-8.2-analytical-solutionsanalytical-solutions-links}{%
\subsection{\texorpdfstring{\protect\hyperlink{analytical-solutions}{Section 8.2 Analytical Solutions} links}{Section 8.2 Analytical Solutions links}}\label{section-8.2-analytical-solutionsanalytical-solutions-links}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \href{https://fanwangecon.github.io/R4Econ/math/solutions/htmlpdfr/fs_solu_x_lin.html}{linear solve x with f(x) = 0}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/math/solutions//fs_solu_x_lin.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/math/solutions/htmlpdfr/fs_solu_x_lin.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/math/solutions/htmlpdfr/fs_solu_x_lin.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/math/solutions/htmlpdfr/fs_solu_x_lin.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    Evaluate and solve statistically relevant problems with one equation and one unknown that permit analytical solutions.
  \end{itemize}
\end{enumerate}

\hypertarget{section-8.3-inequality-modelsinequality-models-links}{%
\subsection{\texorpdfstring{\protect\hyperlink{inequality-models}{Section 8.3 Inequality Models} links}{Section 8.3 Inequality Models links}}\label{section-8.3-inequality-modelsinequality-models-links}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \href{https://fanwangecon.github.io/R4Econ/math/func_ineq/htmlpdfr/fs_gini_disc.html}{Gini for Discrete Samples}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/math/func_ineq//fs_gini_disc.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/math/func_ineq/htmlpdfr/fs_gini_disc.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/math/func_ineq/htmlpdfr/fs_gini_disc.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/math/func_ineq/htmlpdfr/fs_gini_disc.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    Given sample of data points that are discrete, compute the approximate gini coefficient.
  \item
    \textbf{r}: \emph{sort() + cumsum() + sum()}
  \end{itemize}
\item
  \href{https://fanwangecon.github.io/R4Econ/math/func_ineq/htmlpdfr/fs_atkinson_ces.html}{CES abd Atkinson Utility}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/math/func_ineq//fs_atkinson_ces.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/math/func_ineq/htmlpdfr/fs_atkinson_ces.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/math/func_ineq/htmlpdfr/fs_atkinson_ces.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/math/func_ineq/htmlpdfr/fs_atkinson_ces.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    Analyze how changing individual outcomes shift utility given inequality preference parameters.
  \item
    Draw Cobb-Douglas, Utilitarian and Leontief indifference curve
  \item
    \textbf{r}: \emph{apply(mt, 1, funct(x)\{\}) + do.call(rbind, ls\_mt)}
  \item
    \textbf{tidyr}: \emph{expand\_grid()}
  \item
    \textbf{ggplot2}: \emph{geom\_line() + facet\_wrap()}
  \end{itemize}
\end{enumerate}

\hypertarget{tables-and-graphs-links}{%
\section{Tables and Graphs links}\label{tables-and-graphs-links}}

\hypertarget{section-9.1-r-base-plotsr-base-plots-links}{%
\subsection{\texorpdfstring{\protect\hyperlink{r-base-plots}{Section 9.1 R Base Plots} links}{Section 9.1 R Base Plots links}}\label{section-9.1-r-base-plotsr-base-plots-links}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \href{https://fanwangecon.github.io/R4Econ/tabgraph/baseplot/htmlpdfr/fs_base_curve.html}{R Base Plot Line with Curves and Scatter}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/tabgraph/baseplot//fs_base_curve.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/tabgraph/baseplot/htmlpdfr/fs_base_curve.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/tabgraph/baseplot/htmlpdfr/fs_base_curve.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/tabgraph/baseplot/htmlpdfr/fs_base_curve.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    Plot scatter points, line plot and functional curve graphs together.
  \item
    Set margins for legend to be outside of graph area, change line, point, label and legend sizes.
  \item
    Generate additional lines for plots successively, record successively, and plot all steps, or initial steps results.
  \item
    \textbf{r}: \emph{plot() + curve() + legend() + title() + axis() + par() + recordPlot()}
  \end{itemize}
\end{enumerate}

\hypertarget{section-9.2-write-and-read-plotswrite-and-read-plots-links}{%
\subsection{\texorpdfstring{\protect\hyperlink{write-and-read-plots}{Section 9.2 Write and Read Plots} links}{Section 9.2 Write and Read Plots links}}\label{section-9.2-write-and-read-plotswrite-and-read-plots-links}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \href{https://fanwangecon.github.io/R4Econ/tabgraph/inout/htmlpdfr/fs_img_io.html}{Base R Save Images At Different Sizes}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/tabgraph/inout//fs_img_io.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/tabgraph/inout/htmlpdfr/fs_img_io.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/tabgraph/inout/htmlpdfr/fs_img_io.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/tabgraph/inout/htmlpdfr/fs_img_io.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    Base R store image core, add legends/titles/labels/axis of different sizes to save figures of different sizes.
  \item
    \textbf{r}: \emph{png() + setEPS() + postscript() + dev.off()}
  \end{itemize}
\end{enumerate}

\hypertarget{programming-links}{%
\section{Programming links}\label{programming-links}}

\hypertarget{section-10.1-file-in-and-outfile-in-and-out-links}{%
\subsection{\texorpdfstring{\protect\hyperlink{file-in-and-out}{Section 10.1 File in and Out} links}{Section 10.1 File in and Out links}}\label{section-10.1-file-in-and-outfile-in-and-out-links}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \href{https://fanwangecon.github.io/R4Econ/development/inout/htmlpdfr/fs_text_save.html}{Save Text to File, Read Text from File, Replace Text in File}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/development/inout//fs_text_save.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/development/inout/htmlpdfr/fs_text_save.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/development/inout/htmlpdfr/fs_text_save.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/development/inout/htmlpdfr/fs_text_save.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    Save data to file, read text from file, replace text in file.
  \item
    \textbf{r}: \emph{kable() + file() + writeLines() + readLines() + close() + gsub()}
  \end{itemize}
\item
  \href{https://fanwangecon.github.io/R4Econ/development/inout/htmlpdfr/fs_rmd_pdf_html.html}{Convert R Markdown File to R, PDF and HTML}: \href{https://github.com/FanWangEcon/R4Econ/blob/master/development/inout//fs_rmd_pdf_html.Rmd}{\textbf{rmd}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/development/inout/htmlpdfr/fs_rmd_pdf_html.R}{\textbf{r}} \textbar{} \href{https://github.com/FanWangEcon/R4Econ/blob/master/development/inout/htmlpdfr/fs_rmd_pdf_html.pdf}{\textbf{pdf}} \textbar{} \href{https://fanwangecon.github.io/R4Econ/development/inout/htmlpdfr/fs_rmd_pdf_html.html}{\textbf{html}}

  \begin{itemize}
  \tightlist
  \item
    Find all files in a folder with a particula suffix, with exclusion.
  \item
    Convert R Markdow File to R, PDF and HTML.
  \item
    Modify markdown pounds hierarchy.
  \item
    \textbf{r}: \emph{file() + writeLines() + readLines() + close() + gsub()}
  \end{itemize}
\end{enumerate}

  \bibliography{book.bib,packages.bib}

\end{document}
