<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Multi-dimensional Data Structures | Data Structures, Estimation and Optimization with R</title>
  <meta name="description" content="<p>Run system executable and shell commands.
Activate conda environment with shell script.</p>" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Multi-dimensional Data Structures | Data Structures, Estimation and Optimization with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="<p>Run system executable and shell commands.
Activate conda environment with shell script.</p>" />
  <meta name="github-repo" content="fanwangecon/R4Econ" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Multi-dimensional Data Structures | Data Structures, Estimation and Optimization with R" />
  
  <meta name="twitter:description" content="<p>Run system executable and shell commands.
Activate conda environment with shell script.</p>" />
  

<meta name="author" content="Fan Wang" />


<meta name="date" content="2021-06-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="functions.html"/>
<link rel="next" href="linear-regression.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-92953468-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-92953468-5');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Structures and Estimation with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html"><i class="fa fa-check"></i><b>1</b> Array, Matrix, Dataframe</a>
<ul>
<li class="chapter" data-level="1.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#list"><i class="fa fa-check"></i><b>1.1</b> List</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#lists"><i class="fa fa-check"></i><b>1.1.1</b> Lists</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#array"><i class="fa fa-check"></i><b>1.2</b> Array</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#array-basics"><i class="fa fa-check"></i><b>1.2.1</b> Array Basics</a></li>
<li class="chapter" data-level="1.2.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-arrays"><i class="fa fa-check"></i><b>1.2.2</b> Generate Arrays</a></li>
<li class="chapter" data-level="1.2.3" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#string-arrays"><i class="fa fa-check"></i><b>1.2.3</b> String Arrays</a></li>
<li class="chapter" data-level="1.2.4" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#mesh-matrices-arrays-and-scalars"><i class="fa fa-check"></i><b>1.2.4</b> Mesh Matrices, Arrays and Scalars</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#matrix"><i class="fa fa-check"></i><b>1.3</b> Matrix</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-matrixes"><i class="fa fa-check"></i><b>1.3.1</b> Generate Matrixes</a></li>
<li class="chapter" data-level="1.3.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#linear-algebra"><i class="fa fa-check"></i><b>1.3.2</b> Linear Algebra</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#variables-in-dataframes"><i class="fa fa-check"></i><b>1.4</b> Variables in Dataframes</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-dataframe"><i class="fa fa-check"></i><b>1.4.1</b> Generate Dataframe</a></li>
<li class="chapter" data-level="1.4.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#factor-label-and-combine"><i class="fa fa-check"></i><b>1.4.2</b> Factor Label and Combine</a></li>
<li class="chapter" data-level="1.4.3" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#drawly-random-rows"><i class="fa fa-check"></i><b>1.4.3</b> Drawly Random Rows</a></li>
<li class="chapter" data-level="1.4.4" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-variables-conditional-on-others"><i class="fa fa-check"></i><b>1.4.4</b> Generate Variables Conditional On Others</a></li>
<li class="chapter" data-level="1.4.5" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#string-dataframes"><i class="fa fa-check"></i><b>1.4.5</b> String Dataframes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="summarize-data.html"><a href="summarize-data.html"><i class="fa fa-check"></i><b>2</b> Summarize Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="summarize-data.html"><a href="summarize-data.html#counting-observation"><i class="fa fa-check"></i><b>2.1</b> Counting Observation</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="summarize-data.html"><a href="summarize-data.html#uncount"><i class="fa fa-check"></i><b>2.1.1</b> Uncount</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="summarize-data.html"><a href="summarize-data.html#sorting-indexing-slicing"><i class="fa fa-check"></i><b>2.2</b> Sorting, Indexing, Slicing</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="summarize-data.html"><a href="summarize-data.html#sorting"><i class="fa fa-check"></i><b>2.2.1</b> Sorting</a></li>
<li class="chapter" data-level="2.2.2" data-path="summarize-data.html"><a href="summarize-data.html#group-sort-and-slice"><i class="fa fa-check"></i><b>2.2.2</b> Group, Sort and Slice</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="summarize-data.html"><a href="summarize-data.html#group-statistics"><i class="fa fa-check"></i><b>2.3</b> Group Statistics</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="summarize-data.html"><a href="summarize-data.html#cumulative-statistics-within-group"><i class="fa fa-check"></i><b>2.3.1</b> Cumulative Statistics within Group</a></li>
<li class="chapter" data-level="2.3.2" data-path="summarize-data.html"><a href="summarize-data.html#groups-statistics"><i class="fa fa-check"></i><b>2.3.2</b> Groups Statistics</a></li>
<li class="chapter" data-level="2.3.3" data-path="summarize-data.html"><a href="summarize-data.html#one-variable-group-summary"><i class="fa fa-check"></i><b>2.3.3</b> One Variable Group Summary</a></li>
<li class="chapter" data-level="2.3.4" data-path="summarize-data.html"><a href="summarize-data.html#nested-within-group-stats"><i class="fa fa-check"></i><b>2.3.4</b> Nested within Group Stats</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="summarize-data.html"><a href="summarize-data.html#distributional-statistics"><i class="fa fa-check"></i><b>2.4</b> Distributional Statistics</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="summarize-data.html"><a href="summarize-data.html#histogram"><i class="fa fa-check"></i><b>2.4.1</b> Histogram</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="summarize-data.html"><a href="summarize-data.html#summarize-multiple-variables"><i class="fa fa-check"></i><b>2.5</b> Summarize Multiple Variables</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="summarize-data.html"><a href="summarize-data.html#generate-replace-variables"><i class="fa fa-check"></i><b>2.5.1</b> Generate Replace Variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>3</b> Functions</a>
<ul>
<li class="chapter" data-level="3.1" data-path="functions.html"><a href="functions.html#dataframe-mutate"><i class="fa fa-check"></i><b>3.1</b> Dataframe Mutate</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="functions.html"><a href="functions.html#row-input-functions"><i class="fa fa-check"></i><b>3.1.1</b> Row Input Functions</a></li>
<li class="chapter" data-level="3.1.2" data-path="functions.html"><a href="functions.html#evaluate-choices-across-states"><i class="fa fa-check"></i><b>3.1.2</b> Evaluate Choices Across States</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="functions.html"><a href="functions.html#dataframe-do-anything"><i class="fa fa-check"></i><b>3.2</b> Dataframe Do Anything</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="functions.html"><a href="functions.html#mx1-by-n-to-mxq-by-n1"><i class="fa fa-check"></i><b>3.2.1</b> (Mx1 by N) to (MxQ by N+1)</a></li>
<li class="chapter" data-level="3.2.2" data-path="functions.html"><a href="functions.html#mxp-by-n-to-mx1-by-1"><i class="fa fa-check"></i><b>3.2.2</b> (MxP by N) to (Mx1 by 1)</a></li>
<li class="chapter" data-level="3.2.3" data-path="functions.html"><a href="functions.html#mxp-by-n-to-mxq-by-nz"><i class="fa fa-check"></i><b>3.2.3</b> (MxP by N) to (MxQ by N+Z)</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="functions.html"><a href="functions.html#apply-and-pmap"><i class="fa fa-check"></i><b>3.3</b> Apply and pmap</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="functions.html"><a href="functions.html#apply-and-sapply"><i class="fa fa-check"></i><b>3.3.1</b> Apply and Sapply</a></li>
<li class="chapter" data-level="3.3.2" data-path="functions.html"><a href="functions.html#mutate-evaluate-functions"><i class="fa fa-check"></i><b>3.3.2</b> Mutate Evaluate Functions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html"><i class="fa fa-check"></i><b>4</b> Multi-dimensional Data Structures</a>
<ul>
<li class="chapter" data-level="4.1" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#generate-gather-bind-and-join"><i class="fa fa-check"></i><b>4.1</b> Generate, Gather, Bind and Join</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#generate-panel-structure"><i class="fa fa-check"></i><b>4.1.1</b> Generate Panel Structure</a></li>
<li class="chapter" data-level="4.1.2" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#join-datasets"><i class="fa fa-check"></i><b>4.1.2</b> Join Datasets</a></li>
<li class="chapter" data-level="4.1.3" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#gather-files"><i class="fa fa-check"></i><b>4.1.3</b> Gather Files</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#wide-and-long"><i class="fa fa-check"></i><b>4.2</b> Wide and Long</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#long-to-wide"><i class="fa fa-check"></i><b>4.2.1</b> Long to Wide</a></li>
<li class="chapter" data-level="4.2.2" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#wide-to-long"><i class="fa fa-check"></i><b>4.2.2</b> Wide to Long</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#join-and-compare"><i class="fa fa-check"></i><b>4.3</b> Join and Compare</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#find-closest-neighbor-on-grid"><i class="fa fa-check"></i><b>4.3.1</b> Find Closest Neighbor on Grid</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i><b>5</b> Linear Regression</a>
<ul>
<li class="chapter" data-level="5.1" data-path="linear-regression.html"><a href="linear-regression.html#ols-and-iv"><i class="fa fa-check"></i><b>5.1</b> OLS and IV</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="linear-regression.html"><a href="linear-regression.html#ols-and-iv-regression"><i class="fa fa-check"></i><b>5.1.1</b> OLS and IV Regression</a></li>
<li class="chapter" data-level="5.1.2" data-path="linear-regression.html"><a href="linear-regression.html#iv-loop-over-rhs"><i class="fa fa-check"></i><b>5.1.2</b> IV Loop over RHS</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="linear-regression.html"><a href="linear-regression.html#decomposition"><i class="fa fa-check"></i><b>5.2</b> Decomposition</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="linear-regression.html"><a href="linear-regression.html#decompose-rhs"><i class="fa fa-check"></i><b>5.2.1</b> Decompose RHS</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html"><i class="fa fa-check"></i><b>6</b> Nonlinear and Other Regressions</a>
<ul>
<li class="chapter" data-level="6.1" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html#logit-regression"><i class="fa fa-check"></i><b>6.1</b> Logit Regression</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html#binary-logit"><i class="fa fa-check"></i><b>6.1.1</b> Binary Logit</a></li>
<li class="chapter" data-level="6.1.2" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html#logistic-choice-model-with-aggregate-shares"><i class="fa fa-check"></i><b>6.1.2</b> Logistic Choice Model with Aggregate Shares</a></li>
<li class="chapter" data-level="6.1.3" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html#prices-from-aggregate-shares-in-logistic-choice-model"><i class="fa fa-check"></i><b>6.1.3</b> Prices from Aggregate Shares in Logistic Choice Model</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html#quantile-regression"><i class="fa fa-check"></i><b>6.2</b> Quantile Regression</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html#quantile-regression-basics"><i class="fa fa-check"></i><b>6.2.1</b> Quantile Regression Basics</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="optimization.html"><a href="optimization.html"><i class="fa fa-check"></i><b>7</b> Optimization</a>
<ul>
<li class="chapter" data-level="7.1" data-path="optimization.html"><a href="optimization.html#bisection"><i class="fa fa-check"></i><b>7.1</b> Bisection</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="optimization.html"><a href="optimization.html#bisection-1"><i class="fa fa-check"></i><b>7.1.1</b> Bisection</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="mathematics.html"><a href="mathematics.html"><i class="fa fa-check"></i><b>8</b> Mathematics</a>
<ul>
<li class="chapter" data-level="8.1" data-path="mathematics.html"><a href="mathematics.html#production-function"><i class="fa fa-check"></i><b>8.1</b> Production Function</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="mathematics.html"><a href="mathematics.html#nested-ces-production-function"><i class="fa fa-check"></i><b>8.1.1</b> Nested CES Production Function</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="mathematics.html"><a href="mathematics.html#basics"><i class="fa fa-check"></i><b>8.2</b> Basics</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="mathematics.html"><a href="mathematics.html#log-with-different-bases-and-exponents"><i class="fa fa-check"></i><b>8.2.1</b> Log with Different Bases and Exponents</a></li>
<li class="chapter" data-level="8.2.2" data-path="mathematics.html"><a href="mathematics.html#rescale-a-parameter-with-fixed-min-and-max"><i class="fa fa-check"></i><b>8.2.2</b> Rescale a Parameter with Fixed Min and Max</a></li>
<li class="chapter" data-level="8.2.3" data-path="mathematics.html"><a href="mathematics.html#find-nearest"><i class="fa fa-check"></i><b>8.2.3</b> Find Nearest</a></li>
<li class="chapter" data-level="8.2.4" data-path="mathematics.html"><a href="mathematics.html#linear-scalar-fx0-solutions"><i class="fa fa-check"></i><b>8.2.4</b> Linear Scalar f(x)=0 Solutions</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="mathematics.html"><a href="mathematics.html#inequality-models"><i class="fa fa-check"></i><b>8.3</b> Inequality Models</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="mathematics.html"><a href="mathematics.html#gini-discrete-sample"><i class="fa fa-check"></i><b>8.3.1</b> GINI Discrete Sample</a></li>
<li class="chapter" data-level="8.3.2" data-path="mathematics.html"><a href="mathematics.html#gini-formula-for-discrete-random-varialbe"><i class="fa fa-check"></i><b>8.3.2</b> GINI Formula for Discrete Random Varialbe</a></li>
<li class="chapter" data-level="8.3.3" data-path="mathematics.html"><a href="mathematics.html#atkinson-inequality-index"><i class="fa fa-check"></i><b>8.3.3</b> Atkinson Inequality Index</a></li>
<li class="chapter" data-level="8.3.4" data-path="mathematics.html"><a href="mathematics.html#location-population-and-pollution"><i class="fa fa-check"></i><b>8.3.4</b> Location, Population, and Pollution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="statistics.html"><a href="statistics.html"><i class="fa fa-check"></i><b>9</b> Statistics</a>
<ul>
<li class="chapter" data-level="9.1" data-path="statistics.html"><a href="statistics.html#distributions"><i class="fa fa-check"></i><b>9.1</b> Distributions</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="statistics.html"><a href="statistics.html#integrate-over-normal-guassian-process-shock"><i class="fa fa-check"></i><b>9.1.1</b> Integrate Over Normal Guassian Process Shock</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="statistics.html"><a href="statistics.html#discrete-random-variable"><i class="fa fa-check"></i><b>9.2</b> Discrete Random Variable</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="statistics.html"><a href="statistics.html#discrete-approximation-of-continuous-random-variables"><i class="fa fa-check"></i><b>9.2.1</b> Discrete Approximation of Continuous Random Variables</a></li>
<li class="chapter" data-level="9.2.2" data-path="statistics.html"><a href="statistics.html#obtaining-joint-distribution-from-marginal-with-rectilinear-restrictions"><i class="fa fa-check"></i><b>9.2.2</b> Obtaining Joint Distribution from Marginal with Rectilinear Restrictions</a></li>
<li class="chapter" data-level="9.2.3" data-path="statistics.html"><a href="statistics.html#obtaining-joint-distribution-from-conditional-with-rectilinear-restrictions"><i class="fa fa-check"></i><b>9.2.3</b> Obtaining Joint Distribution from Conditional with Rectilinear Restrictions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html"><i class="fa fa-check"></i><b>10</b> Tables and Graphs</a>
<ul>
<li class="chapter" data-level="10.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#r-base-plots"><i class="fa fa-check"></i><b>10.1</b> R Base Plots</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#plot-curve-line-and-points"><i class="fa fa-check"></i><b>10.1.1</b> Plot Curve, Line and Points</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#ggplot-line-related-plots"><i class="fa fa-check"></i><b>10.2</b> ggplot Line Related Plots</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#ggplot-line-plot"><i class="fa fa-check"></i><b>10.2.1</b> ggplot Line Plot</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#ggplot-scatter-related-plots"><i class="fa fa-check"></i><b>10.3</b> ggplot Scatter Related Plots</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#ggplot-scatter-plot"><i class="fa fa-check"></i><b>10.3.1</b> ggplot Scatter Plot</a></li>
<li class="chapter" data-level="10.3.2" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#ggplot-multiple-scatter-lines-with-facet-wrap"><i class="fa fa-check"></i><b>10.3.2</b> ggplot Multiple Scatter-Lines with Facet Wrap</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#write-and-read-plots"><i class="fa fa-check"></i><b>10.4</b> Write and Read Plots</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#import-and-export-images"><i class="fa fa-check"></i><b>10.4.1</b> Import and Export Images</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="get-data.html"><a href="get-data.html"><i class="fa fa-check"></i><b>11</b> Get Data</a>
<ul>
<li class="chapter" data-level="11.1" data-path="get-data.html"><a href="get-data.html#environmental-data"><i class="fa fa-check"></i><b>11.1</b> Environmental Data</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="get-data.html"><a href="get-data.html#ecmwf-era5-data"><i class="fa fa-check"></i><b>11.1.1</b> ECMWF ERA5 Data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="code-and-development.html"><a href="code-and-development.html"><i class="fa fa-check"></i><b>12</b> Code and Development</a>
<ul>
<li class="chapter" data-level="12.1" data-path="code-and-development.html"><a href="code-and-development.html#files-in-and-out"><i class="fa fa-check"></i><b>12.1</b> Files In and Out</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="code-and-development.html"><a href="code-and-development.html#file-path"><i class="fa fa-check"></i><b>12.1.1</b> File Path</a></li>
<li class="chapter" data-level="12.1.2" data-path="code-and-development.html"><a href="code-and-development.html#text-to-file"><i class="fa fa-check"></i><b>12.1.2</b> Text to File</a></li>
<li class="chapter" data-level="12.1.3" data-path="code-and-development.html"><a href="code-and-development.html#rmd-to-html"><i class="fa fa-check"></i><b>12.1.3</b> Rmd to HTML</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="code-and-development.html"><a href="code-and-development.html#python-with-r"><i class="fa fa-check"></i><b>12.2</b> Python with R</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="code-and-development.html"><a href="code-and-development.html#reticulate-basics"><i class="fa fa-check"></i><b>12.2.1</b> Reticulate Basics</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="code-and-development.html"><a href="code-and-development.html#command-line"><i class="fa fa-check"></i><b>12.3</b> Command Line</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="code-and-development.html"><a href="code-and-development.html#shell-and-system-commands"><i class="fa fa-check"></i><b>12.3.1</b> Shell and System Commands</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="index-and-code-links.html"><a href="index-and-code-links.html"><i class="fa fa-check"></i><b>A</b> Index and Code Links</a>
<ul>
<li class="chapter" data-level="A.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#array-matrix-dataframe-links"><i class="fa fa-check"></i><b>A.1</b> Array, Matrix, Dataframe links</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.1-listlist-links"><i class="fa fa-check"></i><b>A.1.1</b> <span>Section 1.1 List</span> links</a></li>
<li class="chapter" data-level="A.1.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.2-arrayarray-links"><i class="fa fa-check"></i><b>A.1.2</b> <span>Section 1.2 Array</span> links</a></li>
<li class="chapter" data-level="A.1.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.3-matrixmatrix-links"><i class="fa fa-check"></i><b>A.1.3</b> <span>Section 1.3 Matrix</span> links</a></li>
<li class="chapter" data-level="A.1.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.4-variables-in-dataframesvariables-in-dataframes-links"><i class="fa fa-check"></i><b>A.1.4</b> <span>Section 1.4 Variables in Dataframes</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#summarize-data-links"><i class="fa fa-check"></i><b>A.2</b> Summarize Data links</a>
<ul>
<li class="chapter" data-level="A.2.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.1-counting-observationcounting-observation-links"><i class="fa fa-check"></i><b>A.2.1</b> <span>Section 2.1 Counting Observation</span> links</a></li>
<li class="chapter" data-level="A.2.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.2-sorting-indexing-slicingsorting-indexing-slicing-links"><i class="fa fa-check"></i><b>A.2.2</b> <span>Section 2.2 Sorting, Indexing, Slicing</span> links</a></li>
<li class="chapter" data-level="A.2.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.3-group-statisticsgroup-statistics-links"><i class="fa fa-check"></i><b>A.2.3</b> <span>Section 2.3 Group Statistics</span> links</a></li>
<li class="chapter" data-level="A.2.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.4-distributional-statisticsdistributional-statistics-links"><i class="fa fa-check"></i><b>A.2.4</b> <span>Section 2.4 Distributional Statistics</span> links</a></li>
<li class="chapter" data-level="A.2.5" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.5-summarize-multiple-variablessummarize-multiple-variables-links"><i class="fa fa-check"></i><b>A.2.5</b> <span>Section 2.5 Summarize Multiple Variables</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#functions-links"><i class="fa fa-check"></i><b>A.3</b> Functions links</a>
<ul>
<li class="chapter" data-level="A.3.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.1-dataframe-mutatedataframe-mutate-links"><i class="fa fa-check"></i><b>A.3.1</b> <span>Section 3.1 Dataframe Mutate</span> links</a></li>
<li class="chapter" data-level="A.3.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.2-dataframe-do-anythingdataframe-do-anything-links"><i class="fa fa-check"></i><b>A.3.2</b> <span>Section 3.2 Dataframe Do Anything</span> links</a></li>
<li class="chapter" data-level="A.3.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.3-apply-and-pmapapply-and-pmap-links"><i class="fa fa-check"></i><b>A.3.3</b> <span>Section 3.3 Apply and pmap</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#multi-dimensional-data-structures-links"><i class="fa fa-check"></i><b>A.4</b> Multi-dimensional Data Structures links</a>
<ul>
<li class="chapter" data-level="A.4.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-4.1-generate-gather-bind-and-joingenerate-gather-bind-and-join-links"><i class="fa fa-check"></i><b>A.4.1</b> <span>Section 4.1 Generate, Gather, Bind and Join</span> links</a></li>
<li class="chapter" data-level="A.4.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-4.2-wide-and-longwide-and-long-links"><i class="fa fa-check"></i><b>A.4.2</b> <span>Section 4.2 Wide and Long</span> links</a></li>
<li class="chapter" data-level="A.4.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-4.3-join-and-comparejoin-and-compare-links"><i class="fa fa-check"></i><b>A.4.3</b> <span>Section 4.3 Join and Compare</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.5" data-path="index-and-code-links.html"><a href="index-and-code-links.html#linear-regression-links"><i class="fa fa-check"></i><b>A.5</b> Linear Regression links</a>
<ul>
<li class="chapter" data-level="A.5.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-5.1-ols-and-ivols-and-iv-links"><i class="fa fa-check"></i><b>A.5.1</b> <span>Section 5.1 OLS and IV</span> links</a></li>
<li class="chapter" data-level="A.5.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-5.2-decompositiondecomposition-links"><i class="fa fa-check"></i><b>A.5.2</b> <span>Section 5.2 Decomposition</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.6" data-path="index-and-code-links.html"><a href="index-and-code-links.html#nonlinear-and-other-regressions-links"><i class="fa fa-check"></i><b>A.6</b> Nonlinear and Other Regressions links</a>
<ul>
<li class="chapter" data-level="A.6.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-6.1-logit-regressionlogit-regression-links"><i class="fa fa-check"></i><b>A.6.1</b> <span>Section 6.1 Logit Regression</span> links</a></li>
<li class="chapter" data-level="A.6.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-6.2-quantile-regressionquantile-regression-links"><i class="fa fa-check"></i><b>A.6.2</b> <span>Section 6.2 Quantile Regression</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.7" data-path="index-and-code-links.html"><a href="index-and-code-links.html#optimization-links"><i class="fa fa-check"></i><b>A.7</b> Optimization links</a>
<ul>
<li class="chapter" data-level="A.7.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-7.1-bisectionbisection-links"><i class="fa fa-check"></i><b>A.7.1</b> <span>Section 7.1 Bisection</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.8" data-path="index-and-code-links.html"><a href="index-and-code-links.html#mathematics-links"><i class="fa fa-check"></i><b>A.8</b> Mathematics links</a>
<ul>
<li class="chapter" data-level="A.8.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-8.1-production-functionproduction-function-links"><i class="fa fa-check"></i><b>A.8.1</b> <span>Section 8.1 Production Function</span> links</a></li>
<li class="chapter" data-level="A.8.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-8.2-basicsbasics-links"><i class="fa fa-check"></i><b>A.8.2</b> <span>Section 8.2 Basics</span> links</a></li>
<li class="chapter" data-level="A.8.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-8.3-inequality-modelsinequality-models-links"><i class="fa fa-check"></i><b>A.8.3</b> <span>Section 8.3 Inequality Models</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.9" data-path="index-and-code-links.html"><a href="index-and-code-links.html#statistics-links"><i class="fa fa-check"></i><b>A.9</b> Statistics links</a>
<ul>
<li class="chapter" data-level="A.9.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-9.1-distributionsdistributions-links"><i class="fa fa-check"></i><b>A.9.1</b> <span>Section 9.1 Distributions</span> links</a></li>
<li class="chapter" data-level="A.9.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-9.2-discrete-random-variablediscrete-random-variable-links"><i class="fa fa-check"></i><b>A.9.2</b> <span>Section 9.2 Discrete Random Variable</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.10" data-path="index-and-code-links.html"><a href="index-and-code-links.html#tables-and-graphs-links"><i class="fa fa-check"></i><b>A.10</b> Tables and Graphs links</a>
<ul>
<li class="chapter" data-level="A.10.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-10.1-r-base-plotsr-base-plots-links"><i class="fa fa-check"></i><b>A.10.1</b> <span>Section 10.1 R Base Plots</span> links</a></li>
<li class="chapter" data-level="A.10.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-10.2-ggplot-line-related-plotsggplot-line-related-plots-links"><i class="fa fa-check"></i><b>A.10.2</b> <span>Section 10.2 ggplot Line Related Plots</span> links</a></li>
<li class="chapter" data-level="A.10.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-10.3-ggplot-scatter-related-plotsggplot-scatter-related-plots-links"><i class="fa fa-check"></i><b>A.10.3</b> <span>Section 10.3 ggplot Scatter Related Plots</span> links</a></li>
<li class="chapter" data-level="A.10.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-10.4-write-and-read-plotswrite-and-read-plots-links"><i class="fa fa-check"></i><b>A.10.4</b> <span>Section 10.4 Write and Read Plots</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.11" data-path="index-and-code-links.html"><a href="index-and-code-links.html#get-data-links"><i class="fa fa-check"></i><b>A.11</b> Get Data links</a>
<ul>
<li class="chapter" data-level="A.11.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-11.1-environmental-dataenvironmental-data-links"><i class="fa fa-check"></i><b>A.11.1</b> <span>Section 11.1 Environmental Data</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.12" data-path="index-and-code-links.html"><a href="index-and-code-links.html#code-and-development-links"><i class="fa fa-check"></i><b>A.12</b> Code and Development links</a>
<ul>
<li class="chapter" data-level="A.12.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-12.1-files-in-and-outfiles-in-and-out-links"><i class="fa fa-check"></i><b>A.12.1</b> <span>Section 12.1 Files In and Out</span> links</a></li>
<li class="chapter" data-level="A.12.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-12.2-python-with-rpython-with-r-links"><i class="fa fa-check"></i><b>A.12.2</b> <span>Section 12.2 Python with R</span> links</a></li>
<li class="chapter" data-level="A.12.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-12.3-command-linecommand-line-links"><i class="fa fa-check"></i><b>A.12.3</b> <span>Section 12.3 Command Line</span> links</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://fanwangecon.github.io/R4Econ/bookdown/index.html" target="blank">R4Econ Bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Structures, Estimation and Optimization with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="multi-dimensional-data-structures" class="section level1" number="4">
<h1><span class="header-section-number">Chapter 4</span> Multi-dimensional Data Structures</h1>

<div id="generate-gather-bind-and-join" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Generate, Gather, Bind and Join</h2>

<div id="generate-panel-structure" class="section level3" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Generate Panel Structure</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R Code Examples</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository (<a href="https://fanwangecon.github.io/Stat4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<div id="balanced-panel-skeleton" class="section level4" number="4.1.1.1">
<h4><span class="header-section-number">4.1.1.1</span> Balanced Panel Skeleton</h4>
<p>There are <span class="math inline">\(N\)</span> individuals, each could be observed <span class="math inline">\(M\)</span> times. In the example below, there are 3 students, each observed over 4 dates. This just uses the <a href="https://tidyr.tidyverse.org/reference/uncount.html">uncount</a> function from <em>tidyr</em>.</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="multi-dimensional-data-structures.html#cb306-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define</span></span>
<span id="cb306-2"><a href="multi-dimensional-data-structures.html#cb306-2" aria-hidden="true" tabindex="-1"></a>it_N <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb306-3"><a href="multi-dimensional-data-structures.html#cb306-3" aria-hidden="true" tabindex="-1"></a>it_M <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb306-4"><a href="multi-dimensional-data-structures.html#cb306-4" aria-hidden="true" tabindex="-1"></a>svr_id <span class="ot">&lt;-</span> <span class="st">&#39;student_id&#39;</span></span>
<span id="cb306-5"><a href="multi-dimensional-data-structures.html#cb306-5" aria-hidden="true" tabindex="-1"></a>svr_date <span class="ot">&lt;-</span> <span class="st">&#39;class_day&#39;</span></span>
<span id="cb306-6"><a href="multi-dimensional-data-structures.html#cb306-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-7"><a href="multi-dimensional-data-structures.html#cb306-7" aria-hidden="true" tabindex="-1"></a><span class="co"># dataframe</span></span>
<span id="cb306-8"><a href="multi-dimensional-data-structures.html#cb306-8" aria-hidden="true" tabindex="-1"></a>df_panel_skeleton <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">matrix</span>(it_M, <span class="at">nrow=</span>it_N, <span class="at">ncol=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb306-9"><a href="multi-dimensional-data-structures.html#cb306-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="at">var =</span> svr_id) <span class="sc">%&gt;%</span></span>
<span id="cb306-10"><a href="multi-dimensional-data-structures.html#cb306-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">uncount</span>(V1) <span class="sc">%&gt;%</span></span>
<span id="cb306-11"><a href="multi-dimensional-data-structures.html#cb306-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_id)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_date) <span class="sc">:</span><span class="er">=</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb306-12"><a href="multi-dimensional-data-structures.html#cb306-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb306-13"><a href="multi-dimensional-data-structures.html#cb306-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-14"><a href="multi-dimensional-data-structures.html#cb306-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb306-15"><a href="multi-dimensional-data-structures.html#cb306-15" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df_panel_skeleton) <span class="sc">%&gt;%</span></span>
<span id="cb306-16"><a href="multi-dimensional-data-structures.html#cb306-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
student_id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
class_day
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5
</td>
</tr>
</tbody>
</table>
</div>
<div id="panel-of-children-with-height-growth" class="section level4" number="4.1.1.2">
<h4><span class="header-section-number">4.1.1.2</span> Panel of Children with Height Growth</h4>
<p>Given <span class="math inline">\(N\)</span> individuals, each with <span class="math inline">\(G\)</span> observations. There is an initial height variable and height grows every year. There are growth variables, variables for cumulative growth and variables for height at each age for each child.</p>
<p>Individuals are defined by gender (1 = female), race (1=asian), and birth height. Within individual yearly information includes height at each year of age.</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="multi-dimensional-data-structures.html#cb307-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define</span></span>
<span id="cb307-2"><a href="multi-dimensional-data-structures.html#cb307-2" aria-hidden="true" tabindex="-1"></a>it_N <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb307-3"><a href="multi-dimensional-data-structures.html#cb307-3" aria-hidden="true" tabindex="-1"></a>it_M <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb307-4"><a href="multi-dimensional-data-structures.html#cb307-4" aria-hidden="true" tabindex="-1"></a>svr_id <span class="ot">&lt;-</span> <span class="st">&#39;indi_id&#39;</span></span>
<span id="cb307-5"><a href="multi-dimensional-data-structures.html#cb307-5" aria-hidden="true" tabindex="-1"></a>svr_gender <span class="ot">&lt;-</span> <span class="st">&#39;female&#39;</span></span>
<span id="cb307-6"><a href="multi-dimensional-data-structures.html#cb307-6" aria-hidden="true" tabindex="-1"></a>svr_asian <span class="ot">&lt;-</span> <span class="st">&#39;asian&#39;</span></span>
<span id="cb307-7"><a href="multi-dimensional-data-structures.html#cb307-7" aria-hidden="true" tabindex="-1"></a>svr_age <span class="ot">&lt;-</span> <span class="st">&#39;year_of_age&#39;</span></span>
<span id="cb307-8"><a href="multi-dimensional-data-structures.html#cb307-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Define Height Related Variables</span></span>
<span id="cb307-9"><a href="multi-dimensional-data-structures.html#cb307-9" aria-hidden="true" tabindex="-1"></a>svr_brthgt <span class="ot">&lt;-</span> <span class="st">&#39;birth_height&#39;</span></span>
<span id="cb307-10"><a href="multi-dimensional-data-structures.html#cb307-10" aria-hidden="true" tabindex="-1"></a>svr_hgtgrow <span class="ot">&lt;-</span> <span class="st">&#39;hgt_growth&#39;</span></span>
<span id="cb307-11"><a href="multi-dimensional-data-structures.html#cb307-11" aria-hidden="true" tabindex="-1"></a>svr_hgtgrow_cumu <span class="ot">&lt;-</span> <span class="st">&#39;hgt_growcumu&#39;</span></span>
<span id="cb307-12"><a href="multi-dimensional-data-structures.html#cb307-12" aria-hidden="true" tabindex="-1"></a>svr_height <span class="ot">&lt;-</span> <span class="st">&#39;height&#39;</span></span>
<span id="cb307-13"><a href="multi-dimensional-data-structures.html#cb307-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb307-14"><a href="multi-dimensional-data-structures.html#cb307-14" aria-hidden="true" tabindex="-1"></a><span class="co"># panel dataframe following</span></span>
<span id="cb307-15"><a href="multi-dimensional-data-structures.html#cb307-15" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb307-16"><a href="multi-dimensional-data-structures.html#cb307-16" aria-hidden="true" tabindex="-1"></a>df_panel_indiage <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">matrix</span>(it_M, <span class="at">nrow=</span>it_N, <span class="at">ncol=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb307-17"><a href="multi-dimensional-data-structures.html#cb307-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_gender) <span class="sc">:</span><span class="er">=</span> <span class="fu">rbinom</span>(<span class="fu">n</span>(), <span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb307-18"><a href="multi-dimensional-data-structures.html#cb307-18" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!!</span><span class="fu">sym</span>(svr_asian) <span class="sc">:</span><span class="er">=</span> <span class="fu">rbinom</span>(<span class="fu">n</span>(), <span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb307-19"><a href="multi-dimensional-data-structures.html#cb307-19" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!!</span><span class="fu">sym</span>(svr_brthgt) <span class="sc">:</span><span class="er">=</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="at">mean=</span><span class="dv">60</span>,<span class="at">sd=</span><span class="dv">3</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb307-20"><a href="multi-dimensional-data-structures.html#cb307-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">uncount</span>(V1) <span class="sc">%&gt;%</span></span>
<span id="cb307-21"><a href="multi-dimensional-data-structures.html#cb307-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_gender), <span class="sc">!!</span><span class="fu">sym</span>(svr_asian), <span class="sc">!!</span><span class="fu">sym</span>(svr_brthgt)) <span class="sc">%&gt;%</span></span>
<span id="cb307-22"><a href="multi-dimensional-data-structures.html#cb307-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_age) <span class="sc">:</span><span class="er">=</span> <span class="fu">row_number</span>(),</span>
<span id="cb307-23"><a href="multi-dimensional-data-structures.html#cb307-23" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!!</span><span class="fu">sym</span>(svr_hgtgrow) <span class="sc">:</span><span class="er">=</span> <span class="fu">runif</span>(<span class="fu">n</span>(), <span class="at">min=</span><span class="dv">5</span>, <span class="at">max=</span><span class="dv">15</span>),</span>
<span id="cb307-24"><a href="multi-dimensional-data-structures.html#cb307-24" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!!</span><span class="fu">sym</span>(svr_hgtgrow_cumu) <span class="sc">:</span><span class="er">=</span> <span class="fu">cumsum</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_hgtgrow)),</span>
<span id="cb307-25"><a href="multi-dimensional-data-structures.html#cb307-25" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!!</span><span class="fu">sym</span>(svr_height) <span class="sc">:</span><span class="er">=</span> <span class="sc">!!</span><span class="fu">sym</span>(svr_brthgt) <span class="sc">+</span> <span class="sc">!!</span><span class="fu">sym</span>(svr_hgtgrow_cumu))  <span class="sc">%&gt;%</span></span>
<span id="cb307-26"><a href="multi-dimensional-data-structures.html#cb307-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb307-27"><a href="multi-dimensional-data-structures.html#cb307-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb307-28"><a href="multi-dimensional-data-structures.html#cb307-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Add Height Index</span></span>
<span id="cb307-29"><a href="multi-dimensional-data-structures.html#cb307-29" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df_panel_indiage) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
female
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
asian
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
birth_height
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
year_of_age
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
hgt_growth
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
hgt_growcumu
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
height
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
65.14520
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
13.895393
</td>
<td style="text-align:right;">
13.895393
</td>
<td style="text-align:right;">
79.04059
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
65.14520
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
11.928034
</td>
<td style="text-align:right;">
25.823427
</td>
<td style="text-align:right;">
90.96862
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
65.14520
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
11.405068
</td>
<td style="text-align:right;">
37.228495
</td>
<td style="text-align:right;">
102.37369
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
61.38275
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
11.907053
</td>
<td style="text-align:right;">
11.907053
</td>
<td style="text-align:right;">
73.28980
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
61.38275
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
12.954674
</td>
<td style="text-align:right;">
24.861727
</td>
<td style="text-align:right;">
86.24448
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
61.38275
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5.246137
</td>
<td style="text-align:right;">
30.107864
</td>
<td style="text-align:right;">
91.49061
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
56.20482
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
14.942698
</td>
<td style="text-align:right;">
14.942698
</td>
<td style="text-align:right;">
71.14751
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
56.20482
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
11.557058
</td>
<td style="text-align:right;">
26.499756
</td>
<td style="text-align:right;">
82.70457
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
56.20482
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
12.085305
</td>
<td style="text-align:right;">
38.585060
</td>
<td style="text-align:right;">
94.78988
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
57.93944
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6.471137
</td>
<td style="text-align:right;">
6.471137
</td>
<td style="text-align:right;">
64.41058
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
57.93944
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
14.630242
</td>
<td style="text-align:right;">
21.101379
</td>
<td style="text-align:right;">
79.04082
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
57.93944
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
14.022991
</td>
<td style="text-align:right;">
35.124369
</td>
<td style="text-align:right;">
93.06381
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
58.66301
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
10.440660
</td>
<td style="text-align:right;">
10.440660
</td>
<td style="text-align:right;">
69.10367
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
58.66301
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
10.941420
</td>
<td style="text-align:right;">
21.382081
</td>
<td style="text-align:right;">
80.04509
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
58.66301
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
7.891597
</td>
<td style="text-align:right;">
29.273678
</td>
<td style="text-align:right;">
87.93669
</td>
</tr>
</tbody>
</table>
</div>
<div id="create-group-ids" class="section level4" number="4.1.1.3">
<h4><span class="header-section-number">4.1.1.3</span> Create Group IDs</h4>
<p>Given the dataframe just created, generate group IDs for each Gender and Race Groups. Given that both are binary, there can only be 4 unique groups.</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="multi-dimensional-data-structures.html#cb308-1" aria-hidden="true" tabindex="-1"></a><span class="co"># group id</span></span>
<span id="cb308-2"><a href="multi-dimensional-data-structures.html#cb308-2" aria-hidden="true" tabindex="-1"></a>svr_group_id <span class="ot">&lt;-</span> <span class="st">&#39;female_asian_id&#39;</span></span>
<span id="cb308-3"><a href="multi-dimensional-data-structures.html#cb308-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Define</span></span>
<span id="cb308-4"><a href="multi-dimensional-data-structures.html#cb308-4" aria-hidden="true" tabindex="-1"></a>ls_svr_group_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;female&#39;</span>, <span class="st">&#39;asian&#39;</span>)</span>
<span id="cb308-5"><a href="multi-dimensional-data-structures.html#cb308-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-6"><a href="multi-dimensional-data-structures.html#cb308-6" aria-hidden="true" tabindex="-1"></a><span class="co"># panel dataframe following</span></span>
<span id="cb308-7"><a href="multi-dimensional-data-structures.html#cb308-7" aria-hidden="true" tabindex="-1"></a>df_panel_indiage_id <span class="ot">&lt;-</span> df_panel_indiage <span class="sc">%&gt;%</span></span>
<span id="cb308-8"><a href="multi-dimensional-data-structures.html#cb308-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">!!!</span><span class="fu">syms</span>(ls_svr_group_vars)) <span class="sc">%&gt;%</span></span>
<span id="cb308-9"><a href="multi-dimensional-data-structures.html#cb308-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="sc">!!!</span><span class="fu">syms</span>(ls_svr_group_vars)) <span class="sc">%&gt;%</span></span>
<span id="cb308-10"><a href="multi-dimensional-data-structures.html#cb308-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_group_id) <span class="sc">:</span><span class="er">=</span> (<span class="fu">row_number</span>()<span class="sc">==</span><span class="dv">1</span>)<span class="sc">*</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb308-11"><a href="multi-dimensional-data-structures.html#cb308-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb308-12"><a href="multi-dimensional-data-structures.html#cb308-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_group_id) <span class="sc">:</span><span class="er">=</span> <span class="fu">cumsum</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_group_id))) <span class="sc">%&gt;%</span></span>
<span id="cb308-13"><a href="multi-dimensional-data-structures.html#cb308-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">one_of</span>(svr_group_id, ls_svr_group_vars), <span class="fu">everything</span>())</span>
<span id="cb308-14"><a href="multi-dimensional-data-structures.html#cb308-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-15"><a href="multi-dimensional-data-structures.html#cb308-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Add Height Index</span></span>
<span id="cb308-16"><a href="multi-dimensional-data-structures.html#cb308-16" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df_panel_indiage_id) <span class="sc">%&gt;%</span></span>
<span id="cb308-17"><a href="multi-dimensional-data-structures.html#cb308-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling_fc_wide</span>()</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:875px; ">
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
female_asian_id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
female
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
asian
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
birth_height
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
year_of_age
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
hgt_growth
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
hgt_growcumu
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
height
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
65.14520
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
13.895393
</td>
<td style="text-align:right;">
13.895393
</td>
<td style="text-align:right;">
79.04059
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
65.14520
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
11.928034
</td>
<td style="text-align:right;">
25.823427
</td>
<td style="text-align:right;">
90.96862
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
65.14520
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
11.405068
</td>
<td style="text-align:right;">
37.228495
</td>
<td style="text-align:right;">
102.37369
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
56.20482
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
14.942698
</td>
<td style="text-align:right;">
14.942698
</td>
<td style="text-align:right;">
71.14751
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
56.20482
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
11.557058
</td>
<td style="text-align:right;">
26.499756
</td>
<td style="text-align:right;">
82.70457
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
56.20482
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
12.085305
</td>
<td style="text-align:right;">
38.585060
</td>
<td style="text-align:right;">
94.78988
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
58.66301
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
10.440660
</td>
<td style="text-align:right;">
10.440660
</td>
<td style="text-align:right;">
69.10367
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
58.66301
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
10.941420
</td>
<td style="text-align:right;">
21.382081
</td>
<td style="text-align:right;">
80.04509
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
58.66301
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
7.891597
</td>
<td style="text-align:right;">
29.273678
</td>
<td style="text-align:right;">
87.93669
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
61.38275
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
11.907053
</td>
<td style="text-align:right;">
11.907053
</td>
<td style="text-align:right;">
73.28980
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
61.38275
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
12.954674
</td>
<td style="text-align:right;">
24.861727
</td>
<td style="text-align:right;">
86.24448
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
61.38275
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5.246137
</td>
<td style="text-align:right;">
30.107864
</td>
<td style="text-align:right;">
91.49061
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
57.93944
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6.471137
</td>
<td style="text-align:right;">
6.471137
</td>
<td style="text-align:right;">
64.41058
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
57.93944
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
14.630242
</td>
<td style="text-align:right;">
21.101379
</td>
<td style="text-align:right;">
79.04082
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
57.93944
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
14.022991
</td>
<td style="text-align:right;">
35.124369
</td>
<td style="text-align:right;">
93.06381
</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<div id="join-datasets" class="section level3" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Join Datasets</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R Code Examples</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository (<a href="https://fanwangecon.github.io/Stat4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<div id="join-panel-with-multiple-keys" class="section level4" number="4.1.2.1">
<h4><span class="header-section-number">4.1.2.1</span> Join Panel with Multiple Keys</h4>
<p>We have two datasets, one for student enrollment, panel over time, but some students do not show up on some dates. The other is a skeleton panel with all student ID and all dates. Often we need to join dataframes together, and we need to join by the student ID and the panel time Key at the same time. When students show up, there is a quiz score for that day, so the joined panel should have as data column quiz score</p>
<p>Student count is <span class="math inline">\(N\)</span>, total dates are <span class="math inline">\(M\)</span>. First we generate two panels below, then we join by both keys using <em>left_join</em>. First, define dataframes:</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="multi-dimensional-data-structures.html#cb309-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define</span></span>
<span id="cb309-2"><a href="multi-dimensional-data-structures.html#cb309-2" aria-hidden="true" tabindex="-1"></a>it_N <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb309-3"><a href="multi-dimensional-data-structures.html#cb309-3" aria-hidden="true" tabindex="-1"></a>it_M <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb309-4"><a href="multi-dimensional-data-structures.html#cb309-4" aria-hidden="true" tabindex="-1"></a>svr_id <span class="ot">&lt;-</span> <span class="st">&#39;sid&#39;</span></span>
<span id="cb309-5"><a href="multi-dimensional-data-structures.html#cb309-5" aria-hidden="true" tabindex="-1"></a>svr_date <span class="ot">&lt;-</span> <span class="st">&#39;classday&#39;</span></span>
<span id="cb309-6"><a href="multi-dimensional-data-structures.html#cb309-6" aria-hidden="true" tabindex="-1"></a>svr_attend <span class="ot">&lt;-</span> <span class="st">&#39;date_in_class&#39;</span></span>
<span id="cb309-7"><a href="multi-dimensional-data-structures.html#cb309-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb309-8"><a href="multi-dimensional-data-structures.html#cb309-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel Skeleton</span></span>
<span id="cb309-9"><a href="multi-dimensional-data-structures.html#cb309-9" aria-hidden="true" tabindex="-1"></a>df_panel_balanced_skeleton <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">matrix</span>(it_M, <span class="at">nrow=</span>it_N, <span class="at">ncol=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb309-10"><a href="multi-dimensional-data-structures.html#cb309-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="at">var =</span> svr_id) <span class="sc">%&gt;%</span></span>
<span id="cb309-11"><a href="multi-dimensional-data-structures.html#cb309-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">uncount</span>(V1) <span class="sc">%&gt;%</span></span>
<span id="cb309-12"><a href="multi-dimensional-data-structures.html#cb309-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_id)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_date) <span class="sc">:</span><span class="er">=</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb309-13"><a href="multi-dimensional-data-structures.html#cb309-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb309-14"><a href="multi-dimensional-data-structures.html#cb309-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb309-15"><a href="multi-dimensional-data-structures.html#cb309-15" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df_panel_balanced_skeleton) <span class="sc">%&gt;%</span></span>
<span id="cb309-16"><a href="multi-dimensional-data-structures.html#cb309-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
classday
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="multi-dimensional-data-structures.html#cb310-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Smaller Panel of Random Days in School</span></span>
<span id="cb310-2"><a href="multi-dimensional-data-structures.html#cb310-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">456</span>)</span>
<span id="cb310-3"><a href="multi-dimensional-data-structures.html#cb310-3" aria-hidden="true" tabindex="-1"></a>df_panel_attend <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">matrix</span>(it_M, <span class="at">nrow=</span>it_N, <span class="at">ncol=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb310-4"><a href="multi-dimensional-data-structures.html#cb310-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="at">var =</span> svr_id) <span class="sc">%&gt;%</span></span>
<span id="cb310-5"><a href="multi-dimensional-data-structures.html#cb310-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">uncount</span>(V1) <span class="sc">%&gt;%</span></span>
<span id="cb310-6"><a href="multi-dimensional-data-structures.html#cb310-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_id)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_date) <span class="sc">:</span><span class="er">=</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb310-7"><a href="multi-dimensional-data-structures.html#cb310-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">in_class =</span> <span class="fu">case_when</span>(<span class="fu">rnorm</span>(<span class="fu">n</span>(),<span class="at">mean=</span><span class="dv">0</span>,<span class="at">sd=</span><span class="dv">1</span>) <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">1</span>, <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb310-8"><a href="multi-dimensional-data-structures.html#cb310-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(in_class <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_id), <span class="sc">!!</span><span class="fu">sym</span>(svr_date)) <span class="sc">%&gt;%</span></span>
<span id="cb310-9"><a href="multi-dimensional-data-structures.html#cb310-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_attend) <span class="sc">:</span><span class="er">=</span> <span class="sc">!!</span><span class="fu">sym</span>(svr_date)) <span class="sc">%&gt;%</span></span>
<span id="cb310-10"><a href="multi-dimensional-data-structures.html#cb310-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dayquizscore =</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(),<span class="at">mean=</span><span class="dv">80</span>,<span class="at">sd=</span><span class="dv">10</span>))</span>
<span id="cb310-11"><a href="multi-dimensional-data-structures.html#cb310-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb310-12"><a href="multi-dimensional-data-structures.html#cb310-12" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df_panel_attend) <span class="sc">%&gt;%</span></span>
<span id="cb310-13"><a href="multi-dimensional-data-structures.html#cb310-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date_in_class
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dayquizscore
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
89.88726
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
96.53929
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
65.59195
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
99.47356
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
97.36936
</td>
</tr>
</tbody>
</table>
<p>Second, now join dataframes:</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="multi-dimensional-data-structures.html#cb311-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join with explicit names</span></span>
<span id="cb311-2"><a href="multi-dimensional-data-structures.html#cb311-2" aria-hidden="true" tabindex="-1"></a>df_quiz_joined_multikey <span class="ot">&lt;-</span> df_panel_balanced_skeleton <span class="sc">%&gt;%</span></span>
<span id="cb311-3"><a href="multi-dimensional-data-structures.html#cb311-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(df_panel_attend,</span>
<span id="cb311-4"><a href="multi-dimensional-data-structures.html#cb311-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">by=</span>(<span class="fu">c</span>(<span class="st">&#39;sid&#39;</span><span class="ot">=</span><span class="st">&#39;sid&#39;</span>, <span class="st">&#39;classday&#39;</span><span class="ot">=</span><span class="st">&#39;date_in_class&#39;</span>)))</span>
<span id="cb311-5"><a href="multi-dimensional-data-structures.html#cb311-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-6"><a href="multi-dimensional-data-structures.html#cb311-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Join with setname strings</span></span>
<span id="cb311-7"><a href="multi-dimensional-data-structures.html#cb311-7" aria-hidden="true" tabindex="-1"></a>df_quiz_joined_multikey_setnames <span class="ot">&lt;-</span> df_panel_balanced_skeleton <span class="sc">%&gt;%</span></span>
<span id="cb311-8"><a href="multi-dimensional-data-structures.html#cb311-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(df_panel_attend, <span class="at">by=</span><span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">&#39;sid&#39;</span>, <span class="st">&#39;date_in_class&#39;</span>), <span class="fu">c</span>(<span class="st">&#39;sid&#39;</span>, <span class="st">&#39;classday&#39;</span>)))</span>
<span id="cb311-9"><a href="multi-dimensional-data-structures.html#cb311-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-10"><a href="multi-dimensional-data-structures.html#cb311-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb311-11"><a href="multi-dimensional-data-structures.html#cb311-11" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df_quiz_joined_multikey) <span class="sc">%&gt;%</span></span>
<span id="cb311-12"><a href="multi-dimensional-data-structures.html#cb311-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
classday
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dayquizscore
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
89.88726
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
96.53929
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
65.59195
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
99.47356
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
97.36936
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="multi-dimensional-data-structures.html#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df_quiz_joined_multikey_setnames) <span class="sc">%&gt;%</span></span>
<span id="cb312-2"><a href="multi-dimensional-data-structures.html#cb312-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
classday
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dayquizscore
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
89.88726
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
96.53929
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
65.59195
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
99.47356
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
97.36936
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table>
</div>
<div id="stack-panel-frames-together" class="section level4" number="4.1.2.2">
<h4><span class="header-section-number">4.1.2.2</span> Stack Panel Frames Together</h4>
<p>There are multiple panel dataframe, each for different subsets of dates. All variable names and units of observations are identical. Use DPLYR <a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a>.</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="multi-dimensional-data-structures.html#cb313-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define</span></span>
<span id="cb313-2"><a href="multi-dimensional-data-structures.html#cb313-2" aria-hidden="true" tabindex="-1"></a>it_N <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="co"># Number of individuals</span></span>
<span id="cb313-3"><a href="multi-dimensional-data-structures.html#cb313-3" aria-hidden="true" tabindex="-1"></a>it_M <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="co"># Number of Months</span></span>
<span id="cb313-4"><a href="multi-dimensional-data-structures.html#cb313-4" aria-hidden="true" tabindex="-1"></a>svr_id <span class="ot">&lt;-</span> <span class="st">&#39;sid&#39;</span></span>
<span id="cb313-5"><a href="multi-dimensional-data-structures.html#cb313-5" aria-hidden="true" tabindex="-1"></a>svr_date <span class="ot">&lt;-</span> <span class="st">&#39;date&#39;</span></span>
<span id="cb313-6"><a href="multi-dimensional-data-structures.html#cb313-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-7"><a href="multi-dimensional-data-structures.html#cb313-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel First Half of Year</span></span>
<span id="cb313-8"><a href="multi-dimensional-data-structures.html#cb313-8" aria-hidden="true" tabindex="-1"></a>df_panel_m1tom3 <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">matrix</span>(it_M, <span class="at">nrow=</span>it_N, <span class="at">ncol=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb313-9"><a href="multi-dimensional-data-structures.html#cb313-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="at">var =</span> svr_id) <span class="sc">%&gt;%</span></span>
<span id="cb313-10"><a href="multi-dimensional-data-structures.html#cb313-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">uncount</span>(V1) <span class="sc">%&gt;%</span></span>
<span id="cb313-11"><a href="multi-dimensional-data-structures.html#cb313-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_id)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_date) <span class="sc">:</span><span class="er">=</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb313-12"><a href="multi-dimensional-data-structures.html#cb313-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb313-13"><a href="multi-dimensional-data-structures.html#cb313-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-14"><a href="multi-dimensional-data-structures.html#cb313-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel Second Half of Year</span></span>
<span id="cb313-15"><a href="multi-dimensional-data-structures.html#cb313-15" aria-hidden="true" tabindex="-1"></a>df_panel_m4tom6 <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">matrix</span>(it_M, <span class="at">nrow=</span>it_N, <span class="at">ncol=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb313-16"><a href="multi-dimensional-data-structures.html#cb313-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="at">var =</span> svr_id) <span class="sc">%&gt;%</span></span>
<span id="cb313-17"><a href="multi-dimensional-data-structures.html#cb313-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">uncount</span>(V1) <span class="sc">%&gt;%</span></span>
<span id="cb313-18"><a href="multi-dimensional-data-structures.html#cb313-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_id)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_date) <span class="sc">:</span><span class="er">=</span> <span class="fu">row_number</span>() <span class="sc">+</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb313-19"><a href="multi-dimensional-data-structures.html#cb313-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb313-20"><a href="multi-dimensional-data-structures.html#cb313-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-21"><a href="multi-dimensional-data-structures.html#cb313-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind Rows</span></span>
<span id="cb313-22"><a href="multi-dimensional-data-structures.html#cb313-22" aria-hidden="true" tabindex="-1"></a>df_panel_m1tm6 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(df_panel_m1tom3, df_panel_m4tom6) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="sc">!!!</span><span class="fu">syms</span>(<span class="fu">c</span>(svr_id, svr_date)))</span>
<span id="cb313-23"><a href="multi-dimensional-data-structures.html#cb313-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-24"><a href="multi-dimensional-data-structures.html#cb313-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb313-25"><a href="multi-dimensional-data-structures.html#cb313-25" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df_panel_m1tom3) <span class="sc">%&gt;%</span></span>
<span id="cb313-26"><a href="multi-dimensional-data-structures.html#cb313-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="multi-dimensional-data-structures.html#cb314-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df_panel_m4tom6) <span class="sc">%&gt;%</span></span>
<span id="cb314-2"><a href="multi-dimensional-data-structures.html#cb314-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
6
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="multi-dimensional-data-structures.html#cb315-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df_panel_m1tm6) <span class="sc">%&gt;%</span></span>
<span id="cb315-2"><a href="multi-dimensional-data-structures.html#cb315-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
6
</td>
</tr>
</tbody>
</table>

</div>
</div>
<div id="gather-files" class="section level3" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> Gather Files</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R Code Examples</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository (<a href="https://fanwangecon.github.io/Stat4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<div id="stack-csv-files-together-extract-and-select-variables" class="section level4" number="4.1.3.1">
<h4><span class="header-section-number">4.1.3.1</span> Stack CSV Files Together Extract and Select Variables</h4>
<p>There are multiple csv files, each was simulated with a different combination of parameters, each file has the same columns and perhaps even the same number of rows. We want to combine the files together, and provide correct attributes to rows from each table stacked, based on each underlying csv file’s file name.</p>
<p>This is necessary, for example, when running computational exercises across EC2 instances in <a href="https://fanwangecon.github.io/Py4Econ/aws/batch/htmlpdfr/fs_aws_batch.html">batch array</a> and files are saved to different <a href="https://fanwangecon.github.io/Py4Econ/aws/s3/htmlpdfr/fs_aws_s3.html">S3</a> folders. Need to gather parallel computational results together in a single file after syncing files locally with S3.</p>
<p>In the <a href="https://github.com/FanWangEcon/R4Econ/tree/master/development/inout/_file/csv">csv</a> folder under this section, there are four subfolder, each containing 3 files with identical file structures.</p>
<p>We want to find the relevant csv files from these directories, and stack the results together.</p>
<ol style="list-style-type: decimal">
<li>File search search string, search in all subfolders, the search string contains file prefix that is common across files that need to be gathered.</li>
<li>Extract path folder hierarchy, each layer of folder is a different variable</li>
<li>Stack files together, with variables for file name and folder name</li>
<li>Extract from file name the component that is not in the search string, keep as separate variable</li>
<li>Follow specific rules about how file suffix is constructed to obtain additional variables.</li>
<li>Keep only a subset of columns of interest.</li>
</ol>
<p>First, <a href="https://fanwangecon.github.io/R4Econ/development/inout/htmlpdfr/fs_rmd_pdf_html.html#11_Search_and_Find_all_Files_in_Repository">search and find</a> all files with certain prefix.</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="multi-dimensional-data-structures.html#cb316-1" aria-hidden="true" tabindex="-1"></a><span class="co"># can search in multiple paths, second path here has no relevant contents</span></span>
<span id="cb316-2"><a href="multi-dimensional-data-structures.html#cb316-2" aria-hidden="true" tabindex="-1"></a>spt_roots <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;C:/Users/fan/R4Econ/panel/basic/_file/csv&#39;</span>,</span>
<span id="cb316-3"><a href="multi-dimensional-data-structures.html#cb316-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">&#39;C:/Users/fan/R4Econ/panel/basic/_file/tex&#39;</span>)</span>
<span id="cb316-4"><a href="multi-dimensional-data-structures.html#cb316-4" aria-hidden="true" tabindex="-1"></a><span class="co"># can skip file names with certain strings</span></span>
<span id="cb316-5"><a href="multi-dimensional-data-structures.html#cb316-5" aria-hidden="true" tabindex="-1"></a>spn_skip <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;A3420&#39;</span>)</span>
<span id="cb316-6"><a href="multi-dimensional-data-structures.html#cb316-6" aria-hidden="true" tabindex="-1"></a><span class="co"># prefix search patther,</span></span>
<span id="cb316-7"><a href="multi-dimensional-data-structures.html#cb316-7" aria-hidden="true" tabindex="-1"></a>st_search_str <span class="ot">&lt;-</span> <span class="st">&#39;solu_19E1NEp99r99x_ITG_PE_cev_*&#39;</span></span>
<span id="cb316-8"><a href="multi-dimensional-data-structures.html#cb316-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb316-9"><a href="multi-dimensional-data-structures.html#cb316-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Search and get all Path</span></span>
<span id="cb316-10"><a href="multi-dimensional-data-structures.html#cb316-10" aria-hidden="true" tabindex="-1"></a>ls_sfls <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path=</span>spt_roots,</span>
<span id="cb316-11"><a href="multi-dimensional-data-structures.html#cb316-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">recursive=</span>T,</span>
<span id="cb316-12"><a href="multi-dimensional-data-structures.html#cb316-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">pattern=</span>st_search_str,</span>
<span id="cb316-13"><a href="multi-dimensional-data-structures.html#cb316-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">full.names=</span>T)</span>
<span id="cb316-14"><a href="multi-dimensional-data-structures.html#cb316-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb316-15"><a href="multi-dimensional-data-structures.html#cb316-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Skip path if contains words in skip list</span></span>
<span id="cb316-16"><a href="multi-dimensional-data-structures.html#cb316-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">missing</span>(spn_skip)) {</span>
<span id="cb316-17"><a href="multi-dimensional-data-structures.html#cb316-17" aria-hidden="true" tabindex="-1"></a>  ls_sfls <span class="ot">&lt;-</span> ls_sfls[<span class="sc">!</span><span class="fu">grepl</span>(<span class="fu">paste</span>(spn_skip, <span class="at">collapse =</span> <span class="st">&quot;|&quot;</span>), ls_sfls)]</span>
<span id="cb316-18"><a href="multi-dimensional-data-structures.html#cb316-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Second, show all the files found, show their full path, the file name and the two folder names above the file name.</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="multi-dimensional-data-structures.html#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop and print found files</span></span>
<span id="cb317-2"><a href="multi-dimensional-data-structures.html#cb317-2" aria-hidden="true" tabindex="-1"></a>it_folders_names_to_keep <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb317-3"><a href="multi-dimensional-data-structures.html#cb317-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (spt_file <span class="cf">in</span> ls_sfls) {</span>
<span id="cb317-4"><a href="multi-dimensional-data-structures.html#cb317-4" aria-hidden="true" tabindex="-1"></a>    ls_srt_folders_name_keep <span class="ot">&lt;-</span> <span class="fu">tail</span>(<span class="fu">strsplit</span>(spt_file, <span class="st">&quot;/&quot;</span>)[[<span class="dv">1</span>]], <span class="at">n=</span>it_folders_names_to_keep<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb317-5"><a href="multi-dimensional-data-structures.html#cb317-5" aria-hidden="true" tabindex="-1"></a>    snm_file_name <span class="ot">&lt;-</span> <span class="fu">tail</span>(ls_srt_folders_name_keep, <span class="dv">1</span>)</span>
<span id="cb317-6"><a href="multi-dimensional-data-structures.html#cb317-6" aria-hidden="true" tabindex="-1"></a>    ls_srt_folders_keep <span class="ot">&lt;-</span> <span class="fu">head</span>(ls_srt_folders_name_keep, it_folders_names_to_keep)</span>
<span id="cb317-7"><a href="multi-dimensional-data-structures.html#cb317-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&#39;path:&#39;</span>, spt_file))</span>
<span id="cb317-8"><a href="multi-dimensional-data-structures.html#cb317-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(snm_file_name)</span>
<span id="cb317-9"><a href="multi-dimensional-data-structures.html#cb317-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(ls_srt_folders_keep)</span>
<span id="cb317-10"><a href="multi-dimensional-data-structures.html#cb317-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;path:C:/Users/fan/R4Econ/panel/basic/_file/csv/cev-2000/solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000_A0.csv&quot;
## [1] &quot;solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000_A0.csv&quot;
## [1] &quot;csv&quot;      &quot;cev-2000&quot;
## [1] &quot;path:C:/Users/fan/R4Econ/panel/basic/_file/csv/cev-2000/solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000_A6840.csv&quot;
## [1] &quot;solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000_A6840.csv&quot;
## [1] &quot;csv&quot;      &quot;cev-2000&quot;
## [1] &quot;path:C:/Users/fan/R4Econ/panel/basic/_file/csv/cev-947/solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947_A0.csv&quot;
## [1] &quot;solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947_A0.csv&quot;
## [1] &quot;csv&quot;     &quot;cev-947&quot;
## [1] &quot;path:C:/Users/fan/R4Econ/panel/basic/_file/csv/cev-947/solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947_A6840.csv&quot;
## [1] &quot;solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947_A6840.csv&quot;
## [1] &quot;csv&quot;     &quot;cev-947&quot;
## [1] &quot;path:C:/Users/fan/R4Econ/panel/basic/_file/csv/cev2000/solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000_A0.csv&quot;
## [1] &quot;solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000_A0.csv&quot;
## [1] &quot;csv&quot;     &quot;cev2000&quot;
## [1] &quot;path:C:/Users/fan/R4Econ/panel/basic/_file/csv/cev2000/solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000_A6840.csv&quot;
## [1] &quot;solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000_A6840.csv&quot;
## [1] &quot;csv&quot;     &quot;cev2000&quot;
## [1] &quot;path:C:/Users/fan/R4Econ/panel/basic/_file/csv/cev947/solu_19E1NEp99r99x_ITG_PE_cev_c14_cev947_A0.csv&quot;
## [1] &quot;solu_19E1NEp99r99x_ITG_PE_cev_c14_cev947_A0.csv&quot;
## [1] &quot;csv&quot;    &quot;cev947&quot;
## [1] &quot;path:C:/Users/fan/R4Econ/panel/basic/_file/csv/cev947/solu_19E1NEp99r99x_ITG_PE_cev_c14_cev947_A6840.csv&quot;
## [1] &quot;solu_19E1NEp99r99x_ITG_PE_cev_c14_cev947_A6840.csv&quot;
## [1] &quot;csv&quot;    &quot;cev947&quot;</code></pre>
<p>Third, create a dataframe with the folder and file names:</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="multi-dimensional-data-structures.html#cb319-1" aria-hidden="true" tabindex="-1"></a><span class="co"># String matrix empty</span></span>
<span id="cb319-2"><a href="multi-dimensional-data-structures.html#cb319-2" aria-hidden="true" tabindex="-1"></a>mt_st_paths_names <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span><span class="cn">NA</span>, <span class="at">nrow=</span><span class="fu">length</span>(ls_sfls), <span class="at">ncol=</span><span class="dv">4</span>)</span>
<span id="cb319-3"><a href="multi-dimensional-data-structures.html#cb319-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb319-4"><a href="multi-dimensional-data-structures.html#cb319-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop and print found files</span></span>
<span id="cb319-5"><a href="multi-dimensional-data-structures.html#cb319-5" aria-hidden="true" tabindex="-1"></a>it_folders_names_to_keep <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb319-6"><a href="multi-dimensional-data-structures.html#cb319-6" aria-hidden="true" tabindex="-1"></a>it_file_counter <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb319-7"><a href="multi-dimensional-data-structures.html#cb319-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (spt_file <span class="cf">in</span> ls_sfls) {</span>
<span id="cb319-8"><a href="multi-dimensional-data-structures.html#cb319-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># row counter</span></span>
<span id="cb319-9"><a href="multi-dimensional-data-structures.html#cb319-9" aria-hidden="true" tabindex="-1"></a>    it_file_counter <span class="ot">=</span> it_file_counter <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb319-10"><a href="multi-dimensional-data-structures.html#cb319-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb319-11"><a href="multi-dimensional-data-structures.html#cb319-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get file paths</span></span>
<span id="cb319-12"><a href="multi-dimensional-data-structures.html#cb319-12" aria-hidden="true" tabindex="-1"></a>    ls_srt_folders_name_keep <span class="ot">&lt;-</span> <span class="fu">tail</span>(<span class="fu">strsplit</span>(spt_file, <span class="st">&quot;/&quot;</span>)[[<span class="dv">1</span>]], <span class="at">n=</span>it_folders_names_to_keep<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb319-13"><a href="multi-dimensional-data-structures.html#cb319-13" aria-hidden="true" tabindex="-1"></a>    snm_file_name <span class="ot">&lt;-</span> <span class="fu">tail</span>(ls_srt_folders_name_keep, <span class="dv">1</span>)</span>
<span id="cb319-14"><a href="multi-dimensional-data-structures.html#cb319-14" aria-hidden="true" tabindex="-1"></a>    ls_srt_folders_keep <span class="ot">&lt;-</span> <span class="fu">head</span>(ls_srt_folders_name_keep, it_folders_names_to_keep)</span>
<span id="cb319-15"><a href="multi-dimensional-data-structures.html#cb319-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb319-16"><a href="multi-dimensional-data-structures.html#cb319-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># store</span></span>
<span id="cb319-17"><a href="multi-dimensional-data-structures.html#cb319-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># tools::file_path_sans_ext to drop suffix</span></span>
<span id="cb319-18"><a href="multi-dimensional-data-structures.html#cb319-18" aria-hidden="true" tabindex="-1"></a>    mt_st_paths_names[it_file_counter,<span class="dv">1</span>] <span class="ot">=</span> tools<span class="sc">::</span><span class="fu">file_path_sans_ext</span>(snm_file_name)</span>
<span id="cb319-19"><a href="multi-dimensional-data-structures.html#cb319-19" aria-hidden="true" tabindex="-1"></a>    mt_st_paths_names[it_file_counter,<span class="dv">2</span>] <span class="ot">=</span> ls_srt_folders_keep[<span class="dv">1</span>]</span>
<span id="cb319-20"><a href="multi-dimensional-data-structures.html#cb319-20" aria-hidden="true" tabindex="-1"></a>    mt_st_paths_names[it_file_counter,<span class="dv">3</span>] <span class="ot">=</span> ls_srt_folders_keep[<span class="dv">2</span>]</span>
<span id="cb319-21"><a href="multi-dimensional-data-structures.html#cb319-21" aria-hidden="true" tabindex="-1"></a>    mt_st_paths_names[it_file_counter,<span class="dv">4</span>] <span class="ot">=</span> spt_file</span>
<span id="cb319-22"><a href="multi-dimensional-data-structures.html#cb319-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb319-23"><a href="multi-dimensional-data-structures.html#cb319-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb319-24"><a href="multi-dimensional-data-structures.html#cb319-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Column Names</span></span>
<span id="cb319-25"><a href="multi-dimensional-data-structures.html#cb319-25" aria-hidden="true" tabindex="-1"></a>ar_st_varnames <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;fileid&#39;</span>,<span class="st">&#39;name&#39;</span>,<span class="st">&#39;folder1&#39;</span>,<span class="st">&#39;folder2&#39;</span>, <span class="st">&#39;fullpath&#39;</span>)</span>
<span id="cb319-26"><a href="multi-dimensional-data-structures.html#cb319-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb319-27"><a href="multi-dimensional-data-structures.html#cb319-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine to tibble, add name col1, col2, etc.</span></span>
<span id="cb319-28"><a href="multi-dimensional-data-structures.html#cb319-28" aria-hidden="true" tabindex="-1"></a>tb_csv_info <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(mt_st_paths_names) <span class="sc">%&gt;%</span></span>
<span id="cb319-29"><a href="multi-dimensional-data-structures.html#cb319-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">&quot;id&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb319-30"><a href="multi-dimensional-data-structures.html#cb319-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_all</span>(<span class="sc">~</span><span class="fu">c</span>(ar_st_varnames))</span>
<span id="cb319-31"><a href="multi-dimensional-data-structures.html#cb319-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb319-32"><a href="multi-dimensional-data-structures.html#cb319-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Display</span></span>
<span id="cb319-33"><a href="multi-dimensional-data-structures.html#cb319-33" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(tb_csv_info[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fileid
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
name
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
folder1
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
folder2
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000_A0
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:left;">
cev-2000
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000_A6840
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:left;">
cev-2000
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947_A0
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:left;">
cev-947
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947_A6840
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:left;">
cev-947
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000_A0
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:left;">
cev2000
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000_A6840
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:left;">
cev2000
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c14_cev947_A0
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:left;">
cev947
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c14_cev947_A6840
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:left;">
cev947
</td>
</tr>
</tbody>
</table>
<p>Fourth, create a dataframe by expanding each row with the datafile loaded in, use <a href="https://fanwangecon.github.io/R4Econ/function/noloop/htmlpdfr/fs_apply.html#122_anonymous_function">apply with anonymous function</a>.</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="multi-dimensional-data-structures.html#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate a list of dataframes</span></span>
<span id="cb320-2"><a href="multi-dimensional-data-structures.html#cb320-2" aria-hidden="true" tabindex="-1"></a>ls_df_loaded_files <span class="ot">=</span></span>
<span id="cb320-3"><a href="multi-dimensional-data-structures.html#cb320-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(tb_csv_info,</span>
<span id="cb320-4"><a href="multi-dimensional-data-structures.html#cb320-4" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>,</span>
<span id="cb320-5"><a href="multi-dimensional-data-structures.html#cb320-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(row) {</span>
<span id="cb320-6"><a href="multi-dimensional-data-structures.html#cb320-6" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Loading file</span></span>
<span id="cb320-7"><a href="multi-dimensional-data-structures.html#cb320-7" aria-hidden="true" tabindex="-1"></a>          spn_full_path <span class="ot">&lt;-</span> row[<span class="dv">5</span>]</span>
<span id="cb320-8"><a href="multi-dimensional-data-structures.html#cb320-8" aria-hidden="true" tabindex="-1"></a>          mt_csv <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="at">file =</span> spn_full_path)</span>
<span id="cb320-9"><a href="multi-dimensional-data-structures.html#cb320-9" aria-hidden="true" tabindex="-1"></a>          <span class="co"># dataframe</span></span>
<span id="cb320-10"><a href="multi-dimensional-data-structures.html#cb320-10" aria-hidden="true" tabindex="-1"></a>          it_fileid <span class="ot">&lt;-</span> row[<span class="dv">1</span>]</span>
<span id="cb320-11"><a href="multi-dimensional-data-structures.html#cb320-11" aria-hidden="true" tabindex="-1"></a>          snm_filename <span class="ot">&lt;-</span> row[<span class="dv">2</span>]</span>
<span id="cb320-12"><a href="multi-dimensional-data-structures.html#cb320-12" aria-hidden="true" tabindex="-1"></a>          srt_folder_level2 <span class="ot">&lt;-</span> row[<span class="dv">3</span>]</span>
<span id="cb320-13"><a href="multi-dimensional-data-structures.html#cb320-13" aria-hidden="true" tabindex="-1"></a>          srt_folder_level1 <span class="ot">&lt;-</span> row[<span class="dv">4</span>]</span>
<span id="cb320-14"><a href="multi-dimensional-data-structures.html#cb320-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-15"><a href="multi-dimensional-data-structures.html#cb320-15" aria-hidden="true" tabindex="-1"></a>          tb_combine <span class="ot">=</span> <span class="fu">as_tibble</span>(mt_csv) <span class="sc">%&gt;%</span></span>
<span id="cb320-16"><a href="multi-dimensional-data-structures.html#cb320-16" aria-hidden="true" tabindex="-1"></a>            na.omit <span class="sc">%&gt;%</span></span>
<span id="cb320-17"><a href="multi-dimensional-data-structures.html#cb320-17" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">&quot;statesid&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb320-18"><a href="multi-dimensional-data-structures.html#cb320-18" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">fileid =</span> it_fileid,</span>
<span id="cb320-19"><a href="multi-dimensional-data-structures.html#cb320-19" aria-hidden="true" tabindex="-1"></a>                   <span class="at">filename =</span> snm_filename,</span>
<span id="cb320-20"><a href="multi-dimensional-data-structures.html#cb320-20" aria-hidden="true" tabindex="-1"></a>                   <span class="at">folder_lvl1 =</span> srt_folder_level1,</span>
<span id="cb320-21"><a href="multi-dimensional-data-structures.html#cb320-21" aria-hidden="true" tabindex="-1"></a>                   <span class="at">folder_lvl2 =</span> srt_folder_level2) <span class="sc">%&gt;%</span></span>
<span id="cb320-22"><a href="multi-dimensional-data-structures.html#cb320-22" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(fileid, filename, folder_lvl1, folder_lvl2,</span>
<span id="cb320-23"><a href="multi-dimensional-data-structures.html#cb320-23" aria-hidden="true" tabindex="-1"></a>                   statesid, <span class="fu">everything</span>())</span>
<span id="cb320-24"><a href="multi-dimensional-data-structures.html#cb320-24" aria-hidden="true" tabindex="-1"></a>          <span class="co"># return</span></span>
<span id="cb320-25"><a href="multi-dimensional-data-structures.html#cb320-25" aria-hidden="true" tabindex="-1"></a>          <span class="fu">return</span>(tb_combine)</span>
<span id="cb320-26"><a href="multi-dimensional-data-structures.html#cb320-26" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb320-27"><a href="multi-dimensional-data-structures.html#cb320-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-28"><a href="multi-dimensional-data-structures.html#cb320-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Stack dataframes together</span></span>
<span id="cb320-29"><a href="multi-dimensional-data-structures.html#cb320-29" aria-hidden="true" tabindex="-1"></a>df_all_files <span class="ot">=</span> <span class="fu">do.call</span>(bind_rows, ls_df_loaded_files)</span>
<span id="cb320-30"><a href="multi-dimensional-data-structures.html#cb320-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-31"><a href="multi-dimensional-data-structures.html#cb320-31" aria-hidden="true" tabindex="-1"></a><span class="co"># show stacked table</span></span>
<span id="cb320-32"><a href="multi-dimensional-data-structures.html#cb320-32" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df_all_files[<span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">601</span>,<span class="dv">50</span>),<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc_wide</span>()</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:875px; ">
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
fileid
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
filename
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
folder_lvl1
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
folder_lvl2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
statesid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
EjV
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000_A0
</td>
<td style="text-align:left;">
cev-2000
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-28.8586860
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000_A0
</td>
<td style="text-align:left;">
cev-2000
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
51
</td>
<td style="text-align:right;">
-0.2106603
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000_A6840
</td>
<td style="text-align:left;">
cev-2000
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
-28.8586860
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000_A6840
</td>
<td style="text-align:left;">
cev-2000
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
53
</td>
<td style="text-align:right;">
-0.0642997
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947_A0
</td>
<td style="text-align:left;">
cev-947
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
-5.8826609
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947_A0
</td>
<td style="text-align:left;">
cev-947
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
55
</td>
<td style="text-align:right;">
0.0353187
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947_A6840
</td>
<td style="text-align:left;">
cev-947
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
-2.7046907
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947_A6840
</td>
<td style="text-align:left;">
cev-947
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
57
</td>
<td style="text-align:right;">
0.1094474
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000_A0
</td>
<td style="text-align:left;">
cev2000
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
-2.9782236
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000_A0
</td>
<td style="text-align:left;">
cev2000
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
59
</td>
<td style="text-align:right;">
0.3389275
</td>
</tr>
<tr>
<td style="text-align:left;">
6
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000_A6840
</td>
<td style="text-align:left;">
cev2000
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
-1.7229647
</td>
</tr>
<tr>
<td style="text-align:left;">
6
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000_A6840
</td>
<td style="text-align:left;">
cev2000
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
61
</td>
<td style="text-align:right;">
-14.6880377
</td>
</tr>
<tr>
<td style="text-align:left;">
7
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c14_cev947_A0
</td>
<td style="text-align:left;">
cev947
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
-1.7623279
</td>
</tr>
</tbody>
</table>
</div>
<p>Fifth, get additional information from the file name and file folder. Extract those as separate variables. The file names is dash connected, with various information. First, split just the final element of the string file name out, which is <em>A###</em>. Then, also extract the number next to N as a separate numeric column. Additional <em>folder_lvl1</em> separate out the numeric number from the initial word <em>cev</em>.</p>
<p><a href="https://stackoverflow.com/a/50518154/8280804">Split “solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000_A###” to “solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000” and “A###”</a>:</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="multi-dimensional-data-structures.html#cb321-1" aria-hidden="true" tabindex="-1"></a><span class="co"># separate last eleemtnafter underscore</span></span>
<span id="cb321-2"><a href="multi-dimensional-data-structures.html#cb321-2" aria-hidden="true" tabindex="-1"></a>df_all_files_finalA <span class="ot">&lt;-</span> df_all_files <span class="sc">%&gt;%</span></span>
<span id="cb321-3"><a href="multi-dimensional-data-structures.html#cb321-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">separate</span>(filename, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;filename_main&quot;</span>, <span class="st">&quot;prod_type_st&quot;</span>),</span>
<span id="cb321-4"><a href="multi-dimensional-data-structures.html#cb321-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep=</span><span class="st">&quot;_(?=[^_]+$)&quot;</span>,</span>
<span id="cb321-5"><a href="multi-dimensional-data-structures.html#cb321-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb321-6"><a href="multi-dimensional-data-structures.html#cb321-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(fileid, filename, filename_main, prod_type_st, folder_lvl1, folder_lvl2,</span>
<span id="cb321-7"><a href="multi-dimensional-data-structures.html#cb321-7" aria-hidden="true" tabindex="-1"></a>          statesid, <span class="fu">everything</span>())</span>
<span id="cb321-8"><a href="multi-dimensional-data-structures.html#cb321-8" aria-hidden="true" tabindex="-1"></a><span class="co"># show stacked table</span></span>
<span id="cb321-9"><a href="multi-dimensional-data-structures.html#cb321-9" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df_all_files_finalA[<span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">601</span>,<span class="dv">50</span>),<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc_wide</span>()</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:875px; ">
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
fileid
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
filename
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
filename_main
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
prod_type_st
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
folder_lvl1
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
folder_lvl2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
statesid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
EjV
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
k_tt
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
b_tt
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000_A0
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:left;">
cev-2000
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-28.8586860
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0.000000
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000_A0
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:left;">
cev-2000
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
51
</td>
<td style="text-align:right;">
-0.2106603
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
78.005300
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000_A6840
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000
</td>
<td style="text-align:left;">
A6840
</td>
<td style="text-align:left;">
cev-2000
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
-28.8586860
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0.000000
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000_A6840
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000
</td>
<td style="text-align:left;">
A6840
</td>
<td style="text-align:left;">
cev-2000
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
53
</td>
<td style="text-align:right;">
-0.0642997
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
84.215368
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947_A0
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:left;">
cev-947
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
-5.8826609
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
3.869909
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947_A0
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:left;">
cev-947
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
55
</td>
<td style="text-align:right;">
0.0353187
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
90.611739
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947_A6840
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947
</td>
<td style="text-align:left;">
A6840
</td>
<td style="text-align:left;">
cev-947
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
-2.7046907
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
7.855916
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947_A6840
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947
</td>
<td style="text-align:left;">
A6840
</td>
<td style="text-align:left;">
cev-947
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
57
</td>
<td style="text-align:right;">
0.1094474
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
90.611739
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000_A0
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:left;">
cev2000
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
-2.9782236
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
7.855916
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000_A0
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:left;">
cev2000
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
59
</td>
<td style="text-align:right;">
0.3389275
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
97.200000
</td>
</tr>
<tr>
<td style="text-align:left;">
6
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000_A6840
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000
</td>
<td style="text-align:left;">
A6840
</td>
<td style="text-align:left;">
cev2000
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
-1.7229647
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
11.961502
</td>
</tr>
<tr>
<td style="text-align:left;">
6
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000_A6840
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000
</td>
<td style="text-align:left;">
A6840
</td>
<td style="text-align:left;">
cev2000
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
61
</td>
<td style="text-align:right;">
-14.6880377
</td>
<td style="text-align:right;">
1.990694
</td>
<td style="text-align:right;">
-1.879215
</td>
</tr>
<tr>
<td style="text-align:left;">
7
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c14_cev947_A0
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c14_cev947
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:left;">
cev947
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
-1.7623279
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
16.190257
</td>
</tr>
</tbody>
</table>
</div>
<p><a href="https://stackoverflow.com/a/47673097/8280804">Split “A###” to “A” and “A###”</a>. Additionally, also split <em>cev####</em> to <em>cev</em> and <em>####</em>, allow for positive and negative numbers. <a href="https://regex101.com">See regular expression 101 helper</a></p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="multi-dimensional-data-structures.html#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="co"># string and number separation</span></span>
<span id="cb322-2"><a href="multi-dimensional-data-structures.html#cb322-2" aria-hidden="true" tabindex="-1"></a>df_all_files_finalB <span class="ot">&lt;-</span> df_all_files_finalA <span class="sc">%&gt;%</span></span>
<span id="cb322-3"><a href="multi-dimensional-data-structures.html#cb322-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(prod_type_st,</span>
<span id="cb322-4"><a href="multi-dimensional-data-structures.html#cb322-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;prod_type_st_prefix&quot;</span>, <span class="st">&quot;prod_type_lvl&quot;</span>),</span>
<span id="cb322-5"><a href="multi-dimensional-data-structures.html#cb322-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep=</span><span class="st">&quot;(?&lt;=[A-Za-z])(?=[-0-9])&quot;</span>, <span class="co"># positive or negative numbers</span></span>
<span id="cb322-6"><a href="multi-dimensional-data-structures.html#cb322-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">remove=</span><span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb322-7"><a href="multi-dimensional-data-structures.html#cb322-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(folder_lvl1,</span>
<span id="cb322-8"><a href="multi-dimensional-data-structures.html#cb322-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;cev_prefix&quot;</span>, <span class="st">&quot;cev_lvl&quot;</span>),</span>
<span id="cb322-9"><a href="multi-dimensional-data-structures.html#cb322-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep=</span><span class="st">&quot;(?&lt;=[A-Za-z])(?=[-0-9])&quot;</span>, <span class="co"># positive or negative numbers</span></span>
<span id="cb322-10"><a href="multi-dimensional-data-structures.html#cb322-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">remove=</span><span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb322-11"><a href="multi-dimensional-data-structures.html#cb322-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cev_st =</span> folder_lvl1,</span>
<span id="cb322-12"><a href="multi-dimensional-data-structures.html#cb322-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">prod_type_lvl =</span> <span class="fu">as.numeric</span>(prod_type_lvl),</span>
<span id="cb322-13"><a href="multi-dimensional-data-structures.html#cb322-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">cev_lvl =</span> <span class="fu">as.numeric</span>(cev_lvl)<span class="sc">/</span><span class="dv">10000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb322-14"><a href="multi-dimensional-data-structures.html#cb322-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(fileid,</span>
<span id="cb322-15"><a href="multi-dimensional-data-structures.html#cb322-15" aria-hidden="true" tabindex="-1"></a>         prod_type_st, prod_type_lvl,</span>
<span id="cb322-16"><a href="multi-dimensional-data-structures.html#cb322-16" aria-hidden="true" tabindex="-1"></a>         cev_st, cev_lvl,</span>
<span id="cb322-17"><a href="multi-dimensional-data-structures.html#cb322-17" aria-hidden="true" tabindex="-1"></a>         statesid, EjV,</span>
<span id="cb322-18"><a href="multi-dimensional-data-structures.html#cb322-18" aria-hidden="true" tabindex="-1"></a>         filename, folder_lvl1, folder_lvl2)</span>
<span id="cb322-19"><a href="multi-dimensional-data-structures.html#cb322-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Ordering, sort by cev_lvl, then prod_type_lvl, then stateid</span></span>
<span id="cb322-20"><a href="multi-dimensional-data-structures.html#cb322-20" aria-hidden="true" tabindex="-1"></a>df_all_files_finalB <span class="ot">&lt;-</span> df_all_files_finalB <span class="sc">%&gt;%</span></span>
<span id="cb322-21"><a href="multi-dimensional-data-structures.html#cb322-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(cev_lvl, prod_type_lvl, statesid)</span>
<span id="cb322-22"><a href="multi-dimensional-data-structures.html#cb322-22" aria-hidden="true" tabindex="-1"></a><span class="co"># show stacked table</span></span>
<span id="cb322-23"><a href="multi-dimensional-data-structures.html#cb322-23" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df_all_files_finalB[<span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">49</span><span class="sc">*</span><span class="dv">16</span>,<span class="dv">49</span>),<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>]) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc_wide</span>()</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:875px; ">
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
fileid
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
prod_type_st
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
prod_type_lvl
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
cev_st
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
cev_lvl
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
statesid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
EjV
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
cev-2000
</td>
<td style="text-align:right;">
-0.2000
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-28.8586860
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
cev-2000
</td>
<td style="text-align:right;">
-0.2000
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
-0.2106603
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
A6840
</td>
<td style="text-align:right;">
6840
</td>
<td style="text-align:left;">
cev-2000
</td>
<td style="text-align:right;">
-0.2000
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-28.8586860
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
A6840
</td>
<td style="text-align:right;">
6840
</td>
<td style="text-align:left;">
cev-2000
</td>
<td style="text-align:right;">
-0.2000
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
-0.1311749
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
cev-947
</td>
<td style="text-align:right;">
-0.0947
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-28.0399281
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
cev-947
</td>
<td style="text-align:right;">
-0.0947
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
-0.0911499
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
A6840
</td>
<td style="text-align:right;">
6840
</td>
<td style="text-align:left;">
cev-947
</td>
<td style="text-align:right;">
-0.0947
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-28.0399281
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
A6840
</td>
<td style="text-align:right;">
6840
</td>
<td style="text-align:left;">
cev-947
</td>
<td style="text-align:right;">
-0.0947
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
-0.0134719
</td>
</tr>
<tr>
<td style="text-align:left;">
7
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
cev947
</td>
<td style="text-align:right;">
0.0947
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-26.8243673
</td>
</tr>
<tr>
<td style="text-align:left;">
7
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
cev947
</td>
<td style="text-align:right;">
0.0947
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.0857474
</td>
</tr>
<tr>
<td style="text-align:left;">
8
</td>
<td style="text-align:left;">
A6840
</td>
<td style="text-align:right;">
6840
</td>
<td style="text-align:left;">
cev947
</td>
<td style="text-align:right;">
0.0947
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-26.8243673
</td>
</tr>
<tr>
<td style="text-align:left;">
8
</td>
<td style="text-align:left;">
A6840
</td>
<td style="text-align:right;">
6840
</td>
<td style="text-align:left;">
cev947
</td>
<td style="text-align:right;">
0.0947
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.1608382
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
cev2000
</td>
<td style="text-align:right;">
0.2000
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-26.2512036
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
cev2000
</td>
<td style="text-align:right;">
0.2000
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.1694524
</td>
</tr>
<tr>
<td style="text-align:left;">
6
</td>
<td style="text-align:left;">
A6840
</td>
<td style="text-align:right;">
6840
</td>
<td style="text-align:left;">
cev2000
</td>
<td style="text-align:right;">
0.2000
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-26.2512036
</td>
</tr>
<tr>
<td style="text-align:left;">
6
</td>
<td style="text-align:left;">
A6840
</td>
<td style="text-align:right;">
6840
</td>
<td style="text-align:left;">
cev2000
</td>
<td style="text-align:right;">
0.2000
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.2432677
</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
</div>
<div id="wide-and-long" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Wide and Long</h2>

<div id="long-to-wide" class="section level3" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Long to Wide</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R Code Examples</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository (<a href="https://fanwangecon.github.io/Stat4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<p>Using the <a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a> function in tidyr to reshape panel or other data structures</p>
<div id="panel-long-attendance-roster-to-wide" class="section level4" number="4.2.1.1">
<h4><span class="header-section-number">4.2.1.1</span> Panel Long Attendance Roster to Wide</h4>
<p>There are <span class="math inline">\(N\)</span> students in class, but only a subset of them attend class each day. If student <span class="math inline">\(id_i\)</span> is in class on day <span class="math inline">\(Q\)</span>, the teacher records on a sheet the date and the student ID. So if the student has been in class 10 times, the teacher has ten rows of recorded data for the student with two columns: column one is the student ID, and column two is the date on which the student was in class. Suppose there were 50 students, who on average attended exactly 10 classes each during the semester, this means we have <span class="math inline">\(10 \cdot 50\)</span> rows of data, with differing numbers of rows for each student. This is shown as <em>df_panel_attend_date</em> generated below.</p>
<p>Now we want to generate a new dataframe, where each row is a date, and each column is a student. The values in the new dataframe shows, at the <span class="math inline">\(Q^{th}\)</span> day, how many classes student <span class="math inline">\(i\)</span> has attended so far. The following results is also in a REconTools Function. This is shown as <em>df_attend_cumu_by_day</em> generated below.</p>
<p><strong>First</strong>, generate the raw data structure, <em>df_panel_attend_date</em>:</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="multi-dimensional-data-structures.html#cb323-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define</span></span>
<span id="cb323-2"><a href="multi-dimensional-data-structures.html#cb323-2" aria-hidden="true" tabindex="-1"></a>it_N <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb323-3"><a href="multi-dimensional-data-structures.html#cb323-3" aria-hidden="true" tabindex="-1"></a>it_M <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb323-4"><a href="multi-dimensional-data-structures.html#cb323-4" aria-hidden="true" tabindex="-1"></a>svr_id <span class="ot">&lt;-</span> <span class="st">&#39;student_id&#39;</span></span>
<span id="cb323-5"><a href="multi-dimensional-data-structures.html#cb323-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-6"><a href="multi-dimensional-data-structures.html#cb323-6" aria-hidden="true" tabindex="-1"></a><span class="co"># from : support/rand/fs_rand_draws.Rmd</span></span>
<span id="cb323-7"><a href="multi-dimensional-data-structures.html#cb323-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">222</span>)</span>
<span id="cb323-8"><a href="multi-dimensional-data-structures.html#cb323-8" aria-hidden="true" tabindex="-1"></a>df_panel_attend_date <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">matrix</span>(it_M, <span class="at">nrow=</span>it_N, <span class="at">ncol=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb323-9"><a href="multi-dimensional-data-structures.html#cb323-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="at">var =</span> svr_id) <span class="sc">%&gt;%</span></span>
<span id="cb323-10"><a href="multi-dimensional-data-structures.html#cb323-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">uncount</span>(V1) <span class="sc">%&gt;%</span></span>
<span id="cb323-11"><a href="multi-dimensional-data-structures.html#cb323-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_id)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb323-12"><a href="multi-dimensional-data-structures.html#cb323-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">in_class =</span> <span class="fu">case_when</span>(<span class="fu">rnorm</span>(<span class="fu">n</span>(),<span class="at">mean=</span><span class="dv">0</span>,<span class="at">sd=</span><span class="dv">1</span>) <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">1</span>, <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb323-13"><a href="multi-dimensional-data-structures.html#cb323-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(in_class <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_id), date) <span class="sc">%&gt;%</span></span>
<span id="cb323-14"><a href="multi-dimensional-data-structures.html#cb323-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">date_in_class =</span> date)</span>
<span id="cb323-15"><a href="multi-dimensional-data-structures.html#cb323-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-16"><a href="multi-dimensional-data-structures.html#cb323-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb323-17"><a href="multi-dimensional-data-structures.html#cb323-17" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df_panel_attend_date) <span class="sc">%&gt;%</span></span>
<span id="cb323-18"><a href="multi-dimensional-data-structures.html#cb323-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
student_id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date_in_class
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5
</td>
</tr>
</tbody>
</table>
<p><strong>Second</strong>, generate wider data structure, <em>df_attend_cumu_by_day</em>:</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="multi-dimensional-data-structures.html#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define</span></span>
<span id="cb324-2"><a href="multi-dimensional-data-structures.html#cb324-2" aria-hidden="true" tabindex="-1"></a>svr_id <span class="ot">&lt;-</span> <span class="st">&#39;student_id&#39;</span></span>
<span id="cb324-3"><a href="multi-dimensional-data-structures.html#cb324-3" aria-hidden="true" tabindex="-1"></a>svr_date <span class="ot">&lt;-</span> <span class="st">&#39;date_in_class&#39;</span></span>
<span id="cb324-4"><a href="multi-dimensional-data-structures.html#cb324-4" aria-hidden="true" tabindex="-1"></a>st_idcol_prefix <span class="ot">&lt;-</span> <span class="st">&#39;sid_&#39;</span></span>
<span id="cb324-5"><a href="multi-dimensional-data-structures.html#cb324-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb324-6"><a href="multi-dimensional-data-structures.html#cb324-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate cumulative enrollment counts by date</span></span>
<span id="cb324-7"><a href="multi-dimensional-data-structures.html#cb324-7" aria-hidden="true" tabindex="-1"></a>df_panel_attend_date_addone <span class="ot">&lt;-</span> df_panel_attend_date <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">attended =</span> <span class="dv">1</span>)</span>
<span id="cb324-8"><a href="multi-dimensional-data-structures.html#cb324-8" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df_panel_attend_date_addone) <span class="sc">%&gt;%</span></span>
<span id="cb324-9"><a href="multi-dimensional-data-structures.html#cb324-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
student_id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date_in_class
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
attended
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="multi-dimensional-data-structures.html#cb325-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot Wide</span></span>
<span id="cb325-2"><a href="multi-dimensional-data-structures.html#cb325-2" aria-hidden="true" tabindex="-1"></a>df_panel_attend_date_wider <span class="ot">&lt;-</span> df_panel_attend_date_addone <span class="sc">%&gt;%</span></span>
<span id="cb325-3"><a href="multi-dimensional-data-structures.html#cb325-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> svr_id,</span>
<span id="cb325-4"><a href="multi-dimensional-data-structures.html#cb325-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> attended)</span>
<span id="cb325-5"><a href="multi-dimensional-data-structures.html#cb325-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df_panel_attend_date_wider) <span class="sc">%&gt;%</span></span>
<span id="cb325-6"><a href="multi-dimensional-data-structures.html#cb325-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date_in_class
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
3
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="multi-dimensional-data-structures.html#cb326-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort and rename</span></span>
<span id="cb326-2"><a href="multi-dimensional-data-structures.html#cb326-2" aria-hidden="true" tabindex="-1"></a><span class="co"># rename see: https://fanwangecon.github.io/R4Econ/amto/tibble/fs_tib_basics.html</span></span>
<span id="cb326-3"><a href="multi-dimensional-data-structures.html#cb326-3" aria-hidden="true" tabindex="-1"></a>ar_unique_ids <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(df_panel_attend_date <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_id))))</span>
<span id="cb326-4"><a href="multi-dimensional-data-structures.html#cb326-4" aria-hidden="true" tabindex="-1"></a>df_panel_attend_date_wider_sort <span class="ot">&lt;-</span> df_panel_attend_date_wider <span class="sc">%&gt;%</span></span>
<span id="cb326-5"><a href="multi-dimensional-data-structures.html#cb326-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_date)) <span class="sc">%&gt;%</span></span>
<span id="cb326-6"><a href="multi-dimensional-data-structures.html#cb326-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename_at</span>(<span class="fu">vars</span>(<span class="fu">num_range</span>(<span class="st">&#39;&#39;</span>,ar_unique_ids))</span>
<span id="cb326-7"><a href="multi-dimensional-data-structures.html#cb326-7" aria-hidden="true" tabindex="-1"></a>              , <span class="fu">list</span>(<span class="sc">~</span><span class="fu">paste0</span>(st_idcol_prefix, . , <span class="st">&#39;&#39;</span>))</span>
<span id="cb326-8"><a href="multi-dimensional-data-structures.html#cb326-8" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb326-9"><a href="multi-dimensional-data-structures.html#cb326-9" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df_panel_attend_date_wider_sort) <span class="sc">%&gt;%</span></span>
<span id="cb326-10"><a href="multi-dimensional-data-structures.html#cb326-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date_in_class
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid_1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid_2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid_3
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="multi-dimensional-data-structures.html#cb327-1" aria-hidden="true" tabindex="-1"></a><span class="co"># replace NA and cumusum again</span></span>
<span id="cb327-2"><a href="multi-dimensional-data-structures.html#cb327-2" aria-hidden="true" tabindex="-1"></a><span class="co"># see: R4Econ/support/function/fs_func_multivar for renaming and replacing</span></span>
<span id="cb327-3"><a href="multi-dimensional-data-structures.html#cb327-3" aria-hidden="true" tabindex="-1"></a>df_attend_cumu_by_day <span class="ot">&lt;-</span> df_panel_attend_date_wider_sort <span class="sc">%&gt;%</span></span>
<span id="cb327-4"><a href="multi-dimensional-data-structures.html#cb327-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="fu">contains</span>(st_idcol_prefix)), <span class="fu">list</span>(<span class="sc">~</span><span class="fu">replace_na</span>(., <span class="dv">0</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb327-5"><a href="multi-dimensional-data-structures.html#cb327-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="fu">contains</span>(st_idcol_prefix)), <span class="fu">list</span>(<span class="sc">~</span><span class="fu">cumsum</span>(.)))</span>
<span id="cb327-6"><a href="multi-dimensional-data-structures.html#cb327-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb327-7"><a href="multi-dimensional-data-structures.html#cb327-7" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df_attend_cumu_by_day) <span class="sc">%&gt;%</span></span>
<span id="cb327-8"><a href="multi-dimensional-data-structures.html#cb327-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date_in_class
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid_1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid_2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid_3
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
</tbody>
</table>
<p>The structure above is also a function in Fan’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, here the function is tested:</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="multi-dimensional-data-structures.html#cb328-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters</span></span>
<span id="cb328-2"><a href="multi-dimensional-data-structures.html#cb328-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df_panel_attend_date</span>
<span id="cb328-3"><a href="multi-dimensional-data-structures.html#cb328-3" aria-hidden="true" tabindex="-1"></a>svr_id_i <span class="ot">&lt;-</span> <span class="st">&#39;student_id&#39;</span></span>
<span id="cb328-4"><a href="multi-dimensional-data-structures.html#cb328-4" aria-hidden="true" tabindex="-1"></a>svr_id_t <span class="ot">&lt;-</span> <span class="st">&#39;date_in_class&#39;</span></span>
<span id="cb328-5"><a href="multi-dimensional-data-structures.html#cb328-5" aria-hidden="true" tabindex="-1"></a>st_idcol_prefix <span class="ot">&lt;-</span> <span class="st">&#39;sid_&#39;</span></span>
<span id="cb328-6"><a href="multi-dimensional-data-structures.html#cb328-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb328-7"><a href="multi-dimensional-data-structures.html#cb328-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Invoke Function</span></span>
<span id="cb328-8"><a href="multi-dimensional-data-structures.html#cb328-8" aria-hidden="true" tabindex="-1"></a>ls_df_rosterwide <span class="ot">&lt;-</span> <span class="fu">ff_panel_expand_longrosterwide</span>(df, svr_id_t, svr_id_i, st_idcol_prefix)</span>
<span id="cb328-9"><a href="multi-dimensional-data-structures.html#cb328-9" aria-hidden="true" tabindex="-1"></a>df_roster_wide_func <span class="ot">&lt;-</span> ls_df_rosterwide<span class="sc">$</span>df_roster_wide</span>
<span id="cb328-10"><a href="multi-dimensional-data-structures.html#cb328-10" aria-hidden="true" tabindex="-1"></a>df_roster_wide_cumu_func <span class="ot">&lt;-</span> ls_df_rosterwide<span class="sc">$</span>df_roster_wide_cumu</span>
<span id="cb328-11"><a href="multi-dimensional-data-structures.html#cb328-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb328-12"><a href="multi-dimensional-data-structures.html#cb328-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb328-13"><a href="multi-dimensional-data-structures.html#cb328-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df_roster_wide_func)</span>
<span id="cb328-14"><a href="multi-dimensional-data-structures.html#cb328-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df_roster_wide_cumu_func)</span></code></pre></div>

</div>
</div>
<div id="wide-to-long" class="section level3" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Wide to Long</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R Code Examples</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository (<a href="https://fanwangecon.github.io/Stat4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<p>Using the <a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a> function in tidyr to reshape panel or other data structures</p>
<div id="generated-matrix-by-states-to-long-table" class="section level4" number="4.2.2.1">
<h4><span class="header-section-number">4.2.2.1</span> Generated Matrix by States to Long Table</h4>
<p>A matrix of ev given states, rows are states and cols are shocks. Convert to Long table with shock and state values and ev.</p>
<p>Generated Matrix by States to Long Table where state values are stored as variables, with correct value labels for states:</p>
<ol style="list-style-type: decimal">
<li>Generate a matrix</li>
<li>Convert matrix to tibble</li>
<li>Tibble make longer, and store column and row id var names</li>
</ol>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="multi-dimensional-data-structures.html#cb329-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate A Matrix</span></span>
<span id="cb329-2"><a href="multi-dimensional-data-structures.html#cb329-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb329-3"><a href="multi-dimensional-data-structures.html#cb329-3" aria-hidden="true" tabindex="-1"></a>ar_a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">1.1</span>,<span class="fl">5.1</span>)</span>
<span id="cb329-4"><a href="multi-dimensional-data-structures.html#cb329-4" aria-hidden="true" tabindex="-1"></a>ar_z <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.5</span>, <span class="fl">2.53</span>, <span class="at">length.out=</span><span class="dv">11</span>)</span>
<span id="cb329-5"><a href="multi-dimensional-data-structures.html#cb329-5" aria-hidden="true" tabindex="-1"></a>mt_ev <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(ar_a<span class="sc">*</span>ar_z), <span class="at">nrow=</span><span class="fu">length</span>(ar_a), <span class="at">ncol=</span><span class="fu">length</span>(ar_z))</span>
<span id="cb329-6"><a href="multi-dimensional-data-structures.html#cb329-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-7"><a href="multi-dimensional-data-structures.html#cb329-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Name Matrix</span></span>
<span id="cb329-8"><a href="multi-dimensional-data-structures.html#cb329-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(mt_ev) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;ai&#39;</span>, <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ar_a)))</span>
<span id="cb329-9"><a href="multi-dimensional-data-structures.html#cb329-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mt_ev) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;zi&#39;</span>, <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ar_z)))</span>
<span id="cb329-10"><a href="multi-dimensional-data-structures.html#cb329-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-11"><a href="multi-dimensional-data-structures.html#cb329-11" aria-hidden="true" tabindex="-1"></a><span class="co"># to tibble</span></span>
<span id="cb329-12"><a href="multi-dimensional-data-structures.html#cb329-12" aria-hidden="true" tabindex="-1"></a>tb_ev <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(mt_ev) <span class="sc">%&gt;%</span> <span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">&quot;ai&quot;</span>)</span>
<span id="cb329-13"><a href="multi-dimensional-data-structures.html#cb329-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-14"><a href="multi-dimensional-data-structures.html#cb329-14" aria-hidden="true" tabindex="-1"></a><span class="co"># longer</span></span>
<span id="cb329-15"><a href="multi-dimensional-data-structures.html#cb329-15" aria-hidden="true" tabindex="-1"></a>tb_ev_long <span class="ot">&lt;-</span> tb_ev <span class="sc">%&gt;%</span></span>
<span id="cb329-16"><a href="multi-dimensional-data-structures.html#cb329-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&#39;zi&#39;</span>),</span>
<span id="cb329-17"><a href="multi-dimensional-data-structures.html#cb329-17" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&#39;zi&#39;</span>),</span>
<span id="cb329-18"><a href="multi-dimensional-data-structures.html#cb329-18" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_pattern =</span> <span class="fu">paste0</span>(<span class="st">&quot;zi(.*)&quot;</span>),</span>
<span id="cb329-19"><a href="multi-dimensional-data-structures.html#cb329-19" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;ev&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb329-20"><a href="multi-dimensional-data-structures.html#cb329-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">zi =</span> <span class="fu">as.numeric</span>(zi))</span>
<span id="cb329-21"><a href="multi-dimensional-data-structures.html#cb329-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-22"><a href="multi-dimensional-data-structures.html#cb329-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with a and z values</span></span>
<span id="cb329-23"><a href="multi-dimensional-data-structures.html#cb329-23" aria-hidden="true" tabindex="-1"></a>tb_ev_long <span class="ot">&lt;-</span> tb_ev_long <span class="sc">%&gt;%</span></span>
<span id="cb329-24"><a href="multi-dimensional-data-structures.html#cb329-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">as_tibble</span>(ar_a) <span class="sc">%&gt;%</span></span>
<span id="cb329-25"><a href="multi-dimensional-data-structures.html#cb329-25" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">&quot;ai&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb329-26"><a href="multi-dimensional-data-structures.html#cb329-26" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rename</span>(<span class="at">a =</span> value)</span>
<span id="cb329-27"><a href="multi-dimensional-data-structures.html#cb329-27" aria-hidden="true" tabindex="-1"></a>              , <span class="at">by =</span> <span class="st">&#39;ai&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb329-28"><a href="multi-dimensional-data-structures.html#cb329-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">as_tibble</span>(ar_z) <span class="sc">%&gt;%</span></span>
<span id="cb329-29"><a href="multi-dimensional-data-structures.html#cb329-29" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">&quot;zi&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb329-30"><a href="multi-dimensional-data-structures.html#cb329-30" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rename</span>(<span class="at">z =</span> value),</span>
<span id="cb329-31"><a href="multi-dimensional-data-structures.html#cb329-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">&#39;zi&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb329-32"><a href="multi-dimensional-data-structures.html#cb329-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(a,ai,z,zi,ev)</span>
<span id="cb329-33"><a href="multi-dimensional-data-structures.html#cb329-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-34"><a href="multi-dimensional-data-structures.html#cb329-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Display</span></span>
<span id="cb329-35"><a href="multi-dimensional-data-structures.html#cb329-35" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(tb_ev) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc_wide</span>()</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:875px; ">
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ai
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi3
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi4
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi5
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi6
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi7
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi8
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi9
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi10
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi11
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-0.5604756
</td>
<td style="text-align:right;">
1.5587083
</td>
<td style="text-align:right;">
0.1292877
</td>
<td style="text-align:right;">
0.4609162
</td>
<td style="text-align:right;">
-0.6868529
</td>
<td style="text-align:right;">
1.2240818
</td>
<td style="text-align:right;">
-0.2301775
</td>
<td style="text-align:right;">
0.0705084
</td>
<td style="text-align:right;">
1.7150650
</td>
<td style="text-align:right;">
-1.2650612
</td>
<td style="text-align:right;">
-0.445662
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-0.2301775
</td>
<td style="text-align:right;">
0.0705084
</td>
<td style="text-align:right;">
1.7150650
</td>
<td style="text-align:right;">
-1.2650612
</td>
<td style="text-align:right;">
-0.4456620
</td>
<td style="text-align:right;">
-0.5604756
</td>
<td style="text-align:right;">
1.5587083
</td>
<td style="text-align:right;">
0.1292877
</td>
<td style="text-align:right;">
0.4609162
</td>
<td style="text-align:right;">
-0.6868529
</td>
<td style="text-align:right;">
1.224082
</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="multi-dimensional-data-structures.html#cb330-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(tb_ev_long) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
a
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ai
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
z
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ev
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-2.500
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-0.5604756
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1.997
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1.5587083
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1.494
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.1292877
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-0.991
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.4609162
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-0.488
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
-0.6868529
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.015
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
1.2240818
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.518
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
-0.2301775
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.021
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0.0705084
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.524
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
1.7150650
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2.027
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
-1.2650612
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2.530
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
-0.4456620
</td>
</tr>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-2.500
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-0.2301775
</td>
</tr>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-1.997
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.0705084
</td>
</tr>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-1.494
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1.7150650
</td>
</tr>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-0.991
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
-1.2650612
</td>
</tr>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-0.488
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
-0.4456620
</td>
</tr>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.015
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
-0.5604756
</td>
</tr>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.518
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
1.5587083
</td>
</tr>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1.021
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0.1292877
</td>
</tr>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1.524
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
0.4609162
</td>
</tr>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2.027
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
-0.6868529
</td>
</tr>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2.530
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
1.2240818
</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="join-and-compare" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Join and Compare</h2>

<div id="find-closest-neighbor-on-grid" class="section level3" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Find Closest Neighbor on Grid</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R Code Examples</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository (<a href="https://fanwangecon.github.io/Stat4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<p>Using the <a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a> function in tidyr to reshape panel or other data structures</p>
<div id="closest-neighbor-on-grid" class="section level4" number="4.3.1.1">
<h4><span class="header-section-number">4.3.1.1</span> Closest Neighbor on Grid</h4>
<p>There is a dataframe that provides <span class="math inline">\(V(coh, a, cev)\)</span> levels. There is another dataframe with <span class="math inline">\(\hat{V}(coh, a)\)</span>, for each <span class="math inline">\(coh, a\)</span>, find the <span class="math inline">\(cev\)</span> that such that the difference between <span class="math inline">\(\hat{V}(coh, a)\)</span> and <span class="math inline">\(V(coh, a, cev)\)</span> is minimized.</p>
<p><span class="math inline">\(V\)</span> and <span class="math inline">\(\hat{V}\)</span> information are stored in a dataframe in the <a href="https://github.com/FanWangEcon/R4Econ/tree/master/panel/join/_file/csv">csv folder</a> in the current directory. In fact, we have one <span class="math inline">\(V\)</span> surface, but multiple <span class="math inline">\(\hat{V}\)</span> files, so we want to do the find closest neighbor exercise for each one of the several <span class="math inline">\(\hat{V}\)</span> files.</p>
<p>The structure is as follows: (1) Load in the <span class="math inline">\(V\)</span> file, where <span class="math inline">\(coh, a, cev\)</span> are all variable attributes. (2) Merge with one <span class="math inline">\(\hat{V}\)</span> file. (3) Take the difference between the <span class="math inline">\(V\)</span> and <span class="math inline">\(\hat{V}\)</span> columns, and take the absolute value of the difference. (4) Group by <span class="math inline">\(coh, a\)</span>, and sort to get the smallest absolute difference among the <span class="math inline">\(cev\)</span> possibilities, and slice out the row for the smallest. (5) Now We have <span class="math inline">\(V(coh, a, cev^{\star}(coh, a))\)</span>. (6) Do this for each of the several <span class="math inline">\(\hat{V}\)</span> files. (7) Stack the results from 1 through 6 together, generate a column that identifies which simulation/exercise/counterfactual each of the <span class="math inline">\(\hat{V}\)</span> file comes from. (8) Visualize by plotting as subplot different <span class="math inline">\(a\)</span>, <span class="math inline">\(coh\)</span> is x-axis, different <span class="math inline">\(\hat{V}\)</span> outcome are different lines, and <span class="math inline">\(cev^{\star}\left(coh, a, \hat{V}\right)\)</span> is the y-axis outcome.</p>
<p>First, load the CEV file.</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="multi-dimensional-data-structures.html#cb331-1" aria-hidden="true" tabindex="-1"></a><span class="co"># folder</span></span>
<span id="cb331-2"><a href="multi-dimensional-data-structures.html#cb331-2" aria-hidden="true" tabindex="-1"></a>spt_root <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;C:/Users/fan/R4Econ/panel/join/_file/csv&#39;</span>)</span>
<span id="cb331-3"><a href="multi-dimensional-data-structures.html#cb331-3" aria-hidden="true" tabindex="-1"></a><span class="co"># cev surface file, the V file</span></span>
<span id="cb331-4"><a href="multi-dimensional-data-structures.html#cb331-4" aria-hidden="true" tabindex="-1"></a>snm_cev_surface <span class="ot">&lt;-</span> <span class="st">&#39;e_19E1NEp99r99_ITG_PE_cev_subsettest.csv&#39;</span></span>
<span id="cb331-5"><a href="multi-dimensional-data-structures.html#cb331-5" aria-hidden="true" tabindex="-1"></a>mt_cev_surface <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="fu">file.path</span>(spt_root, snm_cev_surface))</span>
<span id="cb331-6"><a href="multi-dimensional-data-structures.html#cb331-6" aria-hidden="true" tabindex="-1"></a>tb_cev_surface <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(mt_cev_surface) <span class="sc">%&gt;%</span></span>
<span id="cb331-7"><a href="multi-dimensional-data-structures.html#cb331-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">EjVcev =</span> EjV)</span></code></pre></div>
<p>Second, loop over the V hat files, join V with V hat:</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="multi-dimensional-data-structures.html#cb332-1" aria-hidden="true" tabindex="-1"></a>ls_tb_cev_surfhat <span class="ot">=</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;list&quot;</span>, <span class="at">length =</span> <span class="dv">4</span>)</span>
<span id="cb332-2"><a href="multi-dimensional-data-structures.html#cb332-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (it_simu_counter <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)) {</span>
<span id="cb332-3"><a href="multi-dimensional-data-structures.html#cb332-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-4"><a href="multi-dimensional-data-structures.html#cb332-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># conditionally change file names</span></span>
<span id="cb332-5"><a href="multi-dimensional-data-structures.html#cb332-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (it_simu_counter <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb332-6"><a href="multi-dimensional-data-structures.html#cb332-6" aria-hidden="true" tabindex="-1"></a>        st_counter <span class="ot">&lt;-</span> <span class="st">&#39;19E1NEp99r99&#39;</span></span>
<span id="cb332-7"><a href="multi-dimensional-data-structures.html#cb332-7" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (it_simu_counter <span class="sc">==</span> <span class="dv">2</span>) {</span>
<span id="cb332-8"><a href="multi-dimensional-data-structures.html#cb332-8" aria-hidden="true" tabindex="-1"></a>        st_counter <span class="ot">&lt;-</span> <span class="st">&#39;19E1NEp02r99&#39;</span></span>
<span id="cb332-9"><a href="multi-dimensional-data-structures.html#cb332-9" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (it_simu_counter <span class="sc">==</span> <span class="dv">3</span>) {</span>
<span id="cb332-10"><a href="multi-dimensional-data-structures.html#cb332-10" aria-hidden="true" tabindex="-1"></a>        st_counter <span class="ot">&lt;-</span> <span class="st">&#39;19E1NEp02per02ger99&#39;</span></span>
<span id="cb332-11"><a href="multi-dimensional-data-structures.html#cb332-11" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (it_simu_counter <span class="sc">==</span> <span class="dv">4</span>) {</span>
<span id="cb332-12"><a href="multi-dimensional-data-structures.html#cb332-12" aria-hidden="true" tabindex="-1"></a>        st_counter <span class="ot">&lt;-</span> <span class="st">&#39;19E1NEp02r02&#39;</span></span>
<span id="cb332-13"><a href="multi-dimensional-data-structures.html#cb332-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb332-14"><a href="multi-dimensional-data-structures.html#cb332-14" aria-hidden="true" tabindex="-1"></a>    snm_v_hat <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;e_&#39;</span>, st_counter, <span class="st">&#39;_ITG_PE_subsettest.csv&#39;</span>)</span>
<span id="cb332-15"><a href="multi-dimensional-data-structures.html#cb332-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb332-16"><a href="multi-dimensional-data-structures.html#cb332-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Overall path to files</span></span>
<span id="cb332-17"><a href="multi-dimensional-data-structures.html#cb332-17" aria-hidden="true" tabindex="-1"></a>    mt_v_hat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="fu">file.path</span>(spt_root, snm_v_hat))</span>
<span id="cb332-18"><a href="multi-dimensional-data-structures.html#cb332-18" aria-hidden="true" tabindex="-1"></a>    tb_v_hat <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(mt_v_hat) <span class="sc">%&gt;%</span></span>
<span id="cb332-19"><a href="multi-dimensional-data-structures.html#cb332-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(prod_type_lvl, statesid, EjV)</span>
<span id="cb332-20"><a href="multi-dimensional-data-structures.html#cb332-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb332-21"><a href="multi-dimensional-data-structures.html#cb332-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Merge file using key </span></span>
<span id="cb332-22"><a href="multi-dimensional-data-structures.html#cb332-22" aria-hidden="true" tabindex="-1"></a>    tb_cev_surfhat <span class="ot">&lt;-</span> tb_cev_surface <span class="sc">%&gt;%</span></span>
<span id="cb332-23"><a href="multi-dimensional-data-structures.html#cb332-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(tb_v_hat, <span class="at">by=</span>(<span class="fu">c</span>(<span class="st">&#39;prod_type_lvl&#39;</span><span class="ot">=</span><span class="st">&#39;prod_type_lvl&#39;</span>, </span>
<span id="cb332-24"><a href="multi-dimensional-data-structures.html#cb332-24" aria-hidden="true" tabindex="-1"></a>                                <span class="st">&#39;statesid&#39;</span><span class="ot">=</span><span class="st">&#39;statesid&#39;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb332-25"><a href="multi-dimensional-data-structures.html#cb332-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(statesid, prod_type_lvl, cev_lvl) <span class="sc">%&gt;%</span></span>
<span id="cb332-26"><a href="multi-dimensional-data-structures.html#cb332-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">counter_policy =</span> st_counter)</span>
<span id="cb332-27"><a href="multi-dimensional-data-structures.html#cb332-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb332-28"><a href="multi-dimensional-data-structures.html#cb332-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store to list</span></span>
<span id="cb332-29"><a href="multi-dimensional-data-structures.html#cb332-29" aria-hidden="true" tabindex="-1"></a>    ls_tb_cev_surfhat[[it_simu_counter]] <span class="ot">&lt;-</span> tb_cev_surfhat</span>
<span id="cb332-30"><a href="multi-dimensional-data-structures.html#cb332-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb332-31"><a href="multi-dimensional-data-structures.html#cb332-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-32"><a href="multi-dimensional-data-structures.html#cb332-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Display</span></span>
<span id="cb332-33"><a href="multi-dimensional-data-structures.html#cb332-33" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(ls_tb_cev_surfhat[[<span class="dv">1</span>]][<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">40</span>, <span class="dv">5</span>),]) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc_wide</span>()</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:875px; ">
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
X
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
cev_st
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
cev_lvl
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
prod_type_st
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
prod_type_lvl
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
statesid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
cash_tt
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
EjVcev
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
EjV
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
counter_policy
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
cev-2000
</td>
<td style="text-align:right;">
-0.2000
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
526
</td>
<td style="text-align:right;">
32.84747
</td>
<td style="text-align:right;">
-1.0479929
</td>
<td style="text-align:right;">
-0.7957419
</td>
<td style="text-align:left;">
19E1NEp99r99
</td>
</tr>
<tr>
<td style="text-align:right;">
1501
</td>
<td style="text-align:left;">
cev-947
</td>
<td style="text-align:right;">
-0.0947
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
526
</td>
<td style="text-align:right;">
32.84747
</td>
<td style="text-align:right;">
-0.9079859
</td>
<td style="text-align:right;">
-0.7957419
</td>
<td style="text-align:left;">
19E1NEp99r99
</td>
</tr>
<tr>
<td style="text-align:right;">
3001
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
526
</td>
<td style="text-align:right;">
32.84747
</td>
<td style="text-align:right;">
-0.7880156
</td>
<td style="text-align:right;">
-0.7957419
</td>
<td style="text-align:left;">
19E1NEp99r99
</td>
</tr>
<tr>
<td style="text-align:right;">
4501
</td>
<td style="text-align:left;">
cev1157
</td>
<td style="text-align:right;">
0.1157
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
526
</td>
<td style="text-align:right;">
32.84747
</td>
<td style="text-align:right;">
-0.6803586
</td>
<td style="text-align:right;">
-0.7957419
</td>
<td style="text-align:left;">
19E1NEp99r99
</td>
</tr>
<tr>
<td style="text-align:right;">
51
</td>
<td style="text-align:left;">
cev-2000
</td>
<td style="text-align:right;">
-0.2000
</td>
<td style="text-align:left;">
A2504
</td>
<td style="text-align:right;">
2504
</td>
<td style="text-align:right;">
526
</td>
<td style="text-align:right;">
32.90371
</td>
<td style="text-align:right;">
-1.0002921
</td>
<td style="text-align:right;">
-0.7504785
</td>
<td style="text-align:left;">
19E1NEp99r99
</td>
</tr>
<tr>
<td style="text-align:right;">
1551
</td>
<td style="text-align:left;">
cev-947
</td>
<td style="text-align:right;">
-0.0947
</td>
<td style="text-align:left;">
A2504
</td>
<td style="text-align:right;">
2504
</td>
<td style="text-align:right;">
526
</td>
<td style="text-align:right;">
32.90371
</td>
<td style="text-align:right;">
-0.8613743
</td>
<td style="text-align:right;">
-0.7504785
</td>
<td style="text-align:left;">
19E1NEp99r99
</td>
</tr>
<tr>
<td style="text-align:right;">
3051
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A2504
</td>
<td style="text-align:right;">
2504
</td>
<td style="text-align:right;">
526
</td>
<td style="text-align:right;">
32.90371
</td>
<td style="text-align:right;">
-0.7423281
</td>
<td style="text-align:right;">
-0.7504785
</td>
<td style="text-align:left;">
19E1NEp99r99
</td>
</tr>
<tr>
<td style="text-align:right;">
4551
</td>
<td style="text-align:left;">
cev1157
</td>
<td style="text-align:right;">
0.1157
</td>
<td style="text-align:left;">
A2504
</td>
<td style="text-align:right;">
2504
</td>
<td style="text-align:right;">
526
</td>
<td style="text-align:right;">
32.90371
</td>
<td style="text-align:right;">
-0.6354620
</td>
<td style="text-align:right;">
-0.7504785
</td>
<td style="text-align:left;">
19E1NEp99r99
</td>
</tr>
</tbody>
</table>
</div>
<p>Third, sort each file, and keep only the best match rows that minimize the absolute distance between <em>EjV</em> and <em>EjVcev</em>.</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="multi-dimensional-data-structures.html#cb333-1" aria-hidden="true" tabindex="-1"></a>ls_tb_cev_matched <span class="ot">=</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;list&quot;</span>, <span class="at">length =</span> <span class="dv">4</span>)</span>
<span id="cb333-2"><a href="multi-dimensional-data-structures.html#cb333-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (it_simu_counter <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)) {</span>
<span id="cb333-3"><a href="multi-dimensional-data-structures.html#cb333-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb333-4"><a href="multi-dimensional-data-structures.html#cb333-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load merged file</span></span>
<span id="cb333-5"><a href="multi-dimensional-data-structures.html#cb333-5" aria-hidden="true" tabindex="-1"></a>    tb_cev_surfhat <span class="ot">&lt;-</span> ls_tb_cev_surfhat[[it_simu_counter]]</span>
<span id="cb333-6"><a href="multi-dimensional-data-structures.html#cb333-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb333-7"><a href="multi-dimensional-data-structures.html#cb333-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Difference Column</span></span>
<span id="cb333-8"><a href="multi-dimensional-data-structures.html#cb333-8" aria-hidden="true" tabindex="-1"></a>    tb_cev_surfhat <span class="ot">&lt;-</span> tb_cev_surfhat <span class="sc">%&gt;%</span> </span>
<span id="cb333-9"><a href="multi-dimensional-data-structures.html#cb333-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">EjVcev_gap =</span> <span class="fu">abs</span>(EjVcev <span class="sc">-</span> EjV))</span>
<span id="cb333-10"><a href="multi-dimensional-data-structures.html#cb333-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb333-11"><a href="multi-dimensional-data-structures.html#cb333-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group by, Arrange and Slice, get lowest gap</span></span>
<span id="cb333-12"><a href="multi-dimensional-data-structures.html#cb333-12" aria-hidden="true" tabindex="-1"></a>    tb_cev_matched <span class="ot">&lt;-</span> tb_cev_surfhat <span class="sc">%&gt;%</span> </span>
<span id="cb333-13"><a href="multi-dimensional-data-structures.html#cb333-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(statesid, prod_type_lvl, EjVcev_gap) <span class="sc">%&gt;%</span></span>
<span id="cb333-14"><a href="multi-dimensional-data-structures.html#cb333-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(statesid, prod_type_lvl) <span class="sc">%&gt;%</span></span>
<span id="cb333-15"><a href="multi-dimensional-data-structures.html#cb333-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice_head</span>(<span class="at">n=</span><span class="dv">1</span>)</span>
<span id="cb333-16"><a href="multi-dimensional-data-structures.html#cb333-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb333-17"><a href="multi-dimensional-data-structures.html#cb333-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store to list</span></span>
<span id="cb333-18"><a href="multi-dimensional-data-structures.html#cb333-18" aria-hidden="true" tabindex="-1"></a>    ls_tb_cev_matched[[it_simu_counter]] <span class="ot">&lt;-</span> tb_cev_matched</span>
<span id="cb333-19"><a href="multi-dimensional-data-structures.html#cb333-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb333-20"><a href="multi-dimensional-data-structures.html#cb333-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb333-21"><a href="multi-dimensional-data-structures.html#cb333-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Display</span></span>
<span id="cb333-22"><a href="multi-dimensional-data-structures.html#cb333-22" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(ls_tb_cev_matched[[<span class="dv">2</span>]][<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">30</span>, <span class="dv">1</span>),]) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc_wide</span>()</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:875px; ">
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
X
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
cev_st
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
cev_lvl
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
prod_type_st
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
prod_type_lvl
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
statesid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
cash_tt
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
EjVcev
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
EjV
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
counter_policy
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
EjVcev_gap
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
3001
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
526
</td>
<td style="text-align:right;">
32.847471
</td>
<td style="text-align:right;">
-0.7880156
</td>
<td style="text-align:right;">
-0.7928034
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0047878
</td>
</tr>
<tr>
<td style="text-align:right;">
3051
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A2504
</td>
<td style="text-align:right;">
2504
</td>
<td style="text-align:right;">
526
</td>
<td style="text-align:right;">
32.903714
</td>
<td style="text-align:right;">
-0.7423281
</td>
<td style="text-align:right;">
-0.7480617
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0057336
</td>
</tr>
<tr>
<td style="text-align:right;">
3101
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A4145
</td>
<td style="text-align:right;">
4145
</td>
<td style="text-align:right;">
526
</td>
<td style="text-align:right;">
32.948970
</td>
<td style="text-align:right;">
-0.7082006
</td>
<td style="text-align:right;">
-0.7145418
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0063412
</td>
</tr>
<tr>
<td style="text-align:right;">
3151
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A5633
</td>
<td style="text-align:right;">
5633
</td>
<td style="text-align:right;">
526
</td>
<td style="text-align:right;">
32.996952
</td>
<td style="text-align:right;">
-0.6753576
</td>
<td style="text-align:right;">
-0.6818996
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0065420
</td>
</tr>
<tr>
<td style="text-align:right;">
3201
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A7274
</td>
<td style="text-align:right;">
7274
</td>
<td style="text-align:right;">
526
</td>
<td style="text-align:right;">
33.058832
</td>
<td style="text-align:right;">
-0.6368297
</td>
<td style="text-align:right;">
-0.6431710
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0063413
</td>
</tr>
<tr>
<td style="text-align:right;">
3251
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A9779
</td>
<td style="text-align:right;">
9779
</td>
<td style="text-align:right;">
526
</td>
<td style="text-align:right;">
33.175241
</td>
<td style="text-align:right;">
-0.5711706
</td>
<td style="text-align:right;">
-0.5774648
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0062942
</td>
</tr>
<tr>
<td style="text-align:right;">
3002
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
555
</td>
<td style="text-align:right;">
53.346587
</td>
<td style="text-align:right;">
-0.2985944
</td>
<td style="text-align:right;">
-0.3041922
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0055978
</td>
</tr>
<tr>
<td style="text-align:right;">
3052
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A2504
</td>
<td style="text-align:right;">
2504
</td>
<td style="text-align:right;">
555
</td>
<td style="text-align:right;">
53.815772
</td>
<td style="text-align:right;">
-0.2617572
</td>
<td style="text-align:right;">
-0.2680026
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0062454
</td>
</tr>
<tr>
<td style="text-align:right;">
3102
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A4145
</td>
<td style="text-align:right;">
4145
</td>
<td style="text-align:right;">
555
</td>
<td style="text-align:right;">
54.193302
</td>
<td style="text-align:right;">
-0.2340822
</td>
<td style="text-align:right;">
-0.2406142
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0065320
</td>
</tr>
<tr>
<td style="text-align:right;">
3152
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A5633
</td>
<td style="text-align:right;">
5633
</td>
<td style="text-align:right;">
555
</td>
<td style="text-align:right;">
54.593579
</td>
<td style="text-align:right;">
-0.2067964
</td>
<td style="text-align:right;">
-0.2134634
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0066670
</td>
</tr>
<tr>
<td style="text-align:right;">
3202
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A7274
</td>
<td style="text-align:right;">
7274
</td>
<td style="text-align:right;">
555
</td>
<td style="text-align:right;">
55.109790
</td>
<td style="text-align:right;">
-0.1740126
</td>
<td style="text-align:right;">
-0.1806320
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0066194
</td>
</tr>
<tr>
<td style="text-align:right;">
3252
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A9779
</td>
<td style="text-align:right;">
9779
</td>
<td style="text-align:right;">
555
</td>
<td style="text-align:right;">
56.080888
</td>
<td style="text-align:right;">
-0.1169470
</td>
<td style="text-align:right;">
-0.1236111
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0066641
</td>
</tr>
<tr>
<td style="text-align:right;">
3603
</td>
<td style="text-align:left;">
cev526
</td>
<td style="text-align:right;">
0.0526
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
905
</td>
<td style="text-align:right;">
1.533025
</td>
<td style="text-align:right;">
-5.2530406
</td>
<td style="text-align:right;">
-5.2486887
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0043519
</td>
</tr>
<tr>
<td style="text-align:right;">
3353
</td>
<td style="text-align:left;">
cev315
</td>
<td style="text-align:right;">
0.0315
</td>
<td style="text-align:left;">
A2504
</td>
<td style="text-align:right;">
2504
</td>
<td style="text-align:right;">
905
</td>
<td style="text-align:right;">
1.714498
</td>
<td style="text-align:right;">
-4.5517474
</td>
<td style="text-align:right;">
-4.5408560
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0108913
</td>
</tr>
<tr>
<td style="text-align:right;">
3403
</td>
<td style="text-align:left;">
cev315
</td>
<td style="text-align:right;">
0.0315
</td>
<td style="text-align:left;">
A4145
</td>
<td style="text-align:right;">
4145
</td>
<td style="text-align:right;">
905
</td>
<td style="text-align:right;">
1.860521
</td>
<td style="text-align:right;">
-4.1039608
</td>
<td style="text-align:right;">
-4.1072736
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0033128
</td>
</tr>
<tr>
<td style="text-align:right;">
3453
</td>
<td style="text-align:left;">
cev315
</td>
<td style="text-align:right;">
0.0315
</td>
<td style="text-align:left;">
A5633
</td>
<td style="text-align:right;">
5633
</td>
<td style="text-align:right;">
905
</td>
<td style="text-align:right;">
2.015341
</td>
<td style="text-align:right;">
-3.7465733
</td>
<td style="text-align:right;">
-3.7611842
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0146109
</td>
</tr>
<tr>
<td style="text-align:right;">
3503
</td>
<td style="text-align:left;">
cev315
</td>
<td style="text-align:right;">
0.0315
</td>
<td style="text-align:left;">
A7274
</td>
<td style="text-align:right;">
7274
</td>
<td style="text-align:right;">
905
</td>
<td style="text-align:right;">
2.215003
</td>
<td style="text-align:right;">
-3.4101025
</td>
<td style="text-align:right;">
-3.4235413
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0134388
</td>
</tr>
<tr>
<td style="text-align:right;">
3553
</td>
<td style="text-align:left;">
cev315
</td>
<td style="text-align:right;">
0.0315
</td>
<td style="text-align:left;">
A9779
</td>
<td style="text-align:right;">
9779
</td>
<td style="text-align:right;">
905
</td>
<td style="text-align:right;">
2.590608
</td>
<td style="text-align:right;">
-2.9413469
</td>
<td style="text-align:right;">
-2.9535570
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0122101
</td>
</tr>
<tr>
<td style="text-align:right;">
3004
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
953
</td>
<td style="text-align:right;">
20.125381
</td>
<td style="text-align:right;">
-1.3249909
</td>
<td style="text-align:right;">
-1.3290865
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0040957
</td>
</tr>
<tr>
<td style="text-align:right;">
3054
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A2504
</td>
<td style="text-align:right;">
2504
</td>
<td style="text-align:right;">
953
</td>
<td style="text-align:right;">
20.306854
</td>
<td style="text-align:right;">
-1.2476021
</td>
<td style="text-align:right;">
-1.2531860
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0055839
</td>
</tr>
<tr>
<td style="text-align:right;">
3104
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A4145
</td>
<td style="text-align:right;">
4145
</td>
<td style="text-align:right;">
953
</td>
<td style="text-align:right;">
20.452876
</td>
<td style="text-align:right;">
-1.1916003
</td>
<td style="text-align:right;">
-1.1975215
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0059211
</td>
</tr>
<tr>
<td style="text-align:right;">
3154
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A5633
</td>
<td style="text-align:right;">
5633
</td>
<td style="text-align:right;">
953
</td>
<td style="text-align:right;">
20.607697
</td>
<td style="text-align:right;">
-1.1383665
</td>
<td style="text-align:right;">
-1.1444048
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0060383
</td>
</tr>
<tr>
<td style="text-align:right;">
3204
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A7274
</td>
<td style="text-align:right;">
7274
</td>
<td style="text-align:right;">
953
</td>
<td style="text-align:right;">
20.807359
</td>
<td style="text-align:right;">
-1.0766095
</td>
<td style="text-align:right;">
-1.0823344
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0057250
</td>
</tr>
<tr>
<td style="text-align:right;">
3254
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A9779
</td>
<td style="text-align:right;">
9779
</td>
<td style="text-align:right;">
953
</td>
<td style="text-align:right;">
21.182964
</td>
<td style="text-align:right;">
-0.9729832
</td>
<td style="text-align:right;">
-0.9781408
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0051576
</td>
</tr>
<tr>
<td style="text-align:right;">
3005
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1017
</td>
<td style="text-align:right;">
63.774766
</td>
<td style="text-align:right;">
-0.1284542
</td>
<td style="text-align:right;">
-0.1342653
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0058110
</td>
</tr>
<tr>
<td style="text-align:right;">
3055
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A2504
</td>
<td style="text-align:right;">
2504
</td>
<td style="text-align:right;">
1017
</td>
<td style="text-align:right;">
64.298911
</td>
<td style="text-align:right;">
-0.0967695
</td>
<td style="text-align:right;">
-0.1031112
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0063417
</td>
</tr>
<tr>
<td style="text-align:right;">
3105
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A4145
</td>
<td style="text-align:right;">
4145
</td>
<td style="text-align:right;">
1017
</td>
<td style="text-align:right;">
64.720664
</td>
<td style="text-align:right;">
-0.0728485
</td>
<td style="text-align:right;">
-0.0793940
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0065454
</td>
</tr>
<tr>
<td style="text-align:right;">
3155
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A5633
</td>
<td style="text-align:right;">
5633
</td>
<td style="text-align:right;">
1017
</td>
<td style="text-align:right;">
65.167829
</td>
<td style="text-align:right;">
-0.0490898
</td>
<td style="text-align:right;">
-0.0557238
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0066341
</td>
</tr>
<tr>
<td style="text-align:right;">
3205
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A7274
</td>
<td style="text-align:right;">
7274
</td>
<td style="text-align:right;">
1017
</td>
<td style="text-align:right;">
65.744507
</td>
<td style="text-align:right;">
-0.0203378
</td>
<td style="text-align:right;">
-0.0269149
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0065772
</td>
</tr>
<tr>
<td style="text-align:right;">
3255
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A9779
</td>
<td style="text-align:right;">
9779
</td>
<td style="text-align:right;">
1017
</td>
<td style="text-align:right;">
66.829359
</td>
<td style="text-align:right;">
0.0299397
</td>
<td style="text-align:right;">
0.0233507
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0065890
</td>
</tr>
</tbody>
</table>
</div>
<p>Fourth, row_bind results together.</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="multi-dimensional-data-structures.html#cb334-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Single dataframe with all results</span></span>
<span id="cb334-2"><a href="multi-dimensional-data-structures.html#cb334-2" aria-hidden="true" tabindex="-1"></a>tb_cev_matched_all_counter <span class="ot">&lt;-</span> <span class="fu">do.call</span>(bind_rows, ls_tb_cev_matched)</span>
<span id="cb334-3"><a href="multi-dimensional-data-structures.html#cb334-3" aria-hidden="true" tabindex="-1"></a><span class="co"># check size</span></span>
<span id="cb334-4"><a href="multi-dimensional-data-structures.html#cb334-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">dim</span>(tb_cev_matched_all_counter))</span></code></pre></div>
<pre><code>## [1] 1200   11</code></pre>
<p>Fifth, visualize results</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="multi-dimensional-data-structures.html#cb336-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select four from the productivity types</span></span>
<span id="cb336-2"><a href="multi-dimensional-data-structures.html#cb336-2" aria-hidden="true" tabindex="-1"></a>ar_prod_type_lvl_unique <span class="ot">&lt;-</span> <span class="fu">unique</span>(tb_cev_matched_all_counter <span class="sc">%&gt;%</span> <span class="fu">pull</span>(prod_type_lvl))</span>
<span id="cb336-3"><a href="multi-dimensional-data-structures.html#cb336-3" aria-hidden="true" tabindex="-1"></a>ar_prod_type_lvl_selected <span class="ot">&lt;-</span> ar_prod_type_lvl_unique[<span class="fu">round</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">length</span>(ar_prod_type_lvl_unique), <span class="at">length.out=</span><span class="dv">4</span>))]</span>
<span id="cb336-4"><a href="multi-dimensional-data-structures.html#cb336-4" aria-hidden="true" tabindex="-1"></a><span class="co"># graph</span></span>
<span id="cb336-5"><a href="multi-dimensional-data-structures.html#cb336-5" aria-hidden="true" tabindex="-1"></a>lineplot <span class="ot">&lt;-</span> tb_cev_matched_all_counter <span class="sc">%&gt;%</span></span>
<span id="cb336-6"><a href="multi-dimensional-data-structures.html#cb336-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(prod_type_lvl <span class="sc">%in%</span> ar_prod_type_lvl_selected) <span class="sc">%&gt;%</span></span>
<span id="cb336-7"><a href="multi-dimensional-data-structures.html#cb336-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(prod_type_st, cash_tt) <span class="sc">%&gt;%</span></span>
<span id="cb336-8"><a href="multi-dimensional-data-structures.html#cb336-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>cash_tt, <span class="at">y=</span>cev_lvl,</span>
<span id="cb336-9"><a href="multi-dimensional-data-structures.html#cb336-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">colour=</span>counter_policy, <span class="at">linetype=</span>counter_policy, <span class="at">shape=</span>counter_policy)) <span class="sc">+</span></span>
<span id="cb336-10"><a href="multi-dimensional-data-structures.html#cb336-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">facet_wrap</span>( <span class="sc">~</span> prod_type_st) <span class="sc">+</span></span>
<span id="cb336-11"><a href="multi-dimensional-data-structures.html#cb336-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb336-12"><a href="multi-dimensional-data-structures.html#cb336-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb336-13"><a href="multi-dimensional-data-structures.html#cb336-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&#39;Visualizing the positions of matched values&#39;</span>,</span>
<span id="cb336-14"><a href="multi-dimensional-data-structures.html#cb336-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">x =</span> <span class="st">&#39;Resource Levels&#39;</span>,</span>
<span id="cb336-15"><a href="multi-dimensional-data-structures.html#cb336-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> <span class="st">&#39;CEV&#39;</span>,</span>
<span id="cb336-16"><a href="multi-dimensional-data-structures.html#cb336-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">caption =</span> <span class="fu">paste0</span>(<span class="st">&#39;https://fanwangecon.github.io/&#39;</span>,</span>
<span id="cb336-17"><a href="multi-dimensional-data-structures.html#cb336-17" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&#39;R4Econ/panel/join/htmlpdfr/fs_join_compare.html&#39;</span>)) </span>
<span id="cb336-18"><a href="multi-dimensional-data-structures.html#cb336-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(lineplot)</span></code></pre></div>
<p><img src="Panel-Data-and-Optimization-with-R_files/figure-html/unnamed-chunk-162-1.png" width="672" style="display: block; margin: auto;" /></p>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="functions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="linear-regression.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": [["Panel-Data-and-Optimization-with-R.pdf", "PDF"]],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
