<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Multi-dimensional Data Structures | Data Structures, Estimation and Optimization with R</title>
  <meta name="description" content="Running parallel code in R" />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Multi-dimensional Data Structures | Data Structures, Estimation and Optimization with R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Running parallel code in R" />
  <meta name="github-repo" content="fanwangecon/R4Econ" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Multi-dimensional Data Structures | Data Structures, Estimation and Optimization with R" />
  
  <meta name="twitter:description" content="Running parallel code in R" />
  

<meta name="author" content="Fan Wang" />


<meta name="date" content="2024-01-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="functions.html"/>
<link rel="next" href="linear-regression.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-92953468-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-92953468-5');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Structures and Estimation with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html"><i class="fa fa-check"></i><b>1</b> Array, Matrix, Dataframe</a>
<ul>
<li class="chapter" data-level="1.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#list"><i class="fa fa-check"></i><b>1.1</b> List</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#lists"><i class="fa fa-check"></i><b>1.1.1</b> Lists</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#array"><i class="fa fa-check"></i><b>1.2</b> Array</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#array-basics"><i class="fa fa-check"></i><b>1.2.1</b> Array Basics</a></li>
<li class="chapter" data-level="1.2.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-arrays"><i class="fa fa-check"></i><b>1.2.2</b> Generate Arrays</a></li>
<li class="chapter" data-level="1.2.3" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#string-arrays"><i class="fa fa-check"></i><b>1.2.3</b> String Arrays</a></li>
<li class="chapter" data-level="1.2.4" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#mesh-matrices-arrays-and-scalars"><i class="fa fa-check"></i><b>1.2.4</b> Mesh Matrices, Arrays and Scalars</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#matrix"><i class="fa fa-check"></i><b>1.3</b> Matrix</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-matrixes"><i class="fa fa-check"></i><b>1.3.1</b> Generate Matrixes</a></li>
<li class="chapter" data-level="1.3.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#linear-algebra"><i class="fa fa-check"></i><b>1.3.2</b> Linear Algebra</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#regular-expression-date-etc."><i class="fa fa-check"></i><b>1.4</b> Regular Expression, Date, etc.</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#string-regular-expression"><i class="fa fa-check"></i><b>1.4.1</b> String Regular Expression</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html"><i class="fa fa-check"></i><b>2</b> Manipulate and Summarize Dataframes</a>
<ul>
<li class="chapter" data-level="2.1" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#variables-in-dataframes"><i class="fa fa-check"></i><b>2.1</b> Variables in Dataframes</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#generate-dataframe"><i class="fa fa-check"></i><b>2.1.1</b> Generate Dataframe</a></li>
<li class="chapter" data-level="2.1.2" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#generate-categorical-variables"><i class="fa fa-check"></i><b>2.1.2</b> Generate Categorical Variables</a></li>
<li class="chapter" data-level="2.1.3" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#drawly-random-rows"><i class="fa fa-check"></i><b>2.1.3</b> Drawly Random Rows</a></li>
<li class="chapter" data-level="2.1.4" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#generate-variables-conditional-on-others"><i class="fa fa-check"></i><b>2.1.4</b> Generate Variables Conditional On Others</a></li>
<li class="chapter" data-level="2.1.5" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#string-dataframes"><i class="fa fa-check"></i><b>2.1.5</b> String Dataframes</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#counting-observation"><i class="fa fa-check"></i><b>2.2</b> Counting Observation</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#counting-and-tabulations"><i class="fa fa-check"></i><b>2.2.1</b> Counting and Tabulations</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#sorting-indexing-slicing"><i class="fa fa-check"></i><b>2.3</b> Sorting, Indexing, Slicing</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#sorting-1"><i class="fa fa-check"></i><b>2.3.1</b> Sorting</a></li>
<li class="chapter" data-level="2.3.2" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#group-sort-and-slice"><i class="fa fa-check"></i><b>2.3.2</b> Group, Sort and Slice</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#advanced-group-aggregation"><i class="fa fa-check"></i><b>2.4</b> Advanced Group Aggregation</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#cumulative-statistics-within-group"><i class="fa fa-check"></i><b>2.4.1</b> Cumulative Statistics within Group</a></li>
<li class="chapter" data-level="2.4.2" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#groups-statistics"><i class="fa fa-check"></i><b>2.4.2</b> Groups Statistics</a></li>
<li class="chapter" data-level="2.4.3" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#one-variable-group-summary"><i class="fa fa-check"></i><b>2.4.3</b> One Variable Group Summary</a></li>
<li class="chapter" data-level="2.4.4" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#nested-within-group-stats"><i class="fa fa-check"></i><b>2.4.4</b> Nested within Group Stats</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#distributional-statistics"><i class="fa fa-check"></i><b>2.5</b> Distributional Statistics</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#histogram"><i class="fa fa-check"></i><b>2.5.1</b> Histogram</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#summarize-multiple-variables"><i class="fa fa-check"></i><b>2.6</b> Summarize Multiple Variables</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#apply-function-over-multiple-columns-and-rows"><i class="fa fa-check"></i><b>2.6.1</b> Apply Function Over Multiple Columns and Rows</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>3</b> Functions</a>
<ul>
<li class="chapter" data-level="3.1" data-path="functions.html"><a href="functions.html#dataframe-mutate"><i class="fa fa-check"></i><b>3.1</b> Dataframe Mutate</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="functions.html"><a href="functions.html#row-input-functions"><i class="fa fa-check"></i><b>3.1.1</b> Row Input Functions</a></li>
<li class="chapter" data-level="3.1.2" data-path="functions.html"><a href="functions.html#evaluate-choices-across-states"><i class="fa fa-check"></i><b>3.1.2</b> Evaluate Choices Across States</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="functions.html"><a href="functions.html#dataframe-do-anything"><i class="fa fa-check"></i><b>3.2</b> Dataframe Do Anything</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="functions.html"><a href="functions.html#mx1-by-n-to-mxq-by-n1"><i class="fa fa-check"></i><b>3.2.1</b> (Mx1 by N) to (MxQ by N+1)</a></li>
<li class="chapter" data-level="3.2.2" data-path="functions.html"><a href="functions.html#mxp-by-n-to-mx1-by-1"><i class="fa fa-check"></i><b>3.2.2</b> (MxP by N) to (Mx1 by 1)</a></li>
<li class="chapter" data-level="3.2.3" data-path="functions.html"><a href="functions.html#mxp-by-n-to-mxq-by-nz"><i class="fa fa-check"></i><b>3.2.3</b> (MxP by N) to (MxQ by N+Z)</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="functions.html"><a href="functions.html#apply-and-pmap"><i class="fa fa-check"></i><b>3.3</b> Apply and pmap</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="functions.html"><a href="functions.html#apply-and-sapply"><i class="fa fa-check"></i><b>3.3.1</b> Apply and Sapply</a></li>
<li class="chapter" data-level="3.3.2" data-path="functions.html"><a href="functions.html#mutate-evaluate-functions"><i class="fa fa-check"></i><b>3.3.2</b> Mutate Evaluate Functions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html"><i class="fa fa-check"></i><b>4</b> Multi-dimensional Data Structures</a>
<ul>
<li class="chapter" data-level="4.1" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#generate-gather-bind-and-join"><i class="fa fa-check"></i><b>4.1</b> Generate, Gather, Bind and Join</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#generate-panel-structure"><i class="fa fa-check"></i><b>4.1.1</b> Generate Panel Structure</a></li>
<li class="chapter" data-level="4.1.2" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#join-datasets"><i class="fa fa-check"></i><b>4.1.2</b> Join Datasets</a></li>
<li class="chapter" data-level="4.1.3" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#gather-files"><i class="fa fa-check"></i><b>4.1.3</b> Gather Files</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#wide-and-long"><i class="fa fa-check"></i><b>4.2</b> Wide and Long</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#long-table-to-wide-table"><i class="fa fa-check"></i><b>4.2.1</b> Long Table to Wide Table</a></li>
<li class="chapter" data-level="4.2.2" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#wide-to-long"><i class="fa fa-check"></i><b>4.2.2</b> Wide to Long</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#within-panel-comparisons-and-statistics"><i class="fa fa-check"></i><b>4.3</b> Within Panel Comparisons and Statistics</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#find-closest-neighbor-on-grid"><i class="fa fa-check"></i><b>4.3.1</b> Find Closest Neighbor on Grid</a></li>
<li class="chapter" data-level="4.3.2" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#within-panel-cross-time-and-cross-group-statistics"><i class="fa fa-check"></i><b>4.3.2</b> Within Panel Cross-time and Cross-group Statistics</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#join-and-merge-files-together-by-keys"><i class="fa fa-check"></i><b>4.4</b> Join and Merge Files Together by Keys</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#mesh-join"><i class="fa fa-check"></i><b>4.4.1</b> Mesh Join</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i><b>5</b> Linear Regression</a>
<ul>
<li class="chapter" data-level="5.1" data-path="linear-regression.html"><a href="linear-regression.html#linear-and-polynomial-fitting"><i class="fa fa-check"></i><b>5.1</b> Linear and Polynomial Fitting</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="linear-regression.html"><a href="linear-regression.html#fit-curves-through-points"><i class="fa fa-check"></i><b>5.1.1</b> Fit Curves Through Points</a></li>
<li class="chapter" data-level="5.1.2" data-path="linear-regression.html"><a href="linear-regression.html#polynomial-time-series"><i class="fa fa-check"></i><b>5.1.2</b> Polynomial Time Series</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="linear-regression.html"><a href="linear-regression.html#ols-and-iv"><i class="fa fa-check"></i><b>5.2</b> OLS and IV</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="linear-regression.html"><a href="linear-regression.html#ols-and-iv-regression"><i class="fa fa-check"></i><b>5.2.1</b> OLS and IV Regression</a></li>
<li class="chapter" data-level="5.2.2" data-path="linear-regression.html"><a href="linear-regression.html#iv-loop-over-rhs"><i class="fa fa-check"></i><b>5.2.2</b> IV Loop over RHS</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="linear-regression.html"><a href="linear-regression.html#decomposition"><i class="fa fa-check"></i><b>5.3</b> Decomposition</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="linear-regression.html"><a href="linear-regression.html#decompose-rhs"><i class="fa fa-check"></i><b>5.3.1</b> Decompose RHS</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html"><i class="fa fa-check"></i><b>6</b> Nonlinear and Other Regressions</a>
<ul>
<li class="chapter" data-level="6.1" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html#logit-regression"><i class="fa fa-check"></i><b>6.1</b> Logit Regression</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html#binary-logit"><i class="fa fa-check"></i><b>6.1.1</b> Binary Logit</a></li>
<li class="chapter" data-level="6.1.2" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html#logistic-choice-model-with-aggregate-shares"><i class="fa fa-check"></i><b>6.1.2</b> Logistic Choice Model with Aggregate Shares</a></li>
<li class="chapter" data-level="6.1.3" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html#prices-from-aggregate-shares-in-logistic-choice-model"><i class="fa fa-check"></i><b>6.1.3</b> Prices from Aggregate Shares in Logistic Choice Model</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html#quantile-regression"><i class="fa fa-check"></i><b>6.2</b> Quantile Regression</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html#quantile-regression-basics"><i class="fa fa-check"></i><b>6.2.1</b> Quantile Regression Basics</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="optimization.html"><a href="optimization.html"><i class="fa fa-check"></i><b>7</b> Optimization</a>
<ul>
<li class="chapter" data-level="7.1" data-path="optimization.html"><a href="optimization.html#grid-based-optimization"><i class="fa fa-check"></i><b>7.1</b> Grid Based Optimization</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="optimization.html"><a href="optimization.html#find-maximum-by-iterating-over-grids"><i class="fa fa-check"></i><b>7.1.1</b> Find Maximum By Iterating Over Grids</a></li>
<li class="chapter" data-level="7.1.2" data-path="optimization.html"><a href="optimization.html#bisection"><i class="fa fa-check"></i><b>7.1.2</b> Bisection</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="mathematics.html"><a href="mathematics.html"><i class="fa fa-check"></i><b>8</b> Mathematics</a>
<ul>
<li class="chapter" data-level="8.1" data-path="mathematics.html"><a href="mathematics.html#basics"><i class="fa fa-check"></i><b>8.1</b> Basics</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="mathematics.html"><a href="mathematics.html#polynomial-formulas-for-points"><i class="fa fa-check"></i><b>8.1.1</b> Polynomial Formulas for Points</a></li>
<li class="chapter" data-level="8.1.2" data-path="mathematics.html"><a href="mathematics.html#rescale-a-parameter-with-fixed-min-and-max"><i class="fa fa-check"></i><b>8.1.2</b> Rescale a Parameter with Fixed Min and Max</a></li>
<li class="chapter" data-level="8.1.3" data-path="mathematics.html"><a href="mathematics.html#log-with-different-bases-and-exponents"><i class="fa fa-check"></i><b>8.1.3</b> Log with Different Bases and Exponents</a></li>
<li class="chapter" data-level="8.1.4" data-path="mathematics.html"><a href="mathematics.html#find-nearest"><i class="fa fa-check"></i><b>8.1.4</b> Find Nearest</a></li>
<li class="chapter" data-level="8.1.5" data-path="mathematics.html"><a href="mathematics.html#linear-scalar-fx0-solutions"><i class="fa fa-check"></i><b>8.1.5</b> Linear Scalar f(x)=0 Solutions</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="mathematics.html"><a href="mathematics.html#production-functions"><i class="fa fa-check"></i><b>8.2</b> Production Functions</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="mathematics.html"><a href="mathematics.html#nested-ces-production-function"><i class="fa fa-check"></i><b>8.2.1</b> Nested CES Production Function</a></li>
<li class="chapter" data-level="8.2.2" data-path="mathematics.html"><a href="mathematics.html#latent-dynamic-health-production-function"><i class="fa fa-check"></i><b>8.2.2</b> Latent Dynamic Health Production Function</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="mathematics.html"><a href="mathematics.html#inequality-models"><i class="fa fa-check"></i><b>8.3</b> Inequality Models</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="mathematics.html"><a href="mathematics.html#gini-discrete-sample"><i class="fa fa-check"></i><b>8.3.1</b> GINI Discrete Sample</a></li>
<li class="chapter" data-level="8.3.2" data-path="mathematics.html"><a href="mathematics.html#gini-formula-for-discrete-random-varialbe"><i class="fa fa-check"></i><b>8.3.2</b> GINI Formula for Discrete Random Varialbe</a></li>
<li class="chapter" data-level="8.3.3" data-path="mathematics.html"><a href="mathematics.html#atkinson-inequality-index"><i class="fa fa-check"></i><b>8.3.3</b> Atkinson Inequality Index</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="statistics.html"><a href="statistics.html"><i class="fa fa-check"></i><b>9</b> Statistics</a>
<ul>
<li class="chapter" data-level="9.1" data-path="statistics.html"><a href="statistics.html#random-draws"><i class="fa fa-check"></i><b>9.1</b> Random Draws</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="statistics.html"><a href="statistics.html#randomly-perturbing-a-parameter"><i class="fa fa-check"></i><b>9.1.1</b> Randomly Perturbing a Parameter</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="statistics.html"><a href="statistics.html#distributions"><i class="fa fa-check"></i><b>9.2</b> Distributions</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="statistics.html"><a href="statistics.html#integrate-over-normal-guassian-process-shock"><i class="fa fa-check"></i><b>9.2.1</b> Integrate Over Normal Guassian Process Shock</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="statistics.html"><a href="statistics.html#discrete-random-variable"><i class="fa fa-check"></i><b>9.3</b> Discrete Random Variable</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="statistics.html"><a href="statistics.html#discrete-approximation-of-continuous-random-variables"><i class="fa fa-check"></i><b>9.3.1</b> Discrete Approximation of Continuous Random Variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html"><i class="fa fa-check"></i><b>10</b> Tables and Graphs</a>
<ul>
<li class="chapter" data-level="10.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#r-base-plots"><i class="fa fa-check"></i><b>10.1</b> R Base Plots</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#plot-curve-line-and-points"><i class="fa fa-check"></i><b>10.1.1</b> Plot Curve, Line and Points</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#ggplot-line-related-plots"><i class="fa fa-check"></i><b>10.2</b> ggplot Line Related Plots</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#ggplot-line-plot-basics"><i class="fa fa-check"></i><b>10.2.1</b> ggplot Line Plot Basics</a></li>
<li class="chapter" data-level="10.2.2" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#ggplot-line-advanced"><i class="fa fa-check"></i><b>10.2.2</b> ggplot Line Advanced</a></li>
<li class="chapter" data-level="10.2.3" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#time-series-plots-with-shaded-areas"><i class="fa fa-check"></i><b>10.2.3</b> Time-series Plots with Shaded Areas</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#ggplot-scatter-related-plots"><i class="fa fa-check"></i><b>10.3</b> ggplot Scatter Related Plots</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#ggplot-scatter-plot"><i class="fa fa-check"></i><b>10.3.1</b> ggplot Scatter Plot</a></li>
<li class="chapter" data-level="10.3.2" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#ggplot-multiple-scatter-lines-with-facet-wrap"><i class="fa fa-check"></i><b>10.3.2</b> ggplot Multiple Scatter-Lines with Facet Wrap</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#write-and-read-plots"><i class="fa fa-check"></i><b>10.4</b> Write and Read Plots</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#import-and-export-images"><i class="fa fa-check"></i><b>10.4.1</b> Import and Export Images</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="get-data.html"><a href="get-data.html"><i class="fa fa-check"></i><b>11</b> Get Data</a>
<ul>
<li class="chapter" data-level="11.1" data-path="get-data.html"><a href="get-data.html#environmental-data"><i class="fa fa-check"></i><b>11.1</b> Environmental Data</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="get-data.html"><a href="get-data.html#ecmwf-era5-data"><i class="fa fa-check"></i><b>11.1.1</b> ECMWF ERA5 Data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="coding-and-development.html"><a href="coding-and-development.html"><i class="fa fa-check"></i><b>12</b> Coding and Development</a>
<ul>
<li class="chapter" data-level="12.1" data-path="coding-and-development.html"><a href="coding-and-development.html#installation-and-packages"><i class="fa fa-check"></i><b>12.1</b> Installation and Packages</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="coding-and-development.html"><a href="coding-and-development.html#r-installation-and-set-up"><i class="fa fa-check"></i><b>12.1.1</b> R Installation and Set-Up</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="coding-and-development.html"><a href="coding-and-development.html#files-in-and-out"><i class="fa fa-check"></i><b>12.2</b> Files In and Out</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="coding-and-development.html"><a href="coding-and-development.html#file-path"><i class="fa fa-check"></i><b>12.2.1</b> File Path</a></li>
<li class="chapter" data-level="12.2.2" data-path="coding-and-development.html"><a href="coding-and-development.html#text-to-file"><i class="fa fa-check"></i><b>12.2.2</b> Text to File</a></li>
<li class="chapter" data-level="12.2.3" data-path="coding-and-development.html"><a href="coding-and-development.html#rmd-to-html"><i class="fa fa-check"></i><b>12.2.3</b> Rmd to HTML</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="coding-and-development.html"><a href="coding-and-development.html#python-with-r"><i class="fa fa-check"></i><b>12.3</b> Python with R</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="coding-and-development.html"><a href="coding-and-development.html#reticulate-basics"><i class="fa fa-check"></i><b>12.3.1</b> Reticulate Basics</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="coding-and-development.html"><a href="coding-and-development.html#command-line"><i class="fa fa-check"></i><b>12.4</b> Command Line</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="coding-and-development.html"><a href="coding-and-development.html#shell-and-system-commands"><i class="fa fa-check"></i><b>12.4.1</b> Shell and System Commands</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="coding-and-development.html"><a href="coding-and-development.html#run-code-in-parallel-in-r"><i class="fa fa-check"></i><b>12.5</b> Run Code in Parallel in R</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="coding-and-development.html"><a href="coding-and-development.html#parallel-loop-in-r"><i class="fa fa-check"></i><b>12.5.1</b> Parallel Loop in R</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="index-and-code-links.html"><a href="index-and-code-links.html"><i class="fa fa-check"></i><b>A</b> Index and Code Links</a>
<ul>
<li class="chapter" data-level="A.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#array-matrix-dataframe-links"><i class="fa fa-check"></i><b>A.1</b> Array, Matrix, Dataframe links</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.1-listlist-links"><i class="fa fa-check"></i><b>A.1.1</b> Section 1.1 List links</a></li>
<li class="chapter" data-level="A.1.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.2-arrayarray-links"><i class="fa fa-check"></i><b>A.1.2</b> Section 1.2 Array links</a></li>
<li class="chapter" data-level="A.1.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.3-matrixmatrix-links"><i class="fa fa-check"></i><b>A.1.3</b> Section 1.3 Matrix links</a></li>
<li class="chapter" data-level="A.1.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.4-regular-expression-date-etc.regular-expression-date-etc.-links"><i class="fa fa-check"></i><b>A.1.4</b> Section 1.4 Regular Expression, Date, etc. links</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#manipulate-and-summarize-dataframes-links"><i class="fa fa-check"></i><b>A.2</b> Manipulate and Summarize Dataframes links</a>
<ul>
<li class="chapter" data-level="A.2.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.1-variables-in-dataframesvariables-in-dataframes-links"><i class="fa fa-check"></i><b>A.2.1</b> Section 2.1 Variables in Dataframes links</a></li>
<li class="chapter" data-level="A.2.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.2-counting-observationcounting-observation-links"><i class="fa fa-check"></i><b>A.2.2</b> Section 2.2 Counting Observation links</a></li>
<li class="chapter" data-level="A.2.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.3-sorting-indexing-slicingsorting-indexing-slicing-links"><i class="fa fa-check"></i><b>A.2.3</b> Section 2.3 Sorting, Indexing, Slicing links</a></li>
<li class="chapter" data-level="A.2.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.4-advanced-group-aggregationadvanced-group-aggregation-links"><i class="fa fa-check"></i><b>A.2.4</b> Section 2.4 Advanced Group Aggregation links</a></li>
<li class="chapter" data-level="A.2.5" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.5-distributional-statisticsdistributional-statistics-links"><i class="fa fa-check"></i><b>A.2.5</b> Section 2.5 Distributional Statistics links</a></li>
<li class="chapter" data-level="A.2.6" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.6-summarize-multiple-variablessummarize-multiple-variables-links"><i class="fa fa-check"></i><b>A.2.6</b> Section 2.6 Summarize Multiple Variables links</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#functions-links"><i class="fa fa-check"></i><b>A.3</b> Functions links</a>
<ul>
<li class="chapter" data-level="A.3.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.1-dataframe-mutatedataframe-mutate-links"><i class="fa fa-check"></i><b>A.3.1</b> Section 3.1 Dataframe Mutate links</a></li>
<li class="chapter" data-level="A.3.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.2-dataframe-do-anythingdataframe-do-anything-links"><i class="fa fa-check"></i><b>A.3.2</b> Section 3.2 Dataframe Do Anything links</a></li>
<li class="chapter" data-level="A.3.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.3-apply-and-pmapapply-and-pmap-links"><i class="fa fa-check"></i><b>A.3.3</b> Section 3.3 Apply and pmap links</a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#multi-dimensional-data-structures-links"><i class="fa fa-check"></i><b>A.4</b> Multi-dimensional Data Structures links</a>
<ul>
<li class="chapter" data-level="A.4.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-4.1-generate-gather-bind-and-joingenerate-gather-bind-and-join-links"><i class="fa fa-check"></i><b>A.4.1</b> Section 4.1 Generate, Gather, Bind and Join links</a></li>
<li class="chapter" data-level="A.4.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-4.2-wide-and-longwide-and-long-links"><i class="fa fa-check"></i><b>A.4.2</b> Section 4.2 Wide and Long links</a></li>
<li class="chapter" data-level="A.4.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-4.3-within-panel-comparisons-and-statisticswithin-panel-comparisons-and-statistics-links"><i class="fa fa-check"></i><b>A.4.3</b> Section 4.3 Within Panel Comparisons and Statistics links</a></li>
<li class="chapter" data-level="A.4.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-4.4-join-and-merge-files-together-by-keysjoin-and-merge-files-together-by-keys-links"><i class="fa fa-check"></i><b>A.4.4</b> Section 4.4 Join and Merge Files Together by Keys links</a></li>
</ul></li>
<li class="chapter" data-level="A.5" data-path="index-and-code-links.html"><a href="index-and-code-links.html#linear-regression-links"><i class="fa fa-check"></i><b>A.5</b> Linear Regression links</a>
<ul>
<li class="chapter" data-level="A.5.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-5.1-linear-and-polynomial-fittinglinear-and-polynomial-fitting-links"><i class="fa fa-check"></i><b>A.5.1</b> Section 5.1 Linear and Polynomial Fitting links</a></li>
<li class="chapter" data-level="A.5.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-5.2-ols-and-ivols-and-iv-links"><i class="fa fa-check"></i><b>A.5.2</b> Section 5.2 OLS and IV links</a></li>
<li class="chapter" data-level="A.5.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-5.3-decompositiondecomposition-links"><i class="fa fa-check"></i><b>A.5.3</b> Section 5.3 Decomposition links</a></li>
</ul></li>
<li class="chapter" data-level="A.6" data-path="index-and-code-links.html"><a href="index-and-code-links.html#nonlinear-and-other-regressions-links"><i class="fa fa-check"></i><b>A.6</b> Nonlinear and Other Regressions links</a>
<ul>
<li class="chapter" data-level="A.6.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-6.1-logit-regressionlogit-regression-links"><i class="fa fa-check"></i><b>A.6.1</b> Section 6.1 Logit Regression links</a></li>
<li class="chapter" data-level="A.6.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-6.2-quantile-regressionquantile-regression-links"><i class="fa fa-check"></i><b>A.6.2</b> Section 6.2 Quantile Regression links</a></li>
</ul></li>
<li class="chapter" data-level="A.7" data-path="index-and-code-links.html"><a href="index-and-code-links.html#optimization-links"><i class="fa fa-check"></i><b>A.7</b> Optimization links</a>
<ul>
<li class="chapter" data-level="A.7.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-7.1-grid-based-optimizationgrid-based-optimization-links"><i class="fa fa-check"></i><b>A.7.1</b> Section 7.1 Grid Based Optimization links</a></li>
</ul></li>
<li class="chapter" data-level="A.8" data-path="index-and-code-links.html"><a href="index-and-code-links.html#mathematics-links"><i class="fa fa-check"></i><b>A.8</b> Mathematics links</a>
<ul>
<li class="chapter" data-level="A.8.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-8.1-basicsbasics-links"><i class="fa fa-check"></i><b>A.8.1</b> Section 8.1 Basics links</a></li>
<li class="chapter" data-level="A.8.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-8.2-production-functionsproduction-functions-links"><i class="fa fa-check"></i><b>A.8.2</b> Section 8.2 Production Functions links</a></li>
<li class="chapter" data-level="A.8.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-8.3-inequality-modelsinequality-models-links"><i class="fa fa-check"></i><b>A.8.3</b> Section 8.3 Inequality Models links</a></li>
</ul></li>
<li class="chapter" data-level="A.9" data-path="index-and-code-links.html"><a href="index-and-code-links.html#statistics-links"><i class="fa fa-check"></i><b>A.9</b> Statistics links</a>
<ul>
<li class="chapter" data-level="A.9.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-9.1-random-drawsrandom-draws-links"><i class="fa fa-check"></i><b>A.9.1</b> Section 9.1 Random Draws links</a></li>
<li class="chapter" data-level="A.9.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-9.2-distributionsdistributions-links"><i class="fa fa-check"></i><b>A.9.2</b> Section 9.2 Distributions links</a></li>
<li class="chapter" data-level="A.9.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-9.3-discrete-random-variablediscrete-random-variable-links"><i class="fa fa-check"></i><b>A.9.3</b> Section 9.3 Discrete Random Variable links</a></li>
</ul></li>
<li class="chapter" data-level="A.10" data-path="index-and-code-links.html"><a href="index-and-code-links.html#tables-and-graphs-links"><i class="fa fa-check"></i><b>A.10</b> Tables and Graphs links</a>
<ul>
<li class="chapter" data-level="A.10.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-10.1-r-base-plotsr-base-plots-links"><i class="fa fa-check"></i><b>A.10.1</b> Section 10.1 R Base Plots links</a></li>
<li class="chapter" data-level="A.10.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-10.2-ggplot-line-related-plotsggplot-line-related-plots-links"><i class="fa fa-check"></i><b>A.10.2</b> Section 10.2 ggplot Line Related Plots links</a></li>
<li class="chapter" data-level="A.10.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-10.3-ggplot-scatter-related-plotsggplot-scatter-related-plots-links"><i class="fa fa-check"></i><b>A.10.3</b> Section 10.3 ggplot Scatter Related Plots links</a></li>
<li class="chapter" data-level="A.10.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-10.4-write-and-read-plotswrite-and-read-plots-links"><i class="fa fa-check"></i><b>A.10.4</b> Section 10.4 Write and Read Plots links</a></li>
</ul></li>
<li class="chapter" data-level="A.11" data-path="index-and-code-links.html"><a href="index-and-code-links.html#get-data-links"><i class="fa fa-check"></i><b>A.11</b> Get Data links</a>
<ul>
<li class="chapter" data-level="A.11.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-11.1-environmental-dataenvironmental-data-links"><i class="fa fa-check"></i><b>A.11.1</b> Section 11.1 Environmental Data links</a></li>
</ul></li>
<li class="chapter" data-level="A.12" data-path="index-and-code-links.html"><a href="index-and-code-links.html#coding-and-development-links"><i class="fa fa-check"></i><b>A.12</b> Coding and Development links</a>
<ul>
<li class="chapter" data-level="A.12.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-12.1-installation-and-packagesinstallation-and-packages-links"><i class="fa fa-check"></i><b>A.12.1</b> Section 12.1 Installation and Packages links</a></li>
<li class="chapter" data-level="A.12.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-12.2-files-in-and-outfiles-in-and-out-links"><i class="fa fa-check"></i><b>A.12.2</b> Section 12.2 Files In and Out links</a></li>
<li class="chapter" data-level="A.12.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-12.3-python-with-rpython-with-r-links"><i class="fa fa-check"></i><b>A.12.3</b> Section 12.3 Python with R links</a></li>
<li class="chapter" data-level="A.12.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-12.4-command-linecommand-line-links"><i class="fa fa-check"></i><b>A.12.4</b> Section 12.4 Command Line links</a></li>
<li class="chapter" data-level="A.12.5" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-12.5-run-code-in-parallel-in-rrun-code-in-parallel-in-r-links"><i class="fa fa-check"></i><b>A.12.5</b> Section 12.5 Run Code in Parallel in R links</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://fanwangecon.github.io/R4Econ/bookdown/index.html" target="blank">R4Econ Bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Structures, Estimation and Optimization with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="multi-dimensional-data-structures" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> Multi-dimensional Data Structures<a href="multi-dimensional-data-structures.html#multi-dimensional-data-structures" class="anchor-section" aria-label="Anchor link to header"></a></h1>

<div id="generate-gather-bind-and-join" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Generate, Gather, Bind and Join<a href="multi-dimensional-data-structures.html#generate-gather-bind-and-join" class="anchor-section" aria-label="Anchor link to header"></a></h2>

<div id="generate-panel-structure" class="section level3 hasAnchor" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Generate Panel Structure<a href="multi-dimensional-data-structures.html#generate-panel-structure" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> research support package, <a href="https://fanwangecon.github.io/R4Econ/">R4Econ</a> examples page, <a href="https://fanwangecon.github.io/PkgTestR/">PkgTestR</a> packaging guide, or <a href="https://fanwangecon.github.io/Stat4Econ/">Stat4Econ</a> course page.</p>
</blockquote>
<div id="balanced-panel-skeleton" class="section level4 hasAnchor" number="4.1.1.1">
<h4><span class="header-section-number">4.1.1.1</span> Balanced Panel Skeleton<a href="multi-dimensional-data-structures.html#balanced-panel-skeleton" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>There are <span class="math inline">\(N\)</span> individuals, each could be observed <span class="math inline">\(M\)</span> times. In the example below, there are 3 students, each observed over 4 dates. This just uses the <a href="https://tidyr.tidyverse.org/reference/uncount.html">uncount</a> function from <em>tidyr</em>.</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="multi-dimensional-data-structures.html#cb409-1" tabindex="-1"></a><span class="co"># Define</span></span>
<span id="cb409-2"><a href="multi-dimensional-data-structures.html#cb409-2" tabindex="-1"></a>it_N <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb409-3"><a href="multi-dimensional-data-structures.html#cb409-3" tabindex="-1"></a>it_M <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb409-4"><a href="multi-dimensional-data-structures.html#cb409-4" tabindex="-1"></a>svr_id <span class="ot">&lt;-</span> <span class="st">&#39;student_id&#39;</span></span>
<span id="cb409-5"><a href="multi-dimensional-data-structures.html#cb409-5" tabindex="-1"></a>svr_date <span class="ot">&lt;-</span> <span class="st">&#39;class_day&#39;</span></span>
<span id="cb409-6"><a href="multi-dimensional-data-structures.html#cb409-6" tabindex="-1"></a></span>
<span id="cb409-7"><a href="multi-dimensional-data-structures.html#cb409-7" tabindex="-1"></a><span class="co"># dataframe</span></span>
<span id="cb409-8"><a href="multi-dimensional-data-structures.html#cb409-8" tabindex="-1"></a>df_panel_skeleton <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">matrix</span>(it_M, <span class="at">nrow=</span>it_N, <span class="at">ncol=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb409-9"><a href="multi-dimensional-data-structures.html#cb409-9" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="at">var =</span> svr_id) <span class="sc">%&gt;%</span></span>
<span id="cb409-10"><a href="multi-dimensional-data-structures.html#cb409-10" tabindex="-1"></a>  <span class="fu">uncount</span>(V1) <span class="sc">%&gt;%</span></span>
<span id="cb409-11"><a href="multi-dimensional-data-structures.html#cb409-11" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_id)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_date) <span class="sc">:=</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb409-12"><a href="multi-dimensional-data-structures.html#cb409-12" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb409-13"><a href="multi-dimensional-data-structures.html#cb409-13" tabindex="-1"></a></span>
<span id="cb409-14"><a href="multi-dimensional-data-structures.html#cb409-14" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb409-15"><a href="multi-dimensional-data-structures.html#cb409-15" tabindex="-1"></a><span class="fu">kable</span>(df_panel_skeleton) <span class="sc">%&gt;%</span></span>
<span id="cb409-16"><a href="multi-dimensional-data-structures.html#cb409-16" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
student_id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
class_day
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5
</td>
</tr>
</tbody>
</table>
</div>
<div id="panel-of-children-with-height-growth" class="section level4 hasAnchor" number="4.1.1.2">
<h4><span class="header-section-number">4.1.1.2</span> Panel of Children with Height Growth<a href="multi-dimensional-data-structures.html#panel-of-children-with-height-growth" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Given <span class="math inline">\(N\)</span> individuals, each with <span class="math inline">\(G\)</span> observations. There is an initial height variable and height grows every year. There are growth variables, variables for cumulative growth and variables for height at each age for each child.</p>
<p>Individuals are defined by gender (1 = female), race (1=asian), and birth height. Within individual yearly information includes height at each year of age.</p>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb410-1"><a href="multi-dimensional-data-structures.html#cb410-1" tabindex="-1"></a><span class="co"># Define</span></span>
<span id="cb410-2"><a href="multi-dimensional-data-structures.html#cb410-2" tabindex="-1"></a>it_N <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb410-3"><a href="multi-dimensional-data-structures.html#cb410-3" tabindex="-1"></a>it_M <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb410-4"><a href="multi-dimensional-data-structures.html#cb410-4" tabindex="-1"></a>svr_id <span class="ot">&lt;-</span> <span class="st">&#39;indi_id&#39;</span></span>
<span id="cb410-5"><a href="multi-dimensional-data-structures.html#cb410-5" tabindex="-1"></a>svr_gender <span class="ot">&lt;-</span> <span class="st">&#39;female&#39;</span></span>
<span id="cb410-6"><a href="multi-dimensional-data-structures.html#cb410-6" tabindex="-1"></a>svr_asian <span class="ot">&lt;-</span> <span class="st">&#39;asian&#39;</span></span>
<span id="cb410-7"><a href="multi-dimensional-data-structures.html#cb410-7" tabindex="-1"></a>svr_age <span class="ot">&lt;-</span> <span class="st">&#39;year_of_age&#39;</span></span>
<span id="cb410-8"><a href="multi-dimensional-data-structures.html#cb410-8" tabindex="-1"></a><span class="co"># Define Height Related Variables</span></span>
<span id="cb410-9"><a href="multi-dimensional-data-structures.html#cb410-9" tabindex="-1"></a>svr_brthgt <span class="ot">&lt;-</span> <span class="st">&#39;birth_height&#39;</span></span>
<span id="cb410-10"><a href="multi-dimensional-data-structures.html#cb410-10" tabindex="-1"></a>svr_hgtgrow <span class="ot">&lt;-</span> <span class="st">&#39;hgt_growth&#39;</span></span>
<span id="cb410-11"><a href="multi-dimensional-data-structures.html#cb410-11" tabindex="-1"></a>svr_hgtgrow_cumu <span class="ot">&lt;-</span> <span class="st">&#39;hgt_growcumu&#39;</span></span>
<span id="cb410-12"><a href="multi-dimensional-data-structures.html#cb410-12" tabindex="-1"></a>svr_height <span class="ot">&lt;-</span> <span class="st">&#39;height&#39;</span></span>
<span id="cb410-13"><a href="multi-dimensional-data-structures.html#cb410-13" tabindex="-1"></a></span>
<span id="cb410-14"><a href="multi-dimensional-data-structures.html#cb410-14" tabindex="-1"></a><span class="co"># panel dataframe following</span></span>
<span id="cb410-15"><a href="multi-dimensional-data-structures.html#cb410-15" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb410-16"><a href="multi-dimensional-data-structures.html#cb410-16" tabindex="-1"></a>df_panel_indiage <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">matrix</span>(it_M, <span class="at">nrow=</span>it_N, <span class="at">ncol=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb410-17"><a href="multi-dimensional-data-structures.html#cb410-17" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_gender) <span class="sc">:=</span> <span class="fu">rbinom</span>(<span class="fu">n</span>(), <span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb410-18"><a href="multi-dimensional-data-structures.html#cb410-18" tabindex="-1"></a>         <span class="sc">!!</span><span class="fu">sym</span>(svr_asian) <span class="sc">:=</span> <span class="fu">rbinom</span>(<span class="fu">n</span>(), <span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb410-19"><a href="multi-dimensional-data-structures.html#cb410-19" tabindex="-1"></a>         <span class="sc">!!</span><span class="fu">sym</span>(svr_brthgt) <span class="sc">:=</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="at">mean=</span><span class="dv">60</span>,<span class="at">sd=</span><span class="dv">3</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb410-20"><a href="multi-dimensional-data-structures.html#cb410-20" tabindex="-1"></a>  <span class="fu">uncount</span>(V1) <span class="sc">%&gt;%</span></span>
<span id="cb410-21"><a href="multi-dimensional-data-structures.html#cb410-21" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_gender), <span class="sc">!!</span><span class="fu">sym</span>(svr_asian), <span class="sc">!!</span><span class="fu">sym</span>(svr_brthgt)) <span class="sc">%&gt;%</span></span>
<span id="cb410-22"><a href="multi-dimensional-data-structures.html#cb410-22" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_age) <span class="sc">:=</span> <span class="fu">row_number</span>(),</span>
<span id="cb410-23"><a href="multi-dimensional-data-structures.html#cb410-23" tabindex="-1"></a>         <span class="sc">!!</span><span class="fu">sym</span>(svr_hgtgrow) <span class="sc">:=</span> <span class="fu">runif</span>(<span class="fu">n</span>(), <span class="at">min=</span><span class="dv">5</span>, <span class="at">max=</span><span class="dv">15</span>),</span>
<span id="cb410-24"><a href="multi-dimensional-data-structures.html#cb410-24" tabindex="-1"></a>         <span class="sc">!!</span><span class="fu">sym</span>(svr_hgtgrow_cumu) <span class="sc">:=</span> <span class="fu">cumsum</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_hgtgrow)),</span>
<span id="cb410-25"><a href="multi-dimensional-data-structures.html#cb410-25" tabindex="-1"></a>         <span class="sc">!!</span><span class="fu">sym</span>(svr_height) <span class="sc">:=</span> <span class="sc">!!</span><span class="fu">sym</span>(svr_brthgt) <span class="sc">+</span> <span class="sc">!!</span><span class="fu">sym</span>(svr_hgtgrow_cumu))  <span class="sc">%&gt;%</span></span>
<span id="cb410-26"><a href="multi-dimensional-data-structures.html#cb410-26" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb410-27"><a href="multi-dimensional-data-structures.html#cb410-27" tabindex="-1"></a></span>
<span id="cb410-28"><a href="multi-dimensional-data-structures.html#cb410-28" tabindex="-1"></a><span class="co"># Add Height Index</span></span>
<span id="cb410-29"><a href="multi-dimensional-data-structures.html#cb410-29" tabindex="-1"></a><span class="fu">kable</span>(df_panel_indiage) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
female
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
asian
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
birth_height
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
year_of_age
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
hgt_growth
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
hgt_growcumu
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
height
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
65.14520
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
13.895393
</td>
<td style="text-align:right;">
13.895393
</td>
<td style="text-align:right;">
79.04059
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
65.14520
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
11.928034
</td>
<td style="text-align:right;">
25.823427
</td>
<td style="text-align:right;">
90.96862
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
65.14520
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
11.405068
</td>
<td style="text-align:right;">
37.228495
</td>
<td style="text-align:right;">
102.37369
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
61.38275
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
11.907053
</td>
<td style="text-align:right;">
11.907053
</td>
<td style="text-align:right;">
73.28980
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
61.38275
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
12.954674
</td>
<td style="text-align:right;">
24.861727
</td>
<td style="text-align:right;">
86.24448
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
61.38275
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5.246137
</td>
<td style="text-align:right;">
30.107864
</td>
<td style="text-align:right;">
91.49061
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
56.20482
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
14.942698
</td>
<td style="text-align:right;">
14.942698
</td>
<td style="text-align:right;">
71.14751
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
56.20482
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
11.557058
</td>
<td style="text-align:right;">
26.499756
</td>
<td style="text-align:right;">
82.70457
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
56.20482
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
12.085305
</td>
<td style="text-align:right;">
38.585060
</td>
<td style="text-align:right;">
94.78988
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
57.93944
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6.471137
</td>
<td style="text-align:right;">
6.471137
</td>
<td style="text-align:right;">
64.41058
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
57.93944
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
14.630242
</td>
<td style="text-align:right;">
21.101379
</td>
<td style="text-align:right;">
79.04082
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
57.93944
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
14.022991
</td>
<td style="text-align:right;">
35.124369
</td>
<td style="text-align:right;">
93.06381
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
58.66301
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
10.440660
</td>
<td style="text-align:right;">
10.440660
</td>
<td style="text-align:right;">
69.10367
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
58.66301
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
10.941420
</td>
<td style="text-align:right;">
21.382081
</td>
<td style="text-align:right;">
80.04509
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
58.66301
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
7.891597
</td>
<td style="text-align:right;">
29.273678
</td>
<td style="text-align:right;">
87.93669
</td>
</tr>
</tbody>
</table>
</div>
<div id="create-group-ids" class="section level4 hasAnchor" number="4.1.1.3">
<h4><span class="header-section-number">4.1.1.3</span> Create Group IDs<a href="multi-dimensional-data-structures.html#create-group-ids" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Given the dataframe just created, generate group IDs for each Gender and Race Groups. Given that both are binary, there can only be 4 unique groups.</p>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb411-1"><a href="multi-dimensional-data-structures.html#cb411-1" tabindex="-1"></a><span class="co"># group id</span></span>
<span id="cb411-2"><a href="multi-dimensional-data-structures.html#cb411-2" tabindex="-1"></a>svr_group_id <span class="ot">&lt;-</span> <span class="st">&#39;female_asian_id&#39;</span></span>
<span id="cb411-3"><a href="multi-dimensional-data-structures.html#cb411-3" tabindex="-1"></a><span class="co"># Define</span></span>
<span id="cb411-4"><a href="multi-dimensional-data-structures.html#cb411-4" tabindex="-1"></a>ls_svr_group_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;female&#39;</span>, <span class="st">&#39;asian&#39;</span>)</span>
<span id="cb411-5"><a href="multi-dimensional-data-structures.html#cb411-5" tabindex="-1"></a></span>
<span id="cb411-6"><a href="multi-dimensional-data-structures.html#cb411-6" tabindex="-1"></a><span class="co"># panel dataframe following</span></span>
<span id="cb411-7"><a href="multi-dimensional-data-structures.html#cb411-7" tabindex="-1"></a>df_panel_indiage_id <span class="ot">&lt;-</span> df_panel_indiage <span class="sc">%&gt;%</span></span>
<span id="cb411-8"><a href="multi-dimensional-data-structures.html#cb411-8" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">!!!</span><span class="fu">syms</span>(ls_svr_group_vars)) <span class="sc">%&gt;%</span></span>
<span id="cb411-9"><a href="multi-dimensional-data-structures.html#cb411-9" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="sc">!!!</span><span class="fu">syms</span>(ls_svr_group_vars)) <span class="sc">%&gt;%</span></span>
<span id="cb411-10"><a href="multi-dimensional-data-structures.html#cb411-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_group_id) <span class="sc">:=</span> (<span class="fu">row_number</span>()<span class="sc">==</span><span class="dv">1</span>)<span class="sc">*</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb411-11"><a href="multi-dimensional-data-structures.html#cb411-11" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb411-12"><a href="multi-dimensional-data-structures.html#cb411-12" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_group_id) <span class="sc">:=</span> <span class="fu">cumsum</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_group_id))) <span class="sc">%&gt;%</span></span>
<span id="cb411-13"><a href="multi-dimensional-data-structures.html#cb411-13" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">one_of</span>(svr_group_id, ls_svr_group_vars), <span class="fu">everything</span>())</span>
<span id="cb411-14"><a href="multi-dimensional-data-structures.html#cb411-14" tabindex="-1"></a></span>
<span id="cb411-15"><a href="multi-dimensional-data-structures.html#cb411-15" tabindex="-1"></a><span class="co"># Add Height Index</span></span>
<span id="cb411-16"><a href="multi-dimensional-data-structures.html#cb411-16" tabindex="-1"></a><span class="fu">kable</span>(df_panel_indiage_id) <span class="sc">%&gt;%</span></span>
<span id="cb411-17"><a href="multi-dimensional-data-structures.html#cb411-17" tabindex="-1"></a>  <span class="fu">kable_styling_fc_wide</span>()</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:875px; ">
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
female_asian_id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
female
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
asian
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
birth_height
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
year_of_age
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
hgt_growth
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
hgt_growcumu
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
height
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
65.14520
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
13.895393
</td>
<td style="text-align:right;">
13.895393
</td>
<td style="text-align:right;">
79.04059
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
65.14520
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
11.928034
</td>
<td style="text-align:right;">
25.823427
</td>
<td style="text-align:right;">
90.96862
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
65.14520
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
11.405068
</td>
<td style="text-align:right;">
37.228495
</td>
<td style="text-align:right;">
102.37369
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
56.20482
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
14.942698
</td>
<td style="text-align:right;">
14.942698
</td>
<td style="text-align:right;">
71.14751
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
56.20482
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
11.557058
</td>
<td style="text-align:right;">
26.499756
</td>
<td style="text-align:right;">
82.70457
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
56.20482
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
12.085305
</td>
<td style="text-align:right;">
38.585060
</td>
<td style="text-align:right;">
94.78988
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
58.66301
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
10.440660
</td>
<td style="text-align:right;">
10.440660
</td>
<td style="text-align:right;">
69.10367
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
58.66301
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
10.941420
</td>
<td style="text-align:right;">
21.382081
</td>
<td style="text-align:right;">
80.04509
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
58.66301
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
7.891597
</td>
<td style="text-align:right;">
29.273678
</td>
<td style="text-align:right;">
87.93669
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
61.38275
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
11.907053
</td>
<td style="text-align:right;">
11.907053
</td>
<td style="text-align:right;">
73.28980
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
61.38275
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
12.954674
</td>
<td style="text-align:right;">
24.861727
</td>
<td style="text-align:right;">
86.24448
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
61.38275
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5.246137
</td>
<td style="text-align:right;">
30.107864
</td>
<td style="text-align:right;">
91.49061
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
57.93944
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6.471137
</td>
<td style="text-align:right;">
6.471137
</td>
<td style="text-align:right;">
64.41058
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
57.93944
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
14.630242
</td>
<td style="text-align:right;">
21.101379
</td>
<td style="text-align:right;">
79.04082
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
57.93944
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
14.022991
</td>
<td style="text-align:right;">
35.124369
</td>
<td style="text-align:right;">
93.06381
</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<div id="join-datasets" class="section level3 hasAnchor" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Join Datasets<a href="multi-dimensional-data-structures.html#join-datasets" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> research support package, <a href="https://fanwangecon.github.io/R4Econ/">R4Econ</a> examples page, <a href="https://fanwangecon.github.io/PkgTestR/">PkgTestR</a> packaging guide, or <a href="https://fanwangecon.github.io/Stat4Econ/">Stat4Econ</a> course page.</p>
</blockquote>
<div id="join-panel-with-multiple-keys" class="section level4 hasAnchor" number="4.1.2.1">
<h4><span class="header-section-number">4.1.2.1</span> Join Panel with Multiple Keys<a href="multi-dimensional-data-structures.html#join-panel-with-multiple-keys" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We have two datasets, one for student enrollment, panel over time, but some students do not show up on some dates. The other is a skeleton panel with all student ID and all dates. Often we need to join dataframes together, and we need to join by the student ID and the panel time Key at the same time. When students show up, there is a quiz score for that day, so the joined panel should have as data column quiz score</p>
<p>Student count is <span class="math inline">\(N\)</span>, total dates are <span class="math inline">\(M\)</span>. First we generate two panels below, then we join by both keys using <em>left_join</em>. First, define dataframes:</p>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb412-1"><a href="multi-dimensional-data-structures.html#cb412-1" tabindex="-1"></a><span class="co"># Define</span></span>
<span id="cb412-2"><a href="multi-dimensional-data-structures.html#cb412-2" tabindex="-1"></a>it_N <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb412-3"><a href="multi-dimensional-data-structures.html#cb412-3" tabindex="-1"></a>it_M <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb412-4"><a href="multi-dimensional-data-structures.html#cb412-4" tabindex="-1"></a>svr_id <span class="ot">&lt;-</span> <span class="st">&#39;sid&#39;</span></span>
<span id="cb412-5"><a href="multi-dimensional-data-structures.html#cb412-5" tabindex="-1"></a>svr_date <span class="ot">&lt;-</span> <span class="st">&#39;classday&#39;</span></span>
<span id="cb412-6"><a href="multi-dimensional-data-structures.html#cb412-6" tabindex="-1"></a>svr_attend <span class="ot">&lt;-</span> <span class="st">&#39;date_in_class&#39;</span></span>
<span id="cb412-7"><a href="multi-dimensional-data-structures.html#cb412-7" tabindex="-1"></a></span>
<span id="cb412-8"><a href="multi-dimensional-data-structures.html#cb412-8" tabindex="-1"></a><span class="co"># Panel Skeleton</span></span>
<span id="cb412-9"><a href="multi-dimensional-data-structures.html#cb412-9" tabindex="-1"></a>df_panel_balanced_skeleton <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">matrix</span>(it_M, <span class="at">nrow=</span>it_N, <span class="at">ncol=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb412-10"><a href="multi-dimensional-data-structures.html#cb412-10" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="at">var =</span> svr_id) <span class="sc">%&gt;%</span></span>
<span id="cb412-11"><a href="multi-dimensional-data-structures.html#cb412-11" tabindex="-1"></a>  <span class="fu">uncount</span>(V1) <span class="sc">%&gt;%</span></span>
<span id="cb412-12"><a href="multi-dimensional-data-structures.html#cb412-12" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_id)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_date) <span class="sc">:=</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb412-13"><a href="multi-dimensional-data-structures.html#cb412-13" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb412-14"><a href="multi-dimensional-data-structures.html#cb412-14" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb412-15"><a href="multi-dimensional-data-structures.html#cb412-15" tabindex="-1"></a><span class="fu">kable</span>(df_panel_balanced_skeleton) <span class="sc">%&gt;%</span></span>
<span id="cb412-16"><a href="multi-dimensional-data-structures.html#cb412-16" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
classday
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb413-1"><a href="multi-dimensional-data-structures.html#cb413-1" tabindex="-1"></a><span class="co"># Smaller Panel of Random Days in School</span></span>
<span id="cb413-2"><a href="multi-dimensional-data-structures.html#cb413-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">456</span>)</span>
<span id="cb413-3"><a href="multi-dimensional-data-structures.html#cb413-3" tabindex="-1"></a>df_panel_attend <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">matrix</span>(it_M, <span class="at">nrow=</span>it_N, <span class="at">ncol=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb413-4"><a href="multi-dimensional-data-structures.html#cb413-4" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="at">var =</span> svr_id) <span class="sc">%&gt;%</span></span>
<span id="cb413-5"><a href="multi-dimensional-data-structures.html#cb413-5" tabindex="-1"></a>  <span class="fu">uncount</span>(V1) <span class="sc">%&gt;%</span></span>
<span id="cb413-6"><a href="multi-dimensional-data-structures.html#cb413-6" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_id)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_date) <span class="sc">:=</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb413-7"><a href="multi-dimensional-data-structures.html#cb413-7" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">in_class =</span> <span class="fu">case_when</span>(<span class="fu">rnorm</span>(<span class="fu">n</span>(),<span class="at">mean=</span><span class="dv">0</span>,<span class="at">sd=</span><span class="dv">1</span>) <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">1</span>, <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb413-8"><a href="multi-dimensional-data-structures.html#cb413-8" tabindex="-1"></a>  <span class="fu">filter</span>(in_class <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_id), <span class="sc">!!</span><span class="fu">sym</span>(svr_date)) <span class="sc">%&gt;%</span></span>
<span id="cb413-9"><a href="multi-dimensional-data-structures.html#cb413-9" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_attend) <span class="sc">:=</span> <span class="sc">!!</span><span class="fu">sym</span>(svr_date)) <span class="sc">%&gt;%</span></span>
<span id="cb413-10"><a href="multi-dimensional-data-structures.html#cb413-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dayquizscore =</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(),<span class="at">mean=</span><span class="dv">80</span>,<span class="at">sd=</span><span class="dv">10</span>))</span>
<span id="cb413-11"><a href="multi-dimensional-data-structures.html#cb413-11" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb413-12"><a href="multi-dimensional-data-structures.html#cb413-12" tabindex="-1"></a><span class="fu">kable</span>(df_panel_attend) <span class="sc">%&gt;%</span></span>
<span id="cb413-13"><a href="multi-dimensional-data-structures.html#cb413-13" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date_in_class
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dayquizscore
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
89.88726
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
96.53929
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
65.59195
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
99.47356
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
97.36936
</td>
</tr>
</tbody>
</table>
<p>Second, now join dataframes:</p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="multi-dimensional-data-structures.html#cb414-1" tabindex="-1"></a><span class="co"># Join with explicit names</span></span>
<span id="cb414-2"><a href="multi-dimensional-data-structures.html#cb414-2" tabindex="-1"></a>df_quiz_joined_multikey <span class="ot">&lt;-</span> df_panel_balanced_skeleton <span class="sc">%&gt;%</span></span>
<span id="cb414-3"><a href="multi-dimensional-data-structures.html#cb414-3" tabindex="-1"></a>  <span class="fu">left_join</span>(df_panel_attend,</span>
<span id="cb414-4"><a href="multi-dimensional-data-structures.html#cb414-4" tabindex="-1"></a>            <span class="at">by=</span>(<span class="fu">c</span>(<span class="st">&#39;sid&#39;</span><span class="ot">=</span><span class="st">&#39;sid&#39;</span>, <span class="st">&#39;classday&#39;</span><span class="ot">=</span><span class="st">&#39;date_in_class&#39;</span>)))</span>
<span id="cb414-5"><a href="multi-dimensional-data-structures.html#cb414-5" tabindex="-1"></a></span>
<span id="cb414-6"><a href="multi-dimensional-data-structures.html#cb414-6" tabindex="-1"></a><span class="co"># Join with setname strings</span></span>
<span id="cb414-7"><a href="multi-dimensional-data-structures.html#cb414-7" tabindex="-1"></a>df_quiz_joined_multikey_setnames <span class="ot">&lt;-</span> df_panel_balanced_skeleton <span class="sc">%&gt;%</span></span>
<span id="cb414-8"><a href="multi-dimensional-data-structures.html#cb414-8" tabindex="-1"></a>  <span class="fu">left_join</span>(df_panel_attend, <span class="at">by=</span><span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">&#39;sid&#39;</span>, <span class="st">&#39;date_in_class&#39;</span>), <span class="fu">c</span>(<span class="st">&#39;sid&#39;</span>, <span class="st">&#39;classday&#39;</span>)))</span>
<span id="cb414-9"><a href="multi-dimensional-data-structures.html#cb414-9" tabindex="-1"></a></span>
<span id="cb414-10"><a href="multi-dimensional-data-structures.html#cb414-10" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb414-11"><a href="multi-dimensional-data-structures.html#cb414-11" tabindex="-1"></a><span class="fu">kable</span>(df_quiz_joined_multikey) <span class="sc">%&gt;%</span></span>
<span id="cb414-12"><a href="multi-dimensional-data-structures.html#cb414-12" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
classday
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dayquizscore
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
89.88726
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
96.53929
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
65.59195
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
99.47356
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
97.36936
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb415-1"><a href="multi-dimensional-data-structures.html#cb415-1" tabindex="-1"></a><span class="fu">kable</span>(df_quiz_joined_multikey_setnames) <span class="sc">%&gt;%</span></span>
<span id="cb415-2"><a href="multi-dimensional-data-structures.html#cb415-2" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
classday
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dayquizscore
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
89.88726
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
96.53929
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
65.59195
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
99.47356
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
97.36936
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table>
</div>
<div id="stack-panel-frames-together" class="section level4 hasAnchor" number="4.1.2.2">
<h4><span class="header-section-number">4.1.2.2</span> Stack Panel Frames Together<a href="multi-dimensional-data-structures.html#stack-panel-frames-together" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>There are multiple panel dataframe, each for different subsets of dates. All variable names and units of observations are identical. Use DPLYR <a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a>.</p>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb416-1"><a href="multi-dimensional-data-structures.html#cb416-1" tabindex="-1"></a><span class="co"># Define</span></span>
<span id="cb416-2"><a href="multi-dimensional-data-structures.html#cb416-2" tabindex="-1"></a>it_N <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="co"># Number of individuals</span></span>
<span id="cb416-3"><a href="multi-dimensional-data-structures.html#cb416-3" tabindex="-1"></a>it_M <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="co"># Number of Months</span></span>
<span id="cb416-4"><a href="multi-dimensional-data-structures.html#cb416-4" tabindex="-1"></a>svr_id <span class="ot">&lt;-</span> <span class="st">&#39;sid&#39;</span></span>
<span id="cb416-5"><a href="multi-dimensional-data-structures.html#cb416-5" tabindex="-1"></a>svr_date <span class="ot">&lt;-</span> <span class="st">&#39;date&#39;</span></span>
<span id="cb416-6"><a href="multi-dimensional-data-structures.html#cb416-6" tabindex="-1"></a></span>
<span id="cb416-7"><a href="multi-dimensional-data-structures.html#cb416-7" tabindex="-1"></a><span class="co"># Panel First Half of Year</span></span>
<span id="cb416-8"><a href="multi-dimensional-data-structures.html#cb416-8" tabindex="-1"></a>df_panel_m1tom3 <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">matrix</span>(it_M, <span class="at">nrow=</span>it_N, <span class="at">ncol=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb416-9"><a href="multi-dimensional-data-structures.html#cb416-9" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="at">var =</span> svr_id) <span class="sc">%&gt;%</span></span>
<span id="cb416-10"><a href="multi-dimensional-data-structures.html#cb416-10" tabindex="-1"></a>  <span class="fu">uncount</span>(V1) <span class="sc">%&gt;%</span></span>
<span id="cb416-11"><a href="multi-dimensional-data-structures.html#cb416-11" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_id)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_date) <span class="sc">:=</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb416-12"><a href="multi-dimensional-data-structures.html#cb416-12" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb416-13"><a href="multi-dimensional-data-structures.html#cb416-13" tabindex="-1"></a></span>
<span id="cb416-14"><a href="multi-dimensional-data-structures.html#cb416-14" tabindex="-1"></a><span class="co"># Panel Second Half of Year</span></span>
<span id="cb416-15"><a href="multi-dimensional-data-structures.html#cb416-15" tabindex="-1"></a>df_panel_m4tom6 <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">matrix</span>(it_M, <span class="at">nrow=</span>it_N, <span class="at">ncol=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb416-16"><a href="multi-dimensional-data-structures.html#cb416-16" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="at">var =</span> svr_id) <span class="sc">%&gt;%</span></span>
<span id="cb416-17"><a href="multi-dimensional-data-structures.html#cb416-17" tabindex="-1"></a>  <span class="fu">uncount</span>(V1) <span class="sc">%&gt;%</span></span>
<span id="cb416-18"><a href="multi-dimensional-data-structures.html#cb416-18" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_id)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_date) <span class="sc">:=</span> <span class="fu">row_number</span>() <span class="sc">+</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb416-19"><a href="multi-dimensional-data-structures.html#cb416-19" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb416-20"><a href="multi-dimensional-data-structures.html#cb416-20" tabindex="-1"></a></span>
<span id="cb416-21"><a href="multi-dimensional-data-structures.html#cb416-21" tabindex="-1"></a><span class="co"># Bind Rows</span></span>
<span id="cb416-22"><a href="multi-dimensional-data-structures.html#cb416-22" tabindex="-1"></a>df_panel_m1tm6 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(df_panel_m1tom3, df_panel_m4tom6) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="sc">!!!</span><span class="fu">syms</span>(<span class="fu">c</span>(svr_id, svr_date)))</span>
<span id="cb416-23"><a href="multi-dimensional-data-structures.html#cb416-23" tabindex="-1"></a></span>
<span id="cb416-24"><a href="multi-dimensional-data-structures.html#cb416-24" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb416-25"><a href="multi-dimensional-data-structures.html#cb416-25" tabindex="-1"></a><span class="fu">kable</span>(df_panel_m1tom3) <span class="sc">%&gt;%</span></span>
<span id="cb416-26"><a href="multi-dimensional-data-structures.html#cb416-26" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb417-1"><a href="multi-dimensional-data-structures.html#cb417-1" tabindex="-1"></a><span class="fu">kable</span>(df_panel_m4tom6) <span class="sc">%&gt;%</span></span>
<span id="cb417-2"><a href="multi-dimensional-data-structures.html#cb417-2" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
6
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="multi-dimensional-data-structures.html#cb418-1" tabindex="-1"></a><span class="fu">kable</span>(df_panel_m1tm6) <span class="sc">%&gt;%</span></span>
<span id="cb418-2"><a href="multi-dimensional-data-structures.html#cb418-2" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
6
</td>
</tr>
</tbody>
</table>

</div>
</div>
<div id="gather-files" class="section level3 hasAnchor" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> Gather Files<a href="multi-dimensional-data-structures.html#gather-files" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> research support package, <a href="https://fanwangecon.github.io/R4Econ/">R4Econ</a> examples page, <a href="https://fanwangecon.github.io/PkgTestR/">PkgTestR</a> packaging guide, or <a href="https://fanwangecon.github.io/Stat4Econ/">Stat4Econ</a> course page.</p>
</blockquote>
<div id="stack-csv-files-together-extract-and-select-variables" class="section level4 hasAnchor" number="4.1.3.1">
<h4><span class="header-section-number">4.1.3.1</span> Stack CSV Files Together Extract and Select Variables<a href="multi-dimensional-data-structures.html#stack-csv-files-together-extract-and-select-variables" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>There are multiple csv files, each was simulated with a different combination of parameters, each file has the same columns and perhaps even the same number of rows. We want to combine the files together, and provide correct attributes to rows from each table stacked, based on each underlying csv file’s file name.</p>
<p>This is necessary, for example, when running computational exercises across EC2 instances in <a href="https://fanwangecon.github.io/Py4Econ/aws/batch/htmlpdfr/fs_aws_batch.html">batch array</a> and files are saved to different <a href="https://fanwangecon.github.io/Py4Econ/aws/s3/htmlpdfr/fs_aws_s3.html">S3</a> folders. Need to gather parallel computational results together in a single file after syncing files locally with S3.</p>
<p>In the <a href="https://github.com/FanWangEcon/R4Econ/tree/master/development/inout/_file/csv">csv</a> folder under this section, there are four subfolder, each containing 3 files with identical file structures.</p>
<p>We want to find the relevant csv files from these directories, and stack the results together.</p>
<ol style="list-style-type: decimal">
<li>File search search string, search in all subfolders, the search string contains file prefix that is common across files that need to be gathered.</li>
<li>Extract path folder hierarchy, each layer of folder is a different variable</li>
<li>Stack files together, with variables for file name and folder name</li>
<li>Extract from file name the component that is not in the search string, keep as separate variable</li>
<li>Follow specific rules about how file suffix is constructed to obtain additional variables.</li>
<li>Keep only a subset of columns of interest.</li>
</ol>
<p>First, <a href="https://fanwangecon.github.io/R4Econ/development/inout/htmlpdfr/fs_rmd_pdf_html.html#11_Search_and_Find_all_Files_in_Repository">search and find</a> all files with certain prefix.</p>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb419-1"><a href="multi-dimensional-data-structures.html#cb419-1" tabindex="-1"></a><span class="co"># can search in multiple paths, second path here has no relevant contents</span></span>
<span id="cb419-2"><a href="multi-dimensional-data-structures.html#cb419-2" tabindex="-1"></a>spt_roots <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;C:/Users/fan/R4Econ/panel/basic/_file/csv&#39;</span>,</span>
<span id="cb419-3"><a href="multi-dimensional-data-structures.html#cb419-3" tabindex="-1"></a>               <span class="st">&#39;C:/Users/fan/R4Econ/panel/basic/_file/tex&#39;</span>)</span>
<span id="cb419-4"><a href="multi-dimensional-data-structures.html#cb419-4" tabindex="-1"></a><span class="co"># can skip file names with certain strings</span></span>
<span id="cb419-5"><a href="multi-dimensional-data-structures.html#cb419-5" tabindex="-1"></a>spn_skip <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;A3420&#39;</span>)</span>
<span id="cb419-6"><a href="multi-dimensional-data-structures.html#cb419-6" tabindex="-1"></a><span class="co"># prefix search patther,</span></span>
<span id="cb419-7"><a href="multi-dimensional-data-structures.html#cb419-7" tabindex="-1"></a>st_search_str <span class="ot">&lt;-</span> <span class="st">&#39;solu_19E1NEp99r99x_ITG_PE_cev_*&#39;</span></span>
<span id="cb419-8"><a href="multi-dimensional-data-structures.html#cb419-8" tabindex="-1"></a></span>
<span id="cb419-9"><a href="multi-dimensional-data-structures.html#cb419-9" tabindex="-1"></a><span class="co"># Search and get all Path</span></span>
<span id="cb419-10"><a href="multi-dimensional-data-structures.html#cb419-10" tabindex="-1"></a>ls_sfls <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path=</span>spt_roots,</span>
<span id="cb419-11"><a href="multi-dimensional-data-structures.html#cb419-11" tabindex="-1"></a>                      <span class="at">recursive=</span>T,</span>
<span id="cb419-12"><a href="multi-dimensional-data-structures.html#cb419-12" tabindex="-1"></a>                      <span class="at">pattern=</span>st_search_str,</span>
<span id="cb419-13"><a href="multi-dimensional-data-structures.html#cb419-13" tabindex="-1"></a>                      <span class="at">full.names=</span>T)</span>
<span id="cb419-14"><a href="multi-dimensional-data-structures.html#cb419-14" tabindex="-1"></a></span>
<span id="cb419-15"><a href="multi-dimensional-data-structures.html#cb419-15" tabindex="-1"></a><span class="co"># Skip path if contains words in skip list</span></span>
<span id="cb419-16"><a href="multi-dimensional-data-structures.html#cb419-16" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">missing</span>(spn_skip)) {</span>
<span id="cb419-17"><a href="multi-dimensional-data-structures.html#cb419-17" tabindex="-1"></a>  ls_sfls <span class="ot">&lt;-</span> ls_sfls[<span class="sc">!</span><span class="fu">grepl</span>(<span class="fu">paste</span>(spn_skip, <span class="at">collapse =</span> <span class="st">&quot;|&quot;</span>), ls_sfls)]</span>
<span id="cb419-18"><a href="multi-dimensional-data-structures.html#cb419-18" tabindex="-1"></a>}</span></code></pre></div>
<p>Second, show all the files found, show their full path, the file name and the two folder names above the file name.</p>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb420-1"><a href="multi-dimensional-data-structures.html#cb420-1" tabindex="-1"></a><span class="co"># Loop and print found files</span></span>
<span id="cb420-2"><a href="multi-dimensional-data-structures.html#cb420-2" tabindex="-1"></a>it_folders_names_to_keep <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb420-3"><a href="multi-dimensional-data-structures.html#cb420-3" tabindex="-1"></a><span class="cf">for</span> (spt_file <span class="cf">in</span> ls_sfls) {</span>
<span id="cb420-4"><a href="multi-dimensional-data-structures.html#cb420-4" tabindex="-1"></a>    ls_srt_folders_name_keep <span class="ot">&lt;-</span> <span class="fu">tail</span>(<span class="fu">strsplit</span>(spt_file, <span class="st">&quot;/&quot;</span>)[[<span class="dv">1</span>]], <span class="at">n=</span>it_folders_names_to_keep<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb420-5"><a href="multi-dimensional-data-structures.html#cb420-5" tabindex="-1"></a>    snm_file_name <span class="ot">&lt;-</span> <span class="fu">tail</span>(ls_srt_folders_name_keep, <span class="dv">1</span>)</span>
<span id="cb420-6"><a href="multi-dimensional-data-structures.html#cb420-6" tabindex="-1"></a>    ls_srt_folders_keep <span class="ot">&lt;-</span> <span class="fu">head</span>(ls_srt_folders_name_keep, it_folders_names_to_keep)</span>
<span id="cb420-7"><a href="multi-dimensional-data-structures.html#cb420-7" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&#39;path:&#39;</span>, spt_file))</span>
<span id="cb420-8"><a href="multi-dimensional-data-structures.html#cb420-8" tabindex="-1"></a>    <span class="fu">print</span>(snm_file_name)</span>
<span id="cb420-9"><a href="multi-dimensional-data-structures.html#cb420-9" tabindex="-1"></a>    <span class="fu">print</span>(ls_srt_folders_keep)</span>
<span id="cb420-10"><a href="multi-dimensional-data-structures.html#cb420-10" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;path:C:/Users/fan/R4Econ/panel/basic/_file/csv/cev-2000/solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000_A0.csv&quot;
## [1] &quot;solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000_A0.csv&quot;
## [1] &quot;csv&quot;      &quot;cev-2000&quot;
## [1] &quot;path:C:/Users/fan/R4Econ/panel/basic/_file/csv/cev-2000/solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000_A6840.csv&quot;
## [1] &quot;solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000_A6840.csv&quot;
## [1] &quot;csv&quot;      &quot;cev-2000&quot;
## [1] &quot;path:C:/Users/fan/R4Econ/panel/basic/_file/csv/cev-947/solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947_A0.csv&quot;
## [1] &quot;solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947_A0.csv&quot;
## [1] &quot;csv&quot;     &quot;cev-947&quot;
## [1] &quot;path:C:/Users/fan/R4Econ/panel/basic/_file/csv/cev-947/solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947_A6840.csv&quot;
## [1] &quot;solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947_A6840.csv&quot;
## [1] &quot;csv&quot;     &quot;cev-947&quot;
## [1] &quot;path:C:/Users/fan/R4Econ/panel/basic/_file/csv/cev2000/solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000_A0.csv&quot;
## [1] &quot;solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000_A0.csv&quot;
## [1] &quot;csv&quot;     &quot;cev2000&quot;
## [1] &quot;path:C:/Users/fan/R4Econ/panel/basic/_file/csv/cev2000/solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000_A6840.csv&quot;
## [1] &quot;solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000_A6840.csv&quot;
## [1] &quot;csv&quot;     &quot;cev2000&quot;
## [1] &quot;path:C:/Users/fan/R4Econ/panel/basic/_file/csv/cev947/solu_19E1NEp99r99x_ITG_PE_cev_c14_cev947_A0.csv&quot;
## [1] &quot;solu_19E1NEp99r99x_ITG_PE_cev_c14_cev947_A0.csv&quot;
## [1] &quot;csv&quot;    &quot;cev947&quot;
## [1] &quot;path:C:/Users/fan/R4Econ/panel/basic/_file/csv/cev947/solu_19E1NEp99r99x_ITG_PE_cev_c14_cev947_A6840.csv&quot;
## [1] &quot;solu_19E1NEp99r99x_ITG_PE_cev_c14_cev947_A6840.csv&quot;
## [1] &quot;csv&quot;    &quot;cev947&quot;</code></pre>
<p>Third, create a dataframe with the folder and file names:</p>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb422-1"><a href="multi-dimensional-data-structures.html#cb422-1" tabindex="-1"></a><span class="co"># String matrix empty</span></span>
<span id="cb422-2"><a href="multi-dimensional-data-structures.html#cb422-2" tabindex="-1"></a>mt_st_paths_names <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span><span class="cn">NA</span>, <span class="at">nrow=</span><span class="fu">length</span>(ls_sfls), <span class="at">ncol=</span><span class="dv">4</span>)</span>
<span id="cb422-3"><a href="multi-dimensional-data-structures.html#cb422-3" tabindex="-1"></a></span>
<span id="cb422-4"><a href="multi-dimensional-data-structures.html#cb422-4" tabindex="-1"></a><span class="co"># Loop and print found files</span></span>
<span id="cb422-5"><a href="multi-dimensional-data-structures.html#cb422-5" tabindex="-1"></a>it_folders_names_to_keep <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb422-6"><a href="multi-dimensional-data-structures.html#cb422-6" tabindex="-1"></a>it_file_counter <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb422-7"><a href="multi-dimensional-data-structures.html#cb422-7" tabindex="-1"></a><span class="cf">for</span> (spt_file <span class="cf">in</span> ls_sfls) {</span>
<span id="cb422-8"><a href="multi-dimensional-data-structures.html#cb422-8" tabindex="-1"></a>    <span class="co"># row counter</span></span>
<span id="cb422-9"><a href="multi-dimensional-data-structures.html#cb422-9" tabindex="-1"></a>    it_file_counter <span class="ot">=</span> it_file_counter <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb422-10"><a href="multi-dimensional-data-structures.html#cb422-10" tabindex="-1"></a></span>
<span id="cb422-11"><a href="multi-dimensional-data-structures.html#cb422-11" tabindex="-1"></a>    <span class="co"># get file paths</span></span>
<span id="cb422-12"><a href="multi-dimensional-data-structures.html#cb422-12" tabindex="-1"></a>    ls_srt_folders_name_keep <span class="ot">&lt;-</span> <span class="fu">tail</span>(<span class="fu">strsplit</span>(spt_file, <span class="st">&quot;/&quot;</span>)[[<span class="dv">1</span>]], <span class="at">n=</span>it_folders_names_to_keep<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb422-13"><a href="multi-dimensional-data-structures.html#cb422-13" tabindex="-1"></a>    snm_file_name <span class="ot">&lt;-</span> <span class="fu">tail</span>(ls_srt_folders_name_keep, <span class="dv">1</span>)</span>
<span id="cb422-14"><a href="multi-dimensional-data-structures.html#cb422-14" tabindex="-1"></a>    ls_srt_folders_keep <span class="ot">&lt;-</span> <span class="fu">head</span>(ls_srt_folders_name_keep, it_folders_names_to_keep)</span>
<span id="cb422-15"><a href="multi-dimensional-data-structures.html#cb422-15" tabindex="-1"></a></span>
<span id="cb422-16"><a href="multi-dimensional-data-structures.html#cb422-16" tabindex="-1"></a>    <span class="co"># store</span></span>
<span id="cb422-17"><a href="multi-dimensional-data-structures.html#cb422-17" tabindex="-1"></a>    <span class="co"># tools::file_path_sans_ext to drop suffix</span></span>
<span id="cb422-18"><a href="multi-dimensional-data-structures.html#cb422-18" tabindex="-1"></a>    mt_st_paths_names[it_file_counter,<span class="dv">1</span>] <span class="ot">=</span> tools<span class="sc">::</span><span class="fu">file_path_sans_ext</span>(snm_file_name)</span>
<span id="cb422-19"><a href="multi-dimensional-data-structures.html#cb422-19" tabindex="-1"></a>    mt_st_paths_names[it_file_counter,<span class="dv">2</span>] <span class="ot">=</span> ls_srt_folders_keep[<span class="dv">1</span>]</span>
<span id="cb422-20"><a href="multi-dimensional-data-structures.html#cb422-20" tabindex="-1"></a>    mt_st_paths_names[it_file_counter,<span class="dv">3</span>] <span class="ot">=</span> ls_srt_folders_keep[<span class="dv">2</span>]</span>
<span id="cb422-21"><a href="multi-dimensional-data-structures.html#cb422-21" tabindex="-1"></a>    mt_st_paths_names[it_file_counter,<span class="dv">4</span>] <span class="ot">=</span> spt_file</span>
<span id="cb422-22"><a href="multi-dimensional-data-structures.html#cb422-22" tabindex="-1"></a>}</span>
<span id="cb422-23"><a href="multi-dimensional-data-structures.html#cb422-23" tabindex="-1"></a></span>
<span id="cb422-24"><a href="multi-dimensional-data-structures.html#cb422-24" tabindex="-1"></a><span class="co"># Column Names</span></span>
<span id="cb422-25"><a href="multi-dimensional-data-structures.html#cb422-25" tabindex="-1"></a>ar_st_varnames <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;fileid&#39;</span>,<span class="st">&#39;name&#39;</span>,<span class="st">&#39;folder1&#39;</span>,<span class="st">&#39;folder2&#39;</span>, <span class="st">&#39;fullpath&#39;</span>)</span>
<span id="cb422-26"><a href="multi-dimensional-data-structures.html#cb422-26" tabindex="-1"></a></span>
<span id="cb422-27"><a href="multi-dimensional-data-structures.html#cb422-27" tabindex="-1"></a><span class="co"># Combine to tibble, add name col1, col2, etc.</span></span>
<span id="cb422-28"><a href="multi-dimensional-data-structures.html#cb422-28" tabindex="-1"></a>tb_csv_info <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(mt_st_paths_names) <span class="sc">%&gt;%</span></span>
<span id="cb422-29"><a href="multi-dimensional-data-structures.html#cb422-29" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">&quot;id&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb422-30"><a href="multi-dimensional-data-structures.html#cb422-30" tabindex="-1"></a>  <span class="fu">rename_all</span>(<span class="sc">~</span><span class="fu">c</span>(ar_st_varnames))</span>
<span id="cb422-31"><a href="multi-dimensional-data-structures.html#cb422-31" tabindex="-1"></a></span>
<span id="cb422-32"><a href="multi-dimensional-data-structures.html#cb422-32" tabindex="-1"></a><span class="co"># Display</span></span>
<span id="cb422-33"><a href="multi-dimensional-data-structures.html#cb422-33" tabindex="-1"></a><span class="fu">kable</span>(tb_csv_info[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fileid
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
name
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
folder1
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
folder2
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000_A0
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:left;">
cev-2000
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000_A6840
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:left;">
cev-2000
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947_A0
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:left;">
cev-947
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947_A6840
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:left;">
cev-947
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000_A0
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:left;">
cev2000
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000_A6840
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:left;">
cev2000
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c14_cev947_A0
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:left;">
cev947
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c14_cev947_A6840
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:left;">
cev947
</td>
</tr>
</tbody>
</table>
<p>Fourth, create a dataframe by expanding each row with the datafile loaded in, use <a href="https://fanwangecon.github.io/R4Econ/function/noloop/htmlpdfr/fs_apply.html#122_anonymous_function">apply with anonymous function</a>.</p>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="multi-dimensional-data-structures.html#cb423-1" tabindex="-1"></a><span class="co"># Generate a list of dataframes</span></span>
<span id="cb423-2"><a href="multi-dimensional-data-structures.html#cb423-2" tabindex="-1"></a>ls_df_loaded_files <span class="ot">=</span></span>
<span id="cb423-3"><a href="multi-dimensional-data-structures.html#cb423-3" tabindex="-1"></a>  <span class="fu">apply</span>(tb_csv_info,</span>
<span id="cb423-4"><a href="multi-dimensional-data-structures.html#cb423-4" tabindex="-1"></a>        <span class="dv">1</span>,</span>
<span id="cb423-5"><a href="multi-dimensional-data-structures.html#cb423-5" tabindex="-1"></a>        <span class="cf">function</span>(row) {</span>
<span id="cb423-6"><a href="multi-dimensional-data-structures.html#cb423-6" tabindex="-1"></a>          <span class="co"># Loading file</span></span>
<span id="cb423-7"><a href="multi-dimensional-data-structures.html#cb423-7" tabindex="-1"></a>          spn_full_path <span class="ot">&lt;-</span> row[<span class="dv">5</span>]</span>
<span id="cb423-8"><a href="multi-dimensional-data-structures.html#cb423-8" tabindex="-1"></a>          mt_csv <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="at">file =</span> spn_full_path)</span>
<span id="cb423-9"><a href="multi-dimensional-data-structures.html#cb423-9" tabindex="-1"></a>          <span class="co"># dataframe</span></span>
<span id="cb423-10"><a href="multi-dimensional-data-structures.html#cb423-10" tabindex="-1"></a>          it_fileid <span class="ot">&lt;-</span> row[<span class="dv">1</span>]</span>
<span id="cb423-11"><a href="multi-dimensional-data-structures.html#cb423-11" tabindex="-1"></a>          snm_filename <span class="ot">&lt;-</span> row[<span class="dv">2</span>]</span>
<span id="cb423-12"><a href="multi-dimensional-data-structures.html#cb423-12" tabindex="-1"></a>          srt_folder_level2 <span class="ot">&lt;-</span> row[<span class="dv">3</span>]</span>
<span id="cb423-13"><a href="multi-dimensional-data-structures.html#cb423-13" tabindex="-1"></a>          srt_folder_level1 <span class="ot">&lt;-</span> row[<span class="dv">4</span>]</span>
<span id="cb423-14"><a href="multi-dimensional-data-structures.html#cb423-14" tabindex="-1"></a></span>
<span id="cb423-15"><a href="multi-dimensional-data-structures.html#cb423-15" tabindex="-1"></a>          tb_combine <span class="ot">=</span> <span class="fu">as_tibble</span>(mt_csv) <span class="sc">%&gt;%</span></span>
<span id="cb423-16"><a href="multi-dimensional-data-structures.html#cb423-16" tabindex="-1"></a>            na.omit <span class="sc">%&gt;%</span></span>
<span id="cb423-17"><a href="multi-dimensional-data-structures.html#cb423-17" tabindex="-1"></a>            <span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">&quot;statesid&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb423-18"><a href="multi-dimensional-data-structures.html#cb423-18" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">fileid =</span> it_fileid,</span>
<span id="cb423-19"><a href="multi-dimensional-data-structures.html#cb423-19" tabindex="-1"></a>                   <span class="at">filename =</span> snm_filename,</span>
<span id="cb423-20"><a href="multi-dimensional-data-structures.html#cb423-20" tabindex="-1"></a>                   <span class="at">folder_lvl1 =</span> srt_folder_level1,</span>
<span id="cb423-21"><a href="multi-dimensional-data-structures.html#cb423-21" tabindex="-1"></a>                   <span class="at">folder_lvl2 =</span> srt_folder_level2) <span class="sc">%&gt;%</span></span>
<span id="cb423-22"><a href="multi-dimensional-data-structures.html#cb423-22" tabindex="-1"></a>            <span class="fu">select</span>(fileid, filename, folder_lvl1, folder_lvl2,</span>
<span id="cb423-23"><a href="multi-dimensional-data-structures.html#cb423-23" tabindex="-1"></a>                   statesid, <span class="fu">everything</span>())</span>
<span id="cb423-24"><a href="multi-dimensional-data-structures.html#cb423-24" tabindex="-1"></a>          <span class="co"># return</span></span>
<span id="cb423-25"><a href="multi-dimensional-data-structures.html#cb423-25" tabindex="-1"></a>          <span class="fu">return</span>(tb_combine)</span>
<span id="cb423-26"><a href="multi-dimensional-data-structures.html#cb423-26" tabindex="-1"></a>        })</span>
<span id="cb423-27"><a href="multi-dimensional-data-structures.html#cb423-27" tabindex="-1"></a></span>
<span id="cb423-28"><a href="multi-dimensional-data-structures.html#cb423-28" tabindex="-1"></a><span class="co"># Stack dataframes together</span></span>
<span id="cb423-29"><a href="multi-dimensional-data-structures.html#cb423-29" tabindex="-1"></a>df_all_files <span class="ot">=</span> <span class="fu">do.call</span>(bind_rows, ls_df_loaded_files)</span>
<span id="cb423-30"><a href="multi-dimensional-data-structures.html#cb423-30" tabindex="-1"></a></span>
<span id="cb423-31"><a href="multi-dimensional-data-structures.html#cb423-31" tabindex="-1"></a><span class="co"># show stacked table</span></span>
<span id="cb423-32"><a href="multi-dimensional-data-structures.html#cb423-32" tabindex="-1"></a><span class="fu">kable</span>(df_all_files[<span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">601</span>,<span class="dv">50</span>),<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc_wide</span>()</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:875px; ">
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
fileid
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
filename
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
folder_lvl1
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
folder_lvl2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
statesid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
EjV
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000_A0
</td>
<td style="text-align:left;">
cev-2000
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-28.8586860
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000_A0
</td>
<td style="text-align:left;">
cev-2000
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
51
</td>
<td style="text-align:right;">
-0.2106603
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000_A6840
</td>
<td style="text-align:left;">
cev-2000
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
-28.8586860
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000_A6840
</td>
<td style="text-align:left;">
cev-2000
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
53
</td>
<td style="text-align:right;">
-0.0642997
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947_A0
</td>
<td style="text-align:left;">
cev-947
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
-5.8826609
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947_A0
</td>
<td style="text-align:left;">
cev-947
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
55
</td>
<td style="text-align:right;">
0.0353187
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947_A6840
</td>
<td style="text-align:left;">
cev-947
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
-2.7046907
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947_A6840
</td>
<td style="text-align:left;">
cev-947
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
57
</td>
<td style="text-align:right;">
0.1094474
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000_A0
</td>
<td style="text-align:left;">
cev2000
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
-2.9782236
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000_A0
</td>
<td style="text-align:left;">
cev2000
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
59
</td>
<td style="text-align:right;">
0.3389275
</td>
</tr>
<tr>
<td style="text-align:left;">
6
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000_A6840
</td>
<td style="text-align:left;">
cev2000
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
-1.7229647
</td>
</tr>
<tr>
<td style="text-align:left;">
6
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000_A6840
</td>
<td style="text-align:left;">
cev2000
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
61
</td>
<td style="text-align:right;">
-14.6880377
</td>
</tr>
<tr>
<td style="text-align:left;">
7
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c14_cev947_A0
</td>
<td style="text-align:left;">
cev947
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
-1.7623279
</td>
</tr>
</tbody>
</table>
</div>
<p>Fifth, get additional information from the file name and file folder. Extract those as separate variables. The file names is dash connected, with various information. First, split just the final element of the string file name out, which is <em>A###</em>. Then, also extract the number next to N as a separate numeric column. Additional <em>folder_lvl1</em> separate out the numeric number from the initial word <em>cev</em>.</p>
<p><a href="https://stackoverflow.com/a/50518154/8280804">Split “solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000_A###” to “solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000” and “A###”</a>:</p>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb424-1"><a href="multi-dimensional-data-structures.html#cb424-1" tabindex="-1"></a><span class="co"># separate last eleemtnafter underscore</span></span>
<span id="cb424-2"><a href="multi-dimensional-data-structures.html#cb424-2" tabindex="-1"></a>df_all_files_finalA <span class="ot">&lt;-</span> df_all_files <span class="sc">%&gt;%</span></span>
<span id="cb424-3"><a href="multi-dimensional-data-structures.html#cb424-3" tabindex="-1"></a>   <span class="fu">separate</span>(filename, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;filename_main&quot;</span>, <span class="st">&quot;prod_type_st&quot;</span>),</span>
<span id="cb424-4"><a href="multi-dimensional-data-structures.html#cb424-4" tabindex="-1"></a>            <span class="at">sep=</span><span class="st">&quot;_(?=[^_]+$)&quot;</span>,</span>
<span id="cb424-5"><a href="multi-dimensional-data-structures.html#cb424-5" tabindex="-1"></a>            <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb424-6"><a href="multi-dimensional-data-structures.html#cb424-6" tabindex="-1"></a>   <span class="fu">select</span>(fileid, filename, filename_main, prod_type_st, folder_lvl1, folder_lvl2,</span>
<span id="cb424-7"><a href="multi-dimensional-data-structures.html#cb424-7" tabindex="-1"></a>          statesid, <span class="fu">everything</span>())</span>
<span id="cb424-8"><a href="multi-dimensional-data-structures.html#cb424-8" tabindex="-1"></a><span class="co"># show stacked table</span></span>
<span id="cb424-9"><a href="multi-dimensional-data-structures.html#cb424-9" tabindex="-1"></a><span class="fu">kable</span>(df_all_files_finalA[<span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">601</span>,<span class="dv">50</span>),<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc_wide</span>()</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:875px; ">
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
fileid
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
filename
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
filename_main
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
prod_type_st
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
folder_lvl1
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
folder_lvl2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
statesid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
EjV
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
k_tt
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
b_tt
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000_A0
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:left;">
cev-2000
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-28.8586860
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0.000000
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000_A0
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:left;">
cev-2000
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
51
</td>
<td style="text-align:right;">
-0.2106603
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
78.005300
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000_A6840
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000
</td>
<td style="text-align:left;">
A6840
</td>
<td style="text-align:left;">
cev-2000
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
-28.8586860
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0.000000
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000_A6840
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c0_cev-2000
</td>
<td style="text-align:left;">
A6840
</td>
<td style="text-align:left;">
cev-2000
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
53
</td>
<td style="text-align:right;">
-0.0642997
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
84.215368
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947_A0
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:left;">
cev-947
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
-5.8826609
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
3.869909
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947_A0
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:left;">
cev-947
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
55
</td>
<td style="text-align:right;">
0.0353187
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
90.611739
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947_A6840
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947
</td>
<td style="text-align:left;">
A6840
</td>
<td style="text-align:left;">
cev-947
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
-2.7046907
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
7.855916
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947_A6840
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c5_cev-947
</td>
<td style="text-align:left;">
A6840
</td>
<td style="text-align:left;">
cev-947
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
57
</td>
<td style="text-align:right;">
0.1094474
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
90.611739
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000_A0
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:left;">
cev2000
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
-2.9782236
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
7.855916
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000_A0
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:left;">
cev2000
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
59
</td>
<td style="text-align:right;">
0.3389275
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
97.200000
</td>
</tr>
<tr>
<td style="text-align:left;">
6
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000_A6840
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000
</td>
<td style="text-align:left;">
A6840
</td>
<td style="text-align:left;">
cev2000
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
-1.7229647
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
11.961502
</td>
</tr>
<tr>
<td style="text-align:left;">
6
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000_A6840
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c19_cev2000
</td>
<td style="text-align:left;">
A6840
</td>
<td style="text-align:left;">
cev2000
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
61
</td>
<td style="text-align:right;">
-14.6880377
</td>
<td style="text-align:right;">
1.990694
</td>
<td style="text-align:right;">
-1.879215
</td>
</tr>
<tr>
<td style="text-align:left;">
7
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c14_cev947_A0
</td>
<td style="text-align:left;">
solu_19E1NEp99r99x_ITG_PE_cev_c14_cev947
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:left;">
cev947
</td>
<td style="text-align:left;">
csv
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
-1.7623279
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
16.190257
</td>
</tr>
</tbody>
</table>
</div>
<p><a href="https://stackoverflow.com/a/47673097/8280804">Split “A###” to “A” and “A###”</a>. Additionally, also split <em>cev####</em> to <em>cev</em> and <em>####</em>, allow for positive and negative numbers. <a href="https://regex101.com">See regular expression 101 helper</a></p>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb425-1"><a href="multi-dimensional-data-structures.html#cb425-1" tabindex="-1"></a><span class="co"># string and number separation</span></span>
<span id="cb425-2"><a href="multi-dimensional-data-structures.html#cb425-2" tabindex="-1"></a>df_all_files_finalB <span class="ot">&lt;-</span> df_all_files_finalA <span class="sc">%&gt;%</span></span>
<span id="cb425-3"><a href="multi-dimensional-data-structures.html#cb425-3" tabindex="-1"></a>  <span class="fu">separate</span>(prod_type_st,</span>
<span id="cb425-4"><a href="multi-dimensional-data-structures.html#cb425-4" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;prod_type_st_prefix&quot;</span>, <span class="st">&quot;prod_type_lvl&quot;</span>),</span>
<span id="cb425-5"><a href="multi-dimensional-data-structures.html#cb425-5" tabindex="-1"></a>           <span class="at">sep=</span><span class="st">&quot;(?&lt;=[A-Za-z])(?=[-0-9])&quot;</span>, <span class="co"># positive or negative numbers</span></span>
<span id="cb425-6"><a href="multi-dimensional-data-structures.html#cb425-6" tabindex="-1"></a>           <span class="at">remove=</span><span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb425-7"><a href="multi-dimensional-data-structures.html#cb425-7" tabindex="-1"></a>  <span class="fu">separate</span>(folder_lvl1,</span>
<span id="cb425-8"><a href="multi-dimensional-data-structures.html#cb425-8" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;cev_prefix&quot;</span>, <span class="st">&quot;cev_lvl&quot;</span>),</span>
<span id="cb425-9"><a href="multi-dimensional-data-structures.html#cb425-9" tabindex="-1"></a>           <span class="at">sep=</span><span class="st">&quot;(?&lt;=[A-Za-z])(?=[-0-9])&quot;</span>, <span class="co"># positive or negative numbers</span></span>
<span id="cb425-10"><a href="multi-dimensional-data-structures.html#cb425-10" tabindex="-1"></a>           <span class="at">remove=</span><span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb425-11"><a href="multi-dimensional-data-structures.html#cb425-11" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cev_st =</span> folder_lvl1,</span>
<span id="cb425-12"><a href="multi-dimensional-data-structures.html#cb425-12" tabindex="-1"></a>         <span class="at">prod_type_lvl =</span> <span class="fu">as.numeric</span>(prod_type_lvl),</span>
<span id="cb425-13"><a href="multi-dimensional-data-structures.html#cb425-13" tabindex="-1"></a>         <span class="at">cev_lvl =</span> <span class="fu">as.numeric</span>(cev_lvl)<span class="sc">/</span><span class="dv">10000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb425-14"><a href="multi-dimensional-data-structures.html#cb425-14" tabindex="-1"></a>  <span class="fu">select</span>(fileid,</span>
<span id="cb425-15"><a href="multi-dimensional-data-structures.html#cb425-15" tabindex="-1"></a>         prod_type_st, prod_type_lvl,</span>
<span id="cb425-16"><a href="multi-dimensional-data-structures.html#cb425-16" tabindex="-1"></a>         cev_st, cev_lvl,</span>
<span id="cb425-17"><a href="multi-dimensional-data-structures.html#cb425-17" tabindex="-1"></a>         statesid, EjV,</span>
<span id="cb425-18"><a href="multi-dimensional-data-structures.html#cb425-18" tabindex="-1"></a>         filename, folder_lvl1, folder_lvl2)</span>
<span id="cb425-19"><a href="multi-dimensional-data-structures.html#cb425-19" tabindex="-1"></a><span class="co"># Ordering, sort by cev_lvl, then prod_type_lvl, then stateid</span></span>
<span id="cb425-20"><a href="multi-dimensional-data-structures.html#cb425-20" tabindex="-1"></a>df_all_files_finalB <span class="ot">&lt;-</span> df_all_files_finalB <span class="sc">%&gt;%</span></span>
<span id="cb425-21"><a href="multi-dimensional-data-structures.html#cb425-21" tabindex="-1"></a>  <span class="fu">arrange</span>(cev_lvl, prod_type_lvl, statesid)</span>
<span id="cb425-22"><a href="multi-dimensional-data-structures.html#cb425-22" tabindex="-1"></a><span class="co"># show stacked table</span></span>
<span id="cb425-23"><a href="multi-dimensional-data-structures.html#cb425-23" tabindex="-1"></a><span class="fu">kable</span>(df_all_files_finalB[<span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">49</span><span class="sc">*</span><span class="dv">16</span>,<span class="dv">49</span>),<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>]) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc_wide</span>()</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:875px; ">
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
fileid
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
prod_type_st
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
prod_type_lvl
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
cev_st
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
cev_lvl
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
statesid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
EjV
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
cev-2000
</td>
<td style="text-align:right;">
-0.2000
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-28.8586860
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
cev-2000
</td>
<td style="text-align:right;">
-0.2000
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
-0.2106603
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
A6840
</td>
<td style="text-align:right;">
6840
</td>
<td style="text-align:left;">
cev-2000
</td>
<td style="text-align:right;">
-0.2000
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-28.8586860
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
A6840
</td>
<td style="text-align:right;">
6840
</td>
<td style="text-align:left;">
cev-2000
</td>
<td style="text-align:right;">
-0.2000
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
-0.1311749
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
cev-947
</td>
<td style="text-align:right;">
-0.0947
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-28.0399281
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
cev-947
</td>
<td style="text-align:right;">
-0.0947
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
-0.0911499
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
A6840
</td>
<td style="text-align:right;">
6840
</td>
<td style="text-align:left;">
cev-947
</td>
<td style="text-align:right;">
-0.0947
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-28.0399281
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
A6840
</td>
<td style="text-align:right;">
6840
</td>
<td style="text-align:left;">
cev-947
</td>
<td style="text-align:right;">
-0.0947
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
-0.0134719
</td>
</tr>
<tr>
<td style="text-align:left;">
7
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
cev947
</td>
<td style="text-align:right;">
0.0947
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-26.8243673
</td>
</tr>
<tr>
<td style="text-align:left;">
7
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
cev947
</td>
<td style="text-align:right;">
0.0947
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.0857474
</td>
</tr>
<tr>
<td style="text-align:left;">
8
</td>
<td style="text-align:left;">
A6840
</td>
<td style="text-align:right;">
6840
</td>
<td style="text-align:left;">
cev947
</td>
<td style="text-align:right;">
0.0947
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-26.8243673
</td>
</tr>
<tr>
<td style="text-align:left;">
8
</td>
<td style="text-align:left;">
A6840
</td>
<td style="text-align:right;">
6840
</td>
<td style="text-align:left;">
cev947
</td>
<td style="text-align:right;">
0.0947
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.1608382
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
cev2000
</td>
<td style="text-align:right;">
0.2000
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-26.2512036
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
cev2000
</td>
<td style="text-align:right;">
0.2000
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.1694524
</td>
</tr>
<tr>
<td style="text-align:left;">
6
</td>
<td style="text-align:left;">
A6840
</td>
<td style="text-align:right;">
6840
</td>
<td style="text-align:left;">
cev2000
</td>
<td style="text-align:right;">
0.2000
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-26.2512036
</td>
</tr>
<tr>
<td style="text-align:left;">
6
</td>
<td style="text-align:left;">
A6840
</td>
<td style="text-align:right;">
6840
</td>
<td style="text-align:left;">
cev2000
</td>
<td style="text-align:right;">
0.2000
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.2432677
</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
</div>
<div id="wide-and-long" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Wide and Long<a href="multi-dimensional-data-structures.html#wide-and-long" class="anchor-section" aria-label="Anchor link to header"></a></h2>

<div id="long-table-to-wide-table" class="section level3 hasAnchor" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Long Table to Wide Table<a href="multi-dimensional-data-structures.html#long-table-to-wide-table" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> research support package, <a href="https://fanwangecon.github.io/R4Econ/">R4Econ</a> examples page, <a href="https://fanwangecon.github.io/PkgTestR/">PkgTestR</a> packaging guide, or <a href="https://fanwangecon.github.io/Stat4Econ/">Stat4Econ</a> course page.</p>
</blockquote>
<p>Using the <a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a> function in tidyr to reshape panel or other data structures</p>
<div id="compute-wide-table-cumulative-student-attendance-based-on-long-table-roster" class="section level4 hasAnchor" number="4.2.1.1">
<h4><span class="header-section-number">4.2.1.1</span> Compute Wide Table Cumulative Student Attendance based on Long Table Roster<a href="multi-dimensional-data-structures.html#compute-wide-table-cumulative-student-attendance-based-on-long-table-roster" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>There are <span class="math inline">\(N\)</span> students in class, but only a subset of them attend class each day. If student <span class="math inline">\(id_i\)</span> is in class on day <span class="math inline">\(Q\)</span>, the teacher records on a sheet the date and the student ID. So if the student has been in class 10 times, the teacher has ten rows of recorded data for the student with two columns: column one is the student ID, and column two is the date on which the student was in class.</p>
<p>Suppose there were 50 students, who on average attended exactly 10 classes each during the semester, this means we have <span class="math inline">\(10 \cdot 50\)</span> rows of data, with differing numbers of rows for each student. This is shown as <em>df_panel_attend_date</em> generated below.</p>
<p>Now we want to generate a new dataframe, where each row is a date, and each column is a student. The values in the new dataframe shows, at the <span class="math inline">\(Q^{th}\)</span> day (row), how many classes student <span class="math inline">\(i\)</span> has attended so far. The following results is also in a REconTools Function. This is shown as <em>df_attend_cumu_by_day</em> generated below.</p>
<p>First, generate the raw data structure, <em>df_panel_attend_date</em>:</p>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb426-1"><a href="multi-dimensional-data-structures.html#cb426-1" tabindex="-1"></a><span class="co"># Define</span></span>
<span id="cb426-2"><a href="multi-dimensional-data-structures.html#cb426-2" tabindex="-1"></a>it_N <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb426-3"><a href="multi-dimensional-data-structures.html#cb426-3" tabindex="-1"></a>it_M <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb426-4"><a href="multi-dimensional-data-structures.html#cb426-4" tabindex="-1"></a>svr_id <span class="ot">&lt;-</span> <span class="st">&#39;student_id&#39;</span></span>
<span id="cb426-5"><a href="multi-dimensional-data-structures.html#cb426-5" tabindex="-1"></a></span>
<span id="cb426-6"><a href="multi-dimensional-data-structures.html#cb426-6" tabindex="-1"></a><span class="co"># from : support/rand/fs_rand_draws.Rmd</span></span>
<span id="cb426-7"><a href="multi-dimensional-data-structures.html#cb426-7" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">222</span>)</span>
<span id="cb426-8"><a href="multi-dimensional-data-structures.html#cb426-8" tabindex="-1"></a>df_panel_attend_date <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">matrix</span>(it_M, <span class="at">nrow=</span>it_N, <span class="at">ncol=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb426-9"><a href="multi-dimensional-data-structures.html#cb426-9" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="at">var =</span> svr_id) <span class="sc">%&gt;%</span></span>
<span id="cb426-10"><a href="multi-dimensional-data-structures.html#cb426-10" tabindex="-1"></a>  <span class="fu">uncount</span>(V1) <span class="sc">%&gt;%</span></span>
<span id="cb426-11"><a href="multi-dimensional-data-structures.html#cb426-11" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_id)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb426-12"><a href="multi-dimensional-data-structures.html#cb426-12" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb426-13"><a href="multi-dimensional-data-structures.html#cb426-13" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">in_class =</span> <span class="fu">case_when</span>(<span class="fu">rnorm</span>(<span class="fu">n</span>(),<span class="at">mean=</span><span class="dv">0</span>,<span class="at">sd=</span><span class="dv">1</span>) <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">1</span>, <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb426-14"><a href="multi-dimensional-data-structures.html#cb426-14" tabindex="-1"></a>  <span class="fu">filter</span>(in_class <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_id), date) <span class="sc">%&gt;%</span></span>
<span id="cb426-15"><a href="multi-dimensional-data-structures.html#cb426-15" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">date_in_class =</span> date)</span>
<span id="cb426-16"><a href="multi-dimensional-data-structures.html#cb426-16" tabindex="-1"></a></span>
<span id="cb426-17"><a href="multi-dimensional-data-structures.html#cb426-17" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb426-18"><a href="multi-dimensional-data-structures.html#cb426-18" tabindex="-1"></a><span class="fu">kable</span>(df_panel_attend_date) <span class="sc">%&gt;%</span></span>
<span id="cb426-19"><a href="multi-dimensional-data-structures.html#cb426-19" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
student_id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date_in_class
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5
</td>
</tr>
</tbody>
</table>
<p>Second, we create a attendance column that is all 1. This is not useful for the long table, but useful for our conversion to wide.</p>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb427-1"><a href="multi-dimensional-data-structures.html#cb427-1" tabindex="-1"></a><span class="co"># Define</span></span>
<span id="cb427-2"><a href="multi-dimensional-data-structures.html#cb427-2" tabindex="-1"></a>svr_id <span class="ot">&lt;-</span> <span class="st">&#39;student_id&#39;</span></span>
<span id="cb427-3"><a href="multi-dimensional-data-structures.html#cb427-3" tabindex="-1"></a>svr_date <span class="ot">&lt;-</span> <span class="st">&#39;date_in_class&#39;</span></span>
<span id="cb427-4"><a href="multi-dimensional-data-structures.html#cb427-4" tabindex="-1"></a>st_idcol_prefix <span class="ot">&lt;-</span> <span class="st">&#39;sid_&#39;</span></span>
<span id="cb427-5"><a href="multi-dimensional-data-structures.html#cb427-5" tabindex="-1"></a></span>
<span id="cb427-6"><a href="multi-dimensional-data-structures.html#cb427-6" tabindex="-1"></a><span class="co"># Generate cumulative enrollment counts by date</span></span>
<span id="cb427-7"><a href="multi-dimensional-data-structures.html#cb427-7" tabindex="-1"></a>df_panel_attend_date_addone <span class="ot">&lt;-</span> df_panel_attend_date <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">attended =</span> <span class="dv">1</span>)</span>
<span id="cb427-8"><a href="multi-dimensional-data-structures.html#cb427-8" tabindex="-1"></a><span class="fu">kable</span>(df_panel_attend_date_addone) <span class="sc">%&gt;%</span></span>
<span id="cb427-9"><a href="multi-dimensional-data-structures.html#cb427-9" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
student_id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date_in_class
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
attended
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p>Third, we convert the long table to wide. The unit of observation is student-day for the long table, and day for the wide table.</p>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="multi-dimensional-data-structures.html#cb428-1" tabindex="-1"></a><span class="co"># Pivot Wide</span></span>
<span id="cb428-2"><a href="multi-dimensional-data-structures.html#cb428-2" tabindex="-1"></a>df_panel_attend_date_wider <span class="ot">&lt;-</span> df_panel_attend_date_addone <span class="sc">%&gt;%</span></span>
<span id="cb428-3"><a href="multi-dimensional-data-structures.html#cb428-3" tabindex="-1"></a>  <span class="fu">arrange</span>(student_id) <span class="sc">%&gt;%</span></span>
<span id="cb428-4"><a href="multi-dimensional-data-structures.html#cb428-4" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> svr_id,</span>
<span id="cb428-5"><a href="multi-dimensional-data-structures.html#cb428-5" tabindex="-1"></a>              <span class="at">values_from =</span> attended)</span>
<span id="cb428-6"><a href="multi-dimensional-data-structures.html#cb428-6" tabindex="-1"></a></span>
<span id="cb428-7"><a href="multi-dimensional-data-structures.html#cb428-7" tabindex="-1"></a><span class="co"># Sort and rename</span></span>
<span id="cb428-8"><a href="multi-dimensional-data-structures.html#cb428-8" tabindex="-1"></a><span class="co"># rename see: https://fanwangecon.github.io/R4Econ/amto/tibble/fs_tib_basics.html</span></span>
<span id="cb428-9"><a href="multi-dimensional-data-structures.html#cb428-9" tabindex="-1"></a>ar_unique_ids <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(df_panel_attend_date <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_id))))</span>
<span id="cb428-10"><a href="multi-dimensional-data-structures.html#cb428-10" tabindex="-1"></a>df_panel_attend_date_wider_sort <span class="ot">&lt;-</span> df_panel_attend_date_wider <span class="sc">%&gt;%</span></span>
<span id="cb428-11"><a href="multi-dimensional-data-structures.html#cb428-11" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_date)) <span class="sc">%&gt;%</span></span>
<span id="cb428-12"><a href="multi-dimensional-data-structures.html#cb428-12" tabindex="-1"></a>    <span class="fu">rename_at</span>(<span class="fu">vars</span>(<span class="fu">num_range</span>(<span class="st">&#39;&#39;</span>,ar_unique_ids))</span>
<span id="cb428-13"><a href="multi-dimensional-data-structures.html#cb428-13" tabindex="-1"></a>              , <span class="fu">list</span>(<span class="sc">~</span><span class="fu">paste0</span>(st_idcol_prefix, . , <span class="st">&#39;&#39;</span>))</span>
<span id="cb428-14"><a href="multi-dimensional-data-structures.html#cb428-14" tabindex="-1"></a>              )</span>
<span id="cb428-15"><a href="multi-dimensional-data-structures.html#cb428-15" tabindex="-1"></a><span class="fu">kable</span>(df_panel_attend_date_wider_sort) <span class="sc">%&gt;%</span></span>
<span id="cb428-16"><a href="multi-dimensional-data-structures.html#cb428-16" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date_in_class
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid_1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid_2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid_3
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p>Fourth, we could achieve what we have above by specifying more parameters in the <em>pivot_wider</em> function.</p>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb429-1"><a href="multi-dimensional-data-structures.html#cb429-1" tabindex="-1"></a><span class="co"># Include name_prefix</span></span>
<span id="cb429-2"><a href="multi-dimensional-data-structures.html#cb429-2" tabindex="-1"></a>df_panel_attend_date_wider_sort <span class="ot">&lt;-</span> df_panel_attend_date_addone <span class="sc">%&gt;%</span></span>
<span id="cb429-3"><a href="multi-dimensional-data-structures.html#cb429-3" tabindex="-1"></a>  <span class="fu">arrange</span>(student_id) <span class="sc">%&gt;%</span></span>
<span id="cb429-4"><a href="multi-dimensional-data-structures.html#cb429-4" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(<span class="st">&quot;date_in_class&quot;</span>),</span>
<span id="cb429-5"><a href="multi-dimensional-data-structures.html#cb429-5" tabindex="-1"></a>              <span class="at">names_from =</span> svr_id,</span>
<span id="cb429-6"><a href="multi-dimensional-data-structures.html#cb429-6" tabindex="-1"></a>              <span class="at">names_prefix =</span> <span class="st">&quot;sid_&quot;</span>,</span>
<span id="cb429-7"><a href="multi-dimensional-data-structures.html#cb429-7" tabindex="-1"></a>              <span class="at">values_from =</span> attended) <span class="sc">%&gt;%</span></span>
<span id="cb429-8"><a href="multi-dimensional-data-structures.html#cb429-8" tabindex="-1"></a>  <span class="fu">arrange</span>(date_in_class)</span>
<span id="cb429-9"><a href="multi-dimensional-data-structures.html#cb429-9" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb429-10"><a href="multi-dimensional-data-structures.html#cb429-10" tabindex="-1"></a><span class="fu">kable</span>(df_panel_attend_date_wider_sort) <span class="sc">%&gt;%</span></span>
<span id="cb429-11"><a href="multi-dimensional-data-structures.html#cb429-11" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date_in_class
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid_1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid_2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid_3
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p>Fifth, sum across rows for each student (column) to get cumulative attendance for each student on each date.</p>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="multi-dimensional-data-structures.html#cb430-1" tabindex="-1"></a><span class="co"># replace NA and cumusum again</span></span>
<span id="cb430-2"><a href="multi-dimensional-data-structures.html#cb430-2" tabindex="-1"></a><span class="co"># see: R4Econ/support/function/fs_func_multivar for renaming and replacing</span></span>
<span id="cb430-3"><a href="multi-dimensional-data-structures.html#cb430-3" tabindex="-1"></a>df_attend_cumu_by_day <span class="ot">&lt;-</span> df_panel_attend_date_wider_sort <span class="sc">%&gt;%</span></span>
<span id="cb430-4"><a href="multi-dimensional-data-structures.html#cb430-4" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="fu">contains</span>(st_idcol_prefix)), <span class="fu">list</span>(<span class="sc">~</span><span class="fu">replace_na</span>(., <span class="dv">0</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb430-5"><a href="multi-dimensional-data-structures.html#cb430-5" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="fu">contains</span>(st_idcol_prefix)), <span class="fu">list</span>(<span class="sc">~</span><span class="fu">cumsum</span>(.)))</span>
<span id="cb430-6"><a href="multi-dimensional-data-structures.html#cb430-6" tabindex="-1"></a></span>
<span id="cb430-7"><a href="multi-dimensional-data-structures.html#cb430-7" tabindex="-1"></a><span class="fu">kable</span>(df_attend_cumu_by_day) <span class="sc">%&gt;%</span></span>
<span id="cb430-8"><a href="multi-dimensional-data-structures.html#cb430-8" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date_in_class
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid_1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid_2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid_3
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
</tbody>
</table>
<p>Finally, the structure above is also a function in Fan’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, here the function is tested:</p>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb431-1"><a href="multi-dimensional-data-structures.html#cb431-1" tabindex="-1"></a><span class="co"># Parameters</span></span>
<span id="cb431-2"><a href="multi-dimensional-data-structures.html#cb431-2" tabindex="-1"></a>df <span class="ot">&lt;-</span> df_panel_attend_date</span>
<span id="cb431-3"><a href="multi-dimensional-data-structures.html#cb431-3" tabindex="-1"></a>svr_id_i <span class="ot">&lt;-</span> <span class="st">&#39;student_id&#39;</span></span>
<span id="cb431-4"><a href="multi-dimensional-data-structures.html#cb431-4" tabindex="-1"></a>svr_id_t <span class="ot">&lt;-</span> <span class="st">&#39;date_in_class&#39;</span></span>
<span id="cb431-5"><a href="multi-dimensional-data-structures.html#cb431-5" tabindex="-1"></a>st_idcol_prefix <span class="ot">&lt;-</span> <span class="st">&#39;sid_&#39;</span></span>
<span id="cb431-6"><a href="multi-dimensional-data-structures.html#cb431-6" tabindex="-1"></a></span>
<span id="cb431-7"><a href="multi-dimensional-data-structures.html#cb431-7" tabindex="-1"></a><span class="co"># Invoke Function</span></span>
<span id="cb431-8"><a href="multi-dimensional-data-structures.html#cb431-8" tabindex="-1"></a>ls_df_rosterwide <span class="ot">&lt;-</span> <span class="fu">ff_panel_expand_longrosterwide</span>(df, svr_id_t, svr_id_i, st_idcol_prefix)</span>
<span id="cb431-9"><a href="multi-dimensional-data-structures.html#cb431-9" tabindex="-1"></a>df_roster_wide_func <span class="ot">&lt;-</span> ls_df_rosterwide<span class="sc">$</span>df_roster_wide</span>
<span id="cb431-10"><a href="multi-dimensional-data-structures.html#cb431-10" tabindex="-1"></a>df_roster_wide_cumu_func <span class="ot">&lt;-</span> ls_df_rosterwide<span class="sc">$</span>df_roster_wide_cumu</span>
<span id="cb431-11"><a href="multi-dimensional-data-structures.html#cb431-11" tabindex="-1"></a></span>
<span id="cb431-12"><a href="multi-dimensional-data-structures.html#cb431-12" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb431-13"><a href="multi-dimensional-data-structures.html#cb431-13" tabindex="-1"></a><span class="fu">print</span>(df_roster_wide_func)</span>
<span id="cb431-14"><a href="multi-dimensional-data-structures.html#cb431-14" tabindex="-1"></a><span class="fu">print</span>(df_roster_wide_cumu_func)</span></code></pre></div>
</div>
<div id="panel-long-attendance-roster-and-score-card-to-wide" class="section level4 hasAnchor" number="4.2.1.2">
<h4><span class="header-section-number">4.2.1.2</span> Panel Long Attendance Roster and Score Card to Wide<a href="multi-dimensional-data-structures.html#panel-long-attendance-roster-and-score-card-to-wide" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In the prior example, at each date, we only had information about attendance, however, we might also know the exam score on each day when the student attends school. In the long table, this appears, in addition to <em>attended</em>, as an additional variable <em>score</em>. When we convert from long to wide, we will have 3 new columns for attendance and also 3 new columns for score. The 3 columns are for the three students, there will be five rows for the five days. Each row in the wide table is the attendance and score information for each day.</p>
<p>First, we add a random score column to the long dataframe created prior. Also add two other additional columns.</p>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb432-1"><a href="multi-dimensional-data-structures.html#cb432-1" tabindex="-1"></a><span class="co"># Create score column</span></span>
<span id="cb432-2"><a href="multi-dimensional-data-structures.html#cb432-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb432-3"><a href="multi-dimensional-data-structures.html#cb432-3" tabindex="-1"></a>df_panel_attend_score_date <span class="ot">&lt;-</span> df_panel_attend_date_addone <span class="sc">%&gt;%</span></span>
<span id="cb432-4"><a href="multi-dimensional-data-structures.html#cb432-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">score =</span> <span class="fu">rnorm</span>(<span class="fu">dim</span>(df_panel_attend_date_addone)[<span class="dv">1</span>], <span class="at">mean=</span><span class="dv">70</span>, <span class="at">sd=</span><span class="dv">10</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb432-5"><a href="multi-dimensional-data-structures.html#cb432-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">score =</span> <span class="fu">round</span>(score, <span class="dv">2</span>),</span>
<span id="cb432-6"><a href="multi-dimensional-data-structures.html#cb432-6" tabindex="-1"></a>         <span class="at">other_var_1 =</span> <span class="dv">1</span>, <span class="at">other_var_2 =</span> <span class="dv">2</span>)</span>
<span id="cb432-7"><a href="multi-dimensional-data-structures.html#cb432-7" tabindex="-1"></a></span>
<span id="cb432-8"><a href="multi-dimensional-data-structures.html#cb432-8" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb432-9"><a href="multi-dimensional-data-structures.html#cb432-9" tabindex="-1"></a><span class="fu">kable</span>(df_panel_attend_score_date, <span class="at">caption=</span><span class="st">&quot;Attend and score info&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb432-10"><a href="multi-dimensional-data-structures.html#cb432-10" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-210">Table 4.1: </span>Attend and score info
</caption>
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
student_id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date_in_class
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
attended
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
score
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
other_var_1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
other_var_2
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
64.40
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
67.70
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
85.59
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
70.71
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
71.29
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
87.15
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
74.61
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
57.35
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
</tbody>
</table>
<p>Second, convert both attended and score columns to wide at the same time. Note that we add “sid” in front of the index for each student. Note that <em>id_cols</em> picks the columns to keep in addition to the names_from and values_from columns. In this case, we are not keeping <em>other_var_1</em> and <em>other_var_2</em>.</p>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb433-1"><a href="multi-dimensional-data-structures.html#cb433-1" tabindex="-1"></a><span class="co"># Convert to wide</span></span>
<span id="cb433-2"><a href="multi-dimensional-data-structures.html#cb433-2" tabindex="-1"></a>df_panel_attend_score_date_wide <span class="ot">&lt;-</span> df_panel_attend_score_date <span class="sc">%&gt;%</span></span>
<span id="cb433-3"><a href="multi-dimensional-data-structures.html#cb433-3" tabindex="-1"></a>  <span class="fu">arrange</span>(student_id) <span class="sc">%&gt;%</span></span>
<span id="cb433-4"><a href="multi-dimensional-data-structures.html#cb433-4" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols  =</span> <span class="fu">c</span>(<span class="st">&quot;date_in_class&quot;</span>),</span>
<span id="cb433-5"><a href="multi-dimensional-data-structures.html#cb433-5" tabindex="-1"></a>              <span class="at">names_from =</span> svr_id,</span>
<span id="cb433-6"><a href="multi-dimensional-data-structures.html#cb433-6" tabindex="-1"></a>              <span class="at">names_prefix =</span> <span class="st">&quot;sid&quot;</span>,</span>
<span id="cb433-7"><a href="multi-dimensional-data-structures.html#cb433-7" tabindex="-1"></a>              <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>,</span>
<span id="cb433-8"><a href="multi-dimensional-data-structures.html#cb433-8" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="fu">c</span>(attended, score)) <span class="sc">%&gt;%</span></span>
<span id="cb433-9"><a href="multi-dimensional-data-structures.html#cb433-9" tabindex="-1"></a>  <span class="fu">arrange</span>(date_in_class)</span>
<span id="cb433-10"><a href="multi-dimensional-data-structures.html#cb433-10" tabindex="-1"></a></span>
<span id="cb433-11"><a href="multi-dimensional-data-structures.html#cb433-11" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb433-12"><a href="multi-dimensional-data-structures.html#cb433-12" tabindex="-1"></a><span class="fu">kable</span>(df_panel_attend_score_date_wide, <span class="at">caption=</span><span class="st">&quot;Attend and score wide&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb433-13"><a href="multi-dimensional-data-structures.html#cb433-13" tabindex="-1"></a>  <span class="fu">kable_styling_fc_wide</span>()</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:875px; ">
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-211">Table 4.2: </span>Attend and score wide
</caption>
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date_in_class
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
attended_sid1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
attended_sid2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
attended_sid3
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
score_sid1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
score_sid2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
score_sid3
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
85.59
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
64.4
</td>
<td style="text-align:right;">
70.71
</td>
<td style="text-align:right;">
87.15
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
74.61
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
67.7
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
71.29
</td>
<td style="text-align:right;">
57.35
</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<div id="wide-to-long" class="section level3 hasAnchor" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Wide to Long<a href="multi-dimensional-data-structures.html#wide-to-long" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> research support package, <a href="https://fanwangecon.github.io/R4Econ/">R4Econ</a> examples page, <a href="https://fanwangecon.github.io/PkgTestR/">PkgTestR</a> packaging guide, or <a href="https://fanwangecon.github.io/Stat4Econ/">Stat4Econ</a> course page.</p>
</blockquote>
<p>Using the <a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a> function in tidyr to reshape panel or other data structures</p>
<div id="wide-to-long-panel-single-variable" class="section level4 hasAnchor" number="4.2.2.1">
<h4><span class="header-section-number">4.2.2.1</span> Wide to long panel, single variable<a href="multi-dimensional-data-structures.html#wide-to-long-panel-single-variable" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We have a matrix of values, the values are <em>ev</em>. Each row corresponds to a different value of the <em>a</em> variable, each column represents a different value of the <em>z</em> variable.</p>
<p>Based on this matrix, we create a table where each unit of observation is for a specific <em>a</em> and <em>z</em> variable combination. So the matrix is turned from wide to long.</p>
<p>The resulting long table has 5 variables</p>
<ol style="list-style-type: decimal">
<li><em>a</em>: values of the <em>a</em> variable, the original matrix row labels</li>
<li><em>ai</em>: an index from 1, indicating the original matrix row index</li>
<li><em>z</em>: values of the <em>z</em> variable, the original matrix column lables</li>
<li><em>zi</em>: an index from 1, indicating hte original matrix column index</li>
</ol>
<p>First, we create the matrix.</p>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb434-1"><a href="multi-dimensional-data-structures.html#cb434-1" tabindex="-1"></a><span class="co"># Generate A Matrix</span></span>
<span id="cb434-2"><a href="multi-dimensional-data-structures.html#cb434-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb434-3"><a href="multi-dimensional-data-structures.html#cb434-3" tabindex="-1"></a>ar_a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">1.1</span>,<span class="fl">5.1</span>)</span>
<span id="cb434-4"><a href="multi-dimensional-data-structures.html#cb434-4" tabindex="-1"></a>ar_z <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.5</span>, <span class="fl">2.53</span>, <span class="at">length.out=</span><span class="dv">11</span>)</span>
<span id="cb434-5"><a href="multi-dimensional-data-structures.html#cb434-5" tabindex="-1"></a>mt_ev <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="fu">length</span>(ar_a)<span class="sc">*</span><span class="fu">length</span>(ar_z)), </span>
<span id="cb434-6"><a href="multi-dimensional-data-structures.html#cb434-6" tabindex="-1"></a>  <span class="at">nrow=</span><span class="fu">length</span>(ar_a), <span class="at">ncol=</span><span class="fu">length</span>(ar_z))</span>
<span id="cb434-7"><a href="multi-dimensional-data-structures.html#cb434-7" tabindex="-1"></a></span>
<span id="cb434-8"><a href="multi-dimensional-data-structures.html#cb434-8" tabindex="-1"></a><span class="co"># Name Matrix</span></span>
<span id="cb434-9"><a href="multi-dimensional-data-structures.html#cb434-9" tabindex="-1"></a><span class="fu">rownames</span>(mt_ev) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;ai&#39;</span>, <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ar_a)))</span>
<span id="cb434-10"><a href="multi-dimensional-data-structures.html#cb434-10" tabindex="-1"></a><span class="fu">colnames</span>(mt_ev) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;zi&#39;</span>, <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ar_z)))</span>
<span id="cb434-11"><a href="multi-dimensional-data-structures.html#cb434-11" tabindex="-1"></a></span>
<span id="cb434-12"><a href="multi-dimensional-data-structures.html#cb434-12" tabindex="-1"></a><span class="co"># to tibble</span></span>
<span id="cb434-13"><a href="multi-dimensional-data-structures.html#cb434-13" tabindex="-1"></a>tb_ev <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(mt_ev) <span class="sc">%&gt;%</span> <span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">&quot;ai&quot;</span>)</span>
<span id="cb434-14"><a href="multi-dimensional-data-structures.html#cb434-14" tabindex="-1"></a></span>
<span id="cb434-15"><a href="multi-dimensional-data-structures.html#cb434-15" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb434-16"><a href="multi-dimensional-data-structures.html#cb434-16" tabindex="-1"></a><span class="fu">print</span>(mt_ev)</span></code></pre></div>
<pre><code>##            zi1        zi2       zi3        zi4        zi5       zi6       zi7
## ai1 -0.5604756 1.55870831 0.1292877  0.4609162 -0.6868529 1.2240818 0.4007715
## ai2 -0.2301775 0.07050839 1.7150650 -1.2650612 -0.4456620 0.3598138 0.1106827
##            zi8        zi9       zi10       zi11
## ai1 -0.5558411  0.4978505  0.7013559 -1.0678237
## ai2  1.7869131 -1.9666172 -0.4727914 -0.2179749</code></pre>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="multi-dimensional-data-structures.html#cb436-1" tabindex="-1"></a><span class="co"># Display</span></span>
<span id="cb436-2"><a href="multi-dimensional-data-structures.html#cb436-2" tabindex="-1"></a><span class="fu">kable</span>(tb_ev, <span class="at">caption =</span> <span class="st">&quot;Wide table&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-213">Table 4.3: </span>Wide table
</caption>
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ai
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi3
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi4
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi5
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi6
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi7
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi8
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi9
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi10
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi11
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-0.5604756
</td>
<td style="text-align:right;">
1.5587083
</td>
<td style="text-align:right;">
0.1292877
</td>
<td style="text-align:right;">
0.4609162
</td>
<td style="text-align:right;">
-0.6868529
</td>
<td style="text-align:right;">
1.2240818
</td>
<td style="text-align:right;">
0.4007715
</td>
<td style="text-align:right;">
-0.5558411
</td>
<td style="text-align:right;">
0.4978505
</td>
<td style="text-align:right;">
0.7013559
</td>
<td style="text-align:right;">
-1.0678237
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-0.2301775
</td>
<td style="text-align:right;">
0.0705084
</td>
<td style="text-align:right;">
1.7150650
</td>
<td style="text-align:right;">
-1.2650612
</td>
<td style="text-align:right;">
-0.4456620
</td>
<td style="text-align:right;">
0.3598138
</td>
<td style="text-align:right;">
0.1106827
</td>
<td style="text-align:right;">
1.7869131
</td>
<td style="text-align:right;">
-1.9666172
</td>
<td style="text-align:right;">
-0.4727914
</td>
<td style="text-align:right;">
-0.2179749
</td>
</tr>
</tbody>
</table>
<p>Second, we convert the table wide to long.</p>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb437-1"><a href="multi-dimensional-data-structures.html#cb437-1" tabindex="-1"></a><span class="co"># longer</span></span>
<span id="cb437-2"><a href="multi-dimensional-data-structures.html#cb437-2" tabindex="-1"></a>tb_ev_long <span class="ot">&lt;-</span> tb_ev <span class="sc">%&gt;%</span></span>
<span id="cb437-3"><a href="multi-dimensional-data-structures.html#cb437-3" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&#39;zi&#39;</span>),</span>
<span id="cb437-4"><a href="multi-dimensional-data-structures.html#cb437-4" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&#39;zi&#39;</span>),</span>
<span id="cb437-5"><a href="multi-dimensional-data-structures.html#cb437-5" tabindex="-1"></a>               <span class="at">names_pattern =</span> <span class="fu">paste0</span>(<span class="st">&quot;zi(.*)&quot;</span>),</span>
<span id="cb437-6"><a href="multi-dimensional-data-structures.html#cb437-6" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;ev&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb437-7"><a href="multi-dimensional-data-structures.html#cb437-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">zi =</span> <span class="fu">as.numeric</span>(zi))</span>
<span id="cb437-8"><a href="multi-dimensional-data-structures.html#cb437-8" tabindex="-1"></a></span>
<span id="cb437-9"><a href="multi-dimensional-data-structures.html#cb437-9" tabindex="-1"></a><span class="co"># Merge with a and z values</span></span>
<span id="cb437-10"><a href="multi-dimensional-data-structures.html#cb437-10" tabindex="-1"></a>tb_ev_long <span class="ot">&lt;-</span> tb_ev_long <span class="sc">%&gt;%</span></span>
<span id="cb437-11"><a href="multi-dimensional-data-structures.html#cb437-11" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">as_tibble</span>(ar_a) <span class="sc">%&gt;%</span></span>
<span id="cb437-12"><a href="multi-dimensional-data-structures.html#cb437-12" tabindex="-1"></a>              <span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">&quot;ai&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb437-13"><a href="multi-dimensional-data-structures.html#cb437-13" tabindex="-1"></a>              <span class="fu">rename</span>(<span class="at">a =</span> value)</span>
<span id="cb437-14"><a href="multi-dimensional-data-structures.html#cb437-14" tabindex="-1"></a>              , <span class="at">by =</span> <span class="st">&#39;ai&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb437-15"><a href="multi-dimensional-data-structures.html#cb437-15" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">as_tibble</span>(ar_z) <span class="sc">%&gt;%</span></span>
<span id="cb437-16"><a href="multi-dimensional-data-structures.html#cb437-16" tabindex="-1"></a>              <span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">&quot;zi&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb437-17"><a href="multi-dimensional-data-structures.html#cb437-17" tabindex="-1"></a>              <span class="fu">rename</span>(<span class="at">z =</span> value),</span>
<span id="cb437-18"><a href="multi-dimensional-data-structures.html#cb437-18" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">&#39;zi&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb437-19"><a href="multi-dimensional-data-structures.html#cb437-19" tabindex="-1"></a>  <span class="fu">select</span>(a,ai,z,zi,ev)</span>
<span id="cb437-20"><a href="multi-dimensional-data-structures.html#cb437-20" tabindex="-1"></a></span>
<span id="cb437-21"><a href="multi-dimensional-data-structures.html#cb437-21" tabindex="-1"></a><span class="co"># Display</span></span>
<span id="cb437-22"><a href="multi-dimensional-data-structures.html#cb437-22" tabindex="-1"></a><span class="fu">kable</span>(tb_ev_long, <span class="at">caption =</span> <span class="st">&quot;Long table&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-214">Table 4.4: </span>Long table
</caption>
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
a
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ai
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
z
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ev
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-2.500
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-0.5604756
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1.997
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1.5587083
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1.494
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.1292877
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-0.991
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.4609162
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-0.488
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
-0.6868529
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.015
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
1.2240818
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.518
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0.4007715
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.021
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
-0.5558411
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.524
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
0.4978505
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2.027
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.7013559
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2.530
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
-1.0678237
</td>
</tr>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-2.500
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-0.2301775
</td>
</tr>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-1.997
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.0705084
</td>
</tr>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-1.494
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1.7150650
</td>
</tr>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-0.991
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
-1.2650612
</td>
</tr>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-0.488
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
-0.4456620
</td>
</tr>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.015
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0.3598138
</td>
</tr>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.518
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0.1106827
</td>
</tr>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1.021
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
1.7869131
</td>
</tr>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1.524
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
-1.9666172
</td>
</tr>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2.027
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
-0.4727914
</td>
</tr>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2.530
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
-0.2179749
</td>
</tr>
</tbody>
</table>
</div>
<div id="wide-to-long-panel-multiple-variables" class="section level4 hasAnchor" number="4.2.2.2">
<h4><span class="header-section-number">4.2.2.2</span> Wide to long panel, multiple variables<a href="multi-dimensional-data-structures.html#wide-to-long-panel-multiple-variables" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We have a dataset where each row contains data from a different year. We have four variables, observed wage, simulated wage, observed labor quantities, and simulated labor quantities.</p>
<p>We generate reshape this file to have four variables:</p>
<ol style="list-style-type: decimal">
<li>year</li>
<li>categorical for wage or quantity</li>
<li>categorical for observed or simulated</li>
<li>a numerical column with wage and quantity values</li>
</ol>
<p>This is different then the situation prior, because we are need to convert to long two different numerical variables that will be in the same long variable, but differentiated by two categorical variables (rather than one).</p>
<p>First, we create the matrix.</p>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="multi-dimensional-data-structures.html#cb438-1" tabindex="-1"></a><span class="co"># Generate A Matrix</span></span>
<span id="cb438-2"><a href="multi-dimensional-data-structures.html#cb438-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb438-3"><a href="multi-dimensional-data-structures.html#cb438-3" tabindex="-1"></a>ar_year <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1995</span>, <span class="dv">1997</span>, <span class="dv">1999</span>)</span>
<span id="cb438-4"><a href="multi-dimensional-data-structures.html#cb438-4" tabindex="-1"></a>ar_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;wage_model&quot;</span>, <span class="st">&quot;quant_model&quot;</span>, <span class="st">&quot;wage_simu&quot;</span>, <span class="st">&quot;quant_simu&quot;</span>)</span>
<span id="cb438-5"><a href="multi-dimensional-data-structures.html#cb438-5" tabindex="-1"></a>mt_equi <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="fu">length</span>(ar_year)<span class="sc">*</span><span class="fu">length</span>(ar_vars)), </span>
<span id="cb438-6"><a href="multi-dimensional-data-structures.html#cb438-6" tabindex="-1"></a>  <span class="at">nrow=</span><span class="fu">length</span>(ar_year), <span class="at">ncol=</span><span class="fu">length</span>(ar_vars))</span>
<span id="cb438-7"><a href="multi-dimensional-data-structures.html#cb438-7" tabindex="-1"></a></span>
<span id="cb438-8"><a href="multi-dimensional-data-structures.html#cb438-8" tabindex="-1"></a><span class="co"># Name Matrix</span></span>
<span id="cb438-9"><a href="multi-dimensional-data-structures.html#cb438-9" tabindex="-1"></a><span class="fu">rownames</span>(mt_equi) <span class="ot">&lt;-</span> ar_year</span>
<span id="cb438-10"><a href="multi-dimensional-data-structures.html#cb438-10" tabindex="-1"></a><span class="fu">colnames</span>(mt_equi) <span class="ot">&lt;-</span> ar_vars</span>
<span id="cb438-11"><a href="multi-dimensional-data-structures.html#cb438-11" tabindex="-1"></a></span>
<span id="cb438-12"><a href="multi-dimensional-data-structures.html#cb438-12" tabindex="-1"></a><span class="co"># to tibble</span></span>
<span id="cb438-13"><a href="multi-dimensional-data-structures.html#cb438-13" tabindex="-1"></a>tb_equi <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(mt_equi, <span class="at">rownames =</span> <span class="st">&quot;year&quot;</span>)</span>
<span id="cb438-14"><a href="multi-dimensional-data-structures.html#cb438-14" tabindex="-1"></a></span>
<span id="cb438-15"><a href="multi-dimensional-data-structures.html#cb438-15" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb438-16"><a href="multi-dimensional-data-structures.html#cb438-16" tabindex="-1"></a><span class="fu">print</span>(mt_equi)</span></code></pre></div>
<pre><code>##      wage_model quant_model  wage_simu quant_simu
## 1995 -0.5604756  0.07050839  0.4609162 -0.4456620
## 1997 -0.2301775  0.12928774 -1.2650612  1.2240818
## 1999  1.5587083  1.71506499 -0.6868529  0.3598138</code></pre>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb440-1"><a href="multi-dimensional-data-structures.html#cb440-1" tabindex="-1"></a><span class="co"># Display</span></span>
<span id="cb440-2"><a href="multi-dimensional-data-structures.html#cb440-2" tabindex="-1"></a><span class="fu">kable</span>(tb_equi, <span class="at">caption =</span> <span class="st">&quot;Wide table&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-215">Table 4.5: </span>Wide table
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
year
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
wage_model
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
quant_model
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
wage_simu
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
quant_simu
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1995
</td>
<td style="text-align:right;">
-0.5604756
</td>
<td style="text-align:right;">
0.0705084
</td>
<td style="text-align:right;">
0.4609162
</td>
<td style="text-align:right;">
-0.4456620
</td>
</tr>
<tr>
<td style="text-align:left;">
1997
</td>
<td style="text-align:right;">
-0.2301775
</td>
<td style="text-align:right;">
0.1292877
</td>
<td style="text-align:right;">
-1.2650612
</td>
<td style="text-align:right;">
1.2240818
</td>
</tr>
<tr>
<td style="text-align:left;">
1999
</td>
<td style="text-align:right;">
1.5587083
</td>
<td style="text-align:right;">
1.7150650
</td>
<td style="text-align:right;">
-0.6868529
</td>
<td style="text-align:right;">
0.3598138
</td>
</tr>
</tbody>
</table>
<p>Second, we convert the table wide to long. We select columns that includes either wage or quant, see tidyselect <a href="https://tidyselect.r-lib.org/reference/starts_with.html">Select variables that match a pattern</a> for additional verbs for how to select variables.</p>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb441-1"><a href="multi-dimensional-data-structures.html#cb441-1" tabindex="-1"></a><span class="co"># longer</span></span>
<span id="cb441-2"><a href="multi-dimensional-data-structures.html#cb441-2" tabindex="-1"></a>tb_equi_long <span class="ot">&lt;-</span> tb_equi <span class="sc">%&gt;%</span></span>
<span id="cb441-3"><a href="multi-dimensional-data-structures.html#cb441-3" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">matches</span>(<span class="st">&#39;wage|quant&#39;</span>),</span>
<span id="cb441-4"><a href="multi-dimensional-data-structures.html#cb441-4" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&#39;variable&#39;</span>, <span class="st">&#39;source&#39;</span>),</span>
<span id="cb441-5"><a href="multi-dimensional-data-structures.html#cb441-5" tabindex="-1"></a>               <span class="at">names_pattern =</span> <span class="fu">paste0</span>(<span class="st">&quot;(.*)_(.*)&quot;</span>),</span>
<span id="cb441-6"><a href="multi-dimensional-data-structures.html#cb441-6" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>) </span>
<span id="cb441-7"><a href="multi-dimensional-data-structures.html#cb441-7" tabindex="-1"></a></span>
<span id="cb441-8"><a href="multi-dimensional-data-structures.html#cb441-8" tabindex="-1"></a><span class="co"># Display</span></span>
<span id="cb441-9"><a href="multi-dimensional-data-structures.html#cb441-9" tabindex="-1"></a><span class="fu">kable</span>(tb_equi_long, <span class="at">caption =</span> <span class="st">&quot;Long table, Two Variables&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-216">Table 4.6: </span>Long table, Two Variables
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
year
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
variable
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
source
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1995
</td>
<td style="text-align:left;">
wage
</td>
<td style="text-align:left;">
model
</td>
<td style="text-align:right;">
-0.5604756
</td>
</tr>
<tr>
<td style="text-align:left;">
1995
</td>
<td style="text-align:left;">
quant
</td>
<td style="text-align:left;">
model
</td>
<td style="text-align:right;">
0.0705084
</td>
</tr>
<tr>
<td style="text-align:left;">
1995
</td>
<td style="text-align:left;">
wage
</td>
<td style="text-align:left;">
simu
</td>
<td style="text-align:right;">
0.4609162
</td>
</tr>
<tr>
<td style="text-align:left;">
1995
</td>
<td style="text-align:left;">
quant
</td>
<td style="text-align:left;">
simu
</td>
<td style="text-align:right;">
-0.4456620
</td>
</tr>
<tr>
<td style="text-align:left;">
1997
</td>
<td style="text-align:left;">
wage
</td>
<td style="text-align:left;">
model
</td>
<td style="text-align:right;">
-0.2301775
</td>
</tr>
<tr>
<td style="text-align:left;">
1997
</td>
<td style="text-align:left;">
quant
</td>
<td style="text-align:left;">
model
</td>
<td style="text-align:right;">
0.1292877
</td>
</tr>
<tr>
<td style="text-align:left;">
1997
</td>
<td style="text-align:left;">
wage
</td>
<td style="text-align:left;">
simu
</td>
<td style="text-align:right;">
-1.2650612
</td>
</tr>
<tr>
<td style="text-align:left;">
1997
</td>
<td style="text-align:left;">
quant
</td>
<td style="text-align:left;">
simu
</td>
<td style="text-align:right;">
1.2240818
</td>
</tr>
<tr>
<td style="text-align:left;">
1999
</td>
<td style="text-align:left;">
wage
</td>
<td style="text-align:left;">
model
</td>
<td style="text-align:right;">
1.5587083
</td>
</tr>
<tr>
<td style="text-align:left;">
1999
</td>
<td style="text-align:left;">
quant
</td>
<td style="text-align:left;">
model
</td>
<td style="text-align:right;">
1.7150650
</td>
</tr>
<tr>
<td style="text-align:left;">
1999
</td>
<td style="text-align:left;">
wage
</td>
<td style="text-align:left;">
simu
</td>
<td style="text-align:right;">
-0.6868529
</td>
</tr>
<tr>
<td style="text-align:left;">
1999
</td>
<td style="text-align:left;">
quant
</td>
<td style="text-align:left;">
simu
</td>
<td style="text-align:right;">
0.3598138
</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="within-panel-comparisons-and-statistics" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Within Panel Comparisons and Statistics<a href="multi-dimensional-data-structures.html#within-panel-comparisons-and-statistics" class="anchor-section" aria-label="Anchor link to header"></a></h2>

<div id="find-closest-neighbor-on-grid" class="section level3 hasAnchor" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Find Closest Neighbor on Grid<a href="multi-dimensional-data-structures.html#find-closest-neighbor-on-grid" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> research support package, <a href="https://fanwangecon.github.io/R4Econ/">R4Econ</a> examples page, <a href="https://fanwangecon.github.io/PkgTestR/">PkgTestR</a> packaging guide, or <a href="https://fanwangecon.github.io/Stat4Econ/">Stat4Econ</a> course page.</p>
</blockquote>
<p>Using the <a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a> function in tidyr to reshape panel or other data structures</p>
<div id="closest-neighbor-on-grid" class="section level4 hasAnchor" number="4.3.1.1">
<h4><span class="header-section-number">4.3.1.1</span> Closest Neighbor on Grid<a href="multi-dimensional-data-structures.html#closest-neighbor-on-grid" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>There is a dataframe that provides <span class="math inline">\(V(coh, a, cev)\)</span> levels. There is another dataframe with <span class="math inline">\(\hat{V}(coh, a)\)</span>, for each <span class="math inline">\(coh, a\)</span>, find the <span class="math inline">\(cev\)</span> that such that the difference between <span class="math inline">\(\hat{V}(coh, a)\)</span> and <span class="math inline">\(V(coh, a, cev)\)</span> is minimized.</p>
<p><span class="math inline">\(V\)</span> and <span class="math inline">\(\hat{V}\)</span> information are stored in a dataframe in the <a href="https://github.com/FanWangEcon/R4Econ/tree/master/panel/join/_file/csv">csv folder</a> in the current directory. In fact, we have one <span class="math inline">\(V\)</span> surface, but multiple <span class="math inline">\(\hat{V}\)</span> files, so we want to do the find closest neighbor exercise for each one of the several <span class="math inline">\(\hat{V}\)</span> files.</p>
<p>The structure is as follows: (1) Load in the <span class="math inline">\(V\)</span> file, where <span class="math inline">\(coh, a, cev\)</span> are all variable attributes. (2) Merge with one <span class="math inline">\(\hat{V}\)</span> file. (3) Take the difference between the <span class="math inline">\(V\)</span> and <span class="math inline">\(\hat{V}\)</span> columns, and take the absolute value of the difference. (4) Group by <span class="math inline">\(coh, a\)</span>, and sort to get the smallest absolute difference among the <span class="math inline">\(cev\)</span> possibilities, and slice out the row for the smallest. (5) Now We have <span class="math inline">\(V(coh, a, cev^{\star}(coh, a))\)</span>. (6) Do this for each of the several <span class="math inline">\(\hat{V}\)</span> files. (7) Stack the results from 1 through 6 together, generate a column that identifies which simulation/exercise/counterfactual each of the <span class="math inline">\(\hat{V}\)</span> file comes from. (8) Visualize by plotting as subplot different <span class="math inline">\(a\)</span>, <span class="math inline">\(coh\)</span> is x-axis, different <span class="math inline">\(\hat{V}\)</span> outcome are different lines, and <span class="math inline">\(cev^{\star}\left(coh, a, \hat{V}\right)\)</span> is the y-axis outcome.</p>
<p>First, load the CEV file.</p>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb442-1"><a href="multi-dimensional-data-structures.html#cb442-1" tabindex="-1"></a><span class="co"># folder</span></span>
<span id="cb442-2"><a href="multi-dimensional-data-structures.html#cb442-2" tabindex="-1"></a>spt_root <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;C:/Users/fan/R4Econ/panel/join/_file/csv&#39;</span>)</span>
<span id="cb442-3"><a href="multi-dimensional-data-structures.html#cb442-3" tabindex="-1"></a><span class="co"># cev surface file, the V file</span></span>
<span id="cb442-4"><a href="multi-dimensional-data-structures.html#cb442-4" tabindex="-1"></a>snm_cev_surface <span class="ot">&lt;-</span> <span class="st">&#39;e_19E1NEp99r99_ITG_PE_cev_subsettest.csv&#39;</span></span>
<span id="cb442-5"><a href="multi-dimensional-data-structures.html#cb442-5" tabindex="-1"></a>mt_cev_surface <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="fu">file.path</span>(spt_root, snm_cev_surface))</span>
<span id="cb442-6"><a href="multi-dimensional-data-structures.html#cb442-6" tabindex="-1"></a>tb_cev_surface <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(mt_cev_surface) <span class="sc">%&gt;%</span></span>
<span id="cb442-7"><a href="multi-dimensional-data-structures.html#cb442-7" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">EjVcev =</span> EjV)</span></code></pre></div>
<p>Second, loop over the V hat files, join V with V hat:</p>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb443-1"><a href="multi-dimensional-data-structures.html#cb443-1" tabindex="-1"></a>ls_tb_cev_surfhat <span class="ot">=</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;list&quot;</span>, <span class="at">length =</span> <span class="dv">4</span>)</span>
<span id="cb443-2"><a href="multi-dimensional-data-structures.html#cb443-2" tabindex="-1"></a><span class="cf">for</span> (it_simu_counter <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)) {</span>
<span id="cb443-3"><a href="multi-dimensional-data-structures.html#cb443-3" tabindex="-1"></a></span>
<span id="cb443-4"><a href="multi-dimensional-data-structures.html#cb443-4" tabindex="-1"></a>    <span class="co"># conditionally change file names</span></span>
<span id="cb443-5"><a href="multi-dimensional-data-structures.html#cb443-5" tabindex="-1"></a>    <span class="cf">if</span> (it_simu_counter <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb443-6"><a href="multi-dimensional-data-structures.html#cb443-6" tabindex="-1"></a>        st_counter <span class="ot">&lt;-</span> <span class="st">&#39;19E1NEp99r99&#39;</span></span>
<span id="cb443-7"><a href="multi-dimensional-data-structures.html#cb443-7" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (it_simu_counter <span class="sc">==</span> <span class="dv">2</span>) {</span>
<span id="cb443-8"><a href="multi-dimensional-data-structures.html#cb443-8" tabindex="-1"></a>        st_counter <span class="ot">&lt;-</span> <span class="st">&#39;19E1NEp02r99&#39;</span></span>
<span id="cb443-9"><a href="multi-dimensional-data-structures.html#cb443-9" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (it_simu_counter <span class="sc">==</span> <span class="dv">3</span>) {</span>
<span id="cb443-10"><a href="multi-dimensional-data-structures.html#cb443-10" tabindex="-1"></a>        st_counter <span class="ot">&lt;-</span> <span class="st">&#39;19E1NEp02per02ger99&#39;</span></span>
<span id="cb443-11"><a href="multi-dimensional-data-structures.html#cb443-11" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (it_simu_counter <span class="sc">==</span> <span class="dv">4</span>) {</span>
<span id="cb443-12"><a href="multi-dimensional-data-structures.html#cb443-12" tabindex="-1"></a>        st_counter <span class="ot">&lt;-</span> <span class="st">&#39;19E1NEp02r02&#39;</span></span>
<span id="cb443-13"><a href="multi-dimensional-data-structures.html#cb443-13" tabindex="-1"></a>    }</span>
<span id="cb443-14"><a href="multi-dimensional-data-structures.html#cb443-14" tabindex="-1"></a>    snm_v_hat <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;e_&#39;</span>, st_counter, <span class="st">&#39;_ITG_PE_subsettest.csv&#39;</span>)</span>
<span id="cb443-15"><a href="multi-dimensional-data-structures.html#cb443-15" tabindex="-1"></a>    </span>
<span id="cb443-16"><a href="multi-dimensional-data-structures.html#cb443-16" tabindex="-1"></a>    <span class="co"># Overall path to files</span></span>
<span id="cb443-17"><a href="multi-dimensional-data-structures.html#cb443-17" tabindex="-1"></a>    mt_v_hat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="fu">file.path</span>(spt_root, snm_v_hat))</span>
<span id="cb443-18"><a href="multi-dimensional-data-structures.html#cb443-18" tabindex="-1"></a>    tb_v_hat <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(mt_v_hat) <span class="sc">%&gt;%</span></span>
<span id="cb443-19"><a href="multi-dimensional-data-structures.html#cb443-19" tabindex="-1"></a>      <span class="fu">select</span>(prod_type_lvl, statesid, EjV)</span>
<span id="cb443-20"><a href="multi-dimensional-data-structures.html#cb443-20" tabindex="-1"></a>    </span>
<span id="cb443-21"><a href="multi-dimensional-data-structures.html#cb443-21" tabindex="-1"></a>    <span class="co"># Merge file using key </span></span>
<span id="cb443-22"><a href="multi-dimensional-data-structures.html#cb443-22" tabindex="-1"></a>    tb_cev_surfhat <span class="ot">&lt;-</span> tb_cev_surface <span class="sc">%&gt;%</span></span>
<span id="cb443-23"><a href="multi-dimensional-data-structures.html#cb443-23" tabindex="-1"></a>      <span class="fu">left_join</span>(tb_v_hat, <span class="at">by=</span>(<span class="fu">c</span>(<span class="st">&#39;prod_type_lvl&#39;</span><span class="ot">=</span><span class="st">&#39;prod_type_lvl&#39;</span>, </span>
<span id="cb443-24"><a href="multi-dimensional-data-structures.html#cb443-24" tabindex="-1"></a>                                <span class="st">&#39;statesid&#39;</span><span class="ot">=</span><span class="st">&#39;statesid&#39;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb443-25"><a href="multi-dimensional-data-structures.html#cb443-25" tabindex="-1"></a>      <span class="fu">arrange</span>(statesid, prod_type_lvl, cev_lvl) <span class="sc">%&gt;%</span></span>
<span id="cb443-26"><a href="multi-dimensional-data-structures.html#cb443-26" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">counter_policy =</span> st_counter)</span>
<span id="cb443-27"><a href="multi-dimensional-data-structures.html#cb443-27" tabindex="-1"></a>    </span>
<span id="cb443-28"><a href="multi-dimensional-data-structures.html#cb443-28" tabindex="-1"></a>    <span class="co"># Store to list</span></span>
<span id="cb443-29"><a href="multi-dimensional-data-structures.html#cb443-29" tabindex="-1"></a>    ls_tb_cev_surfhat[[it_simu_counter]] <span class="ot">&lt;-</span> tb_cev_surfhat</span>
<span id="cb443-30"><a href="multi-dimensional-data-structures.html#cb443-30" tabindex="-1"></a>}</span>
<span id="cb443-31"><a href="multi-dimensional-data-structures.html#cb443-31" tabindex="-1"></a></span>
<span id="cb443-32"><a href="multi-dimensional-data-structures.html#cb443-32" tabindex="-1"></a><span class="co"># Display</span></span>
<span id="cb443-33"><a href="multi-dimensional-data-structures.html#cb443-33" tabindex="-1"></a><span class="fu">kable</span>(ls_tb_cev_surfhat[[<span class="dv">1</span>]][<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">40</span>, <span class="dv">5</span>),]) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc_wide</span>()</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:875px; ">
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
X
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
cev_st
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
cev_lvl
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
prod_type_st
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
prod_type_lvl
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
statesid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
cash_tt
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
EjVcev
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
EjV
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
counter_policy
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
cev-2000
</td>
<td style="text-align:right;">
-0.2000
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
526
</td>
<td style="text-align:right;">
32.84747
</td>
<td style="text-align:right;">
-1.0479929
</td>
<td style="text-align:right;">
-0.7957419
</td>
<td style="text-align:left;">
19E1NEp99r99
</td>
</tr>
<tr>
<td style="text-align:right;">
1501
</td>
<td style="text-align:left;">
cev-947
</td>
<td style="text-align:right;">
-0.0947
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
526
</td>
<td style="text-align:right;">
32.84747
</td>
<td style="text-align:right;">
-0.9079859
</td>
<td style="text-align:right;">
-0.7957419
</td>
<td style="text-align:left;">
19E1NEp99r99
</td>
</tr>
<tr>
<td style="text-align:right;">
3001
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
526
</td>
<td style="text-align:right;">
32.84747
</td>
<td style="text-align:right;">
-0.7880156
</td>
<td style="text-align:right;">
-0.7957419
</td>
<td style="text-align:left;">
19E1NEp99r99
</td>
</tr>
<tr>
<td style="text-align:right;">
4501
</td>
<td style="text-align:left;">
cev1157
</td>
<td style="text-align:right;">
0.1157
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
526
</td>
<td style="text-align:right;">
32.84747
</td>
<td style="text-align:right;">
-0.6803586
</td>
<td style="text-align:right;">
-0.7957419
</td>
<td style="text-align:left;">
19E1NEp99r99
</td>
</tr>
<tr>
<td style="text-align:right;">
51
</td>
<td style="text-align:left;">
cev-2000
</td>
<td style="text-align:right;">
-0.2000
</td>
<td style="text-align:left;">
A2504
</td>
<td style="text-align:right;">
2504
</td>
<td style="text-align:right;">
526
</td>
<td style="text-align:right;">
32.90371
</td>
<td style="text-align:right;">
-1.0002921
</td>
<td style="text-align:right;">
-0.7504785
</td>
<td style="text-align:left;">
19E1NEp99r99
</td>
</tr>
<tr>
<td style="text-align:right;">
1551
</td>
<td style="text-align:left;">
cev-947
</td>
<td style="text-align:right;">
-0.0947
</td>
<td style="text-align:left;">
A2504
</td>
<td style="text-align:right;">
2504
</td>
<td style="text-align:right;">
526
</td>
<td style="text-align:right;">
32.90371
</td>
<td style="text-align:right;">
-0.8613743
</td>
<td style="text-align:right;">
-0.7504785
</td>
<td style="text-align:left;">
19E1NEp99r99
</td>
</tr>
<tr>
<td style="text-align:right;">
3051
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A2504
</td>
<td style="text-align:right;">
2504
</td>
<td style="text-align:right;">
526
</td>
<td style="text-align:right;">
32.90371
</td>
<td style="text-align:right;">
-0.7423281
</td>
<td style="text-align:right;">
-0.7504785
</td>
<td style="text-align:left;">
19E1NEp99r99
</td>
</tr>
<tr>
<td style="text-align:right;">
4551
</td>
<td style="text-align:left;">
cev1157
</td>
<td style="text-align:right;">
0.1157
</td>
<td style="text-align:left;">
A2504
</td>
<td style="text-align:right;">
2504
</td>
<td style="text-align:right;">
526
</td>
<td style="text-align:right;">
32.90371
</td>
<td style="text-align:right;">
-0.6354620
</td>
<td style="text-align:right;">
-0.7504785
</td>
<td style="text-align:left;">
19E1NEp99r99
</td>
</tr>
</tbody>
</table>
</div>
<p>Third, sort each file, and keep only the best match rows that minimize the absolute distance between <em>EjV</em> and <em>EjVcev</em>.</p>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb444-1"><a href="multi-dimensional-data-structures.html#cb444-1" tabindex="-1"></a>ls_tb_cev_matched <span class="ot">=</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;list&quot;</span>, <span class="at">length =</span> <span class="dv">4</span>)</span>
<span id="cb444-2"><a href="multi-dimensional-data-structures.html#cb444-2" tabindex="-1"></a><span class="cf">for</span> (it_simu_counter <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)) {</span>
<span id="cb444-3"><a href="multi-dimensional-data-structures.html#cb444-3" tabindex="-1"></a></span>
<span id="cb444-4"><a href="multi-dimensional-data-structures.html#cb444-4" tabindex="-1"></a>    <span class="co"># Load merged file</span></span>
<span id="cb444-5"><a href="multi-dimensional-data-structures.html#cb444-5" tabindex="-1"></a>    tb_cev_surfhat <span class="ot">&lt;-</span> ls_tb_cev_surfhat[[it_simu_counter]]</span>
<span id="cb444-6"><a href="multi-dimensional-data-structures.html#cb444-6" tabindex="-1"></a></span>
<span id="cb444-7"><a href="multi-dimensional-data-structures.html#cb444-7" tabindex="-1"></a>    <span class="co"># Difference Column</span></span>
<span id="cb444-8"><a href="multi-dimensional-data-structures.html#cb444-8" tabindex="-1"></a>    tb_cev_surfhat <span class="ot">&lt;-</span> tb_cev_surfhat <span class="sc">%&gt;%</span> </span>
<span id="cb444-9"><a href="multi-dimensional-data-structures.html#cb444-9" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">EjVcev_gap =</span> <span class="fu">abs</span>(EjVcev <span class="sc">-</span> EjV))</span>
<span id="cb444-10"><a href="multi-dimensional-data-structures.html#cb444-10" tabindex="-1"></a>    </span>
<span id="cb444-11"><a href="multi-dimensional-data-structures.html#cb444-11" tabindex="-1"></a>    <span class="co"># Group by, Arrange and Slice, get lowest gap</span></span>
<span id="cb444-12"><a href="multi-dimensional-data-structures.html#cb444-12" tabindex="-1"></a>    tb_cev_matched <span class="ot">&lt;-</span> tb_cev_surfhat <span class="sc">%&gt;%</span> </span>
<span id="cb444-13"><a href="multi-dimensional-data-structures.html#cb444-13" tabindex="-1"></a>      <span class="fu">arrange</span>(statesid, prod_type_lvl, EjVcev_gap) <span class="sc">%&gt;%</span></span>
<span id="cb444-14"><a href="multi-dimensional-data-structures.html#cb444-14" tabindex="-1"></a>      <span class="fu">group_by</span>(statesid, prod_type_lvl) <span class="sc">%&gt;%</span></span>
<span id="cb444-15"><a href="multi-dimensional-data-structures.html#cb444-15" tabindex="-1"></a>      <span class="fu">slice_head</span>(<span class="at">n=</span><span class="dv">1</span>)</span>
<span id="cb444-16"><a href="multi-dimensional-data-structures.html#cb444-16" tabindex="-1"></a></span>
<span id="cb444-17"><a href="multi-dimensional-data-structures.html#cb444-17" tabindex="-1"></a>    <span class="co"># Store to list</span></span>
<span id="cb444-18"><a href="multi-dimensional-data-structures.html#cb444-18" tabindex="-1"></a>    ls_tb_cev_matched[[it_simu_counter]] <span class="ot">&lt;-</span> tb_cev_matched</span>
<span id="cb444-19"><a href="multi-dimensional-data-structures.html#cb444-19" tabindex="-1"></a>}</span>
<span id="cb444-20"><a href="multi-dimensional-data-structures.html#cb444-20" tabindex="-1"></a></span>
<span id="cb444-21"><a href="multi-dimensional-data-structures.html#cb444-21" tabindex="-1"></a><span class="co"># Display</span></span>
<span id="cb444-22"><a href="multi-dimensional-data-structures.html#cb444-22" tabindex="-1"></a><span class="fu">kable</span>(ls_tb_cev_matched[[<span class="dv">2</span>]][<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">30</span>, <span class="dv">1</span>),]) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc_wide</span>()</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:875px; ">
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
X
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
cev_st
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
cev_lvl
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
prod_type_st
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
prod_type_lvl
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
statesid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
cash_tt
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
EjVcev
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
EjV
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
counter_policy
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
EjVcev_gap
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
3001
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
526
</td>
<td style="text-align:right;">
32.847471
</td>
<td style="text-align:right;">
-0.7880156
</td>
<td style="text-align:right;">
-0.7928034
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0047878
</td>
</tr>
<tr>
<td style="text-align:right;">
3051
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A2504
</td>
<td style="text-align:right;">
2504
</td>
<td style="text-align:right;">
526
</td>
<td style="text-align:right;">
32.903714
</td>
<td style="text-align:right;">
-0.7423281
</td>
<td style="text-align:right;">
-0.7480617
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0057336
</td>
</tr>
<tr>
<td style="text-align:right;">
3101
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A4145
</td>
<td style="text-align:right;">
4145
</td>
<td style="text-align:right;">
526
</td>
<td style="text-align:right;">
32.948970
</td>
<td style="text-align:right;">
-0.7082006
</td>
<td style="text-align:right;">
-0.7145418
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0063412
</td>
</tr>
<tr>
<td style="text-align:right;">
3151
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A5633
</td>
<td style="text-align:right;">
5633
</td>
<td style="text-align:right;">
526
</td>
<td style="text-align:right;">
32.996952
</td>
<td style="text-align:right;">
-0.6753576
</td>
<td style="text-align:right;">
-0.6818996
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0065420
</td>
</tr>
<tr>
<td style="text-align:right;">
3201
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A7274
</td>
<td style="text-align:right;">
7274
</td>
<td style="text-align:right;">
526
</td>
<td style="text-align:right;">
33.058832
</td>
<td style="text-align:right;">
-0.6368297
</td>
<td style="text-align:right;">
-0.6431710
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0063413
</td>
</tr>
<tr>
<td style="text-align:right;">
3251
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A9779
</td>
<td style="text-align:right;">
9779
</td>
<td style="text-align:right;">
526
</td>
<td style="text-align:right;">
33.175241
</td>
<td style="text-align:right;">
-0.5711706
</td>
<td style="text-align:right;">
-0.5774648
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0062942
</td>
</tr>
<tr>
<td style="text-align:right;">
3002
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
555
</td>
<td style="text-align:right;">
53.346587
</td>
<td style="text-align:right;">
-0.2985944
</td>
<td style="text-align:right;">
-0.3041922
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0055978
</td>
</tr>
<tr>
<td style="text-align:right;">
3052
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A2504
</td>
<td style="text-align:right;">
2504
</td>
<td style="text-align:right;">
555
</td>
<td style="text-align:right;">
53.815772
</td>
<td style="text-align:right;">
-0.2617572
</td>
<td style="text-align:right;">
-0.2680026
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0062454
</td>
</tr>
<tr>
<td style="text-align:right;">
3102
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A4145
</td>
<td style="text-align:right;">
4145
</td>
<td style="text-align:right;">
555
</td>
<td style="text-align:right;">
54.193302
</td>
<td style="text-align:right;">
-0.2340822
</td>
<td style="text-align:right;">
-0.2406142
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0065320
</td>
</tr>
<tr>
<td style="text-align:right;">
3152
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A5633
</td>
<td style="text-align:right;">
5633
</td>
<td style="text-align:right;">
555
</td>
<td style="text-align:right;">
54.593579
</td>
<td style="text-align:right;">
-0.2067964
</td>
<td style="text-align:right;">
-0.2134634
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0066670
</td>
</tr>
<tr>
<td style="text-align:right;">
3202
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A7274
</td>
<td style="text-align:right;">
7274
</td>
<td style="text-align:right;">
555
</td>
<td style="text-align:right;">
55.109790
</td>
<td style="text-align:right;">
-0.1740126
</td>
<td style="text-align:right;">
-0.1806320
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0066194
</td>
</tr>
<tr>
<td style="text-align:right;">
3252
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A9779
</td>
<td style="text-align:right;">
9779
</td>
<td style="text-align:right;">
555
</td>
<td style="text-align:right;">
56.080888
</td>
<td style="text-align:right;">
-0.1169470
</td>
<td style="text-align:right;">
-0.1236111
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0066641
</td>
</tr>
<tr>
<td style="text-align:right;">
3603
</td>
<td style="text-align:left;">
cev526
</td>
<td style="text-align:right;">
0.0526
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
905
</td>
<td style="text-align:right;">
1.533025
</td>
<td style="text-align:right;">
-5.2530406
</td>
<td style="text-align:right;">
-5.2486887
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0043519
</td>
</tr>
<tr>
<td style="text-align:right;">
3353
</td>
<td style="text-align:left;">
cev315
</td>
<td style="text-align:right;">
0.0315
</td>
<td style="text-align:left;">
A2504
</td>
<td style="text-align:right;">
2504
</td>
<td style="text-align:right;">
905
</td>
<td style="text-align:right;">
1.714498
</td>
<td style="text-align:right;">
-4.5517474
</td>
<td style="text-align:right;">
-4.5408560
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0108913
</td>
</tr>
<tr>
<td style="text-align:right;">
3403
</td>
<td style="text-align:left;">
cev315
</td>
<td style="text-align:right;">
0.0315
</td>
<td style="text-align:left;">
A4145
</td>
<td style="text-align:right;">
4145
</td>
<td style="text-align:right;">
905
</td>
<td style="text-align:right;">
1.860521
</td>
<td style="text-align:right;">
-4.1039608
</td>
<td style="text-align:right;">
-4.1072736
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0033128
</td>
</tr>
<tr>
<td style="text-align:right;">
3453
</td>
<td style="text-align:left;">
cev315
</td>
<td style="text-align:right;">
0.0315
</td>
<td style="text-align:left;">
A5633
</td>
<td style="text-align:right;">
5633
</td>
<td style="text-align:right;">
905
</td>
<td style="text-align:right;">
2.015341
</td>
<td style="text-align:right;">
-3.7465733
</td>
<td style="text-align:right;">
-3.7611842
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0146109
</td>
</tr>
<tr>
<td style="text-align:right;">
3503
</td>
<td style="text-align:left;">
cev315
</td>
<td style="text-align:right;">
0.0315
</td>
<td style="text-align:left;">
A7274
</td>
<td style="text-align:right;">
7274
</td>
<td style="text-align:right;">
905
</td>
<td style="text-align:right;">
2.215003
</td>
<td style="text-align:right;">
-3.4101025
</td>
<td style="text-align:right;">
-3.4235413
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0134388
</td>
</tr>
<tr>
<td style="text-align:right;">
3553
</td>
<td style="text-align:left;">
cev315
</td>
<td style="text-align:right;">
0.0315
</td>
<td style="text-align:left;">
A9779
</td>
<td style="text-align:right;">
9779
</td>
<td style="text-align:right;">
905
</td>
<td style="text-align:right;">
2.590608
</td>
<td style="text-align:right;">
-2.9413469
</td>
<td style="text-align:right;">
-2.9535570
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0122101
</td>
</tr>
<tr>
<td style="text-align:right;">
3004
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
953
</td>
<td style="text-align:right;">
20.125381
</td>
<td style="text-align:right;">
-1.3249909
</td>
<td style="text-align:right;">
-1.3290865
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0040957
</td>
</tr>
<tr>
<td style="text-align:right;">
3054
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A2504
</td>
<td style="text-align:right;">
2504
</td>
<td style="text-align:right;">
953
</td>
<td style="text-align:right;">
20.306854
</td>
<td style="text-align:right;">
-1.2476021
</td>
<td style="text-align:right;">
-1.2531860
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0055839
</td>
</tr>
<tr>
<td style="text-align:right;">
3104
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A4145
</td>
<td style="text-align:right;">
4145
</td>
<td style="text-align:right;">
953
</td>
<td style="text-align:right;">
20.452876
</td>
<td style="text-align:right;">
-1.1916003
</td>
<td style="text-align:right;">
-1.1975215
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0059211
</td>
</tr>
<tr>
<td style="text-align:right;">
3154
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A5633
</td>
<td style="text-align:right;">
5633
</td>
<td style="text-align:right;">
953
</td>
<td style="text-align:right;">
20.607697
</td>
<td style="text-align:right;">
-1.1383665
</td>
<td style="text-align:right;">
-1.1444048
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0060383
</td>
</tr>
<tr>
<td style="text-align:right;">
3204
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A7274
</td>
<td style="text-align:right;">
7274
</td>
<td style="text-align:right;">
953
</td>
<td style="text-align:right;">
20.807359
</td>
<td style="text-align:right;">
-1.0766095
</td>
<td style="text-align:right;">
-1.0823344
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0057250
</td>
</tr>
<tr>
<td style="text-align:right;">
3254
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A9779
</td>
<td style="text-align:right;">
9779
</td>
<td style="text-align:right;">
953
</td>
<td style="text-align:right;">
21.182964
</td>
<td style="text-align:right;">
-0.9729832
</td>
<td style="text-align:right;">
-0.9781408
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0051576
</td>
</tr>
<tr>
<td style="text-align:right;">
3005
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1017
</td>
<td style="text-align:right;">
63.774766
</td>
<td style="text-align:right;">
-0.1284542
</td>
<td style="text-align:right;">
-0.1342653
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0058110
</td>
</tr>
<tr>
<td style="text-align:right;">
3055
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A2504
</td>
<td style="text-align:right;">
2504
</td>
<td style="text-align:right;">
1017
</td>
<td style="text-align:right;">
64.298911
</td>
<td style="text-align:right;">
-0.0967695
</td>
<td style="text-align:right;">
-0.1031112
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0063417
</td>
</tr>
<tr>
<td style="text-align:right;">
3105
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A4145
</td>
<td style="text-align:right;">
4145
</td>
<td style="text-align:right;">
1017
</td>
<td style="text-align:right;">
64.720664
</td>
<td style="text-align:right;">
-0.0728485
</td>
<td style="text-align:right;">
-0.0793940
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0065454
</td>
</tr>
<tr>
<td style="text-align:right;">
3155
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A5633
</td>
<td style="text-align:right;">
5633
</td>
<td style="text-align:right;">
1017
</td>
<td style="text-align:right;">
65.167829
</td>
<td style="text-align:right;">
-0.0490898
</td>
<td style="text-align:right;">
-0.0557238
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0066341
</td>
</tr>
<tr>
<td style="text-align:right;">
3205
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A7274
</td>
<td style="text-align:right;">
7274
</td>
<td style="text-align:right;">
1017
</td>
<td style="text-align:right;">
65.744507
</td>
<td style="text-align:right;">
-0.0203378
</td>
<td style="text-align:right;">
-0.0269149
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0065772
</td>
</tr>
<tr>
<td style="text-align:right;">
3255
</td>
<td style="text-align:left;">
cev105
</td>
<td style="text-align:right;">
0.0105
</td>
<td style="text-align:left;">
A9779
</td>
<td style="text-align:right;">
9779
</td>
<td style="text-align:right;">
1017
</td>
<td style="text-align:right;">
66.829359
</td>
<td style="text-align:right;">
0.0299397
</td>
<td style="text-align:right;">
0.0233507
</td>
<td style="text-align:left;">
19E1NEp02r99
</td>
<td style="text-align:right;">
0.0065890
</td>
</tr>
</tbody>
</table>
</div>
<p>Fourth, row_bind results together.</p>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb445-1"><a href="multi-dimensional-data-structures.html#cb445-1" tabindex="-1"></a><span class="co"># Single dataframe with all results</span></span>
<span id="cb445-2"><a href="multi-dimensional-data-structures.html#cb445-2" tabindex="-1"></a>tb_cev_matched_all_counter <span class="ot">&lt;-</span> <span class="fu">do.call</span>(bind_rows, ls_tb_cev_matched)</span>
<span id="cb445-3"><a href="multi-dimensional-data-structures.html#cb445-3" tabindex="-1"></a><span class="co"># check size</span></span>
<span id="cb445-4"><a href="multi-dimensional-data-structures.html#cb445-4" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">dim</span>(tb_cev_matched_all_counter))</span></code></pre></div>
<pre><code>## [1] 1200   11</code></pre>
<p>Fifth, visualize results</p>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb447-1"><a href="multi-dimensional-data-structures.html#cb447-1" tabindex="-1"></a><span class="co"># select four from the productivity types</span></span>
<span id="cb447-2"><a href="multi-dimensional-data-structures.html#cb447-2" tabindex="-1"></a>ar_prod_type_lvl_unique <span class="ot">&lt;-</span> <span class="fu">unique</span>(tb_cev_matched_all_counter <span class="sc">%&gt;%</span> <span class="fu">pull</span>(prod_type_lvl))</span>
<span id="cb447-3"><a href="multi-dimensional-data-structures.html#cb447-3" tabindex="-1"></a>ar_prod_type_lvl_selected <span class="ot">&lt;-</span> ar_prod_type_lvl_unique[<span class="fu">round</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">length</span>(ar_prod_type_lvl_unique), <span class="at">length.out=</span><span class="dv">4</span>))]</span>
<span id="cb447-4"><a href="multi-dimensional-data-structures.html#cb447-4" tabindex="-1"></a><span class="co"># graph</span></span>
<span id="cb447-5"><a href="multi-dimensional-data-structures.html#cb447-5" tabindex="-1"></a>lineplot <span class="ot">&lt;-</span> tb_cev_matched_all_counter <span class="sc">%&gt;%</span></span>
<span id="cb447-6"><a href="multi-dimensional-data-structures.html#cb447-6" tabindex="-1"></a>    <span class="fu">filter</span>(prod_type_lvl <span class="sc">%in%</span> ar_prod_type_lvl_selected) <span class="sc">%&gt;%</span></span>
<span id="cb447-7"><a href="multi-dimensional-data-structures.html#cb447-7" tabindex="-1"></a>    <span class="fu">group_by</span>(prod_type_st, cash_tt) <span class="sc">%&gt;%</span></span>
<span id="cb447-8"><a href="multi-dimensional-data-structures.html#cb447-8" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>cash_tt, <span class="at">y=</span>cev_lvl,</span>
<span id="cb447-9"><a href="multi-dimensional-data-structures.html#cb447-9" tabindex="-1"></a>               <span class="at">colour=</span>counter_policy, <span class="at">linetype=</span>counter_policy, <span class="at">shape=</span>counter_policy)) <span class="sc">+</span></span>
<span id="cb447-10"><a href="multi-dimensional-data-structures.html#cb447-10" tabindex="-1"></a>        <span class="fu">facet_wrap</span>( <span class="sc">~</span> prod_type_st) <span class="sc">+</span></span>
<span id="cb447-11"><a href="multi-dimensional-data-structures.html#cb447-11" tabindex="-1"></a>        <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb447-12"><a href="multi-dimensional-data-structures.html#cb447-12" tabindex="-1"></a>        <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb447-13"><a href="multi-dimensional-data-structures.html#cb447-13" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&#39;Visualizing the positions of matched values&#39;</span>,</span>
<span id="cb447-14"><a href="multi-dimensional-data-structures.html#cb447-14" tabindex="-1"></a>             <span class="at">x =</span> <span class="st">&#39;Resource Levels&#39;</span>,</span>
<span id="cb447-15"><a href="multi-dimensional-data-structures.html#cb447-15" tabindex="-1"></a>             <span class="at">y =</span> <span class="st">&#39;CEV&#39;</span>,</span>
<span id="cb447-16"><a href="multi-dimensional-data-structures.html#cb447-16" tabindex="-1"></a>             <span class="at">caption =</span> <span class="fu">paste0</span>(<span class="st">&#39;https://fanwangecon.github.io/&#39;</span>,</span>
<span id="cb447-17"><a href="multi-dimensional-data-structures.html#cb447-17" tabindex="-1"></a>                              <span class="st">&#39;R4Econ/panel/join/htmlpdfr/fs_join_compare.html&#39;</span>)) </span>
<span id="cb447-18"><a href="multi-dimensional-data-structures.html#cb447-18" tabindex="-1"></a><span class="fu">print</span>(lineplot)</span></code></pre></div>
<p><img src="Panel-Data-and-Optimization-with-R_files/figure-html/unnamed-chunk-222-1.png" width="672" style="display: block; margin: auto;" /></p>

</div>
</div>
<div id="within-panel-cross-time-and-cross-group-statistics" class="section level3 hasAnchor" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Within Panel Cross-time and Cross-group Statistics<a href="multi-dimensional-data-structures.html#within-panel-cross-time-and-cross-group-statistics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> research support package, <a href="https://fanwangecon.github.io/R4Econ/">R4Econ</a> examples page, <a href="https://fanwangecon.github.io/PkgTestR/">PkgTestR</a> packaging guide, or <a href="https://fanwangecon.github.io/Stat4Econ/">Stat4Econ</a> course page.</p>
</blockquote>
<div id="comparing-three-countries-over-time" class="section level4 hasAnchor" number="4.3.2.1">
<h4><span class="header-section-number">4.3.2.1</span> Comparing Three Countries over Time<a href="multi-dimensional-data-structures.html#comparing-three-countries-over-time" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Given three time series for three “countries”, we compute percentage change from initial year for each country, and compare relative values within each timer period versus one country.</p>
<p>First, we generate the core data inputs. We assume that the output here would be the data structure we face prior to generating the figures we are interested in. We use data from the attitude dataset, but re-interpret what the columns are. We work with data from three “countries” at the same time, which generalizes also to the two countries case.</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="multi-dimensional-data-structures.html#cb448-1" tabindex="-1"></a><span class="co"># Load data, and treat index as &quot;year&quot;</span></span>
<span id="cb448-2"><a href="multi-dimensional-data-structures.html#cb448-2" tabindex="-1"></a><span class="co"># pretend data to be country-data</span></span>
<span id="cb448-3"><a href="multi-dimensional-data-structures.html#cb448-3" tabindex="-1"></a>df_attitude <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(attitude) <span class="sc">%&gt;%</span></span>
<span id="cb448-4"><a href="multi-dimensional-data-structures.html#cb448-4" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">&quot;year&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb448-5"><a href="multi-dimensional-data-structures.html#cb448-5" tabindex="-1"></a>  <span class="fu">select</span>(year, rating, complaints, learning) <span class="sc">%&gt;%</span> </span>
<span id="cb448-6"><a href="multi-dimensional-data-structures.html#cb448-6" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">stats_usa =</span> rating, </span>
<span id="cb448-7"><a href="multi-dimensional-data-structures.html#cb448-7" tabindex="-1"></a>         <span class="at">stats_canada =</span> complaints, </span>
<span id="cb448-8"><a href="multi-dimensional-data-structures.html#cb448-8" tabindex="-1"></a>         <span class="at">stats_uk =</span> learning)</span>
<span id="cb448-9"><a href="multi-dimensional-data-structures.html#cb448-9" tabindex="-1"></a></span>
<span id="cb448-10"><a href="multi-dimensional-data-structures.html#cb448-10" tabindex="-1"></a><span class="co"># Wide to Long</span></span>
<span id="cb448-11"><a href="multi-dimensional-data-structures.html#cb448-11" tabindex="-1"></a>df_attitude <span class="ot">&lt;-</span> df_attitude <span class="sc">%&gt;%</span></span>
<span id="cb448-12"><a href="multi-dimensional-data-structures.html#cb448-12" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&#39;stats_&#39;</span>),</span>
<span id="cb448-13"><a href="multi-dimensional-data-structures.html#cb448-13" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&#39;country&#39;</span>),</span>
<span id="cb448-14"><a href="multi-dimensional-data-structures.html#cb448-14" tabindex="-1"></a>               <span class="at">names_pattern =</span> <span class="fu">paste0</span>(<span class="st">&quot;stats_(.*)&quot;</span>),</span>
<span id="cb448-15"><a href="multi-dimensional-data-structures.html#cb448-15" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;rating&quot;</span>)</span>
<span id="cb448-16"><a href="multi-dimensional-data-structures.html#cb448-16" tabindex="-1"></a></span>
<span id="cb448-17"><a href="multi-dimensional-data-structures.html#cb448-17" tabindex="-1"></a><span class="co"># Print </span></span>
<span id="cb448-18"><a href="multi-dimensional-data-structures.html#cb448-18" tabindex="-1"></a><span class="fu">kable</span>(df_attitude[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,]) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
year
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
country
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
rating
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
usa
</td>
<td style="text-align:right;">
43
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
canada
</td>
<td style="text-align:right;">
51
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
uk
</td>
<td style="text-align:right;">
39
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
usa
</td>
<td style="text-align:right;">
63
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
canada
</td>
<td style="text-align:right;">
64
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
uk
</td>
<td style="text-align:right;">
54
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
usa
</td>
<td style="text-align:right;">
71
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
canada
</td>
<td style="text-align:right;">
70
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
uk
</td>
<td style="text-align:right;">
69
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
usa
</td>
<td style="text-align:right;">
61
</td>
</tr>
</tbody>
</table>
<p>Second, we generate additional data inputs. Specifically, we also generate ratios of values with respect to he “first” country, within each year.</p>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb449-1"><a href="multi-dimensional-data-structures.html#cb449-1" tabindex="-1"></a><span class="co"># Sort and get list of countries</span></span>
<span id="cb449-2"><a href="multi-dimensional-data-structures.html#cb449-2" tabindex="-1"></a>ar_countries_sorted <span class="ot">&lt;-</span> df_attitude <span class="sc">%&gt;%</span> </span>
<span id="cb449-3"><a href="multi-dimensional-data-structures.html#cb449-3" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(country) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(country) <span class="sc">%&gt;%</span> </span>
<span id="cb449-4"><a href="multi-dimensional-data-structures.html#cb449-4" tabindex="-1"></a>  <span class="fu">pull</span>(country)</span>
<span id="cb449-5"><a href="multi-dimensional-data-structures.html#cb449-5" tabindex="-1"></a>st_ratio_var <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;ratings_ratio_vs_country&#39;</span>, ar_countries_sorted[<span class="dv">1</span>])</span>
<span id="cb449-6"><a href="multi-dimensional-data-structures.html#cb449-6" tabindex="-1"></a></span>
<span id="cb449-7"><a href="multi-dimensional-data-structures.html#cb449-7" tabindex="-1"></a><span class="co"># Generate ratio over the first location</span></span>
<span id="cb449-8"><a href="multi-dimensional-data-structures.html#cb449-8" tabindex="-1"></a>df_attitude <span class="ot">&lt;-</span> df_attitude <span class="sc">%&gt;%</span> </span>
<span id="cb449-9"><a href="multi-dimensional-data-structures.html#cb449-9" tabindex="-1"></a>  <span class="fu">arrange</span>(year, country) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb449-10"><a href="multi-dimensional-data-structures.html#cb449-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(st_ratio_var) <span class="sc">:=</span> rating<span class="sc">/</span><span class="fu">first</span>(rating))</span>
<span id="cb449-11"><a href="multi-dimensional-data-structures.html#cb449-11" tabindex="-1"></a>  </span>
<span id="cb449-12"><a href="multi-dimensional-data-structures.html#cb449-12" tabindex="-1"></a><span class="co"># Print </span></span>
<span id="cb449-13"><a href="multi-dimensional-data-structures.html#cb449-13" tabindex="-1"></a><span class="fu">kable</span>(df_attitude[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,]) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
year
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
country
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
rating
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ratings_ratio_vs_countrycanada
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
canada
</td>
<td style="text-align:right;">
51
</td>
<td style="text-align:right;">
1.0000000
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
uk
</td>
<td style="text-align:right;">
39
</td>
<td style="text-align:right;">
0.7647059
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
usa
</td>
<td style="text-align:right;">
43
</td>
<td style="text-align:right;">
0.8431373
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
canada
</td>
<td style="text-align:right;">
64
</td>
<td style="text-align:right;">
1.0000000
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
uk
</td>
<td style="text-align:right;">
54
</td>
<td style="text-align:right;">
0.8437500
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
usa
</td>
<td style="text-align:right;">
63
</td>
<td style="text-align:right;">
0.9843750
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
canada
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:right;">
1.0000000
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
uk
</td>
<td style="text-align:right;">
69
</td>
<td style="text-align:right;">
0.9857143
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
usa
</td>
<td style="text-align:right;">
71
</td>
<td style="text-align:right;">
1.0142857
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
canada
</td>
<td style="text-align:right;">
63
</td>
<td style="text-align:right;">
1.0000000
</td>
</tr>
</tbody>
</table>
<p>Third, we now generate ratios of values with respect to the first year, within each country.</p>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="multi-dimensional-data-structures.html#cb450-1" tabindex="-1"></a><span class="co"># Sort and get list of countries</span></span>
<span id="cb450-2"><a href="multi-dimensional-data-structures.html#cb450-2" tabindex="-1"></a>ar_years_sorted <span class="ot">&lt;-</span> df_attitude <span class="sc">%&gt;%</span> </span>
<span id="cb450-3"><a href="multi-dimensional-data-structures.html#cb450-3" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(year) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb450-4"><a href="multi-dimensional-data-structures.html#cb450-4" tabindex="-1"></a>  <span class="fu">pull</span>(year)</span>
<span id="cb450-5"><a href="multi-dimensional-data-structures.html#cb450-5" tabindex="-1"></a>st_ratio_var <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;ratings_ratio_vs_year&#39;</span>, ar_years_sorted[<span class="dv">1</span>])</span>
<span id="cb450-6"><a href="multi-dimensional-data-structures.html#cb450-6" tabindex="-1"></a></span>
<span id="cb450-7"><a href="multi-dimensional-data-structures.html#cb450-7" tabindex="-1"></a><span class="co"># Generate ratio over the first location</span></span>
<span id="cb450-8"><a href="multi-dimensional-data-structures.html#cb450-8" tabindex="-1"></a>df_attitude <span class="ot">&lt;-</span> df_attitude <span class="sc">%&gt;%</span> </span>
<span id="cb450-9"><a href="multi-dimensional-data-structures.html#cb450-9" tabindex="-1"></a>  <span class="fu">arrange</span>(country, year) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span> </span>
<span id="cb450-10"><a href="multi-dimensional-data-structures.html#cb450-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(st_ratio_var) <span class="sc">:=</span> rating<span class="sc">/</span><span class="fu">first</span>(rating))</span>
<span id="cb450-11"><a href="multi-dimensional-data-structures.html#cb450-11" tabindex="-1"></a>  </span>
<span id="cb450-12"><a href="multi-dimensional-data-structures.html#cb450-12" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb450-13"><a href="multi-dimensional-data-structures.html#cb450-13" tabindex="-1"></a><span class="co"># Within each country, we show the first 3 years </span></span>
<span id="cb450-14"><a href="multi-dimensional-data-structures.html#cb450-14" tabindex="-1"></a><span class="fu">kable</span>(df_attitude <span class="sc">%&gt;%</span> </span>
<span id="cb450-15"><a href="multi-dimensional-data-structures.html#cb450-15" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span> </span>
<span id="cb450-16"><a href="multi-dimensional-data-structures.html#cb450-16" tabindex="-1"></a>  <span class="fu">slice_min</span>(<span class="at">order_by =</span> year, <span class="at">n =</span> <span class="dv">3</span>)</span>
<span id="cb450-17"><a href="multi-dimensional-data-structures.html#cb450-17" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
year
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
country
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
rating
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ratings_ratio_vs_countrycanada
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ratings_ratio_vs_year1
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
canada
</td>
<td style="text-align:right;">
51
</td>
<td style="text-align:right;">
1.0000000
</td>
<td style="text-align:right;">
1.000000
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
canada
</td>
<td style="text-align:right;">
64
</td>
<td style="text-align:right;">
1.0000000
</td>
<td style="text-align:right;">
1.254902
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
canada
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:right;">
1.0000000
</td>
<td style="text-align:right;">
1.372549
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
uk
</td>
<td style="text-align:right;">
39
</td>
<td style="text-align:right;">
0.7647059
</td>
<td style="text-align:right;">
1.000000
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
uk
</td>
<td style="text-align:right;">
54
</td>
<td style="text-align:right;">
0.8437500
</td>
<td style="text-align:right;">
1.384615
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
uk
</td>
<td style="text-align:right;">
69
</td>
<td style="text-align:right;">
0.9857143
</td>
<td style="text-align:right;">
1.769231
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
usa
</td>
<td style="text-align:right;">
43
</td>
<td style="text-align:right;">
0.8431373
</td>
<td style="text-align:right;">
1.000000
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
usa
</td>
<td style="text-align:right;">
63
</td>
<td style="text-align:right;">
0.9843750
</td>
<td style="text-align:right;">
1.465116
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
usa
</td>
<td style="text-align:right;">
71
</td>
<td style="text-align:right;">
1.0142857
</td>
<td style="text-align:right;">
1.651163
</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="join-and-merge-files-together-by-keys" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Join and Merge Files Together by Keys<a href="multi-dimensional-data-structures.html#join-and-merge-files-together-by-keys" class="anchor-section" aria-label="Anchor link to header"></a></h2>

<div id="mesh-join" class="section level3 hasAnchor" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Mesh Join<a href="multi-dimensional-data-structures.html#mesh-join" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> research support package, <a href="https://fanwangecon.github.io/R4Econ/">R4Econ</a> examples page, <a href="https://fanwangecon.github.io/PkgTestR/">PkgTestR</a> packaging guide, or <a href="https://fanwangecon.github.io/Stat4Econ/">Stat4Econ</a> course page.</p>
</blockquote>
<div id="expand-multiple-rows-with-the-same-expansion" class="section level4 hasAnchor" number="4.4.1.1">
<h4><span class="header-section-number">4.4.1.1</span> Expand Multiple Rows with the Same Expansion<a href="multi-dimensional-data-structures.html#expand-multiple-rows-with-the-same-expansion" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>File A is at <code>ID x Week x DayOfWeek</code> level, file B is at <code>ID x DayOfWeek x Product</code>. Product is the product ID bought, could also store other info on product as additional variables. We want to create a file that is at <code>ID x Week x DayOfweek x Product</code> level.</p>
<p>The idea is that products bought made on Monday by household 1, for example are always the same, and file A records a “shopping-record”, which week, which day each household went shopping.</p>
<p>We do not store in file A what was bought because a particular household always buys the same thing on the same day of the week. We store data in A and B separately to save space since all products by the same household on the same day of week is always identical.</p>
<p>However, we need to join the two files together compute how many units of each product all households bought throughout some timeframe.</p>
<p>Step 1, construct File A, by fully messing ID, Week and Day of Week. In the simulated file below, household 1 shopped 3 times, twice on 3rd day of week, once on 2nd day of week, across two weeks. Household 2 shopped once, on the 3rd day of week.</p>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="multi-dimensional-data-structures.html#cb451-1" tabindex="-1"></a><span class="co"># Mesh</span></span>
<span id="cb451-2"><a href="multi-dimensional-data-structures.html#cb451-2" tabindex="-1"></a>ar_st_varnames <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;hh&#39;</span>,<span class="st">&#39;week&#39;</span>,<span class="st">&#39;dayofweek&#39;</span>)</span>
<span id="cb451-3"><a href="multi-dimensional-data-structures.html#cb451-3" tabindex="-1"></a>ar_it_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb451-4"><a href="multi-dimensional-data-structures.html#cb451-4" tabindex="-1"></a>ar_it_weeks <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb451-5"><a href="multi-dimensional-data-structures.html#cb451-5" tabindex="-1"></a>ar_it_daysofweek <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)</span>
<span id="cb451-6"><a href="multi-dimensional-data-structures.html#cb451-6" tabindex="-1"></a>df_idwkday_mesh <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(</span>
<span id="cb451-7"><a href="multi-dimensional-data-structures.html#cb451-7" tabindex="-1"></a>  ar_it_ids, ar_it_weeks, ar_it_daysofweek) <span class="sc">%&gt;%</span></span>
<span id="cb451-8"><a href="multi-dimensional-data-structures.html#cb451-8" tabindex="-1"></a>  <span class="fu">rename_all</span>(<span class="sc">~</span><span class="fu">c</span>(ar_st_varnames))</span>
<span id="cb451-9"><a href="multi-dimensional-data-structures.html#cb451-9" tabindex="-1"></a></span>
<span id="cb451-10"><a href="multi-dimensional-data-structures.html#cb451-10" tabindex="-1"></a><span class="co"># Randomly drop a subset of rows </span></span>
<span id="cb451-11"><a href="multi-dimensional-data-structures.html#cb451-11" tabindex="-1"></a><span class="co"># Different subset of ID and Week for each DayOfWeek. </span></span>
<span id="cb451-12"><a href="multi-dimensional-data-structures.html#cb451-12" tabindex="-1"></a>it_M <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb451-13"><a href="multi-dimensional-data-structures.html#cb451-13" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">456</span>)</span>
<span id="cb451-14"><a href="multi-dimensional-data-structures.html#cb451-14" tabindex="-1"></a>df_idwkday_mesh <span class="ot">&lt;-</span> df_idwkday_mesh[<span class="fu">sample</span>(<span class="fu">dim</span>(df_idwkday_mesh)[<span class="dv">1</span>], it_M, <span class="at">replace=</span><span class="cn">FALSE</span>),] <span class="sc">%&gt;%</span> </span>
<span id="cb451-15"><a href="multi-dimensional-data-structures.html#cb451-15" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">!!!</span><span class="fu">syms</span>(ar_st_varnames))</span>
<span id="cb451-16"><a href="multi-dimensional-data-structures.html#cb451-16" tabindex="-1"></a></span>
<span id="cb451-17"><a href="multi-dimensional-data-structures.html#cb451-17" tabindex="-1"></a><span class="co"># Display</span></span>
<span id="cb451-18"><a href="multi-dimensional-data-structures.html#cb451-18" tabindex="-1"></a>st_caption <span class="ot">&lt;-</span> <span class="st">&quot;File A (ID x Week x DayOfWeek)&quot;</span></span>
<span id="cb451-19"><a href="multi-dimensional-data-structures.html#cb451-19" tabindex="-1"></a><span class="fu">kable</span>(df_idwkday_mesh, <span class="at">caption=</span>st_caption) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-228">Table 4.7: </span>File A (ID x Week x DayOfWeek)
</caption>
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
hh
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
week
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dayofweek
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
</tr>
</tbody>
</table>
<p>Step 2, construct File B. We have shopping list for the 1st household on shopping from 1st, 2nd, and 3rd days of a week. We have a shopping list for 2nd household only for shopping on the 1st and 2nd day.</p>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="multi-dimensional-data-structures.html#cb452-1" tabindex="-1"></a><span class="co"># Generate day of week specific product file</span></span>
<span id="cb452-2"><a href="multi-dimensional-data-structures.html#cb452-2" tabindex="-1"></a>ar_st_varnames <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;hh&#39;</span>, <span class="st">&#39;dayofweek&#39;</span>, <span class="st">&#39;product&#39;</span>)</span>
<span id="cb452-3"><a href="multi-dimensional-data-structures.html#cb452-3" tabindex="-1"></a>ar_it_product <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="dv">14</span>)</span>
<span id="cb452-4"><a href="multi-dimensional-data-structures.html#cb452-4" tabindex="-1"></a>df_dayproduct_mesh <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(</span>
<span id="cb452-5"><a href="multi-dimensional-data-structures.html#cb452-5" tabindex="-1"></a>  ar_it_ids, ar_it_daysofweek, ar_it_product) <span class="sc">%&gt;%</span></span>
<span id="cb452-6"><a href="multi-dimensional-data-structures.html#cb452-6" tabindex="-1"></a>  <span class="fu">rename_all</span>(<span class="sc">~</span><span class="fu">c</span>(ar_st_varnames))</span>
<span id="cb452-7"><a href="multi-dimensional-data-structures.html#cb452-7" tabindex="-1"></a></span>
<span id="cb452-8"><a href="multi-dimensional-data-structures.html#cb452-8" tabindex="-1"></a><span class="co"># Make each day product list not identical</span></span>
<span id="cb452-9"><a href="multi-dimensional-data-structures.html#cb452-9" tabindex="-1"></a>it_M <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb452-10"><a href="multi-dimensional-data-structures.html#cb452-10" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb452-11"><a href="multi-dimensional-data-structures.html#cb452-11" tabindex="-1"></a>df_dayproduct_mesh <span class="ot">&lt;-</span> df_dayproduct_mesh[<span class="fu">sample</span>(<span class="fu">dim</span>(df_dayproduct_mesh)[<span class="dv">1</span>], it_M, <span class="at">replace=</span><span class="cn">FALSE</span>),] <span class="sc">%&gt;%</span> </span>
<span id="cb452-12"><a href="multi-dimensional-data-structures.html#cb452-12" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">!!!</span><span class="fu">syms</span>(ar_st_varnames))</span>
<span id="cb452-13"><a href="multi-dimensional-data-structures.html#cb452-13" tabindex="-1"></a></span>
<span id="cb452-14"><a href="multi-dimensional-data-structures.html#cb452-14" tabindex="-1"></a><span class="co"># Display</span></span>
<span id="cb452-15"><a href="multi-dimensional-data-structures.html#cb452-15" tabindex="-1"></a>st_caption <span class="ot">&lt;-</span> <span class="st">&quot;File B (ID x DayOfWeek x Product)&quot;</span></span>
<span id="cb452-16"><a href="multi-dimensional-data-structures.html#cb452-16" tabindex="-1"></a><span class="fu">kable</span>(df_dayproduct_mesh, <span class="at">caption=</span>st_caption) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-229">Table 4.8: </span>File B (ID x DayOfWeek x Product)
</caption>
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
hh
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dayofweek
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
product
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
14
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
13
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
14
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
13
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
11
</td>
</tr>
</tbody>
</table>
<p>Step 3. we combine files A and B together via <a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">dplyr::left_join</a>.</p>
<p>Given the sample files we have constructed we have:</p>
<ul>
<li>multiple items in shopping list for household 1 on day 3</li>
<li>no shopping list for household 2 on day 3</li>
<li>shopping list available on days that do not appear on shopping days tracking list</li>
</ul>
<p>When we left_join, we do not include in combined file shopping list from days for households not in the tracking list. Note that from the output below, we achieved several things:</p>
<ul>
<li>the day 3 shopping list for household 1 is merged in twice, to household’s trips on day 3 in both week 1 and 2, rows expanded because 3 items bought on each day</li>
<li>the day 2 shopping list for household 1 is merged in once, there are no row-expansion, since there was one item bought on this shopping list</li>
<li>the day 3 shopping list for household 2 is not merged in, since the shopping list does not exist, but the row remains.</li>
</ul>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="multi-dimensional-data-structures.html#cb453-1" tabindex="-1"></a><span class="co"># left join</span></span>
<span id="cb453-2"><a href="multi-dimensional-data-structures.html#cb453-2" tabindex="-1"></a>df_left_join <span class="ot">&lt;-</span> df_idwkday_mesh <span class="sc">%&gt;%</span> </span>
<span id="cb453-3"><a href="multi-dimensional-data-structures.html#cb453-3" tabindex="-1"></a>  <span class="fu">left_join</span>(df_dayproduct_mesh, </span>
<span id="cb453-4"><a href="multi-dimensional-data-structures.html#cb453-4" tabindex="-1"></a>  <span class="at">by=</span> <span class="fu">c</span>(<span class="st">&#39;hh&#39;</span><span class="ot">=</span><span class="st">&#39;hh&#39;</span>, <span class="st">&#39;dayofweek&#39;</span><span class="ot">=</span><span class="st">&#39;dayofweek&#39;</span>))</span>
<span id="cb453-5"><a href="multi-dimensional-data-structures.html#cb453-5" tabindex="-1"></a><span class="co"># Display left-join</span></span>
<span id="cb453-6"><a href="multi-dimensional-data-structures.html#cb453-6" tabindex="-1"></a>st_caption <span class="ot">&lt;-</span> <span class="st">&quot;File C, left-join (ID x Week x DayOfweek x Product)&quot;</span></span>
<span id="cb453-7"><a href="multi-dimensional-data-structures.html#cb453-7" tabindex="-1"></a><span class="fu">kable</span>(df_left_join, <span class="at">caption=</span>st_caption) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-230">Table 4.9: </span>File C, left-join (ID x Week x DayOfweek x Product)
</caption>
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
hh
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
week
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dayofweek
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
product
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
13
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
14
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
14
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
13
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
14
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table>
<p>Step 4, now, we also try <a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">dplyr::full_join</a>. Note that the full-join result is not what we want, it added shopping list by household to the file, but these shopping lists were un-realized, since the households did not shop in any week on those days. So our desired result is achieved by <a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">dplyr::left_join</a>.</p>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="multi-dimensional-data-structures.html#cb454-1" tabindex="-1"></a><span class="co"># full join</span></span>
<span id="cb454-2"><a href="multi-dimensional-data-structures.html#cb454-2" tabindex="-1"></a>df_full_join <span class="ot">&lt;-</span> df_idwkday_mesh <span class="sc">%&gt;%</span> </span>
<span id="cb454-3"><a href="multi-dimensional-data-structures.html#cb454-3" tabindex="-1"></a>  <span class="fu">full_join</span>(df_dayproduct_mesh, </span>
<span id="cb454-4"><a href="multi-dimensional-data-structures.html#cb454-4" tabindex="-1"></a>  <span class="at">by=</span> <span class="fu">c</span>(<span class="st">&#39;hh&#39;</span><span class="ot">=</span><span class="st">&#39;hh&#39;</span>, <span class="st">&#39;dayofweek&#39;</span><span class="ot">=</span><span class="st">&#39;dayofweek&#39;</span>))</span>
<span id="cb454-5"><a href="multi-dimensional-data-structures.html#cb454-5" tabindex="-1"></a><span class="co"># Display full-join</span></span>
<span id="cb454-6"><a href="multi-dimensional-data-structures.html#cb454-6" tabindex="-1"></a>st_caption <span class="ot">&lt;-</span> <span class="st">&quot;File C, full-join (ID x Week x DayOfweek x Product)&quot;</span></span>
<span id="cb454-7"><a href="multi-dimensional-data-structures.html#cb454-7" tabindex="-1"></a><span class="fu">kable</span>(df_full_join, <span class="at">caption=</span>st_caption) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-231">Table 4.10: </span>File C, full-join (ID x Week x DayOfweek x Product)
</caption>
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
hh
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
week
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dayofweek
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
product
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
13
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
14
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
14
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
13
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
14
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
13
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
11
</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="functions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="linear-regression.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": [["Panel-Data-and-Optimization-with-R.pdf", "PDF"]],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
