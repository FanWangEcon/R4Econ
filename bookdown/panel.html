<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Panel | Data Structures, Estimation and Optimization with R</title>
  <meta name="description" content="<p>Run system executable and shell commands.
Activate conda environment with shell script.</p>" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Panel | Data Structures, Estimation and Optimization with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="<p>Run system executable and shell commands.
Activate conda environment with shell script.</p>" />
  <meta name="github-repo" content="fanwangecon/R4Econ" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Panel | Data Structures, Estimation and Optimization with R" />
  
  <meta name="twitter:description" content="<p>Run system executable and shell commands.
Activate conda environment with shell script.</p>" />
  

<meta name="author" content="Fan Wang" />


<meta name="date" content="2021-01-08" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="functions.html"/>
<link rel="next" href="linear-regression.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-92953468-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-92953468-5');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Structures and Estimation with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html"><i class="fa fa-check"></i><b>1</b> Array, Matrix, Dataframe</a>
<ul>
<li class="chapter" data-level="1.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#list"><i class="fa fa-check"></i><b>1.1</b> List</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#multiple-dimensional-list"><i class="fa fa-check"></i><b>1.1.1</b> Multiple Dimensional List</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#array"><i class="fa fa-check"></i><b>1.2</b> Array</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#array-basics"><i class="fa fa-check"></i><b>1.2.1</b> Array Basics</a></li>
<li class="chapter" data-level="1.2.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-arrays"><i class="fa fa-check"></i><b>1.2.2</b> Generate Arrays</a></li>
<li class="chapter" data-level="1.2.3" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#string-arrays"><i class="fa fa-check"></i><b>1.2.3</b> String Arrays</a></li>
<li class="chapter" data-level="1.2.4" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#mesh-matrices-arrays-and-scalars"><i class="fa fa-check"></i><b>1.2.4</b> Mesh Matrices, Arrays and Scalars</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#matrix"><i class="fa fa-check"></i><b>1.3</b> Matrix</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-matrixes"><i class="fa fa-check"></i><b>1.3.1</b> Generate Matrixes</a></li>
<li class="chapter" data-level="1.3.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#linear-algebra"><i class="fa fa-check"></i><b>1.3.2</b> Linear Algebra</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#variables-in-dataframes"><i class="fa fa-check"></i><b>1.4</b> Variables in Dataframes</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-dataframe"><i class="fa fa-check"></i><b>1.4.1</b> Generate Dataframe</a></li>
<li class="chapter" data-level="1.4.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#factor-label-and-combine"><i class="fa fa-check"></i><b>1.4.2</b> Factor Label and Combine</a></li>
<li class="chapter" data-level="1.4.3" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#drawly-random-rows"><i class="fa fa-check"></i><b>1.4.3</b> Drawly Random Rows</a></li>
<li class="chapter" data-level="1.4.4" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-variables-conditional-on-others"><i class="fa fa-check"></i><b>1.4.4</b> Generate Variables Conditional On Others</a></li>
<li class="chapter" data-level="1.4.5" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#string-values"><i class="fa fa-check"></i><b>1.4.5</b> String Values</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="summarize-data.html"><a href="summarize-data.html"><i class="fa fa-check"></i><b>2</b> Summarize Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="summarize-data.html"><a href="summarize-data.html#counting-observation"><i class="fa fa-check"></i><b>2.1</b> Counting Observation</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="summarize-data.html"><a href="summarize-data.html#uncount"><i class="fa fa-check"></i><b>2.1.1</b> Uncount</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="summarize-data.html"><a href="summarize-data.html#sorting-indexing-slicing"><i class="fa fa-check"></i><b>2.2</b> Sorting, Indexing, Slicing</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="summarize-data.html"><a href="summarize-data.html#sorting"><i class="fa fa-check"></i><b>2.2.1</b> Sorting</a></li>
<li class="chapter" data-level="2.2.2" data-path="summarize-data.html"><a href="summarize-data.html#group-sort-and-slice"><i class="fa fa-check"></i><b>2.2.2</b> Group, Sort and Slice</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="summarize-data.html"><a href="summarize-data.html#group-statistics"><i class="fa fa-check"></i><b>2.3</b> Group Statistics</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="summarize-data.html"><a href="summarize-data.html#cumulative-statistics-within-group"><i class="fa fa-check"></i><b>2.3.1</b> Cumulative Statistics within Group</a></li>
<li class="chapter" data-level="2.3.2" data-path="summarize-data.html"><a href="summarize-data.html#groups-statistics"><i class="fa fa-check"></i><b>2.3.2</b> Groups Statistics</a></li>
<li class="chapter" data-level="2.3.3" data-path="summarize-data.html"><a href="summarize-data.html#one-variable-group-summary"><i class="fa fa-check"></i><b>2.3.3</b> One Variable Group Summary</a></li>
<li class="chapter" data-level="2.3.4" data-path="summarize-data.html"><a href="summarize-data.html#nested-within-group-stats"><i class="fa fa-check"></i><b>2.3.4</b> Nested within Group Stats</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="summarize-data.html"><a href="summarize-data.html#distributional-statistics"><i class="fa fa-check"></i><b>2.4</b> Distributional Statistics</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="summarize-data.html"><a href="summarize-data.html#histogram"><i class="fa fa-check"></i><b>2.4.1</b> Histogram</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="summarize-data.html"><a href="summarize-data.html#summarize-multiple-variables"><i class="fa fa-check"></i><b>2.5</b> Summarize Multiple Variables</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="summarize-data.html"><a href="summarize-data.html#generate-replace-variables"><i class="fa fa-check"></i><b>2.5.1</b> Generate Replace Variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>3</b> Functions</a>
<ul>
<li class="chapter" data-level="3.1" data-path="functions.html"><a href="functions.html#dataframe-mutate"><i class="fa fa-check"></i><b>3.1</b> Dataframe Mutate</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="functions.html"><a href="functions.html#row-input-functions"><i class="fa fa-check"></i><b>3.1.1</b> Row Input Functions</a></li>
<li class="chapter" data-level="3.1.2" data-path="functions.html"><a href="functions.html#evaluate-choices-across-states"><i class="fa fa-check"></i><b>3.1.2</b> Evaluate Choices Across States</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="functions.html"><a href="functions.html#dataframe-do-anything"><i class="fa fa-check"></i><b>3.2</b> Dataframe Do Anything</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="functions.html"><a href="functions.html#mx1-by-n-to-mxq-by-n1"><i class="fa fa-check"></i><b>3.2.1</b> (Mx1 by N) to (MxQ by N+1)</a></li>
<li class="chapter" data-level="3.2.2" data-path="functions.html"><a href="functions.html#mxp-by-n-to-mx1-by-1"><i class="fa fa-check"></i><b>3.2.2</b> (MxP by N) to (Mx1 by 1)</a></li>
<li class="chapter" data-level="3.2.3" data-path="functions.html"><a href="functions.html#mxp-by-n-to-mxq-by-nz"><i class="fa fa-check"></i><b>3.2.3</b> (MxP by N) to (MxQ by N+Z)</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="functions.html"><a href="functions.html#apply-and-pmap"><i class="fa fa-check"></i><b>3.3</b> Apply and pmap</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="functions.html"><a href="functions.html#apply-and-sapply"><i class="fa fa-check"></i><b>3.3.1</b> Apply and Sapply</a></li>
<li class="chapter" data-level="3.3.2" data-path="functions.html"><a href="functions.html#mutate-evaluate-functions"><i class="fa fa-check"></i><b>3.3.2</b> Mutate Evaluate Functions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="panel.html"><a href="panel.html"><i class="fa fa-check"></i><b>4</b> Panel</a>
<ul>
<li class="chapter" data-level="4.1" data-path="panel.html"><a href="panel.html#generate-and-join"><i class="fa fa-check"></i><b>4.1</b> Generate and Join</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="panel.html"><a href="panel.html#generate-panel-structure"><i class="fa fa-check"></i><b>4.1.1</b> Generate Panel Structure</a></li>
<li class="chapter" data-level="4.1.2" data-path="panel.html"><a href="panel.html#join-datasets"><i class="fa fa-check"></i><b>4.1.2</b> Join Datasets</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="panel.html"><a href="panel.html#wide-and-long"><i class="fa fa-check"></i><b>4.2</b> Wide and Long</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="panel.html"><a href="panel.html#long-to-wide"><i class="fa fa-check"></i><b>4.2.1</b> Long to Wide</a></li>
<li class="chapter" data-level="4.2.2" data-path="panel.html"><a href="panel.html#wide-to-long"><i class="fa fa-check"></i><b>4.2.2</b> Wide to Long</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i><b>5</b> Linear Regression</a>
<ul>
<li class="chapter" data-level="5.1" data-path="linear-regression.html"><a href="linear-regression.html#ols-and-iv"><i class="fa fa-check"></i><b>5.1</b> OLS and IV</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="linear-regression.html"><a href="linear-regression.html#ols-and-iv-regression"><i class="fa fa-check"></i><b>5.1.1</b> OLS and IV Regression</a></li>
<li class="chapter" data-level="5.1.2" data-path="linear-regression.html"><a href="linear-regression.html#iv-loop-over-rhs"><i class="fa fa-check"></i><b>5.1.2</b> IV Loop over RHS</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="linear-regression.html"><a href="linear-regression.html#decomposition"><i class="fa fa-check"></i><b>5.2</b> Decomposition</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="linear-regression.html"><a href="linear-regression.html#decompose-rhs"><i class="fa fa-check"></i><b>5.2.1</b> Decompose RHS</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html"><i class="fa fa-check"></i><b>6</b> Nonlinear Regression</a>
<ul>
<li class="chapter" data-level="6.1" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html#logit-regression"><i class="fa fa-check"></i><b>6.1</b> Logit Regression</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html#binary-logit"><i class="fa fa-check"></i><b>6.1.1</b> Binary Logit</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html#quantile-regression"><i class="fa fa-check"></i><b>6.2</b> Quantile Regression</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html#quantile-regression-basics"><i class="fa fa-check"></i><b>6.2.1</b> Quantile Regression Basics</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="optimization.html"><a href="optimization.html"><i class="fa fa-check"></i><b>7</b> Optimization</a>
<ul>
<li class="chapter" data-level="7.1" data-path="optimization.html"><a href="optimization.html#bisection"><i class="fa fa-check"></i><b>7.1</b> Bisection</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="optimization.html"><a href="optimization.html#bisection-1"><i class="fa fa-check"></i><b>7.1.1</b> Bisection</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html"><i class="fa fa-check"></i><b>8</b> Mathmatics and Statistics</a>
<ul>
<li class="chapter" data-level="8.1" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#distributions"><i class="fa fa-check"></i><b>8.1</b> Distributions</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#integrate-over-normal-guassian-process-shock"><i class="fa fa-check"></i><b>8.1.1</b> Integrate Over Normal Guassian Process Shock</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#analytical-solutions"><i class="fa fa-check"></i><b>8.2</b> Analytical Solutions</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#linear-scalar-fx0-solutions"><i class="fa fa-check"></i><b>8.2.1</b> Linear Scalar f(x)=0 Solutions</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#inequality-models"><i class="fa fa-check"></i><b>8.3</b> Inequality Models</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#gini-discrete-sample"><i class="fa fa-check"></i><b>8.3.1</b> Gini Discrete Sample</a></li>
<li class="chapter" data-level="8.3.2" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#atkinson-inequality-index"><i class="fa fa-check"></i><b>8.3.2</b> Atkinson Inequality Index</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html"><i class="fa fa-check"></i><b>9</b> Tables and Graphs</a>
<ul>
<li class="chapter" data-level="9.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#r-base-plots"><i class="fa fa-check"></i><b>9.1</b> R Base Plots</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#plot-curve-line-and-points"><i class="fa fa-check"></i><b>9.1.1</b> Plot Curve, Line and Points</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#write-and-read-plots"><i class="fa fa-check"></i><b>9.2</b> Write and Read Plots</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#import-and-export-images"><i class="fa fa-check"></i><b>9.2.1</b> Import and Export Images</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="get-data.html"><a href="get-data.html"><i class="fa fa-check"></i><b>10</b> Get Data</a>
<ul>
<li class="chapter" data-level="10.1" data-path="get-data.html"><a href="get-data.html#environmental-data"><i class="fa fa-check"></i><b>10.1</b> Environmental Data</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="get-data.html"><a href="get-data.html#ecmwf-era5-data"><i class="fa fa-check"></i><b>10.1.1</b> ECMWF ERA5 Data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="code-and-development.html"><a href="code-and-development.html"><i class="fa fa-check"></i><b>11</b> Code and Development</a>
<ul>
<li class="chapter" data-level="11.1" data-path="code-and-development.html"><a href="code-and-development.html#file-in-and-out"><i class="fa fa-check"></i><b>11.1</b> File in and Out</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="code-and-development.html"><a href="code-and-development.html#text-to-file"><i class="fa fa-check"></i><b>11.1.1</b> Text to File</a></li>
<li class="chapter" data-level="11.1.2" data-path="code-and-development.html"><a href="code-and-development.html#rmd-to-html"><i class="fa fa-check"></i><b>11.1.2</b> Rmd to HTML</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="code-and-development.html"><a href="code-and-development.html#python-with-r"><i class="fa fa-check"></i><b>11.2</b> Python with R</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="code-and-development.html"><a href="code-and-development.html#reticulate-basics"><i class="fa fa-check"></i><b>11.2.1</b> Reticulate Basics</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="code-and-development.html"><a href="code-and-development.html#command-line"><i class="fa fa-check"></i><b>11.3</b> Command Line</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="code-and-development.html"><a href="code-and-development.html#shell-and-system-commands"><i class="fa fa-check"></i><b>11.3.1</b> Shell and System Commands</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="index-and-code-links.html"><a href="index-and-code-links.html"><i class="fa fa-check"></i><b>A</b> Index and Code Links</a>
<ul>
<li class="chapter" data-level="A.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#array-matrix-dataframe-links"><i class="fa fa-check"></i><b>A.1</b> Array, Matrix, Dataframe links</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.1-listlist-links"><i class="fa fa-check"></i><b>A.1.1</b> <span>Section 1.1 List</span> links</a></li>
<li class="chapter" data-level="A.1.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.2-arrayarray-links"><i class="fa fa-check"></i><b>A.1.2</b> <span>Section 1.2 Array</span> links</a></li>
<li class="chapter" data-level="A.1.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.3-matrixmatrix-links"><i class="fa fa-check"></i><b>A.1.3</b> <span>Section 1.3 Matrix</span> links</a></li>
<li class="chapter" data-level="A.1.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.4-variables-in-dataframesvariables-in-dataframes-links"><i class="fa fa-check"></i><b>A.1.4</b> <span>Section 1.4 Variables in Dataframes</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#summarize-data-links"><i class="fa fa-check"></i><b>A.2</b> Summarize Data links</a>
<ul>
<li class="chapter" data-level="A.2.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.1-counting-observationcounting-observation-links"><i class="fa fa-check"></i><b>A.2.1</b> <span>Section 2.1 Counting Observation</span> links</a></li>
<li class="chapter" data-level="A.2.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.2-sorting-indexing-slicingsorting-indexing-slicing-links"><i class="fa fa-check"></i><b>A.2.2</b> <span>Section 2.2 Sorting, Indexing, Slicing</span> links</a></li>
<li class="chapter" data-level="A.2.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.3-group-statisticsgroup-statistics-links"><i class="fa fa-check"></i><b>A.2.3</b> <span>Section 2.3 Group Statistics</span> links</a></li>
<li class="chapter" data-level="A.2.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.4-distributional-statisticsdistributional-statistics-links"><i class="fa fa-check"></i><b>A.2.4</b> <span>Section 2.4 Distributional Statistics</span> links</a></li>
<li class="chapter" data-level="A.2.5" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.5-summarize-multiple-variablessummarize-multiple-variables-links"><i class="fa fa-check"></i><b>A.2.5</b> <span>Section 2.5 Summarize Multiple Variables</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#functions-links"><i class="fa fa-check"></i><b>A.3</b> Functions links</a>
<ul>
<li class="chapter" data-level="A.3.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.1-dataframe-mutatedataframe-mutate-links"><i class="fa fa-check"></i><b>A.3.1</b> <span>Section 3.1 Dataframe Mutate</span> links</a></li>
<li class="chapter" data-level="A.3.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.2-dataframe-do-anythingdataframe-do-anything-links"><i class="fa fa-check"></i><b>A.3.2</b> <span>Section 3.2 Dataframe Do Anything</span> links</a></li>
<li class="chapter" data-level="A.3.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.3-apply-and-pmapapply-and-pmap-links"><i class="fa fa-check"></i><b>A.3.3</b> <span>Section 3.3 Apply and pmap</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#panel-links"><i class="fa fa-check"></i><b>A.4</b> Panel links</a>
<ul>
<li class="chapter" data-level="A.4.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-4.1-generate-and-joingenerate-and-join-links"><i class="fa fa-check"></i><b>A.4.1</b> <span>Section 4.1 Generate and Join</span> links</a></li>
<li class="chapter" data-level="A.4.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-4.2-wide-and-longwide-and-long-links"><i class="fa fa-check"></i><b>A.4.2</b> <span>Section 4.2 Wide and Long</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.5" data-path="index-and-code-links.html"><a href="index-and-code-links.html#linear-regression-links"><i class="fa fa-check"></i><b>A.5</b> Linear Regression links</a>
<ul>
<li class="chapter" data-level="A.5.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-5.1-ols-and-ivols-and-iv-links"><i class="fa fa-check"></i><b>A.5.1</b> <span>Section 5.1 OLS and IV</span> links</a></li>
<li class="chapter" data-level="A.5.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-5.2-decompositiondecomposition-links"><i class="fa fa-check"></i><b>A.5.2</b> <span>Section 5.2 Decomposition</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.6" data-path="index-and-code-links.html"><a href="index-and-code-links.html#nonlinear-regression-links"><i class="fa fa-check"></i><b>A.6</b> Nonlinear Regression links</a>
<ul>
<li class="chapter" data-level="A.6.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-6.1-logit-regressionlogit-regression-links"><i class="fa fa-check"></i><b>A.6.1</b> <span>Section 6.1 Logit Regression</span> links</a></li>
<li class="chapter" data-level="A.6.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-6.2-quantile-regressionquantile-regression-links"><i class="fa fa-check"></i><b>A.6.2</b> <span>Section 6.2 Quantile Regression</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.7" data-path="index-and-code-links.html"><a href="index-and-code-links.html#optimization-links"><i class="fa fa-check"></i><b>A.7</b> Optimization links</a>
<ul>
<li class="chapter" data-level="A.7.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-7.1-bisectionbisection-links"><i class="fa fa-check"></i><b>A.7.1</b> <span>Section 7.1 Bisection</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.8" data-path="index-and-code-links.html"><a href="index-and-code-links.html#mathmatics-and-statistics-links"><i class="fa fa-check"></i><b>A.8</b> Mathmatics and Statistics links</a>
<ul>
<li class="chapter" data-level="A.8.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-8.1-distributionsdistributions-links"><i class="fa fa-check"></i><b>A.8.1</b> <span>Section 8.1 Distributions</span> links</a></li>
<li class="chapter" data-level="A.8.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-8.2-analytical-solutionsanalytical-solutions-links"><i class="fa fa-check"></i><b>A.8.2</b> <span>Section 8.2 Analytical Solutions</span> links</a></li>
<li class="chapter" data-level="A.8.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-8.3-inequality-modelsinequality-models-links"><i class="fa fa-check"></i><b>A.8.3</b> <span>Section 8.3 Inequality Models</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.9" data-path="index-and-code-links.html"><a href="index-and-code-links.html#tables-and-graphs-links"><i class="fa fa-check"></i><b>A.9</b> Tables and Graphs links</a>
<ul>
<li class="chapter" data-level="A.9.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-9.1-r-base-plotsr-base-plots-links"><i class="fa fa-check"></i><b>A.9.1</b> <span>Section 9.1 R Base Plots</span> links</a></li>
<li class="chapter" data-level="A.9.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-9.2-write-and-read-plotswrite-and-read-plots-links"><i class="fa fa-check"></i><b>A.9.2</b> <span>Section 9.2 Write and Read Plots</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.10" data-path="index-and-code-links.html"><a href="index-and-code-links.html#get-data-links"><i class="fa fa-check"></i><b>A.10</b> Get Data links</a>
<ul>
<li class="chapter" data-level="A.10.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-10.1-environmental-dataenvironmental-data-links"><i class="fa fa-check"></i><b>A.10.1</b> <span>Section 10.1 Environmental Data</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.11" data-path="index-and-code-links.html"><a href="index-and-code-links.html#code-and-development-links"><i class="fa fa-check"></i><b>A.11</b> Code and Development links</a>
<ul>
<li class="chapter" data-level="A.11.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-11.1-file-in-and-outfile-in-and-out-links"><i class="fa fa-check"></i><b>A.11.1</b> <span>Section 11.1 File in and Out</span> links</a></li>
<li class="chapter" data-level="A.11.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-11.2-python-with-rpython-with-r-links"><i class="fa fa-check"></i><b>A.11.2</b> <span>Section 11.2 Python with R</span> links</a></li>
<li class="chapter" data-level="A.11.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-11.3-command-linecommand-line-links"><i class="fa fa-check"></i><b>A.11.3</b> <span>Section 11.3 Command Line</span> links</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://fanwangecon.github.io/R4Econ/bookdown/index.html" target="blank">R4Econ Bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Structures, Estimation and Optimization with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="panel" class="section level1" number="4">
<h1><span class="header-section-number">Chapter 4</span> Panel</h1>

<div id="generate-and-join" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Generate and Join</h2>

<div id="generate-panel-structure" class="section level3" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Generate Panel Structure</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>â€™s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R Code Examples</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository (<a href="https://fanwangecon.github.io/Stat4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<div id="balanced-panel-skeleton" class="section level4" number="4.1.1.1">
<h4><span class="header-section-number">4.1.1.1</span> Balanced Panel Skeleton</h4>
<p>There are <span class="math inline">\(N\)</span> individuals, each could be observed <span class="math inline">\(M\)</span> times. In the example below, there are 3 students, each observed over 4 dates. This just uses the <a href="https://tidyr.tidyverse.org/reference/uncount.html">uncount</a> function from <em>tidyr</em>.</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="panel.html#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define</span></span>
<span id="cb278-2"><a href="panel.html#cb278-2" aria-hidden="true" tabindex="-1"></a>it_N <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb278-3"><a href="panel.html#cb278-3" aria-hidden="true" tabindex="-1"></a>it_M <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb278-4"><a href="panel.html#cb278-4" aria-hidden="true" tabindex="-1"></a>svr_id <span class="ot">&lt;-</span> <span class="st">&#39;student_id&#39;</span></span>
<span id="cb278-5"><a href="panel.html#cb278-5" aria-hidden="true" tabindex="-1"></a>svr_date <span class="ot">&lt;-</span> <span class="st">&#39;class_day&#39;</span></span>
<span id="cb278-6"><a href="panel.html#cb278-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-7"><a href="panel.html#cb278-7" aria-hidden="true" tabindex="-1"></a><span class="co"># dataframe</span></span>
<span id="cb278-8"><a href="panel.html#cb278-8" aria-hidden="true" tabindex="-1"></a>df_panel_skeleton <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">matrix</span>(it_M, <span class="at">nrow=</span>it_N, <span class="at">ncol=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb278-9"><a href="panel.html#cb278-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="at">var =</span> svr_id) <span class="sc">%&gt;%</span></span>
<span id="cb278-10"><a href="panel.html#cb278-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">uncount</span>(V1) <span class="sc">%&gt;%</span></span>
<span id="cb278-11"><a href="panel.html#cb278-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_id)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_date) <span class="sc">:</span><span class="er">=</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb278-12"><a href="panel.html#cb278-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb278-13"><a href="panel.html#cb278-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-14"><a href="panel.html#cb278-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb278-15"><a href="panel.html#cb278-15" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df_panel_skeleton) <span class="sc">%&gt;%</span></span>
<span id="cb278-16"><a href="panel.html#cb278-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
student_id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
class_day
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5
</td>
</tr>
</tbody>
</table>
</div>
<div id="panel-of-children-with-height-growth" class="section level4" number="4.1.1.2">
<h4><span class="header-section-number">4.1.1.2</span> Panel of Children with Height Growth</h4>
<p>Given <span class="math inline">\(N\)</span> individuals, each with <span class="math inline">\(G\)</span> observations. There is an initial height variable and height grows every year. There are growth variables, variables for cumulative growth and variables for height at each age for each child.</p>
<p>Individuals are defined by gender (1 = female), race (1=asian), and birth height. Within individual yearly information includes height at each year of age.</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="panel.html#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define</span></span>
<span id="cb279-2"><a href="panel.html#cb279-2" aria-hidden="true" tabindex="-1"></a>it_N <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb279-3"><a href="panel.html#cb279-3" aria-hidden="true" tabindex="-1"></a>it_M <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb279-4"><a href="panel.html#cb279-4" aria-hidden="true" tabindex="-1"></a>svr_id <span class="ot">&lt;-</span> <span class="st">&#39;indi_id&#39;</span></span>
<span id="cb279-5"><a href="panel.html#cb279-5" aria-hidden="true" tabindex="-1"></a>svr_gender <span class="ot">&lt;-</span> <span class="st">&#39;female&#39;</span></span>
<span id="cb279-6"><a href="panel.html#cb279-6" aria-hidden="true" tabindex="-1"></a>svr_asian <span class="ot">&lt;-</span> <span class="st">&#39;asian&#39;</span></span>
<span id="cb279-7"><a href="panel.html#cb279-7" aria-hidden="true" tabindex="-1"></a>svr_age <span class="ot">&lt;-</span> <span class="st">&#39;year_of_age&#39;</span></span>
<span id="cb279-8"><a href="panel.html#cb279-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Define Height Related Variables</span></span>
<span id="cb279-9"><a href="panel.html#cb279-9" aria-hidden="true" tabindex="-1"></a>svr_brthgt <span class="ot">&lt;-</span> <span class="st">&#39;birth_height&#39;</span></span>
<span id="cb279-10"><a href="panel.html#cb279-10" aria-hidden="true" tabindex="-1"></a>svr_hgtgrow <span class="ot">&lt;-</span> <span class="st">&#39;hgt_growth&#39;</span></span>
<span id="cb279-11"><a href="panel.html#cb279-11" aria-hidden="true" tabindex="-1"></a>svr_hgtgrow_cumu <span class="ot">&lt;-</span> <span class="st">&#39;hgt_growcumu&#39;</span></span>
<span id="cb279-12"><a href="panel.html#cb279-12" aria-hidden="true" tabindex="-1"></a>svr_height <span class="ot">&lt;-</span> <span class="st">&#39;height&#39;</span></span>
<span id="cb279-13"><a href="panel.html#cb279-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-14"><a href="panel.html#cb279-14" aria-hidden="true" tabindex="-1"></a><span class="co"># panel dataframe following</span></span>
<span id="cb279-15"><a href="panel.html#cb279-15" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb279-16"><a href="panel.html#cb279-16" aria-hidden="true" tabindex="-1"></a>df_panel_indiage <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">matrix</span>(it_M, <span class="at">nrow=</span>it_N, <span class="at">ncol=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb279-17"><a href="panel.html#cb279-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_gender) <span class="sc">:</span><span class="er">=</span> <span class="fu">rbinom</span>(<span class="fu">n</span>(), <span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb279-18"><a href="panel.html#cb279-18" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!!</span><span class="fu">sym</span>(svr_asian) <span class="sc">:</span><span class="er">=</span> <span class="fu">rbinom</span>(<span class="fu">n</span>(), <span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb279-19"><a href="panel.html#cb279-19" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!!</span><span class="fu">sym</span>(svr_brthgt) <span class="sc">:</span><span class="er">=</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="at">mean=</span><span class="dv">60</span>,<span class="at">sd=</span><span class="dv">3</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb279-20"><a href="panel.html#cb279-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">uncount</span>(V1) <span class="sc">%&gt;%</span></span>
<span id="cb279-21"><a href="panel.html#cb279-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_gender), <span class="sc">!!</span><span class="fu">sym</span>(svr_asian), <span class="sc">!!</span><span class="fu">sym</span>(svr_brthgt)) <span class="sc">%&gt;%</span></span>
<span id="cb279-22"><a href="panel.html#cb279-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_age) <span class="sc">:</span><span class="er">=</span> <span class="fu">row_number</span>(),</span>
<span id="cb279-23"><a href="panel.html#cb279-23" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!!</span><span class="fu">sym</span>(svr_hgtgrow) <span class="sc">:</span><span class="er">=</span> <span class="fu">runif</span>(<span class="fu">n</span>(), <span class="at">min=</span><span class="dv">5</span>, <span class="at">max=</span><span class="dv">15</span>),</span>
<span id="cb279-24"><a href="panel.html#cb279-24" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!!</span><span class="fu">sym</span>(svr_hgtgrow_cumu) <span class="sc">:</span><span class="er">=</span> <span class="fu">cumsum</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_hgtgrow)),</span>
<span id="cb279-25"><a href="panel.html#cb279-25" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!!</span><span class="fu">sym</span>(svr_height) <span class="sc">:</span><span class="er">=</span> <span class="sc">!!</span><span class="fu">sym</span>(svr_brthgt) <span class="sc">+</span> <span class="sc">!!</span><span class="fu">sym</span>(svr_hgtgrow_cumu))  <span class="sc">%&gt;%</span></span>
<span id="cb279-26"><a href="panel.html#cb279-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb279-27"><a href="panel.html#cb279-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-28"><a href="panel.html#cb279-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Add Height Index</span></span>
<span id="cb279-29"><a href="panel.html#cb279-29" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df_panel_indiage) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
female
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
asian
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
birth_height
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
year_of_age
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
hgt_growth
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
hgt_growcumu
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
height
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
65.14520
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
13.895393
</td>
<td style="text-align:right;">
13.895393
</td>
<td style="text-align:right;">
79.04059
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
65.14520
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
11.928034
</td>
<td style="text-align:right;">
25.823427
</td>
<td style="text-align:right;">
90.96862
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
65.14520
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
11.405068
</td>
<td style="text-align:right;">
37.228495
</td>
<td style="text-align:right;">
102.37369
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
61.38275
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
11.907053
</td>
<td style="text-align:right;">
11.907053
</td>
<td style="text-align:right;">
73.28980
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
61.38275
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
12.954674
</td>
<td style="text-align:right;">
24.861727
</td>
<td style="text-align:right;">
86.24448
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
61.38275
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5.246137
</td>
<td style="text-align:right;">
30.107864
</td>
<td style="text-align:right;">
91.49061
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
56.20482
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
14.942698
</td>
<td style="text-align:right;">
14.942698
</td>
<td style="text-align:right;">
71.14751
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
56.20482
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
11.557058
</td>
<td style="text-align:right;">
26.499756
</td>
<td style="text-align:right;">
82.70457
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
56.20482
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
12.085305
</td>
<td style="text-align:right;">
38.585060
</td>
<td style="text-align:right;">
94.78988
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
57.93944
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6.471137
</td>
<td style="text-align:right;">
6.471137
</td>
<td style="text-align:right;">
64.41058
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
57.93944
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
14.630242
</td>
<td style="text-align:right;">
21.101379
</td>
<td style="text-align:right;">
79.04082
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
57.93944
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
14.022991
</td>
<td style="text-align:right;">
35.124369
</td>
<td style="text-align:right;">
93.06381
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
58.66301
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
10.440660
</td>
<td style="text-align:right;">
10.440660
</td>
<td style="text-align:right;">
69.10367
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
58.66301
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
10.941420
</td>
<td style="text-align:right;">
21.382081
</td>
<td style="text-align:right;">
80.04509
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
58.66301
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
7.891597
</td>
<td style="text-align:right;">
29.273678
</td>
<td style="text-align:right;">
87.93669
</td>
</tr>
</tbody>
</table>
</div>
<div id="create-group-ids" class="section level4" number="4.1.1.3">
<h4><span class="header-section-number">4.1.1.3</span> Create Group IDs</h4>
<p>Given the dataframe just created, generate group IDs for each Gender and Race Groups. Given that both are binary, there can only be 4 unique groups.</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="panel.html#cb280-1" aria-hidden="true" tabindex="-1"></a><span class="co"># group id</span></span>
<span id="cb280-2"><a href="panel.html#cb280-2" aria-hidden="true" tabindex="-1"></a>svr_group_id <span class="ot">&lt;-</span> <span class="st">&#39;female_asian_id&#39;</span></span>
<span id="cb280-3"><a href="panel.html#cb280-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Define</span></span>
<span id="cb280-4"><a href="panel.html#cb280-4" aria-hidden="true" tabindex="-1"></a>ls_svr_group_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;female&#39;</span>, <span class="st">&#39;asian&#39;</span>)</span>
<span id="cb280-5"><a href="panel.html#cb280-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-6"><a href="panel.html#cb280-6" aria-hidden="true" tabindex="-1"></a><span class="co"># panel dataframe following</span></span>
<span id="cb280-7"><a href="panel.html#cb280-7" aria-hidden="true" tabindex="-1"></a>df_panel_indiage_id <span class="ot">&lt;-</span> df_panel_indiage <span class="sc">%&gt;%</span></span>
<span id="cb280-8"><a href="panel.html#cb280-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">!!!</span><span class="fu">syms</span>(ls_svr_group_vars)) <span class="sc">%&gt;%</span></span>
<span id="cb280-9"><a href="panel.html#cb280-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="sc">!!!</span><span class="fu">syms</span>(ls_svr_group_vars)) <span class="sc">%&gt;%</span></span>
<span id="cb280-10"><a href="panel.html#cb280-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_group_id) <span class="sc">:</span><span class="er">=</span> (<span class="fu">row_number</span>()<span class="sc">==</span><span class="dv">1</span>)<span class="sc">*</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb280-11"><a href="panel.html#cb280-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb280-12"><a href="panel.html#cb280-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_group_id) <span class="sc">:</span><span class="er">=</span> <span class="fu">cumsum</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_group_id))) <span class="sc">%&gt;%</span></span>
<span id="cb280-13"><a href="panel.html#cb280-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">one_of</span>(svr_group_id, ls_svr_group_vars), <span class="fu">everything</span>())</span>
<span id="cb280-14"><a href="panel.html#cb280-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-15"><a href="panel.html#cb280-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Add Height Index</span></span>
<span id="cb280-16"><a href="panel.html#cb280-16" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df_panel_indiage_id) <span class="sc">%&gt;%</span></span>
<span id="cb280-17"><a href="panel.html#cb280-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling_fc_wide</span>()</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:875px; ">
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
female_asian_id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
female
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
asian
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
birth_height
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
year_of_age
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
hgt_growth
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
hgt_growcumu
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
height
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
65.14520
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
13.895393
</td>
<td style="text-align:right;">
13.895393
</td>
<td style="text-align:right;">
79.04059
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
65.14520
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
11.928034
</td>
<td style="text-align:right;">
25.823427
</td>
<td style="text-align:right;">
90.96862
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
65.14520
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
11.405068
</td>
<td style="text-align:right;">
37.228495
</td>
<td style="text-align:right;">
102.37369
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
56.20482
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
14.942698
</td>
<td style="text-align:right;">
14.942698
</td>
<td style="text-align:right;">
71.14751
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
56.20482
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
11.557058
</td>
<td style="text-align:right;">
26.499756
</td>
<td style="text-align:right;">
82.70457
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
56.20482
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
12.085305
</td>
<td style="text-align:right;">
38.585060
</td>
<td style="text-align:right;">
94.78988
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
58.66301
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
10.440660
</td>
<td style="text-align:right;">
10.440660
</td>
<td style="text-align:right;">
69.10367
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
58.66301
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
10.941420
</td>
<td style="text-align:right;">
21.382081
</td>
<td style="text-align:right;">
80.04509
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
58.66301
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
7.891597
</td>
<td style="text-align:right;">
29.273678
</td>
<td style="text-align:right;">
87.93669
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
61.38275
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
11.907053
</td>
<td style="text-align:right;">
11.907053
</td>
<td style="text-align:right;">
73.28980
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
61.38275
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
12.954674
</td>
<td style="text-align:right;">
24.861727
</td>
<td style="text-align:right;">
86.24448
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
61.38275
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5.246137
</td>
<td style="text-align:right;">
30.107864
</td>
<td style="text-align:right;">
91.49061
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
57.93944
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6.471137
</td>
<td style="text-align:right;">
6.471137
</td>
<td style="text-align:right;">
64.41058
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
57.93944
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
14.630242
</td>
<td style="text-align:right;">
21.101379
</td>
<td style="text-align:right;">
79.04082
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
57.93944
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
14.022991
</td>
<td style="text-align:right;">
35.124369
</td>
<td style="text-align:right;">
93.06381
</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<div id="join-datasets" class="section level3" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Join Datasets</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>â€™s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R Code Examples</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository (<a href="https://fanwangecon.github.io/Stat4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<div id="join-panel-with-multiple-keys" class="section level4" number="4.1.2.1">
<h4><span class="header-section-number">4.1.2.1</span> Join Panel with Multiple Keys</h4>
<p>We have two datasets, one for student enrollment, panel over time, but some students do not show up on some dates. The other is a skeleton panel with all student ID and all dates. Often we need to join dataframes together, and we need to join by the student ID and the panel time Key at the same time. When students show up, there is a quiz score for that day, so the joined panel should have as data column quiz score</p>
<p>Student count is <span class="math inline">\(N\)</span>, total dates are <span class="math inline">\(M\)</span>. First we generate two panels below, then we join by both keys using <em>left_join</em>. First, define dataframes:</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="panel.html#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define</span></span>
<span id="cb281-2"><a href="panel.html#cb281-2" aria-hidden="true" tabindex="-1"></a>it_N <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb281-3"><a href="panel.html#cb281-3" aria-hidden="true" tabindex="-1"></a>it_M <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb281-4"><a href="panel.html#cb281-4" aria-hidden="true" tabindex="-1"></a>svr_id <span class="ot">&lt;-</span> <span class="st">&#39;sid&#39;</span></span>
<span id="cb281-5"><a href="panel.html#cb281-5" aria-hidden="true" tabindex="-1"></a>svr_date <span class="ot">&lt;-</span> <span class="st">&#39;classday&#39;</span></span>
<span id="cb281-6"><a href="panel.html#cb281-6" aria-hidden="true" tabindex="-1"></a>svr_attend <span class="ot">&lt;-</span> <span class="st">&#39;date_in_class&#39;</span></span>
<span id="cb281-7"><a href="panel.html#cb281-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-8"><a href="panel.html#cb281-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel Skeleton</span></span>
<span id="cb281-9"><a href="panel.html#cb281-9" aria-hidden="true" tabindex="-1"></a>df_panel_balanced_skeleton <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">matrix</span>(it_M, <span class="at">nrow=</span>it_N, <span class="at">ncol=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb281-10"><a href="panel.html#cb281-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="at">var =</span> svr_id) <span class="sc">%&gt;%</span></span>
<span id="cb281-11"><a href="panel.html#cb281-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">uncount</span>(V1) <span class="sc">%&gt;%</span></span>
<span id="cb281-12"><a href="panel.html#cb281-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_id)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_date) <span class="sc">:</span><span class="er">=</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb281-13"><a href="panel.html#cb281-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb281-14"><a href="panel.html#cb281-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb281-15"><a href="panel.html#cb281-15" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df_panel_balanced_skeleton) <span class="sc">%&gt;%</span></span>
<span id="cb281-16"><a href="panel.html#cb281-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
classday
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="panel.html#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Smaller Panel of Random Days in School</span></span>
<span id="cb282-2"><a href="panel.html#cb282-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">456</span>)</span>
<span id="cb282-3"><a href="panel.html#cb282-3" aria-hidden="true" tabindex="-1"></a>df_panel_attend <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">matrix</span>(it_M, <span class="at">nrow=</span>it_N, <span class="at">ncol=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb282-4"><a href="panel.html#cb282-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="at">var =</span> svr_id) <span class="sc">%&gt;%</span></span>
<span id="cb282-5"><a href="panel.html#cb282-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">uncount</span>(V1) <span class="sc">%&gt;%</span></span>
<span id="cb282-6"><a href="panel.html#cb282-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_id)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_date) <span class="sc">:</span><span class="er">=</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb282-7"><a href="panel.html#cb282-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">in_class =</span> <span class="fu">case_when</span>(<span class="fu">rnorm</span>(<span class="fu">n</span>(),<span class="at">mean=</span><span class="dv">0</span>,<span class="at">sd=</span><span class="dv">1</span>) <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">1</span>, <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb282-8"><a href="panel.html#cb282-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(in_class <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_id), <span class="sc">!!</span><span class="fu">sym</span>(svr_date)) <span class="sc">%&gt;%</span></span>
<span id="cb282-9"><a href="panel.html#cb282-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_attend) <span class="sc">:</span><span class="er">=</span> <span class="sc">!!</span><span class="fu">sym</span>(svr_date)) <span class="sc">%&gt;%</span></span>
<span id="cb282-10"><a href="panel.html#cb282-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dayquizscore =</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(),<span class="at">mean=</span><span class="dv">80</span>,<span class="at">sd=</span><span class="dv">10</span>))</span>
<span id="cb282-11"><a href="panel.html#cb282-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb282-12"><a href="panel.html#cb282-12" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df_panel_attend) <span class="sc">%&gt;%</span></span>
<span id="cb282-13"><a href="panel.html#cb282-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date_in_class
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dayquizscore
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
89.88726
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
96.53929
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
65.59195
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
99.47356
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
97.36936
</td>
</tr>
</tbody>
</table>
<p>Second, now join dataframes:</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="panel.html#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join with explicit names</span></span>
<span id="cb283-2"><a href="panel.html#cb283-2" aria-hidden="true" tabindex="-1"></a>df_quiz_joined_multikey <span class="ot">&lt;-</span> df_panel_balanced_skeleton <span class="sc">%&gt;%</span></span>
<span id="cb283-3"><a href="panel.html#cb283-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(df_panel_attend,</span>
<span id="cb283-4"><a href="panel.html#cb283-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">by=</span>(<span class="fu">c</span>(<span class="st">&#39;sid&#39;</span><span class="ot">=</span><span class="st">&#39;sid&#39;</span>, <span class="st">&#39;classday&#39;</span><span class="ot">=</span><span class="st">&#39;date_in_class&#39;</span>)))</span>
<span id="cb283-5"><a href="panel.html#cb283-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-6"><a href="panel.html#cb283-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Join with setname strings</span></span>
<span id="cb283-7"><a href="panel.html#cb283-7" aria-hidden="true" tabindex="-1"></a>df_quiz_joined_multikey_setnames <span class="ot">&lt;-</span> df_panel_balanced_skeleton <span class="sc">%&gt;%</span></span>
<span id="cb283-8"><a href="panel.html#cb283-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(df_panel_attend, <span class="at">by=</span><span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">&#39;sid&#39;</span>, <span class="st">&#39;date_in_class&#39;</span>), <span class="fu">c</span>(<span class="st">&#39;sid&#39;</span>, <span class="st">&#39;classday&#39;</span>)))</span>
<span id="cb283-9"><a href="panel.html#cb283-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-10"><a href="panel.html#cb283-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb283-11"><a href="panel.html#cb283-11" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df_quiz_joined_multikey) <span class="sc">%&gt;%</span></span>
<span id="cb283-12"><a href="panel.html#cb283-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
classday
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dayquizscore
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
89.88726
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
96.53929
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
65.59195
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
99.47356
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
97.36936
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="panel.html#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df_quiz_joined_multikey_setnames) <span class="sc">%&gt;%</span></span>
<span id="cb284-2"><a href="panel.html#cb284-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
classday
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dayquizscore
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
89.88726
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
96.53929
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
65.59195
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
99.47356
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
97.36936
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table>
</div>
<div id="stack-panel-frames-together" class="section level4" number="4.1.2.2">
<h4><span class="header-section-number">4.1.2.2</span> Stack Panel Frames Together</h4>
<p>There are multiple panel dataframe, each for different subsets of dates. All variable names and units of observations are identical. Use DPLYR <a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a>.</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="panel.html#cb285-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define</span></span>
<span id="cb285-2"><a href="panel.html#cb285-2" aria-hidden="true" tabindex="-1"></a>it_N <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="co"># Number of individuals</span></span>
<span id="cb285-3"><a href="panel.html#cb285-3" aria-hidden="true" tabindex="-1"></a>it_M <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="co"># Number of Months</span></span>
<span id="cb285-4"><a href="panel.html#cb285-4" aria-hidden="true" tabindex="-1"></a>svr_id <span class="ot">&lt;-</span> <span class="st">&#39;sid&#39;</span></span>
<span id="cb285-5"><a href="panel.html#cb285-5" aria-hidden="true" tabindex="-1"></a>svr_date <span class="ot">&lt;-</span> <span class="st">&#39;date&#39;</span></span>
<span id="cb285-6"><a href="panel.html#cb285-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-7"><a href="panel.html#cb285-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel First Half of Year</span></span>
<span id="cb285-8"><a href="panel.html#cb285-8" aria-hidden="true" tabindex="-1"></a>df_panel_m1tom3 <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">matrix</span>(it_M, <span class="at">nrow=</span>it_N, <span class="at">ncol=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb285-9"><a href="panel.html#cb285-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="at">var =</span> svr_id) <span class="sc">%&gt;%</span></span>
<span id="cb285-10"><a href="panel.html#cb285-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">uncount</span>(V1) <span class="sc">%&gt;%</span></span>
<span id="cb285-11"><a href="panel.html#cb285-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_id)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_date) <span class="sc">:</span><span class="er">=</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb285-12"><a href="panel.html#cb285-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb285-13"><a href="panel.html#cb285-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-14"><a href="panel.html#cb285-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel Second Half of Year</span></span>
<span id="cb285-15"><a href="panel.html#cb285-15" aria-hidden="true" tabindex="-1"></a>df_panel_m4tom6 <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">matrix</span>(it_M, <span class="at">nrow=</span>it_N, <span class="at">ncol=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb285-16"><a href="panel.html#cb285-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="at">var =</span> svr_id) <span class="sc">%&gt;%</span></span>
<span id="cb285-17"><a href="panel.html#cb285-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">uncount</span>(V1) <span class="sc">%&gt;%</span></span>
<span id="cb285-18"><a href="panel.html#cb285-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_id)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_date) <span class="sc">:</span><span class="er">=</span> <span class="fu">row_number</span>() <span class="sc">+</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb285-19"><a href="panel.html#cb285-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb285-20"><a href="panel.html#cb285-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-21"><a href="panel.html#cb285-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind Rows</span></span>
<span id="cb285-22"><a href="panel.html#cb285-22" aria-hidden="true" tabindex="-1"></a>df_panel_m1tm6 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(df_panel_m1tom3, df_panel_m4tom6) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="sc">!!!</span><span class="fu">syms</span>(<span class="fu">c</span>(svr_id, svr_date)))</span>
<span id="cb285-23"><a href="panel.html#cb285-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-24"><a href="panel.html#cb285-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb285-25"><a href="panel.html#cb285-25" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df_panel_m1tom3) <span class="sc">%&gt;%</span></span>
<span id="cb285-26"><a href="panel.html#cb285-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="panel.html#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df_panel_m4tom6) <span class="sc">%&gt;%</span></span>
<span id="cb286-2"><a href="panel.html#cb286-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
6
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="panel.html#cb287-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df_panel_m1tm6) <span class="sc">%&gt;%</span></span>
<span id="cb287-2"><a href="panel.html#cb287-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
6
</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="wide-and-long" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Wide and Long</h2>

<div id="long-to-wide" class="section level3" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Long to Wide</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>â€™s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R Code Examples</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository (<a href="https://fanwangecon.github.io/Stat4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<p>Using the <a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a> function in tidyr to reshape panel or other data structures</p>
<div id="panel-long-attendance-roster-to-wide" class="section level4" number="4.2.1.1">
<h4><span class="header-section-number">4.2.1.1</span> Panel Long Attendance Roster to Wide</h4>
<p>There are <span class="math inline">\(N\)</span> students in class, but only a subset of them attend class each day. If student <span class="math inline">\(id_i\)</span> is in class on day <span class="math inline">\(Q\)</span>, the teacher records on a sheet the date and the student ID. So if the student has been in class 10 times, the teacher has ten rows of recorded data for the student with two columns: column one is the student ID, and column two is the date on which the student was in class. Suppose there were 50 students, who on average attended exactly 10 classes each during the semester, this means we have <span class="math inline">\(10 \cdot 50\)</span> rows of data, with differing numbers of rows for each student. This is shown as <em>df_panel_attend_date</em> generated below.</p>
<p>Now we want to generate a new dataframe, where each row is a date, and each column is a student. The values in the new dataframe shows, at the <span class="math inline">\(Q^{th}\)</span> day, how many classes student <span class="math inline">\(i\)</span> has attended so far. The following results is also in a REconTools Function. This is shown as <em>df_attend_cumu_by_day</em> generated below.</p>
<p><strong>First</strong>, generate the raw data structure, <em>df_panel_attend_date</em>:</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="panel.html#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define</span></span>
<span id="cb288-2"><a href="panel.html#cb288-2" aria-hidden="true" tabindex="-1"></a>it_N <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb288-3"><a href="panel.html#cb288-3" aria-hidden="true" tabindex="-1"></a>it_M <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb288-4"><a href="panel.html#cb288-4" aria-hidden="true" tabindex="-1"></a>svr_id <span class="ot">&lt;-</span> <span class="st">&#39;student_id&#39;</span></span>
<span id="cb288-5"><a href="panel.html#cb288-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-6"><a href="panel.html#cb288-6" aria-hidden="true" tabindex="-1"></a><span class="co"># from : support/rand/fs_rand_draws.Rmd</span></span>
<span id="cb288-7"><a href="panel.html#cb288-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">222</span>)</span>
<span id="cb288-8"><a href="panel.html#cb288-8" aria-hidden="true" tabindex="-1"></a>df_panel_attend_date <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">matrix</span>(it_M, <span class="at">nrow=</span>it_N, <span class="at">ncol=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb288-9"><a href="panel.html#cb288-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="at">var =</span> svr_id) <span class="sc">%&gt;%</span></span>
<span id="cb288-10"><a href="panel.html#cb288-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">uncount</span>(V1) <span class="sc">%&gt;%</span></span>
<span id="cb288-11"><a href="panel.html#cb288-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_id)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb288-12"><a href="panel.html#cb288-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">in_class =</span> <span class="fu">case_when</span>(<span class="fu">rnorm</span>(<span class="fu">n</span>(),<span class="at">mean=</span><span class="dv">0</span>,<span class="at">sd=</span><span class="dv">1</span>) <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">1</span>, <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb288-13"><a href="panel.html#cb288-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(in_class <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_id), date) <span class="sc">%&gt;%</span></span>
<span id="cb288-14"><a href="panel.html#cb288-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">date_in_class =</span> date)</span>
<span id="cb288-15"><a href="panel.html#cb288-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-16"><a href="panel.html#cb288-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb288-17"><a href="panel.html#cb288-17" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df_panel_attend_date) <span class="sc">%&gt;%</span></span>
<span id="cb288-18"><a href="panel.html#cb288-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
student_id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date_in_class
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5
</td>
</tr>
</tbody>
</table>
<p><strong>Second</strong>, generate wider data structure, <em>df_attend_cumu_by_day</em>:</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="panel.html#cb289-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define</span></span>
<span id="cb289-2"><a href="panel.html#cb289-2" aria-hidden="true" tabindex="-1"></a>svr_id <span class="ot">&lt;-</span> <span class="st">&#39;student_id&#39;</span></span>
<span id="cb289-3"><a href="panel.html#cb289-3" aria-hidden="true" tabindex="-1"></a>svr_date <span class="ot">&lt;-</span> <span class="st">&#39;date_in_class&#39;</span></span>
<span id="cb289-4"><a href="panel.html#cb289-4" aria-hidden="true" tabindex="-1"></a>st_idcol_prefix <span class="ot">&lt;-</span> <span class="st">&#39;sid_&#39;</span></span>
<span id="cb289-5"><a href="panel.html#cb289-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-6"><a href="panel.html#cb289-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate cumulative enrollment counts by date</span></span>
<span id="cb289-7"><a href="panel.html#cb289-7" aria-hidden="true" tabindex="-1"></a>df_panel_attend_date_addone <span class="ot">&lt;-</span> df_panel_attend_date <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">attended =</span> <span class="dv">1</span>)</span>
<span id="cb289-8"><a href="panel.html#cb289-8" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df_panel_attend_date_addone) <span class="sc">%&gt;%</span></span>
<span id="cb289-9"><a href="panel.html#cb289-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
student_id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date_in_class
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
attended
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="panel.html#cb290-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot Wide</span></span>
<span id="cb290-2"><a href="panel.html#cb290-2" aria-hidden="true" tabindex="-1"></a>df_panel_attend_date_wider <span class="ot">&lt;-</span> df_panel_attend_date_addone <span class="sc">%&gt;%</span></span>
<span id="cb290-3"><a href="panel.html#cb290-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> svr_id,</span>
<span id="cb290-4"><a href="panel.html#cb290-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> attended)</span>
<span id="cb290-5"><a href="panel.html#cb290-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df_panel_attend_date_wider) <span class="sc">%&gt;%</span></span>
<span id="cb290-6"><a href="panel.html#cb290-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date_in_class
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
3
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="panel.html#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort and rename</span></span>
<span id="cb291-2"><a href="panel.html#cb291-2" aria-hidden="true" tabindex="-1"></a><span class="co"># rename see: https://fanwangecon.github.io/R4Econ/amto/tibble/fs_tib_basics.html</span></span>
<span id="cb291-3"><a href="panel.html#cb291-3" aria-hidden="true" tabindex="-1"></a>ar_unique_ids <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(df_panel_attend_date <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_id))))</span>
<span id="cb291-4"><a href="panel.html#cb291-4" aria-hidden="true" tabindex="-1"></a>df_panel_attend_date_wider_sort <span class="ot">&lt;-</span> df_panel_attend_date_wider <span class="sc">%&gt;%</span></span>
<span id="cb291-5"><a href="panel.html#cb291-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_date)) <span class="sc">%&gt;%</span></span>
<span id="cb291-6"><a href="panel.html#cb291-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename_at</span>(<span class="fu">vars</span>(<span class="fu">num_range</span>(<span class="st">&#39;&#39;</span>,ar_unique_ids))</span>
<span id="cb291-7"><a href="panel.html#cb291-7" aria-hidden="true" tabindex="-1"></a>              , <span class="fu">list</span>(<span class="sc">~</span><span class="fu">paste0</span>(st_idcol_prefix, . , <span class="st">&#39;&#39;</span>))</span>
<span id="cb291-8"><a href="panel.html#cb291-8" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb291-9"><a href="panel.html#cb291-9" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df_panel_attend_date_wider_sort) <span class="sc">%&gt;%</span></span>
<span id="cb291-10"><a href="panel.html#cb291-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date_in_class
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid_1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid_2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid_3
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="panel.html#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="co"># replace NA and cumusum again</span></span>
<span id="cb292-2"><a href="panel.html#cb292-2" aria-hidden="true" tabindex="-1"></a><span class="co"># see: R4Econ/support/function/fs_func_multivar for renaming and replacing</span></span>
<span id="cb292-3"><a href="panel.html#cb292-3" aria-hidden="true" tabindex="-1"></a>df_attend_cumu_by_day <span class="ot">&lt;-</span> df_panel_attend_date_wider_sort <span class="sc">%&gt;%</span></span>
<span id="cb292-4"><a href="panel.html#cb292-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="fu">contains</span>(st_idcol_prefix)), <span class="fu">list</span>(<span class="sc">~</span><span class="fu">replace_na</span>(., <span class="dv">0</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb292-5"><a href="panel.html#cb292-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="fu">contains</span>(st_idcol_prefix)), <span class="fu">list</span>(<span class="sc">~</span><span class="fu">cumsum</span>(.)))</span>
<span id="cb292-6"><a href="panel.html#cb292-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-7"><a href="panel.html#cb292-7" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df_attend_cumu_by_day) <span class="sc">%&gt;%</span></span>
<span id="cb292-8"><a href="panel.html#cb292-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date_in_class
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid_1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid_2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid_3
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
</tbody>
</table>
<p>The structure above is also a function in Fanâ€™s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, here the function is tested:</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="panel.html#cb293-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters</span></span>
<span id="cb293-2"><a href="panel.html#cb293-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df_panel_attend_date</span>
<span id="cb293-3"><a href="panel.html#cb293-3" aria-hidden="true" tabindex="-1"></a>svr_id_i <span class="ot">&lt;-</span> <span class="st">&#39;student_id&#39;</span></span>
<span id="cb293-4"><a href="panel.html#cb293-4" aria-hidden="true" tabindex="-1"></a>svr_id_t <span class="ot">&lt;-</span> <span class="st">&#39;date_in_class&#39;</span></span>
<span id="cb293-5"><a href="panel.html#cb293-5" aria-hidden="true" tabindex="-1"></a>st_idcol_prefix <span class="ot">&lt;-</span> <span class="st">&#39;sid_&#39;</span></span>
<span id="cb293-6"><a href="panel.html#cb293-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb293-7"><a href="panel.html#cb293-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Invoke Function</span></span>
<span id="cb293-8"><a href="panel.html#cb293-8" aria-hidden="true" tabindex="-1"></a>ls_df_rosterwide <span class="ot">&lt;-</span> <span class="fu">ff_panel_expand_longrosterwide</span>(df, svr_id_t, svr_id_i, st_idcol_prefix)</span>
<span id="cb293-9"><a href="panel.html#cb293-9" aria-hidden="true" tabindex="-1"></a>df_roster_wide_func <span class="ot">&lt;-</span> ls_df_rosterwide<span class="sc">$</span>df_roster_wide</span>
<span id="cb293-10"><a href="panel.html#cb293-10" aria-hidden="true" tabindex="-1"></a>df_roster_wide_cumu_func <span class="ot">&lt;-</span> ls_df_rosterwide<span class="sc">$</span>df_roster_wide_cumu</span>
<span id="cb293-11"><a href="panel.html#cb293-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb293-12"><a href="panel.html#cb293-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb293-13"><a href="panel.html#cb293-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df_roster_wide_func)</span>
<span id="cb293-14"><a href="panel.html#cb293-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df_roster_wide_cumu_func)</span></code></pre></div>

</div>
</div>
<div id="wide-to-long" class="section level3" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Wide to Long</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>â€™s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R Code Examples</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository (<a href="https://fanwangecon.github.io/Stat4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<p>Using the <a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a> function in tidyr to reshape panel or other data structures</p>
<div id="generated-matrix-by-states-to-long-table" class="section level4" number="4.2.2.1">
<h4><span class="header-section-number">4.2.2.1</span> Generated Matrix by States to Long Table</h4>
<p>A matrix of ev given states, rows are states and cols are shocks. Convert to Long table with shock and state values and ev.</p>
<p>Generated Matrix by States to Long Table where state values are stored as variables, with correct value labels for states:</p>
<ol style="list-style-type: decimal">
<li>Generate a matrix</li>
<li>Convert matrix to tibble</li>
<li>Tibble make longer, and store column and row id var names</li>
</ol>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="panel.html#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate A Matrix</span></span>
<span id="cb294-2"><a href="panel.html#cb294-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb294-3"><a href="panel.html#cb294-3" aria-hidden="true" tabindex="-1"></a>ar_a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">1.1</span>,<span class="fl">5.1</span>)</span>
<span id="cb294-4"><a href="panel.html#cb294-4" aria-hidden="true" tabindex="-1"></a>ar_z <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.5</span>, <span class="fl">2.53</span>, <span class="at">length.out=</span><span class="dv">11</span>)</span>
<span id="cb294-5"><a href="panel.html#cb294-5" aria-hidden="true" tabindex="-1"></a>mt_ev <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(ar_a<span class="sc">*</span>ar_z), <span class="at">nrow=</span><span class="fu">length</span>(ar_a), <span class="at">ncol=</span><span class="fu">length</span>(ar_z))</span>
<span id="cb294-6"><a href="panel.html#cb294-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-7"><a href="panel.html#cb294-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Name Matrix</span></span>
<span id="cb294-8"><a href="panel.html#cb294-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(mt_ev) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;ai&#39;</span>, <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ar_a)))</span>
<span id="cb294-9"><a href="panel.html#cb294-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mt_ev) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;zi&#39;</span>, <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ar_z)))</span>
<span id="cb294-10"><a href="panel.html#cb294-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-11"><a href="panel.html#cb294-11" aria-hidden="true" tabindex="-1"></a><span class="co"># to tibble</span></span>
<span id="cb294-12"><a href="panel.html#cb294-12" aria-hidden="true" tabindex="-1"></a>tb_ev <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(mt_ev) <span class="sc">%&gt;%</span> <span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">&quot;ai&quot;</span>)</span>
<span id="cb294-13"><a href="panel.html#cb294-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-14"><a href="panel.html#cb294-14" aria-hidden="true" tabindex="-1"></a><span class="co"># longer</span></span>
<span id="cb294-15"><a href="panel.html#cb294-15" aria-hidden="true" tabindex="-1"></a>tb_ev_long <span class="ot">&lt;-</span> tb_ev <span class="sc">%&gt;%</span></span>
<span id="cb294-16"><a href="panel.html#cb294-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&#39;zi&#39;</span>),</span>
<span id="cb294-17"><a href="panel.html#cb294-17" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&#39;zi&#39;</span>),</span>
<span id="cb294-18"><a href="panel.html#cb294-18" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_pattern =</span> <span class="fu">paste0</span>(<span class="st">&quot;zi(.*)&quot;</span>),</span>
<span id="cb294-19"><a href="panel.html#cb294-19" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;ev&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb294-20"><a href="panel.html#cb294-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">zi =</span> <span class="fu">as.numeric</span>(zi))</span>
<span id="cb294-21"><a href="panel.html#cb294-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-22"><a href="panel.html#cb294-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with a and z values</span></span>
<span id="cb294-23"><a href="panel.html#cb294-23" aria-hidden="true" tabindex="-1"></a>tb_ev_long <span class="ot">&lt;-</span> tb_ev_long <span class="sc">%&gt;%</span></span>
<span id="cb294-24"><a href="panel.html#cb294-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">as_tibble</span>(ar_a) <span class="sc">%&gt;%</span></span>
<span id="cb294-25"><a href="panel.html#cb294-25" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">&quot;ai&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb294-26"><a href="panel.html#cb294-26" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rename</span>(<span class="at">a =</span> value)</span>
<span id="cb294-27"><a href="panel.html#cb294-27" aria-hidden="true" tabindex="-1"></a>              , <span class="at">by =</span> <span class="st">&#39;ai&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb294-28"><a href="panel.html#cb294-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">as_tibble</span>(ar_z) <span class="sc">%&gt;%</span></span>
<span id="cb294-29"><a href="panel.html#cb294-29" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">&quot;zi&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb294-30"><a href="panel.html#cb294-30" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rename</span>(<span class="at">z =</span> value),</span>
<span id="cb294-31"><a href="panel.html#cb294-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">&#39;zi&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb294-32"><a href="panel.html#cb294-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(a,ai,z,zi,ev)</span>
<span id="cb294-33"><a href="panel.html#cb294-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-34"><a href="panel.html#cb294-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Display</span></span>
<span id="cb294-35"><a href="panel.html#cb294-35" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(tb_ev) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc_wide</span>()</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:875px; ">
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ai
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi3
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi4
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi5
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi6
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi7
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi8
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi9
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi10
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi11
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-0.5604756
</td>
<td style="text-align:right;">
1.5587083
</td>
<td style="text-align:right;">
0.1292877
</td>
<td style="text-align:right;">
0.4609162
</td>
<td style="text-align:right;">
-0.6868529
</td>
<td style="text-align:right;">
1.2240818
</td>
<td style="text-align:right;">
-0.2301775
</td>
<td style="text-align:right;">
0.0705084
</td>
<td style="text-align:right;">
1.7150650
</td>
<td style="text-align:right;">
-1.2650612
</td>
<td style="text-align:right;">
-0.445662
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-0.2301775
</td>
<td style="text-align:right;">
0.0705084
</td>
<td style="text-align:right;">
1.7150650
</td>
<td style="text-align:right;">
-1.2650612
</td>
<td style="text-align:right;">
-0.4456620
</td>
<td style="text-align:right;">
-0.5604756
</td>
<td style="text-align:right;">
1.5587083
</td>
<td style="text-align:right;">
0.1292877
</td>
<td style="text-align:right;">
0.4609162
</td>
<td style="text-align:right;">
-0.6868529
</td>
<td style="text-align:right;">
1.224082
</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="panel.html#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(tb_ev_long) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
a
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ai
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
z
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
zi
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ev
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-2.500
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-0.5604756
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1.997
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1.5587083
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1.494
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.1292877
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-0.991
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.4609162
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-0.488
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
-0.6868529
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.015
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
1.2240818
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.518
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
-0.2301775
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.021
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0.0705084
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.524
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
1.7150650
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2.027
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
-1.2650612
</td>
</tr>
<tr>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2.530
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
-0.4456620
</td>
</tr>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-2.500
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-0.2301775
</td>
</tr>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-1.997
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.0705084
</td>
</tr>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-1.494
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1.7150650
</td>
</tr>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-0.991
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
-1.2650612
</td>
</tr>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-0.488
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
-0.4456620
</td>
</tr>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.015
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
-0.5604756
</td>
</tr>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.518
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
1.5587083
</td>
</tr>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1.021
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0.1292877
</td>
</tr>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1.524
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
0.4609162
</td>
</tr>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2.027
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
-0.6868529
</td>
</tr>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2.530
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
1.2240818
</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="functions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="linear-regression.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": [["Panel-Data-and-Optimization-with-R.pdf", "PDF"]],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
