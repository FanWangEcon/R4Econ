<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Panel | Panel Data and Optimization with R</title>
  <meta name="description" content="R Examples Panel and Optimization." />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Panel | Panel Data and Optimization with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="R Examples Panel and Optimization." />
  <meta name="github-repo" content="fanwangecon/R4Econ" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Panel | Panel Data and Optimization with R" />
  
  <meta name="twitter:description" content="R Examples Panel and Optimization." />
  

<meta name="author" content="Fan Wang" />


<meta name="date" content="2020-05-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="functions.html"/>
<link rel="next" href="linear-regression.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-92953468-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-92953468-5');
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Panel Data and Optimization with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html"><i class="fa fa-check"></i><b>1</b> Array, Matrix, Dataframe</a><ul>
<li class="chapter" data-level="1.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#list"><i class="fa fa-check"></i><b>1.1</b> List</a><ul>
<li class="chapter" data-level="1.1.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#multiple-dimensional-list"><i class="fa fa-check"></i><b>1.1.1</b> Multiple Dimensional List</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#array"><i class="fa fa-check"></i><b>1.2</b> Array</a><ul>
<li class="chapter" data-level="1.2.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#array-basics"><i class="fa fa-check"></i><b>1.2.1</b> Array Basics</a></li>
<li class="chapter" data-level="1.2.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-arrays"><i class="fa fa-check"></i><b>1.2.2</b> Generate Arrays</a></li>
<li class="chapter" data-level="1.2.3" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#string-arrays"><i class="fa fa-check"></i><b>1.2.3</b> String Arrays</a></li>
<li class="chapter" data-level="1.2.4" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#mesh-matrices-arrays-and-scalars"><i class="fa fa-check"></i><b>1.2.4</b> Mesh Matrices, Arrays and Scalars</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#matrix"><i class="fa fa-check"></i><b>1.3</b> Matrix</a><ul>
<li class="chapter" data-level="1.3.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-matrixes"><i class="fa fa-check"></i><b>1.3.1</b> Generate Matrixes</a></li>
<li class="chapter" data-level="1.3.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#linear-algebra"><i class="fa fa-check"></i><b>1.3.2</b> Linear Algebra</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#variables-in-dataframes"><i class="fa fa-check"></i><b>1.4</b> Variables in Dataframes</a><ul>
<li class="chapter" data-level="1.4.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-dataframe"><i class="fa fa-check"></i><b>1.4.1</b> Generate Dataframe</a></li>
<li class="chapter" data-level="1.4.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#factor-label-and-combine"><i class="fa fa-check"></i><b>1.4.2</b> Factor Label and Combine</a></li>
<li class="chapter" data-level="1.4.3" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#drawly-random-rows"><i class="fa fa-check"></i><b>1.4.3</b> Drawly Random Rows</a></li>
<li class="chapter" data-level="1.4.4" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-variables-conditional-on-others"><i class="fa fa-check"></i><b>1.4.4</b> Generate Variables Conditional On Others</a></li>
<li class="chapter" data-level="1.4.5" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#string-values"><i class="fa fa-check"></i><b>1.4.5</b> String Values</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="summarize-data.html"><a href="summarize-data.html"><i class="fa fa-check"></i><b>2</b> Summarize Data</a><ul>
<li class="chapter" data-level="2.1" data-path="summarize-data.html"><a href="summarize-data.html#counting-observation"><i class="fa fa-check"></i><b>2.1</b> Counting Observation</a><ul>
<li class="chapter" data-level="2.1.1" data-path="summarize-data.html"><a href="summarize-data.html#uncount"><i class="fa fa-check"></i><b>2.1.1</b> Uncount</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="summarize-data.html"><a href="summarize-data.html#sorting-indexing-slicing"><i class="fa fa-check"></i><b>2.2</b> Sorting, Indexing, Slicing</a><ul>
<li class="chapter" data-level="2.2.1" data-path="summarize-data.html"><a href="summarize-data.html#sorting"><i class="fa fa-check"></i><b>2.2.1</b> Sorting</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="summarize-data.html"><a href="summarize-data.html#group-statistics"><i class="fa fa-check"></i><b>2.3</b> Group Statistics</a><ul>
<li class="chapter" data-level="2.3.1" data-path="summarize-data.html"><a href="summarize-data.html#groups-statistics"><i class="fa fa-check"></i><b>2.3.1</b> Groups Statistics</a></li>
<li class="chapter" data-level="2.3.2" data-path="summarize-data.html"><a href="summarize-data.html#one-variable-group-summary"><i class="fa fa-check"></i><b>2.3.2</b> One Variable Group Summary</a></li>
<li class="chapter" data-level="2.3.3" data-path="summarize-data.html"><a href="summarize-data.html#nested-within-group-stats"><i class="fa fa-check"></i><b>2.3.3</b> Nested within Group Stats</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="summarize-data.html"><a href="summarize-data.html#distributional-statistics"><i class="fa fa-check"></i><b>2.4</b> Distributional Statistics</a><ul>
<li class="chapter" data-level="2.4.1" data-path="summarize-data.html"><a href="summarize-data.html#histogram"><i class="fa fa-check"></i><b>2.4.1</b> Histogram</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="summarize-data.html"><a href="summarize-data.html#summarize-multiple-variables"><i class="fa fa-check"></i><b>2.5</b> Summarize Multiple Variables</a><ul>
<li class="chapter" data-level="2.5.1" data-path="summarize-data.html"><a href="summarize-data.html#generate-replace-variables"><i class="fa fa-check"></i><b>2.5.1</b> Generate Replace Variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>3</b> Functions</a><ul>
<li class="chapter" data-level="3.1" data-path="functions.html"><a href="functions.html#dataframe-mutate"><i class="fa fa-check"></i><b>3.1</b> Dataframe Mutate</a><ul>
<li class="chapter" data-level="3.1.1" data-path="functions.html"><a href="functions.html#row-input-functions"><i class="fa fa-check"></i><b>3.1.1</b> Row Input Functions</a></li>
<li class="chapter" data-level="3.1.2" data-path="functions.html"><a href="functions.html#evaluate-choices-across-states"><i class="fa fa-check"></i><b>3.1.2</b> Evaluate Choices Across States</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="functions.html"><a href="functions.html#dataframe-do-anything"><i class="fa fa-check"></i><b>3.2</b> Dataframe Do Anything</a><ul>
<li class="chapter" data-level="3.2.1" data-path="functions.html"><a href="functions.html#mxq-to-mxp-rows"><i class="fa fa-check"></i><b>3.2.1</b> MxQ to MxP Rows</a></li>
<li class="chapter" data-level="3.2.2" data-path="functions.html"><a href="functions.html#mx1-to-mxq-rows"><i class="fa fa-check"></i><b>3.2.2</b> Mx1 to MxQ Rows</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="functions.html"><a href="functions.html#apply-and-pmap"><i class="fa fa-check"></i><b>3.3</b> Apply and pmap</a><ul>
<li class="chapter" data-level="3.3.1" data-path="functions.html"><a href="functions.html#apply-sapply-mutate"><i class="fa fa-check"></i><b>3.3.1</b> Apply, Sapply, Mutate</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="panel.html"><a href="panel.html"><i class="fa fa-check"></i><b>4</b> Panel</a><ul>
<li class="chapter" data-level="4.1" data-path="panel.html"><a href="panel.html#generate-and-join"><i class="fa fa-check"></i><b>4.1</b> Generate and Join</a><ul>
<li class="chapter" data-level="4.1.1" data-path="panel.html"><a href="panel.html#generate-panel-structure"><i class="fa fa-check"></i><b>4.1.1</b> Generate Panel Structure</a></li>
<li class="chapter" data-level="4.1.2" data-path="panel.html"><a href="panel.html#join-datasets"><i class="fa fa-check"></i><b>4.1.2</b> Join Datasets</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="panel.html"><a href="panel.html#wide-and-long"><i class="fa fa-check"></i><b>4.2</b> Wide and Long</a><ul>
<li class="chapter" data-level="4.2.1" data-path="panel.html"><a href="panel.html#long-to-wide"><i class="fa fa-check"></i><b>4.2.1</b> Long to Wide</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i><b>5</b> Linear Regression</a><ul>
<li class="chapter" data-level="5.1" data-path="linear-regression.html"><a href="linear-regression.html#ols-and-iv"><i class="fa fa-check"></i><b>5.1</b> OLS and IV</a><ul>
<li class="chapter" data-level="5.1.1" data-path="linear-regression.html"><a href="linear-regression.html#ols-and-iv-regression"><i class="fa fa-check"></i><b>5.1.1</b> OLS and IV Regression</a></li>
<li class="chapter" data-level="5.1.2" data-path="linear-regression.html"><a href="linear-regression.html#iv-loop-over-rhs"><i class="fa fa-check"></i><b>5.1.2</b> IV Loop over RHS</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="linear-regression.html"><a href="linear-regression.html#decomposition"><i class="fa fa-check"></i><b>5.2</b> Decomposition</a><ul>
<li class="chapter" data-level="5.2.1" data-path="linear-regression.html"><a href="linear-regression.html#decompose-rhs"><i class="fa fa-check"></i><b>5.2.1</b> Decompose RHS</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html"><i class="fa fa-check"></i><b>6</b> Nonlinear Regression</a><ul>
<li class="chapter" data-level="6.1" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html#logit-regression"><i class="fa fa-check"></i><b>6.1</b> Logit Regression</a><ul>
<li class="chapter" data-level="6.1.1" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html#binary-logit"><i class="fa fa-check"></i><b>6.1.1</b> Binary Logit</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="optimization.html"><a href="optimization.html"><i class="fa fa-check"></i><b>7</b> Optimization</a><ul>
<li class="chapter" data-level="7.1" data-path="optimization.html"><a href="optimization.html#bisection"><i class="fa fa-check"></i><b>7.1</b> Bisection</a><ul>
<li class="chapter" data-level="7.1.1" data-path="optimization.html"><a href="optimization.html#bisection-1"><i class="fa fa-check"></i><b>7.1.1</b> Bisection</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html"><i class="fa fa-check"></i><b>8</b> Mathmatics and Statistics</a><ul>
<li class="chapter" data-level="8.1" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#distributions"><i class="fa fa-check"></i><b>8.1</b> Distributions</a><ul>
<li class="chapter" data-level="8.1.1" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#integrate-over-normal-guassian-process-shock"><i class="fa fa-check"></i><b>8.1.1</b> Integrate Over Normal Guassian Process Shock</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#analytical-solutions"><i class="fa fa-check"></i><b>8.2</b> Analytical Solutions</a><ul>
<li class="chapter" data-level="8.2.1" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#linear-scalar-fx0-solutions"><i class="fa fa-check"></i><b>8.2.1</b> Linear Scalar f(x)=0 Solutions</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#inequality-models"><i class="fa fa-check"></i><b>8.3</b> Inequality Models</a><ul>
<li class="chapter" data-level="8.3.1" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#gini-discrete-sample"><i class="fa fa-check"></i><b>8.3.1</b> Gini Discrete Sample</a></li>
<li class="chapter" data-level="8.3.2" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#atkinson-family-utility"><i class="fa fa-check"></i><b>8.3.2</b> Atkinson Family Utility</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html"><i class="fa fa-check"></i><b>9</b> Tables and Graphs</a><ul>
<li class="chapter" data-level="9.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#r-base-plots"><i class="fa fa-check"></i><b>9.1</b> R Base Plots</a><ul>
<li class="chapter" data-level="9.1.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#plot-curve-line-and-points"><i class="fa fa-check"></i><b>9.1.1</b> Plot Curve, Line and Points</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#write-and-read-plots"><i class="fa fa-check"></i><b>9.2</b> Write and Read Plots</a><ul>
<li class="chapter" data-level="9.2.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#import-and-export-images"><i class="fa fa-check"></i><b>9.2.1</b> Import and Export Images</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="index-and-code-links.html"><a href="index-and-code-links.html"><i class="fa fa-check"></i><b>A</b> Index and Code Links</a><ul>
<li class="chapter" data-level="A.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#array-matrix-dataframe-links"><i class="fa fa-check"></i><b>A.1</b> Array, Matrix, Dataframe links</a><ul>
<li class="chapter" data-level="A.1.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.1-listlist-links"><i class="fa fa-check"></i><b>A.1.1</b> <span>Section 1.1 List</span> links</a></li>
<li class="chapter" data-level="A.1.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.2-arrayarray-links"><i class="fa fa-check"></i><b>A.1.2</b> <span>Section 1.2 Array</span> links</a></li>
<li class="chapter" data-level="A.1.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.3-matrixmatrix-links"><i class="fa fa-check"></i><b>A.1.3</b> <span>Section 1.3 Matrix</span> links</a></li>
<li class="chapter" data-level="A.1.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.4-variables-in-dataframesvariables-in-dataframes-links"><i class="fa fa-check"></i><b>A.1.4</b> <span>Section 1.4 Variables in Dataframes</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#summarize-data-links"><i class="fa fa-check"></i><b>A.2</b> Summarize Data links</a><ul>
<li class="chapter" data-level="A.2.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.1-counting-observationcounting-observation-links"><i class="fa fa-check"></i><b>A.2.1</b> <span>Section 2.1 Counting Observation</span> links</a></li>
<li class="chapter" data-level="A.2.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.2-sorting-indexing-slicingsorting-indexing-slicing-links"><i class="fa fa-check"></i><b>A.2.2</b> <span>Section 2.2 Sorting, Indexing, Slicing</span> links</a></li>
<li class="chapter" data-level="A.2.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.3-group-statisticsgroup-statistics-links"><i class="fa fa-check"></i><b>A.2.3</b> <span>Section 2.3 Group Statistics</span> links</a></li>
<li class="chapter" data-level="A.2.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.4-distributional-statisticsdistributional-statistics-links"><i class="fa fa-check"></i><b>A.2.4</b> <span>Section 2.4 Distributional Statistics</span> links</a></li>
<li class="chapter" data-level="A.2.5" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.5-summarize-multiple-variablessummarize-multiple-variables-links"><i class="fa fa-check"></i><b>A.2.5</b> <span>Section 2.5 Summarize Multiple Variables</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#functions-links"><i class="fa fa-check"></i><b>A.3</b> Functions links</a><ul>
<li class="chapter" data-level="A.3.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.1-dataframe-mutatedataframe-mutate-links"><i class="fa fa-check"></i><b>A.3.1</b> <span>Section 3.1 Dataframe Mutate</span> links</a></li>
<li class="chapter" data-level="A.3.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.2-dataframe-do-anythingdataframe-do-anything-links"><i class="fa fa-check"></i><b>A.3.2</b> <span>Section 3.2 Dataframe Do Anything</span> links</a></li>
<li class="chapter" data-level="A.3.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.3-apply-and-pmapapply-and-pmap-links"><i class="fa fa-check"></i><b>A.3.3</b> <span>Section 3.3 Apply and pmap</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#panel-links"><i class="fa fa-check"></i><b>A.4</b> Panel links</a><ul>
<li class="chapter" data-level="A.4.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-4.1-generate-and-joingenerate-and-join-links"><i class="fa fa-check"></i><b>A.4.1</b> <span>Section 4.1 Generate and Join</span> links</a></li>
<li class="chapter" data-level="A.4.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-4.2-wide-and-longwide-and-long-links"><i class="fa fa-check"></i><b>A.4.2</b> <span>Section 4.2 Wide and Long</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.5" data-path="index-and-code-links.html"><a href="index-and-code-links.html#linear-regression-links"><i class="fa fa-check"></i><b>A.5</b> Linear Regression links</a><ul>
<li class="chapter" data-level="A.5.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-5.1-ols-and-ivols-and-iv-links"><i class="fa fa-check"></i><b>A.5.1</b> <span>Section 5.1 OLS and IV</span> links</a></li>
<li class="chapter" data-level="A.5.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-5.2-decompositiondecomposition-links"><i class="fa fa-check"></i><b>A.5.2</b> <span>Section 5.2 Decomposition</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.6" data-path="index-and-code-links.html"><a href="index-and-code-links.html#nonlinear-regression-links"><i class="fa fa-check"></i><b>A.6</b> Nonlinear Regression links</a><ul>
<li class="chapter" data-level="A.6.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-6.1-logit-regressionlogit-regression-links"><i class="fa fa-check"></i><b>A.6.1</b> <span>Section 6.1 Logit Regression</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.7" data-path="index-and-code-links.html"><a href="index-and-code-links.html#optimization-links"><i class="fa fa-check"></i><b>A.7</b> Optimization links</a><ul>
<li class="chapter" data-level="A.7.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-7.1-bisectionbisection-links"><i class="fa fa-check"></i><b>A.7.1</b> <span>Section 7.1 Bisection</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.8" data-path="index-and-code-links.html"><a href="index-and-code-links.html#mathmatics-and-statistics-links"><i class="fa fa-check"></i><b>A.8</b> Mathmatics and Statistics links</a><ul>
<li class="chapter" data-level="A.8.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-8.1-distributionsdistributions-links"><i class="fa fa-check"></i><b>A.8.1</b> <span>Section 8.1 Distributions</span> links</a></li>
<li class="chapter" data-level="A.8.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-8.2-analytical-solutionsanalytical-solutions-links"><i class="fa fa-check"></i><b>A.8.2</b> <span>Section 8.2 Analytical Solutions</span> links</a></li>
<li class="chapter" data-level="A.8.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-8.3-inequality-modelsinequality-models-links"><i class="fa fa-check"></i><b>A.8.3</b> <span>Section 8.3 Inequality Models</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.9" data-path="index-and-code-links.html"><a href="index-and-code-links.html#tables-and-graphs-links"><i class="fa fa-check"></i><b>A.9</b> Tables and Graphs links</a><ul>
<li class="chapter" data-level="A.9.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-9.1-r-base-plotsr-base-plots-links"><i class="fa fa-check"></i><b>A.9.1</b> <span>Section 9.1 R Base Plots</span> links</a></li>
<li class="chapter" data-level="A.9.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-9.2-write-and-read-plotswrite-and-read-plots-links"><i class="fa fa-check"></i><b>A.9.2</b> <span>Section 9.2 Write and Read Plots</span> links</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://fanwangecon.github.io/R4Econ/bookdown/index.html" target="blank">R4Econ Bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Panel Data and Optimization with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="panel" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Panel</h1>

<div id="generate-and-join" class="section level2">
<h2><span class="header-section-number">4.1</span> Generate and Join</h2>

<div id="generate-panel-structure" class="section level3">
<h3><span class="header-section-number">4.1.1</span> Generate Panel Structure</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R Code Examples</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository (<a href="https://fanwangecon.github.io/Stat4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<div id="balanced-panel-skeleton" class="section level4">
<h4><span class="header-section-number">4.1.1.1</span> Balanced Panel Skeleton</h4>
<p>There are <span class="math inline">\(N\)</span> individuals, each could be observed <span class="math inline">\(M\)</span> times. In the example below, there are 3 students, each observed over 4 dates. This just uses the <a href="https://tidyr.tidyverse.org/reference/uncount.html">uncount</a> function from <em>tidyr</em>.</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb248-1" title="1"><span class="co"># Define</span></a>
<a class="sourceLine" id="cb248-2" title="2">it_N &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb248-3" title="3">it_M &lt;-<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb248-4" title="4">svr_id &lt;-<span class="st"> &#39;student_id&#39;</span></a>
<a class="sourceLine" id="cb248-5" title="5">svr_date &lt;-<span class="st"> &#39;class_day&#39;</span></a>
<a class="sourceLine" id="cb248-6" title="6"></a>
<a class="sourceLine" id="cb248-7" title="7"><span class="co"># dataframe</span></a>
<a class="sourceLine" id="cb248-8" title="8">df_panel_skeleton &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(<span class="kw">matrix</span>(it_M, <span class="dt">nrow=</span>it_N, <span class="dt">ncol=</span><span class="dv">1</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb248-9" title="9"><span class="st">  </span><span class="kw">rowid_to_column</span>(<span class="dt">var =</span> svr_id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb248-10" title="10"><span class="st">  </span><span class="kw">uncount</span>(V1) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb248-11" title="11"><span class="st">  </span><span class="kw">group_by</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_id)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_date) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">row_number</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb248-12" title="12"><span class="st">  </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb248-13" title="13"></a>
<a class="sourceLine" id="cb248-14" title="14"><span class="co"># Print</span></a>
<a class="sourceLine" id="cb248-15" title="15"><span class="kw">kable</span>(df_panel_skeleton) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb248-16" title="16"><span class="st">  </span><span class="kw">kable_styling_fc</span>()</a></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
student_id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
class_day
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5
</td>
</tr>
</tbody>
</table>

</div>
</div>
<div id="join-datasets" class="section level3">
<h3><span class="header-section-number">4.1.2</span> Join Datasets</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R Code Examples</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository (<a href="https://fanwangecon.github.io/Stat4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<div id="join-panel-with-multiple-keys" class="section level4">
<h4><span class="header-section-number">4.1.2.1</span> Join Panel with Multiple Keys</h4>
<p>We have two datasets, one for student enrollment, panel over time, but some students do not show up on some dates. The other is a skeleton panel with all student ID and all dates. Often we need to join dataframes together, and we need to join by the student ID and the panel time Key at the same time. When students show up, there is a quiz score for that day, so the joined panel should have as data column quiz score</p>
<p>Student count is <span class="math inline">\(N\)</span>, total dates are <span class="math inline">\(M\)</span>. First we generate two panels below, then we join by both keys using <em>left_join</em>. First, define dataframes:</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb249-1" title="1"><span class="co"># Define</span></a>
<a class="sourceLine" id="cb249-2" title="2">it_N &lt;-<span class="st"> </span><span class="dv">4</span></a>
<a class="sourceLine" id="cb249-3" title="3">it_M &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb249-4" title="4">svr_id &lt;-<span class="st"> &#39;sid&#39;</span></a>
<a class="sourceLine" id="cb249-5" title="5">svr_date &lt;-<span class="st"> &#39;classday&#39;</span></a>
<a class="sourceLine" id="cb249-6" title="6">svr_attend &lt;-<span class="st"> &#39;date_in_class&#39;</span></a>
<a class="sourceLine" id="cb249-7" title="7"></a>
<a class="sourceLine" id="cb249-8" title="8"><span class="co"># Panel Skeleton</span></a>
<a class="sourceLine" id="cb249-9" title="9">df_panel_balanced_skeleton &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(<span class="kw">matrix</span>(it_M, <span class="dt">nrow=</span>it_N, <span class="dt">ncol=</span><span class="dv">1</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb249-10" title="10"><span class="st">  </span><span class="kw">rowid_to_column</span>(<span class="dt">var =</span> svr_id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb249-11" title="11"><span class="st">  </span><span class="kw">uncount</span>(V1) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb249-12" title="12"><span class="st">  </span><span class="kw">group_by</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_id)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_date) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">row_number</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb249-13" title="13"><span class="st">  </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb249-14" title="14"><span class="co"># Print</span></a>
<a class="sourceLine" id="cb249-15" title="15"><span class="kw">kable</span>(df_panel_balanced_skeleton) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb249-16" title="16"><span class="st">  </span><span class="kw">kable_styling_fc</span>()</a></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
classday
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb250-1" title="1"><span class="co"># Smaller Panel of Random Days in School</span></a>
<a class="sourceLine" id="cb250-2" title="2"><span class="kw">set.seed</span>(<span class="dv">456</span>)</a>
<a class="sourceLine" id="cb250-3" title="3">df_panel_attend &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(<span class="kw">matrix</span>(it_M, <span class="dt">nrow=</span>it_N, <span class="dt">ncol=</span><span class="dv">1</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb250-4" title="4"><span class="st">  </span><span class="kw">rowid_to_column</span>(<span class="dt">var =</span> svr_id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb250-5" title="5"><span class="st">  </span><span class="kw">uncount</span>(V1) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb250-6" title="6"><span class="st">  </span><span class="kw">group_by</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_id)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_date) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">row_number</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb250-7" title="7"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">in_class =</span> <span class="kw">case_when</span>(<span class="kw">rnorm</span>(<span class="kw">n</span>(),<span class="dt">mean=</span><span class="dv">0</span>,<span class="dt">sd=</span><span class="dv">1</span>) <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="dv">0</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb250-8" title="8"><span class="st">  </span><span class="kw">filter</span>(in_class <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_id), <span class="op">!!</span><span class="kw">sym</span>(svr_date)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb250-9" title="9"><span class="st">  </span><span class="kw">rename</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_attend) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="op">!!</span><span class="kw">sym</span>(svr_date)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb250-10" title="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dayquizscore =</span> <span class="kw">rnorm</span>(<span class="kw">n</span>(),<span class="dt">mean=</span><span class="dv">80</span>,<span class="dt">sd=</span><span class="dv">10</span>))</a>
<a class="sourceLine" id="cb250-11" title="11"><span class="co"># Print</span></a>
<a class="sourceLine" id="cb250-12" title="12"><span class="kw">kable</span>(df_panel_attend) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb250-13" title="13"><span class="st">  </span><span class="kw">kable_styling_fc</span>()</a></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date_in_class
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dayquizscore
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
89.88726
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
96.53929
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
65.59195
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
99.47356
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
97.36936
</td>
</tr>
</tbody>
</table>
<p>Second, now join dataframes:</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb251-1" title="1"><span class="co"># Join with explicit names</span></a>
<a class="sourceLine" id="cb251-2" title="2">df_quiz_joined_multikey &lt;-<span class="st"> </span>df_panel_balanced_skeleton <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb251-3" title="3"><span class="st">  </span><span class="kw">left_join</span>(df_panel_attend,</a>
<a class="sourceLine" id="cb251-4" title="4">            <span class="dt">by=</span>(<span class="kw">c</span>(<span class="st">&#39;sid&#39;</span>=<span class="st">&#39;sid&#39;</span>, <span class="st">&#39;classday&#39;</span>=<span class="st">&#39;date_in_class&#39;</span>)))</a>
<a class="sourceLine" id="cb251-5" title="5"></a>
<a class="sourceLine" id="cb251-6" title="6"><span class="co"># Join with setname strings</span></a>
<a class="sourceLine" id="cb251-7" title="7">df_quiz_joined_multikey_setnames &lt;-<span class="st"> </span>df_panel_balanced_skeleton <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb251-8" title="8"><span class="st">  </span><span class="kw">left_join</span>(df_panel_attend, <span class="dt">by=</span><span class="kw">setNames</span>(<span class="kw">c</span>(<span class="st">&#39;sid&#39;</span>, <span class="st">&#39;date_in_class&#39;</span>), <span class="kw">c</span>(<span class="st">&#39;sid&#39;</span>, <span class="st">&#39;classday&#39;</span>)))</a>
<a class="sourceLine" id="cb251-9" title="9"></a>
<a class="sourceLine" id="cb251-10" title="10"><span class="co"># Print</span></a>
<a class="sourceLine" id="cb251-11" title="11"><span class="kw">kable</span>(df_quiz_joined_multikey) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb251-12" title="12"><span class="st">  </span><span class="kw">kable_styling_fc</span>()</a></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
classday
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dayquizscore
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
89.88726
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
96.53929
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
65.59195
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
99.47356
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
97.36936
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb252-1" title="1"><span class="kw">kable</span>(df_quiz_joined_multikey_setnames) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb252-2" title="2"><span class="st">  </span><span class="kw">kable_styling_fc</span>()</a></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
classday
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dayquizscore
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
89.88726
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
96.53929
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
65.59195
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
99.47356
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
97.36936
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table>
</div>
<div id="stack-panel-frames-together" class="section level4">
<h4><span class="header-section-number">4.1.2.2</span> Stack Panel Frames Together</h4>
<p>There are multiple panel dataframe, each for different subsets of dates. All variable names and units of observations are identical. Use DPLYR <a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a>.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb253-1" title="1"><span class="co"># Define</span></a>
<a class="sourceLine" id="cb253-2" title="2">it_N &lt;-<span class="st"> </span><span class="dv">2</span> <span class="co"># Number of individuals</span></a>
<a class="sourceLine" id="cb253-3" title="3">it_M &lt;-<span class="st"> </span><span class="dv">3</span> <span class="co"># Number of Months</span></a>
<a class="sourceLine" id="cb253-4" title="4">svr_id &lt;-<span class="st"> &#39;sid&#39;</span></a>
<a class="sourceLine" id="cb253-5" title="5">svr_date &lt;-<span class="st"> &#39;date&#39;</span></a>
<a class="sourceLine" id="cb253-6" title="6"></a>
<a class="sourceLine" id="cb253-7" title="7"><span class="co"># Panel First Half of Year</span></a>
<a class="sourceLine" id="cb253-8" title="8">df_panel_m1tom3 &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(<span class="kw">matrix</span>(it_M, <span class="dt">nrow=</span>it_N, <span class="dt">ncol=</span><span class="dv">1</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb253-9" title="9"><span class="st">  </span><span class="kw">rowid_to_column</span>(<span class="dt">var =</span> svr_id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb253-10" title="10"><span class="st">  </span><span class="kw">uncount</span>(V1) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb253-11" title="11"><span class="st">  </span><span class="kw">group_by</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_id)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_date) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">row_number</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb253-12" title="12"><span class="st">  </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb253-13" title="13"></a>
<a class="sourceLine" id="cb253-14" title="14"><span class="co"># Panel Second Half of Year</span></a>
<a class="sourceLine" id="cb253-15" title="15">df_panel_m4tom6 &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(<span class="kw">matrix</span>(it_M, <span class="dt">nrow=</span>it_N, <span class="dt">ncol=</span><span class="dv">1</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb253-16" title="16"><span class="st">  </span><span class="kw">rowid_to_column</span>(<span class="dt">var =</span> svr_id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb253-17" title="17"><span class="st">  </span><span class="kw">uncount</span>(V1) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb253-18" title="18"><span class="st">  </span><span class="kw">group_by</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_id)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_date) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">row_number</span>() <span class="op">+</span><span class="st"> </span><span class="dv">3</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb253-19" title="19"><span class="st">  </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb253-20" title="20"></a>
<a class="sourceLine" id="cb253-21" title="21"><span class="co"># Bind Rows</span></a>
<a class="sourceLine" id="cb253-22" title="22">df_panel_m1tm6 &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(df_panel_m1tom3, df_panel_m4tom6) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="op">!!!</span><span class="kw">syms</span>(<span class="kw">c</span>(svr_id, svr_date)))</a>
<a class="sourceLine" id="cb253-23" title="23"></a>
<a class="sourceLine" id="cb253-24" title="24"><span class="co"># Print</span></a>
<a class="sourceLine" id="cb253-25" title="25"><span class="kw">kable</span>(df_panel_m1tom3) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb253-26" title="26"><span class="st">  </span><span class="kw">kable_styling_fc</span>()</a></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb254-1" title="1"><span class="kw">kable</span>(df_panel_m4tom6) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb254-2" title="2"><span class="st">  </span><span class="kw">kable_styling_fc</span>()</a></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
6
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb255-1" title="1"><span class="kw">kable</span>(df_panel_m1tm6) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb255-2" title="2"><span class="st">  </span><span class="kw">kable_styling_fc</span>()</a></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
6
</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="wide-and-long" class="section level2">
<h2><span class="header-section-number">4.2</span> Wide and Long</h2>

<div id="long-to-wide" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Long to Wide</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R Code Examples</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository (<a href="https://fanwangecon.github.io/Stat4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<p>Using the <a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a> function in tidyr to reshape panel or other data structures</p>
<div id="panel-long-attendance-roster-to-wide" class="section level4">
<h4><span class="header-section-number">4.2.1.1</span> Panel Long Attendance Roster to Wide</h4>
<p>There are <span class="math inline">\(N\)</span> students in class, but only a subset of them attend class each day. If student <span class="math inline">\(id_i\)</span> is in class on day <span class="math inline">\(Q\)</span>, the teacher records on a sheet the date and the student ID. So if the student has been in class 10 times, the teacher has ten rows of recorded data for the student with two columns: column one is the student ID, and column two is the date on which the student was in class. Suppose there were 50 students, who on average attended exactly 10 classes each during the semester, this means we have <span class="math inline">\(10 \cdot 50\)</span> rows of data, with differing numbers of rows for each student. This is shown as <em>df_panel_attend_date</em> generated below.</p>
<p>Now we want to generate a new dataframe, where each row is a date, and each column is a student. The values in the new dataframe shows, at the <span class="math inline">\(Q^{th}\)</span> day, how many classes student <span class="math inline">\(i\)</span> has attended so far. The following results is also in a REconTools Function. This is shown as <em>df_attend_cumu_by_day</em> generated below.</p>
<p><strong>First</strong>, generate the raw data structure, <em>df_panel_attend_date</em>:</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb256-1" title="1"><span class="co"># Define</span></a>
<a class="sourceLine" id="cb256-2" title="2">it_N &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb256-3" title="3">it_M &lt;-<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb256-4" title="4">svr_id &lt;-<span class="st"> &#39;student_id&#39;</span></a>
<a class="sourceLine" id="cb256-5" title="5"></a>
<a class="sourceLine" id="cb256-6" title="6"><span class="co"># from : support/rand/fs_rand_draws.Rmd</span></a>
<a class="sourceLine" id="cb256-7" title="7"><span class="kw">set.seed</span>(<span class="dv">222</span>)</a>
<a class="sourceLine" id="cb256-8" title="8">df_panel_attend_date &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(<span class="kw">matrix</span>(it_M, <span class="dt">nrow=</span>it_N, <span class="dt">ncol=</span><span class="dv">1</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb256-9" title="9"><span class="st">  </span><span class="kw">rowid_to_column</span>(<span class="dt">var =</span> svr_id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb256-10" title="10"><span class="st">  </span><span class="kw">uncount</span>(V1) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb256-11" title="11"><span class="st">  </span><span class="kw">group_by</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_id)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">date =</span> <span class="kw">row_number</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb256-12" title="12"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">in_class =</span> <span class="kw">case_when</span>(<span class="kw">rnorm</span>(<span class="kw">n</span>(),<span class="dt">mean=</span><span class="dv">0</span>,<span class="dt">sd=</span><span class="dv">1</span>) <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="dv">0</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb256-13" title="13"><span class="st">  </span><span class="kw">filter</span>(in_class <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_id), date) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb256-14" title="14"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">date_in_class =</span> date)</a>
<a class="sourceLine" id="cb256-15" title="15"></a>
<a class="sourceLine" id="cb256-16" title="16"><span class="co"># Print</span></a>
<a class="sourceLine" id="cb256-17" title="17"><span class="kw">kable</span>(df_panel_attend_date) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb256-18" title="18"><span class="st">  </span><span class="kw">kable_styling_fc</span>()</a></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
student_id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date_in_class
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5
</td>
</tr>
</tbody>
</table>
<p><strong>Second</strong>, generate wider data structure, <em>df_attend_cumu_by_day</em>:</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb257-1" title="1"><span class="co"># Define</span></a>
<a class="sourceLine" id="cb257-2" title="2">svr_id &lt;-<span class="st"> &#39;student_id&#39;</span></a>
<a class="sourceLine" id="cb257-3" title="3">svr_date &lt;-<span class="st"> &#39;date_in_class&#39;</span></a>
<a class="sourceLine" id="cb257-4" title="4">st_idcol_prefix &lt;-<span class="st"> &#39;sid_&#39;</span></a>
<a class="sourceLine" id="cb257-5" title="5"></a>
<a class="sourceLine" id="cb257-6" title="6"><span class="co"># Generate cumulative enrollment counts by date</span></a>
<a class="sourceLine" id="cb257-7" title="7">df_panel_attend_date_addone &lt;-<span class="st"> </span>df_panel_attend_date <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">attended =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb257-8" title="8"><span class="kw">kable</span>(df_panel_attend_date_addone) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb257-9" title="9"><span class="st">  </span><span class="kw">kable_styling_fc</span>()</a></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
student_id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date_in_class
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
attended
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb258-1" title="1"><span class="co"># Pivot Wide</span></a>
<a class="sourceLine" id="cb258-2" title="2">df_panel_attend_date_wider &lt;-<span class="st"> </span>df_panel_attend_date_addone <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb258-3" title="3"><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> svr_id,</a>
<a class="sourceLine" id="cb258-4" title="4">              <span class="dt">values_from =</span> attended)</a>
<a class="sourceLine" id="cb258-5" title="5"><span class="kw">kable</span>(df_panel_attend_date_wider) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb258-6" title="6"><span class="st">  </span><span class="kw">kable_styling_fc</span>()</a></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date_in_class
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
3
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb259-1" title="1"><span class="co"># Sort and rename</span></a>
<a class="sourceLine" id="cb259-2" title="2"><span class="co"># rename see: https://fanwangecon.github.io/R4Econ/amto/tibble/fs_tib_basics.html</span></a>
<a class="sourceLine" id="cb259-3" title="3">ar_unique_ids &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">unique</span>(df_panel_attend_date <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_id))))</a>
<a class="sourceLine" id="cb259-4" title="4">df_panel_attend_date_wider_sort &lt;-<span class="st"> </span>df_panel_attend_date_wider <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb259-5" title="5"><span class="st">    </span><span class="kw">arrange</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_date)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb259-6" title="6"><span class="st">    </span><span class="kw">rename_at</span>(<span class="kw">vars</span>(<span class="kw">num_range</span>(<span class="st">&#39;&#39;</span>,ar_unique_ids))</a>
<a class="sourceLine" id="cb259-7" title="7">              , <span class="kw">list</span>(<span class="op">~</span><span class="kw">paste0</span>(st_idcol_prefix, . , <span class="st">&#39;&#39;</span>))</a>
<a class="sourceLine" id="cb259-8" title="8">              )</a>
<a class="sourceLine" id="cb259-9" title="9"><span class="kw">kable</span>(df_panel_attend_date_wider_sort) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb259-10" title="10"><span class="st">  </span><span class="kw">kable_styling_fc</span>()</a></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date_in_class
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid_1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid_2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid_3
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb260-1" title="1"><span class="co"># replace NA and cumusum again</span></a>
<a class="sourceLine" id="cb260-2" title="2"><span class="co"># see: R4Econ/support/function/fs_func_multivar for renaming and replacing</span></a>
<a class="sourceLine" id="cb260-3" title="3">df_attend_cumu_by_day &lt;-<span class="st"> </span>df_panel_attend_date_wider_sort <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb260-4" title="4"><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(<span class="kw">contains</span>(st_idcol_prefix)), <span class="kw">list</span>(<span class="op">~</span><span class="kw">replace_na</span>(., <span class="dv">0</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb260-5" title="5"><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(<span class="kw">contains</span>(st_idcol_prefix)), <span class="kw">list</span>(<span class="op">~</span><span class="kw">cumsum</span>(.)))</a>
<a class="sourceLine" id="cb260-6" title="6"></a>
<a class="sourceLine" id="cb260-7" title="7"><span class="kw">kable</span>(df_attend_cumu_by_day) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb260-8" title="8"><span class="st">  </span><span class="kw">kable_styling_fc</span>()</a></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date_in_class
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid_1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid_2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sid_3
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
</tbody>
</table>
<p>The structure above is also a function in Fan’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, here the function is tested:</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb261-1" title="1"><span class="co"># Parameters</span></a>
<a class="sourceLine" id="cb261-2" title="2">df &lt;-<span class="st"> </span>df_panel_attend_date</a>
<a class="sourceLine" id="cb261-3" title="3">svr_id_i &lt;-<span class="st"> &#39;student_id&#39;</span></a>
<a class="sourceLine" id="cb261-4" title="4">svr_id_t &lt;-<span class="st"> &#39;date_in_class&#39;</span></a>
<a class="sourceLine" id="cb261-5" title="5">st_idcol_prefix &lt;-<span class="st"> &#39;sid_&#39;</span></a>
<a class="sourceLine" id="cb261-6" title="6"></a>
<a class="sourceLine" id="cb261-7" title="7"><span class="co"># Invoke Function</span></a>
<a class="sourceLine" id="cb261-8" title="8">ls_df_rosterwide &lt;-<span class="st"> </span><span class="kw">ff_panel_expand_longrosterwide</span>(df, svr_id_t, svr_id_i, st_idcol_prefix)</a>
<a class="sourceLine" id="cb261-9" title="9">df_roster_wide_func &lt;-<span class="st"> </span>ls_df_rosterwide<span class="op">$</span>df_roster_wide</a>
<a class="sourceLine" id="cb261-10" title="10">df_roster_wide_cumu_func &lt;-<span class="st"> </span>ls_df_rosterwide<span class="op">$</span>df_roster_wide_cumu</a>
<a class="sourceLine" id="cb261-11" title="11"></a>
<a class="sourceLine" id="cb261-12" title="12"><span class="co"># Print</span></a>
<a class="sourceLine" id="cb261-13" title="13"><span class="kw">print</span>(df_roster_wide_func)</a>
<a class="sourceLine" id="cb261-14" title="14"><span class="kw">print</span>(df_roster_wide_cumu_func)</a></code></pre></div>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="functions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="linear-regression.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": [["Panel-Data-and-Optimization-with-R.pdf", "PDF"]],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
