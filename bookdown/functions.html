<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Functions | Panel Data and Optimization with R</title>
  <meta name="description" content="R Examples Panel and Optimization." />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Functions | Panel Data and Optimization with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="R Examples Panel and Optimization." />
  <meta name="github-repo" content="fanwangecon/R4Econ" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Functions | Panel Data and Optimization with R" />
  
  <meta name="twitter:description" content="R Examples Panel and Optimization." />
  

<meta name="author" content="Fan Wang" />


<meta name="date" content="2020-04-23" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="summarize-data.html"/>
<link rel="next" href="panel.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-92953468-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-92953468-5');
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Panel Data and Optimization with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html"><i class="fa fa-check"></i><b>1</b> Array, Matrix, Dataframe</a><ul>
<li class="chapter" data-level="1.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#list"><i class="fa fa-check"></i><b>1.1</b> List</a><ul>
<li class="chapter" data-level="1.1.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#multiple-dimensional-list"><i class="fa fa-check"></i><b>1.1.1</b> Multiple Dimensional List</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#array"><i class="fa fa-check"></i><b>1.2</b> Array</a><ul>
<li class="chapter" data-level="1.2.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#array-basics"><i class="fa fa-check"></i><b>1.2.1</b> Array Basics</a></li>
<li class="chapter" data-level="1.2.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-arrays"><i class="fa fa-check"></i><b>1.2.2</b> Generate Arrays</a></li>
<li class="chapter" data-level="1.2.3" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#string-arrays"><i class="fa fa-check"></i><b>1.2.3</b> String Arrays</a></li>
<li class="chapter" data-level="1.2.4" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#mesh-matrices-arrays-and-scalars"><i class="fa fa-check"></i><b>1.2.4</b> Mesh Matrices, Arrays and Scalars</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#matrix"><i class="fa fa-check"></i><b>1.3</b> Matrix</a><ul>
<li class="chapter" data-level="1.3.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-matrixes"><i class="fa fa-check"></i><b>1.3.1</b> Generate Matrixes</a></li>
<li class="chapter" data-level="1.3.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#linear-algebra"><i class="fa fa-check"></i><b>1.3.2</b> Linear Algebra</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#variables-in-dataframes"><i class="fa fa-check"></i><b>1.4</b> Variables in Dataframes</a><ul>
<li class="chapter" data-level="1.4.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-dataframe"><i class="fa fa-check"></i><b>1.4.1</b> Generate Dataframe</a></li>
<li class="chapter" data-level="1.4.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#factor-label-and-combine"><i class="fa fa-check"></i><b>1.4.2</b> Factor Label and Combine</a></li>
<li class="chapter" data-level="1.4.3" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#drawly-random-rows"><i class="fa fa-check"></i><b>1.4.3</b> Drawly Random Rows</a></li>
<li class="chapter" data-level="1.4.4" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-variables-conditional-on-others"><i class="fa fa-check"></i><b>1.4.4</b> Generate Variables Conditional On Others</a></li>
<li class="chapter" data-level="1.4.5" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#string-values"><i class="fa fa-check"></i><b>1.4.5</b> String Values</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="summarize-data.html"><a href="summarize-data.html"><i class="fa fa-check"></i><b>2</b> Summarize Data</a><ul>
<li class="chapter" data-level="2.1" data-path="summarize-data.html"><a href="summarize-data.html#counting-observation"><i class="fa fa-check"></i><b>2.1</b> Counting Observation</a><ul>
<li class="chapter" data-level="2.1.1" data-path="summarize-data.html"><a href="summarize-data.html#uncount"><i class="fa fa-check"></i><b>2.1.1</b> Uncount</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="summarize-data.html"><a href="summarize-data.html#sorting-indexing-slicing"><i class="fa fa-check"></i><b>2.2</b> Sorting, Indexing, Slicing</a><ul>
<li class="chapter" data-level="2.2.1" data-path="summarize-data.html"><a href="summarize-data.html#sorting"><i class="fa fa-check"></i><b>2.2.1</b> Sorting</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="summarize-data.html"><a href="summarize-data.html#group-statistics"><i class="fa fa-check"></i><b>2.3</b> Group Statistics</a><ul>
<li class="chapter" data-level="2.3.1" data-path="summarize-data.html"><a href="summarize-data.html#groups-statistics"><i class="fa fa-check"></i><b>2.3.1</b> Groups Statistics</a></li>
<li class="chapter" data-level="2.3.2" data-path="summarize-data.html"><a href="summarize-data.html#one-variable-group-summary"><i class="fa fa-check"></i><b>2.3.2</b> One Variable Group Summary</a></li>
<li class="chapter" data-level="2.3.3" data-path="summarize-data.html"><a href="summarize-data.html#nested-within-group-stats"><i class="fa fa-check"></i><b>2.3.3</b> Nested within Group Stats</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="summarize-data.html"><a href="summarize-data.html#distributional-statistics"><i class="fa fa-check"></i><b>2.4</b> Distributional Statistics</a><ul>
<li class="chapter" data-level="2.4.1" data-path="summarize-data.html"><a href="summarize-data.html#histogram"><i class="fa fa-check"></i><b>2.4.1</b> Histogram</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="summarize-data.html"><a href="summarize-data.html#summarize-multiple-variables"><i class="fa fa-check"></i><b>2.5</b> Summarize Multiple Variables</a><ul>
<li class="chapter" data-level="2.5.1" data-path="summarize-data.html"><a href="summarize-data.html#generate-replace-variables"><i class="fa fa-check"></i><b>2.5.1</b> Generate Replace Variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>3</b> Functions</a><ul>
<li class="chapter" data-level="3.1" data-path="functions.html"><a href="functions.html#dataframe-mutate"><i class="fa fa-check"></i><b>3.1</b> Dataframe Mutate</a><ul>
<li class="chapter" data-level="3.1.1" data-path="functions.html"><a href="functions.html#row-input-functions"><i class="fa fa-check"></i><b>3.1.1</b> Row Input Functions</a></li>
<li class="chapter" data-level="3.1.2" data-path="functions.html"><a href="functions.html#evaluate-choices-across-states"><i class="fa fa-check"></i><b>3.1.2</b> Evaluate Choices Across States</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="functions.html"><a href="functions.html#dataframe-do-anything"><i class="fa fa-check"></i><b>3.2</b> Dataframe Do Anything</a><ul>
<li class="chapter" data-level="3.2.1" data-path="functions.html"><a href="functions.html#mxq-to-mxp-rows"><i class="fa fa-check"></i><b>3.2.1</b> MxQ to MxP Rows</a></li>
<li class="chapter" data-level="3.2.2" data-path="functions.html"><a href="functions.html#mx1-to-mxq-rows"><i class="fa fa-check"></i><b>3.2.2</b> Mx1 to MxQ Rows</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="functions.html"><a href="functions.html#apply-and-pmap"><i class="fa fa-check"></i><b>3.3</b> Apply and pmap</a><ul>
<li class="chapter" data-level="3.3.1" data-path="functions.html"><a href="functions.html#apply-sapply-mutate"><i class="fa fa-check"></i><b>3.3.1</b> Apply, Sapply, Mutate</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="panel.html"><a href="panel.html"><i class="fa fa-check"></i><b>4</b> Panel</a><ul>
<li class="chapter" data-level="4.1" data-path="panel.html"><a href="panel.html#generate-and-join"><i class="fa fa-check"></i><b>4.1</b> Generate and Join</a><ul>
<li class="chapter" data-level="4.1.1" data-path="panel.html"><a href="panel.html#generate-panel-structure"><i class="fa fa-check"></i><b>4.1.1</b> Generate Panel Structure</a></li>
<li class="chapter" data-level="4.1.2" data-path="panel.html"><a href="panel.html#join-datasets"><i class="fa fa-check"></i><b>4.1.2</b> Join Datasets</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="panel.html"><a href="panel.html#wide-and-long"><i class="fa fa-check"></i><b>4.2</b> Wide and Long</a><ul>
<li class="chapter" data-level="4.2.1" data-path="panel.html"><a href="panel.html#long-to-wide"><i class="fa fa-check"></i><b>4.2.1</b> Long to Wide</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i><b>5</b> Linear Regression</a><ul>
<li class="chapter" data-level="5.1" data-path="linear-regression.html"><a href="linear-regression.html#ols-and-iv"><i class="fa fa-check"></i><b>5.1</b> OLS and IV</a><ul>
<li class="chapter" data-level="5.1.1" data-path="linear-regression.html"><a href="linear-regression.html#ols-and-iv-regression"><i class="fa fa-check"></i><b>5.1.1</b> OLS and IV Regression</a></li>
<li class="chapter" data-level="5.1.2" data-path="linear-regression.html"><a href="linear-regression.html#iv-loop-over-rhs"><i class="fa fa-check"></i><b>5.1.2</b> IV Loop over RHS</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="linear-regression.html"><a href="linear-regression.html#decomposition"><i class="fa fa-check"></i><b>5.2</b> Decomposition</a><ul>
<li class="chapter" data-level="5.2.1" data-path="linear-regression.html"><a href="linear-regression.html#decompose-rhs"><i class="fa fa-check"></i><b>5.2.1</b> Decompose RHS</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html"><i class="fa fa-check"></i><b>6</b> Nonlinear Regression</a><ul>
<li class="chapter" data-level="6.1" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html#logit-regression"><i class="fa fa-check"></i><b>6.1</b> Logit Regression</a><ul>
<li class="chapter" data-level="6.1.1" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html#binary-logit"><i class="fa fa-check"></i><b>6.1.1</b> Binary Logit</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="optimization.html"><a href="optimization.html"><i class="fa fa-check"></i><b>7</b> Optimization</a><ul>
<li class="chapter" data-level="7.1" data-path="optimization.html"><a href="optimization.html#bisection"><i class="fa fa-check"></i><b>7.1</b> Bisection</a><ul>
<li class="chapter" data-level="7.1.1" data-path="optimization.html"><a href="optimization.html#bisection-1"><i class="fa fa-check"></i><b>7.1.1</b> Bisection</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html"><i class="fa fa-check"></i><b>8</b> Mathmatics and Statistics</a><ul>
<li class="chapter" data-level="8.1" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#distributions"><i class="fa fa-check"></i><b>8.1</b> Distributions</a><ul>
<li class="chapter" data-level="8.1.1" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#integrate-over-normal-guassian-process-shock"><i class="fa fa-check"></i><b>8.1.1</b> Integrate Over Normal Guassian Process Shock</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#analytical-solutions"><i class="fa fa-check"></i><b>8.2</b> Analytical Solutions</a><ul>
<li class="chapter" data-level="8.2.1" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#linear-scalar-fx0-solutions"><i class="fa fa-check"></i><b>8.2.1</b> Linear Scalar f(x)=0 Solutions</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#inequality-models"><i class="fa fa-check"></i><b>8.3</b> Inequality Models</a><ul>
<li class="chapter" data-level="8.3.1" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#gini-discrete-sample"><i class="fa fa-check"></i><b>8.3.1</b> Gini Discrete Sample</a></li>
<li class="chapter" data-level="8.3.2" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#atkinson-family-utility"><i class="fa fa-check"></i><b>8.3.2</b> Atkinson Family Utility</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html"><i class="fa fa-check"></i><b>9</b> Tables and Graphs</a><ul>
<li class="chapter" data-level="9.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#r-base-plots"><i class="fa fa-check"></i><b>9.1</b> R Base Plots</a><ul>
<li class="chapter" data-level="9.1.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#plot-curve-line-and-points"><i class="fa fa-check"></i><b>9.1.1</b> Plot Curve, Line and Points</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#write-and-read-plots"><i class="fa fa-check"></i><b>9.2</b> Write and Read Plots</a><ul>
<li class="chapter" data-level="9.2.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#import-and-export-images"><i class="fa fa-check"></i><b>9.2.1</b> Import and Export Images</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="index-and-code-links.html"><a href="index-and-code-links.html"><i class="fa fa-check"></i><b>A</b> Index and Code Links</a><ul>
<li class="chapter" data-level="A.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#array-matrix-dataframe-links"><i class="fa fa-check"></i><b>A.1</b> Array, Matrix, Dataframe links</a><ul>
<li class="chapter" data-level="A.1.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.1-listlist-links"><i class="fa fa-check"></i><b>A.1.1</b> <span>Section 1.1 List</span> links</a></li>
<li class="chapter" data-level="A.1.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.2-arrayarray-links"><i class="fa fa-check"></i><b>A.1.2</b> <span>Section 1.2 Array</span> links</a></li>
<li class="chapter" data-level="A.1.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.3-matrixmatrix-links"><i class="fa fa-check"></i><b>A.1.3</b> <span>Section 1.3 Matrix</span> links</a></li>
<li class="chapter" data-level="A.1.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.4-variables-in-dataframesvariables-in-dataframes-links"><i class="fa fa-check"></i><b>A.1.4</b> <span>Section 1.4 Variables in Dataframes</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#summarize-data-links"><i class="fa fa-check"></i><b>A.2</b> Summarize Data links</a><ul>
<li class="chapter" data-level="A.2.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.1-counting-observationcounting-observation-links"><i class="fa fa-check"></i><b>A.2.1</b> <span>Section 2.1 Counting Observation</span> links</a></li>
<li class="chapter" data-level="A.2.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.2-sorting-indexing-slicingsorting-indexing-slicing-links"><i class="fa fa-check"></i><b>A.2.2</b> <span>Section 2.2 Sorting, Indexing, Slicing</span> links</a></li>
<li class="chapter" data-level="A.2.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.3-group-statisticsgroup-statistics-links"><i class="fa fa-check"></i><b>A.2.3</b> <span>Section 2.3 Group Statistics</span> links</a></li>
<li class="chapter" data-level="A.2.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.4-distributional-statisticsdistributional-statistics-links"><i class="fa fa-check"></i><b>A.2.4</b> <span>Section 2.4 Distributional Statistics</span> links</a></li>
<li class="chapter" data-level="A.2.5" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.5-summarize-multiple-variablessummarize-multiple-variables-links"><i class="fa fa-check"></i><b>A.2.5</b> <span>Section 2.5 Summarize Multiple Variables</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#functions-links"><i class="fa fa-check"></i><b>A.3</b> Functions links</a><ul>
<li class="chapter" data-level="A.3.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.1-dataframe-mutatedataframe-mutate-links"><i class="fa fa-check"></i><b>A.3.1</b> <span>Section 3.1 Dataframe Mutate</span> links</a></li>
<li class="chapter" data-level="A.3.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.2-dataframe-do-anythingdataframe-do-anything-links"><i class="fa fa-check"></i><b>A.3.2</b> <span>Section 3.2 Dataframe Do Anything</span> links</a></li>
<li class="chapter" data-level="A.3.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.3-apply-and-pmapapply-and-pmap-links"><i class="fa fa-check"></i><b>A.3.3</b> <span>Section 3.3 Apply and pmap</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#panel-links"><i class="fa fa-check"></i><b>A.4</b> Panel links</a><ul>
<li class="chapter" data-level="A.4.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-4.1-generate-and-joingenerate-and-join-links"><i class="fa fa-check"></i><b>A.4.1</b> <span>Section 4.1 Generate and Join</span> links</a></li>
<li class="chapter" data-level="A.4.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-4.2-wide-and-longwide-and-long-links"><i class="fa fa-check"></i><b>A.4.2</b> <span>Section 4.2 Wide and Long</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.5" data-path="index-and-code-links.html"><a href="index-and-code-links.html#linear-regression-links"><i class="fa fa-check"></i><b>A.5</b> Linear Regression links</a><ul>
<li class="chapter" data-level="A.5.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-5.1-ols-and-ivols-and-iv-links"><i class="fa fa-check"></i><b>A.5.1</b> <span>Section 5.1 OLS and IV</span> links</a></li>
<li class="chapter" data-level="A.5.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-5.2-decompositiondecomposition-links"><i class="fa fa-check"></i><b>A.5.2</b> <span>Section 5.2 Decomposition</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.6" data-path="index-and-code-links.html"><a href="index-and-code-links.html#nonlinear-regression-links"><i class="fa fa-check"></i><b>A.6</b> Nonlinear Regression links</a><ul>
<li class="chapter" data-level="A.6.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-6.1-logit-regressionlogit-regression-links"><i class="fa fa-check"></i><b>A.6.1</b> <span>Section 6.1 Logit Regression</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.7" data-path="index-and-code-links.html"><a href="index-and-code-links.html#optimization-links"><i class="fa fa-check"></i><b>A.7</b> Optimization links</a><ul>
<li class="chapter" data-level="A.7.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-7.1-bisectionbisection-links"><i class="fa fa-check"></i><b>A.7.1</b> <span>Section 7.1 Bisection</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.8" data-path="index-and-code-links.html"><a href="index-and-code-links.html#mathmatics-and-statistics-links"><i class="fa fa-check"></i><b>A.8</b> Mathmatics and Statistics links</a><ul>
<li class="chapter" data-level="A.8.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-8.1-distributionsdistributions-links"><i class="fa fa-check"></i><b>A.8.1</b> <span>Section 8.1 Distributions</span> links</a></li>
<li class="chapter" data-level="A.8.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-8.2-analytical-solutionsanalytical-solutions-links"><i class="fa fa-check"></i><b>A.8.2</b> <span>Section 8.2 Analytical Solutions</span> links</a></li>
<li class="chapter" data-level="A.8.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-8.3-inequality-modelsinequality-models-links"><i class="fa fa-check"></i><b>A.8.3</b> <span>Section 8.3 Inequality Models</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.9" data-path="index-and-code-links.html"><a href="index-and-code-links.html#tables-and-graphs-links"><i class="fa fa-check"></i><b>A.9</b> Tables and Graphs links</a><ul>
<li class="chapter" data-level="A.9.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-9.1-r-base-plotsr-base-plots-links"><i class="fa fa-check"></i><b>A.9.1</b> <span>Section 9.1 R Base Plots</span> links</a></li>
<li class="chapter" data-level="A.9.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-9.2-write-and-read-plotswrite-and-read-plots-links"><i class="fa fa-check"></i><b>A.9.2</b> <span>Section 9.2 Write and Read Plots</span> links</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://fanwangecon.github.io/R4Econ/bookdown/index.html" target="blank">R4Econ Bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Panel Data and Optimization with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="functions" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Functions</h1>

<div id="dataframe-mutate" class="section level2">
<h2><span class="header-section-number">3.1</span> Dataframe Mutate</h2>

<div id="row-input-functions" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Row Input Functions</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R4Econ</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository.</p>
</blockquote>
<p>We want evaluate nonlinear function f(Q_i, y_i, ar_x, ar_y, c, d), where c and d are constants, and ar_x and ar_y are arrays, both fixed. x_i and y_i vary over each row of matrix. We would like to evaluate this nonlinear function concurrently across <span class="math inline">\(N\)</span> individuals. The eventual goal is to find the <span class="math inline">\(i\)</span> specific <span class="math inline">\(Q\)</span> that solves the nonlinear equations.</p>
<p>This is a continuation of <a href="https://fanwangecon.github.io/R4Econ/function/noloop/fs_applysapplymutate.html">R use Apply, Sapply and dplyr Mutate to Evaluate one Function Across Rows of a Matrix</a></p>
<div id="set-up-input-arrays" class="section level4">
<h4><span class="header-section-number">3.1.1.1</span> Set up Input Arrays</h4>
<p>There is a function that takes <span class="math inline">\(M=Q+P\)</span> inputs, we want to evaluate this function <span class="math inline">\(N\)</span> times. Each time, there are <span class="math inline">\(M\)</span> inputs, where all but <span class="math inline">\(Q\)</span> of the <span class="math inline">\(M\)</span> inputs, meaning <span class="math inline">\(P\)</span> of the <span class="math inline">\(M\)</span> inputs, are the same. In particular, <span class="math inline">\(P=Q*N\)</span>.</p>
<p><span class="math display">\[M = Q+P = Q + Q*N\]</span></p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb198-1" title="1"><span class="co"># it_child_count = N, the number of children</span></a>
<a class="sourceLine" id="cb198-2" title="2">it_N_child_cnt =<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb198-3" title="3"><span class="co"># it_heter_param = Q, number of parameters that are heterogeneous across children</span></a>
<a class="sourceLine" id="cb198-4" title="4">it_Q_hetpa_cnt =<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb198-5" title="5"></a>
<a class="sourceLine" id="cb198-6" title="6"><span class="co"># P fixed parameters, nN is N dimensional, nP is P dimensional</span></a>
<a class="sourceLine" id="cb198-7" title="7">ar_nN_A =<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dt">length.out =</span> it_N_child_cnt)</a>
<a class="sourceLine" id="cb198-8" title="8">ar_nN_alpha =<span class="st"> </span><span class="kw">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="dt">length.out =</span> it_N_child_cnt)</a>
<a class="sourceLine" id="cb198-9" title="9">ar_nP_A_alpha =<span class="st"> </span><span class="kw">c</span>(ar_nN_A, ar_nN_alpha)</a>
<a class="sourceLine" id="cb198-10" title="10">ar_nN_N_choice =<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>,it_N_child_cnt)<span class="op">/</span><span class="kw">sum</span>(<span class="kw">seq</span>(<span class="dv">1</span>,it_N_child_cnt))</a>
<a class="sourceLine" id="cb198-11" title="11"></a>
<a class="sourceLine" id="cb198-12" title="12"><span class="co"># N by Q varying parameters</span></a>
<a class="sourceLine" id="cb198-13" title="13">mt_nN_by_nQ_A_alpha =<span class="st"> </span><span class="kw">cbind</span>(ar_nN_A, ar_nN_alpha, ar_nN_N_choice)</a>
<a class="sourceLine" id="cb198-14" title="14"><span class="co"># Show</span></a>
<a class="sourceLine" id="cb198-15" title="15"><span class="kw">kable</span>(mt_nN_by_nQ_A_alpha) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb198-16" title="16"><span class="st">  </span><span class="kw">kable_styling_fc</span>()</a></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ar_nN_A
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ar_nN_alpha
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ar_nN_N_choice
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-2
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
0.0666667
</td>
</tr>
<tr>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
0.1333333
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.2000000
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
0.2666667
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.9
</td>
<td style="text-align:right;">
0.3333333
</td>
</tr>
</tbody>
</table>
</div>
<div id="testing-function" class="section level4">
<h4><span class="header-section-number">3.1.1.2</span> Testing Function</h4>
<p>Test non-linear Equation.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb199-1" title="1"><span class="co"># Test Parameters</span></a>
<a class="sourceLine" id="cb199-2" title="2">fl_N_agg =<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb199-3" title="3">fl_rho =<span class="st"> </span><span class="dv">-1</span></a>
<a class="sourceLine" id="cb199-4" title="4">fl_N_q =<span class="st"> </span>ar_nN_N_choice[<span class="dv">4</span>]<span class="op">*</span>fl_N_agg</a>
<a class="sourceLine" id="cb199-5" title="5">ar_A_alpha =<span class="st"> </span>mt_nN_by_nQ_A_alpha[<span class="dv">4</span>,]</a>
<a class="sourceLine" id="cb199-6" title="6"><span class="co"># Apply Function</span></a>
<a class="sourceLine" id="cb199-7" title="7">ar_p1_s1 =<span class="st"> </span><span class="kw">exp</span>((ar_A_alpha[<span class="dv">1</span>] <span class="op">-</span><span class="st"> </span>ar_nN_A)<span class="op">*</span>fl_rho)</a>
<a class="sourceLine" id="cb199-8" title="8">ar_p1_s2 =<span class="st"> </span>(ar_A_alpha[<span class="dv">2</span>]<span class="op">/</span>ar_nN_alpha)</a>
<a class="sourceLine" id="cb199-9" title="9">ar_p1_s3 =<span class="st"> </span>(<span class="dv">1</span><span class="op">/</span>(ar_nN_alpha<span class="op">*</span>fl_rho <span class="op">-</span><span class="st"> </span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb199-10" title="10">ar_p1 =<span class="st"> </span>(ar_p1_s1<span class="op">*</span>ar_p1_s2)<span class="op">^</span>ar_p1_s3</a>
<a class="sourceLine" id="cb199-11" title="11">ar_p2 =<span class="st"> </span>fl_N_q<span class="op">^</span>((ar_A_alpha[<span class="dv">2</span>]<span class="op">*</span>fl_rho<span class="dv">-1</span>)<span class="op">/</span>(ar_nN_alpha<span class="op">*</span>fl_rho<span class="dv">-1</span>))</a>
<a class="sourceLine" id="cb199-12" title="12">ar_overall =<span class="st"> </span>ar_p1<span class="op">*</span>ar_p2</a>
<a class="sourceLine" id="cb199-13" title="13">fl_overall =<span class="st"> </span>fl_N_agg <span class="op">-</span><span class="st"> </span><span class="kw">sum</span>(ar_overall)</a>
<a class="sourceLine" id="cb199-14" title="14"><span class="kw">print</span>(fl_overall)</a></code></pre></div>
<pre><code>## [1] -598.2559</code></pre>
<p>Implement the non-linear problem’s evaluation using apply over all <span class="math inline">\(N\)</span> individuals.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb201-1" title="1"><span class="co"># Define Implicit Function</span></a>
<a class="sourceLine" id="cb201-2" title="2">ffi_nonlin_dplyrdo &lt;-<span class="st"> </span><span class="cf">function</span>(fl_A, fl_alpha, fl_N, ar_A, ar_alpha, fl_N_agg, fl_rho){</a>
<a class="sourceLine" id="cb201-3" title="3">  <span class="co"># ar_A_alpha[1] is A</span></a>
<a class="sourceLine" id="cb201-4" title="4">  <span class="co"># ar_A_alpha[2] is alpha</span></a>
<a class="sourceLine" id="cb201-5" title="5"></a>
<a class="sourceLine" id="cb201-6" title="6">  <span class="co"># # Test Parameters</span></a>
<a class="sourceLine" id="cb201-7" title="7">  <span class="co"># fl_N = 100</span></a>
<a class="sourceLine" id="cb201-8" title="8">  <span class="co"># fl_rho = -1</span></a>
<a class="sourceLine" id="cb201-9" title="9">  <span class="co"># fl_N_q = 10</span></a>
<a class="sourceLine" id="cb201-10" title="10"></a>
<a class="sourceLine" id="cb201-11" title="11">  <span class="co"># Apply Function</span></a>
<a class="sourceLine" id="cb201-12" title="12">  ar_p1_s1 =<span class="st"> </span><span class="kw">exp</span>((fl_A <span class="op">-</span><span class="st"> </span>ar_A)<span class="op">*</span>fl_rho)</a>
<a class="sourceLine" id="cb201-13" title="13">  ar_p1_s2 =<span class="st"> </span>(fl_alpha<span class="op">/</span>ar_alpha)</a>
<a class="sourceLine" id="cb201-14" title="14">  ar_p1_s3 =<span class="st"> </span>(<span class="dv">1</span><span class="op">/</span>(ar_alpha<span class="op">*</span>fl_rho <span class="op">-</span><span class="st"> </span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb201-15" title="15">  ar_p1 =<span class="st"> </span>(ar_p1_s1<span class="op">*</span>ar_p1_s2)<span class="op">^</span>ar_p1_s3</a>
<a class="sourceLine" id="cb201-16" title="16">  ar_p2 =<span class="st"> </span>fl_N<span class="op">^</span>((fl_alpha<span class="op">*</span>fl_rho<span class="dv">-1</span>)<span class="op">/</span>(ar_alpha<span class="op">*</span>fl_rho<span class="dv">-1</span>))</a>
<a class="sourceLine" id="cb201-17" title="17">  ar_overall =<span class="st"> </span>ar_p1<span class="op">*</span>ar_p2</a>
<a class="sourceLine" id="cb201-18" title="18">  fl_overall =<span class="st"> </span>fl_N_agg <span class="op">-</span><span class="st"> </span><span class="kw">sum</span>(ar_overall)</a>
<a class="sourceLine" id="cb201-19" title="19"></a>
<a class="sourceLine" id="cb201-20" title="20">  <span class="kw">return</span>(fl_overall)</a>
<a class="sourceLine" id="cb201-21" title="21">}</a>
<a class="sourceLine" id="cb201-22" title="22"></a>
<a class="sourceLine" id="cb201-23" title="23"><span class="co"># Parameters</span></a>
<a class="sourceLine" id="cb201-24" title="24">fl_rho =<span class="st"> </span><span class="dv">-1</span></a>
<a class="sourceLine" id="cb201-25" title="25"></a>
<a class="sourceLine" id="cb201-26" title="26"><span class="co"># Evaluate Function</span></a>
<a class="sourceLine" id="cb201-27" title="27"><span class="kw">print</span>(<span class="kw">ffi_nonlin_dplyrdo</span>(mt_nN_by_nQ_A_alpha[<span class="dv">1</span>,<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb201-28" title="28">                         mt_nN_by_nQ_A_alpha[<span class="dv">1</span>,<span class="dv">2</span>],</a>
<a class="sourceLine" id="cb201-29" title="29">                         mt_nN_by_nQ_A_alpha[<span class="dv">1</span>,<span class="dv">3</span>]<span class="op">*</span>fl_N_agg,</a>
<a class="sourceLine" id="cb201-30" title="30">                         ar_nN_A, ar_nN_alpha, fl_N_agg, fl_rho))</a></code></pre></div>
<pre><code>## [1] 81.86645</code></pre>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb203-1" title="1"><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq</span>(<span class="dv">1</span>,<span class="kw">dim</span>(mt_nN_by_nQ_A_alpha)[<span class="dv">1</span>])){</a>
<a class="sourceLine" id="cb203-2" title="2">  fl_eval =<span class="st"> </span><span class="kw">ffi_nonlin_dplyrdo</span>(mt_nN_by_nQ_A_alpha[i,<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb203-3" title="3">                               mt_nN_by_nQ_A_alpha[i,<span class="dv">2</span>],</a>
<a class="sourceLine" id="cb203-4" title="4">                               mt_nN_by_nQ_A_alpha[i,<span class="dv">3</span>]<span class="op">*</span>fl_N_agg,</a>
<a class="sourceLine" id="cb203-5" title="5">                               ar_nN_A, ar_nN_alpha, fl_N_agg, fl_rho)</a>
<a class="sourceLine" id="cb203-6" title="6">  <span class="kw">print</span>(fl_eval)</a>
<a class="sourceLine" id="cb203-7" title="7">}</a></code></pre></div>
<pre><code>## [1] 81.86645
## [1] 54.48885
## [1] -65.5619
## [1] -598.2559
## [1] -3154.072</code></pre>
</div>
<div id="evaluate-nonlinear-function-using-dplyr-mutate" class="section level4">
<h4><span class="header-section-number">3.1.1.3</span> Evaluate Nonlinear Function using dplyr mutate</h4>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb205-1" title="1"><span class="co"># Convert Matrix to Tibble</span></a>
<a class="sourceLine" id="cb205-2" title="2">ar_st_col_names =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;fl_A&#39;</span>, <span class="st">&#39;fl_alpha&#39;</span>, <span class="st">&#39;fl_N&#39;</span>)</a>
<a class="sourceLine" id="cb205-3" title="3">tb_nN_by_nQ_A_alpha &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(mt_nN_by_nQ_A_alpha) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename_all</span>(<span class="op">~</span><span class="kw">c</span>(ar_st_col_names))</a>
<a class="sourceLine" id="cb205-4" title="4"></a>
<a class="sourceLine" id="cb205-5" title="5"><span class="co"># Define Implicit Function</span></a>
<a class="sourceLine" id="cb205-6" title="6">ffi_nonlin_dplyrdo &lt;-<span class="st"> </span><span class="cf">function</span>(fl_A, fl_alpha, fl_N, ar_A, ar_alpha, fl_N_agg, fl_rho){</a>
<a class="sourceLine" id="cb205-7" title="7"></a>
<a class="sourceLine" id="cb205-8" title="8">  <span class="co"># Test Parameters</span></a>
<a class="sourceLine" id="cb205-9" title="9">  <span class="co"># ar_A = ar_nN_A</span></a>
<a class="sourceLine" id="cb205-10" title="10">  <span class="co"># ar_alpha = ar_nN_alpha</span></a>
<a class="sourceLine" id="cb205-11" title="11">  <span class="co"># fl_N = 100</span></a>
<a class="sourceLine" id="cb205-12" title="12">  <span class="co"># fl_rho = -1</span></a>
<a class="sourceLine" id="cb205-13" title="13">  <span class="co"># fl_N_q = 10</span></a>
<a class="sourceLine" id="cb205-14" title="14"></a>
<a class="sourceLine" id="cb205-15" title="15">  <span class="co"># Apply Function</span></a>
<a class="sourceLine" id="cb205-16" title="16">  ar_p1_s1 =<span class="st"> </span><span class="kw">exp</span>((fl_A <span class="op">-</span><span class="st"> </span>ar_A)<span class="op">*</span>fl_rho)</a>
<a class="sourceLine" id="cb205-17" title="17">  ar_p1_s2 =<span class="st"> </span>(fl_alpha<span class="op">/</span>ar_alpha)</a>
<a class="sourceLine" id="cb205-18" title="18">  ar_p1_s3 =<span class="st"> </span>(<span class="dv">1</span><span class="op">/</span>(ar_alpha<span class="op">*</span>fl_rho <span class="op">-</span><span class="st"> </span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb205-19" title="19">  ar_p1 =<span class="st"> </span>(ar_p1_s1<span class="op">*</span>ar_p1_s2)<span class="op">^</span>ar_p1_s3</a>
<a class="sourceLine" id="cb205-20" title="20">  ar_p2 =<span class="st"> </span>(fl_N<span class="op">*</span>fl_N_agg)<span class="op">^</span>((fl_alpha<span class="op">*</span>fl_rho<span class="dv">-1</span>)<span class="op">/</span>(ar_alpha<span class="op">*</span>fl_rho<span class="dv">-1</span>))</a>
<a class="sourceLine" id="cb205-21" title="21">  ar_overall =<span class="st"> </span>ar_p1<span class="op">*</span>ar_p2</a>
<a class="sourceLine" id="cb205-22" title="22">  fl_overall =<span class="st"> </span>fl_N_agg <span class="op">-</span><span class="st"> </span><span class="kw">sum</span>(ar_overall)</a>
<a class="sourceLine" id="cb205-23" title="23"></a>
<a class="sourceLine" id="cb205-24" title="24">  <span class="kw">return</span>(fl_overall)</a>
<a class="sourceLine" id="cb205-25" title="25">}</a>
<a class="sourceLine" id="cb205-26" title="26"></a>
<a class="sourceLine" id="cb205-27" title="27"><span class="co"># fl_A, fl_alpha are from columns of tb_nN_by_nQ_A_alpha</span></a>
<a class="sourceLine" id="cb205-28" title="28">tb_nN_by_nQ_A_alpha =<span class="st"> </span>tb_nN_by_nQ_A_alpha <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb205-29" title="29"><span class="st">                        </span><span class="kw">mutate</span>(<span class="dt">dplyr_eval =</span> <span class="kw">ffi_nonlin_dplyrdo</span>(fl_A, fl_alpha, fl_N,</a>
<a class="sourceLine" id="cb205-30" title="30">                                                               ar_nN_A, ar_nN_alpha,</a>
<a class="sourceLine" id="cb205-31" title="31">                                                               fl_N_agg, fl_rho))</a>
<a class="sourceLine" id="cb205-32" title="32"><span class="co"># Show</span></a>
<a class="sourceLine" id="cb205-33" title="33"><span class="kw">kable</span>(tb_nN_by_nQ_A_alpha) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb205-34" title="34"><span class="st">  </span><span class="kw">kable_styling_fc</span>()</a></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_A
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_alpha
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_N
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dplyr_eval
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-2
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
0.0666667
</td>
<td style="text-align:right;">
81.86645
</td>
</tr>
<tr>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
0.1333333
</td>
<td style="text-align:right;">
54.48885
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.2000000
</td>
<td style="text-align:right;">
-65.56190
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
0.2666667
</td>
<td style="text-align:right;">
-598.25595
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.9
</td>
<td style="text-align:right;">
0.3333333
</td>
<td style="text-align:right;">
-3154.07226
</td>
</tr>
</tbody>
</table>

</div>
</div>
<div id="evaluate-choices-across-states" class="section level3">
<h3><span class="header-section-number">3.1.2</span> Evaluate Choices Across States</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R4Econ</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository.</p>
</blockquote>
<p>See the <a href="https://fanwangecon.github.io/REconTools/reference/ff_opti_bisect_pmap_multi.html">ff_opti_bisect_pmap_multi</a> function from <a href="https://fanwangecon.github.io/">Fan</a>’s <em><a href="https://fanwangecon.github.io/REconTools/">REconTools</a></em> Package, which provides a resuable function based on the algorithm worked out here.</p>
<p>We want evaluate linear function <span class="math inline">\(0=f(z_{ij}, x_i, y_i, \textbf{X}, \textbf{Y}, c, d)\)</span>. There are <span class="math inline">\(i\)</span> functions that have <span class="math inline">\(i\)</span> specific <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>. For each <span class="math inline">\(i\)</span> function, we evaluate along a grid of feasible values for <span class="math inline">\(z\)</span>, over <span class="math inline">\(j\in J\)</span> grid points, potentially looking for the <span class="math inline">\(j\)</span> that is closest to the root. <span class="math inline">\(\textbf{X}\)</span> and <span class="math inline">\(\textbf{Y}\)</span> are arrays common across the <span class="math inline">\(i\)</span> equations, and <span class="math inline">\(c\)</span> and <span class="math inline">\(d\)</span> are constants.</p>
<p>The evaluation strategy is the following, given min and max for <span class="math inline">\(z\)</span> that are specific for each <span class="math inline">\(j\)</span>, and given common number of grid points, generate a matrix of <span class="math inline">\(z_{ij}\)</span>. Suppose there the number of <span class="math inline">\(i\)</span> is <span class="math inline">\(I\)</span>, and the number of grid points for <span class="math inline">\(j\)</span> is <span class="math inline">\(J\)</span>.</p>
<ol style="list-style-type: decimal">
<li>Generate a <span class="math inline">\(J \cdot I\)</span> by <span class="math inline">\(3\)</span> matrix where the columns are <span class="math inline">\(z,x,y\)</span> as tibble</li>
<li>Follow <a href="https://fanwangecon.github.io/R4Econ/function/mutatef/fs_funceval.html">this</a> Mutate to evaluate the <span class="math inline">\(f(\cdot)\)</span> function.</li>
<li>Add two categorical columns for grid levels and wich <span class="math inline">\(i\)</span>, <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> index. Plot Mutate output evaluated column categorized by <span class="math inline">\(i\)</span> as color and <span class="math inline">\(j\)</span> as x-axis.</li>
</ol>
<div id="set-up-input-arrays-1" class="section level4">
<h4><span class="header-section-number">3.1.2.1</span> Set up Input Arrays</h4>
<p>There is a function that takes <span class="math inline">\(M=Q+P\)</span> inputs, we want to evaluate this function <span class="math inline">\(N\)</span> times. Each time, there are <span class="math inline">\(M\)</span> inputs, where all but <span class="math inline">\(Q\)</span> of the <span class="math inline">\(M\)</span> inputs, meaning <span class="math inline">\(P\)</span> of the <span class="math inline">\(M\)</span> inputs, are the same. In particular, <span class="math inline">\(P=Q*N\)</span>.</p>
<p><span class="math display">\[M = Q+P = Q + Q*N\]</span></p>
<p>Now we need to expand this by the number of choice grid. Each row, representing one equation, is expanded by the number of choice grids. We are graphically searching, or rather brute force searching, which means if we have 100 individuals, we want to plot out the nonlinear equation for each of these lines, and show graphically where each line crosses zero. We achieve this, by evaluating the equation for each of the 100 individuals along a grid of feasible choices.</p>
<p>In this problem here, the feasible choices are shared across individuals.</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb206-1" title="1"><span class="co"># Parameters</span></a>
<a class="sourceLine" id="cb206-2" title="2">fl_rho =<span class="st"> </span><span class="fl">0.20</span></a>
<a class="sourceLine" id="cb206-3" title="3">svr_id_var =<span class="st"> &#39;INDI_ID&#39;</span></a>
<a class="sourceLine" id="cb206-4" title="4"></a>
<a class="sourceLine" id="cb206-5" title="5"><span class="co"># it_child_count = N, the number of children</span></a>
<a class="sourceLine" id="cb206-6" title="6">it_N_child_cnt =<span class="st"> </span><span class="dv">4</span></a>
<a class="sourceLine" id="cb206-7" title="7"><span class="co"># it_heter_param = Q, number of parameters that are heterogeneous across children</span></a>
<a class="sourceLine" id="cb206-8" title="8">it_Q_hetpa_cnt =<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb206-9" title="9"></a>
<a class="sourceLine" id="cb206-10" title="10"><span class="co"># P fixed parameters, nN is N dimensional, nP is P dimensional</span></a>
<a class="sourceLine" id="cb206-11" title="11">ar_nN_A =<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dt">length.out =</span> it_N_child_cnt)</a>
<a class="sourceLine" id="cb206-12" title="12">ar_nN_alpha =<span class="st"> </span><span class="kw">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="dt">length.out =</span> it_N_child_cnt)</a>
<a class="sourceLine" id="cb206-13" title="13">ar_nP_A_alpha =<span class="st"> </span><span class="kw">c</span>(ar_nN_A, ar_nN_alpha)</a>
<a class="sourceLine" id="cb206-14" title="14"></a>
<a class="sourceLine" id="cb206-15" title="15"><span class="co"># N by Q varying parameters</span></a>
<a class="sourceLine" id="cb206-16" title="16">mt_nN_by_nQ_A_alpha =<span class="st"> </span><span class="kw">cbind</span>(ar_nN_A, ar_nN_alpha)</a>
<a class="sourceLine" id="cb206-17" title="17"></a>
<a class="sourceLine" id="cb206-18" title="18"><span class="co"># Choice Grid for nutritional feasible choices for each</span></a>
<a class="sourceLine" id="cb206-19" title="19">fl_N_agg =<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb206-20" title="20">fl_N_min =<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb206-21" title="21">it_N_choice_cnt_ttest =<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb206-22" title="22">it_N_choice_cnt_dense =<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb206-23" title="23">ar_N_choices_ttest =<span class="st"> </span><span class="kw">seq</span>(fl_N_min, fl_N_agg, <span class="dt">length.out =</span> it_N_choice_cnt_ttest)</a>
<a class="sourceLine" id="cb206-24" title="24">ar_N_choices_dense =<span class="st"> </span><span class="kw">seq</span>(fl_N_min, fl_N_agg, <span class="dt">length.out =</span> it_N_choice_cnt_dense)</a>
<a class="sourceLine" id="cb206-25" title="25"></a>
<a class="sourceLine" id="cb206-26" title="26"><span class="co"># Mesh Expand</span></a>
<a class="sourceLine" id="cb206-27" title="27">tb_states_choices &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(mt_nN_by_nQ_A_alpha) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rowid_to_column</span>(<span class="dt">var=</span>svr_id_var)</a>
<a class="sourceLine" id="cb206-28" title="28">tb_states_choices_ttest &lt;-<span class="st"> </span>tb_states_choices <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">expand_grid</span>(<span class="dt">choices =</span> ar_N_choices_ttest)</a>
<a class="sourceLine" id="cb206-29" title="29">tb_states_choices_dense &lt;-<span class="st"> </span>tb_states_choices <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">expand_grid</span>(<span class="dt">choices =</span> ar_N_choices_dense)</a>
<a class="sourceLine" id="cb206-30" title="30"></a>
<a class="sourceLine" id="cb206-31" title="31"><span class="co"># display</span></a>
<a class="sourceLine" id="cb206-32" title="32"><span class="kw">summary</span>(tb_states_choices_dense)</a></code></pre></div>
<pre><code>##     INDI_ID        ar_nN_A    ar_nN_alpha     choices   
##  Min.   :1.00   Min.   :-2   Min.   :0.1   Min.   :  0  
##  1st Qu.:1.75   1st Qu.:-1   1st Qu.:0.3   1st Qu.: 25  
##  Median :2.50   Median : 0   Median :0.5   Median : 50  
##  Mean   :2.50   Mean   : 0   Mean   :0.5   Mean   : 50  
##  3rd Qu.:3.25   3rd Qu.: 1   3rd Qu.:0.7   3rd Qu.: 75  
##  Max.   :4.00   Max.   : 2   Max.   :0.9   Max.   :100</code></pre>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb208-1" title="1"><span class="kw">kable</span>(tb_states_choices_ttest) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb208-2" title="2"><span class="st">  </span><span class="kw">kable_styling_fc</span>()</a></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
INDI_ID
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ar_nN_A
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ar_nN_alpha
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
choices
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-2.0000000
</td>
<td style="text-align:right;">
0.1000000
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-2.0000000
</td>
<td style="text-align:right;">
0.1000000
</td>
<td style="text-align:right;">
50
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-2.0000000
</td>
<td style="text-align:right;">
0.1000000
</td>
<td style="text-align:right;">
100
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-0.6666667
</td>
<td style="text-align:right;">
0.3666667
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-0.6666667
</td>
<td style="text-align:right;">
0.3666667
</td>
<td style="text-align:right;">
50
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-0.6666667
</td>
<td style="text-align:right;">
0.3666667
</td>
<td style="text-align:right;">
100
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.6666667
</td>
<td style="text-align:right;">
0.6333333
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.6666667
</td>
<td style="text-align:right;">
0.6333333
</td>
<td style="text-align:right;">
50
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.6666667
</td>
<td style="text-align:right;">
0.6333333
</td>
<td style="text-align:right;">
100
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2.0000000
</td>
<td style="text-align:right;">
0.9000000
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2.0000000
</td>
<td style="text-align:right;">
0.9000000
</td>
<td style="text-align:right;">
50
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2.0000000
</td>
<td style="text-align:right;">
0.9000000
</td>
<td style="text-align:right;">
100
</td>
</tr>
</tbody>
</table>
</div>
<div id="apply-same-function-all-rows-some-inputs-row-specific-other-shared" class="section level4">
<h4><span class="header-section-number">3.1.2.2</span> Apply Same Function all Rows, Some Inputs Row-specific, other Shared</h4>
<p>There are two types of inputs, row-specific inputs, and inputs that should be applied for each row. The Function just requires all of these inputs, it does not know what is row-specific and what is common for all row. Dplyr recognizes which parameter inputs already existing in the piped dataframe/tibble, given rowwise, those will be row-specific inputs. Additional function parameters that do not exist in dataframe as variable names, but that are pre-defined scalars or arrays will be applied to all rows.</p>
<ul>
<li><span class="citation">(<span class="citeproc-not-found" data-reference-id="param"><strong>???</strong></span>)</span> string variable name of input where functions are evaluated, these are already contained in the dataframe, existing variable names, row specific, rowwise computation over these, each rowwise calculation using different rows: <em>fl_A</em>, <em>fl_alpha</em>, <em>fl_N</em></li>
<li><span class="citation">(<span class="citeproc-not-found" data-reference-id="param"><strong>???</strong></span>)</span> scalar and array values that are applied to every rowwise calculation, all rowwise calculations using the same scalars and arrays:<em>ar_A</em>, <em>ar_alpha</em>, <em>fl_N_agg</em>, <em>fl_rho</em></li>
<li><span class="citation">(<span class="citeproc-not-found" data-reference-id="param"><strong>???</strong></span>)</span> string output variable name</li>
</ul>
<p>The function looks within group, finds min/max etc that are relevant.</p>
<div id="points-and-denser-dataframs-and-define-function" class="section level5">
<h5><span class="header-section-number">3.1.2.2.1</span> 3 Points and Denser Dataframs and Define Function</h5>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb209-1" title="1"><span class="co"># Convert Matrix to Tibble</span></a>
<a class="sourceLine" id="cb209-2" title="2">ar_st_col_names =<span class="st"> </span><span class="kw">c</span>(svr_id_var,<span class="st">&#39;fl_A&#39;</span>, <span class="st">&#39;fl_alpha&#39;</span>)</a>
<a class="sourceLine" id="cb209-3" title="3">tb_states_choices &lt;-<span class="st"> </span>tb_states_choices <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename_all</span>(<span class="op">~</span><span class="kw">c</span>(ar_st_col_names))</a>
<a class="sourceLine" id="cb209-4" title="4">ar_st_col_names =<span class="st"> </span><span class="kw">c</span>(svr_id_var,<span class="st">&#39;fl_A&#39;</span>, <span class="st">&#39;fl_alpha&#39;</span>, <span class="st">&#39;fl_N&#39;</span>)</a>
<a class="sourceLine" id="cb209-5" title="5">tb_states_choices_ttest &lt;-<span class="st"> </span>tb_states_choices_ttest <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename_all</span>(<span class="op">~</span><span class="kw">c</span>(ar_st_col_names))</a>
<a class="sourceLine" id="cb209-6" title="6">tb_states_choices_dense &lt;-<span class="st"> </span>tb_states_choices_dense <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename_all</span>(<span class="op">~</span><span class="kw">c</span>(ar_st_col_names))</a>
<a class="sourceLine" id="cb209-7" title="7"></a>
<a class="sourceLine" id="cb209-8" title="8"><span class="co"># Define Implicit Function</span></a>
<a class="sourceLine" id="cb209-9" title="9">ffi_nonlin_dplyrdo &lt;-<span class="st"> </span><span class="cf">function</span>(fl_A, fl_alpha, fl_N, ar_A, ar_alpha, fl_N_agg, fl_rho){</a>
<a class="sourceLine" id="cb209-10" title="10">  <span class="co"># scalar value that are row-specific, in dataframe already: *fl_A*, *fl_alpha*, *fl_N*</span></a>
<a class="sourceLine" id="cb209-11" title="11">  <span class="co"># array and scalars not in dataframe, common all rows: *ar_A*, *ar_alpha*, *fl_N_agg*, *fl_rho*</span></a>
<a class="sourceLine" id="cb209-12" title="12"></a>
<a class="sourceLine" id="cb209-13" title="13">  <span class="co"># Test Parameters</span></a>
<a class="sourceLine" id="cb209-14" title="14">  <span class="co"># ar_A = ar_nN_A</span></a>
<a class="sourceLine" id="cb209-15" title="15">  <span class="co"># ar_alpha = ar_nN_alpha</span></a>
<a class="sourceLine" id="cb209-16" title="16">  <span class="co"># fl_N = 100</span></a>
<a class="sourceLine" id="cb209-17" title="17">  <span class="co"># fl_rho = -1</span></a>
<a class="sourceLine" id="cb209-18" title="18">  <span class="co"># fl_N_q = 10</span></a>
<a class="sourceLine" id="cb209-19" title="19"></a>
<a class="sourceLine" id="cb209-20" title="20">  <span class="co"># Apply Function</span></a>
<a class="sourceLine" id="cb209-21" title="21">  ar_p1_s1 =<span class="st"> </span><span class="kw">exp</span>((fl_A <span class="op">-</span><span class="st"> </span>ar_A)<span class="op">*</span>fl_rho)</a>
<a class="sourceLine" id="cb209-22" title="22">  ar_p1_s2 =<span class="st"> </span>(fl_alpha<span class="op">/</span>ar_alpha)</a>
<a class="sourceLine" id="cb209-23" title="23">  ar_p1_s3 =<span class="st"> </span>(<span class="dv">1</span><span class="op">/</span>(ar_alpha<span class="op">*</span>fl_rho <span class="op">-</span><span class="st"> </span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb209-24" title="24">  ar_p1 =<span class="st"> </span>(ar_p1_s1<span class="op">*</span>ar_p1_s2)<span class="op">^</span>ar_p1_s3</a>
<a class="sourceLine" id="cb209-25" title="25">  ar_p2 =<span class="st"> </span>fl_N<span class="op">^</span>((fl_alpha<span class="op">*</span>fl_rho<span class="dv">-1</span>)<span class="op">/</span>(ar_alpha<span class="op">*</span>fl_rho<span class="dv">-1</span>))</a>
<a class="sourceLine" id="cb209-26" title="26">  ar_overall =<span class="st"> </span>ar_p1<span class="op">*</span>ar_p2</a>
<a class="sourceLine" id="cb209-27" title="27">  fl_overall =<span class="st"> </span>fl_N_agg <span class="op">-</span><span class="st"> </span><span class="kw">sum</span>(ar_overall)</a>
<a class="sourceLine" id="cb209-28" title="28"></a>
<a class="sourceLine" id="cb209-29" title="29">  <span class="kw">return</span>(fl_overall)</a>
<a class="sourceLine" id="cb209-30" title="30">}</a></code></pre></div>
</div>
<div id="evaluate-at-three-choice-points-and-show-table" class="section level5">
<h5><span class="header-section-number">3.1.2.2.2</span> Evaluate at Three Choice Points and Show Table</h5>
<p>In the example below, just show results evaluating over three choice points and show table.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb210-1" title="1"><span class="co"># fl_A, fl_alpha are from columns of tb_nN_by_nQ_A_alpha</span></a>
<a class="sourceLine" id="cb210-2" title="2">tb_states_choices_ttest_eval =<span class="st"> </span>tb_states_choices_ttest <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb210-3" title="3"><span class="st">                        </span><span class="kw">mutate</span>(<span class="dt">dplyr_eval =</span> <span class="kw">ffi_nonlin_dplyrdo</span>(fl_A, fl_alpha, fl_N,</a>
<a class="sourceLine" id="cb210-4" title="4">                                                               ar_nN_A, ar_nN_alpha,</a>
<a class="sourceLine" id="cb210-5" title="5">                                                               fl_N_agg, fl_rho))</a>
<a class="sourceLine" id="cb210-6" title="6"><span class="co"># Show</span></a>
<a class="sourceLine" id="cb210-7" title="7"><span class="kw">kable</span>(tb_states_choices_ttest_eval) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb210-8" title="8"><span class="st">  </span><span class="kw">kable_styling_fc</span>()</a></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
INDI_ID
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_A
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_alpha
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_N
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dplyr_eval
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-2.0000000
</td>
<td style="text-align:right;">
0.1000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.00000
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-2.0000000
</td>
<td style="text-align:right;">
0.1000000
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
-5666.95576
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-2.0000000
</td>
<td style="text-align:right;">
0.1000000
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
-12880.28392
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-0.6666667
</td>
<td style="text-align:right;">
0.3666667
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.00000
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-0.6666667
</td>
<td style="text-align:right;">
0.3666667
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
-595.73454
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-0.6666667
</td>
<td style="text-align:right;">
0.3666667
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
-1394.70698
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.6666667
</td>
<td style="text-align:right;">
0.6333333
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.00000
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.6666667
</td>
<td style="text-align:right;">
0.6333333
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
-106.51058
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.6666667
</td>
<td style="text-align:right;">
0.6333333
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
-323.94216
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2.0000000
</td>
<td style="text-align:right;">
0.9000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.00000
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2.0000000
</td>
<td style="text-align:right;">
0.9000000
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
22.55577
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2.0000000
</td>
<td style="text-align:right;">
0.9000000
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
-51.97161
</td>
</tr>
</tbody>
</table>
</div>
<div id="evaluate-at-many-choice-points-and-show-graphically" class="section level5">
<h5><span class="header-section-number">3.1.2.2.3</span> Evaluate at Many Choice Points and Show Graphically</h5>
<p>Same as above, but now we evaluate the function over the individuals at many choice points so that we can graph things out.</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb211-1" title="1"><span class="co"># fl_A, fl_alpha are from columns of tb_nN_by_nQ_A_alpha</span></a>
<a class="sourceLine" id="cb211-2" title="2">tb_states_choices_dense_eval =<span class="st"> </span>tb_states_choices_dense <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb211-3" title="3"><span class="st">                        </span><span class="kw">mutate</span>(<span class="dt">dplyr_eval =</span> <span class="kw">ffi_nonlin_dplyrdo</span>(fl_A, fl_alpha, fl_N,</a>
<a class="sourceLine" id="cb211-4" title="4">                                                               ar_nN_A, ar_nN_alpha,</a>
<a class="sourceLine" id="cb211-5" title="5">                                                               fl_N_agg, fl_rho))</a></code></pre></div>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb212-1" title="1"><span class="co"># Labeling</span></a>
<a class="sourceLine" id="cb212-2" title="2">st_title &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&#39;Evaluate Non-Linear Functions to Search for Roots&#39;</span>)</a>
<a class="sourceLine" id="cb212-3" title="3">st_subtitle &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&#39;https://fanwangecon.github.io/&#39;</span>,</a>
<a class="sourceLine" id="cb212-4" title="4">                      <span class="st">&#39;R4Econ/function/mutatef/htmlpdfr/fs_func_choice_states.html&#39;</span>)</a>
<a class="sourceLine" id="cb212-5" title="5">st_caption &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&#39;Evaluating the function, &#39;</span>,</a>
<a class="sourceLine" id="cb212-6" title="6">                     <span class="st">&#39;https://fanwangecon.github.io/R4Econ/&#39;</span>)</a>
<a class="sourceLine" id="cb212-7" title="7">st_x_label &lt;-<span class="st"> &#39;x values&#39;</span></a>
<a class="sourceLine" id="cb212-8" title="8">st_y_label &lt;-<span class="st"> &#39;f(x)&#39;</span></a>
<a class="sourceLine" id="cb212-9" title="9"></a>
<a class="sourceLine" id="cb212-10" title="10"><span class="co"># Show</span></a>
<a class="sourceLine" id="cb212-11" title="11"><span class="kw">dim</span>(tb_states_choices_dense_eval)</a></code></pre></div>
<pre><code>## [1] 400   5</code></pre>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb214-1" title="1"><span class="kw">summary</span>(tb_states_choices_dense_eval)</a></code></pre></div>
<pre><code>##     INDI_ID          fl_A       fl_alpha        fl_N       dplyr_eval       
##  Min.   :1.00   Min.   :-2   Min.   :0.1   Min.   :  0   Min.   :-12880.28  
##  1st Qu.:1.75   1st Qu.:-1   1st Qu.:0.3   1st Qu.: 25   1st Qu.: -1167.29  
##  Median :2.50   Median : 0   Median :0.5   Median : 50   Median :  -202.42  
##  Mean   :2.50   Mean   : 0   Mean   :0.5   Mean   : 50   Mean   : -1645.65  
##  3rd Qu.:3.25   3rd Qu.: 1   3rd Qu.:0.7   3rd Qu.: 75   3rd Qu.:     0.96  
##  Max.   :4.00   Max.   : 2   Max.   :0.9   Max.   :100   Max.   :   100.00</code></pre>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb216-1" title="1">lineplot &lt;-<span class="st"> </span>tb_states_choices_dense_eval <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb216-2" title="2"><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>fl_N, <span class="dt">y=</span>dplyr_eval)) <span class="op">+</span></a>
<a class="sourceLine" id="cb216-3" title="3"><span class="st">        </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb216-4" title="4"><span class="st">        </span><span class="kw">facet_wrap</span>( . <span class="op">~</span><span class="st"> </span>INDI_ID, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb216-5" title="5"><span class="st">        </span><span class="kw">geom_hline</span>(<span class="dt">yintercept=</span><span class="dv">0</span>, <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>,</a>
<a class="sourceLine" id="cb216-6" title="6">                <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb216-7" title="7"><span class="st">        </span><span class="kw">labs</span>(<span class="dt">title =</span> st_title,</a>
<a class="sourceLine" id="cb216-8" title="8">             <span class="dt">subtitle =</span> st_subtitle,</a>
<a class="sourceLine" id="cb216-9" title="9">             <span class="dt">x =</span> st_x_label,</a>
<a class="sourceLine" id="cb216-10" title="10">             <span class="dt">y =</span> st_y_label,</a>
<a class="sourceLine" id="cb216-11" title="11">             <span class="dt">caption =</span> st_caption)</a>
<a class="sourceLine" id="cb216-12" title="12"><span class="kw">print</span>(lineplot)</a></code></pre></div>
<p><img src="Panel-Data-and-Optimization-with-R_files/figure-html/graph%20many%20evaluations-1.png" width="672" style="display: block; margin: auto;" /></p>

</div>
</div>
</div>
</div>
<div id="dataframe-do-anything" class="section level2">
<h2><span class="header-section-number">3.2</span> Dataframe Do Anything</h2>

<div id="mxq-to-mxp-rows" class="section level3">
<h3><span class="header-section-number">3.2.1</span> MxQ to MxP Rows</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R4Econ</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository.</p>
</blockquote>
<div id="mxq-to-mx1-rows-within-group-gini" class="section level4">
<h4><span class="header-section-number">3.2.1.1</span> MxQ to Mx1 Rows: Within Group Gini</h4>
<p>There is a Panel with <span class="math inline">\(M\)</span> individuals and each individual has <span class="math inline">\(Q\)</span> records/rows. A function generate an individual specific outcome given the <span class="math inline">\(Q\)</span> individual specific inputs, along with shared parameters and arrays across the <span class="math inline">\(M\)</span> individuals.</p>
<p>For example, suppose we have a dataframe of individual wage information from different countries, each row is an individual from one country. We want to generate country specific gini based on the individual data for each country in the dataframe. But additionally, perhaps the gini formula requires not just individual income but some additional parameters or shared dataframes as inputs.</p>
<p>Given the within <span class="math inline">\(m\)</span> income observations, we can compute gini statistics that are individual specific based on the observed distribution of incomes. For this, we will use the <a href="https://fanwangecon.github.io/REconTools/reference/ff_dist_gini_vector_pos.html">ff_dist_gini_vector_pos.html</a> function from <a href="https://fanwangecon.github.io/REconTools/">REconTools</a>.</p>
<p>To make this more interesting, we will generate large dataframe with more <span class="math inline">\(M\)</span> and more <span class="math inline">\(Q\)</span> each <span class="math inline">\(m\)</span>.</p>
<div id="large-dataframe" class="section level5">
<h5><span class="header-section-number">3.2.1.1.1</span> Large Dataframe</h5>
<p>There are up to ten thousand income observation per person. And there are ten people.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb217-1" title="1"><span class="co"># Parameter Setups</span></a>
<a class="sourceLine" id="cb217-2" title="2">it_M &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb217-3" title="3">it_Q_max &lt;-<span class="st"> </span><span class="dv">10000</span></a>
<a class="sourceLine" id="cb217-4" title="4">fl_rnorm_mu &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb217-5" title="5">ar_rnorm_sd &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="fl">0.01</span>, <span class="fl">0.2</span>, <span class="dt">length.out=</span>it_M)</a>
<a class="sourceLine" id="cb217-6" title="6">ar_it_q &lt;-<span class="st"> </span><span class="kw">sample.int</span>(it_Q_max, it_M, <span class="dt">replace=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb217-7" title="7"></a>
<a class="sourceLine" id="cb217-8" title="8"><span class="co"># N by Q varying parameters</span></a>
<a class="sourceLine" id="cb217-9" title="9">mt_data =<span class="st"> </span><span class="kw">cbind</span>(ar_it_q, ar_rnorm_sd)</a>
<a class="sourceLine" id="cb217-10" title="10">tb_M &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(mt_data) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rowid_to_column</span>(<span class="dt">var =</span> <span class="st">&quot;ID&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb217-11" title="11"><span class="st">                </span><span class="kw">rename</span>(<span class="dt">sd =</span> ar_rnorm_sd, <span class="dt">Q =</span> ar_it_q) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb217-12" title="12"><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">mean =</span> fl_rnorm_mu)</a></code></pre></div>
</div>
<div id="compute-group-specific-gini-normal" class="section level5">
<h5><span class="header-section-number">3.2.1.1.2</span> Compute Group specific gini, NORMAL</h5>
<p>There is only one input for the gini function <em>ar_pos</em>. Note that the gini are not very large even with large SD, because these are normal distributions. By Construction, most peple are in the middle. So with almost zero standard deviation, we have perfect equality, as standard deviation increases, inequality increases, but still pretty equal overall, there is no fat upper tail.</p>
<p>Note that there are three ways of referring to variable names with dot, which are all shown below:</p>
<ol style="list-style-type: decimal">
<li>We can explicitly refer to names</li>
<li>We can use the <a href="https://stackoverflow.com/a/18228613/8280804">dollar dot structure</a> to use string variable names in do anything.</li>
<li>We can use dot bracket, this is the only option that works with string variable names</li>
</ol>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb218-1" title="1"><span class="co"># A. Normal Draw Expansion, Explicitly Name</span></a>
<a class="sourceLine" id="cb218-2" title="2"><span class="kw">set.seed</span>(<span class="st">&#39;123&#39;</span>)</a>
<a class="sourceLine" id="cb218-3" title="3">tb_income_norm_dot_dollar &lt;-<span class="st"> </span>tb_M <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(ID) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb218-4" title="4"><span class="st">  </span><span class="kw">do</span>(<span class="dt">income =</span> <span class="kw">rnorm</span>(.<span class="op">$</span>Q,</a>
<a class="sourceLine" id="cb218-5" title="5">                    <span class="dt">mean=</span>.<span class="op">$</span>mean,</a>
<a class="sourceLine" id="cb218-6" title="6">                    <span class="dt">sd=</span>.<span class="op">$</span>sd)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb218-7" title="7"><span class="st">  </span><span class="kw">unnest</span>(<span class="kw">c</span>(income)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb218-8" title="8"><span class="st">  </span><span class="kw">left_join</span>(tb_M, <span class="dt">by=</span><span class="st">&quot;ID&quot;</span>)</a>
<a class="sourceLine" id="cb218-9" title="9"></a>
<a class="sourceLine" id="cb218-10" title="10"><span class="co"># Normal Draw Expansion again, dot dollar differently with string variable name</span></a>
<a class="sourceLine" id="cb218-11" title="11"><span class="kw">set.seed</span>(<span class="st">&#39;123&#39;</span>)</a>
<a class="sourceLine" id="cb218-12" title="12">tb_income_norm_dollar_dot &lt;-<span class="st"> </span>tb_M <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(ID) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb218-13" title="13"><span class="st">  </span><span class="kw">do</span>(<span class="dt">income =</span> <span class="kw">rnorm</span>(<span class="st">`</span><span class="dt">$</span><span class="st">`</span>(., <span class="st">&#39;Q&#39;</span>),</a>
<a class="sourceLine" id="cb218-14" title="14">                    <span class="dt">mean =</span> <span class="st">`</span><span class="dt">$</span><span class="st">`</span>(., <span class="st">&#39;mean&#39;</span>),</a>
<a class="sourceLine" id="cb218-15" title="15">                    <span class="dt">sd =</span> <span class="st">`</span><span class="dt">$</span><span class="st">`</span>(., <span class="st">&#39;sd&#39;</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb218-16" title="16"><span class="st">  </span><span class="kw">unnest</span>(<span class="kw">c</span>(income)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb218-17" title="17"><span class="st">  </span><span class="kw">left_join</span>(tb_M, <span class="dt">by=</span><span class="st">&quot;ID&quot;</span>)</a>
<a class="sourceLine" id="cb218-18" title="18"></a>
<a class="sourceLine" id="cb218-19" title="19"><span class="co"># Normal Draw Expansion again, dot double bracket</span></a>
<a class="sourceLine" id="cb218-20" title="20"><span class="kw">set.seed</span>(<span class="st">&#39;123&#39;</span>)</a>
<a class="sourceLine" id="cb218-21" title="21">svr_mean &lt;-<span class="st"> &#39;mean&#39;</span></a>
<a class="sourceLine" id="cb218-22" title="22">svr_sd &lt;-<span class="st"> &#39;sd&#39;</span></a>
<a class="sourceLine" id="cb218-23" title="23">svr_Q &lt;-<span class="st"> &#39;Q&#39;</span></a>
<a class="sourceLine" id="cb218-24" title="24">tb_income_norm_dot_bracket_db &lt;-<span class="st"> </span>tb_M <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(ID) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb218-25" title="25"><span class="st">  </span><span class="kw">do</span>(<span class="dt">income =</span> <span class="kw">rnorm</span>(.[[svr_Q]],</a>
<a class="sourceLine" id="cb218-26" title="26">                    <span class="dt">mean =</span> .[[svr_mean]],</a>
<a class="sourceLine" id="cb218-27" title="27">                    <span class="dt">sd =</span> .[[svr_sd]])) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb218-28" title="28"><span class="st">  </span><span class="kw">unnest</span>(<span class="kw">c</span>(income)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb218-29" title="29"><span class="st">  </span><span class="kw">left_join</span>(tb_M, <span class="dt">by=</span><span class="st">&quot;ID&quot;</span>)</a>
<a class="sourceLine" id="cb218-30" title="30"></a>
<a class="sourceLine" id="cb218-31" title="31"><span class="co"># display</span></a>
<a class="sourceLine" id="cb218-32" title="32"><span class="kw">sum</span>(<span class="kw">sum</span>(tb_income_norm_dollar_dot <span class="op">-</span><span class="st"> </span>tb_income_norm_dot_dollar <span class="op">-</span><span class="st"> </span>tb_income_norm_dot_bracket_db))</a></code></pre></div>
<pre><code>## [1] -463785175</code></pre>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb220-1" title="1"><span class="co"># display</span></a>
<a class="sourceLine" id="cb220-2" title="2"><span class="kw">head</span>(tb_income_norm_dot_dollar, <span class="dv">20</span>)</a></code></pre></div>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb221-1" title="1"><span class="co"># Gini by Group</span></a>
<a class="sourceLine" id="cb221-2" title="2">tb_gini_norm &lt;-<span class="st"> </span>tb_income_norm_dollar_dot <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(ID) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb221-3" title="3"><span class="st">  </span><span class="kw">do</span>(<span class="dt">inc_gini_norm =</span> <span class="kw">ff_dist_gini_vector_pos</span>(.<span class="op">$</span>income)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb221-4" title="4"><span class="st">  </span><span class="kw">unnest</span>(<span class="kw">c</span>(inc_gini_norm)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb221-5" title="5"><span class="st">  </span><span class="kw">left_join</span>(tb_M, <span class="dt">by=</span><span class="st">&quot;ID&quot;</span>)</a>
<a class="sourceLine" id="cb221-6" title="6"></a>
<a class="sourceLine" id="cb221-7" title="7"><span class="co"># display</span></a>
<a class="sourceLine" id="cb221-8" title="8"><span class="kw">kable</span>(tb_gini_norm) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb221-9" title="9"><span class="st">  </span><span class="kw">kable_styling_fc</span>()</a></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ID
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
inc_gini_norm
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Q
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
mean
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0056337
</td>
<td style="text-align:right;">
9982
</td>
<td style="text-align:right;">
0.0100000
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.0175280
</td>
<td style="text-align:right;">
2980
</td>
<td style="text-align:right;">
0.0311111
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.0293986
</td>
<td style="text-align:right;">
1614
</td>
<td style="text-align:right;">
0.0522222
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.0422304
</td>
<td style="text-align:right;">
555
</td>
<td style="text-align:right;">
0.0733333
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.0535146
</td>
<td style="text-align:right;">
4469
</td>
<td style="text-align:right;">
0.0944444
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0.0653938
</td>
<td style="text-align:right;">
9359
</td>
<td style="text-align:right;">
0.1155556
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0.0769135
</td>
<td style="text-align:right;">
7789
</td>
<td style="text-align:right;">
0.1366667
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0.0894165
</td>
<td style="text-align:right;">
9991
</td>
<td style="text-align:right;">
0.1577778
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
0.1010982
</td>
<td style="text-align:right;">
9097
</td>
<td style="text-align:right;">
0.1788889
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.1124019
</td>
<td style="text-align:right;">
1047
</td>
<td style="text-align:right;">
0.2000000
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="mx1-to-mxq-rows" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Mx1 to MxQ Rows</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R4Econ</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository.</p>
</blockquote>
<p><strong>Case One</strong>: There is a dataframe with <span class="math inline">\(M\)</span> rows, based on these <span class="math inline">\(m\)</span> specific information, generate dataframes for each <span class="math inline">\(m\)</span>. Stack these indivdiual dataframes together and merge original <span class="math inline">\(m\)</span> specific information in as well. The number of rows for each <span class="math inline">\(m\)</span> is <span class="math inline">\(Q_m\)</span>, each <span class="math inline">\(m\)</span> could have different number of expansion rows.</p>
<p>Generate a panel with <span class="math inline">\(M\)</span> individuals, each individual is observed for different spans of times (<em>uncount</em>). Before expanding, generate individual specific normal distribution standard deviation. All individuals share the same mean, but have increasing standard deviations.</p>
<div id="generate-dataframe-with-m-rows." class="section level4">
<h4><span class="header-section-number">3.2.2.1</span> Generate Dataframe with M Rows.</h4>
<p>This is the first step, generate <span class="math inline">\(M\)</span> rows of data, to be expanded. Each row contains the number of normal draws to make and the mean and the standard deviation for normal daraws that are <span class="math inline">\(m\)</span> specific.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb222-1" title="1"><span class="co"># Parameter Setups</span></a>
<a class="sourceLine" id="cb222-2" title="2">it_M &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb222-3" title="3">it_Q_max &lt;-<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb222-4" title="4">fl_rnorm_mu &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb222-5" title="5">ar_rnorm_sd &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="fl">0.01</span>, <span class="dv">200</span>, <span class="dt">length.out=</span>it_M)</a>
<a class="sourceLine" id="cb222-6" title="6">ar_it_q &lt;-<span class="st"> </span><span class="kw">sample.int</span>(it_Q_max, it_M, <span class="dt">replace=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb222-7" title="7"></a>
<a class="sourceLine" id="cb222-8" title="8"><span class="co"># N by Q varying parameters</span></a>
<a class="sourceLine" id="cb222-9" title="9">mt_data =<span class="st"> </span><span class="kw">cbind</span>(ar_it_q, ar_rnorm_sd)</a>
<a class="sourceLine" id="cb222-10" title="10">tb_M &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(mt_data) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rowid_to_column</span>(<span class="dt">var =</span> <span class="st">&quot;ID&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb222-11" title="11"><span class="st">                </span><span class="kw">rename</span>(<span class="dt">sd =</span> ar_rnorm_sd, <span class="dt">Q =</span> ar_it_q) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb222-12" title="12"><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">mean =</span> fl_rnorm_mu)</a>
<a class="sourceLine" id="cb222-13" title="13"></a>
<a class="sourceLine" id="cb222-14" title="14"><span class="co"># display</span></a>
<a class="sourceLine" id="cb222-15" title="15"><span class="kw">kable</span>(tb_M) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb222-16" title="16"><span class="st">  </span><span class="kw">kable_styling_fc</span>()</a></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ID
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Q
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
mean
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:right;">
1000
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
100.005
</td>
<td style="text-align:right;">
1000
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
200.000
</td>
<td style="text-align:right;">
1000
</td>
</tr>
</tbody>
</table>
</div>
<div id="random-normal-draw-expansion" class="section level4">
<h4><span class="header-section-number">3.2.2.2</span> Random Normal Draw Expansion</h4>
<p>The steps are:</p>
<ol style="list-style-type: decimal">
<li><a href="https://dplyr.tidyverse.org/reference/do.html">do anything</a></li>
<li>use “.$” sign to refer to variable names, or [[‘name’]]</li>
<li>unnest</li>
<li>left_join expanded and original</li>
</ol>
<p>Note these all give the same results</p>
<p>Use dot dollar to get variables</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb223-1" title="1"><span class="co"># Generate $Q_m$ individual specific incomes, expanded different number of times for each m</span></a>
<a class="sourceLine" id="cb223-2" title="2">tb_income &lt;-<span class="st"> </span>tb_M <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(ID) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb223-3" title="3"><span class="st">  </span><span class="kw">do</span>(<span class="dt">income =</span> <span class="kw">rnorm</span>(.<span class="op">$</span>Q, <span class="dt">mean=</span>.<span class="op">$</span>mean, <span class="dt">sd=</span>.<span class="op">$</span>sd)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb223-4" title="4"><span class="st">  </span><span class="kw">unnest</span>(<span class="kw">c</span>(income))</a>
<a class="sourceLine" id="cb223-5" title="5"></a>
<a class="sourceLine" id="cb223-6" title="6"><span class="co"># Merge back with tb_M</span></a>
<a class="sourceLine" id="cb223-7" title="7">tb_income_full_dd &lt;-<span class="st"> </span>tb_income <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb223-8" title="8"><span class="st">  </span><span class="kw">left_join</span>(tb_M)</a>
<a class="sourceLine" id="cb223-9" title="9"></a>
<a class="sourceLine" id="cb223-10" title="10"><span class="co"># display</span></a>
<a class="sourceLine" id="cb223-11" title="11"><span class="kw">kable</span>(tb_income) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb223-12" title="12"><span class="st">  </span><span class="kw">kable_styling_fc</span>()</a></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ID
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
income
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1000.0183
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
999.9943
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
999.9822
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1033.7465
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1093.1374
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
862.1896
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
988.7742
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb224-1" title="1"><span class="kw">kable</span>(tb_income_full_dd) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-2" title="2"><span class="st">  </span><span class="kw">kable_styling_fc</span>()</a></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ID
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
income
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Q
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
mean
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1000.0183
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:right;">
1000
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
999.9943
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:right;">
1000
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
999.9822
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:right;">
1000
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1033.7465
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
100.005
</td>
<td style="text-align:right;">
1000
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1093.1374
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
100.005
</td>
<td style="text-align:right;">
1000
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
862.1896
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
100.005
</td>
<td style="text-align:right;">
1000
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
988.7742
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
200.000
</td>
<td style="text-align:right;">
1000
</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="apply-and-pmap" class="section level2">
<h2><span class="header-section-number">3.3</span> Apply and pmap</h2>

<div id="apply-sapply-mutate" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Apply, Sapply, Mutate</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R4Econ</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository.</p>
</blockquote>
<ul>
<li>r apply matrix to function row by row</li>
<li>r evaluate function on grid</li>
<li><a href="https://stackoverflow.com/questions/4236368/apply-a-function-to-every-row-of-a-matrix-or-a-data-frame">Apply a function to every row of a matrix or a data frame</a></li>
<li>r apply</li>
<li>r sapply</li>
<li>sapply over matrix row by row</li>
<li>apply dplyr vectorize</li>
<li>function as parameters using formulas</li>
<li>do</li>
</ul>
<p>We want evaluate linear function f(x_i, y_i, ar_x, ar_y, c, d), where c and d are constants, and ar_x and ar_y are arrays, both fixed. x_i and y_i vary over each row of matrix. More specifically, we have a functions, this function takes inputs that are individual specific. We would like to evaluate this function concurrently across <span class="math inline">\(N\)</span> individuals.</p>
<p>The function is such that across the <span class="math inline">\(N\)</span> individuals, some of the function parameter inputs are the same, but others are different. If we are looking at demand for a particular product, the prices of all products enter the demand equation for each product, but the product’s own price enters also in a different way.</p>
<p>The objective is either to just evaluate this function across <span class="math inline">\(N\)</span> individuals, or this is a part of a nonlinear solution system.</p>
<p>What is the relationship between apply, lapply and vectorization? see <a href="https://stackoverflow.com/a/29006276/8280804">Is the “*apply” family really not vectorized?</a>.</p>
<div id="set-up-input-arrays-2" class="section level4">
<h4><span class="header-section-number">3.3.1.1</span> Set up Input Arrays</h4>
<p>There is a function that takes <span class="math inline">\(M=Q+P\)</span> inputs, we want to evaluate this function <span class="math inline">\(N\)</span> times. Each time, there are <span class="math inline">\(M\)</span> inputs, where all but <span class="math inline">\(Q\)</span> of the <span class="math inline">\(M\)</span> inputs, meaning <span class="math inline">\(P\)</span> of the <span class="math inline">\(M\)</span> inputs, are the same. In particular, <span class="math inline">\(P=Q*N\)</span>.</p>
<p><span class="math display">\[M = Q+P = Q + Q*N\]</span></p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb225-1" title="1"><span class="co"># it_child_count = N, the number of children</span></a>
<a class="sourceLine" id="cb225-2" title="2">it_N_child_cnt =<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb225-3" title="3"><span class="co"># it_heter_param = Q, number of parameters that are</span></a>
<a class="sourceLine" id="cb225-4" title="4"><span class="co"># heterogeneous across children</span></a>
<a class="sourceLine" id="cb225-5" title="5">it_Q_hetpa_cnt =<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb225-6" title="6"></a>
<a class="sourceLine" id="cb225-7" title="7"><span class="co"># P fixed parameters, nN is N dimensional, nP is P dimensional</span></a>
<a class="sourceLine" id="cb225-8" title="8">ar_nN_A =<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dt">length.out =</span> it_N_child_cnt)</a>
<a class="sourceLine" id="cb225-9" title="9">ar_nN_alpha =<span class="st"> </span><span class="kw">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="dt">length.out =</span> it_N_child_cnt)</a>
<a class="sourceLine" id="cb225-10" title="10">ar_nP_A_alpha =<span class="st"> </span><span class="kw">c</span>(ar_nN_A, ar_nN_alpha)</a>
<a class="sourceLine" id="cb225-11" title="11"></a>
<a class="sourceLine" id="cb225-12" title="12"><span class="co"># N by Q varying parameters</span></a>
<a class="sourceLine" id="cb225-13" title="13">mt_nN_by_nQ_A_alpha =<span class="st"> </span><span class="kw">cbind</span>(ar_nN_A, ar_nN_alpha)</a>
<a class="sourceLine" id="cb225-14" title="14"></a>
<a class="sourceLine" id="cb225-15" title="15"><span class="co"># display</span></a>
<a class="sourceLine" id="cb225-16" title="16"><span class="kw">kable</span>(mt_nN_by_nQ_A_alpha) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-17" title="17"><span class="st">  </span><span class="kw">kable_styling_fc</span>()</a></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ar_nN_A
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ar_nN_alpha
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-2
</td>
<td style="text-align:right;">
0.1
</td>
</tr>
<tr>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0.3
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.5
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.7
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.9
</td>
</tr>
</tbody>
</table>
</div>
<div id="using-apply" class="section level4">
<h4><span class="header-section-number">3.3.1.2</span> Using apply</h4>
<div id="apply-with-named-function" class="section level5">
<h5><span class="header-section-number">3.3.1.2.1</span> Apply with Named Function</h5>
<p>First we use the apply function, we have to hard-code the arrays that are fixed for each of the <span class="math inline">\(N\)</span> individuals. Then apply allows us to loop over the matrix that is <span class="math inline">\(N\)</span> by <span class="math inline">\(Q\)</span>, each row one at a time, from <span class="math inline">\(1\)</span> to <span class="math inline">\(N\)</span>.</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb226-1" title="1"><span class="co"># Define Implicit Function</span></a>
<a class="sourceLine" id="cb226-2" title="2">ffi_linear_hardcode &lt;-<span class="st"> </span><span class="cf">function</span>(ar_A_alpha){</a>
<a class="sourceLine" id="cb226-3" title="3">  <span class="co"># ar_A_alpha[1] is A</span></a>
<a class="sourceLine" id="cb226-4" title="4">  <span class="co"># ar_A_alpha[2] is alpha</span></a>
<a class="sourceLine" id="cb226-5" title="5"></a>
<a class="sourceLine" id="cb226-6" title="6">  fl_out =<span class="st"> </span><span class="kw">sum</span>(ar_A_alpha[<span class="dv">1</span>]<span class="op">*</span>ar_nN_A <span class="op">+</span></a>
<a class="sourceLine" id="cb226-7" title="7"><span class="st">                 </span><span class="dv">1</span><span class="op">/</span>(ar_A_alpha[<span class="dv">2</span>] <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span>ar_nN_alpha))</a>
<a class="sourceLine" id="cb226-8" title="8"></a>
<a class="sourceLine" id="cb226-9" title="9">  <span class="kw">return</span>(fl_out)</a>
<a class="sourceLine" id="cb226-10" title="10">}</a>
<a class="sourceLine" id="cb226-11" title="11"></a>
<a class="sourceLine" id="cb226-12" title="12"><span class="co"># Evaluate function row by row</span></a>
<a class="sourceLine" id="cb226-13" title="13">ar_func_apply =<span class="st"> </span><span class="kw">apply</span>(mt_nN_by_nQ_A_alpha, <span class="dv">1</span>, ffi_linear_hardcode)</a></code></pre></div>
</div>
<div id="apply-using-anonymous-function" class="section level5">
<h5><span class="header-section-number">3.3.1.2.2</span> Apply using Anonymous Function</h5>
<ul>
<li>apply over matrix</li>
</ul>
<p>Apply with anonymous function generating a list of arrays of different lengths. In the example below, we want to drawn <span class="math inline">\(N\)</span> sets of random uniform numbers, but for each set the number of draws we want to have is <span class="math inline">\(Q_i\)</span>. Furthermore, we want to rescale the random uniform draws so that they all become proportions that sum u pto one for each <span class="math inline">\(i\)</span>, but then we multply each row’s values by the row specific aggregates.</p>
<p>The anonymous function has hard coded parameters. Using an anonymous function here allows for parameters to be provided inside the function that are shared across each looped evaluation. This is perhaps more convenient than sapply with additional parameters.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb227-1" title="1"><span class="kw">set.seed</span>(<span class="dv">1039</span>)</a>
<a class="sourceLine" id="cb227-2" title="2"></a>
<a class="sourceLine" id="cb227-3" title="3"><span class="co"># Define the number of draws each row and total amount</span></a>
<a class="sourceLine" id="cb227-4" title="4">it_N &lt;-<span class="st"> </span><span class="dv">4</span></a>
<a class="sourceLine" id="cb227-5" title="5">fl_unif_min &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb227-6" title="6">fl_unif_max &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb227-7" title="7">mt_draw_define &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">sample</span>(it_N, it_N, <span class="dt">replace=</span><span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb227-8" title="8">                        <span class="kw">runif</span>(it_N, <span class="dt">min=</span><span class="dv">1</span>, <span class="dt">max=</span><span class="dv">10</span>))</a>
<a class="sourceLine" id="cb227-9" title="9">tb_draw_define &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(mt_draw_define) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb227-10" title="10"><span class="st">  </span><span class="kw">rowid_to_column</span>(<span class="dt">var =</span> <span class="st">&quot;draw_group&quot;</span>)</a>
<a class="sourceLine" id="cb227-11" title="11"><span class="kw">print</span>(tb_draw_define)</a>
<a class="sourceLine" id="cb227-12" title="12"></a>
<a class="sourceLine" id="cb227-13" title="13"><span class="co"># apply row by row, anonymous function has hard</span></a>
<a class="sourceLine" id="cb227-14" title="14"><span class="co"># coded min and max</span></a>
<a class="sourceLine" id="cb227-15" title="15">ls_ar_draws_shares_lvls =</a>
<a class="sourceLine" id="cb227-16" title="16"><span class="st">  </span><span class="kw">apply</span>(tb_draw_define,</a>
<a class="sourceLine" id="cb227-17" title="17">        <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb227-18" title="18">        <span class="cf">function</span>(row) {</a>
<a class="sourceLine" id="cb227-19" title="19">          it_draw &lt;-<span class="st"> </span>row[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb227-20" title="20">          fl_sum &lt;-<span class="st"> </span>row[<span class="dv">3</span>]</a>
<a class="sourceLine" id="cb227-21" title="21">          ar_unif &lt;-<span class="st"> </span><span class="kw">runif</span>(it_draw,</a>
<a class="sourceLine" id="cb227-22" title="22">                           <span class="dt">min=</span>fl_unif_min,</a>
<a class="sourceLine" id="cb227-23" title="23">                           <span class="dt">max=</span>fl_unif_max)</a>
<a class="sourceLine" id="cb227-24" title="24">          ar_share &lt;-<span class="st"> </span>ar_unif<span class="op">/</span><span class="kw">sum</span>(ar_unif)</a>
<a class="sourceLine" id="cb227-25" title="25">          ar_levels &lt;-<span class="st"> </span>ar_share<span class="op">*</span>fl_sum</a>
<a class="sourceLine" id="cb227-26" title="26">          <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">ar_share=</span>ar_share,</a>
<a class="sourceLine" id="cb227-27" title="27">                      <span class="dt">ar_levels=</span>ar_levels))</a>
<a class="sourceLine" id="cb227-28" title="28">        })</a>
<a class="sourceLine" id="cb227-29" title="29"></a>
<a class="sourceLine" id="cb227-30" title="30"><span class="co"># Show Results</span></a>
<a class="sourceLine" id="cb227-31" title="31"><span class="kw">print</span>(ls_ar_draws_shares_lvls)</a></code></pre></div>
<pre><code>## [[1]]
## [[1]]$ar_share
## [1] 0.2783638 0.2224140 0.2797840 0.2194381
## 
## [[1]]$ar_levels
## [1] 1.492414 1.192446 1.500028 1.176491
## 
## 
## [[2]]
## [[2]]$ar_share
## [1] 0.5052919 0.4947081
## 
## [[2]]$ar_levels
## [1] 3.866528 3.785541
## 
## 
## [[3]]
## [[3]]$ar_share
## [1] 1
## 
## [[3]]$ar_levels
##       V2 
## 9.572211 
## 
## 
## [[4]]
## [[4]]$ar_share
## [1] 0.4211426 0.2909812 0.2878762
## 
## [[4]]$ar_levels
## [1] 4.051971 2.799640 2.769765</code></pre>
<p>We will try to do the same thing as above, but now the output will be a stacked dataframe. Note that within each element of the apply row by row loop, we are generating two variables <em>ar_share</em> and <em>ar_levels</em>. We will not generate a dataframe with multiple columns, storing <em>ar_share</em>, <em>ar_levels</em> as well as information on <em>min</em>, <em>max</em>, number of draws and rescale total sum.</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb229-1" title="1"><span class="kw">set.seed</span>(<span class="dv">1039</span>)</a>
<a class="sourceLine" id="cb229-2" title="2"><span class="co"># apply row by row, anonymous function has hard coded min and max</span></a>
<a class="sourceLine" id="cb229-3" title="3">ls_mt_draws_shares_lvls =</a>
<a class="sourceLine" id="cb229-4" title="4"><span class="st">  </span><span class="kw">apply</span>(tb_draw_define, <span class="dv">1</span>, <span class="cf">function</span>(row) {</a>
<a class="sourceLine" id="cb229-5" title="5"></a>
<a class="sourceLine" id="cb229-6" title="6">    it_draw_group &lt;-<span class="st"> </span>row[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb229-7" title="7">    it_draw &lt;-<span class="st"> </span>row[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb229-8" title="8">    fl_sum &lt;-<span class="st"> </span>row[<span class="dv">3</span>]</a>
<a class="sourceLine" id="cb229-9" title="9"></a>
<a class="sourceLine" id="cb229-10" title="10">    ar_unif &lt;-<span class="st"> </span><span class="kw">runif</span>(it_draw,</a>
<a class="sourceLine" id="cb229-11" title="11">                     <span class="dt">min=</span>fl_unif_min,</a>
<a class="sourceLine" id="cb229-12" title="12">                     <span class="dt">max=</span>fl_unif_max)</a>
<a class="sourceLine" id="cb229-13" title="13">    ar_share &lt;-<span class="st"> </span>ar_unif<span class="op">/</span><span class="kw">sum</span>(ar_unif)</a>
<a class="sourceLine" id="cb229-14" title="14">    ar_levels &lt;-<span class="st"> </span>ar_share<span class="op">*</span>fl_sum</a>
<a class="sourceLine" id="cb229-15" title="15"></a>
<a class="sourceLine" id="cb229-16" title="16">    mt_all_res &lt;-<span class="st"> </span><span class="kw">cbind</span>(it_draw_group, it_draw, fl_sum,</a>
<a class="sourceLine" id="cb229-17" title="17">                        ar_unif, ar_share, ar_levels)</a>
<a class="sourceLine" id="cb229-18" title="18">    <span class="kw">colnames</span>(mt_all_res) &lt;-</a>
<a class="sourceLine" id="cb229-19" title="19"><span class="st">      </span><span class="kw">c</span>(<span class="st">&#39;draw_group&#39;</span>, <span class="st">&#39;draw_count&#39;</span>, <span class="st">&#39;sum&#39;</span>,</a>
<a class="sourceLine" id="cb229-20" title="20">        <span class="st">&#39;unif_draw&#39;</span>, <span class="st">&#39;share&#39;</span>, <span class="st">&#39;rescale&#39;</span>)</a>
<a class="sourceLine" id="cb229-21" title="21">    <span class="kw">rownames</span>(mt_all_res) &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb229-22" title="22"></a>
<a class="sourceLine" id="cb229-23" title="23">    <span class="kw">return</span>(mt_all_res)</a>
<a class="sourceLine" id="cb229-24" title="24">  })</a>
<a class="sourceLine" id="cb229-25" title="25">mt_draws_shares_lvls_all &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, ls_mt_draws_shares_lvls)</a>
<a class="sourceLine" id="cb229-26" title="26"><span class="co"># Show Results</span></a>
<a class="sourceLine" id="cb229-27" title="27"><span class="kw">kable</span>(mt_draws_shares_lvls_all) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable_styling_fc</span>()</a></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
draw_group
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
draw_count
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sum
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
unif_draw
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
share
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
rescale
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
5.361378
</td>
<td style="text-align:right;">
1.125668
</td>
<td style="text-align:right;">
0.1988606
</td>
<td style="text-align:right;">
1.066167
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
5.361378
</td>
<td style="text-align:right;">
1.668536
</td>
<td style="text-align:right;">
0.2947638
</td>
<td style="text-align:right;">
1.580340
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
5.361378
</td>
<td style="text-align:right;">
1.419382
</td>
<td style="text-align:right;">
0.2507483
</td>
<td style="text-align:right;">
1.344356
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
5.361378
</td>
<td style="text-align:right;">
1.447001
</td>
<td style="text-align:right;">
0.2556274
</td>
<td style="text-align:right;">
1.370515
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
7.652069
</td>
<td style="text-align:right;">
1.484598
</td>
<td style="text-align:right;">
0.4605236
</td>
<td style="text-align:right;">
3.523959
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
7.652069
</td>
<td style="text-align:right;">
1.739119
</td>
<td style="text-align:right;">
0.5394764
</td>
<td style="text-align:right;">
4.128110
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
9.572211
</td>
<td style="text-align:right;">
1.952468
</td>
<td style="text-align:right;">
1.0000000
</td>
<td style="text-align:right;">
9.572211
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
9.621375
</td>
<td style="text-align:right;">
1.957931
</td>
<td style="text-align:right;">
0.3609352
</td>
<td style="text-align:right;">
3.472693
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
9.621375
</td>
<td style="text-align:right;">
1.926995
</td>
<td style="text-align:right;">
0.3552324
</td>
<td style="text-align:right;">
3.417824
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
9.621375
</td>
<td style="text-align:right;">
1.539678
</td>
<td style="text-align:right;">
0.2838324
</td>
<td style="text-align:right;">
2.730858
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="using-sapply" class="section level4">
<h4><span class="header-section-number">3.3.1.3</span> Using sapply</h4>
<div id="sapply-with-named-function" class="section level5">
<h5><span class="header-section-number">3.3.1.3.1</span> sapply with named function</h5>
<ul>
<li>r convert matrix to list</li>
<li>Convert a matrix to a list of vectors in R</li>
</ul>
<p>Sapply allows us to not have tohard code in the A and alpha arrays. But Sapply works over List or Vector, not Matrix. So we have to convert the <span class="math inline">\(N\)</span> by <span class="math inline">\(Q\)</span> matrix to a N element list
Now update the function with sapply.</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb230-1" title="1">ls_ar_nN_by_nQ_A_alpha =<span class="st"> </span><span class="kw">as.list</span>(<span class="kw">data.frame</span>(<span class="kw">t</span>(mt_nN_by_nQ_A_alpha)))</a>
<a class="sourceLine" id="cb230-2" title="2"></a>
<a class="sourceLine" id="cb230-3" title="3"><span class="co"># Define Implicit Function</span></a>
<a class="sourceLine" id="cb230-4" title="4">ffi_linear_sapply &lt;-<span class="st"> </span><span class="cf">function</span>(ar_A_alpha, ar_A, ar_alpha){</a>
<a class="sourceLine" id="cb230-5" title="5">  <span class="co"># ar_A_alpha[1] is A</span></a>
<a class="sourceLine" id="cb230-6" title="6">  <span class="co"># ar_A_alpha[2] is alpha</span></a>
<a class="sourceLine" id="cb230-7" title="7"></a>
<a class="sourceLine" id="cb230-8" title="8">  fl_out =<span class="st"> </span><span class="kw">sum</span>(ar_A_alpha[<span class="dv">1</span>]<span class="op">*</span>ar_nN_A <span class="op">+</span></a>
<a class="sourceLine" id="cb230-9" title="9"><span class="st">                 </span><span class="dv">1</span><span class="op">/</span>(ar_A_alpha[<span class="dv">2</span>] <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span>ar_nN_alpha))</a>
<a class="sourceLine" id="cb230-10" title="10"></a>
<a class="sourceLine" id="cb230-11" title="11">  <span class="kw">return</span>(fl_out)</a>
<a class="sourceLine" id="cb230-12" title="12">}</a>
<a class="sourceLine" id="cb230-13" title="13"></a>
<a class="sourceLine" id="cb230-14" title="14"><span class="co"># Evaluate function row by row</span></a>
<a class="sourceLine" id="cb230-15" title="15">ar_func_sapply =<span class="st"> </span><span class="kw">sapply</span>(ls_ar_nN_by_nQ_A_alpha, ffi_linear_sapply,</a>
<a class="sourceLine" id="cb230-16" title="16">                        <span class="dt">ar_A=</span>ar_nN_A, <span class="dt">ar_alpha=</span>ar_nN_alpha)</a></code></pre></div>
</div>
<div id="sapply-using-anonymous-function" class="section level5">
<h5><span class="header-section-number">3.3.1.3.2</span> sapply using anonymous function</h5>
<ul>
<li>sapply anonymous function</li>
<li>r anoymous function multiple lines</li>
</ul>
<p>Sapply with anonymous function generating a list of arrays of different lengths. In the example below, we want to drawn <span class="math inline">\(N\)</span> sets of random uniform numbers, but for each set the number of draws we want to have is <span class="math inline">\(Q_i\)</span>. Furthermore, we want to rescale the random uniform draws so that they all become proportions that sum u pto one for each <span class="math inline">\(i\)</span>.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb231-1" title="1">it_N &lt;-<span class="st"> </span><span class="dv">4</span></a>
<a class="sourceLine" id="cb231-2" title="2">fl_unif_min &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb231-3" title="3">fl_unif_max &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb231-4" title="4"></a>
<a class="sourceLine" id="cb231-5" title="5"><span class="co"># Generate using runif without anonymous function</span></a>
<a class="sourceLine" id="cb231-6" title="6"><span class="kw">set.seed</span>(<span class="dv">1039</span>)</a>
<a class="sourceLine" id="cb231-7" title="7">ls_ar_draws =<span class="st"> </span><span class="kw">sapply</span>(<span class="kw">seq</span>(it_N),</a>
<a class="sourceLine" id="cb231-8" title="8">                     runif,</a>
<a class="sourceLine" id="cb231-9" title="9">                     <span class="dt">min=</span>fl_unif_min, <span class="dt">max=</span>fl_unif_max)</a>
<a class="sourceLine" id="cb231-10" title="10"><span class="kw">print</span>(ls_ar_draws)</a></code></pre></div>
<pre><code>## [[1]]
## [1] 1.125668
## 
## [[2]]
## [1] 1.668536 1.419382
## 
## [[3]]
## [1] 1.447001 1.484598 1.739119
## 
## [[4]]
## [1] 1.952468 1.957931 1.926995 1.539678</code></pre>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb233-1" title="1"><span class="co"># Generate Using Anonymous Function</span></a>
<a class="sourceLine" id="cb233-2" title="2"><span class="kw">set.seed</span>(<span class="dv">1039</span>)</a>
<a class="sourceLine" id="cb233-3" title="3">ls_ar_draws_shares =<span class="st"> </span><span class="kw">sapply</span>(<span class="kw">seq</span>(it_N),</a>
<a class="sourceLine" id="cb233-4" title="4">                            <span class="cf">function</span>(n, min, max) {</a>
<a class="sourceLine" id="cb233-5" title="5">                              ar_unif &lt;-<span class="st"> </span><span class="kw">runif</span>(n,min,max)</a>
<a class="sourceLine" id="cb233-6" title="6">                              ar_share &lt;-<span class="st"> </span>ar_unif<span class="op">/</span><span class="kw">sum</span>(ar_unif)</a>
<a class="sourceLine" id="cb233-7" title="7">                              <span class="kw">return</span>(ar_share)</a>
<a class="sourceLine" id="cb233-8" title="8">                            },</a>
<a class="sourceLine" id="cb233-9" title="9">                            <span class="dt">min=</span>fl_unif_min, <span class="dt">max=</span>fl_unif_max)</a>
<a class="sourceLine" id="cb233-10" title="10"><span class="co"># Print Share</span></a>
<a class="sourceLine" id="cb233-11" title="11"><span class="kw">print</span>(ls_ar_draws_shares)</a></code></pre></div>
<pre><code>## [[1]]
## [1] 1
## 
## [[2]]
## [1] 0.5403432 0.4596568
## 
## [[3]]
## [1] 0.3098027 0.3178522 0.3723451
## 
## [[4]]
## [1] 0.2646671 0.2654076 0.2612141 0.2087113</code></pre>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb235-1" title="1"><span class="co"># Sapply with anonymous function to check sums</span></a>
<a class="sourceLine" id="cb235-2" title="2"><span class="kw">sapply</span>(<span class="kw">seq</span>(it_N), <span class="cf">function</span>(x) {<span class="kw">sum</span>(ls_ar_draws[[x]])})</a></code></pre></div>
<pre><code>## [1] 1.125668 3.087918 4.670717 7.377071</code></pre>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb237-1" title="1"><span class="kw">sapply</span>(<span class="kw">seq</span>(it_N), <span class="cf">function</span>(x) {<span class="kw">sum</span>(ls_ar_draws_shares[[x]])})</a></code></pre></div>
<pre><code>## [1] 1 1 1 1</code></pre>
</div>
</div>
<div id="using-dplyr-mutate-rowwise" class="section level4">
<h4><span class="header-section-number">3.3.1.4</span> Using dplyr mutate rowwise</h4>
<ul>
<li>dplyr mutate own function</li>
<li>dplyr all row function</li>
<li>dplyr do function</li>
<li>apply function each row dplyr</li>
<li>applying a function to every row of a table using dplyr</li>
<li>dplyr rowwise</li>
</ul>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb239-1" title="1"><span class="co"># Convert Matrix to Tibble</span></a>
<a class="sourceLine" id="cb239-2" title="2">ar_st_col_names =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;fl_A&#39;</span>, <span class="st">&#39;fl_alpha&#39;</span>)</a>
<a class="sourceLine" id="cb239-3" title="3">tb_nN_by_nQ_A_alpha &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(mt_nN_by_nQ_A_alpha) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb239-4" title="4"><span class="st">  </span><span class="kw">rename_all</span>(<span class="op">~</span><span class="kw">c</span>(ar_st_col_names))</a>
<a class="sourceLine" id="cb239-5" title="5"><span class="co"># Show</span></a>
<a class="sourceLine" id="cb239-6" title="6"><span class="kw">kable</span>(tb_nN_by_nQ_A_alpha) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb239-7" title="7"><span class="st">  </span><span class="kw">kable_styling_fc</span>()</a></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_A
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_alpha
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-2
</td>
<td style="text-align:right;">
0.1
</td>
</tr>
<tr>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0.3
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.5
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.7
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.9
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb240-1" title="1"><span class="co"># Define Implicit Function</span></a>
<a class="sourceLine" id="cb240-2" title="2">ffi_linear_dplyrdo &lt;-<span class="st"> </span><span class="cf">function</span>(fl_A, fl_alpha, ar_nN_A, ar_nN_alpha){</a>
<a class="sourceLine" id="cb240-3" title="3">  <span class="co"># ar_A_alpha[1] is A</span></a>
<a class="sourceLine" id="cb240-4" title="4">  <span class="co"># ar_A_alpha[2] is alpha</span></a>
<a class="sourceLine" id="cb240-5" title="5"></a>
<a class="sourceLine" id="cb240-6" title="6">  <span class="kw">print</span>(<span class="kw">paste0</span>(<span class="st">&#39;cur row, fl_A=&#39;</span>, fl_A, <span class="st">&#39;, fl_alpha=&#39;</span>, fl_alpha))</a>
<a class="sourceLine" id="cb240-7" title="7">  fl_out =<span class="st"> </span><span class="kw">sum</span>(fl_A<span class="op">*</span>ar_nN_A <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span>(fl_alpha <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span>ar_nN_alpha))</a>
<a class="sourceLine" id="cb240-8" title="8"></a>
<a class="sourceLine" id="cb240-9" title="9">  <span class="kw">return</span>(fl_out)</a>
<a class="sourceLine" id="cb240-10" title="10">}</a>
<a class="sourceLine" id="cb240-11" title="11"></a>
<a class="sourceLine" id="cb240-12" title="12"><span class="co"># Evaluate function row by row of tibble</span></a>
<a class="sourceLine" id="cb240-13" title="13"><span class="co"># fl_A, fl_alpha are from columns of tb_nN_by_nQ_A_alpha</span></a>
<a class="sourceLine" id="cb240-14" title="14">tb_nN_by_nQ_A_alpha_show &lt;-<span class="st"> </span>tb_nN_by_nQ_A_alpha <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb240-15" title="15"><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb240-16" title="16"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dplyr_eval =</span></a>
<a class="sourceLine" id="cb240-17" title="17">           <span class="kw">ffi_linear_dplyrdo</span>(fl_A, fl_alpha, ar_nN_A, ar_nN_alpha))</a></code></pre></div>
<pre><code>## [1] &quot;cur row, fl_A=-2, fl_alpha=0.1&quot;
## [1] &quot;cur row, fl_A=-1, fl_alpha=0.3&quot;
## [1] &quot;cur row, fl_A=0, fl_alpha=0.5&quot;
## [1] &quot;cur row, fl_A=1, fl_alpha=0.7&quot;
## [1] &quot;cur row, fl_A=2, fl_alpha=0.9&quot;</code></pre>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb242-1" title="1"><span class="co"># Show</span></a>
<a class="sourceLine" id="cb242-2" title="2"><span class="kw">kable</span>(tb_nN_by_nQ_A_alpha_show) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb242-3" title="3"><span class="st">  </span><span class="kw">kable_styling_fc</span>()</a></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_A
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_alpha
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dplyr_eval
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-2
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
2.346356
</td>
</tr>
<tr>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
2.094273
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
1.895316
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
1.733708
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.9
</td>
<td style="text-align:right;">
1.599477
</td>
</tr>
</tbody>
</table>
<p>same as before, still rowwise, but hard code some inputs:</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb243-1" title="1"><span class="co"># Define function, fixed inputs are not parameters, but</span></a>
<a class="sourceLine" id="cb243-2" title="2"><span class="co"># defined earlier as a part of the function</span></a>
<a class="sourceLine" id="cb243-3" title="3"><span class="co"># ar_nN_A, ar_nN_alpha are fixed, not parameters</span></a>
<a class="sourceLine" id="cb243-4" title="4">ffi_linear_dplyrdo_func &lt;-<span class="st"> </span><span class="cf">function</span>(fl_A, fl_alpha){</a>
<a class="sourceLine" id="cb243-5" title="5">  fl_out &lt;-<span class="st"> </span><span class="kw">sum</span>(fl_A<span class="op">*</span>ar_nN_A <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span>(fl_alpha <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span>ar_nN_alpha))</a>
<a class="sourceLine" id="cb243-6" title="6">  <span class="kw">return</span>(fl_out)</a>
<a class="sourceLine" id="cb243-7" title="7">}</a>
<a class="sourceLine" id="cb243-8" title="8"></a>
<a class="sourceLine" id="cb243-9" title="9"><span class="co"># Evaluate function row by row of tibble</span></a>
<a class="sourceLine" id="cb243-10" title="10">tbfunc_A_nN_by_nQ_A_alpha_rowwise =<span class="st"> </span>tb_nN_by_nQ_A_alpha <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb243-11" title="11"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dplyr_eval =</span> <span class="kw">ffi_linear_dplyrdo_func</span>(fl_A, fl_alpha))</a>
<a class="sourceLine" id="cb243-12" title="12"><span class="co"># Show</span></a>
<a class="sourceLine" id="cb243-13" title="13"><span class="kw">kable</span>(tbfunc_A_nN_by_nQ_A_alpha_rowwise) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb243-14" title="14"><span class="st">  </span><span class="kw">kable_styling_fc</span>()</a></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_A
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_alpha
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dplyr_eval
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-2
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
2.346356
</td>
</tr>
<tr>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
2.094273
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
1.895316
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
1.733708
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.9
</td>
<td style="text-align:right;">
1.599477
</td>
</tr>
</tbody>
</table>
</div>
<div id="using-dplyr-mutate-with-pmap" class="section level4">
<h4><span class="header-section-number">3.3.1.5</span> Using Dplyr Mutate with Pmap</h4>
<p>Apparantly <em>rowwise()</em> is not a good idea, and <em>pmap</em> should be used, below is the <em>pmap</em> solution to the problem. Which does seem nicer. Crucially, don’t have to define input parameter names, automatically I think they are matching up to the names in the function</p>
<ul>
<li>dplyr mutate pass function</li>
<li>r function quosure string multiple</li>
<li>r function multiple parameters as one string</li>
<li>dplyr mutate anonymous function</li>
<li>quosure style lambda</li>
<li>pmap tibble rows</li>
<li>dplyr pwalk</li>
</ul>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb244-1" title="1"><span class="co"># Define function, fixed inputs are not parameters, but defined</span></a>
<a class="sourceLine" id="cb244-2" title="2"><span class="co"># earlier as a part of the function Rorate fl_alpha and fl_A name</span></a>
<a class="sourceLine" id="cb244-3" title="3"><span class="co"># compared to before to make sure pmap tracks by names</span></a>
<a class="sourceLine" id="cb244-4" title="4">ffi_linear_dplyrdo_func &lt;-<span class="st"> </span><span class="cf">function</span>(fl_alpha, fl_A){</a>
<a class="sourceLine" id="cb244-5" title="5">  fl_out &lt;-<span class="st"> </span><span class="kw">sum</span>(fl_A<span class="op">*</span>ar_nN_A <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span>(fl_alpha <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span>ar_nN_alpha))</a>
<a class="sourceLine" id="cb244-6" title="6">  <span class="kw">return</span>(fl_out)</a>
<a class="sourceLine" id="cb244-7" title="7">}</a>
<a class="sourceLine" id="cb244-8" title="8"></a>
<a class="sourceLine" id="cb244-9" title="9"><span class="co"># Evaluate a function row by row of dataframe, generate list,</span></a>
<a class="sourceLine" id="cb244-10" title="10"><span class="co"># then to vector</span></a>
<a class="sourceLine" id="cb244-11" title="11">tb_nN_by_nQ_A_alpha <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pmap</span>(ffi_linear_dplyrdo_func) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unlist</span>()</a></code></pre></div>
<pre><code>## [1] 2.346356 2.094273 1.895316 1.733708 1.599477</code></pre>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb246-1" title="1"><span class="co"># Same as above, but in line line and save output as new column</span></a>
<a class="sourceLine" id="cb246-2" title="2"><span class="co"># in dataframe note this ONLY works if the tibble only has variables</span></a>
<a class="sourceLine" id="cb246-3" title="3"><span class="co"># that are inputs for the function if tibble contains additional</span></a>
<a class="sourceLine" id="cb246-4" title="4"><span class="co">#  variables, those should be droppd, or only the ones needed selected,</span></a>
<a class="sourceLine" id="cb246-5" title="5"><span class="co"># inside the pmap call below.</span></a>
<a class="sourceLine" id="cb246-6" title="6">tbfunc_A_nN_by_nQ_A_alpha_pmap &lt;-<span class="st"> </span>tb_nN_by_nQ_A_alpha <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb246-7" title="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dplyr_eval_pmap =</span></a>
<a class="sourceLine" id="cb246-8" title="8">           <span class="kw">unlist</span>(</a>
<a class="sourceLine" id="cb246-9" title="9">             <span class="kw">pmap</span>(tb_nN_by_nQ_A_alpha, ffi_linear_dplyrdo_func)</a>
<a class="sourceLine" id="cb246-10" title="10">           )</a>
<a class="sourceLine" id="cb246-11" title="11">  )</a>
<a class="sourceLine" id="cb246-12" title="12"></a>
<a class="sourceLine" id="cb246-13" title="13"><span class="co"># Show</span></a>
<a class="sourceLine" id="cb246-14" title="14"><span class="kw">kable</span>(tbfunc_A_nN_by_nQ_A_alpha_pmap) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb246-15" title="15"><span class="st">  </span><span class="kw">kable_styling_fc</span>()</a></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_A
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_alpha
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dplyr_eval_pmap
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-2
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
2.346356
</td>
</tr>
<tr>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
2.094273
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
1.895316
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
1.733708
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.9
</td>
<td style="text-align:right;">
1.599477
</td>
</tr>
</tbody>
</table>
</div>
<div id="dplyr-three-types-of-inputs-rowwise" class="section level4">
<h4><span class="header-section-number">3.3.1.6</span> DPLYR Three Types of Inputs ROWWISE</h4>
<p>Now, we have three types of parameters, for something like a bisection type calculation. We will supply the program with a function with some hard-coded value inside, and as parameters, we will have one parameter which is a row in the current matrix, and another parameter which is a sclar values. The three types of parameters are dealt with sparately:</p>
<ol style="list-style-type: decimal">
<li>parameters that are fixed for all bisection iterations, but differ for each row</li>
</ol>
<ul>
<li>these are hard-coded into the function</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>parameters that are fixed for all bisection iterations, but are shared across rows</li>
</ol>
<ul>
<li>these are the first parameter of the function, a list</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>parameters that differ for each iteration, but differ acoss iterations</li>
</ol>
<ul>
<li><p>second scalar value parameter for the function</p></li>
<li><p>dplyr mutate function applow to each row dot notation</p></li>
<li><p>note <a href="https://community.rstudio.com/t/dplyr-alternatives-to-rowwise/8071">rowwise might be bad</a> according to Hadley, should use pmap?</p></li>
</ul>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb247-1" title="1">ffi_linear_dplyrdo_fdot &lt;-<span class="st"> </span><span class="cf">function</span>(ls_row, fl_param){</a>
<a class="sourceLine" id="cb247-2" title="2">  <span class="co"># Type 1 Param = ar_nN_A, ar_nN_alpha</span></a>
<a class="sourceLine" id="cb247-3" title="3">  <span class="co"># Type 2 Param = ls_row$fl_A, ls_row$fl_alpha</span></a>
<a class="sourceLine" id="cb247-4" title="4">  <span class="co"># Type 3 Param = fl_param</span></a>
<a class="sourceLine" id="cb247-5" title="5"></a>
<a class="sourceLine" id="cb247-6" title="6">  fl_out &lt;-<span class="st"> </span>(<span class="kw">sum</span>(ls_row<span class="op">$</span>fl_A<span class="op">*</span>ar_nN_A <span class="op">+</span></a>
<a class="sourceLine" id="cb247-7" title="7"><span class="st">                   </span><span class="dv">1</span><span class="op">/</span>(ls_row<span class="op">$</span>fl_alpha <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span>ar_nN_alpha))) <span class="op">+</span><span class="st"> </span>fl_param</a>
<a class="sourceLine" id="cb247-8" title="8">  <span class="kw">return</span>(fl_out)</a>
<a class="sourceLine" id="cb247-9" title="9">}</a>
<a class="sourceLine" id="cb247-10" title="10"></a>
<a class="sourceLine" id="cb247-11" title="11">cur_func &lt;-<span class="st"> </span>ffi_linear_dplyrdo_fdot</a>
<a class="sourceLine" id="cb247-12" title="12">fl_param &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb247-13" title="13">dplyr_eval_flex &lt;-<span class="st"> </span>tb_nN_by_nQ_A_alpha <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb247-14" title="14"><span class="st">  </span><span class="kw">do</span>(<span class="dt">dplyr_eval_flex =</span> <span class="kw">cur_func</span>(., fl_param)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb247-15" title="15"><span class="st">  </span><span class="kw">unnest</span>(dplyr_eval_flex)</a>
<a class="sourceLine" id="cb247-16" title="16">tbfunc_B_nN_by_nQ_A_alpha &lt;-<span class="st"> </span>tb_nN_by_nQ_A_alpha <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">add_column</span>(dplyr_eval_flex)</a>
<a class="sourceLine" id="cb247-17" title="17"><span class="co"># Show</span></a>
<a class="sourceLine" id="cb247-18" title="18"><span class="kw">kable</span>(tbfunc_B_nN_by_nQ_A_alpha) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb247-19" title="19"><span class="st">  </span><span class="kw">kable_styling_fc</span>()</a></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_A
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_alpha
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
dplyr_eval_flex
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-2
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;">
2.346356
</td>
</tr>
<tr>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:left;">
2.094273
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:left;">
1.895316
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:left;">
1.733708
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.9
</td>
<td style="text-align:left;">
1.599477
</td>
</tr>
</tbody>
</table>
</div>
<div id="compare-apply-and-mutate-results" class="section level4">
<h4><span class="header-section-number">3.3.1.7</span> Compare Apply and Mutate Results</h4>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb248-1" title="1"><span class="co"># Show overall Results</span></a>
<a class="sourceLine" id="cb248-2" title="2">mt_results &lt;-<span class="st"> </span><span class="kw">cbind</span>(ar_func_apply, ar_func_sapply,</a>
<a class="sourceLine" id="cb248-3" title="3">                    tb_nN_by_nQ_A_alpha_show[<span class="st">&#39;dplyr_eval&#39;</span>],</a>
<a class="sourceLine" id="cb248-4" title="4">                    tbfunc_A_nN_by_nQ_A_alpha_rowwise[<span class="st">&#39;dplyr_eval&#39;</span>],</a>
<a class="sourceLine" id="cb248-5" title="5">                    tbfunc_A_nN_by_nQ_A_alpha_pmap[<span class="st">&#39;dplyr_eval_pmap&#39;</span>],</a>
<a class="sourceLine" id="cb248-6" title="6">                    tbfunc_B_nN_by_nQ_A_alpha[<span class="st">&#39;dplyr_eval_flex&#39;</span>],</a>
<a class="sourceLine" id="cb248-7" title="7">                    mt_nN_by_nQ_A_alpha)</a>
<a class="sourceLine" id="cb248-8" title="8"><span class="kw">colnames</span>(mt_results) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;eval_lin_apply&#39;</span>, <span class="st">&#39;eval_lin_sapply&#39;</span>,</a>
<a class="sourceLine" id="cb248-9" title="9">                          <span class="st">&#39;eval_dplyr_mutate&#39;</span>,</a>
<a class="sourceLine" id="cb248-10" title="10">                          <span class="st">&#39;eval_dplyr_mutate_hcode&#39;</span>,</a>
<a class="sourceLine" id="cb248-11" title="11">                          <span class="st">&#39;eval_dplyr_mutate_pmap&#39;</span>,</a>
<a class="sourceLine" id="cb248-12" title="12">                          <span class="st">&#39;eval_dplyr_mutate_flex&#39;</span>,</a>
<a class="sourceLine" id="cb248-13" title="13">                          <span class="st">&#39;A_child&#39;</span>, <span class="st">&#39;alpha_child&#39;</span>)</a>
<a class="sourceLine" id="cb248-14" title="14"><span class="kw">kable</span>(mt_results) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb248-15" title="15"><span class="st">  </span><span class="kw">kable_styling_fc_wide</span>()</a></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:875px; ">
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
eval_lin_apply
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
eval_lin_sapply
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
eval_dplyr_mutate
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
eval_dplyr_mutate_hcode
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
eval_dplyr_mutate_pmap
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
eval_dplyr_mutate_flex
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
A_child
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
alpha_child
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
X1
</td>
<td style="text-align:right;">
2.346356
</td>
<td style="text-align:right;">
2.346356
</td>
<td style="text-align:right;">
2.346356
</td>
<td style="text-align:right;">
2.346356
</td>
<td style="text-align:right;">
2.346356
</td>
<td style="text-align:left;">
2.346356
</td>
<td style="text-align:right;">
-2
</td>
<td style="text-align:right;">
0.1
</td>
</tr>
<tr>
<td style="text-align:left;">
X2
</td>
<td style="text-align:right;">
2.094273
</td>
<td style="text-align:right;">
2.094273
</td>
<td style="text-align:right;">
2.094273
</td>
<td style="text-align:right;">
2.094273
</td>
<td style="text-align:right;">
2.094273
</td>
<td style="text-align:left;">
2.094273
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0.3
</td>
</tr>
<tr>
<td style="text-align:left;">
X3
</td>
<td style="text-align:right;">
1.895316
</td>
<td style="text-align:right;">
1.895316
</td>
<td style="text-align:right;">
1.895316
</td>
<td style="text-align:right;">
1.895316
</td>
<td style="text-align:right;">
1.895316
</td>
<td style="text-align:left;">
1.895316
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.5
</td>
</tr>
<tr>
<td style="text-align:left;">
X4
</td>
<td style="text-align:right;">
1.733708
</td>
<td style="text-align:right;">
1.733708
</td>
<td style="text-align:right;">
1.733708
</td>
<td style="text-align:right;">
1.733708
</td>
<td style="text-align:right;">
1.733708
</td>
<td style="text-align:left;">
1.733708
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.7
</td>
</tr>
<tr>
<td style="text-align:left;">
X5
</td>
<td style="text-align:right;">
1.599477
</td>
<td style="text-align:right;">
1.599477
</td>
<td style="text-align:right;">
1.599477
</td>
<td style="text-align:right;">
1.599477
</td>
<td style="text-align:right;">
1.599477
</td>
<td style="text-align:left;">
1.599477
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.9
</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="summarize-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="panel.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": [["Panel-Data-and-Optimization-with-R.pdf", "PDF"]],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
