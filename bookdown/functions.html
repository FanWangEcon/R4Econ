<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Functions | Data Structures, Estimation and Optimization with R</title>
  <meta name="description" content="Running parallel code in R" />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Functions | Data Structures, Estimation and Optimization with R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Running parallel code in R" />
  <meta name="github-repo" content="fanwangecon/R4Econ" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Functions | Data Structures, Estimation and Optimization with R" />
  
  <meta name="twitter:description" content="Running parallel code in R" />
  

<meta name="author" content="Fan Wang" />


<meta name="date" content="2024-01-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="manipulate-and-summarize-dataframes.html"/>
<link rel="next" href="multi-dimensional-data-structures.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-92953468-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-92953468-5');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Structures and Estimation with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html"><i class="fa fa-check"></i><b>1</b> Array, Matrix, Dataframe</a>
<ul>
<li class="chapter" data-level="1.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#list"><i class="fa fa-check"></i><b>1.1</b> List</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#lists"><i class="fa fa-check"></i><b>1.1.1</b> Lists</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#array"><i class="fa fa-check"></i><b>1.2</b> Array</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#array-basics"><i class="fa fa-check"></i><b>1.2.1</b> Array Basics</a></li>
<li class="chapter" data-level="1.2.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-arrays"><i class="fa fa-check"></i><b>1.2.2</b> Generate Arrays</a></li>
<li class="chapter" data-level="1.2.3" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#string-arrays"><i class="fa fa-check"></i><b>1.2.3</b> String Arrays</a></li>
<li class="chapter" data-level="1.2.4" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#mesh-matrices-arrays-and-scalars"><i class="fa fa-check"></i><b>1.2.4</b> Mesh Matrices, Arrays and Scalars</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#matrix"><i class="fa fa-check"></i><b>1.3</b> Matrix</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-matrixes"><i class="fa fa-check"></i><b>1.3.1</b> Generate Matrixes</a></li>
<li class="chapter" data-level="1.3.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#linear-algebra"><i class="fa fa-check"></i><b>1.3.2</b> Linear Algebra</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#regular-expression-date-etc."><i class="fa fa-check"></i><b>1.4</b> Regular Expression, Date, etc.</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#string-regular-expression"><i class="fa fa-check"></i><b>1.4.1</b> String Regular Expression</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html"><i class="fa fa-check"></i><b>2</b> Manipulate and Summarize Dataframes</a>
<ul>
<li class="chapter" data-level="2.1" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#variables-in-dataframes"><i class="fa fa-check"></i><b>2.1</b> Variables in Dataframes</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#generate-dataframe"><i class="fa fa-check"></i><b>2.1.1</b> Generate Dataframe</a></li>
<li class="chapter" data-level="2.1.2" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#generate-categorical-variables"><i class="fa fa-check"></i><b>2.1.2</b> Generate Categorical Variables</a></li>
<li class="chapter" data-level="2.1.3" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#drawly-random-rows"><i class="fa fa-check"></i><b>2.1.3</b> Drawly Random Rows</a></li>
<li class="chapter" data-level="2.1.4" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#generate-variables-conditional-on-others"><i class="fa fa-check"></i><b>2.1.4</b> Generate Variables Conditional On Others</a></li>
<li class="chapter" data-level="2.1.5" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#string-dataframes"><i class="fa fa-check"></i><b>2.1.5</b> String Dataframes</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#counting-observation"><i class="fa fa-check"></i><b>2.2</b> Counting Observation</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#counting-and-tabulations"><i class="fa fa-check"></i><b>2.2.1</b> Counting and Tabulations</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#sorting-indexing-slicing"><i class="fa fa-check"></i><b>2.3</b> Sorting, Indexing, Slicing</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#sorting-1"><i class="fa fa-check"></i><b>2.3.1</b> Sorting</a></li>
<li class="chapter" data-level="2.3.2" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#group-sort-and-slice"><i class="fa fa-check"></i><b>2.3.2</b> Group, Sort and Slice</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#advanced-group-aggregation"><i class="fa fa-check"></i><b>2.4</b> Advanced Group Aggregation</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#cumulative-statistics-within-group"><i class="fa fa-check"></i><b>2.4.1</b> Cumulative Statistics within Group</a></li>
<li class="chapter" data-level="2.4.2" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#groups-statistics"><i class="fa fa-check"></i><b>2.4.2</b> Groups Statistics</a></li>
<li class="chapter" data-level="2.4.3" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#one-variable-group-summary"><i class="fa fa-check"></i><b>2.4.3</b> One Variable Group Summary</a></li>
<li class="chapter" data-level="2.4.4" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#nested-within-group-stats"><i class="fa fa-check"></i><b>2.4.4</b> Nested within Group Stats</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#distributional-statistics"><i class="fa fa-check"></i><b>2.5</b> Distributional Statistics</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#histogram"><i class="fa fa-check"></i><b>2.5.1</b> Histogram</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#summarize-multiple-variables"><i class="fa fa-check"></i><b>2.6</b> Summarize Multiple Variables</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="manipulate-and-summarize-dataframes.html"><a href="manipulate-and-summarize-dataframes.html#apply-function-over-multiple-columns-and-rows"><i class="fa fa-check"></i><b>2.6.1</b> Apply Function Over Multiple Columns and Rows</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>3</b> Functions</a>
<ul>
<li class="chapter" data-level="3.1" data-path="functions.html"><a href="functions.html#dataframe-mutate"><i class="fa fa-check"></i><b>3.1</b> Dataframe Mutate</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="functions.html"><a href="functions.html#row-input-functions"><i class="fa fa-check"></i><b>3.1.1</b> Row Input Functions</a></li>
<li class="chapter" data-level="3.1.2" data-path="functions.html"><a href="functions.html#evaluate-choices-across-states"><i class="fa fa-check"></i><b>3.1.2</b> Evaluate Choices Across States</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="functions.html"><a href="functions.html#dataframe-do-anything"><i class="fa fa-check"></i><b>3.2</b> Dataframe Do Anything</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="functions.html"><a href="functions.html#mx1-by-n-to-mxq-by-n1"><i class="fa fa-check"></i><b>3.2.1</b> (Mx1 by N) to (MxQ by N+1)</a></li>
<li class="chapter" data-level="3.2.2" data-path="functions.html"><a href="functions.html#mxp-by-n-to-mx1-by-1"><i class="fa fa-check"></i><b>3.2.2</b> (MxP by N) to (Mx1 by 1)</a></li>
<li class="chapter" data-level="3.2.3" data-path="functions.html"><a href="functions.html#mxp-by-n-to-mxq-by-nz"><i class="fa fa-check"></i><b>3.2.3</b> (MxP by N) to (MxQ by N+Z)</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="functions.html"><a href="functions.html#apply-and-pmap"><i class="fa fa-check"></i><b>3.3</b> Apply and pmap</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="functions.html"><a href="functions.html#apply-and-sapply"><i class="fa fa-check"></i><b>3.3.1</b> Apply and Sapply</a></li>
<li class="chapter" data-level="3.3.2" data-path="functions.html"><a href="functions.html#mutate-evaluate-functions"><i class="fa fa-check"></i><b>3.3.2</b> Mutate Evaluate Functions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html"><i class="fa fa-check"></i><b>4</b> Multi-dimensional Data Structures</a>
<ul>
<li class="chapter" data-level="4.1" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#generate-gather-bind-and-join"><i class="fa fa-check"></i><b>4.1</b> Generate, Gather, Bind and Join</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#generate-panel-structure"><i class="fa fa-check"></i><b>4.1.1</b> Generate Panel Structure</a></li>
<li class="chapter" data-level="4.1.2" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#join-datasets"><i class="fa fa-check"></i><b>4.1.2</b> Join Datasets</a></li>
<li class="chapter" data-level="4.1.3" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#gather-files"><i class="fa fa-check"></i><b>4.1.3</b> Gather Files</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#wide-and-long"><i class="fa fa-check"></i><b>4.2</b> Wide and Long</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#long-table-to-wide-table"><i class="fa fa-check"></i><b>4.2.1</b> Long Table to Wide Table</a></li>
<li class="chapter" data-level="4.2.2" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#wide-to-long"><i class="fa fa-check"></i><b>4.2.2</b> Wide to Long</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#within-panel-comparisons-and-statistics"><i class="fa fa-check"></i><b>4.3</b> Within Panel Comparisons and Statistics</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#find-closest-neighbor-on-grid"><i class="fa fa-check"></i><b>4.3.1</b> Find Closest Neighbor on Grid</a></li>
<li class="chapter" data-level="4.3.2" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#within-panel-cross-time-and-cross-group-statistics"><i class="fa fa-check"></i><b>4.3.2</b> Within Panel Cross-time and Cross-group Statistics</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#join-and-merge-files-together-by-keys"><i class="fa fa-check"></i><b>4.4</b> Join and Merge Files Together by Keys</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="multi-dimensional-data-structures.html"><a href="multi-dimensional-data-structures.html#mesh-join"><i class="fa fa-check"></i><b>4.4.1</b> Mesh Join</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i><b>5</b> Linear Regression</a>
<ul>
<li class="chapter" data-level="5.1" data-path="linear-regression.html"><a href="linear-regression.html#linear-and-polynomial-fitting"><i class="fa fa-check"></i><b>5.1</b> Linear and Polynomial Fitting</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="linear-regression.html"><a href="linear-regression.html#fit-curves-through-points"><i class="fa fa-check"></i><b>5.1.1</b> Fit Curves Through Points</a></li>
<li class="chapter" data-level="5.1.2" data-path="linear-regression.html"><a href="linear-regression.html#polynomial-time-series"><i class="fa fa-check"></i><b>5.1.2</b> Polynomial Time Series</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="linear-regression.html"><a href="linear-regression.html#ols-and-iv"><i class="fa fa-check"></i><b>5.2</b> OLS and IV</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="linear-regression.html"><a href="linear-regression.html#ols-and-iv-regression"><i class="fa fa-check"></i><b>5.2.1</b> OLS and IV Regression</a></li>
<li class="chapter" data-level="5.2.2" data-path="linear-regression.html"><a href="linear-regression.html#iv-loop-over-rhs"><i class="fa fa-check"></i><b>5.2.2</b> IV Loop over RHS</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="linear-regression.html"><a href="linear-regression.html#decomposition"><i class="fa fa-check"></i><b>5.3</b> Decomposition</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="linear-regression.html"><a href="linear-regression.html#decompose-rhs"><i class="fa fa-check"></i><b>5.3.1</b> Decompose RHS</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html"><i class="fa fa-check"></i><b>6</b> Nonlinear and Other Regressions</a>
<ul>
<li class="chapter" data-level="6.1" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html#logit-regression"><i class="fa fa-check"></i><b>6.1</b> Logit Regression</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html#binary-logit"><i class="fa fa-check"></i><b>6.1.1</b> Binary Logit</a></li>
<li class="chapter" data-level="6.1.2" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html#logistic-choice-model-with-aggregate-shares"><i class="fa fa-check"></i><b>6.1.2</b> Logistic Choice Model with Aggregate Shares</a></li>
<li class="chapter" data-level="6.1.3" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html#prices-from-aggregate-shares-in-logistic-choice-model"><i class="fa fa-check"></i><b>6.1.3</b> Prices from Aggregate Shares in Logistic Choice Model</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html#quantile-regression"><i class="fa fa-check"></i><b>6.2</b> Quantile Regression</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="nonlinear-and-other-regressions.html"><a href="nonlinear-and-other-regressions.html#quantile-regression-basics"><i class="fa fa-check"></i><b>6.2.1</b> Quantile Regression Basics</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="optimization.html"><a href="optimization.html"><i class="fa fa-check"></i><b>7</b> Optimization</a>
<ul>
<li class="chapter" data-level="7.1" data-path="optimization.html"><a href="optimization.html#grid-based-optimization"><i class="fa fa-check"></i><b>7.1</b> Grid Based Optimization</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="optimization.html"><a href="optimization.html#find-maximum-by-iterating-over-grids"><i class="fa fa-check"></i><b>7.1.1</b> Find Maximum By Iterating Over Grids</a></li>
<li class="chapter" data-level="7.1.2" data-path="optimization.html"><a href="optimization.html#bisection"><i class="fa fa-check"></i><b>7.1.2</b> Bisection</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="mathematics.html"><a href="mathematics.html"><i class="fa fa-check"></i><b>8</b> Mathematics</a>
<ul>
<li class="chapter" data-level="8.1" data-path="mathematics.html"><a href="mathematics.html#basics"><i class="fa fa-check"></i><b>8.1</b> Basics</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="mathematics.html"><a href="mathematics.html#polynomial-formulas-for-points"><i class="fa fa-check"></i><b>8.1.1</b> Polynomial Formulas for Points</a></li>
<li class="chapter" data-level="8.1.2" data-path="mathematics.html"><a href="mathematics.html#rescale-a-parameter-with-fixed-min-and-max"><i class="fa fa-check"></i><b>8.1.2</b> Rescale a Parameter with Fixed Min and Max</a></li>
<li class="chapter" data-level="8.1.3" data-path="mathematics.html"><a href="mathematics.html#log-with-different-bases-and-exponents"><i class="fa fa-check"></i><b>8.1.3</b> Log with Different Bases and Exponents</a></li>
<li class="chapter" data-level="8.1.4" data-path="mathematics.html"><a href="mathematics.html#find-nearest"><i class="fa fa-check"></i><b>8.1.4</b> Find Nearest</a></li>
<li class="chapter" data-level="8.1.5" data-path="mathematics.html"><a href="mathematics.html#linear-scalar-fx0-solutions"><i class="fa fa-check"></i><b>8.1.5</b> Linear Scalar f(x)=0 Solutions</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="mathematics.html"><a href="mathematics.html#production-functions"><i class="fa fa-check"></i><b>8.2</b> Production Functions</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="mathematics.html"><a href="mathematics.html#nested-ces-production-function"><i class="fa fa-check"></i><b>8.2.1</b> Nested CES Production Function</a></li>
<li class="chapter" data-level="8.2.2" data-path="mathematics.html"><a href="mathematics.html#latent-dynamic-health-production-function"><i class="fa fa-check"></i><b>8.2.2</b> Latent Dynamic Health Production Function</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="mathematics.html"><a href="mathematics.html#inequality-models"><i class="fa fa-check"></i><b>8.3</b> Inequality Models</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="mathematics.html"><a href="mathematics.html#gini-discrete-sample"><i class="fa fa-check"></i><b>8.3.1</b> GINI Discrete Sample</a></li>
<li class="chapter" data-level="8.3.2" data-path="mathematics.html"><a href="mathematics.html#gini-formula-for-discrete-random-varialbe"><i class="fa fa-check"></i><b>8.3.2</b> GINI Formula for Discrete Random Varialbe</a></li>
<li class="chapter" data-level="8.3.3" data-path="mathematics.html"><a href="mathematics.html#atkinson-inequality-index"><i class="fa fa-check"></i><b>8.3.3</b> Atkinson Inequality Index</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="statistics.html"><a href="statistics.html"><i class="fa fa-check"></i><b>9</b> Statistics</a>
<ul>
<li class="chapter" data-level="9.1" data-path="statistics.html"><a href="statistics.html#random-draws"><i class="fa fa-check"></i><b>9.1</b> Random Draws</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="statistics.html"><a href="statistics.html#randomly-perturbing-a-parameter"><i class="fa fa-check"></i><b>9.1.1</b> Randomly Perturbing a Parameter</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="statistics.html"><a href="statistics.html#distributions"><i class="fa fa-check"></i><b>9.2</b> Distributions</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="statistics.html"><a href="statistics.html#integrate-over-normal-guassian-process-shock"><i class="fa fa-check"></i><b>9.2.1</b> Integrate Over Normal Guassian Process Shock</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="statistics.html"><a href="statistics.html#discrete-random-variable"><i class="fa fa-check"></i><b>9.3</b> Discrete Random Variable</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="statistics.html"><a href="statistics.html#discrete-approximation-of-continuous-random-variables"><i class="fa fa-check"></i><b>9.3.1</b> Discrete Approximation of Continuous Random Variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html"><i class="fa fa-check"></i><b>10</b> Tables and Graphs</a>
<ul>
<li class="chapter" data-level="10.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#r-base-plots"><i class="fa fa-check"></i><b>10.1</b> R Base Plots</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#plot-curve-line-and-points"><i class="fa fa-check"></i><b>10.1.1</b> Plot Curve, Line and Points</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#ggplot-line-related-plots"><i class="fa fa-check"></i><b>10.2</b> ggplot Line Related Plots</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#ggplot-line-plot-basics"><i class="fa fa-check"></i><b>10.2.1</b> ggplot Line Plot Basics</a></li>
<li class="chapter" data-level="10.2.2" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#ggplot-line-advanced"><i class="fa fa-check"></i><b>10.2.2</b> ggplot Line Advanced</a></li>
<li class="chapter" data-level="10.2.3" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#time-series-plots-with-shaded-areas"><i class="fa fa-check"></i><b>10.2.3</b> Time-series Plots with Shaded Areas</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#ggplot-scatter-related-plots"><i class="fa fa-check"></i><b>10.3</b> ggplot Scatter Related Plots</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#ggplot-scatter-plot"><i class="fa fa-check"></i><b>10.3.1</b> ggplot Scatter Plot</a></li>
<li class="chapter" data-level="10.3.2" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#ggplot-multiple-scatter-lines-with-facet-wrap"><i class="fa fa-check"></i><b>10.3.2</b> ggplot Multiple Scatter-Lines with Facet Wrap</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#write-and-read-plots"><i class="fa fa-check"></i><b>10.4</b> Write and Read Plots</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#import-and-export-images"><i class="fa fa-check"></i><b>10.4.1</b> Import and Export Images</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="get-data.html"><a href="get-data.html"><i class="fa fa-check"></i><b>11</b> Get Data</a>
<ul>
<li class="chapter" data-level="11.1" data-path="get-data.html"><a href="get-data.html#environmental-data"><i class="fa fa-check"></i><b>11.1</b> Environmental Data</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="get-data.html"><a href="get-data.html#ecmwf-era5-data"><i class="fa fa-check"></i><b>11.1.1</b> ECMWF ERA5 Data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="coding-and-development.html"><a href="coding-and-development.html"><i class="fa fa-check"></i><b>12</b> Coding and Development</a>
<ul>
<li class="chapter" data-level="12.1" data-path="coding-and-development.html"><a href="coding-and-development.html#installation-and-packages"><i class="fa fa-check"></i><b>12.1</b> Installation and Packages</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="coding-and-development.html"><a href="coding-and-development.html#r-installation-and-set-up"><i class="fa fa-check"></i><b>12.1.1</b> R Installation and Set-Up</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="coding-and-development.html"><a href="coding-and-development.html#files-in-and-out"><i class="fa fa-check"></i><b>12.2</b> Files In and Out</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="coding-and-development.html"><a href="coding-and-development.html#file-path"><i class="fa fa-check"></i><b>12.2.1</b> File Path</a></li>
<li class="chapter" data-level="12.2.2" data-path="coding-and-development.html"><a href="coding-and-development.html#text-to-file"><i class="fa fa-check"></i><b>12.2.2</b> Text to File</a></li>
<li class="chapter" data-level="12.2.3" data-path="coding-and-development.html"><a href="coding-and-development.html#rmd-to-html"><i class="fa fa-check"></i><b>12.2.3</b> Rmd to HTML</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="coding-and-development.html"><a href="coding-and-development.html#python-with-r"><i class="fa fa-check"></i><b>12.3</b> Python with R</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="coding-and-development.html"><a href="coding-and-development.html#reticulate-basics"><i class="fa fa-check"></i><b>12.3.1</b> Reticulate Basics</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="coding-and-development.html"><a href="coding-and-development.html#command-line"><i class="fa fa-check"></i><b>12.4</b> Command Line</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="coding-and-development.html"><a href="coding-and-development.html#shell-and-system-commands"><i class="fa fa-check"></i><b>12.4.1</b> Shell and System Commands</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="coding-and-development.html"><a href="coding-and-development.html#run-code-in-parallel-in-r"><i class="fa fa-check"></i><b>12.5</b> Run Code in Parallel in R</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="coding-and-development.html"><a href="coding-and-development.html#parallel-loop-in-r"><i class="fa fa-check"></i><b>12.5.1</b> Parallel Loop in R</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="index-and-code-links.html"><a href="index-and-code-links.html"><i class="fa fa-check"></i><b>A</b> Index and Code Links</a>
<ul>
<li class="chapter" data-level="A.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#array-matrix-dataframe-links"><i class="fa fa-check"></i><b>A.1</b> Array, Matrix, Dataframe links</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.1-listlist-links"><i class="fa fa-check"></i><b>A.1.1</b> Section 1.1 List links</a></li>
<li class="chapter" data-level="A.1.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.2-arrayarray-links"><i class="fa fa-check"></i><b>A.1.2</b> Section 1.2 Array links</a></li>
<li class="chapter" data-level="A.1.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.3-matrixmatrix-links"><i class="fa fa-check"></i><b>A.1.3</b> Section 1.3 Matrix links</a></li>
<li class="chapter" data-level="A.1.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.4-regular-expression-date-etc.regular-expression-date-etc.-links"><i class="fa fa-check"></i><b>A.1.4</b> Section 1.4 Regular Expression, Date, etc. links</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#manipulate-and-summarize-dataframes-links"><i class="fa fa-check"></i><b>A.2</b> Manipulate and Summarize Dataframes links</a>
<ul>
<li class="chapter" data-level="A.2.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.1-variables-in-dataframesvariables-in-dataframes-links"><i class="fa fa-check"></i><b>A.2.1</b> Section 2.1 Variables in Dataframes links</a></li>
<li class="chapter" data-level="A.2.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.2-counting-observationcounting-observation-links"><i class="fa fa-check"></i><b>A.2.2</b> Section 2.2 Counting Observation links</a></li>
<li class="chapter" data-level="A.2.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.3-sorting-indexing-slicingsorting-indexing-slicing-links"><i class="fa fa-check"></i><b>A.2.3</b> Section 2.3 Sorting, Indexing, Slicing links</a></li>
<li class="chapter" data-level="A.2.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.4-advanced-group-aggregationadvanced-group-aggregation-links"><i class="fa fa-check"></i><b>A.2.4</b> Section 2.4 Advanced Group Aggregation links</a></li>
<li class="chapter" data-level="A.2.5" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.5-distributional-statisticsdistributional-statistics-links"><i class="fa fa-check"></i><b>A.2.5</b> Section 2.5 Distributional Statistics links</a></li>
<li class="chapter" data-level="A.2.6" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.6-summarize-multiple-variablessummarize-multiple-variables-links"><i class="fa fa-check"></i><b>A.2.6</b> Section 2.6 Summarize Multiple Variables links</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#functions-links"><i class="fa fa-check"></i><b>A.3</b> Functions links</a>
<ul>
<li class="chapter" data-level="A.3.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.1-dataframe-mutatedataframe-mutate-links"><i class="fa fa-check"></i><b>A.3.1</b> Section 3.1 Dataframe Mutate links</a></li>
<li class="chapter" data-level="A.3.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.2-dataframe-do-anythingdataframe-do-anything-links"><i class="fa fa-check"></i><b>A.3.2</b> Section 3.2 Dataframe Do Anything links</a></li>
<li class="chapter" data-level="A.3.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.3-apply-and-pmapapply-and-pmap-links"><i class="fa fa-check"></i><b>A.3.3</b> Section 3.3 Apply and pmap links</a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#multi-dimensional-data-structures-links"><i class="fa fa-check"></i><b>A.4</b> Multi-dimensional Data Structures links</a>
<ul>
<li class="chapter" data-level="A.4.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-4.1-generate-gather-bind-and-joingenerate-gather-bind-and-join-links"><i class="fa fa-check"></i><b>A.4.1</b> Section 4.1 Generate, Gather, Bind and Join links</a></li>
<li class="chapter" data-level="A.4.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-4.2-wide-and-longwide-and-long-links"><i class="fa fa-check"></i><b>A.4.2</b> Section 4.2 Wide and Long links</a></li>
<li class="chapter" data-level="A.4.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-4.3-within-panel-comparisons-and-statisticswithin-panel-comparisons-and-statistics-links"><i class="fa fa-check"></i><b>A.4.3</b> Section 4.3 Within Panel Comparisons and Statistics links</a></li>
<li class="chapter" data-level="A.4.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-4.4-join-and-merge-files-together-by-keysjoin-and-merge-files-together-by-keys-links"><i class="fa fa-check"></i><b>A.4.4</b> Section 4.4 Join and Merge Files Together by Keys links</a></li>
</ul></li>
<li class="chapter" data-level="A.5" data-path="index-and-code-links.html"><a href="index-and-code-links.html#linear-regression-links"><i class="fa fa-check"></i><b>A.5</b> Linear Regression links</a>
<ul>
<li class="chapter" data-level="A.5.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-5.1-linear-and-polynomial-fittinglinear-and-polynomial-fitting-links"><i class="fa fa-check"></i><b>A.5.1</b> Section 5.1 Linear and Polynomial Fitting links</a></li>
<li class="chapter" data-level="A.5.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-5.2-ols-and-ivols-and-iv-links"><i class="fa fa-check"></i><b>A.5.2</b> Section 5.2 OLS and IV links</a></li>
<li class="chapter" data-level="A.5.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-5.3-decompositiondecomposition-links"><i class="fa fa-check"></i><b>A.5.3</b> Section 5.3 Decomposition links</a></li>
</ul></li>
<li class="chapter" data-level="A.6" data-path="index-and-code-links.html"><a href="index-and-code-links.html#nonlinear-and-other-regressions-links"><i class="fa fa-check"></i><b>A.6</b> Nonlinear and Other Regressions links</a>
<ul>
<li class="chapter" data-level="A.6.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-6.1-logit-regressionlogit-regression-links"><i class="fa fa-check"></i><b>A.6.1</b> Section 6.1 Logit Regression links</a></li>
<li class="chapter" data-level="A.6.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-6.2-quantile-regressionquantile-regression-links"><i class="fa fa-check"></i><b>A.6.2</b> Section 6.2 Quantile Regression links</a></li>
</ul></li>
<li class="chapter" data-level="A.7" data-path="index-and-code-links.html"><a href="index-and-code-links.html#optimization-links"><i class="fa fa-check"></i><b>A.7</b> Optimization links</a>
<ul>
<li class="chapter" data-level="A.7.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-7.1-grid-based-optimizationgrid-based-optimization-links"><i class="fa fa-check"></i><b>A.7.1</b> Section 7.1 Grid Based Optimization links</a></li>
</ul></li>
<li class="chapter" data-level="A.8" data-path="index-and-code-links.html"><a href="index-and-code-links.html#mathematics-links"><i class="fa fa-check"></i><b>A.8</b> Mathematics links</a>
<ul>
<li class="chapter" data-level="A.8.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-8.1-basicsbasics-links"><i class="fa fa-check"></i><b>A.8.1</b> Section 8.1 Basics links</a></li>
<li class="chapter" data-level="A.8.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-8.2-production-functionsproduction-functions-links"><i class="fa fa-check"></i><b>A.8.2</b> Section 8.2 Production Functions links</a></li>
<li class="chapter" data-level="A.8.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-8.3-inequality-modelsinequality-models-links"><i class="fa fa-check"></i><b>A.8.3</b> Section 8.3 Inequality Models links</a></li>
</ul></li>
<li class="chapter" data-level="A.9" data-path="index-and-code-links.html"><a href="index-and-code-links.html#statistics-links"><i class="fa fa-check"></i><b>A.9</b> Statistics links</a>
<ul>
<li class="chapter" data-level="A.9.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-9.1-random-drawsrandom-draws-links"><i class="fa fa-check"></i><b>A.9.1</b> Section 9.1 Random Draws links</a></li>
<li class="chapter" data-level="A.9.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-9.2-distributionsdistributions-links"><i class="fa fa-check"></i><b>A.9.2</b> Section 9.2 Distributions links</a></li>
<li class="chapter" data-level="A.9.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-9.3-discrete-random-variablediscrete-random-variable-links"><i class="fa fa-check"></i><b>A.9.3</b> Section 9.3 Discrete Random Variable links</a></li>
</ul></li>
<li class="chapter" data-level="A.10" data-path="index-and-code-links.html"><a href="index-and-code-links.html#tables-and-graphs-links"><i class="fa fa-check"></i><b>A.10</b> Tables and Graphs links</a>
<ul>
<li class="chapter" data-level="A.10.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-10.1-r-base-plotsr-base-plots-links"><i class="fa fa-check"></i><b>A.10.1</b> Section 10.1 R Base Plots links</a></li>
<li class="chapter" data-level="A.10.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-10.2-ggplot-line-related-plotsggplot-line-related-plots-links"><i class="fa fa-check"></i><b>A.10.2</b> Section 10.2 ggplot Line Related Plots links</a></li>
<li class="chapter" data-level="A.10.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-10.3-ggplot-scatter-related-plotsggplot-scatter-related-plots-links"><i class="fa fa-check"></i><b>A.10.3</b> Section 10.3 ggplot Scatter Related Plots links</a></li>
<li class="chapter" data-level="A.10.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-10.4-write-and-read-plotswrite-and-read-plots-links"><i class="fa fa-check"></i><b>A.10.4</b> Section 10.4 Write and Read Plots links</a></li>
</ul></li>
<li class="chapter" data-level="A.11" data-path="index-and-code-links.html"><a href="index-and-code-links.html#get-data-links"><i class="fa fa-check"></i><b>A.11</b> Get Data links</a>
<ul>
<li class="chapter" data-level="A.11.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-11.1-environmental-dataenvironmental-data-links"><i class="fa fa-check"></i><b>A.11.1</b> Section 11.1 Environmental Data links</a></li>
</ul></li>
<li class="chapter" data-level="A.12" data-path="index-and-code-links.html"><a href="index-and-code-links.html#coding-and-development-links"><i class="fa fa-check"></i><b>A.12</b> Coding and Development links</a>
<ul>
<li class="chapter" data-level="A.12.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-12.1-installation-and-packagesinstallation-and-packages-links"><i class="fa fa-check"></i><b>A.12.1</b> Section 12.1 Installation and Packages links</a></li>
<li class="chapter" data-level="A.12.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-12.2-files-in-and-outfiles-in-and-out-links"><i class="fa fa-check"></i><b>A.12.2</b> Section 12.2 Files In and Out links</a></li>
<li class="chapter" data-level="A.12.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-12.3-python-with-rpython-with-r-links"><i class="fa fa-check"></i><b>A.12.3</b> Section 12.3 Python with R links</a></li>
<li class="chapter" data-level="A.12.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-12.4-command-linecommand-line-links"><i class="fa fa-check"></i><b>A.12.4</b> Section 12.4 Command Line links</a></li>
<li class="chapter" data-level="A.12.5" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-12.5-run-code-in-parallel-in-rrun-code-in-parallel-in-r-links"><i class="fa fa-check"></i><b>A.12.5</b> Section 12.5 Run Code in Parallel in R links</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://fanwangecon.github.io/R4Econ/bookdown/index.html" target="blank">R4Econ Bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Structures, Estimation and Optimization with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="functions" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Chapter 3</span> Functions<a href="functions.html#functions" class="anchor-section" aria-label="Anchor link to header"></a></h1>

<div id="dataframe-mutate" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Dataframe Mutate<a href="functions.html#dataframe-mutate" class="anchor-section" aria-label="Anchor link to header"></a></h2>

<div id="row-input-functions" class="section level3 hasAnchor" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Row Input Functions<a href="functions.html#row-input-functions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> research support package, <a href="https://fanwangecon.github.io/R4Econ/">R4Econ</a> examples page, <a href="https://fanwangecon.github.io/PkgTestR/">PkgTestR</a> packaging guide, or <a href="https://fanwangecon.github.io/Stat4Econ/">Stat4Econ</a> course page.</p>
</blockquote>
<p>We want evaluate nonlinear function f(Q_i, y_i, ar_x, ar_y, c, d), where c and d are constants, and ar_x and ar_y are arrays, both fixed. x_i and y_i vary over each row of matrix. We would like to evaluate this nonlinear function concurrently across <span class="math inline">\(N\)</span> individuals. The eventual goal is to find the <span class="math inline">\(i\)</span> specific <span class="math inline">\(Q\)</span> that solves the nonlinear equations.</p>
<p>This is a continuation of <a href="https://fanwangecon.github.io/R4Econ/function/noloop/fs_applysapplymutate.html">R use Apply, Sapply and dplyr Mutate to Evaluate one Function Across Rows of a Matrix</a></p>
<div id="set-up-input-arrays" class="section level4 hasAnchor" number="3.1.1.1">
<h4><span class="header-section-number">3.1.1.1</span> Set up Input Arrays<a href="functions.html#set-up-input-arrays" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>There is a function that takes <span class="math inline">\(M=Q+P\)</span> inputs, we want to evaluate this function <span class="math inline">\(N\)</span> times. Each time, there are <span class="math inline">\(M\)</span> inputs, where all but <span class="math inline">\(Q\)</span> of the <span class="math inline">\(M\)</span> inputs, meaning <span class="math inline">\(P\)</span> of the <span class="math inline">\(M\)</span> inputs, are the same. In particular, <span class="math inline">\(P=Q*N\)</span>.</p>
<p><span class="math display">\[M = Q+P = Q + Q*N\]</span></p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="functions.html#cb336-1" tabindex="-1"></a><span class="co"># it_child_count = N, the number of children</span></span>
<span id="cb336-2"><a href="functions.html#cb336-2" tabindex="-1"></a>it_N_child_cnt <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb336-3"><a href="functions.html#cb336-3" tabindex="-1"></a><span class="co"># it_heter_param = Q, number of parameters that are heterogeneous across children</span></span>
<span id="cb336-4"><a href="functions.html#cb336-4" tabindex="-1"></a>it_Q_hetpa_cnt <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb336-5"><a href="functions.html#cb336-5" tabindex="-1"></a></span>
<span id="cb336-6"><a href="functions.html#cb336-6" tabindex="-1"></a><span class="co"># P fixed parameters, nN is N dimensional, nP is P dimensional</span></span>
<span id="cb336-7"><a href="functions.html#cb336-7" tabindex="-1"></a>ar_nN_A <span class="ot">=</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="at">length.out =</span> it_N_child_cnt)</span>
<span id="cb336-8"><a href="functions.html#cb336-8" tabindex="-1"></a>ar_nN_alpha <span class="ot">=</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="at">length.out =</span> it_N_child_cnt)</span>
<span id="cb336-9"><a href="functions.html#cb336-9" tabindex="-1"></a>ar_nP_A_alpha <span class="ot">=</span> <span class="fu">c</span>(ar_nN_A, ar_nN_alpha)</span>
<span id="cb336-10"><a href="functions.html#cb336-10" tabindex="-1"></a>ar_nN_N_choice <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">1</span>,it_N_child_cnt)<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">seq</span>(<span class="dv">1</span>,it_N_child_cnt))</span>
<span id="cb336-11"><a href="functions.html#cb336-11" tabindex="-1"></a></span>
<span id="cb336-12"><a href="functions.html#cb336-12" tabindex="-1"></a><span class="co"># N by Q varying parameters</span></span>
<span id="cb336-13"><a href="functions.html#cb336-13" tabindex="-1"></a>mt_nN_by_nQ_A_alpha <span class="ot">=</span> <span class="fu">cbind</span>(ar_nN_A, ar_nN_alpha, ar_nN_N_choice)</span>
<span id="cb336-14"><a href="functions.html#cb336-14" tabindex="-1"></a></span>
<span id="cb336-15"><a href="functions.html#cb336-15" tabindex="-1"></a><span class="co"># Convert Matrix to Tibble</span></span>
<span id="cb336-16"><a href="functions.html#cb336-16" tabindex="-1"></a>ar_st_col_names <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;fl_A&#39;</span>, <span class="st">&#39;fl_alpha&#39;</span>, <span class="st">&#39;fl_N&#39;</span>)</span>
<span id="cb336-17"><a href="functions.html#cb336-17" tabindex="-1"></a>tb_nN_by_nQ_A_alpha <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(mt_nN_by_nQ_A_alpha) <span class="sc">%&gt;%</span> <span class="fu">rename_all</span>(<span class="sc">~</span><span class="fu">c</span>(ar_st_col_names))</span>
<span id="cb336-18"><a href="functions.html#cb336-18" tabindex="-1"></a></span>
<span id="cb336-19"><a href="functions.html#cb336-19" tabindex="-1"></a><span class="co"># Show</span></span>
<span id="cb336-20"><a href="functions.html#cb336-20" tabindex="-1"></a><span class="fu">kable</span>(tb_nN_by_nQ_A_alpha) <span class="sc">%&gt;%</span></span>
<span id="cb336-21"><a href="functions.html#cb336-21" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_A
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_alpha
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_N
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-2
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
0.0666667
</td>
</tr>
<tr>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
0.1333333
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.2000000
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
0.2666667
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.9
</td>
<td style="text-align:right;">
0.3333333
</td>
</tr>
</tbody>
</table>
</div>
<div id="mutate-over-simple-function" class="section level4 hasAnchor" number="3.1.1.2">
<h4><span class="header-section-number">3.1.1.2</span> Mutate over Simple Function<a href="functions.html#mutate-over-simple-function" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For this example, use a very simple function with only one type of input, all inputs are scalars.</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="functions.html#cb337-1" tabindex="-1"></a><span class="co"># Define Implicit Function</span></span>
<span id="cb337-2"><a href="functions.html#cb337-2" tabindex="-1"></a>ffi_nonlinear <span class="ot">&lt;-</span> <span class="cf">function</span>(fl_A, fl_alpha){</span>
<span id="cb337-3"><a href="functions.html#cb337-3" tabindex="-1"></a></span>
<span id="cb337-4"><a href="functions.html#cb337-4" tabindex="-1"></a>  fl_out <span class="ot">&lt;-</span> (fl_A <span class="sc">+</span> fl_alpha<span class="sc">*</span>fl_A)<span class="sc">/</span>(fl_A)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb337-5"><a href="functions.html#cb337-5" tabindex="-1"></a></span>
<span id="cb337-6"><a href="functions.html#cb337-6" tabindex="-1"></a>  <span class="fu">return</span>(fl_out)</span>
<span id="cb337-7"><a href="functions.html#cb337-7" tabindex="-1"></a>}</span></code></pre></div>
<p>Apply the function over the dataframe, note five different ways below, the third way allows for parameters to be strings.</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="functions.html#cb338-1" tabindex="-1"></a><span class="co"># variable names</span></span>
<span id="cb338-2"><a href="functions.html#cb338-2" tabindex="-1"></a>svr_fl_A <span class="ot">&lt;-</span> <span class="st">&#39;fl_A&#39;</span></span>
<span id="cb338-3"><a href="functions.html#cb338-3" tabindex="-1"></a>svr_fl_alpha <span class="ot">&lt;-</span> <span class="st">&#39;fl_alpha&#39;</span></span>
<span id="cb338-4"><a href="functions.html#cb338-4" tabindex="-1"></a></span>
<span id="cb338-5"><a href="functions.html#cb338-5" tabindex="-1"></a><span class="co"># Evaluate</span></span>
<span id="cb338-6"><a href="functions.html#cb338-6" tabindex="-1"></a>tb_nN_by_nQ_A_alpha_mutate_rows <span class="ot">&lt;-</span> tb_nN_by_nQ_A_alpha <span class="sc">%&gt;%</span></span>
<span id="cb338-7"><a href="functions.html#cb338-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fl_out_m1 =</span> <span class="fu">ffi_nonlinear</span>(<span class="at">fl_A=</span>.<span class="sc">$</span>fl_A, <span class="at">fl_alpha=</span>.<span class="sc">$</span>fl_alpha),</span>
<span id="cb338-8"><a href="functions.html#cb338-8" tabindex="-1"></a>         <span class="at">fl_out_m2 =</span> <span class="fu">ffi_nonlinear</span>(<span class="at">fl_A=</span><span class="st">`</span><span class="at">$</span><span class="st">`</span>(., <span class="st">&#39;fl_A&#39;</span>), <span class="at">fl_alpha=</span><span class="st">`</span><span class="at">$</span><span class="st">`</span>(., <span class="st">&#39;fl_alpha&#39;</span>)),</span>
<span id="cb338-9"><a href="functions.html#cb338-9" tabindex="-1"></a>         <span class="at">fl_out_m3 =</span> <span class="fu">ffi_nonlinear</span>(<span class="at">fl_A=</span>.[[svr_fl_A]], <span class="at">fl_alpha=</span>.[[svr_fl_alpha]]),</span>
<span id="cb338-10"><a href="functions.html#cb338-10" tabindex="-1"></a>         <span class="at">fl_out_m4 =</span> <span class="fu">ffi_nonlinear</span>(<span class="at">fl_A=</span>fl_A, <span class="at">fl_alpha=</span>fl_alpha),</span>
<span id="cb338-11"><a href="functions.html#cb338-11" tabindex="-1"></a>         <span class="at">fl_out_m5 =</span> <span class="fu">ffi_nonlinear</span>(fl_A, fl_alpha))</span>
<span id="cb338-12"><a href="functions.html#cb338-12" tabindex="-1"></a></span>
<span id="cb338-13"><a href="functions.html#cb338-13" tabindex="-1"></a><span class="co"># print</span></span>
<span id="cb338-14"><a href="functions.html#cb338-14" tabindex="-1"></a><span class="fu">kable</span>(tb_nN_by_nQ_A_alpha_mutate_rows) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_A
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_alpha
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_N
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_out_m1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_out_m2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_out_m3
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_out_m4
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_out_m5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-2
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
0.0666667
</td>
<td style="text-align:right;">
-0.55
</td>
<td style="text-align:right;">
-0.55
</td>
<td style="text-align:right;">
-0.55
</td>
<td style="text-align:right;">
-0.55
</td>
<td style="text-align:right;">
-0.55
</td>
</tr>
<tr>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
0.1333333
</td>
<td style="text-align:right;">
-1.30
</td>
<td style="text-align:right;">
-1.30
</td>
<td style="text-align:right;">
-1.30
</td>
<td style="text-align:right;">
-1.30
</td>
<td style="text-align:right;">
-1.30
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.2000000
</td>
<td style="text-align:right;">
NaN
</td>
<td style="text-align:right;">
NaN
</td>
<td style="text-align:right;">
NaN
</td>
<td style="text-align:right;">
NaN
</td>
<td style="text-align:right;">
NaN
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
0.2666667
</td>
<td style="text-align:right;">
1.70
</td>
<td style="text-align:right;">
1.70
</td>
<td style="text-align:right;">
1.70
</td>
<td style="text-align:right;">
1.70
</td>
<td style="text-align:right;">
1.70
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.9
</td>
<td style="text-align:right;">
0.3333333
</td>
<td style="text-align:right;">
0.95
</td>
<td style="text-align:right;">
0.95
</td>
<td style="text-align:right;">
0.95
</td>
<td style="text-align:right;">
0.95
</td>
<td style="text-align:right;">
0.95
</td>
</tr>
</tbody>
</table>
</div>
<div id="testing-function-with-scalar-and-arrays" class="section level4 hasAnchor" number="3.1.1.3">
<h4><span class="header-section-number">3.1.1.3</span> Testing Function with Scalar and Arrays<a href="functions.html#testing-function-with-scalar-and-arrays" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Test non-linear Equation.</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="functions.html#cb339-1" tabindex="-1"></a><span class="co"># Test Parameters</span></span>
<span id="cb339-2"><a href="functions.html#cb339-2" tabindex="-1"></a>fl_N_agg <span class="ot">=</span> <span class="dv">100</span></span>
<span id="cb339-3"><a href="functions.html#cb339-3" tabindex="-1"></a>fl_rho <span class="ot">=</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb339-4"><a href="functions.html#cb339-4" tabindex="-1"></a>fl_N_q <span class="ot">=</span> ar_nN_N_choice[<span class="dv">4</span>]<span class="sc">*</span>fl_N_agg</span>
<span id="cb339-5"><a href="functions.html#cb339-5" tabindex="-1"></a>ar_A_alpha <span class="ot">=</span> mt_nN_by_nQ_A_alpha[<span class="dv">4</span>,]</span>
<span id="cb339-6"><a href="functions.html#cb339-6" tabindex="-1"></a><span class="co"># Apply Function</span></span>
<span id="cb339-7"><a href="functions.html#cb339-7" tabindex="-1"></a>ar_p1_s1 <span class="ot">=</span> <span class="fu">exp</span>((ar_A_alpha[<span class="dv">1</span>] <span class="sc">-</span> ar_nN_A)<span class="sc">*</span>fl_rho)</span>
<span id="cb339-8"><a href="functions.html#cb339-8" tabindex="-1"></a>ar_p1_s2 <span class="ot">=</span> (ar_A_alpha[<span class="dv">2</span>]<span class="sc">/</span>ar_nN_alpha)</span>
<span id="cb339-9"><a href="functions.html#cb339-9" tabindex="-1"></a>ar_p1_s3 <span class="ot">=</span> (<span class="dv">1</span><span class="sc">/</span>(ar_nN_alpha<span class="sc">*</span>fl_rho <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb339-10"><a href="functions.html#cb339-10" tabindex="-1"></a>ar_p1 <span class="ot">=</span> (ar_p1_s1<span class="sc">*</span>ar_p1_s2)<span class="sc">^</span>ar_p1_s3</span>
<span id="cb339-11"><a href="functions.html#cb339-11" tabindex="-1"></a>ar_p2 <span class="ot">=</span> fl_N_q<span class="sc">^</span>((ar_A_alpha[<span class="dv">2</span>]<span class="sc">*</span>fl_rho<span class="dv">-1</span>)<span class="sc">/</span>(ar_nN_alpha<span class="sc">*</span>fl_rho<span class="dv">-1</span>))</span>
<span id="cb339-12"><a href="functions.html#cb339-12" tabindex="-1"></a>ar_overall <span class="ot">=</span> ar_p1<span class="sc">*</span>ar_p2</span>
<span id="cb339-13"><a href="functions.html#cb339-13" tabindex="-1"></a>fl_overall <span class="ot">=</span> fl_N_agg <span class="sc">-</span> <span class="fu">sum</span>(ar_overall)</span>
<span id="cb339-14"><a href="functions.html#cb339-14" tabindex="-1"></a><span class="fu">print</span>(fl_overall)</span></code></pre></div>
<pre><code>## [1] -598.2559</code></pre>
<p>Implement the non-linear problem’s evaluation using apply over all <span class="math inline">\(N\)</span> individuals.</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="functions.html#cb341-1" tabindex="-1"></a><span class="co"># Define Implicit Function</span></span>
<span id="cb341-2"><a href="functions.html#cb341-2" tabindex="-1"></a>ffi_nonlin_dplyrdo <span class="ot">&lt;-</span> <span class="cf">function</span>(fl_A, fl_alpha, fl_N, ar_A, ar_alpha, fl_N_agg, fl_rho){</span>
<span id="cb341-3"><a href="functions.html#cb341-3" tabindex="-1"></a>  <span class="co"># ar_A_alpha[1] is A</span></span>
<span id="cb341-4"><a href="functions.html#cb341-4" tabindex="-1"></a>  <span class="co"># ar_A_alpha[2] is alpha</span></span>
<span id="cb341-5"><a href="functions.html#cb341-5" tabindex="-1"></a></span>
<span id="cb341-6"><a href="functions.html#cb341-6" tabindex="-1"></a>  <span class="co"># # Test Parameters</span></span>
<span id="cb341-7"><a href="functions.html#cb341-7" tabindex="-1"></a>  <span class="co"># fl_N = 100</span></span>
<span id="cb341-8"><a href="functions.html#cb341-8" tabindex="-1"></a>  <span class="co"># fl_rho = -1</span></span>
<span id="cb341-9"><a href="functions.html#cb341-9" tabindex="-1"></a>  <span class="co"># fl_N_q = 10</span></span>
<span id="cb341-10"><a href="functions.html#cb341-10" tabindex="-1"></a></span>
<span id="cb341-11"><a href="functions.html#cb341-11" tabindex="-1"></a>  <span class="co"># Apply Function</span></span>
<span id="cb341-12"><a href="functions.html#cb341-12" tabindex="-1"></a>  ar_p1_s1 <span class="ot">=</span> <span class="fu">exp</span>((fl_A <span class="sc">-</span> ar_A)<span class="sc">*</span>fl_rho)</span>
<span id="cb341-13"><a href="functions.html#cb341-13" tabindex="-1"></a>  ar_p1_s2 <span class="ot">=</span> (fl_alpha<span class="sc">/</span>ar_alpha)</span>
<span id="cb341-14"><a href="functions.html#cb341-14" tabindex="-1"></a>  ar_p1_s3 <span class="ot">=</span> (<span class="dv">1</span><span class="sc">/</span>(ar_alpha<span class="sc">*</span>fl_rho <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb341-15"><a href="functions.html#cb341-15" tabindex="-1"></a>  ar_p1 <span class="ot">=</span> (ar_p1_s1<span class="sc">*</span>ar_p1_s2)<span class="sc">^</span>ar_p1_s3</span>
<span id="cb341-16"><a href="functions.html#cb341-16" tabindex="-1"></a>  ar_p2 <span class="ot">=</span> fl_N<span class="sc">^</span>((fl_alpha<span class="sc">*</span>fl_rho<span class="dv">-1</span>)<span class="sc">/</span>(ar_alpha<span class="sc">*</span>fl_rho<span class="dv">-1</span>))</span>
<span id="cb341-17"><a href="functions.html#cb341-17" tabindex="-1"></a>  ar_overall <span class="ot">=</span> ar_p1<span class="sc">*</span>ar_p2</span>
<span id="cb341-18"><a href="functions.html#cb341-18" tabindex="-1"></a>  fl_overall <span class="ot">=</span> fl_N_agg <span class="sc">-</span> <span class="fu">sum</span>(ar_overall)</span>
<span id="cb341-19"><a href="functions.html#cb341-19" tabindex="-1"></a></span>
<span id="cb341-20"><a href="functions.html#cb341-20" tabindex="-1"></a>  <span class="fu">return</span>(fl_overall)</span>
<span id="cb341-21"><a href="functions.html#cb341-21" tabindex="-1"></a>}</span>
<span id="cb341-22"><a href="functions.html#cb341-22" tabindex="-1"></a></span>
<span id="cb341-23"><a href="functions.html#cb341-23" tabindex="-1"></a><span class="co"># Parameters</span></span>
<span id="cb341-24"><a href="functions.html#cb341-24" tabindex="-1"></a>fl_rho <span class="ot">=</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb341-25"><a href="functions.html#cb341-25" tabindex="-1"></a></span>
<span id="cb341-26"><a href="functions.html#cb341-26" tabindex="-1"></a><span class="co"># Evaluate Function</span></span>
<span id="cb341-27"><a href="functions.html#cb341-27" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">ffi_nonlin_dplyrdo</span>(mt_nN_by_nQ_A_alpha[<span class="dv">1</span>,<span class="dv">1</span>],</span>
<span id="cb341-28"><a href="functions.html#cb341-28" tabindex="-1"></a>                         mt_nN_by_nQ_A_alpha[<span class="dv">1</span>,<span class="dv">2</span>],</span>
<span id="cb341-29"><a href="functions.html#cb341-29" tabindex="-1"></a>                         mt_nN_by_nQ_A_alpha[<span class="dv">1</span>,<span class="dv">3</span>]<span class="sc">*</span>fl_N_agg,</span>
<span id="cb341-30"><a href="functions.html#cb341-30" tabindex="-1"></a>                         ar_nN_A, ar_nN_alpha, fl_N_agg, fl_rho))</span></code></pre></div>
<pre><code>## [1] 81.86645</code></pre>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="functions.html#cb343-1" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">dim</span>(mt_nN_by_nQ_A_alpha)[<span class="dv">1</span>])){</span>
<span id="cb343-2"><a href="functions.html#cb343-2" tabindex="-1"></a>  fl_eval <span class="ot">=</span> <span class="fu">ffi_nonlin_dplyrdo</span>(mt_nN_by_nQ_A_alpha[i,<span class="dv">1</span>],</span>
<span id="cb343-3"><a href="functions.html#cb343-3" tabindex="-1"></a>                               mt_nN_by_nQ_A_alpha[i,<span class="dv">2</span>],</span>
<span id="cb343-4"><a href="functions.html#cb343-4" tabindex="-1"></a>                               mt_nN_by_nQ_A_alpha[i,<span class="dv">3</span>]<span class="sc">*</span>fl_N_agg,</span>
<span id="cb343-5"><a href="functions.html#cb343-5" tabindex="-1"></a>                               ar_nN_A, ar_nN_alpha, fl_N_agg, fl_rho)</span>
<span id="cb343-6"><a href="functions.html#cb343-6" tabindex="-1"></a>  <span class="fu">print</span>(fl_eval)</span>
<span id="cb343-7"><a href="functions.html#cb343-7" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] 81.86645
## [1] 54.48885
## [1] -65.5619
## [1] -598.2559
## [1] -3154.072</code></pre>
</div>
<div id="evaluate-nonlinear-function-using-dplyr-mutate" class="section level4 hasAnchor" number="3.1.1.4">
<h4><span class="header-section-number">3.1.1.4</span> Evaluate Nonlinear Function using dplyr mutate<a href="functions.html#evaluate-nonlinear-function-using-dplyr-mutate" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="functions.html#cb345-1" tabindex="-1"></a><span class="co"># Define Implicit Function</span></span>
<span id="cb345-2"><a href="functions.html#cb345-2" tabindex="-1"></a>ffi_nonlin_dplyrdo <span class="ot">&lt;-</span> <span class="cf">function</span>(fl_A, fl_alpha, fl_N, ar_A, ar_alpha, fl_N_agg, fl_rho){</span>
<span id="cb345-3"><a href="functions.html#cb345-3" tabindex="-1"></a></span>
<span id="cb345-4"><a href="functions.html#cb345-4" tabindex="-1"></a>  <span class="co"># Test Parameters</span></span>
<span id="cb345-5"><a href="functions.html#cb345-5" tabindex="-1"></a>  <span class="co"># ar_A = ar_nN_A</span></span>
<span id="cb345-6"><a href="functions.html#cb345-6" tabindex="-1"></a>  <span class="co"># ar_alpha = ar_nN_alpha</span></span>
<span id="cb345-7"><a href="functions.html#cb345-7" tabindex="-1"></a>  <span class="co"># fl_N = 100</span></span>
<span id="cb345-8"><a href="functions.html#cb345-8" tabindex="-1"></a>  <span class="co"># fl_rho = -1</span></span>
<span id="cb345-9"><a href="functions.html#cb345-9" tabindex="-1"></a>  <span class="co"># fl_N_q = 10</span></span>
<span id="cb345-10"><a href="functions.html#cb345-10" tabindex="-1"></a></span>
<span id="cb345-11"><a href="functions.html#cb345-11" tabindex="-1"></a>  <span class="co"># Apply Function</span></span>
<span id="cb345-12"><a href="functions.html#cb345-12" tabindex="-1"></a>  ar_p1_s1 <span class="ot">=</span> <span class="fu">exp</span>((fl_A <span class="sc">-</span> ar_A)<span class="sc">*</span>fl_rho)</span>
<span id="cb345-13"><a href="functions.html#cb345-13" tabindex="-1"></a>  ar_p1_s2 <span class="ot">=</span> (fl_alpha<span class="sc">/</span>ar_alpha)</span>
<span id="cb345-14"><a href="functions.html#cb345-14" tabindex="-1"></a>  ar_p1_s3 <span class="ot">=</span> (<span class="dv">1</span><span class="sc">/</span>(ar_alpha<span class="sc">*</span>fl_rho <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb345-15"><a href="functions.html#cb345-15" tabindex="-1"></a>  ar_p1 <span class="ot">=</span> (ar_p1_s1<span class="sc">*</span>ar_p1_s2)<span class="sc">^</span>ar_p1_s3</span>
<span id="cb345-16"><a href="functions.html#cb345-16" tabindex="-1"></a>  ar_p2 <span class="ot">=</span> (fl_N<span class="sc">*</span>fl_N_agg)<span class="sc">^</span>((fl_alpha<span class="sc">*</span>fl_rho<span class="dv">-1</span>)<span class="sc">/</span>(ar_alpha<span class="sc">*</span>fl_rho<span class="dv">-1</span>))</span>
<span id="cb345-17"><a href="functions.html#cb345-17" tabindex="-1"></a>  ar_overall <span class="ot">=</span> ar_p1<span class="sc">*</span>ar_p2</span>
<span id="cb345-18"><a href="functions.html#cb345-18" tabindex="-1"></a>  fl_overall <span class="ot">=</span> fl_N_agg <span class="sc">-</span> <span class="fu">sum</span>(ar_overall)</span>
<span id="cb345-19"><a href="functions.html#cb345-19" tabindex="-1"></a></span>
<span id="cb345-20"><a href="functions.html#cb345-20" tabindex="-1"></a>  <span class="fu">return</span>(fl_overall)</span>
<span id="cb345-21"><a href="functions.html#cb345-21" tabindex="-1"></a>}</span>
<span id="cb345-22"><a href="functions.html#cb345-22" tabindex="-1"></a></span>
<span id="cb345-23"><a href="functions.html#cb345-23" tabindex="-1"></a><span class="co"># fl_A, fl_alpha are from columns of tb_nN_by_nQ_A_alpha</span></span>
<span id="cb345-24"><a href="functions.html#cb345-24" tabindex="-1"></a>tb_nN_by_nQ_A_alpha <span class="ot">=</span> tb_nN_by_nQ_A_alpha <span class="sc">%&gt;%</span> <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb345-25"><a href="functions.html#cb345-25" tabindex="-1"></a>                        <span class="fu">mutate</span>(<span class="at">dplyr_eval =</span> <span class="fu">ffi_nonlin_dplyrdo</span>(fl_A, fl_alpha, fl_N,</span>
<span id="cb345-26"><a href="functions.html#cb345-26" tabindex="-1"></a>                                                               ar_nN_A, ar_nN_alpha,</span>
<span id="cb345-27"><a href="functions.html#cb345-27" tabindex="-1"></a>                                                               fl_N_agg, fl_rho))</span>
<span id="cb345-28"><a href="functions.html#cb345-28" tabindex="-1"></a><span class="co"># Show</span></span>
<span id="cb345-29"><a href="functions.html#cb345-29" tabindex="-1"></a><span class="fu">kable</span>(tb_nN_by_nQ_A_alpha) <span class="sc">%&gt;%</span></span>
<span id="cb345-30"><a href="functions.html#cb345-30" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_A
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_alpha
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_N
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dplyr_eval
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-2
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
0.0666667
</td>
<td style="text-align:right;">
81.86645
</td>
</tr>
<tr>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
0.1333333
</td>
<td style="text-align:right;">
54.48885
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.2000000
</td>
<td style="text-align:right;">
-65.56190
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
0.2666667
</td>
<td style="text-align:right;">
-598.25595
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.9
</td>
<td style="text-align:right;">
0.3333333
</td>
<td style="text-align:right;">
-3154.07226
</td>
</tr>
</tbody>
</table>

</div>
</div>
<div id="evaluate-choices-across-states" class="section level3 hasAnchor" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Evaluate Choices Across States<a href="functions.html#evaluate-choices-across-states" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> research support package, <a href="https://fanwangecon.github.io/R4Econ/">R4Econ</a> examples page, <a href="https://fanwangecon.github.io/PkgTestR/">PkgTestR</a> packaging guide, or <a href="https://fanwangecon.github.io/Stat4Econ/">Stat4Econ</a> course page.</p>
</blockquote>
<p>See the <a href="https://fanwangecon.github.io/REconTools/reference/ff_opti_bisect_pmap_multi.html">ff_opti_bisect_pmap_multi</a> function from <a href="https://fanwangecon.github.io/">Fan</a>’s <em><a href="https://fanwangecon.github.io/REconTools/">REconTools</a></em> Package, which provides a resuable function based on the algorithm worked out here.</p>
<p>We want evaluate linear function <span class="math inline">\(0=f(z_{ij}, x_i, y_i, \textbf{X}, \textbf{Y}, c, d)\)</span>. There are <span class="math inline">\(i\)</span> functions that have <span class="math inline">\(i\)</span> specific <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>. For each <span class="math inline">\(i\)</span> function, we evaluate along a grid of feasible values for <span class="math inline">\(z\)</span>, over <span class="math inline">\(j\in J\)</span> grid points, potentially looking for the <span class="math inline">\(j\)</span> that is closest to the root. <span class="math inline">\(\textbf{X}\)</span> and <span class="math inline">\(\textbf{Y}\)</span> are arrays common across the <span class="math inline">\(i\)</span> equations, and <span class="math inline">\(c\)</span> and <span class="math inline">\(d\)</span> are constants.</p>
<p>The evaluation strategy is the following, given min and max for <span class="math inline">\(z\)</span> that are specific for each <span class="math inline">\(j\)</span>, and given common number of grid points, generate a matrix of <span class="math inline">\(z_{ij}\)</span>. Suppose there the number of <span class="math inline">\(i\)</span> is <span class="math inline">\(I\)</span>, and the number of grid points for <span class="math inline">\(j\)</span> is <span class="math inline">\(J\)</span>.</p>
<ol style="list-style-type: decimal">
<li>Generate a <span class="math inline">\(J \cdot I\)</span> by <span class="math inline">\(3\)</span> matrix where the columns are <span class="math inline">\(z,x,y\)</span> as tibble</li>
<li>Follow <a href="https://fanwangecon.github.io/R4Econ/function/mutatef/fs_funceval.html">this</a> Mutate to evaluate the <span class="math inline">\(f(\cdot)\)</span> function.</li>
<li>Add two categorical columns for grid levels and wich <span class="math inline">\(i\)</span>, <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> index. Plot Mutate output evaluated column categorized by <span class="math inline">\(i\)</span> as color and <span class="math inline">\(j\)</span> as x-axis.</li>
</ol>
<div id="set-up-input-arrays-1" class="section level4 hasAnchor" number="3.1.2.1">
<h4><span class="header-section-number">3.1.2.1</span> Set up Input Arrays<a href="functions.html#set-up-input-arrays-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>There is a function that takes <span class="math inline">\(M=Q+P\)</span> inputs, we want to evaluate this function <span class="math inline">\(N\)</span> times. Each time, there are <span class="math inline">\(M\)</span> inputs, where all but <span class="math inline">\(Q\)</span> of the <span class="math inline">\(M\)</span> inputs, meaning <span class="math inline">\(P\)</span> of the <span class="math inline">\(M\)</span> inputs, are the same. In particular, <span class="math inline">\(P=Q*N\)</span>.</p>
<p><span class="math display">\[M = Q+P = Q + Q*N\]</span></p>
<p>Now we need to expand this by the number of choice grid. Each row, representing one equation, is expanded by the number of choice grids. We are graphically searching, or rather brute force searching, which means if we have 100 individuals, we want to plot out the nonlinear equation for each of these lines, and show graphically where each line crosses zero. We achieve this, by evaluating the equation for each of the 100 individuals along a grid of feasible choices.</p>
<p>In this problem here, the feasible choices are shared across individuals.</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="functions.html#cb346-1" tabindex="-1"></a><span class="co"># Parameters</span></span>
<span id="cb346-2"><a href="functions.html#cb346-2" tabindex="-1"></a>fl_rho <span class="ot">=</span> <span class="fl">0.20</span></span>
<span id="cb346-3"><a href="functions.html#cb346-3" tabindex="-1"></a>svr_id_var <span class="ot">=</span> <span class="st">&#39;INDI_ID&#39;</span></span>
<span id="cb346-4"><a href="functions.html#cb346-4" tabindex="-1"></a></span>
<span id="cb346-5"><a href="functions.html#cb346-5" tabindex="-1"></a><span class="co"># it_child_count = N, the number of children</span></span>
<span id="cb346-6"><a href="functions.html#cb346-6" tabindex="-1"></a>it_N_child_cnt <span class="ot">=</span> <span class="dv">4</span></span>
<span id="cb346-7"><a href="functions.html#cb346-7" tabindex="-1"></a><span class="co"># it_heter_param = Q, number of parameters that are heterogeneous across children</span></span>
<span id="cb346-8"><a href="functions.html#cb346-8" tabindex="-1"></a>it_Q_hetpa_cnt <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb346-9"><a href="functions.html#cb346-9" tabindex="-1"></a></span>
<span id="cb346-10"><a href="functions.html#cb346-10" tabindex="-1"></a><span class="co"># P fixed parameters, nN is N dimensional, nP is P dimensional</span></span>
<span id="cb346-11"><a href="functions.html#cb346-11" tabindex="-1"></a>ar_nN_A <span class="ot">=</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="at">length.out =</span> it_N_child_cnt)</span>
<span id="cb346-12"><a href="functions.html#cb346-12" tabindex="-1"></a>ar_nN_alpha <span class="ot">=</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="at">length.out =</span> it_N_child_cnt)</span>
<span id="cb346-13"><a href="functions.html#cb346-13" tabindex="-1"></a>ar_nP_A_alpha <span class="ot">=</span> <span class="fu">c</span>(ar_nN_A, ar_nN_alpha)</span>
<span id="cb346-14"><a href="functions.html#cb346-14" tabindex="-1"></a></span>
<span id="cb346-15"><a href="functions.html#cb346-15" tabindex="-1"></a><span class="co"># N by Q varying parameters</span></span>
<span id="cb346-16"><a href="functions.html#cb346-16" tabindex="-1"></a>mt_nN_by_nQ_A_alpha <span class="ot">=</span> <span class="fu">cbind</span>(ar_nN_A, ar_nN_alpha)</span>
<span id="cb346-17"><a href="functions.html#cb346-17" tabindex="-1"></a></span>
<span id="cb346-18"><a href="functions.html#cb346-18" tabindex="-1"></a><span class="co"># Choice Grid for nutritional feasible choices for each</span></span>
<span id="cb346-19"><a href="functions.html#cb346-19" tabindex="-1"></a>fl_N_agg <span class="ot">=</span> <span class="dv">100</span></span>
<span id="cb346-20"><a href="functions.html#cb346-20" tabindex="-1"></a>fl_N_min <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb346-21"><a href="functions.html#cb346-21" tabindex="-1"></a>it_N_choice_cnt_ttest <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb346-22"><a href="functions.html#cb346-22" tabindex="-1"></a>it_N_choice_cnt_dense <span class="ot">=</span> <span class="dv">100</span></span>
<span id="cb346-23"><a href="functions.html#cb346-23" tabindex="-1"></a>ar_N_choices_ttest <span class="ot">=</span> <span class="fu">seq</span>(fl_N_min, fl_N_agg, <span class="at">length.out =</span> it_N_choice_cnt_ttest)</span>
<span id="cb346-24"><a href="functions.html#cb346-24" tabindex="-1"></a>ar_N_choices_dense <span class="ot">=</span> <span class="fu">seq</span>(fl_N_min, fl_N_agg, <span class="at">length.out =</span> it_N_choice_cnt_dense)</span>
<span id="cb346-25"><a href="functions.html#cb346-25" tabindex="-1"></a></span>
<span id="cb346-26"><a href="functions.html#cb346-26" tabindex="-1"></a><span class="co"># Mesh Expand</span></span>
<span id="cb346-27"><a href="functions.html#cb346-27" tabindex="-1"></a>tb_states_choices <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(mt_nN_by_nQ_A_alpha) <span class="sc">%&gt;%</span> <span class="fu">rowid_to_column</span>(<span class="at">var=</span>svr_id_var)</span>
<span id="cb346-28"><a href="functions.html#cb346-28" tabindex="-1"></a>tb_states_choices_ttest <span class="ot">&lt;-</span> tb_states_choices <span class="sc">%&gt;%</span> <span class="fu">expand_grid</span>(<span class="at">choices =</span> ar_N_choices_ttest)</span>
<span id="cb346-29"><a href="functions.html#cb346-29" tabindex="-1"></a>tb_states_choices_dense <span class="ot">&lt;-</span> tb_states_choices <span class="sc">%&gt;%</span> <span class="fu">expand_grid</span>(<span class="at">choices =</span> ar_N_choices_dense)</span>
<span id="cb346-30"><a href="functions.html#cb346-30" tabindex="-1"></a></span>
<span id="cb346-31"><a href="functions.html#cb346-31" tabindex="-1"></a><span class="co"># display</span></span>
<span id="cb346-32"><a href="functions.html#cb346-32" tabindex="-1"></a><span class="fu">summary</span>(tb_states_choices_dense)</span></code></pre></div>
<pre><code>##     INDI_ID        ar_nN_A    ar_nN_alpha     choices   
##  Min.   :1.00   Min.   :-2   Min.   :0.1   Min.   :  0  
##  1st Qu.:1.75   1st Qu.:-1   1st Qu.:0.3   1st Qu.: 25  
##  Median :2.50   Median : 0   Median :0.5   Median : 50  
##  Mean   :2.50   Mean   : 0   Mean   :0.5   Mean   : 50  
##  3rd Qu.:3.25   3rd Qu.: 1   3rd Qu.:0.7   3rd Qu.: 75  
##  Max.   :4.00   Max.   : 2   Max.   :0.9   Max.   :100</code></pre>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="functions.html#cb348-1" tabindex="-1"></a><span class="fu">kable</span>(tb_states_choices_ttest) <span class="sc">%&gt;%</span></span>
<span id="cb348-2"><a href="functions.html#cb348-2" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
INDI_ID
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ar_nN_A
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ar_nN_alpha
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
choices
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-2.0000000
</td>
<td style="text-align:right;">
0.1000000
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-2.0000000
</td>
<td style="text-align:right;">
0.1000000
</td>
<td style="text-align:right;">
50
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-2.0000000
</td>
<td style="text-align:right;">
0.1000000
</td>
<td style="text-align:right;">
100
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-0.6666667
</td>
<td style="text-align:right;">
0.3666667
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-0.6666667
</td>
<td style="text-align:right;">
0.3666667
</td>
<td style="text-align:right;">
50
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-0.6666667
</td>
<td style="text-align:right;">
0.3666667
</td>
<td style="text-align:right;">
100
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.6666667
</td>
<td style="text-align:right;">
0.6333333
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.6666667
</td>
<td style="text-align:right;">
0.6333333
</td>
<td style="text-align:right;">
50
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.6666667
</td>
<td style="text-align:right;">
0.6333333
</td>
<td style="text-align:right;">
100
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2.0000000
</td>
<td style="text-align:right;">
0.9000000
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2.0000000
</td>
<td style="text-align:right;">
0.9000000
</td>
<td style="text-align:right;">
50
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2.0000000
</td>
<td style="text-align:right;">
0.9000000
</td>
<td style="text-align:right;">
100
</td>
</tr>
</tbody>
</table>
</div>
<div id="apply-same-function-all-rows-some-inputs-row-specific-other-shared" class="section level4 hasAnchor" number="3.1.2.2">
<h4><span class="header-section-number">3.1.2.2</span> Apply Same Function all Rows, Some Inputs Row-specific, other Shared<a href="functions.html#apply-same-function-all-rows-some-inputs-row-specific-other-shared" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>There are two types of inputs, row-specific inputs, and inputs that should be applied for each row. The Function just requires all of these inputs, it does not know what is row-specific and what is common for all row. Dplyr recognizes which parameter inputs already existing in the piped dataframe/tibble, given rowwise, those will be row-specific inputs. Additional function parameters that do not exist in dataframe as variable names, but that are pre-defined scalars or arrays will be applied to all rows.</p>
<ul>
<li><span class="citation">(<a href="#ref-param"><strong>param?</strong></a>)</span> string variable name of input where functions are evaluated, these are already contained in the dataframe, existing variable names, row specific, rowwise computation over these, each rowwise calculation using different rows: <em>fl_A</em>, <em>fl_alpha</em>, <em>fl_N</em></li>
<li><span class="citation">(<a href="#ref-param"><strong>param?</strong></a>)</span> scalar and array values that are applied to every rowwise calculation, all rowwise calculations using the same scalars and arrays:<em>ar_A</em>, <em>ar_alpha</em>, <em>fl_N_agg</em>, <em>fl_rho</em></li>
<li><span class="citation">(<a href="#ref-param"><strong>param?</strong></a>)</span> string output variable name</li>
</ul>
<p>The function looks within group, finds min/max etc that are relevant.</p>
<div id="points-and-denser-dataframs-and-define-function" class="section level5 hasAnchor" number="3.1.2.2.1">
<h5><span class="header-section-number">3.1.2.2.1</span> 3 Points and Denser Dataframs and Define Function<a href="functions.html#points-and-denser-dataframs-and-define-function" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="functions.html#cb349-1" tabindex="-1"></a><span class="co"># Convert Matrix to Tibble</span></span>
<span id="cb349-2"><a href="functions.html#cb349-2" tabindex="-1"></a>ar_st_col_names <span class="ot">=</span> <span class="fu">c</span>(svr_id_var,<span class="st">&#39;fl_A&#39;</span>, <span class="st">&#39;fl_alpha&#39;</span>)</span>
<span id="cb349-3"><a href="functions.html#cb349-3" tabindex="-1"></a>tb_states_choices <span class="ot">&lt;-</span> tb_states_choices <span class="sc">%&gt;%</span> <span class="fu">rename_all</span>(<span class="sc">~</span><span class="fu">c</span>(ar_st_col_names))</span>
<span id="cb349-4"><a href="functions.html#cb349-4" tabindex="-1"></a>ar_st_col_names <span class="ot">=</span> <span class="fu">c</span>(svr_id_var,<span class="st">&#39;fl_A&#39;</span>, <span class="st">&#39;fl_alpha&#39;</span>, <span class="st">&#39;fl_N&#39;</span>)</span>
<span id="cb349-5"><a href="functions.html#cb349-5" tabindex="-1"></a>tb_states_choices_ttest <span class="ot">&lt;-</span> tb_states_choices_ttest <span class="sc">%&gt;%</span> <span class="fu">rename_all</span>(<span class="sc">~</span><span class="fu">c</span>(ar_st_col_names))</span>
<span id="cb349-6"><a href="functions.html#cb349-6" tabindex="-1"></a>tb_states_choices_dense <span class="ot">&lt;-</span> tb_states_choices_dense <span class="sc">%&gt;%</span> <span class="fu">rename_all</span>(<span class="sc">~</span><span class="fu">c</span>(ar_st_col_names))</span>
<span id="cb349-7"><a href="functions.html#cb349-7" tabindex="-1"></a></span>
<span id="cb349-8"><a href="functions.html#cb349-8" tabindex="-1"></a><span class="co"># Define Implicit Function</span></span>
<span id="cb349-9"><a href="functions.html#cb349-9" tabindex="-1"></a>ffi_nonlin_dplyrdo <span class="ot">&lt;-</span> <span class="cf">function</span>(fl_A, fl_alpha, fl_N, ar_A, ar_alpha, fl_N_agg, fl_rho){</span>
<span id="cb349-10"><a href="functions.html#cb349-10" tabindex="-1"></a>  <span class="co"># scalar value that are row-specific, in dataframe already: *fl_A*, *fl_alpha*, *fl_N*</span></span>
<span id="cb349-11"><a href="functions.html#cb349-11" tabindex="-1"></a>  <span class="co"># array and scalars not in dataframe, common all rows: *ar_A*, *ar_alpha*, *fl_N_agg*, *fl_rho*</span></span>
<span id="cb349-12"><a href="functions.html#cb349-12" tabindex="-1"></a></span>
<span id="cb349-13"><a href="functions.html#cb349-13" tabindex="-1"></a>  <span class="co"># Test Parameters</span></span>
<span id="cb349-14"><a href="functions.html#cb349-14" tabindex="-1"></a>  <span class="co"># ar_A = ar_nN_A</span></span>
<span id="cb349-15"><a href="functions.html#cb349-15" tabindex="-1"></a>  <span class="co"># ar_alpha = ar_nN_alpha</span></span>
<span id="cb349-16"><a href="functions.html#cb349-16" tabindex="-1"></a>  <span class="co"># fl_N = 100</span></span>
<span id="cb349-17"><a href="functions.html#cb349-17" tabindex="-1"></a>  <span class="co"># fl_rho = -1</span></span>
<span id="cb349-18"><a href="functions.html#cb349-18" tabindex="-1"></a>  <span class="co"># fl_N_q = 10</span></span>
<span id="cb349-19"><a href="functions.html#cb349-19" tabindex="-1"></a></span>
<span id="cb349-20"><a href="functions.html#cb349-20" tabindex="-1"></a>  <span class="co"># Apply Function</span></span>
<span id="cb349-21"><a href="functions.html#cb349-21" tabindex="-1"></a>  ar_p1_s1 <span class="ot">=</span> <span class="fu">exp</span>((fl_A <span class="sc">-</span> ar_A)<span class="sc">*</span>fl_rho)</span>
<span id="cb349-22"><a href="functions.html#cb349-22" tabindex="-1"></a>  ar_p1_s2 <span class="ot">=</span> (fl_alpha<span class="sc">/</span>ar_alpha)</span>
<span id="cb349-23"><a href="functions.html#cb349-23" tabindex="-1"></a>  ar_p1_s3 <span class="ot">=</span> (<span class="dv">1</span><span class="sc">/</span>(ar_alpha<span class="sc">*</span>fl_rho <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb349-24"><a href="functions.html#cb349-24" tabindex="-1"></a>  ar_p1 <span class="ot">=</span> (ar_p1_s1<span class="sc">*</span>ar_p1_s2)<span class="sc">^</span>ar_p1_s3</span>
<span id="cb349-25"><a href="functions.html#cb349-25" tabindex="-1"></a>  ar_p2 <span class="ot">=</span> fl_N<span class="sc">^</span>((fl_alpha<span class="sc">*</span>fl_rho<span class="dv">-1</span>)<span class="sc">/</span>(ar_alpha<span class="sc">*</span>fl_rho<span class="dv">-1</span>))</span>
<span id="cb349-26"><a href="functions.html#cb349-26" tabindex="-1"></a>  ar_overall <span class="ot">=</span> ar_p1<span class="sc">*</span>ar_p2</span>
<span id="cb349-27"><a href="functions.html#cb349-27" tabindex="-1"></a>  fl_overall <span class="ot">=</span> fl_N_agg <span class="sc">-</span> <span class="fu">sum</span>(ar_overall)</span>
<span id="cb349-28"><a href="functions.html#cb349-28" tabindex="-1"></a></span>
<span id="cb349-29"><a href="functions.html#cb349-29" tabindex="-1"></a>  <span class="fu">return</span>(fl_overall)</span>
<span id="cb349-30"><a href="functions.html#cb349-30" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="evaluate-at-three-choice-points-and-show-table" class="section level5 hasAnchor" number="3.1.2.2.2">
<h5><span class="header-section-number">3.1.2.2.2</span> Evaluate at Three Choice Points and Show Table<a href="functions.html#evaluate-at-three-choice-points-and-show-table" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>In the example below, just show results evaluating over three choice points and show table.</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="functions.html#cb350-1" tabindex="-1"></a><span class="co"># fl_A, fl_alpha are from columns of tb_nN_by_nQ_A_alpha</span></span>
<span id="cb350-2"><a href="functions.html#cb350-2" tabindex="-1"></a>tb_states_choices_ttest_eval <span class="ot">=</span> tb_states_choices_ttest <span class="sc">%&gt;%</span> <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb350-3"><a href="functions.html#cb350-3" tabindex="-1"></a>                        <span class="fu">mutate</span>(<span class="at">dplyr_eval =</span> <span class="fu">ffi_nonlin_dplyrdo</span>(fl_A, fl_alpha, fl_N,</span>
<span id="cb350-4"><a href="functions.html#cb350-4" tabindex="-1"></a>                                                               ar_nN_A, ar_nN_alpha,</span>
<span id="cb350-5"><a href="functions.html#cb350-5" tabindex="-1"></a>                                                               fl_N_agg, fl_rho))</span>
<span id="cb350-6"><a href="functions.html#cb350-6" tabindex="-1"></a><span class="co"># Show</span></span>
<span id="cb350-7"><a href="functions.html#cb350-7" tabindex="-1"></a><span class="fu">kable</span>(tb_states_choices_ttest_eval) <span class="sc">%&gt;%</span></span>
<span id="cb350-8"><a href="functions.html#cb350-8" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
INDI_ID
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_A
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_alpha
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_N
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dplyr_eval
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-2.0000000
</td>
<td style="text-align:right;">
0.1000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.00000
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-2.0000000
</td>
<td style="text-align:right;">
0.1000000
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
-5666.95576
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-2.0000000
</td>
<td style="text-align:right;">
0.1000000
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
-12880.28392
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-0.6666667
</td>
<td style="text-align:right;">
0.3666667
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.00000
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-0.6666667
</td>
<td style="text-align:right;">
0.3666667
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
-595.73454
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-0.6666667
</td>
<td style="text-align:right;">
0.3666667
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
-1394.70698
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.6666667
</td>
<td style="text-align:right;">
0.6333333
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.00000
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.6666667
</td>
<td style="text-align:right;">
0.6333333
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
-106.51058
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.6666667
</td>
<td style="text-align:right;">
0.6333333
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
-323.94216
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2.0000000
</td>
<td style="text-align:right;">
0.9000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.00000
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2.0000000
</td>
<td style="text-align:right;">
0.9000000
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
22.55577
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2.0000000
</td>
<td style="text-align:right;">
0.9000000
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
-51.97161
</td>
</tr>
</tbody>
</table>
</div>
<div id="evaluate-at-many-choice-points-and-show-graphically" class="section level5 hasAnchor" number="3.1.2.2.3">
<h5><span class="header-section-number">3.1.2.2.3</span> Evaluate at Many Choice Points and Show Graphically<a href="functions.html#evaluate-at-many-choice-points-and-show-graphically" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Same as above, but now we evaluate the function over the individuals at many choice points so that we can graph things out.</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="functions.html#cb351-1" tabindex="-1"></a><span class="co"># fl_A, fl_alpha are from columns of tb_nN_by_nQ_A_alpha</span></span>
<span id="cb351-2"><a href="functions.html#cb351-2" tabindex="-1"></a>tb_states_choices_dense_eval <span class="ot">=</span> tb_states_choices_dense <span class="sc">%&gt;%</span> <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb351-3"><a href="functions.html#cb351-3" tabindex="-1"></a>                        <span class="fu">mutate</span>(<span class="at">dplyr_eval =</span> <span class="fu">ffi_nonlin_dplyrdo</span>(fl_A, fl_alpha, fl_N,</span>
<span id="cb351-4"><a href="functions.html#cb351-4" tabindex="-1"></a>                                                               ar_nN_A, ar_nN_alpha,</span>
<span id="cb351-5"><a href="functions.html#cb351-5" tabindex="-1"></a>                                                               fl_N_agg, fl_rho))</span></code></pre></div>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="functions.html#cb352-1" tabindex="-1"></a><span class="co"># Labeling</span></span>
<span id="cb352-2"><a href="functions.html#cb352-2" tabindex="-1"></a>st_title <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;Evaluate Non-Linear Functions to Search for Roots&#39;</span>)</span>
<span id="cb352-3"><a href="functions.html#cb352-3" tabindex="-1"></a>st_subtitle <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;https://fanwangecon.github.io/&#39;</span>,</span>
<span id="cb352-4"><a href="functions.html#cb352-4" tabindex="-1"></a>                      <span class="st">&#39;R4Econ/function/mutatef/htmlpdfr/fs_func_choice_states.html&#39;</span>)</span>
<span id="cb352-5"><a href="functions.html#cb352-5" tabindex="-1"></a>st_caption <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;Evaluating the function, &#39;</span>,</span>
<span id="cb352-6"><a href="functions.html#cb352-6" tabindex="-1"></a>                     <span class="st">&#39;https://fanwangecon.github.io/R4Econ/&#39;</span>)</span>
<span id="cb352-7"><a href="functions.html#cb352-7" tabindex="-1"></a>st_x_label <span class="ot">&lt;-</span> <span class="st">&#39;x values&#39;</span></span>
<span id="cb352-8"><a href="functions.html#cb352-8" tabindex="-1"></a>st_y_label <span class="ot">&lt;-</span> <span class="st">&#39;f(x)&#39;</span></span>
<span id="cb352-9"><a href="functions.html#cb352-9" tabindex="-1"></a></span>
<span id="cb352-10"><a href="functions.html#cb352-10" tabindex="-1"></a><span class="co"># Show</span></span>
<span id="cb352-11"><a href="functions.html#cb352-11" tabindex="-1"></a><span class="fu">dim</span>(tb_states_choices_dense_eval)</span></code></pre></div>
<pre><code>## [1] 400   5</code></pre>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="functions.html#cb354-1" tabindex="-1"></a><span class="fu">summary</span>(tb_states_choices_dense_eval)</span></code></pre></div>
<pre><code>##     INDI_ID          fl_A       fl_alpha        fl_N       dplyr_eval       
##  Min.   :1.00   Min.   :-2   Min.   :0.1   Min.   :  0   Min.   :-12880.28  
##  1st Qu.:1.75   1st Qu.:-1   1st Qu.:0.3   1st Qu.: 25   1st Qu.: -1167.29  
##  Median :2.50   Median : 0   Median :0.5   Median : 50   Median :  -202.42  
##  Mean   :2.50   Mean   : 0   Mean   :0.5   Mean   : 50   Mean   : -1645.65  
##  3rd Qu.:3.25   3rd Qu.: 1   3rd Qu.:0.7   3rd Qu.: 75   3rd Qu.:     0.96  
##  Max.   :4.00   Max.   : 2   Max.   :0.9   Max.   :100   Max.   :   100.00</code></pre>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="functions.html#cb356-1" tabindex="-1"></a>lineplot <span class="ot">&lt;-</span> tb_states_choices_dense_eval <span class="sc">%&gt;%</span></span>
<span id="cb356-2"><a href="functions.html#cb356-2" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>fl_N, <span class="at">y=</span>dplyr_eval)) <span class="sc">+</span></span>
<span id="cb356-3"><a href="functions.html#cb356-3" tabindex="-1"></a>        <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb356-4"><a href="functions.html#cb356-4" tabindex="-1"></a>        <span class="fu">facet_wrap</span>( . <span class="sc">~</span> INDI_ID, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb356-5"><a href="functions.html#cb356-5" tabindex="-1"></a>        <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="dv">0</span>, <span class="at">linetype=</span><span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb356-6"><a href="functions.html#cb356-6" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb356-7"><a href="functions.html#cb356-7" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">title =</span> st_title,</span>
<span id="cb356-8"><a href="functions.html#cb356-8" tabindex="-1"></a>             <span class="at">subtitle =</span> st_subtitle,</span>
<span id="cb356-9"><a href="functions.html#cb356-9" tabindex="-1"></a>             <span class="at">x =</span> st_x_label,</span>
<span id="cb356-10"><a href="functions.html#cb356-10" tabindex="-1"></a>             <span class="at">y =</span> st_y_label,</span>
<span id="cb356-11"><a href="functions.html#cb356-11" tabindex="-1"></a>             <span class="at">caption =</span> st_caption)</span>
<span id="cb356-12"><a href="functions.html#cb356-12" tabindex="-1"></a><span class="fu">print</span>(lineplot)</span></code></pre></div>
<p><img src="Panel-Data-and-Optimization-with-R_files/figure-html/graph%20many%20evaluations-1.png" width="672" style="display: block; margin: auto;" /></p>

</div>
</div>
</div>
</div>
<div id="dataframe-do-anything" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Dataframe Do Anything<a href="functions.html#dataframe-do-anything" class="anchor-section" aria-label="Anchor link to header"></a></h2>

<div id="mx1-by-n-to-mxq-by-n1" class="section level3 hasAnchor" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> (Mx1 by N) to (MxQ by N+1)<a href="functions.html#mx1-by-n-to-mxq-by-n1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> research support package, <a href="https://fanwangecon.github.io/R4Econ/">R4Econ</a> examples page, <a href="https://fanwangecon.github.io/PkgTestR/">PkgTestR</a> packaging guide, or <a href="https://fanwangecon.github.io/Stat4Econ/">Stat4Econ</a> course page.</p>
</blockquote>
<p><strong>Case One</strong>: There is a dataframe with <span class="math inline">\(M\)</span> rows, based on these <span class="math inline">\(m\)</span> specific information, generate dataframes for each <span class="math inline">\(m\)</span>. Stack these indivdiual dataframes together and merge original <span class="math inline">\(m\)</span> specific information in as well. The number of rows for each <span class="math inline">\(m\)</span> is <span class="math inline">\(Q_m\)</span>, each <span class="math inline">\(m\)</span> could have different number of expansion rows.</p>
<p>Generate a panel with <span class="math inline">\(M\)</span> individuals, each individual is observed for different spans of times (<em>uncount</em>). Before expanding, generate individual specific normal distribution standard deviation. All individuals share the same mean, but have increasing standard deviations.</p>
<div id="generate-dataframe-with-m-rows." class="section level4 hasAnchor" number="3.2.1.1">
<h4><span class="header-section-number">3.2.1.1</span> Generate Dataframe with M Rows.<a href="functions.html#generate-dataframe-with-m-rows." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This is the first step, generate <span class="math inline">\(M\)</span> rows of data, to be expanded. Each row contains the number of normal draws to make and the mean and the standard deviation for normal daraws that are <span class="math inline">\(m\)</span> specific.</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="functions.html#cb357-1" tabindex="-1"></a><span class="co"># Parameter Setups</span></span>
<span id="cb357-2"><a href="functions.html#cb357-2" tabindex="-1"></a>it_M <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb357-3"><a href="functions.html#cb357-3" tabindex="-1"></a>it_Q_max <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb357-4"><a href="functions.html#cb357-4" tabindex="-1"></a>fl_rnorm_mu <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb357-5"><a href="functions.html#cb357-5" tabindex="-1"></a>ar_rnorm_sd <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.01</span>, <span class="dv">200</span>, <span class="at">length.out=</span>it_M)</span>
<span id="cb357-6"><a href="functions.html#cb357-6" tabindex="-1"></a>ar_it_q <span class="ot">&lt;-</span> <span class="fu">sample.int</span>(it_Q_max, it_M, <span class="at">replace=</span><span class="cn">TRUE</span>)</span>
<span id="cb357-7"><a href="functions.html#cb357-7" tabindex="-1"></a></span>
<span id="cb357-8"><a href="functions.html#cb357-8" tabindex="-1"></a><span class="co"># N by Q varying parameters</span></span>
<span id="cb357-9"><a href="functions.html#cb357-9" tabindex="-1"></a>mt_data <span class="ot">=</span> <span class="fu">cbind</span>(ar_it_q, ar_rnorm_sd)</span>
<span id="cb357-10"><a href="functions.html#cb357-10" tabindex="-1"></a>tb_M <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(mt_data) <span class="sc">%&gt;%</span> <span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">&quot;ID&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb357-11"><a href="functions.html#cb357-11" tabindex="-1"></a>                <span class="fu">rename</span>(<span class="at">sd =</span> ar_rnorm_sd, <span class="at">Q =</span> ar_it_q) <span class="sc">%&gt;%</span></span>
<span id="cb357-12"><a href="functions.html#cb357-12" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">mean =</span> fl_rnorm_mu)</span>
<span id="cb357-13"><a href="functions.html#cb357-13" tabindex="-1"></a></span>
<span id="cb357-14"><a href="functions.html#cb357-14" tabindex="-1"></a><span class="co"># display</span></span>
<span id="cb357-15"><a href="functions.html#cb357-15" tabindex="-1"></a><span class="fu">kable</span>(tb_M) <span class="sc">%&gt;%</span></span>
<span id="cb357-16"><a href="functions.html#cb357-16" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ID
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Q
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
mean
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:right;">
1000
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
100.005
</td>
<td style="text-align:right;">
1000
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
200.000
</td>
<td style="text-align:right;">
1000
</td>
</tr>
</tbody>
</table>
</div>
<div id="random-normal-draw-expansion" class="section level4 hasAnchor" number="3.2.1.2">
<h4><span class="header-section-number">3.2.1.2</span> Random Normal Draw Expansion<a href="functions.html#random-normal-draw-expansion" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The steps are:</p>
<ol style="list-style-type: decimal">
<li><a href="https://dplyr.tidyverse.org/reference/do.html">do anything</a></li>
<li>use “.$” sign to refer to variable names, or [[‘name’]]</li>
<li>unnest</li>
<li>left_join expanded and original</li>
</ol>
<p>Note these all give the same results</p>
<p>Use dot dollar to get variables</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="functions.html#cb358-1" tabindex="-1"></a><span class="co"># Generate $Q_m$ individual specific incomes, expanded different number of times for each m</span></span>
<span id="cb358-2"><a href="functions.html#cb358-2" tabindex="-1"></a>tb_income <span class="ot">&lt;-</span> tb_M <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb358-3"><a href="functions.html#cb358-3" tabindex="-1"></a>  <span class="fu">do</span>(<span class="at">income =</span> <span class="fu">rnorm</span>(.<span class="sc">$</span>Q, <span class="at">mean=</span>.<span class="sc">$</span>mean, <span class="at">sd=</span>.<span class="sc">$</span>sd)) <span class="sc">%&gt;%</span></span>
<span id="cb358-4"><a href="functions.html#cb358-4" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="fu">c</span>(income))</span>
<span id="cb358-5"><a href="functions.html#cb358-5" tabindex="-1"></a></span>
<span id="cb358-6"><a href="functions.html#cb358-6" tabindex="-1"></a><span class="co"># Merge back with tb_M</span></span>
<span id="cb358-7"><a href="functions.html#cb358-7" tabindex="-1"></a>tb_income_full_dd <span class="ot">&lt;-</span> tb_income <span class="sc">%&gt;%</span></span>
<span id="cb358-8"><a href="functions.html#cb358-8" tabindex="-1"></a>  <span class="fu">left_join</span>(tb_M)</span>
<span id="cb358-9"><a href="functions.html#cb358-9" tabindex="-1"></a></span>
<span id="cb358-10"><a href="functions.html#cb358-10" tabindex="-1"></a><span class="co"># display</span></span>
<span id="cb358-11"><a href="functions.html#cb358-11" tabindex="-1"></a><span class="fu">kable</span>(tb_income) <span class="sc">%&gt;%</span></span>
<span id="cb358-12"><a href="functions.html#cb358-12" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ID
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
income
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
999.9803
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1070.1391
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
952.7185
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
893.2123
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
956.4050
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
794.7991
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
854.2218
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
874.9921
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="functions.html#cb359-1" tabindex="-1"></a><span class="fu">kable</span>(tb_income_full_dd) <span class="sc">%&gt;%</span></span>
<span id="cb359-2"><a href="functions.html#cb359-2" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ID
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
income
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Q
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
mean
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
999.9803
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:right;">
1000
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1070.1391
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
100.005
</td>
<td style="text-align:right;">
1000
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
952.7185
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
100.005
</td>
<td style="text-align:right;">
1000
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
893.2123
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
100.005
</td>
<td style="text-align:right;">
1000
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
956.4050
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
200.000
</td>
<td style="text-align:right;">
1000
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
794.7991
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
200.000
</td>
<td style="text-align:right;">
1000
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
854.2218
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
200.000
</td>
<td style="text-align:right;">
1000
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
874.9921
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
200.000
</td>
<td style="text-align:right;">
1000
</td>
</tr>
</tbody>
</table>

</div>
</div>
<div id="mxp-by-n-to-mx1-by-1" class="section level3 hasAnchor" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> (MxP by N) to (Mx1 by 1)<a href="functions.html#mxp-by-n-to-mx1-by-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> research support package, <a href="https://fanwangecon.github.io/R4Econ/">R4Econ</a> examples page, <a href="https://fanwangecon.github.io/PkgTestR/">PkgTestR</a> packaging guide, or <a href="https://fanwangecon.github.io/Stat4Econ/">Stat4Econ</a> course page.</p>
</blockquote>
<div id="wages-from-many-countries-and-country-specific-gini" class="section level4 hasAnchor" number="3.2.2.1">
<h4><span class="header-section-number">3.2.2.1</span> Wages from Many Countries and Country-specific GINI<a href="functions.html#wages-from-many-countries-and-country-specific-gini" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>There is a Panel with <span class="math inline">\(M\)</span> individuals and each individual has <span class="math inline">\(Q\)</span> records/rows. A function generate an individual specific outcome given the <span class="math inline">\(Q\)</span> individual specific inputs, along with shared parameters/values stored as variables that contain common values for each of the <span class="math inline">\(M\)</span> individuals.</p>
<p>For example, suppose we have a dataframe of individual wage information from different countries (the number of countries is <span class="math inline">\(M\)</span>). Each row is an individual from one country, giving us <span class="math inline">\(Q \cdot M\)</span> observations of wages.</p>
<p>We want to generate country specific gini based on the individual wage data for each country in the dataframe. Additionally, perhaps the gini formula requires not just individual wages but some additional parameters or shared dataframes as inputs. We will use the <a href="https://fanwangecon.github.io/REconTools/reference/ff_dist_gini_vector_pos.html">ff_dist_gini_vector_pos.html</a> function from <a href="https://fanwangecon.github.io/REconTools/">REconTools</a>.</p>
<p>First, we simulate a dataframe with <span class="math inline">\(M\)</span> countries, and up to <span class="math inline">\(Q\)</span> people in each country. The countries share the same mean income, but have different standard deviations.</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="functions.html#cb360-1" tabindex="-1"></a><span class="co"># Parameter Setups</span></span>
<span id="cb360-2"><a href="functions.html#cb360-2" tabindex="-1"></a>it_M <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb360-3"><a href="functions.html#cb360-3" tabindex="-1"></a>it_Q_max <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb360-4"><a href="functions.html#cb360-4" tabindex="-1"></a>fl_rnorm_mu <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb360-5"><a href="functions.html#cb360-5" tabindex="-1"></a>ar_rnorm_sd <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.01</span>, <span class="fl">0.2</span>, <span class="at">length.out=</span>it_M)</span>
<span id="cb360-6"><a href="functions.html#cb360-6" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="st">&#39;789&#39;</span>)</span>
<span id="cb360-7"><a href="functions.html#cb360-7" tabindex="-1"></a>ar_it_q <span class="ot">&lt;-</span> <span class="fu">sample.int</span>(it_Q_max, it_M, <span class="at">replace=</span><span class="cn">TRUE</span>)</span>
<span id="cb360-8"><a href="functions.html#cb360-8" tabindex="-1"></a></span>
<span id="cb360-9"><a href="functions.html#cb360-9" tabindex="-1"></a><span class="co"># N by Q varying parameters</span></span>
<span id="cb360-10"><a href="functions.html#cb360-10" tabindex="-1"></a>mt_data <span class="ot">&lt;-</span> <span class="fu">cbind</span>(ar_it_q, ar_rnorm_sd)</span>
<span id="cb360-11"><a href="functions.html#cb360-11" tabindex="-1"></a>tb_M <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(mt_data) <span class="sc">%&gt;%</span> <span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">&quot;ID&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb360-12"><a href="functions.html#cb360-12" tabindex="-1"></a>                <span class="fu">rename</span>(<span class="at">sd =</span> ar_rnorm_sd,</span>
<span id="cb360-13"><a href="functions.html#cb360-13" tabindex="-1"></a>                       <span class="at">Q =</span> ar_it_q) <span class="sc">%&gt;%</span></span>
<span id="cb360-14"><a href="functions.html#cb360-14" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">mean =</span> fl_rnorm_mu) <span class="sc">%&gt;%</span></span>
<span id="cb360-15"><a href="functions.html#cb360-15" tabindex="-1"></a>                <span class="fu">select</span>(ID, Q,</span>
<span id="cb360-16"><a href="functions.html#cb360-16" tabindex="-1"></a>                       mean, sd)</span>
<span id="cb360-17"><a href="functions.html#cb360-17" tabindex="-1"></a></span>
<span id="cb360-18"><a href="functions.html#cb360-18" tabindex="-1"></a><span class="co"># Show table</span></span>
<span id="cb360-19"><a href="functions.html#cb360-19" tabindex="-1"></a><span class="fu">kable</span>(tb_M, <span class="at">caption =</span> <span class="fu">paste0</span>(<span class="st">&quot;M=&quot;</span>, it_M,</span>
<span id="cb360-20"><a href="functions.html#cb360-20" tabindex="-1"></a>  <span class="st">&quot; countries (ID is country ID), observation per country (Q)&quot;</span>,</span>
<span id="cb360-21"><a href="functions.html#cb360-21" tabindex="-1"></a>  <span class="st">&quot;, mean and s.d. of wages each country&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb360-22"><a href="functions.html#cb360-22" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-171">Table 3.1: </span>M=10 countries (ID is country ID), observation per country (Q), mean and s.d. of wages each country
</caption>
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ID
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Q
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sd
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0100000
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0311111
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
42
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0522222
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
26
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0733333
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
99
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0944444
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
37
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.1155556
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.1366667
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
43
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.1577778
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
67
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.1788889
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.2000000
</td>
</tr>
</tbody>
</table>
<p>Second, we now expand the dataframe so that each country has not just one row, but <span class="math inline">\(Q_i\)</span> of observations (<span class="math inline">\(i\)</span> is country), or randomly drawn income based on the country-specific income distribution. Note that there are three ways of referring to variable names with dot, which are all shown below:</p>
<ol style="list-style-type: decimal">
<li>We can explicitly refer to names</li>
<li>We can use the <a href="https://stackoverflow.com/a/18228613/8280804">dollar dot structure</a> to use string variable names in do anything.</li>
<li>We can use dot bracket, this is the only option that works with string variable names</li>
</ol>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="functions.html#cb361-1" tabindex="-1"></a><span class="co"># A. Normal Draw Expansion, Explicitly Name</span></span>
<span id="cb361-2"><a href="functions.html#cb361-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="st">&#39;123&#39;</span>)</span>
<span id="cb361-3"><a href="functions.html#cb361-3" tabindex="-1"></a>tb_income_norm_dot_dollar <span class="ot">&lt;-</span> tb_M <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb361-4"><a href="functions.html#cb361-4" tabindex="-1"></a>  <span class="fu">do</span>(<span class="at">income =</span> <span class="fu">rnorm</span>(.<span class="sc">$</span>Q, <span class="at">mean=</span>.<span class="sc">$</span>mean, <span class="at">sd=</span>.<span class="sc">$</span>sd)) <span class="sc">%&gt;%</span></span>
<span id="cb361-5"><a href="functions.html#cb361-5" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="fu">c</span>(income)) <span class="sc">%&gt;%</span></span>
<span id="cb361-6"><a href="functions.html#cb361-6" tabindex="-1"></a>  <span class="fu">left_join</span>(tb_M, <span class="at">by=</span><span class="st">&quot;ID&quot;</span>)</span>
<span id="cb361-7"><a href="functions.html#cb361-7" tabindex="-1"></a></span>
<span id="cb361-8"><a href="functions.html#cb361-8" tabindex="-1"></a><span class="co"># Normal Draw Expansion again, dot dollar differently with string variable name</span></span>
<span id="cb361-9"><a href="functions.html#cb361-9" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="st">&#39;123&#39;</span>)</span>
<span id="cb361-10"><a href="functions.html#cb361-10" tabindex="-1"></a>tb_income_norm_dollar_dot <span class="ot">&lt;-</span> tb_M <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb361-11"><a href="functions.html#cb361-11" tabindex="-1"></a>  <span class="fu">do</span>(<span class="at">income =</span> <span class="fu">rnorm</span>(<span class="st">`</span><span class="at">$</span><span class="st">`</span>(., <span class="st">&#39;Q&#39;</span>), <span class="at">mean =</span> <span class="st">`</span><span class="at">$</span><span class="st">`</span>(., <span class="st">&#39;mean&#39;</span>), <span class="at">sd =</span> <span class="st">`</span><span class="at">$</span><span class="st">`</span>(., <span class="st">&#39;sd&#39;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb361-12"><a href="functions.html#cb361-12" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="fu">c</span>(income)) <span class="sc">%&gt;%</span></span>
<span id="cb361-13"><a href="functions.html#cb361-13" tabindex="-1"></a>  <span class="fu">left_join</span>(tb_M, <span class="at">by=</span><span class="st">&quot;ID&quot;</span>)</span>
<span id="cb361-14"><a href="functions.html#cb361-14" tabindex="-1"></a></span>
<span id="cb361-15"><a href="functions.html#cb361-15" tabindex="-1"></a><span class="co"># Normal Draw Expansion again, dot double bracket</span></span>
<span id="cb361-16"><a href="functions.html#cb361-16" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="st">&#39;123&#39;</span>)</span>
<span id="cb361-17"><a href="functions.html#cb361-17" tabindex="-1"></a>svr_mean <span class="ot">&lt;-</span> <span class="st">&#39;mean&#39;</span></span>
<span id="cb361-18"><a href="functions.html#cb361-18" tabindex="-1"></a>svr_sd <span class="ot">&lt;-</span> <span class="st">&#39;sd&#39;</span></span>
<span id="cb361-19"><a href="functions.html#cb361-19" tabindex="-1"></a>svr_Q <span class="ot">&lt;-</span> <span class="st">&#39;Q&#39;</span></span>
<span id="cb361-20"><a href="functions.html#cb361-20" tabindex="-1"></a>tb_income_norm_dot_bracket_db <span class="ot">&lt;-</span> tb_M <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb361-21"><a href="functions.html#cb361-21" tabindex="-1"></a>  <span class="fu">do</span>(<span class="at">income =</span> <span class="fu">rnorm</span>(.[[svr_Q]], <span class="at">mean =</span> .[[svr_mean]], <span class="at">sd =</span> .[[svr_sd]])) <span class="sc">%&gt;%</span></span>
<span id="cb361-22"><a href="functions.html#cb361-22" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="fu">c</span>(income)) <span class="sc">%&gt;%</span></span>
<span id="cb361-23"><a href="functions.html#cb361-23" tabindex="-1"></a>  <span class="fu">left_join</span>(tb_M, <span class="at">by=</span><span class="st">&quot;ID&quot;</span>)</span></code></pre></div>
<p>Third, we print the first set of rows of the dataframe, and also summarize income by country groups.</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="functions.html#cb362-1" tabindex="-1"></a><span class="co"># Show dataframe dimension</span></span>
<span id="cb362-2"><a href="functions.html#cb362-2" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">dim</span>(tb_income_norm_dot_bracket_db))</span></code></pre></div>
<pre><code>## [1] 541   5</code></pre>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="functions.html#cb364-1" tabindex="-1"></a><span class="co"># Show first 20 rows</span></span>
<span id="cb364-2"><a href="functions.html#cb364-2" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(tb_income_norm_dot_bracket_db, <span class="dv">20</span>),</span>
<span id="cb364-3"><a href="functions.html#cb364-3" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">&quot;ID = country ID, wage draws&quot;</span></span>
<span id="cb364-4"><a href="functions.html#cb364-4" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-173">Table 3.2: </span>ID = country ID, wage draws
</caption>
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ID
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
income
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Q
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sd
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.9943952
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.01
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.9976982
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.01
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.0155871
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.01
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.0007051
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.01
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.0012929
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.01
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.0171506
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.01
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.0046092
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.01
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.9873494
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.01
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.9931315
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.01
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.9955434
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.01
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.0122408
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.01
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.0035981
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.01
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.0040077
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.01
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.0011068
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.01
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.9944416
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.01
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.0178691
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.01
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.0049785
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.01
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.9803338
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.01
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.0070136
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.01
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.9952721
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.01
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="functions.html#cb365-1" tabindex="-1"></a><span class="co"># Display country-specific summaries</span></span>
<span id="cb365-2"><a href="functions.html#cb365-2" tabindex="-1"></a>REconTools<span class="sc">::</span><span class="fu">ff_summ_bygroup</span>(tb_income_norm_dot_bracket_db, <span class="fu">c</span>(<span class="st">&quot;ID&quot;</span>), <span class="st">&quot;income&quot;</span>)<span class="sc">$</span>df_table_grp_stats</span></code></pre></div>
<p>Fourth, there is only one input for the gini function <em>ar_pos</em>. Note that the gini are not very large even with large SD, because these are normal distributions. By Construction, most peple are in the middle. So with almost zero standard deviation, we have perfect equality, as standard deviation increases, inequality increases, but still pretty equal overall, there is no fat upper tail.</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="functions.html#cb366-1" tabindex="-1"></a><span class="co"># Gini by Group</span></span>
<span id="cb366-2"><a href="functions.html#cb366-2" tabindex="-1"></a>tb_gini_norm <span class="ot">&lt;-</span> tb_income_norm_dot_bracket_db <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb366-3"><a href="functions.html#cb366-3" tabindex="-1"></a>  <span class="fu">do</span>(<span class="at">inc_gini_norm =</span> REconTools<span class="sc">::</span><span class="fu">ff_dist_gini_vector_pos</span>(.<span class="sc">$</span>income)) <span class="sc">%&gt;%</span></span>
<span id="cb366-4"><a href="functions.html#cb366-4" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="fu">c</span>(inc_gini_norm)) <span class="sc">%&gt;%</span></span>
<span id="cb366-5"><a href="functions.html#cb366-5" tabindex="-1"></a>  <span class="fu">left_join</span>(tb_M, <span class="at">by=</span><span class="st">&quot;ID&quot;</span>)</span>
<span id="cb366-6"><a href="functions.html#cb366-6" tabindex="-1"></a></span>
<span id="cb366-7"><a href="functions.html#cb366-7" tabindex="-1"></a><span class="co"># display</span></span>
<span id="cb366-8"><a href="functions.html#cb366-8" tabindex="-1"></a><span class="fu">kable</span>(tb_gini_norm,</span>
<span id="cb366-9"><a href="functions.html#cb366-9" tabindex="-1"></a>  <span class="at">caption =</span> <span class="fu">paste0</span>(</span>
<span id="cb366-10"><a href="functions.html#cb366-10" tabindex="-1"></a>    <span class="st">&quot;Country-specific wage GINI based on income draws&quot;</span>,</span>
<span id="cb366-11"><a href="functions.html#cb366-11" tabindex="-1"></a>    <span class="st">&quot;, ID=country-ID, Q=sample-size-per-country&quot;</span>,</span>
<span id="cb366-12"><a href="functions.html#cb366-12" tabindex="-1"></a>    <span class="st">&quot;, mean=true-income-mean, sd=true-income-sd&quot;</span></span>
<span id="cb366-13"><a href="functions.html#cb366-13" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb366-14"><a href="functions.html#cb366-14" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-174">Table 3.3: </span>Country-specific wage GINI based on income draws, ID=country-ID, Q=sample-size-per-country, mean=true-income-mean, sd=true-income-sd
</caption>
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ID
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
inc_gini_norm
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Q
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sd
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0052111
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0100000
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.0137174
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0311111
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.0245939
</td>
<td style="text-align:right;">
42
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0522222
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.0303468
</td>
<td style="text-align:right;">
26
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0733333
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.0527628
</td>
<td style="text-align:right;">
99
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0944444
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0.0544053
</td>
<td style="text-align:right;">
37
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.1155556
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0.0786986
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.1366667
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0.0818873
</td>
<td style="text-align:right;">
43
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.1577778
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
0.1014639
</td>
<td style="text-align:right;">
67
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.1788889
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.0903825
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.2000000
</td>
</tr>
</tbody>
</table>

</div>
</div>
<div id="mxp-by-n-to-mxq-by-nz" class="section level3 hasAnchor" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> (MxP by N) to (MxQ by N+Z)<a href="functions.html#mxp-by-n-to-mxq-by-nz" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> research support package, <a href="https://fanwangecon.github.io/R4Econ/">R4Econ</a> examples page, <a href="https://fanwangecon.github.io/PkgTestR/">PkgTestR</a> packaging guide, or <a href="https://fanwangecon.github.io/Stat4Econ/">Stat4Econ</a> course page.</p>
</blockquote>
<p>There is a dataframe composed of <em>M</em> mini-dataframes. Group by a variable that identifies each unique sub-dataframe, and use the sub-dataframes with <em>P</em> rows as inputs to a function.</p>
<p>The function outputs <em>Q by Z</em> rows and columns of results, stack the results. The output file has <em>MxQ</em> rows and the <em>Z</em> columns of additional results should be appended.</p>
<div id="generate-the-mxp-by-n-dataframe" class="section level4 hasAnchor" number="3.2.3.1">
<h4><span class="header-section-number">3.2.3.1</span> Generate the MxP by N Dataframe<a href="functions.html#generate-the-mxp-by-n-dataframe" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><em>M</em> Grouping characteristics, <em>P</em> rows for each group, and <em>N</em> Variables.</p>
<ol style="list-style-type: decimal">
<li><em>M</em> are individuals</li>
<li><em>P</em> are dates</li>
<li>A wage variable for individual wage at each date. And a savings varaible as well.</li>
</ol>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="functions.html#cb367-1" tabindex="-1"></a><span class="co"># Define</span></span>
<span id="cb367-2"><a href="functions.html#cb367-2" tabindex="-1"></a>it_M <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb367-3"><a href="functions.html#cb367-3" tabindex="-1"></a>it_P <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb367-4"><a href="functions.html#cb367-4" tabindex="-1"></a>svr_m <span class="ot">&lt;-</span> <span class="st">&#39;group_m&#39;</span></span>
<span id="cb367-5"><a href="functions.html#cb367-5" tabindex="-1"></a>svr_mp <span class="ot">&lt;-</span> <span class="st">&#39;info_mp&#39;</span></span>
<span id="cb367-6"><a href="functions.html#cb367-6" tabindex="-1"></a></span>
<span id="cb367-7"><a href="functions.html#cb367-7" tabindex="-1"></a><span class="co"># dataframe</span></span>
<span id="cb367-8"><a href="functions.html#cb367-8" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb367-9"><a href="functions.html#cb367-9" tabindex="-1"></a>df_panel_skeleton <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">matrix</span>(it_P, <span class="at">nrow=</span>it_M, <span class="at">ncol=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb367-10"><a href="functions.html#cb367-10" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="at">var =</span> svr_m) <span class="sc">%&gt;%</span></span>
<span id="cb367-11"><a href="functions.html#cb367-11" tabindex="-1"></a>  <span class="fu">uncount</span>(V1) <span class="sc">%&gt;%</span></span>
<span id="cb367-12"><a href="functions.html#cb367-12" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_m)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_mp) <span class="sc">:=</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb367-13"><a href="functions.html#cb367-13" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb367-14"><a href="functions.html#cb367-14" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">wage =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">100</span>, <span class="dv">10</span>), </span>
<span id="cb367-15"><a href="functions.html#cb367-15" tabindex="-1"></a>                       <span class="at">savings =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">200</span>, <span class="dv">30</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb367-16"><a href="functions.html#cb367-16" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb367-17"><a href="functions.html#cb367-17" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">&quot;id_ji&quot;</span>)</span>
<span id="cb367-18"><a href="functions.html#cb367-18" tabindex="-1"></a></span>
<span id="cb367-19"><a href="functions.html#cb367-19" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb367-20"><a href="functions.html#cb367-20" tabindex="-1"></a><span class="fu">kable</span>(df_panel_skeleton) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
id_ji
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
group_m
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
info_mp
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
wage
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
savings
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
94.39524
</td>
<td style="text-align:right;">
253.6074
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
97.69823
</td>
<td style="text-align:right;">
214.9355
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
115.58708
</td>
<td style="text-align:right;">
141.0015
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
100.70508
</td>
<td style="text-align:right;">
221.0407
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
101.29288
</td>
<td style="text-align:right;">
185.8163
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
117.15065
</td>
<td style="text-align:right;">
167.9653
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
104.60916
</td>
<td style="text-align:right;">
193.4608
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
87.34939
</td>
<td style="text-align:right;">
169.2199
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
93.13147
</td>
<td style="text-align:right;">
178.1333
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
95.54338
</td>
<td style="text-align:right;">
181.2488
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
112.24082
</td>
<td style="text-align:right;">
149.3992
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
103.59814
</td>
<td style="text-align:right;">
225.1336
</td>
</tr>
<tr>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
104.00771
</td>
<td style="text-align:right;">
204.6012
</td>
</tr>
<tr>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
101.10683
</td>
<td style="text-align:right;">
165.8559
</td>
</tr>
<tr>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
94.44159
</td>
<td style="text-align:right;">
237.6144
</td>
</tr>
</tbody>
</table>
</div>
<div id="subgroup-compute-and-expand" class="section level4 hasAnchor" number="3.2.3.2">
<h4><span class="header-section-number">3.2.3.2</span> Subgroup Compute and Expand<a href="functions.html#subgroup-compute-and-expand" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Use the <em>M</em> sub-dataframes, generate <em>Q</em> by <em>Z</em> result for each of the <em>M</em> groups. Stack all results together.</p>
<p>Base on all the wages for each individual, generate individual specific mean and standard deviations. Do this for three things, the wage variable, the savings variable, and the sum of wage and savings:</p>
<ol style="list-style-type: decimal">
<li><em>Z=2</em>: 2 columns, mean and standard deviation</li>
<li><em>Q=3</em>: 3 rows, statistics based on wage, savings, and the sum of both</li>
</ol>
<p>First, here is the processing function that takes the dataframe as input, with a parameter for rounding:</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="functions.html#cb368-1" tabindex="-1"></a><span class="co"># define function</span></span>
<span id="cb368-2"><a href="functions.html#cb368-2" tabindex="-1"></a>ffi_subset_mean_sd <span class="ot">&lt;-</span> <span class="cf">function</span>(df_sub, <span class="at">it_round=</span><span class="dv">1</span>) {</span>
<span id="cb368-3"><a href="functions.html#cb368-3" tabindex="-1"></a>  <span class="co">#&#39; A function that generates mean and sd for several variables</span></span>
<span id="cb368-4"><a href="functions.html#cb368-4" tabindex="-1"></a>  <span class="co">#&#39;</span></span>
<span id="cb368-5"><a href="functions.html#cb368-5" tabindex="-1"></a>  <span class="co">#&#39; @description</span></span>
<span id="cb368-6"><a href="functions.html#cb368-6" tabindex="-1"></a>  <span class="co">#&#39; Assume there are two variables in df_sub wage and savings</span></span>
<span id="cb368-7"><a href="functions.html#cb368-7" tabindex="-1"></a>  <span class="co">#&#39;</span></span>
<span id="cb368-8"><a href="functions.html#cb368-8" tabindex="-1"></a>  <span class="co">#&#39; @param df_sub dataframe where each individual row is a different </span></span>
<span id="cb368-9"><a href="functions.html#cb368-9" tabindex="-1"></a>  <span class="co">#&#39; data point, over which we compute mean and sd, Assum there are two </span></span>
<span id="cb368-10"><a href="functions.html#cb368-10" tabindex="-1"></a>  <span class="co">#&#39; variables, savings and wage</span></span>
<span id="cb368-11"><a href="functions.html#cb368-11" tabindex="-1"></a>  <span class="co">#&#39; @param it_round integer rounding for resulting dataframe</span></span>
<span id="cb368-12"><a href="functions.html#cb368-12" tabindex="-1"></a>  <span class="co">#&#39; @return a dataframe where each row is aggregate for a different type</span></span>
<span id="cb368-13"><a href="functions.html#cb368-13" tabindex="-1"></a>  <span class="co">#&#39; of variablea and each column is a different statistics</span></span>
<span id="cb368-14"><a href="functions.html#cb368-14" tabindex="-1"></a>  </span>
<span id="cb368-15"><a href="functions.html#cb368-15" tabindex="-1"></a>  fl_wage_mn <span class="ot">=</span> <span class="fu">mean</span>(df_sub<span class="sc">$</span>wage)</span>
<span id="cb368-16"><a href="functions.html#cb368-16" tabindex="-1"></a>  fl_wage_sd <span class="ot">=</span> <span class="fu">sd</span>(df_sub<span class="sc">$</span>wage)</span>
<span id="cb368-17"><a href="functions.html#cb368-17" tabindex="-1"></a>  </span>
<span id="cb368-18"><a href="functions.html#cb368-18" tabindex="-1"></a>  fl_save_mn <span class="ot">=</span> <span class="fu">mean</span>(df_sub<span class="sc">$</span>savings)</span>
<span id="cb368-19"><a href="functions.html#cb368-19" tabindex="-1"></a>  fl_save_sd <span class="ot">=</span> <span class="fu">sd</span>(df_sub<span class="sc">$</span>savings)</span>
<span id="cb368-20"><a href="functions.html#cb368-20" tabindex="-1"></a>  </span>
<span id="cb368-21"><a href="functions.html#cb368-21" tabindex="-1"></a>  fl_wgsv_mn <span class="ot">=</span> <span class="fu">mean</span>(df_sub<span class="sc">$</span>wage <span class="sc">+</span> df_sub<span class="sc">$</span>savings)</span>
<span id="cb368-22"><a href="functions.html#cb368-22" tabindex="-1"></a>  fl_wgsv_sd <span class="ot">=</span> <span class="fu">sd</span>(df_sub<span class="sc">$</span>wage <span class="sc">+</span> df_sub<span class="sc">$</span>savings)  </span>
<span id="cb368-23"><a href="functions.html#cb368-23" tabindex="-1"></a>  </span>
<span id="cb368-24"><a href="functions.html#cb368-24" tabindex="-1"></a>  ar_mn <span class="ot">&lt;-</span> <span class="fu">c</span>(fl_wage_mn, fl_save_mn, fl_wgsv_mn)</span>
<span id="cb368-25"><a href="functions.html#cb368-25" tabindex="-1"></a>  ar_sd <span class="ot">&lt;-</span> <span class="fu">c</span>(fl_wage_sd, fl_save_sd, fl_wgsv_sd)</span>
<span id="cb368-26"><a href="functions.html#cb368-26" tabindex="-1"></a>  ar_st_row_lab <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;wage&#39;</span>, <span class="st">&#39;savings&#39;</span>, <span class="st">&#39;wage_and_savings&#39;</span>)</span>
<span id="cb368-27"><a href="functions.html#cb368-27" tabindex="-1"></a>  </span>
<span id="cb368-28"><a href="functions.html#cb368-28" tabindex="-1"></a>  mt_stats <span class="ot">&lt;-</span> <span class="fu">cbind</span>(ar_mn, ar_sd)</span>
<span id="cb368-29"><a href="functions.html#cb368-29" tabindex="-1"></a>  mt_stats <span class="ot">&lt;-</span> <span class="fu">round</span>(mt_stats, it_round)</span>
<span id="cb368-30"><a href="functions.html#cb368-30" tabindex="-1"></a>  </span>
<span id="cb368-31"><a href="functions.html#cb368-31" tabindex="-1"></a>  ar_st_varnames <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;mean&#39;</span>, <span class="st">&#39;sd&#39;</span>, <span class="st">&#39;variables&#39;</span>)</span>
<span id="cb368-32"><a href="functions.html#cb368-32" tabindex="-1"></a>  df_combine <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(mt_stats) <span class="sc">%&gt;%</span> </span>
<span id="cb368-33"><a href="functions.html#cb368-33" tabindex="-1"></a>    <span class="fu">add_column</span>(ar_st_row_lab) <span class="sc">%&gt;%</span></span>
<span id="cb368-34"><a href="functions.html#cb368-34" tabindex="-1"></a>    <span class="fu">rename_all</span>(<span class="sc">~</span><span class="fu">c</span>(ar_st_varnames)) <span class="sc">%&gt;%</span></span>
<span id="cb368-35"><a href="functions.html#cb368-35" tabindex="-1"></a>    <span class="fu">select</span>(variables, <span class="st">&#39;mean&#39;</span>, <span class="st">&#39;sd&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb368-36"><a href="functions.html#cb368-36" tabindex="-1"></a>    <span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">&quot;id_q&quot;</span>)</span>
<span id="cb368-37"><a href="functions.html#cb368-37" tabindex="-1"></a>    </span>
<span id="cb368-38"><a href="functions.html#cb368-38" tabindex="-1"></a>  <span class="fu">return</span>(df_combine)</span>
<span id="cb368-39"><a href="functions.html#cb368-39" tabindex="-1"></a>}</span>
<span id="cb368-40"><a href="functions.html#cb368-40" tabindex="-1"></a><span class="co"># testing function</span></span>
<span id="cb368-41"><a href="functions.html#cb368-41" tabindex="-1"></a><span class="fu">ffi_subset_mean_sd</span>(df_panel_skeleton <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_m)<span class="sc">==</span><span class="dv">1</span>))</span></code></pre></div>
<p>Second, call <em>ffi_subset_mean_sd</em> function for each of the groups indexed by <em>j</em> and stack results together with <em>j</em> index:</p>
<ol style="list-style-type: decimal">
<li>group by</li>
<li>call function</li>
<li>unnest</li>
</ol>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="functions.html#cb369-1" tabindex="-1"></a><span class="co"># run group stats and stack dataframes</span></span>
<span id="cb369-2"><a href="functions.html#cb369-2" tabindex="-1"></a>df_outputs <span class="ot">&lt;-</span> df_panel_skeleton <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(svr_m)) <span class="sc">%&gt;%</span></span>
<span id="cb369-3"><a href="functions.html#cb369-3" tabindex="-1"></a>  <span class="fu">do</span>(<span class="at">df_stats =</span> <span class="fu">ffi_subset_mean_sd</span>(., <span class="at">it_round=</span><span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb369-4"><a href="functions.html#cb369-4" tabindex="-1"></a>  <span class="fu">unnest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb369-5"><a href="functions.html#cb369-5" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">&quot;id_mq&quot;</span>)</span>
<span id="cb369-6"><a href="functions.html#cb369-6" tabindex="-1"></a><span class="co"># print</span></span>
<span id="cb369-7"><a href="functions.html#cb369-7" tabindex="-1"></a><span class="fu">kable</span>(df_outputs) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
id_mq
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
group_m
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
id_q
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
variables
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sd
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
wage
</td>
<td style="text-align:right;">
101.94
</td>
<td style="text-align:right;">
8.11
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
savings
</td>
<td style="text-align:right;">
203.28
</td>
<td style="text-align:right;">
42.33
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
wage_and_savings
</td>
<td style="text-align:right;">
305.22
</td>
<td style="text-align:right;">
34.83
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
wage
</td>
<td style="text-align:right;">
99.56
</td>
<td style="text-align:right;">
11.63
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
savings
</td>
<td style="text-align:right;">
178.01
</td>
<td style="text-align:right;">
10.34
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
wage_and_savings
</td>
<td style="text-align:right;">
277.56
</td>
<td style="text-align:right;">
15.48
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
wage
</td>
<td style="text-align:right;">
103.08
</td>
<td style="text-align:right;">
6.39
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
savings
</td>
<td style="text-align:right;">
196.52
</td>
<td style="text-align:right;">
37.86
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
wage_and_savings
</td>
<td style="text-align:right;">
299.60
</td>
<td style="text-align:right;">
33.50
</td>
</tr>
</tbody>
</table>
<p>In the resulting file, we went from a matrix with <em>MxP</em> rows to a matrix with <em>MxQ</em> Rows.</p>

</div>
</div>
</div>
<div id="apply-and-pmap" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Apply and pmap<a href="functions.html#apply-and-pmap" class="anchor-section" aria-label="Anchor link to header"></a></h2>

<div id="apply-and-sapply" class="section level3 hasAnchor" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Apply and Sapply<a href="functions.html#apply-and-sapply" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> research support package, <a href="https://fanwangecon.github.io/R4Econ/">R4Econ</a> examples page, <a href="https://fanwangecon.github.io/PkgTestR/">PkgTestR</a> packaging guide, or <a href="https://fanwangecon.github.io/Stat4Econ/">Stat4Econ</a> course page.</p>
</blockquote>
<ul>
<li>r apply matrix to function row by row</li>
<li>r evaluate function on grid</li>
<li><a href="https://stackoverflow.com/questions/4236368/apply-a-function-to-every-row-of-a-matrix-or-a-data-frame">Apply a function to every row of a matrix or a data frame</a></li>
<li>r apply</li>
<li>r sapply</li>
<li>sapply over matrix row by row</li>
<li>function as parameters using formulas</li>
<li>do</li>
</ul>
<p>We want evaluate linear function f(x_i, y_i, ar_x, ar_y, c, d), where c and d are constants, and ar_x and ar_y are arrays, both fixed. x_i and y_i vary over each row of matrix. More specifically, we have a functions, this function takes inputs that are individual specific. We would like to evaluate this function concurrently across <span class="math inline">\(N\)</span> individuals.</p>
<p>The function is such that across the <span class="math inline">\(N\)</span> individuals, some of the function parameter inputs are the same, but others are different. If we are looking at demand for a particular product, the prices of all products enter the demand equation for each product, but the product’s own price enters also in a different way.</p>
<p>The objective is either to just evaluate this function across <span class="math inline">\(N\)</span> individuals, or this is a part of a nonlinear solution system.</p>
<p>What is the relationship between apply, lapply and vectorization? see <a href="https://stackoverflow.com/a/29006276/8280804">Is the “*apply” family really not vectorized?</a>.</p>
<div id="set-up-input-arrays-2" class="section level4 hasAnchor" number="3.3.1.1">
<h4><span class="header-section-number">3.3.1.1</span> Set up Input Arrays<a href="functions.html#set-up-input-arrays-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>There is a function that takes <span class="math inline">\(M=Q+P\)</span> inputs, we want to evaluate this function <span class="math inline">\(N\)</span> times. Each time, there are <span class="math inline">\(M\)</span> inputs, where all but <span class="math inline">\(Q\)</span> of the <span class="math inline">\(M\)</span> inputs, meaning <span class="math inline">\(P\)</span> of the <span class="math inline">\(M\)</span> inputs, are the same. In particular, <span class="math inline">\(P=Q*N\)</span>.</p>
<p><span class="math display">\[M = Q+P = Q + Q*N\]</span></p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="functions.html#cb370-1" tabindex="-1"></a><span class="co"># it_child_count = N, the number of children</span></span>
<span id="cb370-2"><a href="functions.html#cb370-2" tabindex="-1"></a>it_N_child_cnt <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb370-3"><a href="functions.html#cb370-3" tabindex="-1"></a><span class="co"># it_heter_param = Q, number of parameters that are</span></span>
<span id="cb370-4"><a href="functions.html#cb370-4" tabindex="-1"></a><span class="co"># heterogeneous across children</span></span>
<span id="cb370-5"><a href="functions.html#cb370-5" tabindex="-1"></a>it_Q_hetpa_cnt <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb370-6"><a href="functions.html#cb370-6" tabindex="-1"></a></span>
<span id="cb370-7"><a href="functions.html#cb370-7" tabindex="-1"></a><span class="co"># P fixed parameters, nN is N dimensional, nP is P dimensional</span></span>
<span id="cb370-8"><a href="functions.html#cb370-8" tabindex="-1"></a>ar_nN_A <span class="ot">=</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="at">length.out =</span> it_N_child_cnt)</span>
<span id="cb370-9"><a href="functions.html#cb370-9" tabindex="-1"></a>ar_nN_alpha <span class="ot">=</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="at">length.out =</span> it_N_child_cnt)</span>
<span id="cb370-10"><a href="functions.html#cb370-10" tabindex="-1"></a>ar_nP_A_alpha <span class="ot">=</span> <span class="fu">c</span>(ar_nN_A, ar_nN_alpha)</span>
<span id="cb370-11"><a href="functions.html#cb370-11" tabindex="-1"></a></span>
<span id="cb370-12"><a href="functions.html#cb370-12" tabindex="-1"></a><span class="co"># N by Q varying parameters</span></span>
<span id="cb370-13"><a href="functions.html#cb370-13" tabindex="-1"></a>mt_nN_by_nQ_A_alpha <span class="ot">=</span> <span class="fu">cbind</span>(ar_nN_A, ar_nN_alpha)</span>
<span id="cb370-14"><a href="functions.html#cb370-14" tabindex="-1"></a></span>
<span id="cb370-15"><a href="functions.html#cb370-15" tabindex="-1"></a><span class="co"># display</span></span>
<span id="cb370-16"><a href="functions.html#cb370-16" tabindex="-1"></a><span class="fu">kable</span>(mt_nN_by_nQ_A_alpha) <span class="sc">%&gt;%</span></span>
<span id="cb370-17"><a href="functions.html#cb370-17" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ar_nN_A
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ar_nN_alpha
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-2
</td>
<td style="text-align:right;">
0.1
</td>
</tr>
<tr>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0.3
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.5
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.7
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.9
</td>
</tr>
</tbody>
</table>
</div>
<div id="using-apply" class="section level4 hasAnchor" number="3.3.1.2">
<h4><span class="header-section-number">3.3.1.2</span> Using apply<a href="functions.html#using-apply" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="named-function" class="section level5 hasAnchor" number="3.3.1.2.1">
<h5><span class="header-section-number">3.3.1.2.1</span> Named Function<a href="functions.html#named-function" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>First we use the apply function, we have to hard-code the arrays that are fixed for each of the <span class="math inline">\(N\)</span> individuals. Then apply allows us to loop over the matrix that is <span class="math inline">\(N\)</span> by <span class="math inline">\(Q\)</span>, each row one at a time, from <span class="math inline">\(1\)</span> to <span class="math inline">\(N\)</span>.</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="functions.html#cb371-1" tabindex="-1"></a><span class="co"># Define Implicit Function</span></span>
<span id="cb371-2"><a href="functions.html#cb371-2" tabindex="-1"></a>ffi_linear_hardcode <span class="ot">&lt;-</span> <span class="cf">function</span>(ar_A_alpha){</span>
<span id="cb371-3"><a href="functions.html#cb371-3" tabindex="-1"></a>  <span class="co"># ar_A_alpha[1] is A</span></span>
<span id="cb371-4"><a href="functions.html#cb371-4" tabindex="-1"></a>  <span class="co"># ar_A_alpha[2] is alpha</span></span>
<span id="cb371-5"><a href="functions.html#cb371-5" tabindex="-1"></a></span>
<span id="cb371-6"><a href="functions.html#cb371-6" tabindex="-1"></a>  fl_out <span class="ot">=</span> <span class="fu">sum</span>(ar_A_alpha[<span class="dv">1</span>]<span class="sc">*</span>ar_nN_A <span class="sc">+</span></span>
<span id="cb371-7"><a href="functions.html#cb371-7" tabindex="-1"></a>                 <span class="dv">1</span><span class="sc">/</span>(ar_A_alpha[<span class="dv">2</span>] <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>ar_nN_alpha))</span>
<span id="cb371-8"><a href="functions.html#cb371-8" tabindex="-1"></a></span>
<span id="cb371-9"><a href="functions.html#cb371-9" tabindex="-1"></a>  <span class="fu">return</span>(fl_out)</span>
<span id="cb371-10"><a href="functions.html#cb371-10" tabindex="-1"></a>}</span>
<span id="cb371-11"><a href="functions.html#cb371-11" tabindex="-1"></a></span>
<span id="cb371-12"><a href="functions.html#cb371-12" tabindex="-1"></a><span class="co"># Evaluate function row by row</span></span>
<span id="cb371-13"><a href="functions.html#cb371-13" tabindex="-1"></a>ar_func_apply <span class="ot">=</span> <span class="fu">apply</span>(mt_nN_by_nQ_A_alpha, <span class="dv">1</span>, ffi_linear_hardcode)</span></code></pre></div>
</div>
<div id="anonymous-function" class="section level5 hasAnchor" number="3.3.1.2.2">
<h5><span class="header-section-number">3.3.1.2.2</span> Anonymous Function<a href="functions.html#anonymous-function" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<ul>
<li>apply over matrix</li>
</ul>
<p>Apply with anonymous function generating a list of arrays of different lengths. In the example below, we want to drawn <span class="math inline">\(N\)</span> sets of random uniform numbers, but for each set the number of draws we want to have is <span class="math inline">\(Q_i\)</span>. Furthermore, we want to rescale the random uniform draws so that they all become proportions that sum u pto one for each <span class="math inline">\(i\)</span>, but then we multply each row’s values by the row specific aggregates.</p>
<p>The anonymous function has hard coded parameters. Using an anonymous function here allows for parameters to be provided inside the function that are shared across each looped evaluation. This is perhaps more convenient than sapply with additional parameters.</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="functions.html#cb372-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1039</span>)</span>
<span id="cb372-2"><a href="functions.html#cb372-2" tabindex="-1"></a></span>
<span id="cb372-3"><a href="functions.html#cb372-3" tabindex="-1"></a><span class="co"># Define the number of draws each row and total amount</span></span>
<span id="cb372-4"><a href="functions.html#cb372-4" tabindex="-1"></a>it_N <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb372-5"><a href="functions.html#cb372-5" tabindex="-1"></a>fl_unif_min <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb372-6"><a href="functions.html#cb372-6" tabindex="-1"></a>fl_unif_max <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb372-7"><a href="functions.html#cb372-7" tabindex="-1"></a>mt_draw_define <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">sample</span>(it_N, it_N, <span class="at">replace=</span><span class="cn">TRUE</span>),</span>
<span id="cb372-8"><a href="functions.html#cb372-8" tabindex="-1"></a>                        <span class="fu">runif</span>(it_N, <span class="at">min=</span><span class="dv">1</span>, <span class="at">max=</span><span class="dv">10</span>))</span>
<span id="cb372-9"><a href="functions.html#cb372-9" tabindex="-1"></a>tb_draw_define <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(mt_draw_define) <span class="sc">%&gt;%</span></span>
<span id="cb372-10"><a href="functions.html#cb372-10" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">&quot;draw_group&quot;</span>)</span>
<span id="cb372-11"><a href="functions.html#cb372-11" tabindex="-1"></a><span class="fu">print</span>(tb_draw_define)</span>
<span id="cb372-12"><a href="functions.html#cb372-12" tabindex="-1"></a></span>
<span id="cb372-13"><a href="functions.html#cb372-13" tabindex="-1"></a><span class="co"># apply row by row, anonymous function has hard</span></span>
<span id="cb372-14"><a href="functions.html#cb372-14" tabindex="-1"></a><span class="co"># coded min and max</span></span>
<span id="cb372-15"><a href="functions.html#cb372-15" tabindex="-1"></a>ls_ar_draws_shares_lvls <span class="ot">=</span></span>
<span id="cb372-16"><a href="functions.html#cb372-16" tabindex="-1"></a>  <span class="fu">apply</span>(tb_draw_define,</span>
<span id="cb372-17"><a href="functions.html#cb372-17" tabindex="-1"></a>        <span class="dv">1</span>,</span>
<span id="cb372-18"><a href="functions.html#cb372-18" tabindex="-1"></a>        <span class="cf">function</span>(row) {</span>
<span id="cb372-19"><a href="functions.html#cb372-19" tabindex="-1"></a>          it_draw <span class="ot">&lt;-</span> row[<span class="dv">2</span>]</span>
<span id="cb372-20"><a href="functions.html#cb372-20" tabindex="-1"></a>          fl_sum <span class="ot">&lt;-</span> row[<span class="dv">3</span>]</span>
<span id="cb372-21"><a href="functions.html#cb372-21" tabindex="-1"></a>          ar_unif <span class="ot">&lt;-</span> <span class="fu">runif</span>(it_draw,</span>
<span id="cb372-22"><a href="functions.html#cb372-22" tabindex="-1"></a>                           <span class="at">min=</span>fl_unif_min,</span>
<span id="cb372-23"><a href="functions.html#cb372-23" tabindex="-1"></a>                           <span class="at">max=</span>fl_unif_max)</span>
<span id="cb372-24"><a href="functions.html#cb372-24" tabindex="-1"></a>          ar_share <span class="ot">&lt;-</span> ar_unif<span class="sc">/</span><span class="fu">sum</span>(ar_unif)</span>
<span id="cb372-25"><a href="functions.html#cb372-25" tabindex="-1"></a>          ar_levels <span class="ot">&lt;-</span> ar_share<span class="sc">*</span>fl_sum</span>
<span id="cb372-26"><a href="functions.html#cb372-26" tabindex="-1"></a>          <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">ar_share=</span>ar_share,</span>
<span id="cb372-27"><a href="functions.html#cb372-27" tabindex="-1"></a>                      <span class="at">ar_levels=</span>ar_levels))</span>
<span id="cb372-28"><a href="functions.html#cb372-28" tabindex="-1"></a>        })</span>
<span id="cb372-29"><a href="functions.html#cb372-29" tabindex="-1"></a></span>
<span id="cb372-30"><a href="functions.html#cb372-30" tabindex="-1"></a><span class="co"># Show Results as list</span></span>
<span id="cb372-31"><a href="functions.html#cb372-31" tabindex="-1"></a><span class="fu">print</span>(ls_ar_draws_shares_lvls)</span></code></pre></div>
<pre><code>## [[1]]
## [[1]]$ar_share
## [1] 0.2783638 0.2224140 0.2797840 0.2194381
## 
## [[1]]$ar_levels
## [1] 1.492414 1.192446 1.500028 1.176491
## 
## 
## [[2]]
## [[2]]$ar_share
## [1] 0.5052919 0.4947081
## 
## [[2]]$ar_levels
## [1] 3.866528 3.785541
## 
## 
## [[3]]
## [[3]]$ar_share
## [1] 1
## 
## [[3]]$ar_levels
##       V2 
## 9.572211 
## 
## 
## [[4]]
## [[4]]$ar_share
## [1] 0.4211426 0.2909812 0.2878762
## 
## [[4]]$ar_levels
## [1] 4.051971 2.799640 2.769765</code></pre>
<p>Above, our results is a list of lists. We can convert this to a table. If all results are scalar, would be regular table where each cell has a single scalar value.</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="functions.html#cb374-1" tabindex="-1"></a><span class="co"># Show results as table</span></span>
<span id="cb374-2"><a href="functions.html#cb374-2" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">as_tibble</span>(<span class="fu">do.call</span>(rbind, ls_ar_draws_shares_lvls))) <span class="sc">%&gt;%</span></span>
<span id="cb374-3"><a href="functions.html#cb374-3" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
ar_share
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
ar_levels
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
0.2783638, 0.2224140, 0.2797840, 0.2194381
</td>
<td style="text-align:left;">
1.492414, 1.192446, 1.500028, 1.176491
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5052919, 0.4947081
</td>
<td style="text-align:left;">
3.866528, 3.785541
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
9.572211
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4211426, 0.2909812, 0.2878762
</td>
<td style="text-align:left;">
4.051971, 2.799640, 2.769765
</td>
</tr>
</tbody>
</table>
<p>We will try to do the same thing as above, but now the output will be a stacked dataframe. Note that within each element of the apply row by row loop, we are generating two variables <em>ar_share</em> and <em>ar_levels</em>. We will not generate a dataframe with multiple columns, storing <em>ar_share</em>, <em>ar_levels</em> as well as information on <em>min</em>, <em>max</em>, number of draws and rescale total sum.</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="functions.html#cb375-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1039</span>)</span>
<span id="cb375-2"><a href="functions.html#cb375-2" tabindex="-1"></a><span class="co"># apply row by row, anonymous function has hard coded min and max</span></span>
<span id="cb375-3"><a href="functions.html#cb375-3" tabindex="-1"></a>ls_mt_draws_shares_lvls <span class="ot">=</span></span>
<span id="cb375-4"><a href="functions.html#cb375-4" tabindex="-1"></a>  <span class="fu">apply</span>(tb_draw_define, <span class="dv">1</span>, <span class="cf">function</span>(row) {</span>
<span id="cb375-5"><a href="functions.html#cb375-5" tabindex="-1"></a></span>
<span id="cb375-6"><a href="functions.html#cb375-6" tabindex="-1"></a>    it_draw_group <span class="ot">&lt;-</span> row[<span class="dv">1</span>]</span>
<span id="cb375-7"><a href="functions.html#cb375-7" tabindex="-1"></a>    it_draw <span class="ot">&lt;-</span> row[<span class="dv">2</span>]</span>
<span id="cb375-8"><a href="functions.html#cb375-8" tabindex="-1"></a>    fl_sum <span class="ot">&lt;-</span> row[<span class="dv">3</span>]</span>
<span id="cb375-9"><a href="functions.html#cb375-9" tabindex="-1"></a></span>
<span id="cb375-10"><a href="functions.html#cb375-10" tabindex="-1"></a>    ar_unif <span class="ot">&lt;-</span> <span class="fu">runif</span>(it_draw,</span>
<span id="cb375-11"><a href="functions.html#cb375-11" tabindex="-1"></a>                     <span class="at">min=</span>fl_unif_min,</span>
<span id="cb375-12"><a href="functions.html#cb375-12" tabindex="-1"></a>                     <span class="at">max=</span>fl_unif_max)</span>
<span id="cb375-13"><a href="functions.html#cb375-13" tabindex="-1"></a>    ar_share <span class="ot">&lt;-</span> ar_unif<span class="sc">/</span><span class="fu">sum</span>(ar_unif)</span>
<span id="cb375-14"><a href="functions.html#cb375-14" tabindex="-1"></a>    ar_levels <span class="ot">&lt;-</span> ar_share<span class="sc">*</span>fl_sum</span>
<span id="cb375-15"><a href="functions.html#cb375-15" tabindex="-1"></a></span>
<span id="cb375-16"><a href="functions.html#cb375-16" tabindex="-1"></a>    mt_all_res <span class="ot">&lt;-</span> <span class="fu">cbind</span>(it_draw_group, it_draw, fl_sum,</span>
<span id="cb375-17"><a href="functions.html#cb375-17" tabindex="-1"></a>                        ar_unif, ar_share, ar_levels)</span>
<span id="cb375-18"><a href="functions.html#cb375-18" tabindex="-1"></a>    <span class="fu">colnames</span>(mt_all_res) <span class="ot">&lt;-</span></span>
<span id="cb375-19"><a href="functions.html#cb375-19" tabindex="-1"></a>      <span class="fu">c</span>(<span class="st">&#39;draw_group&#39;</span>, <span class="st">&#39;draw_count&#39;</span>, <span class="st">&#39;sum&#39;</span>,</span>
<span id="cb375-20"><a href="functions.html#cb375-20" tabindex="-1"></a>        <span class="st">&#39;unif_draw&#39;</span>, <span class="st">&#39;share&#39;</span>, <span class="st">&#39;rescale&#39;</span>)</span>
<span id="cb375-21"><a href="functions.html#cb375-21" tabindex="-1"></a>    <span class="fu">rownames</span>(mt_all_res) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb375-22"><a href="functions.html#cb375-22" tabindex="-1"></a></span>
<span id="cb375-23"><a href="functions.html#cb375-23" tabindex="-1"></a>    <span class="fu">return</span>(mt_all_res)</span>
<span id="cb375-24"><a href="functions.html#cb375-24" tabindex="-1"></a>  })</span>
<span id="cb375-25"><a href="functions.html#cb375-25" tabindex="-1"></a>mt_draws_shares_lvls_all <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, ls_mt_draws_shares_lvls)</span>
<span id="cb375-26"><a href="functions.html#cb375-26" tabindex="-1"></a><span class="co"># Show Results</span></span>
<span id="cb375-27"><a href="functions.html#cb375-27" tabindex="-1"></a><span class="fu">kable</span>(mt_draws_shares_lvls_all) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
draw_group
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
draw_count
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sum
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
unif_draw
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
share
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
rescale
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
5.361378
</td>
<td style="text-align:right;">
1.125668
</td>
<td style="text-align:right;">
0.1988606
</td>
<td style="text-align:right;">
1.066167
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
5.361378
</td>
<td style="text-align:right;">
1.668536
</td>
<td style="text-align:right;">
0.2947638
</td>
<td style="text-align:right;">
1.580340
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
5.361378
</td>
<td style="text-align:right;">
1.419382
</td>
<td style="text-align:right;">
0.2507483
</td>
<td style="text-align:right;">
1.344356
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
5.361378
</td>
<td style="text-align:right;">
1.447001
</td>
<td style="text-align:right;">
0.2556274
</td>
<td style="text-align:right;">
1.370515
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
7.652069
</td>
<td style="text-align:right;">
1.484598
</td>
<td style="text-align:right;">
0.4605236
</td>
<td style="text-align:right;">
3.523959
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
7.652069
</td>
<td style="text-align:right;">
1.739119
</td>
<td style="text-align:right;">
0.5394764
</td>
<td style="text-align:right;">
4.128110
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
9.572211
</td>
<td style="text-align:right;">
1.952468
</td>
<td style="text-align:right;">
1.0000000
</td>
<td style="text-align:right;">
9.572211
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
9.621375
</td>
<td style="text-align:right;">
1.957931
</td>
<td style="text-align:right;">
0.3609352
</td>
<td style="text-align:right;">
3.472693
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
9.621375
</td>
<td style="text-align:right;">
1.926995
</td>
<td style="text-align:right;">
0.3552324
</td>
<td style="text-align:right;">
3.417824
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
9.621375
</td>
<td style="text-align:right;">
1.539678
</td>
<td style="text-align:right;">
0.2838324
</td>
<td style="text-align:right;">
2.730858
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="using-sapply" class="section level4 hasAnchor" number="3.3.1.3">
<h4><span class="header-section-number">3.3.1.3</span> Using sapply<a href="functions.html#using-sapply" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="named-function-1" class="section level5 hasAnchor" number="3.3.1.3.1">
<h5><span class="header-section-number">3.3.1.3.1</span> Named Function<a href="functions.html#named-function-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<ul>
<li>r convert matrix to list</li>
<li>Convert a matrix to a list of vectors in R</li>
</ul>
<p>Sapply allows us to not have tohard code in the A and alpha arrays. But Sapply works over List or Vector, not Matrix. So we have to convert the <span class="math inline">\(N\)</span> by <span class="math inline">\(Q\)</span> matrix to a N element list
Now update the function with sapply.</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="functions.html#cb376-1" tabindex="-1"></a>ls_ar_nN_by_nQ_A_alpha <span class="ot">=</span> <span class="fu">as.list</span>(<span class="fu">data.frame</span>(<span class="fu">t</span>(mt_nN_by_nQ_A_alpha)))</span>
<span id="cb376-2"><a href="functions.html#cb376-2" tabindex="-1"></a></span>
<span id="cb376-3"><a href="functions.html#cb376-3" tabindex="-1"></a><span class="co"># Define Implicit Function</span></span>
<span id="cb376-4"><a href="functions.html#cb376-4" tabindex="-1"></a>ffi_linear_sapply <span class="ot">&lt;-</span> <span class="cf">function</span>(ar_A_alpha, ar_A, ar_alpha){</span>
<span id="cb376-5"><a href="functions.html#cb376-5" tabindex="-1"></a>  <span class="co"># ar_A_alpha[1] is A</span></span>
<span id="cb376-6"><a href="functions.html#cb376-6" tabindex="-1"></a>  <span class="co"># ar_A_alpha[2] is alpha</span></span>
<span id="cb376-7"><a href="functions.html#cb376-7" tabindex="-1"></a></span>
<span id="cb376-8"><a href="functions.html#cb376-8" tabindex="-1"></a>  fl_out <span class="ot">=</span> <span class="fu">sum</span>(ar_A_alpha[<span class="dv">1</span>]<span class="sc">*</span>ar_nN_A <span class="sc">+</span></span>
<span id="cb376-9"><a href="functions.html#cb376-9" tabindex="-1"></a>                 <span class="dv">1</span><span class="sc">/</span>(ar_A_alpha[<span class="dv">2</span>] <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>ar_nN_alpha))</span>
<span id="cb376-10"><a href="functions.html#cb376-10" tabindex="-1"></a></span>
<span id="cb376-11"><a href="functions.html#cb376-11" tabindex="-1"></a>  <span class="fu">return</span>(fl_out)</span>
<span id="cb376-12"><a href="functions.html#cb376-12" tabindex="-1"></a>}</span>
<span id="cb376-13"><a href="functions.html#cb376-13" tabindex="-1"></a></span>
<span id="cb376-14"><a href="functions.html#cb376-14" tabindex="-1"></a><span class="co"># Evaluate function row by row</span></span>
<span id="cb376-15"><a href="functions.html#cb376-15" tabindex="-1"></a>ar_func_sapply <span class="ot">=</span> <span class="fu">sapply</span>(ls_ar_nN_by_nQ_A_alpha, ffi_linear_sapply,</span>
<span id="cb376-16"><a href="functions.html#cb376-16" tabindex="-1"></a>                        <span class="at">ar_A=</span>ar_nN_A, <span class="at">ar_alpha=</span>ar_nN_alpha)</span></code></pre></div>
</div>
<div id="anonymous-function-list-of-arrays-as-output" class="section level5 hasAnchor" number="3.3.1.3.2">
<h5><span class="header-section-number">3.3.1.3.2</span> Anonymous Function, list of arrays as output<a href="functions.html#anonymous-function-list-of-arrays-as-output" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<ul>
<li>sapply anonymous function</li>
<li>r anoymous function multiple lines</li>
</ul>
<p>Sapply with anonymous function generating a list of arrays of different lengths. In the example below, we want to drawn <span class="math inline">\(N\)</span> sets of random uniform numbers, but for each set the number of draws we want to have is <span class="math inline">\(Q_i\)</span>. Furthermore, we want to rescale the random uniform draws so that they all become proportions that sum u pto one for each <span class="math inline">\(i\)</span>.</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="functions.html#cb377-1" tabindex="-1"></a>it_N <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb377-2"><a href="functions.html#cb377-2" tabindex="-1"></a>fl_unif_min <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb377-3"><a href="functions.html#cb377-3" tabindex="-1"></a>fl_unif_max <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb377-4"><a href="functions.html#cb377-4" tabindex="-1"></a></span>
<span id="cb377-5"><a href="functions.html#cb377-5" tabindex="-1"></a><span class="co"># Generate using runif without anonymous function</span></span>
<span id="cb377-6"><a href="functions.html#cb377-6" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1039</span>)</span>
<span id="cb377-7"><a href="functions.html#cb377-7" tabindex="-1"></a>ls_ar_draws <span class="ot">=</span> <span class="fu">sapply</span>(<span class="fu">seq</span>(it_N),</span>
<span id="cb377-8"><a href="functions.html#cb377-8" tabindex="-1"></a>                     runif,</span>
<span id="cb377-9"><a href="functions.html#cb377-9" tabindex="-1"></a>                     <span class="at">min=</span>fl_unif_min, <span class="at">max=</span>fl_unif_max)</span>
<span id="cb377-10"><a href="functions.html#cb377-10" tabindex="-1"></a><span class="fu">print</span>(ls_ar_draws)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 1.125668
## 
## [[2]]
## [1] 1.668536 1.419382
## 
## [[3]]
## [1] 1.447001 1.484598 1.739119
## 
## [[4]]
## [1] 1.952468 1.957931 1.926995 1.539678</code></pre>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="functions.html#cb379-1" tabindex="-1"></a><span class="co"># Generate Using Anonymous Function</span></span>
<span id="cb379-2"><a href="functions.html#cb379-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1039</span>)</span>
<span id="cb379-3"><a href="functions.html#cb379-3" tabindex="-1"></a>ls_ar_draws_shares <span class="ot">=</span> <span class="fu">sapply</span>(<span class="fu">seq</span>(it_N),</span>
<span id="cb379-4"><a href="functions.html#cb379-4" tabindex="-1"></a>                            <span class="cf">function</span>(n, min, max) {</span>
<span id="cb379-5"><a href="functions.html#cb379-5" tabindex="-1"></a>                              ar_unif <span class="ot">&lt;-</span> <span class="fu">runif</span>(n,min,max)</span>
<span id="cb379-6"><a href="functions.html#cb379-6" tabindex="-1"></a>                              ar_share <span class="ot">&lt;-</span> ar_unif<span class="sc">/</span><span class="fu">sum</span>(ar_unif)</span>
<span id="cb379-7"><a href="functions.html#cb379-7" tabindex="-1"></a>                              <span class="fu">return</span>(ar_share)</span>
<span id="cb379-8"><a href="functions.html#cb379-8" tabindex="-1"></a>                            },</span>
<span id="cb379-9"><a href="functions.html#cb379-9" tabindex="-1"></a>                            <span class="at">min=</span>fl_unif_min, <span class="at">max=</span>fl_unif_max)</span>
<span id="cb379-10"><a href="functions.html#cb379-10" tabindex="-1"></a><span class="co"># Print Share</span></span>
<span id="cb379-11"><a href="functions.html#cb379-11" tabindex="-1"></a><span class="fu">print</span>(ls_ar_draws_shares)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 1
## 
## [[2]]
## [1] 0.5403432 0.4596568
## 
## [[3]]
## [1] 0.3098027 0.3178522 0.3723451
## 
## [[4]]
## [1] 0.2646671 0.2654076 0.2612141 0.2087113</code></pre>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="functions.html#cb381-1" tabindex="-1"></a><span class="co"># Sapply with anonymous function to check sums</span></span>
<span id="cb381-2"><a href="functions.html#cb381-2" tabindex="-1"></a><span class="fu">sapply</span>(<span class="fu">seq</span>(it_N), <span class="cf">function</span>(x) {<span class="fu">sum</span>(ls_ar_draws[[x]])})</span></code></pre></div>
<pre><code>## [1] 1.125668 3.087918 4.670717 7.377071</code></pre>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="functions.html#cb383-1" tabindex="-1"></a><span class="fu">sapply</span>(<span class="fu">seq</span>(it_N), <span class="cf">function</span>(x) {<span class="fu">sum</span>(ls_ar_draws_shares[[x]])})</span></code></pre></div>
<pre><code>## [1] 1 1 1 1</code></pre>
</div>
<div id="anonymous-function-matrix-as-output" class="section level5 hasAnchor" number="3.3.1.3.3">
<h5><span class="header-section-number">3.3.1.3.3</span> Anonymous Function, matrix as output<a href="functions.html#anonymous-function-matrix-as-output" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Below, we provide another example with sapply, we generate probabilities for discrete random variables that follow the <a href="https://fanwangecon.github.io/Stat4Econ/probability_discrete/htmlpdfr/binomial.html">binomial distribution</a>. We do this for twice, with “chance of success” set at different values.</p>
<p>The output in this case is a matrix, where each column stores the output from a different dbinom call.</p>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="functions.html#cb385-1" tabindex="-1"></a><span class="co"># First, generate the results without sapply</span></span>
<span id="cb385-2"><a href="functions.html#cb385-2" tabindex="-1"></a>ar_binomprob <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>), <span class="at">nrow=</span><span class="dv">2</span>, <span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb385-3"><a href="functions.html#cb385-3" tabindex="-1"></a><span class="co"># Second, generate the results with sapply</span></span>
<span id="cb385-4"><a href="functions.html#cb385-4" tabindex="-1"></a><span class="co"># dbinom call: dbinom(x, size, prob, log = FALSE)</span></span>
<span id="cb385-5"><a href="functions.html#cb385-5" tabindex="-1"></a><span class="co"># The function requires x, size, and prob.</span></span>
<span id="cb385-6"><a href="functions.html#cb385-6" tabindex="-1"></a><span class="co"># we provide x and size, and each element of ar_binomprob</span></span>
<span id="cb385-7"><a href="functions.html#cb385-7" tabindex="-1"></a><span class="co"># will be a different prob.</span></span>
<span id="cb385-8"><a href="functions.html#cb385-8" tabindex="-1"></a>mt_dbinom <span class="ot">&lt;-</span> <span class="fu">sapply</span>(ar_binomprob, dbinom, <span class="at">x=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">4</span>), <span class="at">size=</span><span class="dv">4</span>)</span>
<span id="cb385-9"><a href="functions.html#cb385-9" tabindex="-1"></a><span class="co"># Third compare results</span></span>
<span id="cb385-10"><a href="functions.html#cb385-10" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&#39;binomial p=&#39;</span>, ar_binomprob[<span class="dv">1</span>]))</span></code></pre></div>
<pre><code>## [1] &quot;binomial p=0.1&quot;</code></pre>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="functions.html#cb387-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">dbinom</span>(<span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">4</span>), <span class="dv">4</span>, ar_binomprob[<span class="dv">1</span>]))</span></code></pre></div>
<pre><code>## [1] 0.6561 0.2916 0.0486 0.0036 0.0001</code></pre>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="functions.html#cb389-1" tabindex="-1"></a><span class="fu">print</span>(mt_dbinom[,<span class="dv">1</span>])</span></code></pre></div>
<pre><code>## [1] 0.6561 0.2916 0.0486 0.0036 0.0001</code></pre>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="functions.html#cb391-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&#39;binomial p=&#39;</span>, ar_binomprob[<span class="dv">2</span>]))</span></code></pre></div>
<pre><code>## [1] &quot;binomial p=0.9&quot;</code></pre>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="functions.html#cb393-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">dbinom</span>(<span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">4</span>), <span class="dv">4</span>, ar_binomprob[<span class="dv">2</span>]))</span></code></pre></div>
<pre><code>## [1] 0.0001 0.0036 0.0486 0.2916 0.6561</code></pre>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="functions.html#cb395-1" tabindex="-1"></a><span class="fu">print</span>(mt_dbinom[,<span class="dv">2</span>])</span></code></pre></div>
<pre><code>## [1] 0.0001 0.0036 0.0486 0.2916 0.6561</code></pre>
</div>
</div>
<div id="compare-results" class="section level4 hasAnchor" number="3.3.1.4">
<h4><span class="header-section-number">3.3.1.4</span> Compare Results<a href="functions.html#compare-results" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="functions.html#cb397-1" tabindex="-1"></a><span class="co"># Show overall Results</span></span>
<span id="cb397-2"><a href="functions.html#cb397-2" tabindex="-1"></a>mt_results <span class="ot">&lt;-</span> <span class="fu">cbind</span>(ar_func_apply, ar_func_sapply)</span>
<span id="cb397-3"><a href="functions.html#cb397-3" tabindex="-1"></a><span class="fu">colnames</span>(mt_results) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;eval_lin_apply&#39;</span>, <span class="st">&#39;eval_lin_sapply&#39;</span>)</span>
<span id="cb397-4"><a href="functions.html#cb397-4" tabindex="-1"></a><span class="fu">kable</span>(mt_results) <span class="sc">%&gt;%</span> <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
eval_lin_apply
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
eval_lin_sapply
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
X1
</td>
<td style="text-align:right;">
2.346356
</td>
<td style="text-align:right;">
2.346356
</td>
</tr>
<tr>
<td style="text-align:left;">
X2
</td>
<td style="text-align:right;">
2.094273
</td>
<td style="text-align:right;">
2.094273
</td>
</tr>
<tr>
<td style="text-align:left;">
X3
</td>
<td style="text-align:right;">
1.895316
</td>
<td style="text-align:right;">
1.895316
</td>
</tr>
<tr>
<td style="text-align:left;">
X4
</td>
<td style="text-align:right;">
1.733708
</td>
<td style="text-align:right;">
1.733708
</td>
</tr>
<tr>
<td style="text-align:left;">
X5
</td>
<td style="text-align:right;">
1.599477
</td>
<td style="text-align:right;">
1.599477
</td>
</tr>
</tbody>
</table>

</div>
</div>
<div id="mutate-evaluate-functions" class="section level3 hasAnchor" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Mutate Evaluate Functions<a href="functions.html#mutate-evaluate-functions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> research support package, <a href="https://fanwangecon.github.io/R4Econ/">R4Econ</a> examples page, <a href="https://fanwangecon.github.io/PkgTestR/">PkgTestR</a> packaging guide, or <a href="https://fanwangecon.github.io/Stat4Econ/">Stat4Econ</a> course page.</p>
</blockquote>
<p>Apply a function over rows of a matrix using mutate, rowwise, etc.</p>
<div id="set-up-input-arrays-3" class="section level4 hasAnchor" number="3.3.2.1">
<h4><span class="header-section-number">3.3.2.1</span> Set up Input Arrays<a href="functions.html#set-up-input-arrays-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>There is a function that takes <span class="math inline">\(M=Q+P\)</span> inputs, we want to evaluate this function <span class="math inline">\(N\)</span> times. Each time, there are <span class="math inline">\(M\)</span> inputs, where all but <span class="math inline">\(Q\)</span> of the <span class="math inline">\(M\)</span> inputs, meaning <span class="math inline">\(P\)</span> of the <span class="math inline">\(M\)</span> inputs, are the same. In particular, <span class="math inline">\(P=Q*N\)</span>.</p>
<p><span class="math display">\[M = Q+P = Q + Q*N\]</span></p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="functions.html#cb398-1" tabindex="-1"></a><span class="co"># it_child_count = N, the number of children</span></span>
<span id="cb398-2"><a href="functions.html#cb398-2" tabindex="-1"></a>it_N_child_cnt <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb398-3"><a href="functions.html#cb398-3" tabindex="-1"></a><span class="co"># it_heter_param = Q, number of parameters that are</span></span>
<span id="cb398-4"><a href="functions.html#cb398-4" tabindex="-1"></a><span class="co"># heterogeneous across children</span></span>
<span id="cb398-5"><a href="functions.html#cb398-5" tabindex="-1"></a>it_Q_hetpa_cnt <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb398-6"><a href="functions.html#cb398-6" tabindex="-1"></a></span>
<span id="cb398-7"><a href="functions.html#cb398-7" tabindex="-1"></a><span class="co"># P fixed parameters, nN is N dimensional, nP is P dimensional</span></span>
<span id="cb398-8"><a href="functions.html#cb398-8" tabindex="-1"></a>ar_nN_A <span class="ot">=</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="at">length.out =</span> it_N_child_cnt)</span>
<span id="cb398-9"><a href="functions.html#cb398-9" tabindex="-1"></a>ar_nN_alpha <span class="ot">=</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="at">length.out =</span> it_N_child_cnt)</span>
<span id="cb398-10"><a href="functions.html#cb398-10" tabindex="-1"></a>ar_nP_A_alpha <span class="ot">=</span> <span class="fu">c</span>(ar_nN_A, ar_nN_alpha)</span>
<span id="cb398-11"><a href="functions.html#cb398-11" tabindex="-1"></a></span>
<span id="cb398-12"><a href="functions.html#cb398-12" tabindex="-1"></a><span class="co"># N by Q varying parameters</span></span>
<span id="cb398-13"><a href="functions.html#cb398-13" tabindex="-1"></a>mt_nN_by_nQ_A_alpha <span class="ot">=</span> <span class="fu">cbind</span>(ar_nN_A, ar_nN_alpha)</span>
<span id="cb398-14"><a href="functions.html#cb398-14" tabindex="-1"></a></span>
<span id="cb398-15"><a href="functions.html#cb398-15" tabindex="-1"></a><span class="co"># display</span></span>
<span id="cb398-16"><a href="functions.html#cb398-16" tabindex="-1"></a><span class="fu">kable</span>(mt_nN_by_nQ_A_alpha) <span class="sc">%&gt;%</span></span>
<span id="cb398-17"><a href="functions.html#cb398-17" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ar_nN_A
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ar_nN_alpha
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-2
</td>
<td style="text-align:right;">
0.1
</td>
</tr>
<tr>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0.3
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.5
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.7
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.9
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="functions.html#cb399-1" tabindex="-1"></a><span class="co"># Convert Matrix to Tibble</span></span>
<span id="cb399-2"><a href="functions.html#cb399-2" tabindex="-1"></a>ar_st_col_names <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;fl_A&#39;</span>, <span class="st">&#39;fl_alpha&#39;</span>)</span>
<span id="cb399-3"><a href="functions.html#cb399-3" tabindex="-1"></a>tb_nN_by_nQ_A_alpha <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(mt_nN_by_nQ_A_alpha) <span class="sc">%&gt;%</span></span>
<span id="cb399-4"><a href="functions.html#cb399-4" tabindex="-1"></a>  <span class="fu">rename_all</span>(<span class="sc">~</span><span class="fu">c</span>(ar_st_col_names))</span>
<span id="cb399-5"><a href="functions.html#cb399-5" tabindex="-1"></a><span class="co"># Show</span></span>
<span id="cb399-6"><a href="functions.html#cb399-6" tabindex="-1"></a><span class="fu">kable</span>(tb_nN_by_nQ_A_alpha) <span class="sc">%&gt;%</span></span>
<span id="cb399-7"><a href="functions.html#cb399-7" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_A
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_alpha
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-2
</td>
<td style="text-align:right;">
0.1
</td>
</tr>
<tr>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0.3
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.5
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.7
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.9
</td>
</tr>
</tbody>
</table>
</div>
<div id="mutate-rowwise" class="section level4 hasAnchor" number="3.3.2.2">
<h4><span class="header-section-number">3.3.2.2</span> mutate rowwise<a href="functions.html#mutate-rowwise" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>dplyr mutate own function</li>
<li>dplyr all row function</li>
<li>dplyr do function</li>
<li>apply function each row dplyr</li>
<li>applying a function to every row of a table using dplyr</li>
<li>dplyr rowwise</li>
</ul>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="functions.html#cb400-1" tabindex="-1"></a><span class="co"># Define Implicit Function</span></span>
<span id="cb400-2"><a href="functions.html#cb400-2" tabindex="-1"></a>ffi_linear_dplyrdo <span class="ot">&lt;-</span> <span class="cf">function</span>(fl_A, fl_alpha, ar_nN_A, ar_nN_alpha){</span>
<span id="cb400-3"><a href="functions.html#cb400-3" tabindex="-1"></a>  <span class="co"># ar_A_alpha[1] is A</span></span>
<span id="cb400-4"><a href="functions.html#cb400-4" tabindex="-1"></a>  <span class="co"># ar_A_alpha[2] is alpha</span></span>
<span id="cb400-5"><a href="functions.html#cb400-5" tabindex="-1"></a></span>
<span id="cb400-6"><a href="functions.html#cb400-6" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&#39;cur row, fl_A=&#39;</span>, fl_A, <span class="st">&#39;, fl_alpha=&#39;</span>, fl_alpha))</span>
<span id="cb400-7"><a href="functions.html#cb400-7" tabindex="-1"></a>  fl_out <span class="ot">=</span> <span class="fu">sum</span>(fl_A<span class="sc">*</span>ar_nN_A <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>(fl_alpha <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>ar_nN_alpha))</span>
<span id="cb400-8"><a href="functions.html#cb400-8" tabindex="-1"></a></span>
<span id="cb400-9"><a href="functions.html#cb400-9" tabindex="-1"></a>  <span class="fu">return</span>(fl_out)</span>
<span id="cb400-10"><a href="functions.html#cb400-10" tabindex="-1"></a>}</span>
<span id="cb400-11"><a href="functions.html#cb400-11" tabindex="-1"></a></span>
<span id="cb400-12"><a href="functions.html#cb400-12" tabindex="-1"></a><span class="co"># Evaluate function row by row of tibble</span></span>
<span id="cb400-13"><a href="functions.html#cb400-13" tabindex="-1"></a><span class="co"># fl_A, fl_alpha are from columns of tb_nN_by_nQ_A_alpha</span></span>
<span id="cb400-14"><a href="functions.html#cb400-14" tabindex="-1"></a>tb_nN_by_nQ_A_alpha_show <span class="ot">&lt;-</span> tb_nN_by_nQ_A_alpha <span class="sc">%&gt;%</span></span>
<span id="cb400-15"><a href="functions.html#cb400-15" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb400-16"><a href="functions.html#cb400-16" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dplyr_eval =</span></span>
<span id="cb400-17"><a href="functions.html#cb400-17" tabindex="-1"></a>           <span class="fu">ffi_linear_dplyrdo</span>(fl_A, fl_alpha, ar_nN_A, ar_nN_alpha))</span></code></pre></div>
<pre><code>## [1] &quot;cur row, fl_A=-2, fl_alpha=0.1&quot;
## [1] &quot;cur row, fl_A=-1, fl_alpha=0.3&quot;
## [1] &quot;cur row, fl_A=0, fl_alpha=0.5&quot;
## [1] &quot;cur row, fl_A=1, fl_alpha=0.7&quot;
## [1] &quot;cur row, fl_A=2, fl_alpha=0.9&quot;</code></pre>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="functions.html#cb402-1" tabindex="-1"></a><span class="co"># Show</span></span>
<span id="cb402-2"><a href="functions.html#cb402-2" tabindex="-1"></a><span class="fu">kable</span>(tb_nN_by_nQ_A_alpha_show) <span class="sc">%&gt;%</span></span>
<span id="cb402-3"><a href="functions.html#cb402-3" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_A
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_alpha
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dplyr_eval
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-2
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
2.346356
</td>
</tr>
<tr>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
2.094273
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
1.895316
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
1.733708
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.9
</td>
<td style="text-align:right;">
1.599477
</td>
</tr>
</tbody>
</table>
<p>same as before, still rowwise, but hard code some inputs:</p>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="functions.html#cb403-1" tabindex="-1"></a><span class="co"># Define function, fixed inputs are not parameters, but</span></span>
<span id="cb403-2"><a href="functions.html#cb403-2" tabindex="-1"></a><span class="co"># defined earlier as a part of the function</span></span>
<span id="cb403-3"><a href="functions.html#cb403-3" tabindex="-1"></a><span class="co"># ar_nN_A, ar_nN_alpha are fixed, not parameters</span></span>
<span id="cb403-4"><a href="functions.html#cb403-4" tabindex="-1"></a>ffi_linear_dplyrdo_func <span class="ot">&lt;-</span> <span class="cf">function</span>(fl_A, fl_alpha){</span>
<span id="cb403-5"><a href="functions.html#cb403-5" tabindex="-1"></a>  fl_out <span class="ot">&lt;-</span> <span class="fu">sum</span>(fl_A<span class="sc">*</span>ar_nN_A <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>(fl_alpha <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>ar_nN_alpha))</span>
<span id="cb403-6"><a href="functions.html#cb403-6" tabindex="-1"></a>  <span class="fu">return</span>(fl_out)</span>
<span id="cb403-7"><a href="functions.html#cb403-7" tabindex="-1"></a>}</span>
<span id="cb403-8"><a href="functions.html#cb403-8" tabindex="-1"></a></span>
<span id="cb403-9"><a href="functions.html#cb403-9" tabindex="-1"></a><span class="co"># Evaluate function row by row of tibble</span></span>
<span id="cb403-10"><a href="functions.html#cb403-10" tabindex="-1"></a>tbfunc_A_nN_by_nQ_A_alpha_rowwise <span class="ot">=</span> tb_nN_by_nQ_A_alpha <span class="sc">%&gt;%</span> <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb403-11"><a href="functions.html#cb403-11" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dplyr_eval =</span> <span class="fu">ffi_linear_dplyrdo_func</span>(fl_A, fl_alpha))</span>
<span id="cb403-12"><a href="functions.html#cb403-12" tabindex="-1"></a><span class="co"># Show</span></span>
<span id="cb403-13"><a href="functions.html#cb403-13" tabindex="-1"></a><span class="fu">kable</span>(tbfunc_A_nN_by_nQ_A_alpha_rowwise) <span class="sc">%&gt;%</span></span>
<span id="cb403-14"><a href="functions.html#cb403-14" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_A
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_alpha
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dplyr_eval
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-2
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
2.346356
</td>
</tr>
<tr>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
2.094273
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
1.895316
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
1.733708
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.9
</td>
<td style="text-align:right;">
1.599477
</td>
</tr>
</tbody>
</table>
</div>
<div id="mutate-with-pmap" class="section level4 hasAnchor" number="3.3.2.3">
<h4><span class="header-section-number">3.3.2.3</span> mutate with pmap<a href="functions.html#mutate-with-pmap" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Apparantly <em>rowwise()</em> is not a good idea, and <em>pmap</em> should be used, below is the <em>pmap</em> solution to the problem. Which does seem nicer. Crucially, don’t have to define input parameter names, automatically I think they are matching up to the names in the function</p>
<ul>
<li>dplyr mutate pass function</li>
<li>r function quosure string multiple</li>
<li>r function multiple parameters as one string</li>
<li>dplyr mutate anonymous function</li>
<li>quosure style lambda</li>
<li>pmap tibble rows</li>
<li>dplyr pwalk</li>
</ul>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="functions.html#cb404-1" tabindex="-1"></a><span class="co"># Define function, fixed inputs are not parameters, but defined</span></span>
<span id="cb404-2"><a href="functions.html#cb404-2" tabindex="-1"></a><span class="co"># earlier as a part of the function Rorate fl_alpha and fl_A name</span></span>
<span id="cb404-3"><a href="functions.html#cb404-3" tabindex="-1"></a><span class="co"># compared to before to make sure pmap tracks by names</span></span>
<span id="cb404-4"><a href="functions.html#cb404-4" tabindex="-1"></a>ffi_linear_dplyrdo_func <span class="ot">&lt;-</span> <span class="cf">function</span>(fl_alpha, fl_A){</span>
<span id="cb404-5"><a href="functions.html#cb404-5" tabindex="-1"></a>  fl_out <span class="ot">&lt;-</span> <span class="fu">sum</span>(fl_A<span class="sc">*</span>ar_nN_A <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>(fl_alpha <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>ar_nN_alpha))</span>
<span id="cb404-6"><a href="functions.html#cb404-6" tabindex="-1"></a>  <span class="fu">return</span>(fl_out)</span>
<span id="cb404-7"><a href="functions.html#cb404-7" tabindex="-1"></a>}</span>
<span id="cb404-8"><a href="functions.html#cb404-8" tabindex="-1"></a></span>
<span id="cb404-9"><a href="functions.html#cb404-9" tabindex="-1"></a><span class="co"># Evaluate a function row by row of dataframe, generate list,</span></span>
<span id="cb404-10"><a href="functions.html#cb404-10" tabindex="-1"></a><span class="co"># then to vector</span></span>
<span id="cb404-11"><a href="functions.html#cb404-11" tabindex="-1"></a>tb_nN_by_nQ_A_alpha <span class="sc">%&gt;%</span> <span class="fu">pmap</span>(ffi_linear_dplyrdo_func) <span class="sc">%&gt;%</span> <span class="fu">unlist</span>()</span></code></pre></div>
<pre><code>## [1] 2.346356 2.094273 1.895316 1.733708 1.599477</code></pre>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb406-1"><a href="functions.html#cb406-1" tabindex="-1"></a><span class="co"># Same as above, but in line line and save output as new column</span></span>
<span id="cb406-2"><a href="functions.html#cb406-2" tabindex="-1"></a><span class="co"># in dataframe note this ONLY works if the tibble only has variables</span></span>
<span id="cb406-3"><a href="functions.html#cb406-3" tabindex="-1"></a><span class="co"># that are inputs for the function if tibble contains additional</span></span>
<span id="cb406-4"><a href="functions.html#cb406-4" tabindex="-1"></a><span class="co">#  variables, those should be droppd, or only the ones needed selected,</span></span>
<span id="cb406-5"><a href="functions.html#cb406-5" tabindex="-1"></a><span class="co"># inside the pmap call below.</span></span>
<span id="cb406-6"><a href="functions.html#cb406-6" tabindex="-1"></a>tbfunc_A_nN_by_nQ_A_alpha_pmap <span class="ot">&lt;-</span> tb_nN_by_nQ_A_alpha <span class="sc">%&gt;%</span></span>
<span id="cb406-7"><a href="functions.html#cb406-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dplyr_eval_pmap =</span></span>
<span id="cb406-8"><a href="functions.html#cb406-8" tabindex="-1"></a>           <span class="fu">unlist</span>(</span>
<span id="cb406-9"><a href="functions.html#cb406-9" tabindex="-1"></a>             <span class="fu">pmap</span>(tb_nN_by_nQ_A_alpha, ffi_linear_dplyrdo_func)</span>
<span id="cb406-10"><a href="functions.html#cb406-10" tabindex="-1"></a>           )</span>
<span id="cb406-11"><a href="functions.html#cb406-11" tabindex="-1"></a>  )</span>
<span id="cb406-12"><a href="functions.html#cb406-12" tabindex="-1"></a></span>
<span id="cb406-13"><a href="functions.html#cb406-13" tabindex="-1"></a><span class="co"># Show</span></span>
<span id="cb406-14"><a href="functions.html#cb406-14" tabindex="-1"></a><span class="fu">kable</span>(tbfunc_A_nN_by_nQ_A_alpha_pmap) <span class="sc">%&gt;%</span></span>
<span id="cb406-15"><a href="functions.html#cb406-15" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_A
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_alpha
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dplyr_eval_pmap
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-2
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
2.346356
</td>
</tr>
<tr>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
2.094273
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
1.895316
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
1.733708
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.9
</td>
<td style="text-align:right;">
1.599477
</td>
</tr>
</tbody>
</table>
</div>
<div id="rowwise-and-do" class="section level4 hasAnchor" number="3.3.2.4">
<h4><span class="header-section-number">3.3.2.4</span> rowwise and do<a href="functions.html#rowwise-and-do" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Now, we have three types of parameters, for something like a bisection type calculation. We will supply the program with a function with some hard-coded value inside, and as parameters, we will have one parameter which is a row in the current matrix, and another parameter which is a sclar values. The three types of parameters are dealt with sparately:</p>
<ol style="list-style-type: decimal">
<li>parameters that are fixed for all bisection iterations, but differ for each row</li>
</ol>
<ul>
<li>these are hard-coded into the function</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>parameters that are fixed for all bisection iterations, but are shared across rows</li>
</ol>
<ul>
<li>these are the first parameter of the function, a list</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>parameters that differ for each iteration, but differ acoss iterations</li>
</ol>
<ul>
<li><p>second scalar value parameter for the function</p></li>
<li><p>dplyr mutate function applow to each row dot notation</p></li>
<li><p>note <a href="https://community.rstudio.com/t/dplyr-alternatives-to-rowwise/8071">rowwise might be bad</a> according to Hadley, should use pmap?</p></li>
</ul>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="functions.html#cb407-1" tabindex="-1"></a>ffi_linear_dplyrdo_fdot <span class="ot">&lt;-</span> <span class="cf">function</span>(ls_row, fl_param){</span>
<span id="cb407-2"><a href="functions.html#cb407-2" tabindex="-1"></a>  <span class="co"># Type 1 Param = ar_nN_A, ar_nN_alpha</span></span>
<span id="cb407-3"><a href="functions.html#cb407-3" tabindex="-1"></a>  <span class="co"># Type 2 Param = ls_row$fl_A, ls_row$fl_alpha</span></span>
<span id="cb407-4"><a href="functions.html#cb407-4" tabindex="-1"></a>  <span class="co"># Type 3 Param = fl_param</span></span>
<span id="cb407-5"><a href="functions.html#cb407-5" tabindex="-1"></a></span>
<span id="cb407-6"><a href="functions.html#cb407-6" tabindex="-1"></a>  fl_out <span class="ot">&lt;-</span> (<span class="fu">sum</span>(ls_row<span class="sc">$</span>fl_A<span class="sc">*</span>ar_nN_A <span class="sc">+</span></span>
<span id="cb407-7"><a href="functions.html#cb407-7" tabindex="-1"></a>                   <span class="dv">1</span><span class="sc">/</span>(ls_row<span class="sc">$</span>fl_alpha <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>ar_nN_alpha))) <span class="sc">+</span> fl_param</span>
<span id="cb407-8"><a href="functions.html#cb407-8" tabindex="-1"></a>  <span class="fu">return</span>(fl_out)</span>
<span id="cb407-9"><a href="functions.html#cb407-9" tabindex="-1"></a>}</span>
<span id="cb407-10"><a href="functions.html#cb407-10" tabindex="-1"></a></span>
<span id="cb407-11"><a href="functions.html#cb407-11" tabindex="-1"></a>cur_func <span class="ot">&lt;-</span> ffi_linear_dplyrdo_fdot</span>
<span id="cb407-12"><a href="functions.html#cb407-12" tabindex="-1"></a>fl_param <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb407-13"><a href="functions.html#cb407-13" tabindex="-1"></a>dplyr_eval_flex <span class="ot">&lt;-</span> tb_nN_by_nQ_A_alpha <span class="sc">%&gt;%</span> <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb407-14"><a href="functions.html#cb407-14" tabindex="-1"></a>  <span class="fu">do</span>(<span class="at">dplyr_eval_flex =</span> <span class="fu">cur_func</span>(., fl_param)) <span class="sc">%&gt;%</span></span>
<span id="cb407-15"><a href="functions.html#cb407-15" tabindex="-1"></a>  <span class="fu">unnest</span>(dplyr_eval_flex)</span>
<span id="cb407-16"><a href="functions.html#cb407-16" tabindex="-1"></a>tbfunc_B_nN_by_nQ_A_alpha <span class="ot">&lt;-</span> tb_nN_by_nQ_A_alpha <span class="sc">%&gt;%</span> <span class="fu">add_column</span>(dplyr_eval_flex)</span>
<span id="cb407-17"><a href="functions.html#cb407-17" tabindex="-1"></a><span class="co"># Show</span></span>
<span id="cb407-18"><a href="functions.html#cb407-18" tabindex="-1"></a><span class="fu">kable</span>(tbfunc_B_nN_by_nQ_A_alpha) <span class="sc">%&gt;%</span></span>
<span id="cb407-19"><a href="functions.html#cb407-19" tabindex="-1"></a>  <span class="fu">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_A
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_alpha
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dplyr_eval_flex
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-2
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
2.346356
</td>
</tr>
<tr>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
2.094273
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
1.895316
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
1.733708
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.9
</td>
<td style="text-align:right;">
1.599477
</td>
</tr>
</tbody>
</table>
</div>
<div id="compare-apply-and-mutate-results" class="section level4 hasAnchor" number="3.3.2.5">
<h4><span class="header-section-number">3.3.2.5</span> Compare Apply and Mutate Results<a href="functions.html#compare-apply-and-mutate-results" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb408-1"><a href="functions.html#cb408-1" tabindex="-1"></a><span class="co"># Show overall Results</span></span>
<span id="cb408-2"><a href="functions.html#cb408-2" tabindex="-1"></a>mt_results <span class="ot">&lt;-</span> <span class="fu">cbind</span>(tb_nN_by_nQ_A_alpha_show[<span class="st">&#39;dplyr_eval&#39;</span>],</span>
<span id="cb408-3"><a href="functions.html#cb408-3" tabindex="-1"></a>                    tbfunc_A_nN_by_nQ_A_alpha_rowwise[<span class="st">&#39;dplyr_eval&#39;</span>],</span>
<span id="cb408-4"><a href="functions.html#cb408-4" tabindex="-1"></a>                    tbfunc_A_nN_by_nQ_A_alpha_pmap[<span class="st">&#39;dplyr_eval_pmap&#39;</span>],</span>
<span id="cb408-5"><a href="functions.html#cb408-5" tabindex="-1"></a>                    tbfunc_B_nN_by_nQ_A_alpha[<span class="st">&#39;dplyr_eval_flex&#39;</span>],</span>
<span id="cb408-6"><a href="functions.html#cb408-6" tabindex="-1"></a>                    mt_nN_by_nQ_A_alpha)</span>
<span id="cb408-7"><a href="functions.html#cb408-7" tabindex="-1"></a><span class="fu">colnames</span>(mt_results) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;eval_dplyr_mutate&#39;</span>,</span>
<span id="cb408-8"><a href="functions.html#cb408-8" tabindex="-1"></a>                          <span class="st">&#39;eval_dplyr_mutate_hcode&#39;</span>,</span>
<span id="cb408-9"><a href="functions.html#cb408-9" tabindex="-1"></a>                          <span class="st">&#39;eval_dplyr_mutate_pmap&#39;</span>,</span>
<span id="cb408-10"><a href="functions.html#cb408-10" tabindex="-1"></a>                          <span class="st">&#39;eval_dplyr_mutate_flex&#39;</span>,</span>
<span id="cb408-11"><a href="functions.html#cb408-11" tabindex="-1"></a>                          <span class="st">&#39;A_child&#39;</span>, <span class="st">&#39;alpha_child&#39;</span>)</span>
<span id="cb408-12"><a href="functions.html#cb408-12" tabindex="-1"></a><span class="fu">kable</span>(mt_results) <span class="sc">%&gt;%</span></span>
<span id="cb408-13"><a href="functions.html#cb408-13" tabindex="-1"></a>  <span class="fu">kable_styling_fc_wide</span>()</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:875px; ">
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
eval_dplyr_mutate
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
eval_dplyr_mutate_hcode
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
eval_dplyr_mutate_pmap
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
eval_dplyr_mutate_flex
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
A_child
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
alpha_child
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
2.346356
</td>
<td style="text-align:right;">
2.346356
</td>
<td style="text-align:right;">
2.346356
</td>
<td style="text-align:right;">
2.346356
</td>
<td style="text-align:right;">
-2
</td>
<td style="text-align:right;">
0.1
</td>
</tr>
<tr>
<td style="text-align:right;">
2.094273
</td>
<td style="text-align:right;">
2.094273
</td>
<td style="text-align:right;">
2.094273
</td>
<td style="text-align:right;">
2.094273
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0.3
</td>
</tr>
<tr>
<td style="text-align:right;">
1.895316
</td>
<td style="text-align:right;">
1.895316
</td>
<td style="text-align:right;">
1.895316
</td>
<td style="text-align:right;">
1.895316
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.5
</td>
</tr>
<tr>
<td style="text-align:right;">
1.733708
</td>
<td style="text-align:right;">
1.733708
</td>
<td style="text-align:right;">
1.733708
</td>
<td style="text-align:right;">
1.733708
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.7
</td>
</tr>
<tr>
<td style="text-align:right;">
1.599477
</td>
<td style="text-align:right;">
1.599477
</td>
<td style="text-align:right;">
1.599477
</td>
<td style="text-align:right;">
1.599477
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.9
</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="manipulate-and-summarize-dataframes.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="multi-dimensional-data-structures.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": [["Panel-Data-and-Optimization-with-R.pdf", "PDF"]],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
