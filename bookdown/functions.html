<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Functions | Data Structures, Estimation and Optimization with R</title>
  <meta name="description" content="Use Python in R with Reticulate" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Functions | Data Structures, Estimation and Optimization with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Use Python in R with Reticulate" />
  <meta name="github-repo" content="fanwangecon/R4Econ" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Functions | Data Structures, Estimation and Optimization with R" />
  
  <meta name="twitter:description" content="Use Python in R with Reticulate" />
  

<meta name="author" content="Fan Wang" />


<meta name="date" content="2020-09-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="summarize-data.html"/>
<link rel="next" href="panel.html"/>
<script src="libs/header-attrs-2.3/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-92953468-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-92953468-5');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Panel Data and Optimization with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html"><i class="fa fa-check"></i><b>1</b> Array, Matrix, Dataframe</a>
<ul>
<li class="chapter" data-level="1.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#list"><i class="fa fa-check"></i><b>1.1</b> List</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#multiple-dimensional-list"><i class="fa fa-check"></i><b>1.1.1</b> Multiple Dimensional List</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#array"><i class="fa fa-check"></i><b>1.2</b> Array</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#array-basics"><i class="fa fa-check"></i><b>1.2.1</b> Array Basics</a></li>
<li class="chapter" data-level="1.2.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-arrays"><i class="fa fa-check"></i><b>1.2.2</b> Generate Arrays</a></li>
<li class="chapter" data-level="1.2.3" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#string-arrays"><i class="fa fa-check"></i><b>1.2.3</b> String Arrays</a></li>
<li class="chapter" data-level="1.2.4" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#mesh-matrices-arrays-and-scalars"><i class="fa fa-check"></i><b>1.2.4</b> Mesh Matrices, Arrays and Scalars</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#matrix"><i class="fa fa-check"></i><b>1.3</b> Matrix</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-matrixes"><i class="fa fa-check"></i><b>1.3.1</b> Generate Matrixes</a></li>
<li class="chapter" data-level="1.3.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#linear-algebra"><i class="fa fa-check"></i><b>1.3.2</b> Linear Algebra</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#variables-in-dataframes"><i class="fa fa-check"></i><b>1.4</b> Variables in Dataframes</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-dataframe"><i class="fa fa-check"></i><b>1.4.1</b> Generate Dataframe</a></li>
<li class="chapter" data-level="1.4.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#factor-label-and-combine"><i class="fa fa-check"></i><b>1.4.2</b> Factor Label and Combine</a></li>
<li class="chapter" data-level="1.4.3" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#drawly-random-rows"><i class="fa fa-check"></i><b>1.4.3</b> Drawly Random Rows</a></li>
<li class="chapter" data-level="1.4.4" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-variables-conditional-on-others"><i class="fa fa-check"></i><b>1.4.4</b> Generate Variables Conditional On Others</a></li>
<li class="chapter" data-level="1.4.5" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#string-values"><i class="fa fa-check"></i><b>1.4.5</b> String Values</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="summarize-data.html"><a href="summarize-data.html"><i class="fa fa-check"></i><b>2</b> Summarize Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="summarize-data.html"><a href="summarize-data.html#counting-observation"><i class="fa fa-check"></i><b>2.1</b> Counting Observation</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="summarize-data.html"><a href="summarize-data.html#uncount"><i class="fa fa-check"></i><b>2.1.1</b> Uncount</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="summarize-data.html"><a href="summarize-data.html#sorting-indexing-slicing"><i class="fa fa-check"></i><b>2.2</b> Sorting, Indexing, Slicing</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="summarize-data.html"><a href="summarize-data.html#sorting"><i class="fa fa-check"></i><b>2.2.1</b> Sorting</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="summarize-data.html"><a href="summarize-data.html#group-statistics"><i class="fa fa-check"></i><b>2.3</b> Group Statistics</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="summarize-data.html"><a href="summarize-data.html#groups-statistics"><i class="fa fa-check"></i><b>2.3.1</b> Groups Statistics</a></li>
<li class="chapter" data-level="2.3.2" data-path="summarize-data.html"><a href="summarize-data.html#one-variable-group-summary"><i class="fa fa-check"></i><b>2.3.2</b> One Variable Group Summary</a></li>
<li class="chapter" data-level="2.3.3" data-path="summarize-data.html"><a href="summarize-data.html#nested-within-group-stats"><i class="fa fa-check"></i><b>2.3.3</b> Nested within Group Stats</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="summarize-data.html"><a href="summarize-data.html#distributional-statistics"><i class="fa fa-check"></i><b>2.4</b> Distributional Statistics</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="summarize-data.html"><a href="summarize-data.html#histogram"><i class="fa fa-check"></i><b>2.4.1</b> Histogram</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="summarize-data.html"><a href="summarize-data.html#summarize-multiple-variables"><i class="fa fa-check"></i><b>2.5</b> Summarize Multiple Variables</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="summarize-data.html"><a href="summarize-data.html#generate-replace-variables"><i class="fa fa-check"></i><b>2.5.1</b> Generate Replace Variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>3</b> Functions</a>
<ul>
<li class="chapter" data-level="3.1" data-path="functions.html"><a href="functions.html#dataframe-mutate"><i class="fa fa-check"></i><b>3.1</b> Dataframe Mutate</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="functions.html"><a href="functions.html#row-input-functions"><i class="fa fa-check"></i><b>3.1.1</b> Row Input Functions</a></li>
<li class="chapter" data-level="3.1.2" data-path="functions.html"><a href="functions.html#evaluate-choices-across-states"><i class="fa fa-check"></i><b>3.1.2</b> Evaluate Choices Across States</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="functions.html"><a href="functions.html#dataframe-do-anything"><i class="fa fa-check"></i><b>3.2</b> Dataframe Do Anything</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="functions.html"><a href="functions.html#mx1-by-n-to-mxq-by-n1"><i class="fa fa-check"></i><b>3.2.1</b> (Mx1 by N) to (MxQ by N+1)</a></li>
<li class="chapter" data-level="3.2.2" data-path="functions.html"><a href="functions.html#mxp-by-n-to-mx1-by-1"><i class="fa fa-check"></i><b>3.2.2</b> (MxP by N) to (Mx1 by 1)</a></li>
<li class="chapter" data-level="3.2.3" data-path="functions.html"><a href="functions.html#mxp-by-n-to-mxq-by-nz"><i class="fa fa-check"></i><b>3.2.3</b> (MxP by N) to (MxQ by N+Z)</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="functions.html"><a href="functions.html#apply-and-pmap"><i class="fa fa-check"></i><b>3.3</b> Apply and pmap</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="functions.html"><a href="functions.html#apply-and-sapply"><i class="fa fa-check"></i><b>3.3.1</b> Apply and Sapply</a></li>
<li class="chapter" data-level="3.3.2" data-path="functions.html"><a href="functions.html#mutate-evaluate-functions"><i class="fa fa-check"></i><b>3.3.2</b> Mutate Evaluate Functions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="panel.html"><a href="panel.html"><i class="fa fa-check"></i><b>4</b> Panel</a>
<ul>
<li class="chapter" data-level="4.1" data-path="panel.html"><a href="panel.html#generate-and-join"><i class="fa fa-check"></i><b>4.1</b> Generate and Join</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="panel.html"><a href="panel.html#generate-panel-structure"><i class="fa fa-check"></i><b>4.1.1</b> Generate Panel Structure</a></li>
<li class="chapter" data-level="4.1.2" data-path="panel.html"><a href="panel.html#join-datasets"><i class="fa fa-check"></i><b>4.1.2</b> Join Datasets</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="panel.html"><a href="panel.html#wide-and-long"><i class="fa fa-check"></i><b>4.2</b> Wide and Long</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="panel.html"><a href="panel.html#long-to-wide"><i class="fa fa-check"></i><b>4.2.1</b> Long to Wide</a></li>
<li class="chapter" data-level="4.2.2" data-path="panel.html"><a href="panel.html#wide-to-long"><i class="fa fa-check"></i><b>4.2.2</b> Wide to Long</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i><b>5</b> Linear Regression</a>
<ul>
<li class="chapter" data-level="5.1" data-path="linear-regression.html"><a href="linear-regression.html#ols-and-iv"><i class="fa fa-check"></i><b>5.1</b> OLS and IV</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="linear-regression.html"><a href="linear-regression.html#ols-and-iv-regression"><i class="fa fa-check"></i><b>5.1.1</b> OLS and IV Regression</a></li>
<li class="chapter" data-level="5.1.2" data-path="linear-regression.html"><a href="linear-regression.html#iv-loop-over-rhs"><i class="fa fa-check"></i><b>5.1.2</b> IV Loop over RHS</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="linear-regression.html"><a href="linear-regression.html#decomposition"><i class="fa fa-check"></i><b>5.2</b> Decomposition</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="linear-regression.html"><a href="linear-regression.html#decompose-rhs"><i class="fa fa-check"></i><b>5.2.1</b> Decompose RHS</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html"><i class="fa fa-check"></i><b>6</b> Nonlinear Regression</a>
<ul>
<li class="chapter" data-level="6.1" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html#logit-regression"><i class="fa fa-check"></i><b>6.1</b> Logit Regression</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html#binary-logit"><i class="fa fa-check"></i><b>6.1.1</b> Binary Logit</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html#quantile-regression"><i class="fa fa-check"></i><b>6.2</b> Quantile Regression</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html#quantile-regression-basics"><i class="fa fa-check"></i><b>6.2.1</b> Quantile Regression Basics</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="optimization.html"><a href="optimization.html"><i class="fa fa-check"></i><b>7</b> Optimization</a>
<ul>
<li class="chapter" data-level="7.1" data-path="optimization.html"><a href="optimization.html#bisection"><i class="fa fa-check"></i><b>7.1</b> Bisection</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="optimization.html"><a href="optimization.html#bisection-1"><i class="fa fa-check"></i><b>7.1.1</b> Bisection</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html"><i class="fa fa-check"></i><b>8</b> Mathmatics and Statistics</a>
<ul>
<li class="chapter" data-level="8.1" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#distributions"><i class="fa fa-check"></i><b>8.1</b> Distributions</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#integrate-over-normal-guassian-process-shock"><i class="fa fa-check"></i><b>8.1.1</b> Integrate Over Normal Guassian Process Shock</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#analytical-solutions"><i class="fa fa-check"></i><b>8.2</b> Analytical Solutions</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#linear-scalar-fx0-solutions"><i class="fa fa-check"></i><b>8.2.1</b> Linear Scalar f(x)=0 Solutions</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#inequality-models"><i class="fa fa-check"></i><b>8.3</b> Inequality Models</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#gini-discrete-sample"><i class="fa fa-check"></i><b>8.3.1</b> Gini Discrete Sample</a></li>
<li class="chapter" data-level="8.3.2" data-path="mathmatics-and-statistics.html"><a href="mathmatics-and-statistics.html#atkinson-inequality-index"><i class="fa fa-check"></i><b>8.3.2</b> Atkinson Inequality Index</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html"><i class="fa fa-check"></i><b>9</b> Tables and Graphs</a>
<ul>
<li class="chapter" data-level="9.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#r-base-plots"><i class="fa fa-check"></i><b>9.1</b> R Base Plots</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#plot-curve-line-and-points"><i class="fa fa-check"></i><b>9.1.1</b> Plot Curve, Line and Points</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#write-and-read-plots"><i class="fa fa-check"></i><b>9.2</b> Write and Read Plots</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#import-and-export-images"><i class="fa fa-check"></i><b>9.2.1</b> Import and Export Images</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="get-data.html"><a href="get-data.html"><i class="fa fa-check"></i><b>10</b> Get Data</a>
<ul>
<li class="chapter" data-level="10.1" data-path="get-data.html"><a href="get-data.html#environmental-data"><i class="fa fa-check"></i><b>10.1</b> Environmental Data</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="get-data.html"><a href="get-data.html#ecmwf-era5-data"><i class="fa fa-check"></i><b>10.1.1</b> ECMWF ERA5 Data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="code-and-development.html"><a href="code-and-development.html"><i class="fa fa-check"></i><b>11</b> Code and Development</a>
<ul>
<li class="chapter" data-level="11.1" data-path="code-and-development.html"><a href="code-and-development.html#file-in-and-out"><i class="fa fa-check"></i><b>11.1</b> File in and Out</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="code-and-development.html"><a href="code-and-development.html#text-to-file"><i class="fa fa-check"></i><b>11.1.1</b> Text to File</a></li>
<li class="chapter" data-level="11.1.2" data-path="code-and-development.html"><a href="code-and-development.html#rmd-to-html"><i class="fa fa-check"></i><b>11.1.2</b> Rmd to HTML</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="code-and-development.html"><a href="code-and-development.html#python-with-r"><i class="fa fa-check"></i><b>11.2</b> Python with R</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="code-and-development.html"><a href="code-and-development.html#reticulate-basics"><i class="fa fa-check"></i><b>11.2.1</b> Reticulate Basics</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="index-and-code-links.html"><a href="index-and-code-links.html"><i class="fa fa-check"></i><b>A</b> Index and Code Links</a>
<ul>
<li class="chapter" data-level="A.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#array-matrix-dataframe-links"><i class="fa fa-check"></i><b>A.1</b> Array, Matrix, Dataframe links</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.1-listlist-links"><i class="fa fa-check"></i><b>A.1.1</b> <span>Section 1.1 List</span> links</a></li>
<li class="chapter" data-level="A.1.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.2-arrayarray-links"><i class="fa fa-check"></i><b>A.1.2</b> <span>Section 1.2 Array</span> links</a></li>
<li class="chapter" data-level="A.1.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.3-matrixmatrix-links"><i class="fa fa-check"></i><b>A.1.3</b> <span>Section 1.3 Matrix</span> links</a></li>
<li class="chapter" data-level="A.1.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.4-variables-in-dataframesvariables-in-dataframes-links"><i class="fa fa-check"></i><b>A.1.4</b> <span>Section 1.4 Variables in Dataframes</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#summarize-data-links"><i class="fa fa-check"></i><b>A.2</b> Summarize Data links</a>
<ul>
<li class="chapter" data-level="A.2.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.1-counting-observationcounting-observation-links"><i class="fa fa-check"></i><b>A.2.1</b> <span>Section 2.1 Counting Observation</span> links</a></li>
<li class="chapter" data-level="A.2.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.2-sorting-indexing-slicingsorting-indexing-slicing-links"><i class="fa fa-check"></i><b>A.2.2</b> <span>Section 2.2 Sorting, Indexing, Slicing</span> links</a></li>
<li class="chapter" data-level="A.2.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.3-group-statisticsgroup-statistics-links"><i class="fa fa-check"></i><b>A.2.3</b> <span>Section 2.3 Group Statistics</span> links</a></li>
<li class="chapter" data-level="A.2.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.4-distributional-statisticsdistributional-statistics-links"><i class="fa fa-check"></i><b>A.2.4</b> <span>Section 2.4 Distributional Statistics</span> links</a></li>
<li class="chapter" data-level="A.2.5" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.5-summarize-multiple-variablessummarize-multiple-variables-links"><i class="fa fa-check"></i><b>A.2.5</b> <span>Section 2.5 Summarize Multiple Variables</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#functions-links"><i class="fa fa-check"></i><b>A.3</b> Functions links</a>
<ul>
<li class="chapter" data-level="A.3.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.1-dataframe-mutatedataframe-mutate-links"><i class="fa fa-check"></i><b>A.3.1</b> <span>Section 3.1 Dataframe Mutate</span> links</a></li>
<li class="chapter" data-level="A.3.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.2-dataframe-do-anythingdataframe-do-anything-links"><i class="fa fa-check"></i><b>A.3.2</b> <span>Section 3.2 Dataframe Do Anything</span> links</a></li>
<li class="chapter" data-level="A.3.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.3-apply-and-pmapapply-and-pmap-links"><i class="fa fa-check"></i><b>A.3.3</b> <span>Section 3.3 Apply and pmap</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#panel-links"><i class="fa fa-check"></i><b>A.4</b> Panel links</a>
<ul>
<li class="chapter" data-level="A.4.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-4.1-generate-and-joingenerate-and-join-links"><i class="fa fa-check"></i><b>A.4.1</b> <span>Section 4.1 Generate and Join</span> links</a></li>
<li class="chapter" data-level="A.4.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-4.2-wide-and-longwide-and-long-links"><i class="fa fa-check"></i><b>A.4.2</b> <span>Section 4.2 Wide and Long</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.5" data-path="index-and-code-links.html"><a href="index-and-code-links.html#linear-regression-links"><i class="fa fa-check"></i><b>A.5</b> Linear Regression links</a>
<ul>
<li class="chapter" data-level="A.5.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-5.1-ols-and-ivols-and-iv-links"><i class="fa fa-check"></i><b>A.5.1</b> <span>Section 5.1 OLS and IV</span> links</a></li>
<li class="chapter" data-level="A.5.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-5.2-decompositiondecomposition-links"><i class="fa fa-check"></i><b>A.5.2</b> <span>Section 5.2 Decomposition</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.6" data-path="index-and-code-links.html"><a href="index-and-code-links.html#nonlinear-regression-links"><i class="fa fa-check"></i><b>A.6</b> Nonlinear Regression links</a>
<ul>
<li class="chapter" data-level="A.6.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-6.1-logit-regressionlogit-regression-links"><i class="fa fa-check"></i><b>A.6.1</b> <span>Section 6.1 Logit Regression</span> links</a></li>
<li class="chapter" data-level="A.6.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-6.2-quantile-regressionquantile-regression-links"><i class="fa fa-check"></i><b>A.6.2</b> <span>Section 6.2 Quantile Regression</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.7" data-path="index-and-code-links.html"><a href="index-and-code-links.html#optimization-links"><i class="fa fa-check"></i><b>A.7</b> Optimization links</a>
<ul>
<li class="chapter" data-level="A.7.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-7.1-bisectionbisection-links"><i class="fa fa-check"></i><b>A.7.1</b> <span>Section 7.1 Bisection</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.8" data-path="index-and-code-links.html"><a href="index-and-code-links.html#mathmatics-and-statistics-links"><i class="fa fa-check"></i><b>A.8</b> Mathmatics and Statistics links</a>
<ul>
<li class="chapter" data-level="A.8.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-8.1-distributionsdistributions-links"><i class="fa fa-check"></i><b>A.8.1</b> <span>Section 8.1 Distributions</span> links</a></li>
<li class="chapter" data-level="A.8.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-8.2-analytical-solutionsanalytical-solutions-links"><i class="fa fa-check"></i><b>A.8.2</b> <span>Section 8.2 Analytical Solutions</span> links</a></li>
<li class="chapter" data-level="A.8.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-8.3-inequality-modelsinequality-models-links"><i class="fa fa-check"></i><b>A.8.3</b> <span>Section 8.3 Inequality Models</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.9" data-path="index-and-code-links.html"><a href="index-and-code-links.html#tables-and-graphs-links"><i class="fa fa-check"></i><b>A.9</b> Tables and Graphs links</a>
<ul>
<li class="chapter" data-level="A.9.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-9.1-r-base-plotsr-base-plots-links"><i class="fa fa-check"></i><b>A.9.1</b> <span>Section 9.1 R Base Plots</span> links</a></li>
<li class="chapter" data-level="A.9.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-9.2-write-and-read-plotswrite-and-read-plots-links"><i class="fa fa-check"></i><b>A.9.2</b> <span>Section 9.2 Write and Read Plots</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.10" data-path="index-and-code-links.html"><a href="index-and-code-links.html#get-data-links"><i class="fa fa-check"></i><b>A.10</b> Get Data links</a>
<ul>
<li class="chapter" data-level="A.10.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-10.1-environmental-dataenvironmental-data-links"><i class="fa fa-check"></i><b>A.10.1</b> <span>Section 10.1 Environmental Data</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.11" data-path="index-and-code-links.html"><a href="index-and-code-links.html#code-and-development-links"><i class="fa fa-check"></i><b>A.11</b> Code and Development links</a>
<ul>
<li class="chapter" data-level="A.11.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-11.1-file-in-and-outfile-in-and-out-links"><i class="fa fa-check"></i><b>A.11.1</b> <span>Section 11.1 File in and Out</span> links</a></li>
<li class="chapter" data-level="A.11.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-11.2-python-with-rpython-with-r-links"><i class="fa fa-check"></i><b>A.11.2</b> <span>Section 11.2 Python with R</span> links</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://fanwangecon.github.io/R4Econ/bookdown/index.html" target="blank">R4Econ Bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Structures, Estimation and Optimization with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="functions" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> Functions</h1>

<div id="dataframe-mutate" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Dataframe Mutate</h2>

<div id="row-input-functions" class="section level3" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Row Input Functions</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R Code Examples</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository (<a href="https://fanwangecon.github.io/Stat4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<p>We want evaluate nonlinear function f(Q_i, y_i, ar_x, ar_y, c, d), where c and d are constants, and ar_x and ar_y are arrays, both fixed. x_i and y_i vary over each row of matrix. We would like to evaluate this nonlinear function concurrently across <span class="math inline">\(N\)</span> individuals. The eventual goal is to find the <span class="math inline">\(i\)</span> specific <span class="math inline">\(Q\)</span> that solves the nonlinear equations.</p>
<p>This is a continuation of <a href="https://fanwangecon.github.io/R4Econ/function/noloop/fs_applysapplymutate.html">R use Apply, Sapply and dplyr Mutate to Evaluate one Function Across Rows of a Matrix</a></p>
<div id="set-up-input-arrays" class="section level4" number="3.1.1.1">
<h4><span class="header-section-number">3.1.1.1</span> Set up Input Arrays</h4>
<p>There is a function that takes <span class="math inline">\(M=Q+P\)</span> inputs, we want to evaluate this function <span class="math inline">\(N\)</span> times. Each time, there are <span class="math inline">\(M\)</span> inputs, where all but <span class="math inline">\(Q\)</span> of the <span class="math inline">\(M\)</span> inputs, meaning <span class="math inline">\(P\)</span> of the <span class="math inline">\(M\)</span> inputs, are the same. In particular, <span class="math inline">\(P=Q*N\)</span>.</p>
<p><span class="math display">\[M = Q+P = Q + Q*N\]</span></p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="functions.html#cb211-1" aria-hidden="true"></a><span class="co"># it_child_count = N, the number of children</span></span>
<span id="cb211-2"><a href="functions.html#cb211-2" aria-hidden="true"></a>it_N_child_cnt =<span class="st"> </span><span class="dv">5</span></span>
<span id="cb211-3"><a href="functions.html#cb211-3" aria-hidden="true"></a><span class="co"># it_heter_param = Q, number of parameters that are heterogeneous across children</span></span>
<span id="cb211-4"><a href="functions.html#cb211-4" aria-hidden="true"></a>it_Q_hetpa_cnt =<span class="st"> </span><span class="dv">2</span></span>
<span id="cb211-5"><a href="functions.html#cb211-5" aria-hidden="true"></a></span>
<span id="cb211-6"><a href="functions.html#cb211-6" aria-hidden="true"></a><span class="co"># P fixed parameters, nN is N dimensional, nP is P dimensional</span></span>
<span id="cb211-7"><a href="functions.html#cb211-7" aria-hidden="true"></a>ar_nN_A =<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dt">length.out =</span> it_N_child_cnt)</span>
<span id="cb211-8"><a href="functions.html#cb211-8" aria-hidden="true"></a>ar_nN_alpha =<span class="st"> </span><span class="kw">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="dt">length.out =</span> it_N_child_cnt)</span>
<span id="cb211-9"><a href="functions.html#cb211-9" aria-hidden="true"></a>ar_nP_A_alpha =<span class="st"> </span><span class="kw">c</span>(ar_nN_A, ar_nN_alpha)</span>
<span id="cb211-10"><a href="functions.html#cb211-10" aria-hidden="true"></a>ar_nN_N_choice =<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>,it_N_child_cnt)<span class="op">/</span><span class="kw">sum</span>(<span class="kw">seq</span>(<span class="dv">1</span>,it_N_child_cnt))</span>
<span id="cb211-11"><a href="functions.html#cb211-11" aria-hidden="true"></a></span>
<span id="cb211-12"><a href="functions.html#cb211-12" aria-hidden="true"></a><span class="co"># N by Q varying parameters</span></span>
<span id="cb211-13"><a href="functions.html#cb211-13" aria-hidden="true"></a>mt_nN_by_nQ_A_alpha =<span class="st"> </span><span class="kw">cbind</span>(ar_nN_A, ar_nN_alpha, ar_nN_N_choice)</span>
<span id="cb211-14"><a href="functions.html#cb211-14" aria-hidden="true"></a></span>
<span id="cb211-15"><a href="functions.html#cb211-15" aria-hidden="true"></a><span class="co"># Convert Matrix to Tibble</span></span>
<span id="cb211-16"><a href="functions.html#cb211-16" aria-hidden="true"></a>ar_st_col_names =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;fl_A&#39;</span>, <span class="st">&#39;fl_alpha&#39;</span>, <span class="st">&#39;fl_N&#39;</span>)</span>
<span id="cb211-17"><a href="functions.html#cb211-17" aria-hidden="true"></a>tb_nN_by_nQ_A_alpha &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(mt_nN_by_nQ_A_alpha) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename_all</span>(<span class="op">~</span><span class="kw">c</span>(ar_st_col_names))</span>
<span id="cb211-18"><a href="functions.html#cb211-18" aria-hidden="true"></a></span>
<span id="cb211-19"><a href="functions.html#cb211-19" aria-hidden="true"></a><span class="co"># Show</span></span>
<span id="cb211-20"><a href="functions.html#cb211-20" aria-hidden="true"></a><span class="kw">kable</span>(tb_nN_by_nQ_A_alpha) <span class="op">%&gt;%</span></span>
<span id="cb211-21"><a href="functions.html#cb211-21" aria-hidden="true"></a><span class="st">  </span><span class="kw">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_A
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_alpha
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_N
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-2
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
0.0666667
</td>
</tr>
<tr>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
0.1333333
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.2000000
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
0.2666667
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.9
</td>
<td style="text-align:right;">
0.3333333
</td>
</tr>
</tbody>
</table>
</div>
<div id="mutate-over-simple-function" class="section level4" number="3.1.1.2">
<h4><span class="header-section-number">3.1.1.2</span> Mutate over Simple Function</h4>
<p>For this example, use a very simple function with only one type of input, all inputs are scalars.</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="functions.html#cb212-1" aria-hidden="true"></a><span class="co"># Define Implicit Function</span></span>
<span id="cb212-2"><a href="functions.html#cb212-2" aria-hidden="true"></a>ffi_nonlinear &lt;-<span class="st"> </span><span class="cf">function</span>(fl_A, fl_alpha){</span>
<span id="cb212-3"><a href="functions.html#cb212-3" aria-hidden="true"></a></span>
<span id="cb212-4"><a href="functions.html#cb212-4" aria-hidden="true"></a>  fl_out &lt;-<span class="st"> </span>(fl_A <span class="op">+</span><span class="st"> </span>fl_alpha<span class="op">*</span>fl_A)<span class="op">/</span>(fl_A)<span class="op">^</span><span class="dv">2</span></span>
<span id="cb212-5"><a href="functions.html#cb212-5" aria-hidden="true"></a></span>
<span id="cb212-6"><a href="functions.html#cb212-6" aria-hidden="true"></a>  <span class="kw">return</span>(fl_out)</span>
<span id="cb212-7"><a href="functions.html#cb212-7" aria-hidden="true"></a>}</span></code></pre></div>
<p>Apply the function over the dataframe, note five different ways below, the third way allows for parameters to be strings.</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="functions.html#cb213-1" aria-hidden="true"></a><span class="co"># variable names</span></span>
<span id="cb213-2"><a href="functions.html#cb213-2" aria-hidden="true"></a>svr_fl_A &lt;-<span class="st"> &#39;fl_A&#39;</span></span>
<span id="cb213-3"><a href="functions.html#cb213-3" aria-hidden="true"></a>svr_fl_alpha &lt;-<span class="st"> &#39;fl_alpha&#39;</span></span>
<span id="cb213-4"><a href="functions.html#cb213-4" aria-hidden="true"></a></span>
<span id="cb213-5"><a href="functions.html#cb213-5" aria-hidden="true"></a><span class="co"># Evaluate</span></span>
<span id="cb213-6"><a href="functions.html#cb213-6" aria-hidden="true"></a>tb_nN_by_nQ_A_alpha_mutate_rows &lt;-<span class="st"> </span>tb_nN_by_nQ_A_alpha <span class="op">%&gt;%</span></span>
<span id="cb213-7"><a href="functions.html#cb213-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fl_out_m1 =</span> <span class="kw">ffi_nonlinear</span>(<span class="dt">fl_A=</span>.<span class="op">$</span>fl_A, <span class="dt">fl_alpha=</span>.<span class="op">$</span>fl_alpha),</span>
<span id="cb213-8"><a href="functions.html#cb213-8" aria-hidden="true"></a>         <span class="dt">fl_out_m2 =</span> <span class="kw">ffi_nonlinear</span>(<span class="dt">fl_A=</span><span class="st">`</span><span class="dt">$</span><span class="st">`</span>(., <span class="st">&#39;fl_A&#39;</span>), <span class="dt">fl_alpha=</span><span class="st">`</span><span class="dt">$</span><span class="st">`</span>(., <span class="st">&#39;fl_alpha&#39;</span>)),</span>
<span id="cb213-9"><a href="functions.html#cb213-9" aria-hidden="true"></a>         <span class="dt">fl_out_m3 =</span> <span class="kw">ffi_nonlinear</span>(<span class="dt">fl_A=</span>.[[svr_fl_A]], <span class="dt">fl_alpha=</span>.[[svr_fl_alpha]]),</span>
<span id="cb213-10"><a href="functions.html#cb213-10" aria-hidden="true"></a>         <span class="dt">fl_out_m4 =</span> <span class="kw">ffi_nonlinear</span>(<span class="dt">fl_A=</span>fl_A, <span class="dt">fl_alpha=</span>fl_alpha),</span>
<span id="cb213-11"><a href="functions.html#cb213-11" aria-hidden="true"></a>         <span class="dt">fl_out_m5 =</span> <span class="kw">ffi_nonlinear</span>(fl_A, fl_alpha))</span>
<span id="cb213-12"><a href="functions.html#cb213-12" aria-hidden="true"></a></span>
<span id="cb213-13"><a href="functions.html#cb213-13" aria-hidden="true"></a><span class="co"># print</span></span>
<span id="cb213-14"><a href="functions.html#cb213-14" aria-hidden="true"></a><span class="kw">kable</span>(tb_nN_by_nQ_A_alpha_mutate_rows) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_A
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_alpha
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_N
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_out_m1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_out_m2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_out_m3
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_out_m4
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_out_m5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-2
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
0.0666667
</td>
<td style="text-align:right;">
-0.55
</td>
<td style="text-align:right;">
-0.55
</td>
<td style="text-align:right;">
-0.55
</td>
<td style="text-align:right;">
-0.55
</td>
<td style="text-align:right;">
-0.55
</td>
</tr>
<tr>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
0.1333333
</td>
<td style="text-align:right;">
-1.30
</td>
<td style="text-align:right;">
-1.30
</td>
<td style="text-align:right;">
-1.30
</td>
<td style="text-align:right;">
-1.30
</td>
<td style="text-align:right;">
-1.30
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.2000000
</td>
<td style="text-align:right;">
NaN
</td>
<td style="text-align:right;">
NaN
</td>
<td style="text-align:right;">
NaN
</td>
<td style="text-align:right;">
NaN
</td>
<td style="text-align:right;">
NaN
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
0.2666667
</td>
<td style="text-align:right;">
1.70
</td>
<td style="text-align:right;">
1.70
</td>
<td style="text-align:right;">
1.70
</td>
<td style="text-align:right;">
1.70
</td>
<td style="text-align:right;">
1.70
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.9
</td>
<td style="text-align:right;">
0.3333333
</td>
<td style="text-align:right;">
0.95
</td>
<td style="text-align:right;">
0.95
</td>
<td style="text-align:right;">
0.95
</td>
<td style="text-align:right;">
0.95
</td>
<td style="text-align:right;">
0.95
</td>
</tr>
</tbody>
</table>
</div>
<div id="testing-function-with-scalar-and-arrays" class="section level4" number="3.1.1.3">
<h4><span class="header-section-number">3.1.1.3</span> Testing Function with Scalar and Arrays</h4>
<p>Test non-linear Equation.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="functions.html#cb214-1" aria-hidden="true"></a><span class="co"># Test Parameters</span></span>
<span id="cb214-2"><a href="functions.html#cb214-2" aria-hidden="true"></a>fl_N_agg =<span class="st"> </span><span class="dv">100</span></span>
<span id="cb214-3"><a href="functions.html#cb214-3" aria-hidden="true"></a>fl_rho =<span class="st"> </span><span class="dv">-1</span></span>
<span id="cb214-4"><a href="functions.html#cb214-4" aria-hidden="true"></a>fl_N_q =<span class="st"> </span>ar_nN_N_choice[<span class="dv">4</span>]<span class="op">*</span>fl_N_agg</span>
<span id="cb214-5"><a href="functions.html#cb214-5" aria-hidden="true"></a>ar_A_alpha =<span class="st"> </span>mt_nN_by_nQ_A_alpha[<span class="dv">4</span>,]</span>
<span id="cb214-6"><a href="functions.html#cb214-6" aria-hidden="true"></a><span class="co"># Apply Function</span></span>
<span id="cb214-7"><a href="functions.html#cb214-7" aria-hidden="true"></a>ar_p1_s1 =<span class="st"> </span><span class="kw">exp</span>((ar_A_alpha[<span class="dv">1</span>] <span class="op">-</span><span class="st"> </span>ar_nN_A)<span class="op">*</span>fl_rho)</span>
<span id="cb214-8"><a href="functions.html#cb214-8" aria-hidden="true"></a>ar_p1_s2 =<span class="st"> </span>(ar_A_alpha[<span class="dv">2</span>]<span class="op">/</span>ar_nN_alpha)</span>
<span id="cb214-9"><a href="functions.html#cb214-9" aria-hidden="true"></a>ar_p1_s3 =<span class="st"> </span>(<span class="dv">1</span><span class="op">/</span>(ar_nN_alpha<span class="op">*</span>fl_rho <span class="op">-</span><span class="st"> </span><span class="dv">1</span>))</span>
<span id="cb214-10"><a href="functions.html#cb214-10" aria-hidden="true"></a>ar_p1 =<span class="st"> </span>(ar_p1_s1<span class="op">*</span>ar_p1_s2)<span class="op">^</span>ar_p1_s3</span>
<span id="cb214-11"><a href="functions.html#cb214-11" aria-hidden="true"></a>ar_p2 =<span class="st"> </span>fl_N_q<span class="op">^</span>((ar_A_alpha[<span class="dv">2</span>]<span class="op">*</span>fl_rho<span class="dv">-1</span>)<span class="op">/</span>(ar_nN_alpha<span class="op">*</span>fl_rho<span class="dv">-1</span>))</span>
<span id="cb214-12"><a href="functions.html#cb214-12" aria-hidden="true"></a>ar_overall =<span class="st"> </span>ar_p1<span class="op">*</span>ar_p2</span>
<span id="cb214-13"><a href="functions.html#cb214-13" aria-hidden="true"></a>fl_overall =<span class="st"> </span>fl_N_agg <span class="op">-</span><span class="st"> </span><span class="kw">sum</span>(ar_overall)</span>
<span id="cb214-14"><a href="functions.html#cb214-14" aria-hidden="true"></a><span class="kw">print</span>(fl_overall)</span></code></pre></div>
<pre><code>## [1] -598.2559</code></pre>
<p>Implement the non-linear problem’s evaluation using apply over all <span class="math inline">\(N\)</span> individuals.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="functions.html#cb216-1" aria-hidden="true"></a><span class="co"># Define Implicit Function</span></span>
<span id="cb216-2"><a href="functions.html#cb216-2" aria-hidden="true"></a>ffi_nonlin_dplyrdo &lt;-<span class="st"> </span><span class="cf">function</span>(fl_A, fl_alpha, fl_N, ar_A, ar_alpha, fl_N_agg, fl_rho){</span>
<span id="cb216-3"><a href="functions.html#cb216-3" aria-hidden="true"></a>  <span class="co"># ar_A_alpha[1] is A</span></span>
<span id="cb216-4"><a href="functions.html#cb216-4" aria-hidden="true"></a>  <span class="co"># ar_A_alpha[2] is alpha</span></span>
<span id="cb216-5"><a href="functions.html#cb216-5" aria-hidden="true"></a></span>
<span id="cb216-6"><a href="functions.html#cb216-6" aria-hidden="true"></a>  <span class="co"># # Test Parameters</span></span>
<span id="cb216-7"><a href="functions.html#cb216-7" aria-hidden="true"></a>  <span class="co"># fl_N = 100</span></span>
<span id="cb216-8"><a href="functions.html#cb216-8" aria-hidden="true"></a>  <span class="co"># fl_rho = -1</span></span>
<span id="cb216-9"><a href="functions.html#cb216-9" aria-hidden="true"></a>  <span class="co"># fl_N_q = 10</span></span>
<span id="cb216-10"><a href="functions.html#cb216-10" aria-hidden="true"></a></span>
<span id="cb216-11"><a href="functions.html#cb216-11" aria-hidden="true"></a>  <span class="co"># Apply Function</span></span>
<span id="cb216-12"><a href="functions.html#cb216-12" aria-hidden="true"></a>  ar_p1_s1 =<span class="st"> </span><span class="kw">exp</span>((fl_A <span class="op">-</span><span class="st"> </span>ar_A)<span class="op">*</span>fl_rho)</span>
<span id="cb216-13"><a href="functions.html#cb216-13" aria-hidden="true"></a>  ar_p1_s2 =<span class="st"> </span>(fl_alpha<span class="op">/</span>ar_alpha)</span>
<span id="cb216-14"><a href="functions.html#cb216-14" aria-hidden="true"></a>  ar_p1_s3 =<span class="st"> </span>(<span class="dv">1</span><span class="op">/</span>(ar_alpha<span class="op">*</span>fl_rho <span class="op">-</span><span class="st"> </span><span class="dv">1</span>))</span>
<span id="cb216-15"><a href="functions.html#cb216-15" aria-hidden="true"></a>  ar_p1 =<span class="st"> </span>(ar_p1_s1<span class="op">*</span>ar_p1_s2)<span class="op">^</span>ar_p1_s3</span>
<span id="cb216-16"><a href="functions.html#cb216-16" aria-hidden="true"></a>  ar_p2 =<span class="st"> </span>fl_N<span class="op">^</span>((fl_alpha<span class="op">*</span>fl_rho<span class="dv">-1</span>)<span class="op">/</span>(ar_alpha<span class="op">*</span>fl_rho<span class="dv">-1</span>))</span>
<span id="cb216-17"><a href="functions.html#cb216-17" aria-hidden="true"></a>  ar_overall =<span class="st"> </span>ar_p1<span class="op">*</span>ar_p2</span>
<span id="cb216-18"><a href="functions.html#cb216-18" aria-hidden="true"></a>  fl_overall =<span class="st"> </span>fl_N_agg <span class="op">-</span><span class="st"> </span><span class="kw">sum</span>(ar_overall)</span>
<span id="cb216-19"><a href="functions.html#cb216-19" aria-hidden="true"></a></span>
<span id="cb216-20"><a href="functions.html#cb216-20" aria-hidden="true"></a>  <span class="kw">return</span>(fl_overall)</span>
<span id="cb216-21"><a href="functions.html#cb216-21" aria-hidden="true"></a>}</span>
<span id="cb216-22"><a href="functions.html#cb216-22" aria-hidden="true"></a></span>
<span id="cb216-23"><a href="functions.html#cb216-23" aria-hidden="true"></a><span class="co"># Parameters</span></span>
<span id="cb216-24"><a href="functions.html#cb216-24" aria-hidden="true"></a>fl_rho =<span class="st"> </span><span class="dv">-1</span></span>
<span id="cb216-25"><a href="functions.html#cb216-25" aria-hidden="true"></a></span>
<span id="cb216-26"><a href="functions.html#cb216-26" aria-hidden="true"></a><span class="co"># Evaluate Function</span></span>
<span id="cb216-27"><a href="functions.html#cb216-27" aria-hidden="true"></a><span class="kw">print</span>(<span class="kw">ffi_nonlin_dplyrdo</span>(mt_nN_by_nQ_A_alpha[<span class="dv">1</span>,<span class="dv">1</span>],</span>
<span id="cb216-28"><a href="functions.html#cb216-28" aria-hidden="true"></a>                         mt_nN_by_nQ_A_alpha[<span class="dv">1</span>,<span class="dv">2</span>],</span>
<span id="cb216-29"><a href="functions.html#cb216-29" aria-hidden="true"></a>                         mt_nN_by_nQ_A_alpha[<span class="dv">1</span>,<span class="dv">3</span>]<span class="op">*</span>fl_N_agg,</span>
<span id="cb216-30"><a href="functions.html#cb216-30" aria-hidden="true"></a>                         ar_nN_A, ar_nN_alpha, fl_N_agg, fl_rho))</span></code></pre></div>
<pre><code>## [1] 81.86645</code></pre>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="functions.html#cb218-1" aria-hidden="true"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq</span>(<span class="dv">1</span>,<span class="kw">dim</span>(mt_nN_by_nQ_A_alpha)[<span class="dv">1</span>])){</span>
<span id="cb218-2"><a href="functions.html#cb218-2" aria-hidden="true"></a>  fl_eval =<span class="st"> </span><span class="kw">ffi_nonlin_dplyrdo</span>(mt_nN_by_nQ_A_alpha[i,<span class="dv">1</span>],</span>
<span id="cb218-3"><a href="functions.html#cb218-3" aria-hidden="true"></a>                               mt_nN_by_nQ_A_alpha[i,<span class="dv">2</span>],</span>
<span id="cb218-4"><a href="functions.html#cb218-4" aria-hidden="true"></a>                               mt_nN_by_nQ_A_alpha[i,<span class="dv">3</span>]<span class="op">*</span>fl_N_agg,</span>
<span id="cb218-5"><a href="functions.html#cb218-5" aria-hidden="true"></a>                               ar_nN_A, ar_nN_alpha, fl_N_agg, fl_rho)</span>
<span id="cb218-6"><a href="functions.html#cb218-6" aria-hidden="true"></a>  <span class="kw">print</span>(fl_eval)</span>
<span id="cb218-7"><a href="functions.html#cb218-7" aria-hidden="true"></a>}</span></code></pre></div>
<pre><code>## [1] 81.86645
## [1] 54.48885
## [1] -65.5619
## [1] -598.2559
## [1] -3154.072</code></pre>
</div>
<div id="evaluate-nonlinear-function-using-dplyr-mutate" class="section level4" number="3.1.1.4">
<h4><span class="header-section-number">3.1.1.4</span> Evaluate Nonlinear Function using dplyr mutate</h4>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="functions.html#cb220-1" aria-hidden="true"></a><span class="co"># Define Implicit Function</span></span>
<span id="cb220-2"><a href="functions.html#cb220-2" aria-hidden="true"></a>ffi_nonlin_dplyrdo &lt;-<span class="st"> </span><span class="cf">function</span>(fl_A, fl_alpha, fl_N, ar_A, ar_alpha, fl_N_agg, fl_rho){</span>
<span id="cb220-3"><a href="functions.html#cb220-3" aria-hidden="true"></a></span>
<span id="cb220-4"><a href="functions.html#cb220-4" aria-hidden="true"></a>  <span class="co"># Test Parameters</span></span>
<span id="cb220-5"><a href="functions.html#cb220-5" aria-hidden="true"></a>  <span class="co"># ar_A = ar_nN_A</span></span>
<span id="cb220-6"><a href="functions.html#cb220-6" aria-hidden="true"></a>  <span class="co"># ar_alpha = ar_nN_alpha</span></span>
<span id="cb220-7"><a href="functions.html#cb220-7" aria-hidden="true"></a>  <span class="co"># fl_N = 100</span></span>
<span id="cb220-8"><a href="functions.html#cb220-8" aria-hidden="true"></a>  <span class="co"># fl_rho = -1</span></span>
<span id="cb220-9"><a href="functions.html#cb220-9" aria-hidden="true"></a>  <span class="co"># fl_N_q = 10</span></span>
<span id="cb220-10"><a href="functions.html#cb220-10" aria-hidden="true"></a></span>
<span id="cb220-11"><a href="functions.html#cb220-11" aria-hidden="true"></a>  <span class="co"># Apply Function</span></span>
<span id="cb220-12"><a href="functions.html#cb220-12" aria-hidden="true"></a>  ar_p1_s1 =<span class="st"> </span><span class="kw">exp</span>((fl_A <span class="op">-</span><span class="st"> </span>ar_A)<span class="op">*</span>fl_rho)</span>
<span id="cb220-13"><a href="functions.html#cb220-13" aria-hidden="true"></a>  ar_p1_s2 =<span class="st"> </span>(fl_alpha<span class="op">/</span>ar_alpha)</span>
<span id="cb220-14"><a href="functions.html#cb220-14" aria-hidden="true"></a>  ar_p1_s3 =<span class="st"> </span>(<span class="dv">1</span><span class="op">/</span>(ar_alpha<span class="op">*</span>fl_rho <span class="op">-</span><span class="st"> </span><span class="dv">1</span>))</span>
<span id="cb220-15"><a href="functions.html#cb220-15" aria-hidden="true"></a>  ar_p1 =<span class="st"> </span>(ar_p1_s1<span class="op">*</span>ar_p1_s2)<span class="op">^</span>ar_p1_s3</span>
<span id="cb220-16"><a href="functions.html#cb220-16" aria-hidden="true"></a>  ar_p2 =<span class="st"> </span>(fl_N<span class="op">*</span>fl_N_agg)<span class="op">^</span>((fl_alpha<span class="op">*</span>fl_rho<span class="dv">-1</span>)<span class="op">/</span>(ar_alpha<span class="op">*</span>fl_rho<span class="dv">-1</span>))</span>
<span id="cb220-17"><a href="functions.html#cb220-17" aria-hidden="true"></a>  ar_overall =<span class="st"> </span>ar_p1<span class="op">*</span>ar_p2</span>
<span id="cb220-18"><a href="functions.html#cb220-18" aria-hidden="true"></a>  fl_overall =<span class="st"> </span>fl_N_agg <span class="op">-</span><span class="st"> </span><span class="kw">sum</span>(ar_overall)</span>
<span id="cb220-19"><a href="functions.html#cb220-19" aria-hidden="true"></a></span>
<span id="cb220-20"><a href="functions.html#cb220-20" aria-hidden="true"></a>  <span class="kw">return</span>(fl_overall)</span>
<span id="cb220-21"><a href="functions.html#cb220-21" aria-hidden="true"></a>}</span>
<span id="cb220-22"><a href="functions.html#cb220-22" aria-hidden="true"></a></span>
<span id="cb220-23"><a href="functions.html#cb220-23" aria-hidden="true"></a><span class="co"># fl_A, fl_alpha are from columns of tb_nN_by_nQ_A_alpha</span></span>
<span id="cb220-24"><a href="functions.html#cb220-24" aria-hidden="true"></a>tb_nN_by_nQ_A_alpha =<span class="st"> </span>tb_nN_by_nQ_A_alpha <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></span>
<span id="cb220-25"><a href="functions.html#cb220-25" aria-hidden="true"></a><span class="st">                        </span><span class="kw">mutate</span>(<span class="dt">dplyr_eval =</span> <span class="kw">ffi_nonlin_dplyrdo</span>(fl_A, fl_alpha, fl_N,</span>
<span id="cb220-26"><a href="functions.html#cb220-26" aria-hidden="true"></a>                                                               ar_nN_A, ar_nN_alpha,</span>
<span id="cb220-27"><a href="functions.html#cb220-27" aria-hidden="true"></a>                                                               fl_N_agg, fl_rho))</span>
<span id="cb220-28"><a href="functions.html#cb220-28" aria-hidden="true"></a><span class="co"># Show</span></span>
<span id="cb220-29"><a href="functions.html#cb220-29" aria-hidden="true"></a><span class="kw">kable</span>(tb_nN_by_nQ_A_alpha) <span class="op">%&gt;%</span></span>
<span id="cb220-30"><a href="functions.html#cb220-30" aria-hidden="true"></a><span class="st">  </span><span class="kw">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_A
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_alpha
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_N
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dplyr_eval
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-2
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
0.0666667
</td>
<td style="text-align:right;">
81.86645
</td>
</tr>
<tr>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
0.1333333
</td>
<td style="text-align:right;">
54.48885
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.2000000
</td>
<td style="text-align:right;">
-65.56190
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
0.2666667
</td>
<td style="text-align:right;">
-598.25595
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.9
</td>
<td style="text-align:right;">
0.3333333
</td>
<td style="text-align:right;">
-3154.07226
</td>
</tr>
</tbody>
</table>

</div>
</div>
<div id="evaluate-choices-across-states" class="section level3" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Evaluate Choices Across States</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R Code Examples</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository (<a href="https://fanwangecon.github.io/Stat4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<p>See the <a href="https://fanwangecon.github.io/REconTools/reference/ff_opti_bisect_pmap_multi.html">ff_opti_bisect_pmap_multi</a> function from <a href="https://fanwangecon.github.io/">Fan</a>’s <em><a href="https://fanwangecon.github.io/REconTools/">REconTools</a></em> Package, which provides a resuable function based on the algorithm worked out here.</p>
<p>We want evaluate linear function <span class="math inline">\(0=f(z_{ij}, x_i, y_i, \textbf{X}, \textbf{Y}, c, d)\)</span>. There are <span class="math inline">\(i\)</span> functions that have <span class="math inline">\(i\)</span> specific <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>. For each <span class="math inline">\(i\)</span> function, we evaluate along a grid of feasible values for <span class="math inline">\(z\)</span>, over <span class="math inline">\(j\in J\)</span> grid points, potentially looking for the <span class="math inline">\(j\)</span> that is closest to the root. <span class="math inline">\(\textbf{X}\)</span> and <span class="math inline">\(\textbf{Y}\)</span> are arrays common across the <span class="math inline">\(i\)</span> equations, and <span class="math inline">\(c\)</span> and <span class="math inline">\(d\)</span> are constants.</p>
<p>The evaluation strategy is the following, given min and max for <span class="math inline">\(z\)</span> that are specific for each <span class="math inline">\(j\)</span>, and given common number of grid points, generate a matrix of <span class="math inline">\(z_{ij}\)</span>. Suppose there the number of <span class="math inline">\(i\)</span> is <span class="math inline">\(I\)</span>, and the number of grid points for <span class="math inline">\(j\)</span> is <span class="math inline">\(J\)</span>.</p>
<ol style="list-style-type: decimal">
<li>Generate a <span class="math inline">\(J \cdot I\)</span> by <span class="math inline">\(3\)</span> matrix where the columns are <span class="math inline">\(z,x,y\)</span> as tibble</li>
<li>Follow <a href="https://fanwangecon.github.io/R4Econ/function/mutatef/fs_funceval.html">this</a> Mutate to evaluate the <span class="math inline">\(f(\cdot)\)</span> function.</li>
<li>Add two categorical columns for grid levels and wich <span class="math inline">\(i\)</span>, <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> index. Plot Mutate output evaluated column categorized by <span class="math inline">\(i\)</span> as color and <span class="math inline">\(j\)</span> as x-axis.</li>
</ol>
<div id="set-up-input-arrays-1" class="section level4" number="3.1.2.1">
<h4><span class="header-section-number">3.1.2.1</span> Set up Input Arrays</h4>
<p>There is a function that takes <span class="math inline">\(M=Q+P\)</span> inputs, we want to evaluate this function <span class="math inline">\(N\)</span> times. Each time, there are <span class="math inline">\(M\)</span> inputs, where all but <span class="math inline">\(Q\)</span> of the <span class="math inline">\(M\)</span> inputs, meaning <span class="math inline">\(P\)</span> of the <span class="math inline">\(M\)</span> inputs, are the same. In particular, <span class="math inline">\(P=Q*N\)</span>.</p>
<p><span class="math display">\[M = Q+P = Q + Q*N\]</span></p>
<p>Now we need to expand this by the number of choice grid. Each row, representing one equation, is expanded by the number of choice grids. We are graphically searching, or rather brute force searching, which means if we have 100 individuals, we want to plot out the nonlinear equation for each of these lines, and show graphically where each line crosses zero. We achieve this, by evaluating the equation for each of the 100 individuals along a grid of feasible choices.</p>
<p>In this problem here, the feasible choices are shared across individuals.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="functions.html#cb221-1" aria-hidden="true"></a><span class="co"># Parameters</span></span>
<span id="cb221-2"><a href="functions.html#cb221-2" aria-hidden="true"></a>fl_rho =<span class="st"> </span><span class="fl">0.20</span></span>
<span id="cb221-3"><a href="functions.html#cb221-3" aria-hidden="true"></a>svr_id_var =<span class="st"> &#39;INDI_ID&#39;</span></span>
<span id="cb221-4"><a href="functions.html#cb221-4" aria-hidden="true"></a></span>
<span id="cb221-5"><a href="functions.html#cb221-5" aria-hidden="true"></a><span class="co"># it_child_count = N, the number of children</span></span>
<span id="cb221-6"><a href="functions.html#cb221-6" aria-hidden="true"></a>it_N_child_cnt =<span class="st"> </span><span class="dv">4</span></span>
<span id="cb221-7"><a href="functions.html#cb221-7" aria-hidden="true"></a><span class="co"># it_heter_param = Q, number of parameters that are heterogeneous across children</span></span>
<span id="cb221-8"><a href="functions.html#cb221-8" aria-hidden="true"></a>it_Q_hetpa_cnt =<span class="st"> </span><span class="dv">2</span></span>
<span id="cb221-9"><a href="functions.html#cb221-9" aria-hidden="true"></a></span>
<span id="cb221-10"><a href="functions.html#cb221-10" aria-hidden="true"></a><span class="co"># P fixed parameters, nN is N dimensional, nP is P dimensional</span></span>
<span id="cb221-11"><a href="functions.html#cb221-11" aria-hidden="true"></a>ar_nN_A =<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dt">length.out =</span> it_N_child_cnt)</span>
<span id="cb221-12"><a href="functions.html#cb221-12" aria-hidden="true"></a>ar_nN_alpha =<span class="st"> </span><span class="kw">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="dt">length.out =</span> it_N_child_cnt)</span>
<span id="cb221-13"><a href="functions.html#cb221-13" aria-hidden="true"></a>ar_nP_A_alpha =<span class="st"> </span><span class="kw">c</span>(ar_nN_A, ar_nN_alpha)</span>
<span id="cb221-14"><a href="functions.html#cb221-14" aria-hidden="true"></a></span>
<span id="cb221-15"><a href="functions.html#cb221-15" aria-hidden="true"></a><span class="co"># N by Q varying parameters</span></span>
<span id="cb221-16"><a href="functions.html#cb221-16" aria-hidden="true"></a>mt_nN_by_nQ_A_alpha =<span class="st"> </span><span class="kw">cbind</span>(ar_nN_A, ar_nN_alpha)</span>
<span id="cb221-17"><a href="functions.html#cb221-17" aria-hidden="true"></a></span>
<span id="cb221-18"><a href="functions.html#cb221-18" aria-hidden="true"></a><span class="co"># Choice Grid for nutritional feasible choices for each</span></span>
<span id="cb221-19"><a href="functions.html#cb221-19" aria-hidden="true"></a>fl_N_agg =<span class="st"> </span><span class="dv">100</span></span>
<span id="cb221-20"><a href="functions.html#cb221-20" aria-hidden="true"></a>fl_N_min =<span class="st"> </span><span class="dv">0</span></span>
<span id="cb221-21"><a href="functions.html#cb221-21" aria-hidden="true"></a>it_N_choice_cnt_ttest =<span class="st"> </span><span class="dv">3</span></span>
<span id="cb221-22"><a href="functions.html#cb221-22" aria-hidden="true"></a>it_N_choice_cnt_dense =<span class="st"> </span><span class="dv">100</span></span>
<span id="cb221-23"><a href="functions.html#cb221-23" aria-hidden="true"></a>ar_N_choices_ttest =<span class="st"> </span><span class="kw">seq</span>(fl_N_min, fl_N_agg, <span class="dt">length.out =</span> it_N_choice_cnt_ttest)</span>
<span id="cb221-24"><a href="functions.html#cb221-24" aria-hidden="true"></a>ar_N_choices_dense =<span class="st"> </span><span class="kw">seq</span>(fl_N_min, fl_N_agg, <span class="dt">length.out =</span> it_N_choice_cnt_dense)</span>
<span id="cb221-25"><a href="functions.html#cb221-25" aria-hidden="true"></a></span>
<span id="cb221-26"><a href="functions.html#cb221-26" aria-hidden="true"></a><span class="co"># Mesh Expand</span></span>
<span id="cb221-27"><a href="functions.html#cb221-27" aria-hidden="true"></a>tb_states_choices &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(mt_nN_by_nQ_A_alpha) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rowid_to_column</span>(<span class="dt">var=</span>svr_id_var)</span>
<span id="cb221-28"><a href="functions.html#cb221-28" aria-hidden="true"></a>tb_states_choices_ttest &lt;-<span class="st"> </span>tb_states_choices <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">expand_grid</span>(<span class="dt">choices =</span> ar_N_choices_ttest)</span>
<span id="cb221-29"><a href="functions.html#cb221-29" aria-hidden="true"></a>tb_states_choices_dense &lt;-<span class="st"> </span>tb_states_choices <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">expand_grid</span>(<span class="dt">choices =</span> ar_N_choices_dense)</span>
<span id="cb221-30"><a href="functions.html#cb221-30" aria-hidden="true"></a></span>
<span id="cb221-31"><a href="functions.html#cb221-31" aria-hidden="true"></a><span class="co"># display</span></span>
<span id="cb221-32"><a href="functions.html#cb221-32" aria-hidden="true"></a><span class="kw">summary</span>(tb_states_choices_dense)</span></code></pre></div>
<pre><code>##     INDI_ID        ar_nN_A    ar_nN_alpha     choices   
##  Min.   :1.00   Min.   :-2   Min.   :0.1   Min.   :  0  
##  1st Qu.:1.75   1st Qu.:-1   1st Qu.:0.3   1st Qu.: 25  
##  Median :2.50   Median : 0   Median :0.5   Median : 50  
##  Mean   :2.50   Mean   : 0   Mean   :0.5   Mean   : 50  
##  3rd Qu.:3.25   3rd Qu.: 1   3rd Qu.:0.7   3rd Qu.: 75  
##  Max.   :4.00   Max.   : 2   Max.   :0.9   Max.   :100</code></pre>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="functions.html#cb223-1" aria-hidden="true"></a><span class="kw">kable</span>(tb_states_choices_ttest) <span class="op">%&gt;%</span></span>
<span id="cb223-2"><a href="functions.html#cb223-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
INDI_ID
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ar_nN_A
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ar_nN_alpha
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
choices
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-2.0000000
</td>
<td style="text-align:right;">
0.1000000
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-2.0000000
</td>
<td style="text-align:right;">
0.1000000
</td>
<td style="text-align:right;">
50
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-2.0000000
</td>
<td style="text-align:right;">
0.1000000
</td>
<td style="text-align:right;">
100
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-0.6666667
</td>
<td style="text-align:right;">
0.3666667
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-0.6666667
</td>
<td style="text-align:right;">
0.3666667
</td>
<td style="text-align:right;">
50
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-0.6666667
</td>
<td style="text-align:right;">
0.3666667
</td>
<td style="text-align:right;">
100
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.6666667
</td>
<td style="text-align:right;">
0.6333333
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.6666667
</td>
<td style="text-align:right;">
0.6333333
</td>
<td style="text-align:right;">
50
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.6666667
</td>
<td style="text-align:right;">
0.6333333
</td>
<td style="text-align:right;">
100
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2.0000000
</td>
<td style="text-align:right;">
0.9000000
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2.0000000
</td>
<td style="text-align:right;">
0.9000000
</td>
<td style="text-align:right;">
50
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2.0000000
</td>
<td style="text-align:right;">
0.9000000
</td>
<td style="text-align:right;">
100
</td>
</tr>
</tbody>
</table>
</div>
<div id="apply-same-function-all-rows-some-inputs-row-specific-other-shared" class="section level4" number="3.1.2.2">
<h4><span class="header-section-number">3.1.2.2</span> Apply Same Function all Rows, Some Inputs Row-specific, other Shared</h4>
<p>There are two types of inputs, row-specific inputs, and inputs that should be applied for each row. The Function just requires all of these inputs, it does not know what is row-specific and what is common for all row. Dplyr recognizes which parameter inputs already existing in the piped dataframe/tibble, given rowwise, those will be row-specific inputs. Additional function parameters that do not exist in dataframe as variable names, but that are pre-defined scalars or arrays will be applied to all rows.</p>
<ul>
<li><span class="citation">(<span class="citeproc-not-found" data-reference-id="param"><strong>???</strong></span>)</span> string variable name of input where functions are evaluated, these are already contained in the dataframe, existing variable names, row specific, rowwise computation over these, each rowwise calculation using different rows: <em>fl_A</em>, <em>fl_alpha</em>, <em>fl_N</em></li>
<li><span class="citation">(<span class="citeproc-not-found" data-reference-id="param"><strong>???</strong></span>)</span> scalar and array values that are applied to every rowwise calculation, all rowwise calculations using the same scalars and arrays:<em>ar_A</em>, <em>ar_alpha</em>, <em>fl_N_agg</em>, <em>fl_rho</em></li>
<li><span class="citation">(<span class="citeproc-not-found" data-reference-id="param"><strong>???</strong></span>)</span> string output variable name</li>
</ul>
<p>The function looks within group, finds min/max etc that are relevant.</p>
<div id="points-and-denser-dataframs-and-define-function" class="section level5" number="3.1.2.2.1">
<h5><span class="header-section-number">3.1.2.2.1</span> 3 Points and Denser Dataframs and Define Function</h5>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="functions.html#cb224-1" aria-hidden="true"></a><span class="co"># Convert Matrix to Tibble</span></span>
<span id="cb224-2"><a href="functions.html#cb224-2" aria-hidden="true"></a>ar_st_col_names =<span class="st"> </span><span class="kw">c</span>(svr_id_var,<span class="st">&#39;fl_A&#39;</span>, <span class="st">&#39;fl_alpha&#39;</span>)</span>
<span id="cb224-3"><a href="functions.html#cb224-3" aria-hidden="true"></a>tb_states_choices &lt;-<span class="st"> </span>tb_states_choices <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename_all</span>(<span class="op">~</span><span class="kw">c</span>(ar_st_col_names))</span>
<span id="cb224-4"><a href="functions.html#cb224-4" aria-hidden="true"></a>ar_st_col_names =<span class="st"> </span><span class="kw">c</span>(svr_id_var,<span class="st">&#39;fl_A&#39;</span>, <span class="st">&#39;fl_alpha&#39;</span>, <span class="st">&#39;fl_N&#39;</span>)</span>
<span id="cb224-5"><a href="functions.html#cb224-5" aria-hidden="true"></a>tb_states_choices_ttest &lt;-<span class="st"> </span>tb_states_choices_ttest <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename_all</span>(<span class="op">~</span><span class="kw">c</span>(ar_st_col_names))</span>
<span id="cb224-6"><a href="functions.html#cb224-6" aria-hidden="true"></a>tb_states_choices_dense &lt;-<span class="st"> </span>tb_states_choices_dense <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename_all</span>(<span class="op">~</span><span class="kw">c</span>(ar_st_col_names))</span>
<span id="cb224-7"><a href="functions.html#cb224-7" aria-hidden="true"></a></span>
<span id="cb224-8"><a href="functions.html#cb224-8" aria-hidden="true"></a><span class="co"># Define Implicit Function</span></span>
<span id="cb224-9"><a href="functions.html#cb224-9" aria-hidden="true"></a>ffi_nonlin_dplyrdo &lt;-<span class="st"> </span><span class="cf">function</span>(fl_A, fl_alpha, fl_N, ar_A, ar_alpha, fl_N_agg, fl_rho){</span>
<span id="cb224-10"><a href="functions.html#cb224-10" aria-hidden="true"></a>  <span class="co"># scalar value that are row-specific, in dataframe already: *fl_A*, *fl_alpha*, *fl_N*</span></span>
<span id="cb224-11"><a href="functions.html#cb224-11" aria-hidden="true"></a>  <span class="co"># array and scalars not in dataframe, common all rows: *ar_A*, *ar_alpha*, *fl_N_agg*, *fl_rho*</span></span>
<span id="cb224-12"><a href="functions.html#cb224-12" aria-hidden="true"></a></span>
<span id="cb224-13"><a href="functions.html#cb224-13" aria-hidden="true"></a>  <span class="co"># Test Parameters</span></span>
<span id="cb224-14"><a href="functions.html#cb224-14" aria-hidden="true"></a>  <span class="co"># ar_A = ar_nN_A</span></span>
<span id="cb224-15"><a href="functions.html#cb224-15" aria-hidden="true"></a>  <span class="co"># ar_alpha = ar_nN_alpha</span></span>
<span id="cb224-16"><a href="functions.html#cb224-16" aria-hidden="true"></a>  <span class="co"># fl_N = 100</span></span>
<span id="cb224-17"><a href="functions.html#cb224-17" aria-hidden="true"></a>  <span class="co"># fl_rho = -1</span></span>
<span id="cb224-18"><a href="functions.html#cb224-18" aria-hidden="true"></a>  <span class="co"># fl_N_q = 10</span></span>
<span id="cb224-19"><a href="functions.html#cb224-19" aria-hidden="true"></a></span>
<span id="cb224-20"><a href="functions.html#cb224-20" aria-hidden="true"></a>  <span class="co"># Apply Function</span></span>
<span id="cb224-21"><a href="functions.html#cb224-21" aria-hidden="true"></a>  ar_p1_s1 =<span class="st"> </span><span class="kw">exp</span>((fl_A <span class="op">-</span><span class="st"> </span>ar_A)<span class="op">*</span>fl_rho)</span>
<span id="cb224-22"><a href="functions.html#cb224-22" aria-hidden="true"></a>  ar_p1_s2 =<span class="st"> </span>(fl_alpha<span class="op">/</span>ar_alpha)</span>
<span id="cb224-23"><a href="functions.html#cb224-23" aria-hidden="true"></a>  ar_p1_s3 =<span class="st"> </span>(<span class="dv">1</span><span class="op">/</span>(ar_alpha<span class="op">*</span>fl_rho <span class="op">-</span><span class="st"> </span><span class="dv">1</span>))</span>
<span id="cb224-24"><a href="functions.html#cb224-24" aria-hidden="true"></a>  ar_p1 =<span class="st"> </span>(ar_p1_s1<span class="op">*</span>ar_p1_s2)<span class="op">^</span>ar_p1_s3</span>
<span id="cb224-25"><a href="functions.html#cb224-25" aria-hidden="true"></a>  ar_p2 =<span class="st"> </span>fl_N<span class="op">^</span>((fl_alpha<span class="op">*</span>fl_rho<span class="dv">-1</span>)<span class="op">/</span>(ar_alpha<span class="op">*</span>fl_rho<span class="dv">-1</span>))</span>
<span id="cb224-26"><a href="functions.html#cb224-26" aria-hidden="true"></a>  ar_overall =<span class="st"> </span>ar_p1<span class="op">*</span>ar_p2</span>
<span id="cb224-27"><a href="functions.html#cb224-27" aria-hidden="true"></a>  fl_overall =<span class="st"> </span>fl_N_agg <span class="op">-</span><span class="st"> </span><span class="kw">sum</span>(ar_overall)</span>
<span id="cb224-28"><a href="functions.html#cb224-28" aria-hidden="true"></a></span>
<span id="cb224-29"><a href="functions.html#cb224-29" aria-hidden="true"></a>  <span class="kw">return</span>(fl_overall)</span>
<span id="cb224-30"><a href="functions.html#cb224-30" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div id="evaluate-at-three-choice-points-and-show-table" class="section level5" number="3.1.2.2.2">
<h5><span class="header-section-number">3.1.2.2.2</span> Evaluate at Three Choice Points and Show Table</h5>
<p>In the example below, just show results evaluating over three choice points and show table.</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="functions.html#cb225-1" aria-hidden="true"></a><span class="co"># fl_A, fl_alpha are from columns of tb_nN_by_nQ_A_alpha</span></span>
<span id="cb225-2"><a href="functions.html#cb225-2" aria-hidden="true"></a>tb_states_choices_ttest_eval =<span class="st"> </span>tb_states_choices_ttest <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></span>
<span id="cb225-3"><a href="functions.html#cb225-3" aria-hidden="true"></a><span class="st">                        </span><span class="kw">mutate</span>(<span class="dt">dplyr_eval =</span> <span class="kw">ffi_nonlin_dplyrdo</span>(fl_A, fl_alpha, fl_N,</span>
<span id="cb225-4"><a href="functions.html#cb225-4" aria-hidden="true"></a>                                                               ar_nN_A, ar_nN_alpha,</span>
<span id="cb225-5"><a href="functions.html#cb225-5" aria-hidden="true"></a>                                                               fl_N_agg, fl_rho))</span>
<span id="cb225-6"><a href="functions.html#cb225-6" aria-hidden="true"></a><span class="co"># Show</span></span>
<span id="cb225-7"><a href="functions.html#cb225-7" aria-hidden="true"></a><span class="kw">kable</span>(tb_states_choices_ttest_eval) <span class="op">%&gt;%</span></span>
<span id="cb225-8"><a href="functions.html#cb225-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
INDI_ID
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_A
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_alpha
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_N
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dplyr_eval
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-2.0000000
</td>
<td style="text-align:right;">
0.1000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.00000
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-2.0000000
</td>
<td style="text-align:right;">
0.1000000
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
-5666.95576
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-2.0000000
</td>
<td style="text-align:right;">
0.1000000
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
-12880.28392
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-0.6666667
</td>
<td style="text-align:right;">
0.3666667
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.00000
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-0.6666667
</td>
<td style="text-align:right;">
0.3666667
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
-595.73454
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-0.6666667
</td>
<td style="text-align:right;">
0.3666667
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
-1394.70698
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.6666667
</td>
<td style="text-align:right;">
0.6333333
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.00000
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.6666667
</td>
<td style="text-align:right;">
0.6333333
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
-106.51058
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.6666667
</td>
<td style="text-align:right;">
0.6333333
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
-323.94216
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2.0000000
</td>
<td style="text-align:right;">
0.9000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.00000
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2.0000000
</td>
<td style="text-align:right;">
0.9000000
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
22.55577
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2.0000000
</td>
<td style="text-align:right;">
0.9000000
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
-51.97161
</td>
</tr>
</tbody>
</table>
</div>
<div id="evaluate-at-many-choice-points-and-show-graphically" class="section level5" number="3.1.2.2.3">
<h5><span class="header-section-number">3.1.2.2.3</span> Evaluate at Many Choice Points and Show Graphically</h5>
<p>Same as above, but now we evaluate the function over the individuals at many choice points so that we can graph things out.</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="functions.html#cb226-1" aria-hidden="true"></a><span class="co"># fl_A, fl_alpha are from columns of tb_nN_by_nQ_A_alpha</span></span>
<span id="cb226-2"><a href="functions.html#cb226-2" aria-hidden="true"></a>tb_states_choices_dense_eval =<span class="st"> </span>tb_states_choices_dense <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></span>
<span id="cb226-3"><a href="functions.html#cb226-3" aria-hidden="true"></a><span class="st">                        </span><span class="kw">mutate</span>(<span class="dt">dplyr_eval =</span> <span class="kw">ffi_nonlin_dplyrdo</span>(fl_A, fl_alpha, fl_N,</span>
<span id="cb226-4"><a href="functions.html#cb226-4" aria-hidden="true"></a>                                                               ar_nN_A, ar_nN_alpha,</span>
<span id="cb226-5"><a href="functions.html#cb226-5" aria-hidden="true"></a>                                                               fl_N_agg, fl_rho))</span></code></pre></div>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="functions.html#cb227-1" aria-hidden="true"></a><span class="co"># Labeling</span></span>
<span id="cb227-2"><a href="functions.html#cb227-2" aria-hidden="true"></a>st_title &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&#39;Evaluate Non-Linear Functions to Search for Roots&#39;</span>)</span>
<span id="cb227-3"><a href="functions.html#cb227-3" aria-hidden="true"></a>st_subtitle &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&#39;https://fanwangecon.github.io/&#39;</span>,</span>
<span id="cb227-4"><a href="functions.html#cb227-4" aria-hidden="true"></a>                      <span class="st">&#39;R4Econ/function/mutatef/htmlpdfr/fs_func_choice_states.html&#39;</span>)</span>
<span id="cb227-5"><a href="functions.html#cb227-5" aria-hidden="true"></a>st_caption &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&#39;Evaluating the function, &#39;</span>,</span>
<span id="cb227-6"><a href="functions.html#cb227-6" aria-hidden="true"></a>                     <span class="st">&#39;https://fanwangecon.github.io/R4Econ/&#39;</span>)</span>
<span id="cb227-7"><a href="functions.html#cb227-7" aria-hidden="true"></a>st_x_label &lt;-<span class="st"> &#39;x values&#39;</span></span>
<span id="cb227-8"><a href="functions.html#cb227-8" aria-hidden="true"></a>st_y_label &lt;-<span class="st"> &#39;f(x)&#39;</span></span>
<span id="cb227-9"><a href="functions.html#cb227-9" aria-hidden="true"></a></span>
<span id="cb227-10"><a href="functions.html#cb227-10" aria-hidden="true"></a><span class="co"># Show</span></span>
<span id="cb227-11"><a href="functions.html#cb227-11" aria-hidden="true"></a><span class="kw">dim</span>(tb_states_choices_dense_eval)</span></code></pre></div>
<pre><code>## [1] 400   5</code></pre>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="functions.html#cb229-1" aria-hidden="true"></a><span class="kw">summary</span>(tb_states_choices_dense_eval)</span></code></pre></div>
<pre><code>##     INDI_ID          fl_A       fl_alpha        fl_N       dplyr_eval       
##  Min.   :1.00   Min.   :-2   Min.   :0.1   Min.   :  0   Min.   :-12880.28  
##  1st Qu.:1.75   1st Qu.:-1   1st Qu.:0.3   1st Qu.: 25   1st Qu.: -1167.29  
##  Median :2.50   Median : 0   Median :0.5   Median : 50   Median :  -202.42  
##  Mean   :2.50   Mean   : 0   Mean   :0.5   Mean   : 50   Mean   : -1645.65  
##  3rd Qu.:3.25   3rd Qu.: 1   3rd Qu.:0.7   3rd Qu.: 75   3rd Qu.:     0.96  
##  Max.   :4.00   Max.   : 2   Max.   :0.9   Max.   :100   Max.   :   100.00</code></pre>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="functions.html#cb231-1" aria-hidden="true"></a>lineplot &lt;-<span class="st"> </span>tb_states_choices_dense_eval <span class="op">%&gt;%</span></span>
<span id="cb231-2"><a href="functions.html#cb231-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>fl_N, <span class="dt">y=</span>dplyr_eval)) <span class="op">+</span></span>
<span id="cb231-3"><a href="functions.html#cb231-3" aria-hidden="true"></a><span class="st">        </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb231-4"><a href="functions.html#cb231-4" aria-hidden="true"></a><span class="st">        </span><span class="kw">facet_wrap</span>( . <span class="op">~</span><span class="st"> </span>INDI_ID, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span></span>
<span id="cb231-5"><a href="functions.html#cb231-5" aria-hidden="true"></a><span class="st">        </span><span class="kw">geom_hline</span>(<span class="dt">yintercept=</span><span class="dv">0</span>, <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb231-6"><a href="functions.html#cb231-6" aria-hidden="true"></a>                <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb231-7"><a href="functions.html#cb231-7" aria-hidden="true"></a><span class="st">        </span><span class="kw">labs</span>(<span class="dt">title =</span> st_title,</span>
<span id="cb231-8"><a href="functions.html#cb231-8" aria-hidden="true"></a>             <span class="dt">subtitle =</span> st_subtitle,</span>
<span id="cb231-9"><a href="functions.html#cb231-9" aria-hidden="true"></a>             <span class="dt">x =</span> st_x_label,</span>
<span id="cb231-10"><a href="functions.html#cb231-10" aria-hidden="true"></a>             <span class="dt">y =</span> st_y_label,</span>
<span id="cb231-11"><a href="functions.html#cb231-11" aria-hidden="true"></a>             <span class="dt">caption =</span> st_caption)</span>
<span id="cb231-12"><a href="functions.html#cb231-12" aria-hidden="true"></a><span class="kw">print</span>(lineplot)</span></code></pre></div>
<p><img src="Panel-Data-and-Optimization-with-R_files/figure-html/graph%20many%20evaluations-1.png" width="672" style="display: block; margin: auto;" /></p>

</div>
</div>
</div>
</div>
<div id="dataframe-do-anything" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Dataframe Do Anything</h2>

<div id="mx1-by-n-to-mxq-by-n1" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> (Mx1 by N) to (MxQ by N+1)</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R Code Examples</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository (<a href="https://fanwangecon.github.io/Stat4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<p><strong>Case One</strong>: There is a dataframe with <span class="math inline">\(M\)</span> rows, based on these <span class="math inline">\(m\)</span> specific information, generate dataframes for each <span class="math inline">\(m\)</span>. Stack these indivdiual dataframes together and merge original <span class="math inline">\(m\)</span> specific information in as well. The number of rows for each <span class="math inline">\(m\)</span> is <span class="math inline">\(Q_m\)</span>, each <span class="math inline">\(m\)</span> could have different number of expansion rows.</p>
<p>Generate a panel with <span class="math inline">\(M\)</span> individuals, each individual is observed for different spans of times (<em>uncount</em>). Before expanding, generate individual specific normal distribution standard deviation. All individuals share the same mean, but have increasing standard deviations.</p>
<div id="generate-dataframe-with-m-rows." class="section level4" number="3.2.1.1">
<h4><span class="header-section-number">3.2.1.1</span> Generate Dataframe with M Rows.</h4>
<p>This is the first step, generate <span class="math inline">\(M\)</span> rows of data, to be expanded. Each row contains the number of normal draws to make and the mean and the standard deviation for normal daraws that are <span class="math inline">\(m\)</span> specific.</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="functions.html#cb232-1" aria-hidden="true"></a><span class="co"># Parameter Setups</span></span>
<span id="cb232-2"><a href="functions.html#cb232-2" aria-hidden="true"></a>it_M &lt;-<span class="st"> </span><span class="dv">3</span></span>
<span id="cb232-3"><a href="functions.html#cb232-3" aria-hidden="true"></a>it_Q_max &lt;-<span class="st"> </span><span class="dv">5</span></span>
<span id="cb232-4"><a href="functions.html#cb232-4" aria-hidden="true"></a>fl_rnorm_mu &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb232-5"><a href="functions.html#cb232-5" aria-hidden="true"></a>ar_rnorm_sd &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="fl">0.01</span>, <span class="dv">200</span>, <span class="dt">length.out=</span>it_M)</span>
<span id="cb232-6"><a href="functions.html#cb232-6" aria-hidden="true"></a>ar_it_q &lt;-<span class="st"> </span><span class="kw">sample.int</span>(it_Q_max, it_M, <span class="dt">replace=</span><span class="ot">TRUE</span>)</span>
<span id="cb232-7"><a href="functions.html#cb232-7" aria-hidden="true"></a></span>
<span id="cb232-8"><a href="functions.html#cb232-8" aria-hidden="true"></a><span class="co"># N by Q varying parameters</span></span>
<span id="cb232-9"><a href="functions.html#cb232-9" aria-hidden="true"></a>mt_data =<span class="st"> </span><span class="kw">cbind</span>(ar_it_q, ar_rnorm_sd)</span>
<span id="cb232-10"><a href="functions.html#cb232-10" aria-hidden="true"></a>tb_M &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(mt_data) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rowid_to_column</span>(<span class="dt">var =</span> <span class="st">&quot;ID&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb232-11"><a href="functions.html#cb232-11" aria-hidden="true"></a><span class="st">                </span><span class="kw">rename</span>(<span class="dt">sd =</span> ar_rnorm_sd, <span class="dt">Q =</span> ar_it_q) <span class="op">%&gt;%</span></span>
<span id="cb232-12"><a href="functions.html#cb232-12" aria-hidden="true"></a><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">mean =</span> fl_rnorm_mu)</span>
<span id="cb232-13"><a href="functions.html#cb232-13" aria-hidden="true"></a></span>
<span id="cb232-14"><a href="functions.html#cb232-14" aria-hidden="true"></a><span class="co"># display</span></span>
<span id="cb232-15"><a href="functions.html#cb232-15" aria-hidden="true"></a><span class="kw">kable</span>(tb_M) <span class="op">%&gt;%</span></span>
<span id="cb232-16"><a href="functions.html#cb232-16" aria-hidden="true"></a><span class="st">  </span><span class="kw">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ID
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Q
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
mean
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:right;">
1000
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
100.005
</td>
<td style="text-align:right;">
1000
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
200.000
</td>
<td style="text-align:right;">
1000
</td>
</tr>
</tbody>
</table>
</div>
<div id="random-normal-draw-expansion" class="section level4" number="3.2.1.2">
<h4><span class="header-section-number">3.2.1.2</span> Random Normal Draw Expansion</h4>
<p>The steps are:</p>
<ol style="list-style-type: decimal">
<li><a href="https://dplyr.tidyverse.org/reference/do.html">do anything</a></li>
<li>use “.$” sign to refer to variable names, or [[‘name’]]</li>
<li>unnest</li>
<li>left_join expanded and original</li>
</ol>
<p>Note these all give the same results</p>
<p>Use dot dollar to get variables</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="functions.html#cb233-1" aria-hidden="true"></a><span class="co"># Generate $Q_m$ individual specific incomes, expanded different number of times for each m</span></span>
<span id="cb233-2"><a href="functions.html#cb233-2" aria-hidden="true"></a>tb_income &lt;-<span class="st"> </span>tb_M <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(ID) <span class="op">%&gt;%</span></span>
<span id="cb233-3"><a href="functions.html#cb233-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">do</span>(<span class="dt">income =</span> <span class="kw">rnorm</span>(.<span class="op">$</span>Q, <span class="dt">mean=</span>.<span class="op">$</span>mean, <span class="dt">sd=</span>.<span class="op">$</span>sd)) <span class="op">%&gt;%</span></span>
<span id="cb233-4"><a href="functions.html#cb233-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">unnest</span>(<span class="kw">c</span>(income))</span>
<span id="cb233-5"><a href="functions.html#cb233-5" aria-hidden="true"></a></span>
<span id="cb233-6"><a href="functions.html#cb233-6" aria-hidden="true"></a><span class="co"># Merge back with tb_M</span></span>
<span id="cb233-7"><a href="functions.html#cb233-7" aria-hidden="true"></a>tb_income_full_dd &lt;-<span class="st"> </span>tb_income <span class="op">%&gt;%</span></span>
<span id="cb233-8"><a href="functions.html#cb233-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">left_join</span>(tb_M)</span>
<span id="cb233-9"><a href="functions.html#cb233-9" aria-hidden="true"></a></span>
<span id="cb233-10"><a href="functions.html#cb233-10" aria-hidden="true"></a><span class="co"># display</span></span>
<span id="cb233-11"><a href="functions.html#cb233-11" aria-hidden="true"></a><span class="kw">kable</span>(tb_income) <span class="op">%&gt;%</span></span>
<span id="cb233-12"><a href="functions.html#cb233-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ID
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
income
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
999.9803
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1070.1391
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
952.7185
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
893.2123
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
956.4050
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
794.7991
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
854.2218
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
874.9921
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="functions.html#cb234-1" aria-hidden="true"></a><span class="kw">kable</span>(tb_income_full_dd) <span class="op">%&gt;%</span></span>
<span id="cb234-2"><a href="functions.html#cb234-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ID
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
income
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Q
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
mean
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
999.9803
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:right;">
1000
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1070.1391
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
100.005
</td>
<td style="text-align:right;">
1000
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
952.7185
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
100.005
</td>
<td style="text-align:right;">
1000
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
893.2123
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
100.005
</td>
<td style="text-align:right;">
1000
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
956.4050
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
200.000
</td>
<td style="text-align:right;">
1000
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
794.7991
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
200.000
</td>
<td style="text-align:right;">
1000
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
854.2218
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
200.000
</td>
<td style="text-align:right;">
1000
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
874.9921
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
200.000
</td>
<td style="text-align:right;">
1000
</td>
</tr>
</tbody>
</table>

</div>
</div>
<div id="mxp-by-n-to-mx1-by-1" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> (MxP by N) to (Mx1 by 1)</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R Code Examples</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository (<a href="https://fanwangecon.github.io/Stat4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<p>There is a Panel with <span class="math inline">\(M\)</span> individuals and each individual has <span class="math inline">\(Q\)</span> records/rows. A function generate an individual specific outcome given the <span class="math inline">\(Q\)</span> individual specific inputs, along with shared parameters and arrays across the <span class="math inline">\(M\)</span> individuals.</p>
<p>For example, suppose we have a dataframe of individual wage information from different countries, each row is an individual from one country. We want to generate country specific gini based on the individual data for each country in the dataframe. But additionally, perhaps the gini formula requires not just individual income but some additional parameters or shared dataframes as inputs.</p>
<p>Given the within <span class="math inline">\(m\)</span> income observations, we can compute gini statistics that are individual specific based on the observed distribution of incomes. For this, we will use the <a href="https://fanwangecon.github.io/REconTools/reference/ff_dist_gini_vector_pos.html">ff_dist_gini_vector_pos.html</a> function from <a href="https://fanwangecon.github.io/REconTools/">REconTools</a>.</p>
<p>To make this more interesting, we will generate large dataframe with more <span class="math inline">\(M\)</span> and more <span class="math inline">\(Q\)</span> each <span class="math inline">\(m\)</span>.</p>
<div id="income-rows-for-individuals-in-many-groups" class="section level4" number="3.2.2.1">
<h4><span class="header-section-number">3.2.2.1</span> Income Rows for Individuals in Many Groups</h4>
<p>There are up to ten thousand income observation per person. And there are ten people.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="functions.html#cb235-1" aria-hidden="true"></a><span class="co"># Parameter Setups</span></span>
<span id="cb235-2"><a href="functions.html#cb235-2" aria-hidden="true"></a>it_M &lt;-<span class="st"> </span><span class="dv">10</span></span>
<span id="cb235-3"><a href="functions.html#cb235-3" aria-hidden="true"></a>it_Q_max &lt;-<span class="st"> </span><span class="dv">10000</span></span>
<span id="cb235-4"><a href="functions.html#cb235-4" aria-hidden="true"></a>fl_rnorm_mu &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb235-5"><a href="functions.html#cb235-5" aria-hidden="true"></a>ar_rnorm_sd &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="fl">0.01</span>, <span class="fl">0.2</span>, <span class="dt">length.out=</span>it_M)</span>
<span id="cb235-6"><a href="functions.html#cb235-6" aria-hidden="true"></a>ar_it_q &lt;-<span class="st"> </span><span class="kw">sample.int</span>(it_Q_max, it_M, <span class="dt">replace=</span><span class="ot">TRUE</span>)</span>
<span id="cb235-7"><a href="functions.html#cb235-7" aria-hidden="true"></a></span>
<span id="cb235-8"><a href="functions.html#cb235-8" aria-hidden="true"></a><span class="co"># N by Q varying parameters</span></span>
<span id="cb235-9"><a href="functions.html#cb235-9" aria-hidden="true"></a>mt_data =<span class="st"> </span><span class="kw">cbind</span>(ar_it_q, ar_rnorm_sd)</span>
<span id="cb235-10"><a href="functions.html#cb235-10" aria-hidden="true"></a>tb_M &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(mt_data) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rowid_to_column</span>(<span class="dt">var =</span> <span class="st">&quot;ID&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb235-11"><a href="functions.html#cb235-11" aria-hidden="true"></a><span class="st">                </span><span class="kw">rename</span>(<span class="dt">sd =</span> ar_rnorm_sd, <span class="dt">Q =</span> ar_it_q) <span class="op">%&gt;%</span></span>
<span id="cb235-12"><a href="functions.html#cb235-12" aria-hidden="true"></a><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">mean =</span> fl_rnorm_mu)</span></code></pre></div>
</div>
<div id="compute-group-specific-gini" class="section level4" number="3.2.2.2">
<h4><span class="header-section-number">3.2.2.2</span> Compute Group Specific Gini</h4>
<p>There is only one input for the gini function <em>ar_pos</em>. Note that the gini are not very large even with large SD, because these are normal distributions. By Construction, most peple are in the middle. So with almost zero standard deviation, we have perfect equality, as standard deviation increases, inequality increases, but still pretty equal overall, there is no fat upper tail.</p>
<p>Note that there are three ways of referring to variable names with dot, which are all shown below:</p>
<ol style="list-style-type: decimal">
<li>We can explicitly refer to names</li>
<li>We can use the <a href="https://stackoverflow.com/a/18228613/8280804">dollar dot structure</a> to use string variable names in do anything.</li>
<li>We can use dot bracket, this is the only option that works with string variable names</li>
</ol>
<p>First: Generate individual group all incomes:</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="functions.html#cb236-1" aria-hidden="true"></a><span class="co"># A. Normal Draw Expansion, Explicitly Name</span></span>
<span id="cb236-2"><a href="functions.html#cb236-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="st">&#39;123&#39;</span>)</span>
<span id="cb236-3"><a href="functions.html#cb236-3" aria-hidden="true"></a>tb_income_norm_dot_dollar &lt;-<span class="st"> </span>tb_M <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(ID) <span class="op">%&gt;%</span></span>
<span id="cb236-4"><a href="functions.html#cb236-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">do</span>(<span class="dt">income =</span> <span class="kw">rnorm</span>(.<span class="op">$</span>Q,</span>
<span id="cb236-5"><a href="functions.html#cb236-5" aria-hidden="true"></a>                    <span class="dt">mean=</span>.<span class="op">$</span>mean,</span>
<span id="cb236-6"><a href="functions.html#cb236-6" aria-hidden="true"></a>                    <span class="dt">sd=</span>.<span class="op">$</span>sd)) <span class="op">%&gt;%</span></span>
<span id="cb236-7"><a href="functions.html#cb236-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">unnest</span>(<span class="kw">c</span>(income)) <span class="op">%&gt;%</span></span>
<span id="cb236-8"><a href="functions.html#cb236-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">left_join</span>(tb_M, <span class="dt">by=</span><span class="st">&quot;ID&quot;</span>)</span>
<span id="cb236-9"><a href="functions.html#cb236-9" aria-hidden="true"></a></span>
<span id="cb236-10"><a href="functions.html#cb236-10" aria-hidden="true"></a><span class="co"># Normal Draw Expansion again, dot dollar differently with string variable name</span></span>
<span id="cb236-11"><a href="functions.html#cb236-11" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="st">&#39;123&#39;</span>)</span>
<span id="cb236-12"><a href="functions.html#cb236-12" aria-hidden="true"></a>tb_income_norm_dollar_dot &lt;-<span class="st"> </span>tb_M <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(ID) <span class="op">%&gt;%</span></span>
<span id="cb236-13"><a href="functions.html#cb236-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">do</span>(<span class="dt">income =</span> <span class="kw">rnorm</span>(<span class="st">`</span><span class="dt">$</span><span class="st">`</span>(., <span class="st">&#39;Q&#39;</span>),</span>
<span id="cb236-14"><a href="functions.html#cb236-14" aria-hidden="true"></a>                    <span class="dt">mean =</span> <span class="st">`</span><span class="dt">$</span><span class="st">`</span>(., <span class="st">&#39;mean&#39;</span>),</span>
<span id="cb236-15"><a href="functions.html#cb236-15" aria-hidden="true"></a>                    <span class="dt">sd =</span> <span class="st">`</span><span class="dt">$</span><span class="st">`</span>(., <span class="st">&#39;sd&#39;</span>))) <span class="op">%&gt;%</span></span>
<span id="cb236-16"><a href="functions.html#cb236-16" aria-hidden="true"></a><span class="st">  </span><span class="kw">unnest</span>(<span class="kw">c</span>(income)) <span class="op">%&gt;%</span></span>
<span id="cb236-17"><a href="functions.html#cb236-17" aria-hidden="true"></a><span class="st">  </span><span class="kw">left_join</span>(tb_M, <span class="dt">by=</span><span class="st">&quot;ID&quot;</span>)</span>
<span id="cb236-18"><a href="functions.html#cb236-18" aria-hidden="true"></a></span>
<span id="cb236-19"><a href="functions.html#cb236-19" aria-hidden="true"></a><span class="co"># Normal Draw Expansion again, dot double bracket</span></span>
<span id="cb236-20"><a href="functions.html#cb236-20" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="st">&#39;123&#39;</span>)</span>
<span id="cb236-21"><a href="functions.html#cb236-21" aria-hidden="true"></a>svr_mean &lt;-<span class="st"> &#39;mean&#39;</span></span>
<span id="cb236-22"><a href="functions.html#cb236-22" aria-hidden="true"></a>svr_sd &lt;-<span class="st"> &#39;sd&#39;</span></span>
<span id="cb236-23"><a href="functions.html#cb236-23" aria-hidden="true"></a>svr_Q &lt;-<span class="st"> &#39;Q&#39;</span></span>
<span id="cb236-24"><a href="functions.html#cb236-24" aria-hidden="true"></a>tb_income_norm_dot_bracket_db &lt;-<span class="st"> </span>tb_M <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(ID) <span class="op">%&gt;%</span></span>
<span id="cb236-25"><a href="functions.html#cb236-25" aria-hidden="true"></a><span class="st">  </span><span class="kw">do</span>(<span class="dt">income =</span> <span class="kw">rnorm</span>(.[[svr_Q]],</span>
<span id="cb236-26"><a href="functions.html#cb236-26" aria-hidden="true"></a>                    <span class="dt">mean =</span> .[[svr_mean]],</span>
<span id="cb236-27"><a href="functions.html#cb236-27" aria-hidden="true"></a>                    <span class="dt">sd =</span> .[[svr_sd]])) <span class="op">%&gt;%</span></span>
<span id="cb236-28"><a href="functions.html#cb236-28" aria-hidden="true"></a><span class="st">  </span><span class="kw">unnest</span>(<span class="kw">c</span>(income)) <span class="op">%&gt;%</span></span>
<span id="cb236-29"><a href="functions.html#cb236-29" aria-hidden="true"></a><span class="st">  </span><span class="kw">left_join</span>(tb_M, <span class="dt">by=</span><span class="st">&quot;ID&quot;</span>)</span>
<span id="cb236-30"><a href="functions.html#cb236-30" aria-hidden="true"></a></span>
<span id="cb236-31"><a href="functions.html#cb236-31" aria-hidden="true"></a><span class="co"># display</span></span>
<span id="cb236-32"><a href="functions.html#cb236-32" aria-hidden="true"></a><span class="kw">print</span>(<span class="kw">dim</span>(tb_income_norm_dot_bracket_db))</span></code></pre></div>
<pre><code>## [1] 59429     5</code></pre>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="functions.html#cb238-1" aria-hidden="true"></a><span class="kw">kable</span>(<span class="kw">head</span>(tb_income_norm_dot_bracket_db, <span class="dv">20</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ID
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
income
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Q
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
mean
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.9943952
</td>
<td style="text-align:right;">
3004
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.9976982
</td>
<td style="text-align:right;">
3004
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.0155871
</td>
<td style="text-align:right;">
3004
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.0007051
</td>
<td style="text-align:right;">
3004
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.0012929
</td>
<td style="text-align:right;">
3004
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.0171506
</td>
<td style="text-align:right;">
3004
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.0046092
</td>
<td style="text-align:right;">
3004
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.9873494
</td>
<td style="text-align:right;">
3004
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.9931315
</td>
<td style="text-align:right;">
3004
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.9955434
</td>
<td style="text-align:right;">
3004
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.0122408
</td>
<td style="text-align:right;">
3004
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.0035981
</td>
<td style="text-align:right;">
3004
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.0040077
</td>
<td style="text-align:right;">
3004
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.0011068
</td>
<td style="text-align:right;">
3004
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.9944416
</td>
<td style="text-align:right;">
3004
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.0178691
</td>
<td style="text-align:right;">
3004
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.0049785
</td>
<td style="text-align:right;">
3004
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.9803338
</td>
<td style="text-align:right;">
3004
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.0070136
</td>
<td style="text-align:right;">
3004
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.9952721
</td>
<td style="text-align:right;">
3004
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p>Second, compute gini:</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="functions.html#cb239-1" aria-hidden="true"></a><span class="co"># Gini by Group</span></span>
<span id="cb239-2"><a href="functions.html#cb239-2" aria-hidden="true"></a>tb_gini_norm &lt;-<span class="st"> </span>tb_income_norm_dot_bracket_db <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(ID) <span class="op">%&gt;%</span></span>
<span id="cb239-3"><a href="functions.html#cb239-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">do</span>(<span class="dt">inc_gini_norm =</span> <span class="kw">ff_dist_gini_vector_pos</span>(.<span class="op">$</span>income)) <span class="op">%&gt;%</span></span>
<span id="cb239-4"><a href="functions.html#cb239-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">unnest</span>(<span class="kw">c</span>(inc_gini_norm)) <span class="op">%&gt;%</span></span>
<span id="cb239-5"><a href="functions.html#cb239-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">left_join</span>(tb_M, <span class="dt">by=</span><span class="st">&quot;ID&quot;</span>)</span>
<span id="cb239-6"><a href="functions.html#cb239-6" aria-hidden="true"></a></span>
<span id="cb239-7"><a href="functions.html#cb239-7" aria-hidden="true"></a><span class="co"># display</span></span>
<span id="cb239-8"><a href="functions.html#cb239-8" aria-hidden="true"></a><span class="kw">kable</span>(tb_gini_norm) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ID
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
inc_gini_norm
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Q
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
mean
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0056006
</td>
<td style="text-align:right;">
3004
</td>
<td style="text-align:right;">
0.0100000
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.0174893
</td>
<td style="text-align:right;">
3207
</td>
<td style="text-align:right;">
0.0311111
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.0295527
</td>
<td style="text-align:right;">
7989
</td>
<td style="text-align:right;">
0.0522222
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.0412807
</td>
<td style="text-align:right;">
3995
</td>
<td style="text-align:right;">
0.0733333
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.0537107
</td>
<td style="text-align:right;">
8358
</td>
<td style="text-align:right;">
0.0944444
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0.0650354
</td>
<td style="text-align:right;">
217
</td>
<td style="text-align:right;">
0.1155556
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0.0766718
</td>
<td style="text-align:right;">
9506
</td>
<td style="text-align:right;">
0.1366667
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0.0891009
</td>
<td style="text-align:right;">
8157
</td>
<td style="text-align:right;">
0.1577778
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
0.1014251
</td>
<td style="text-align:right;">
6216
</td>
<td style="text-align:right;">
0.1788889
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.1135054
</td>
<td style="text-align:right;">
8780
</td>
<td style="text-align:right;">
0.2000000
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>

</div>
</div>
<div id="mxp-by-n-to-mxq-by-nz" class="section level3" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> (MxP by N) to (MxQ by N+Z)</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R Code Examples</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository (<a href="https://fanwangecon.github.io/Stat4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<p>There is a dataframe composed of <em>M</em> mini-dataframes. Group by a variable that identifies each unique sub-dataframe, and use the sub-dataframes with <em>P</em> rows as inputs to a function.</p>
<p>The function outputs <em>Q by Z</em> rows and columns of results, stack the results. The output file has <em>MxQ</em> rows and the <em>Z</em> columns of additional results should be appended.</p>
<div id="generate-the-mxp-by-n-dataframe" class="section level4" number="3.2.3.1">
<h4><span class="header-section-number">3.2.3.1</span> Generate the MxP by N Dataframe</h4>
<p><em>M</em> Grouping characteristics, <em>P</em> rows for each group, and <em>N</em> Variables.</p>
<ol style="list-style-type: decimal">
<li><em>M</em> are individuals</li>
<li><em>P</em> are dates</li>
<li>A wage variable for individual wage at each date. And a savings varaible as well.</li>
</ol>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="functions.html#cb240-1" aria-hidden="true"></a><span class="co"># Define</span></span>
<span id="cb240-2"><a href="functions.html#cb240-2" aria-hidden="true"></a>it_M &lt;-<span class="st"> </span><span class="dv">3</span></span>
<span id="cb240-3"><a href="functions.html#cb240-3" aria-hidden="true"></a>it_P &lt;-<span class="st"> </span><span class="dv">5</span></span>
<span id="cb240-4"><a href="functions.html#cb240-4" aria-hidden="true"></a>svr_m &lt;-<span class="st"> &#39;group_m&#39;</span></span>
<span id="cb240-5"><a href="functions.html#cb240-5" aria-hidden="true"></a>svr_mp &lt;-<span class="st"> &#39;info_mp&#39;</span></span>
<span id="cb240-6"><a href="functions.html#cb240-6" aria-hidden="true"></a></span>
<span id="cb240-7"><a href="functions.html#cb240-7" aria-hidden="true"></a><span class="co"># dataframe</span></span>
<span id="cb240-8"><a href="functions.html#cb240-8" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb240-9"><a href="functions.html#cb240-9" aria-hidden="true"></a>df_panel_skeleton &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(<span class="kw">matrix</span>(it_P, <span class="dt">nrow=</span>it_M, <span class="dt">ncol=</span><span class="dv">1</span>)) <span class="op">%&gt;%</span></span>
<span id="cb240-10"><a href="functions.html#cb240-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">rowid_to_column</span>(<span class="dt">var =</span> svr_m) <span class="op">%&gt;%</span></span>
<span id="cb240-11"><a href="functions.html#cb240-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">uncount</span>(V1) <span class="op">%&gt;%</span></span>
<span id="cb240-12"><a href="functions.html#cb240-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_m)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_mp) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">row_number</span>()) <span class="op">%&gt;%</span></span>
<span id="cb240-13"><a href="functions.html#cb240-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb240-14"><a href="functions.html#cb240-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">wage =</span> <span class="kw">rnorm</span>(<span class="dv">1</span>, <span class="dv">100</span>, <span class="dv">10</span>), </span>
<span id="cb240-15"><a href="functions.html#cb240-15" aria-hidden="true"></a>                       <span class="dt">savings =</span> <span class="kw">rnorm</span>(<span class="dv">1</span>, <span class="dv">200</span>, <span class="dv">30</span>)) <span class="op">%&gt;%</span></span>
<span id="cb240-16"><a href="functions.html#cb240-16" aria-hidden="true"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb240-17"><a href="functions.html#cb240-17" aria-hidden="true"></a><span class="st">  </span><span class="kw">rowid_to_column</span>(<span class="dt">var =</span> <span class="st">&quot;id_ji&quot;</span>)</span>
<span id="cb240-18"><a href="functions.html#cb240-18" aria-hidden="true"></a></span>
<span id="cb240-19"><a href="functions.html#cb240-19" aria-hidden="true"></a><span class="co"># Print</span></span>
<span id="cb240-20"><a href="functions.html#cb240-20" aria-hidden="true"></a><span class="kw">kable</span>(df_panel_skeleton) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
id_ji
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
group_m
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
info_mp
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
wage
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
savings
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
94.39524
</td>
<td style="text-align:right;">
253.6074
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
97.69823
</td>
<td style="text-align:right;">
214.9355
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
115.58708
</td>
<td style="text-align:right;">
141.0015
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
100.70508
</td>
<td style="text-align:right;">
221.0407
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
101.29288
</td>
<td style="text-align:right;">
185.8163
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
117.15065
</td>
<td style="text-align:right;">
167.9653
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
104.60916
</td>
<td style="text-align:right;">
193.4608
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
87.34939
</td>
<td style="text-align:right;">
169.2199
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
93.13147
</td>
<td style="text-align:right;">
178.1333
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
95.54338
</td>
<td style="text-align:right;">
181.2488
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
112.24082
</td>
<td style="text-align:right;">
149.3992
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
103.59814
</td>
<td style="text-align:right;">
225.1336
</td>
</tr>
<tr>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
104.00771
</td>
<td style="text-align:right;">
204.6012
</td>
</tr>
<tr>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
101.10683
</td>
<td style="text-align:right;">
165.8559
</td>
</tr>
<tr>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
94.44159
</td>
<td style="text-align:right;">
237.6144
</td>
</tr>
</tbody>
</table>
</div>
<div id="subgroup-compute-and-expand" class="section level4" number="3.2.3.2">
<h4><span class="header-section-number">3.2.3.2</span> Subgroup Compute and Expand</h4>
<p>Use the <em>M</em> sub-dataframes, generate <em>Q</em> by <em>Z</em> result for each of the <em>M</em> groups. Stack all results together.</p>
<p>Base on all the wages for each individual, generate individual specific mean and standard deviations. Do this for three things, the wage variable, the savings variable, and the sum of wage and savings:</p>
<ol style="list-style-type: decimal">
<li><em>Z=2</em>: 2 columns, mean and standard deviation</li>
<li><em>Q=3</em>: 3 rows, statistics based on wage, savings, and the sum of both</li>
</ol>
<p>First, here is the processing function that takes the dataframe as input, with a parameter for rounding:</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="functions.html#cb241-1" aria-hidden="true"></a><span class="co"># define function</span></span>
<span id="cb241-2"><a href="functions.html#cb241-2" aria-hidden="true"></a>ffi_subset_mean_sd &lt;-<span class="st"> </span><span class="cf">function</span>(df_sub, <span class="dt">it_round=</span><span class="dv">1</span>) {</span>
<span id="cb241-3"><a href="functions.html#cb241-3" aria-hidden="true"></a>  <span class="co">#&#39; A function that generates mean and sd for several variables</span></span>
<span id="cb241-4"><a href="functions.html#cb241-4" aria-hidden="true"></a>  <span class="co">#&#39;</span></span>
<span id="cb241-5"><a href="functions.html#cb241-5" aria-hidden="true"></a>  <span class="co">#&#39; @description</span></span>
<span id="cb241-6"><a href="functions.html#cb241-6" aria-hidden="true"></a>  <span class="co">#&#39; Assume there are two variables in df_sub wage and savings</span></span>
<span id="cb241-7"><a href="functions.html#cb241-7" aria-hidden="true"></a>  <span class="co">#&#39;</span></span>
<span id="cb241-8"><a href="functions.html#cb241-8" aria-hidden="true"></a>  <span class="co">#&#39; @param df_sub dataframe where each individual row is a different </span></span>
<span id="cb241-9"><a href="functions.html#cb241-9" aria-hidden="true"></a>  <span class="co">#&#39; data point, over which we compute mean and sd, Assum there are two </span></span>
<span id="cb241-10"><a href="functions.html#cb241-10" aria-hidden="true"></a>  <span class="co">#&#39; variables, savings and wage</span></span>
<span id="cb241-11"><a href="functions.html#cb241-11" aria-hidden="true"></a>  <span class="co">#&#39; @param it_round integer rounding for resulting dataframe</span></span>
<span id="cb241-12"><a href="functions.html#cb241-12" aria-hidden="true"></a>  <span class="co">#&#39; @return a dataframe where each row is aggregate for a different type</span></span>
<span id="cb241-13"><a href="functions.html#cb241-13" aria-hidden="true"></a>  <span class="co">#&#39; of variablea and each column is a different statistics</span></span>
<span id="cb241-14"><a href="functions.html#cb241-14" aria-hidden="true"></a>  </span>
<span id="cb241-15"><a href="functions.html#cb241-15" aria-hidden="true"></a>  fl_wage_mn =<span class="st"> </span><span class="kw">mean</span>(df_sub<span class="op">$</span>wage)</span>
<span id="cb241-16"><a href="functions.html#cb241-16" aria-hidden="true"></a>  fl_wage_sd =<span class="st"> </span><span class="kw">sd</span>(df_sub<span class="op">$</span>wage)</span>
<span id="cb241-17"><a href="functions.html#cb241-17" aria-hidden="true"></a>  </span>
<span id="cb241-18"><a href="functions.html#cb241-18" aria-hidden="true"></a>  fl_save_mn =<span class="st"> </span><span class="kw">mean</span>(df_sub<span class="op">$</span>savings)</span>
<span id="cb241-19"><a href="functions.html#cb241-19" aria-hidden="true"></a>  fl_save_sd =<span class="st"> </span><span class="kw">sd</span>(df_sub<span class="op">$</span>savings)</span>
<span id="cb241-20"><a href="functions.html#cb241-20" aria-hidden="true"></a>  </span>
<span id="cb241-21"><a href="functions.html#cb241-21" aria-hidden="true"></a>  fl_wgsv_mn =<span class="st"> </span><span class="kw">mean</span>(df_sub<span class="op">$</span>wage <span class="op">+</span><span class="st"> </span>df_sub<span class="op">$</span>savings)</span>
<span id="cb241-22"><a href="functions.html#cb241-22" aria-hidden="true"></a>  fl_wgsv_sd =<span class="st"> </span><span class="kw">sd</span>(df_sub<span class="op">$</span>wage <span class="op">+</span><span class="st"> </span>df_sub<span class="op">$</span>savings)  </span>
<span id="cb241-23"><a href="functions.html#cb241-23" aria-hidden="true"></a>  </span>
<span id="cb241-24"><a href="functions.html#cb241-24" aria-hidden="true"></a>  ar_mn &lt;-<span class="st"> </span><span class="kw">c</span>(fl_wage_mn, fl_save_mn, fl_wgsv_mn)</span>
<span id="cb241-25"><a href="functions.html#cb241-25" aria-hidden="true"></a>  ar_sd &lt;-<span class="st"> </span><span class="kw">c</span>(fl_wage_sd, fl_save_sd, fl_wgsv_sd)</span>
<span id="cb241-26"><a href="functions.html#cb241-26" aria-hidden="true"></a>  ar_st_row_lab &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;wage&#39;</span>, <span class="st">&#39;savings&#39;</span>, <span class="st">&#39;wage_and_savings&#39;</span>)</span>
<span id="cb241-27"><a href="functions.html#cb241-27" aria-hidden="true"></a>  </span>
<span id="cb241-28"><a href="functions.html#cb241-28" aria-hidden="true"></a>  mt_stats &lt;-<span class="st"> </span><span class="kw">cbind</span>(ar_mn, ar_sd)</span>
<span id="cb241-29"><a href="functions.html#cb241-29" aria-hidden="true"></a>  mt_stats &lt;-<span class="st"> </span><span class="kw">round</span>(mt_stats, it_round)</span>
<span id="cb241-30"><a href="functions.html#cb241-30" aria-hidden="true"></a>  </span>
<span id="cb241-31"><a href="functions.html#cb241-31" aria-hidden="true"></a>  ar_st_varnames &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;mean&#39;</span>, <span class="st">&#39;sd&#39;</span>, <span class="st">&#39;variables&#39;</span>)</span>
<span id="cb241-32"><a href="functions.html#cb241-32" aria-hidden="true"></a>  df_combine &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(mt_stats) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb241-33"><a href="functions.html#cb241-33" aria-hidden="true"></a><span class="st">    </span><span class="kw">add_column</span>(ar_st_row_lab) <span class="op">%&gt;%</span></span>
<span id="cb241-34"><a href="functions.html#cb241-34" aria-hidden="true"></a><span class="st">    </span><span class="kw">rename_all</span>(<span class="op">~</span><span class="kw">c</span>(ar_st_varnames)) <span class="op">%&gt;%</span></span>
<span id="cb241-35"><a href="functions.html#cb241-35" aria-hidden="true"></a><span class="st">    </span><span class="kw">select</span>(variables, <span class="st">&#39;mean&#39;</span>, <span class="st">&#39;sd&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb241-36"><a href="functions.html#cb241-36" aria-hidden="true"></a><span class="st">    </span><span class="kw">rowid_to_column</span>(<span class="dt">var =</span> <span class="st">&quot;id_q&quot;</span>)</span>
<span id="cb241-37"><a href="functions.html#cb241-37" aria-hidden="true"></a>    </span>
<span id="cb241-38"><a href="functions.html#cb241-38" aria-hidden="true"></a>  <span class="kw">return</span>(df_combine)</span>
<span id="cb241-39"><a href="functions.html#cb241-39" aria-hidden="true"></a>}</span>
<span id="cb241-40"><a href="functions.html#cb241-40" aria-hidden="true"></a><span class="co"># testing function</span></span>
<span id="cb241-41"><a href="functions.html#cb241-41" aria-hidden="true"></a><span class="kw">ffi_subset_mean_sd</span>(df_panel_skeleton <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_m)<span class="op">==</span><span class="dv">1</span>))</span></code></pre></div>
<p>Second, call <em>ffi_subset_mean_sd</em> function for each of the groups indexed by <em>j</em> and stack results together with <em>j</em> index:</p>
<ol style="list-style-type: decimal">
<li>group by</li>
<li>call function</li>
<li>unnest</li>
</ol>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="functions.html#cb242-1" aria-hidden="true"></a><span class="co"># run group stats and stack dataframes</span></span>
<span id="cb242-2"><a href="functions.html#cb242-2" aria-hidden="true"></a>df_outputs &lt;-<span class="st"> </span>df_panel_skeleton <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_m)) <span class="op">%&gt;%</span></span>
<span id="cb242-3"><a href="functions.html#cb242-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">do</span>(<span class="dt">df_stats =</span> <span class="kw">ffi_subset_mean_sd</span>(., <span class="dt">it_round=</span><span class="dv">2</span>)) <span class="op">%&gt;%</span></span>
<span id="cb242-4"><a href="functions.html#cb242-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">unnest</span>() <span class="op">%&gt;%</span></span>
<span id="cb242-5"><a href="functions.html#cb242-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">rowid_to_column</span>(<span class="dt">var =</span> <span class="st">&quot;id_mq&quot;</span>)</span>
<span id="cb242-6"><a href="functions.html#cb242-6" aria-hidden="true"></a><span class="co"># print</span></span>
<span id="cb242-7"><a href="functions.html#cb242-7" aria-hidden="true"></a><span class="kw">kable</span>(df_outputs) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
id_mq
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
group_m
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
id_q
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
variables
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sd
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
wage
</td>
<td style="text-align:right;">
101.94
</td>
<td style="text-align:right;">
8.11
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
savings
</td>
<td style="text-align:right;">
203.28
</td>
<td style="text-align:right;">
42.33
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
wage_and_savings
</td>
<td style="text-align:right;">
305.22
</td>
<td style="text-align:right;">
34.83
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
wage
</td>
<td style="text-align:right;">
99.56
</td>
<td style="text-align:right;">
11.63
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
savings
</td>
<td style="text-align:right;">
178.01
</td>
<td style="text-align:right;">
10.34
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
wage_and_savings
</td>
<td style="text-align:right;">
277.56
</td>
<td style="text-align:right;">
15.48
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
wage
</td>
<td style="text-align:right;">
103.08
</td>
<td style="text-align:right;">
6.39
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
savings
</td>
<td style="text-align:right;">
196.52
</td>
<td style="text-align:right;">
37.86
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
wage_and_savings
</td>
<td style="text-align:right;">
299.60
</td>
<td style="text-align:right;">
33.50
</td>
</tr>
</tbody>
</table>
<p>In the resulting file, we went from a matrix with <em>MxP</em> rows to a matrix with <em>MxQ</em> Rows.</p>

</div>
</div>
</div>
<div id="apply-and-pmap" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Apply and pmap</h2>

<div id="apply-and-sapply" class="section level3" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Apply and Sapply</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R Code Examples</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository (<a href="https://fanwangecon.github.io/Stat4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<ul>
<li>r apply matrix to function row by row</li>
<li>r evaluate function on grid</li>
<li><a href="https://stackoverflow.com/questions/4236368/apply-a-function-to-every-row-of-a-matrix-or-a-data-frame">Apply a function to every row of a matrix or a data frame</a></li>
<li>r apply</li>
<li>r sapply</li>
<li>sapply over matrix row by row</li>
<li>function as parameters using formulas</li>
<li>do</li>
</ul>
<p>We want evaluate linear function f(x_i, y_i, ar_x, ar_y, c, d), where c and d are constants, and ar_x and ar_y are arrays, both fixed. x_i and y_i vary over each row of matrix. More specifically, we have a functions, this function takes inputs that are individual specific. We would like to evaluate this function concurrently across <span class="math inline">\(N\)</span> individuals.</p>
<p>The function is such that across the <span class="math inline">\(N\)</span> individuals, some of the function parameter inputs are the same, but others are different. If we are looking at demand for a particular product, the prices of all products enter the demand equation for each product, but the product’s own price enters also in a different way.</p>
<p>The objective is either to just evaluate this function across <span class="math inline">\(N\)</span> individuals, or this is a part of a nonlinear solution system.</p>
<p>What is the relationship between apply, lapply and vectorization? see <a href="https://stackoverflow.com/a/29006276/8280804">Is the “*apply” family really not vectorized?</a>.</p>
<div id="set-up-input-arrays-2" class="section level4" number="3.3.1.1">
<h4><span class="header-section-number">3.3.1.1</span> Set up Input Arrays</h4>
<p>There is a function that takes <span class="math inline">\(M=Q+P\)</span> inputs, we want to evaluate this function <span class="math inline">\(N\)</span> times. Each time, there are <span class="math inline">\(M\)</span> inputs, where all but <span class="math inline">\(Q\)</span> of the <span class="math inline">\(M\)</span> inputs, meaning <span class="math inline">\(P\)</span> of the <span class="math inline">\(M\)</span> inputs, are the same. In particular, <span class="math inline">\(P=Q*N\)</span>.</p>
<p><span class="math display">\[M = Q+P = Q + Q*N\]</span></p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="functions.html#cb243-1" aria-hidden="true"></a><span class="co"># it_child_count = N, the number of children</span></span>
<span id="cb243-2"><a href="functions.html#cb243-2" aria-hidden="true"></a>it_N_child_cnt =<span class="st"> </span><span class="dv">5</span></span>
<span id="cb243-3"><a href="functions.html#cb243-3" aria-hidden="true"></a><span class="co"># it_heter_param = Q, number of parameters that are</span></span>
<span id="cb243-4"><a href="functions.html#cb243-4" aria-hidden="true"></a><span class="co"># heterogeneous across children</span></span>
<span id="cb243-5"><a href="functions.html#cb243-5" aria-hidden="true"></a>it_Q_hetpa_cnt =<span class="st"> </span><span class="dv">2</span></span>
<span id="cb243-6"><a href="functions.html#cb243-6" aria-hidden="true"></a></span>
<span id="cb243-7"><a href="functions.html#cb243-7" aria-hidden="true"></a><span class="co"># P fixed parameters, nN is N dimensional, nP is P dimensional</span></span>
<span id="cb243-8"><a href="functions.html#cb243-8" aria-hidden="true"></a>ar_nN_A =<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dt">length.out =</span> it_N_child_cnt)</span>
<span id="cb243-9"><a href="functions.html#cb243-9" aria-hidden="true"></a>ar_nN_alpha =<span class="st"> </span><span class="kw">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="dt">length.out =</span> it_N_child_cnt)</span>
<span id="cb243-10"><a href="functions.html#cb243-10" aria-hidden="true"></a>ar_nP_A_alpha =<span class="st"> </span><span class="kw">c</span>(ar_nN_A, ar_nN_alpha)</span>
<span id="cb243-11"><a href="functions.html#cb243-11" aria-hidden="true"></a></span>
<span id="cb243-12"><a href="functions.html#cb243-12" aria-hidden="true"></a><span class="co"># N by Q varying parameters</span></span>
<span id="cb243-13"><a href="functions.html#cb243-13" aria-hidden="true"></a>mt_nN_by_nQ_A_alpha =<span class="st"> </span><span class="kw">cbind</span>(ar_nN_A, ar_nN_alpha)</span>
<span id="cb243-14"><a href="functions.html#cb243-14" aria-hidden="true"></a></span>
<span id="cb243-15"><a href="functions.html#cb243-15" aria-hidden="true"></a><span class="co"># display</span></span>
<span id="cb243-16"><a href="functions.html#cb243-16" aria-hidden="true"></a><span class="kw">kable</span>(mt_nN_by_nQ_A_alpha) <span class="op">%&gt;%</span></span>
<span id="cb243-17"><a href="functions.html#cb243-17" aria-hidden="true"></a><span class="st">  </span><span class="kw">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ar_nN_A
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ar_nN_alpha
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-2
</td>
<td style="text-align:right;">
0.1
</td>
</tr>
<tr>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0.3
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.5
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.7
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.9
</td>
</tr>
</tbody>
</table>
</div>
<div id="using-apply" class="section level4" number="3.3.1.2">
<h4><span class="header-section-number">3.3.1.2</span> Using apply</h4>
<div id="named-function" class="section level5" number="3.3.1.2.1">
<h5><span class="header-section-number">3.3.1.2.1</span> Named Function</h5>
<p>First we use the apply function, we have to hard-code the arrays that are fixed for each of the <span class="math inline">\(N\)</span> individuals. Then apply allows us to loop over the matrix that is <span class="math inline">\(N\)</span> by <span class="math inline">\(Q\)</span>, each row one at a time, from <span class="math inline">\(1\)</span> to <span class="math inline">\(N\)</span>.</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="functions.html#cb244-1" aria-hidden="true"></a><span class="co"># Define Implicit Function</span></span>
<span id="cb244-2"><a href="functions.html#cb244-2" aria-hidden="true"></a>ffi_linear_hardcode &lt;-<span class="st"> </span><span class="cf">function</span>(ar_A_alpha){</span>
<span id="cb244-3"><a href="functions.html#cb244-3" aria-hidden="true"></a>  <span class="co"># ar_A_alpha[1] is A</span></span>
<span id="cb244-4"><a href="functions.html#cb244-4" aria-hidden="true"></a>  <span class="co"># ar_A_alpha[2] is alpha</span></span>
<span id="cb244-5"><a href="functions.html#cb244-5" aria-hidden="true"></a></span>
<span id="cb244-6"><a href="functions.html#cb244-6" aria-hidden="true"></a>  fl_out =<span class="st"> </span><span class="kw">sum</span>(ar_A_alpha[<span class="dv">1</span>]<span class="op">*</span>ar_nN_A <span class="op">+</span></span>
<span id="cb244-7"><a href="functions.html#cb244-7" aria-hidden="true"></a><span class="st">                 </span><span class="dv">1</span><span class="op">/</span>(ar_A_alpha[<span class="dv">2</span>] <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span>ar_nN_alpha))</span>
<span id="cb244-8"><a href="functions.html#cb244-8" aria-hidden="true"></a></span>
<span id="cb244-9"><a href="functions.html#cb244-9" aria-hidden="true"></a>  <span class="kw">return</span>(fl_out)</span>
<span id="cb244-10"><a href="functions.html#cb244-10" aria-hidden="true"></a>}</span>
<span id="cb244-11"><a href="functions.html#cb244-11" aria-hidden="true"></a></span>
<span id="cb244-12"><a href="functions.html#cb244-12" aria-hidden="true"></a><span class="co"># Evaluate function row by row</span></span>
<span id="cb244-13"><a href="functions.html#cb244-13" aria-hidden="true"></a>ar_func_apply =<span class="st"> </span><span class="kw">apply</span>(mt_nN_by_nQ_A_alpha, <span class="dv">1</span>, ffi_linear_hardcode)</span></code></pre></div>
</div>
<div id="anonymous-function" class="section level5" number="3.3.1.2.2">
<h5><span class="header-section-number">3.3.1.2.2</span> Anonymous Function</h5>
<ul>
<li>apply over matrix</li>
</ul>
<p>Apply with anonymous function generating a list of arrays of different lengths. In the example below, we want to drawn <span class="math inline">\(N\)</span> sets of random uniform numbers, but for each set the number of draws we want to have is <span class="math inline">\(Q_i\)</span>. Furthermore, we want to rescale the random uniform draws so that they all become proportions that sum u pto one for each <span class="math inline">\(i\)</span>, but then we multply each row’s values by the row specific aggregates.</p>
<p>The anonymous function has hard coded parameters. Using an anonymous function here allows for parameters to be provided inside the function that are shared across each looped evaluation. This is perhaps more convenient than sapply with additional parameters.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="functions.html#cb245-1" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1039</span>)</span>
<span id="cb245-2"><a href="functions.html#cb245-2" aria-hidden="true"></a></span>
<span id="cb245-3"><a href="functions.html#cb245-3" aria-hidden="true"></a><span class="co"># Define the number of draws each row and total amount</span></span>
<span id="cb245-4"><a href="functions.html#cb245-4" aria-hidden="true"></a>it_N &lt;-<span class="st"> </span><span class="dv">4</span></span>
<span id="cb245-5"><a href="functions.html#cb245-5" aria-hidden="true"></a>fl_unif_min &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb245-6"><a href="functions.html#cb245-6" aria-hidden="true"></a>fl_unif_max &lt;-<span class="st"> </span><span class="dv">2</span></span>
<span id="cb245-7"><a href="functions.html#cb245-7" aria-hidden="true"></a>mt_draw_define &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">sample</span>(it_N, it_N, <span class="dt">replace=</span><span class="ot">TRUE</span>),</span>
<span id="cb245-8"><a href="functions.html#cb245-8" aria-hidden="true"></a>                        <span class="kw">runif</span>(it_N, <span class="dt">min=</span><span class="dv">1</span>, <span class="dt">max=</span><span class="dv">10</span>))</span>
<span id="cb245-9"><a href="functions.html#cb245-9" aria-hidden="true"></a>tb_draw_define &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(mt_draw_define) <span class="op">%&gt;%</span></span>
<span id="cb245-10"><a href="functions.html#cb245-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">rowid_to_column</span>(<span class="dt">var =</span> <span class="st">&quot;draw_group&quot;</span>)</span>
<span id="cb245-11"><a href="functions.html#cb245-11" aria-hidden="true"></a><span class="kw">print</span>(tb_draw_define)</span>
<span id="cb245-12"><a href="functions.html#cb245-12" aria-hidden="true"></a></span>
<span id="cb245-13"><a href="functions.html#cb245-13" aria-hidden="true"></a><span class="co"># apply row by row, anonymous function has hard</span></span>
<span id="cb245-14"><a href="functions.html#cb245-14" aria-hidden="true"></a><span class="co"># coded min and max</span></span>
<span id="cb245-15"><a href="functions.html#cb245-15" aria-hidden="true"></a>ls_ar_draws_shares_lvls =</span>
<span id="cb245-16"><a href="functions.html#cb245-16" aria-hidden="true"></a><span class="st">  </span><span class="kw">apply</span>(tb_draw_define,</span>
<span id="cb245-17"><a href="functions.html#cb245-17" aria-hidden="true"></a>        <span class="dv">1</span>,</span>
<span id="cb245-18"><a href="functions.html#cb245-18" aria-hidden="true"></a>        <span class="cf">function</span>(row) {</span>
<span id="cb245-19"><a href="functions.html#cb245-19" aria-hidden="true"></a>          it_draw &lt;-<span class="st"> </span>row[<span class="dv">2</span>]</span>
<span id="cb245-20"><a href="functions.html#cb245-20" aria-hidden="true"></a>          fl_sum &lt;-<span class="st"> </span>row[<span class="dv">3</span>]</span>
<span id="cb245-21"><a href="functions.html#cb245-21" aria-hidden="true"></a>          ar_unif &lt;-<span class="st"> </span><span class="kw">runif</span>(it_draw,</span>
<span id="cb245-22"><a href="functions.html#cb245-22" aria-hidden="true"></a>                           <span class="dt">min=</span>fl_unif_min,</span>
<span id="cb245-23"><a href="functions.html#cb245-23" aria-hidden="true"></a>                           <span class="dt">max=</span>fl_unif_max)</span>
<span id="cb245-24"><a href="functions.html#cb245-24" aria-hidden="true"></a>          ar_share &lt;-<span class="st"> </span>ar_unif<span class="op">/</span><span class="kw">sum</span>(ar_unif)</span>
<span id="cb245-25"><a href="functions.html#cb245-25" aria-hidden="true"></a>          ar_levels &lt;-<span class="st"> </span>ar_share<span class="op">*</span>fl_sum</span>
<span id="cb245-26"><a href="functions.html#cb245-26" aria-hidden="true"></a>          <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">ar_share=</span>ar_share,</span>
<span id="cb245-27"><a href="functions.html#cb245-27" aria-hidden="true"></a>                      <span class="dt">ar_levels=</span>ar_levels))</span>
<span id="cb245-28"><a href="functions.html#cb245-28" aria-hidden="true"></a>        })</span>
<span id="cb245-29"><a href="functions.html#cb245-29" aria-hidden="true"></a></span>
<span id="cb245-30"><a href="functions.html#cb245-30" aria-hidden="true"></a><span class="co"># Show Results</span></span>
<span id="cb245-31"><a href="functions.html#cb245-31" aria-hidden="true"></a><span class="kw">print</span>(ls_ar_draws_shares_lvls)</span></code></pre></div>
<pre><code>## [[1]]
## [[1]]$ar_share
## [1] 0.2783638 0.2224140 0.2797840 0.2194381
## 
## [[1]]$ar_levels
## [1] 1.492414 1.192446 1.500028 1.176491
## 
## 
## [[2]]
## [[2]]$ar_share
## [1] 0.5052919 0.4947081
## 
## [[2]]$ar_levels
## [1] 3.866528 3.785541
## 
## 
## [[3]]
## [[3]]$ar_share
## [1] 1
## 
## [[3]]$ar_levels
##       V2 
## 9.572211 
## 
## 
## [[4]]
## [[4]]$ar_share
## [1] 0.4211426 0.2909812 0.2878762
## 
## [[4]]$ar_levels
## [1] 4.051971 2.799640 2.769765</code></pre>
<p>We will try to do the same thing as above, but now the output will be a stacked dataframe. Note that within each element of the apply row by row loop, we are generating two variables <em>ar_share</em> and <em>ar_levels</em>. We will not generate a dataframe with multiple columns, storing <em>ar_share</em>, <em>ar_levels</em> as well as information on <em>min</em>, <em>max</em>, number of draws and rescale total sum.</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="functions.html#cb247-1" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1039</span>)</span>
<span id="cb247-2"><a href="functions.html#cb247-2" aria-hidden="true"></a><span class="co"># apply row by row, anonymous function has hard coded min and max</span></span>
<span id="cb247-3"><a href="functions.html#cb247-3" aria-hidden="true"></a>ls_mt_draws_shares_lvls =</span>
<span id="cb247-4"><a href="functions.html#cb247-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">apply</span>(tb_draw_define, <span class="dv">1</span>, <span class="cf">function</span>(row) {</span>
<span id="cb247-5"><a href="functions.html#cb247-5" aria-hidden="true"></a></span>
<span id="cb247-6"><a href="functions.html#cb247-6" aria-hidden="true"></a>    it_draw_group &lt;-<span class="st"> </span>row[<span class="dv">1</span>]</span>
<span id="cb247-7"><a href="functions.html#cb247-7" aria-hidden="true"></a>    it_draw &lt;-<span class="st"> </span>row[<span class="dv">2</span>]</span>
<span id="cb247-8"><a href="functions.html#cb247-8" aria-hidden="true"></a>    fl_sum &lt;-<span class="st"> </span>row[<span class="dv">3</span>]</span>
<span id="cb247-9"><a href="functions.html#cb247-9" aria-hidden="true"></a></span>
<span id="cb247-10"><a href="functions.html#cb247-10" aria-hidden="true"></a>    ar_unif &lt;-<span class="st"> </span><span class="kw">runif</span>(it_draw,</span>
<span id="cb247-11"><a href="functions.html#cb247-11" aria-hidden="true"></a>                     <span class="dt">min=</span>fl_unif_min,</span>
<span id="cb247-12"><a href="functions.html#cb247-12" aria-hidden="true"></a>                     <span class="dt">max=</span>fl_unif_max)</span>
<span id="cb247-13"><a href="functions.html#cb247-13" aria-hidden="true"></a>    ar_share &lt;-<span class="st"> </span>ar_unif<span class="op">/</span><span class="kw">sum</span>(ar_unif)</span>
<span id="cb247-14"><a href="functions.html#cb247-14" aria-hidden="true"></a>    ar_levels &lt;-<span class="st"> </span>ar_share<span class="op">*</span>fl_sum</span>
<span id="cb247-15"><a href="functions.html#cb247-15" aria-hidden="true"></a></span>
<span id="cb247-16"><a href="functions.html#cb247-16" aria-hidden="true"></a>    mt_all_res &lt;-<span class="st"> </span><span class="kw">cbind</span>(it_draw_group, it_draw, fl_sum,</span>
<span id="cb247-17"><a href="functions.html#cb247-17" aria-hidden="true"></a>                        ar_unif, ar_share, ar_levels)</span>
<span id="cb247-18"><a href="functions.html#cb247-18" aria-hidden="true"></a>    <span class="kw">colnames</span>(mt_all_res) &lt;-</span>
<span id="cb247-19"><a href="functions.html#cb247-19" aria-hidden="true"></a><span class="st">      </span><span class="kw">c</span>(<span class="st">&#39;draw_group&#39;</span>, <span class="st">&#39;draw_count&#39;</span>, <span class="st">&#39;sum&#39;</span>,</span>
<span id="cb247-20"><a href="functions.html#cb247-20" aria-hidden="true"></a>        <span class="st">&#39;unif_draw&#39;</span>, <span class="st">&#39;share&#39;</span>, <span class="st">&#39;rescale&#39;</span>)</span>
<span id="cb247-21"><a href="functions.html#cb247-21" aria-hidden="true"></a>    <span class="kw">rownames</span>(mt_all_res) &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb247-22"><a href="functions.html#cb247-22" aria-hidden="true"></a></span>
<span id="cb247-23"><a href="functions.html#cb247-23" aria-hidden="true"></a>    <span class="kw">return</span>(mt_all_res)</span>
<span id="cb247-24"><a href="functions.html#cb247-24" aria-hidden="true"></a>  })</span>
<span id="cb247-25"><a href="functions.html#cb247-25" aria-hidden="true"></a>mt_draws_shares_lvls_all &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, ls_mt_draws_shares_lvls)</span>
<span id="cb247-26"><a href="functions.html#cb247-26" aria-hidden="true"></a><span class="co"># Show Results</span></span>
<span id="cb247-27"><a href="functions.html#cb247-27" aria-hidden="true"></a><span class="kw">kable</span>(mt_draws_shares_lvls_all) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
draw_group
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
draw_count
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sum
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
unif_draw
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
share
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
rescale
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
5.361378
</td>
<td style="text-align:right;">
1.125668
</td>
<td style="text-align:right;">
0.1988606
</td>
<td style="text-align:right;">
1.066167
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
5.361378
</td>
<td style="text-align:right;">
1.668536
</td>
<td style="text-align:right;">
0.2947638
</td>
<td style="text-align:right;">
1.580340
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
5.361378
</td>
<td style="text-align:right;">
1.419382
</td>
<td style="text-align:right;">
0.2507483
</td>
<td style="text-align:right;">
1.344356
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
5.361378
</td>
<td style="text-align:right;">
1.447001
</td>
<td style="text-align:right;">
0.2556274
</td>
<td style="text-align:right;">
1.370515
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
7.652069
</td>
<td style="text-align:right;">
1.484598
</td>
<td style="text-align:right;">
0.4605236
</td>
<td style="text-align:right;">
3.523959
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
7.652069
</td>
<td style="text-align:right;">
1.739119
</td>
<td style="text-align:right;">
0.5394764
</td>
<td style="text-align:right;">
4.128110
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
9.572211
</td>
<td style="text-align:right;">
1.952468
</td>
<td style="text-align:right;">
1.0000000
</td>
<td style="text-align:right;">
9.572211
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
9.621375
</td>
<td style="text-align:right;">
1.957931
</td>
<td style="text-align:right;">
0.3609352
</td>
<td style="text-align:right;">
3.472693
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
9.621375
</td>
<td style="text-align:right;">
1.926995
</td>
<td style="text-align:right;">
0.3552324
</td>
<td style="text-align:right;">
3.417824
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
9.621375
</td>
<td style="text-align:right;">
1.539678
</td>
<td style="text-align:right;">
0.2838324
</td>
<td style="text-align:right;">
2.730858
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="using-sapply" class="section level4" number="3.3.1.3">
<h4><span class="header-section-number">3.3.1.3</span> Using sapply</h4>
<div id="named-function-1" class="section level5" number="3.3.1.3.1">
<h5><span class="header-section-number">3.3.1.3.1</span> Named Function</h5>
<ul>
<li>r convert matrix to list</li>
<li>Convert a matrix to a list of vectors in R</li>
</ul>
<p>Sapply allows us to not have tohard code in the A and alpha arrays. But Sapply works over List or Vector, not Matrix. So we have to convert the <span class="math inline">\(N\)</span> by <span class="math inline">\(Q\)</span> matrix to a N element list
Now update the function with sapply.</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="functions.html#cb248-1" aria-hidden="true"></a>ls_ar_nN_by_nQ_A_alpha =<span class="st"> </span><span class="kw">as.list</span>(<span class="kw">data.frame</span>(<span class="kw">t</span>(mt_nN_by_nQ_A_alpha)))</span>
<span id="cb248-2"><a href="functions.html#cb248-2" aria-hidden="true"></a></span>
<span id="cb248-3"><a href="functions.html#cb248-3" aria-hidden="true"></a><span class="co"># Define Implicit Function</span></span>
<span id="cb248-4"><a href="functions.html#cb248-4" aria-hidden="true"></a>ffi_linear_sapply &lt;-<span class="st"> </span><span class="cf">function</span>(ar_A_alpha, ar_A, ar_alpha){</span>
<span id="cb248-5"><a href="functions.html#cb248-5" aria-hidden="true"></a>  <span class="co"># ar_A_alpha[1] is A</span></span>
<span id="cb248-6"><a href="functions.html#cb248-6" aria-hidden="true"></a>  <span class="co"># ar_A_alpha[2] is alpha</span></span>
<span id="cb248-7"><a href="functions.html#cb248-7" aria-hidden="true"></a></span>
<span id="cb248-8"><a href="functions.html#cb248-8" aria-hidden="true"></a>  fl_out =<span class="st"> </span><span class="kw">sum</span>(ar_A_alpha[<span class="dv">1</span>]<span class="op">*</span>ar_nN_A <span class="op">+</span></span>
<span id="cb248-9"><a href="functions.html#cb248-9" aria-hidden="true"></a><span class="st">                 </span><span class="dv">1</span><span class="op">/</span>(ar_A_alpha[<span class="dv">2</span>] <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span>ar_nN_alpha))</span>
<span id="cb248-10"><a href="functions.html#cb248-10" aria-hidden="true"></a></span>
<span id="cb248-11"><a href="functions.html#cb248-11" aria-hidden="true"></a>  <span class="kw">return</span>(fl_out)</span>
<span id="cb248-12"><a href="functions.html#cb248-12" aria-hidden="true"></a>}</span>
<span id="cb248-13"><a href="functions.html#cb248-13" aria-hidden="true"></a></span>
<span id="cb248-14"><a href="functions.html#cb248-14" aria-hidden="true"></a><span class="co"># Evaluate function row by row</span></span>
<span id="cb248-15"><a href="functions.html#cb248-15" aria-hidden="true"></a>ar_func_sapply =<span class="st"> </span><span class="kw">sapply</span>(ls_ar_nN_by_nQ_A_alpha, ffi_linear_sapply,</span>
<span id="cb248-16"><a href="functions.html#cb248-16" aria-hidden="true"></a>                        <span class="dt">ar_A=</span>ar_nN_A, <span class="dt">ar_alpha=</span>ar_nN_alpha)</span></code></pre></div>
</div>
<div id="anonymous-function-1" class="section level5" number="3.3.1.3.2">
<h5><span class="header-section-number">3.3.1.3.2</span> Anonymous Function</h5>
<ul>
<li>sapply anonymous function</li>
<li>r anoymous function multiple lines</li>
</ul>
<p>Sapply with anonymous function generating a list of arrays of different lengths. In the example below, we want to drawn <span class="math inline">\(N\)</span> sets of random uniform numbers, but for each set the number of draws we want to have is <span class="math inline">\(Q_i\)</span>. Furthermore, we want to rescale the random uniform draws so that they all become proportions that sum u pto one for each <span class="math inline">\(i\)</span>.</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="functions.html#cb249-1" aria-hidden="true"></a>it_N &lt;-<span class="st"> </span><span class="dv">4</span></span>
<span id="cb249-2"><a href="functions.html#cb249-2" aria-hidden="true"></a>fl_unif_min &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb249-3"><a href="functions.html#cb249-3" aria-hidden="true"></a>fl_unif_max &lt;-<span class="st"> </span><span class="dv">2</span></span>
<span id="cb249-4"><a href="functions.html#cb249-4" aria-hidden="true"></a></span>
<span id="cb249-5"><a href="functions.html#cb249-5" aria-hidden="true"></a><span class="co"># Generate using runif without anonymous function</span></span>
<span id="cb249-6"><a href="functions.html#cb249-6" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1039</span>)</span>
<span id="cb249-7"><a href="functions.html#cb249-7" aria-hidden="true"></a>ls_ar_draws =<span class="st"> </span><span class="kw">sapply</span>(<span class="kw">seq</span>(it_N),</span>
<span id="cb249-8"><a href="functions.html#cb249-8" aria-hidden="true"></a>                     runif,</span>
<span id="cb249-9"><a href="functions.html#cb249-9" aria-hidden="true"></a>                     <span class="dt">min=</span>fl_unif_min, <span class="dt">max=</span>fl_unif_max)</span>
<span id="cb249-10"><a href="functions.html#cb249-10" aria-hidden="true"></a><span class="kw">print</span>(ls_ar_draws)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 1.125668
## 
## [[2]]
## [1] 1.668536 1.419382
## 
## [[3]]
## [1] 1.447001 1.484598 1.739119
## 
## [[4]]
## [1] 1.952468 1.957931 1.926995 1.539678</code></pre>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="functions.html#cb251-1" aria-hidden="true"></a><span class="co"># Generate Using Anonymous Function</span></span>
<span id="cb251-2"><a href="functions.html#cb251-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1039</span>)</span>
<span id="cb251-3"><a href="functions.html#cb251-3" aria-hidden="true"></a>ls_ar_draws_shares =<span class="st"> </span><span class="kw">sapply</span>(<span class="kw">seq</span>(it_N),</span>
<span id="cb251-4"><a href="functions.html#cb251-4" aria-hidden="true"></a>                            <span class="cf">function</span>(n, min, max) {</span>
<span id="cb251-5"><a href="functions.html#cb251-5" aria-hidden="true"></a>                              ar_unif &lt;-<span class="st"> </span><span class="kw">runif</span>(n,min,max)</span>
<span id="cb251-6"><a href="functions.html#cb251-6" aria-hidden="true"></a>                              ar_share &lt;-<span class="st"> </span>ar_unif<span class="op">/</span><span class="kw">sum</span>(ar_unif)</span>
<span id="cb251-7"><a href="functions.html#cb251-7" aria-hidden="true"></a>                              <span class="kw">return</span>(ar_share)</span>
<span id="cb251-8"><a href="functions.html#cb251-8" aria-hidden="true"></a>                            },</span>
<span id="cb251-9"><a href="functions.html#cb251-9" aria-hidden="true"></a>                            <span class="dt">min=</span>fl_unif_min, <span class="dt">max=</span>fl_unif_max)</span>
<span id="cb251-10"><a href="functions.html#cb251-10" aria-hidden="true"></a><span class="co"># Print Share</span></span>
<span id="cb251-11"><a href="functions.html#cb251-11" aria-hidden="true"></a><span class="kw">print</span>(ls_ar_draws_shares)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 1
## 
## [[2]]
## [1] 0.5403432 0.4596568
## 
## [[3]]
## [1] 0.3098027 0.3178522 0.3723451
## 
## [[4]]
## [1] 0.2646671 0.2654076 0.2612141 0.2087113</code></pre>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="functions.html#cb253-1" aria-hidden="true"></a><span class="co"># Sapply with anonymous function to check sums</span></span>
<span id="cb253-2"><a href="functions.html#cb253-2" aria-hidden="true"></a><span class="kw">sapply</span>(<span class="kw">seq</span>(it_N), <span class="cf">function</span>(x) {<span class="kw">sum</span>(ls_ar_draws[[x]])})</span></code></pre></div>
<pre><code>## [1] 1.125668 3.087918 4.670717 7.377071</code></pre>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="functions.html#cb255-1" aria-hidden="true"></a><span class="kw">sapply</span>(<span class="kw">seq</span>(it_N), <span class="cf">function</span>(x) {<span class="kw">sum</span>(ls_ar_draws_shares[[x]])})</span></code></pre></div>
<pre><code>## [1] 1 1 1 1</code></pre>
</div>
</div>
<div id="compare-results" class="section level4" number="3.3.1.4">
<h4><span class="header-section-number">3.3.1.4</span> Compare Results</h4>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="functions.html#cb257-1" aria-hidden="true"></a><span class="co"># Show overall Results</span></span>
<span id="cb257-2"><a href="functions.html#cb257-2" aria-hidden="true"></a>mt_results &lt;-<span class="st"> </span><span class="kw">cbind</span>(ar_func_apply, ar_func_sapply)</span>
<span id="cb257-3"><a href="functions.html#cb257-3" aria-hidden="true"></a><span class="kw">colnames</span>(mt_results) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;eval_lin_apply&#39;</span>, <span class="st">&#39;eval_lin_sapply&#39;</span>)</span>
<span id="cb257-4"><a href="functions.html#cb257-4" aria-hidden="true"></a><span class="kw">kable</span>(mt_results) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
eval_lin_apply
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
eval_lin_sapply
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
X1
</td>
<td style="text-align:right;">
2.346356
</td>
<td style="text-align:right;">
2.346356
</td>
</tr>
<tr>
<td style="text-align:left;">
X2
</td>
<td style="text-align:right;">
2.094273
</td>
<td style="text-align:right;">
2.094273
</td>
</tr>
<tr>
<td style="text-align:left;">
X3
</td>
<td style="text-align:right;">
1.895316
</td>
<td style="text-align:right;">
1.895316
</td>
</tr>
<tr>
<td style="text-align:left;">
X4
</td>
<td style="text-align:right;">
1.733708
</td>
<td style="text-align:right;">
1.733708
</td>
</tr>
<tr>
<td style="text-align:left;">
X5
</td>
<td style="text-align:right;">
1.599477
</td>
<td style="text-align:right;">
1.599477
</td>
</tr>
</tbody>
</table>

</div>
</div>
<div id="mutate-evaluate-functions" class="section level3" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Mutate Evaluate Functions</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R Code Examples</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository (<a href="https://fanwangecon.github.io/Stat4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<p>Apply a function over rows of a matrix using mutate, rowwise, etc.</p>
<div id="set-up-input-arrays-3" class="section level4" number="3.3.2.1">
<h4><span class="header-section-number">3.3.2.1</span> Set up Input Arrays</h4>
<p>There is a function that takes <span class="math inline">\(M=Q+P\)</span> inputs, we want to evaluate this function <span class="math inline">\(N\)</span> times. Each time, there are <span class="math inline">\(M\)</span> inputs, where all but <span class="math inline">\(Q\)</span> of the <span class="math inline">\(M\)</span> inputs, meaning <span class="math inline">\(P\)</span> of the <span class="math inline">\(M\)</span> inputs, are the same. In particular, <span class="math inline">\(P=Q*N\)</span>.</p>
<p><span class="math display">\[M = Q+P = Q + Q*N\]</span></p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="functions.html#cb258-1" aria-hidden="true"></a><span class="co"># it_child_count = N, the number of children</span></span>
<span id="cb258-2"><a href="functions.html#cb258-2" aria-hidden="true"></a>it_N_child_cnt =<span class="st"> </span><span class="dv">5</span></span>
<span id="cb258-3"><a href="functions.html#cb258-3" aria-hidden="true"></a><span class="co"># it_heter_param = Q, number of parameters that are</span></span>
<span id="cb258-4"><a href="functions.html#cb258-4" aria-hidden="true"></a><span class="co"># heterogeneous across children</span></span>
<span id="cb258-5"><a href="functions.html#cb258-5" aria-hidden="true"></a>it_Q_hetpa_cnt =<span class="st"> </span><span class="dv">2</span></span>
<span id="cb258-6"><a href="functions.html#cb258-6" aria-hidden="true"></a></span>
<span id="cb258-7"><a href="functions.html#cb258-7" aria-hidden="true"></a><span class="co"># P fixed parameters, nN is N dimensional, nP is P dimensional</span></span>
<span id="cb258-8"><a href="functions.html#cb258-8" aria-hidden="true"></a>ar_nN_A =<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dt">length.out =</span> it_N_child_cnt)</span>
<span id="cb258-9"><a href="functions.html#cb258-9" aria-hidden="true"></a>ar_nN_alpha =<span class="st"> </span><span class="kw">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="dt">length.out =</span> it_N_child_cnt)</span>
<span id="cb258-10"><a href="functions.html#cb258-10" aria-hidden="true"></a>ar_nP_A_alpha =<span class="st"> </span><span class="kw">c</span>(ar_nN_A, ar_nN_alpha)</span>
<span id="cb258-11"><a href="functions.html#cb258-11" aria-hidden="true"></a></span>
<span id="cb258-12"><a href="functions.html#cb258-12" aria-hidden="true"></a><span class="co"># N by Q varying parameters</span></span>
<span id="cb258-13"><a href="functions.html#cb258-13" aria-hidden="true"></a>mt_nN_by_nQ_A_alpha =<span class="st"> </span><span class="kw">cbind</span>(ar_nN_A, ar_nN_alpha)</span>
<span id="cb258-14"><a href="functions.html#cb258-14" aria-hidden="true"></a></span>
<span id="cb258-15"><a href="functions.html#cb258-15" aria-hidden="true"></a><span class="co"># display</span></span>
<span id="cb258-16"><a href="functions.html#cb258-16" aria-hidden="true"></a><span class="kw">kable</span>(mt_nN_by_nQ_A_alpha) <span class="op">%&gt;%</span></span>
<span id="cb258-17"><a href="functions.html#cb258-17" aria-hidden="true"></a><span class="st">  </span><span class="kw">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ar_nN_A
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ar_nN_alpha
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-2
</td>
<td style="text-align:right;">
0.1
</td>
</tr>
<tr>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0.3
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.5
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.7
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.9
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="functions.html#cb259-1" aria-hidden="true"></a><span class="co"># Convert Matrix to Tibble</span></span>
<span id="cb259-2"><a href="functions.html#cb259-2" aria-hidden="true"></a>ar_st_col_names =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;fl_A&#39;</span>, <span class="st">&#39;fl_alpha&#39;</span>)</span>
<span id="cb259-3"><a href="functions.html#cb259-3" aria-hidden="true"></a>tb_nN_by_nQ_A_alpha &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(mt_nN_by_nQ_A_alpha) <span class="op">%&gt;%</span></span>
<span id="cb259-4"><a href="functions.html#cb259-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">rename_all</span>(<span class="op">~</span><span class="kw">c</span>(ar_st_col_names))</span>
<span id="cb259-5"><a href="functions.html#cb259-5" aria-hidden="true"></a><span class="co"># Show</span></span>
<span id="cb259-6"><a href="functions.html#cb259-6" aria-hidden="true"></a><span class="kw">kable</span>(tb_nN_by_nQ_A_alpha) <span class="op">%&gt;%</span></span>
<span id="cb259-7"><a href="functions.html#cb259-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_A
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_alpha
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-2
</td>
<td style="text-align:right;">
0.1
</td>
</tr>
<tr>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0.3
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.5
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.7
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.9
</td>
</tr>
</tbody>
</table>
</div>
<div id="mutate-rowwise" class="section level4" number="3.3.2.2">
<h4><span class="header-section-number">3.3.2.2</span> mutate rowwise</h4>
<ul>
<li>dplyr mutate own function</li>
<li>dplyr all row function</li>
<li>dplyr do function</li>
<li>apply function each row dplyr</li>
<li>applying a function to every row of a table using dplyr</li>
<li>dplyr rowwise</li>
</ul>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="functions.html#cb260-1" aria-hidden="true"></a><span class="co"># Define Implicit Function</span></span>
<span id="cb260-2"><a href="functions.html#cb260-2" aria-hidden="true"></a>ffi_linear_dplyrdo &lt;-<span class="st"> </span><span class="cf">function</span>(fl_A, fl_alpha, ar_nN_A, ar_nN_alpha){</span>
<span id="cb260-3"><a href="functions.html#cb260-3" aria-hidden="true"></a>  <span class="co"># ar_A_alpha[1] is A</span></span>
<span id="cb260-4"><a href="functions.html#cb260-4" aria-hidden="true"></a>  <span class="co"># ar_A_alpha[2] is alpha</span></span>
<span id="cb260-5"><a href="functions.html#cb260-5" aria-hidden="true"></a></span>
<span id="cb260-6"><a href="functions.html#cb260-6" aria-hidden="true"></a>  <span class="kw">print</span>(<span class="kw">paste0</span>(<span class="st">&#39;cur row, fl_A=&#39;</span>, fl_A, <span class="st">&#39;, fl_alpha=&#39;</span>, fl_alpha))</span>
<span id="cb260-7"><a href="functions.html#cb260-7" aria-hidden="true"></a>  fl_out =<span class="st"> </span><span class="kw">sum</span>(fl_A<span class="op">*</span>ar_nN_A <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span>(fl_alpha <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span>ar_nN_alpha))</span>
<span id="cb260-8"><a href="functions.html#cb260-8" aria-hidden="true"></a></span>
<span id="cb260-9"><a href="functions.html#cb260-9" aria-hidden="true"></a>  <span class="kw">return</span>(fl_out)</span>
<span id="cb260-10"><a href="functions.html#cb260-10" aria-hidden="true"></a>}</span>
<span id="cb260-11"><a href="functions.html#cb260-11" aria-hidden="true"></a></span>
<span id="cb260-12"><a href="functions.html#cb260-12" aria-hidden="true"></a><span class="co"># Evaluate function row by row of tibble</span></span>
<span id="cb260-13"><a href="functions.html#cb260-13" aria-hidden="true"></a><span class="co"># fl_A, fl_alpha are from columns of tb_nN_by_nQ_A_alpha</span></span>
<span id="cb260-14"><a href="functions.html#cb260-14" aria-hidden="true"></a>tb_nN_by_nQ_A_alpha_show &lt;-<span class="st"> </span>tb_nN_by_nQ_A_alpha <span class="op">%&gt;%</span></span>
<span id="cb260-15"><a href="functions.html#cb260-15" aria-hidden="true"></a><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></span>
<span id="cb260-16"><a href="functions.html#cb260-16" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dplyr_eval =</span></span>
<span id="cb260-17"><a href="functions.html#cb260-17" aria-hidden="true"></a>           <span class="kw">ffi_linear_dplyrdo</span>(fl_A, fl_alpha, ar_nN_A, ar_nN_alpha))</span></code></pre></div>
<pre><code>## [1] &quot;cur row, fl_A=-2, fl_alpha=0.1&quot;
## [1] &quot;cur row, fl_A=-1, fl_alpha=0.3&quot;
## [1] &quot;cur row, fl_A=0, fl_alpha=0.5&quot;
## [1] &quot;cur row, fl_A=1, fl_alpha=0.7&quot;
## [1] &quot;cur row, fl_A=2, fl_alpha=0.9&quot;</code></pre>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="functions.html#cb262-1" aria-hidden="true"></a><span class="co"># Show</span></span>
<span id="cb262-2"><a href="functions.html#cb262-2" aria-hidden="true"></a><span class="kw">kable</span>(tb_nN_by_nQ_A_alpha_show) <span class="op">%&gt;%</span></span>
<span id="cb262-3"><a href="functions.html#cb262-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_A
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_alpha
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dplyr_eval
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-2
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
2.346356
</td>
</tr>
<tr>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
2.094273
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
1.895316
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
1.733708
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.9
</td>
<td style="text-align:right;">
1.599477
</td>
</tr>
</tbody>
</table>
<p>same as before, still rowwise, but hard code some inputs:</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="functions.html#cb263-1" aria-hidden="true"></a><span class="co"># Define function, fixed inputs are not parameters, but</span></span>
<span id="cb263-2"><a href="functions.html#cb263-2" aria-hidden="true"></a><span class="co"># defined earlier as a part of the function</span></span>
<span id="cb263-3"><a href="functions.html#cb263-3" aria-hidden="true"></a><span class="co"># ar_nN_A, ar_nN_alpha are fixed, not parameters</span></span>
<span id="cb263-4"><a href="functions.html#cb263-4" aria-hidden="true"></a>ffi_linear_dplyrdo_func &lt;-<span class="st"> </span><span class="cf">function</span>(fl_A, fl_alpha){</span>
<span id="cb263-5"><a href="functions.html#cb263-5" aria-hidden="true"></a>  fl_out &lt;-<span class="st"> </span><span class="kw">sum</span>(fl_A<span class="op">*</span>ar_nN_A <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span>(fl_alpha <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span>ar_nN_alpha))</span>
<span id="cb263-6"><a href="functions.html#cb263-6" aria-hidden="true"></a>  <span class="kw">return</span>(fl_out)</span>
<span id="cb263-7"><a href="functions.html#cb263-7" aria-hidden="true"></a>}</span>
<span id="cb263-8"><a href="functions.html#cb263-8" aria-hidden="true"></a></span>
<span id="cb263-9"><a href="functions.html#cb263-9" aria-hidden="true"></a><span class="co"># Evaluate function row by row of tibble</span></span>
<span id="cb263-10"><a href="functions.html#cb263-10" aria-hidden="true"></a>tbfunc_A_nN_by_nQ_A_alpha_rowwise =<span class="st"> </span>tb_nN_by_nQ_A_alpha <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></span>
<span id="cb263-11"><a href="functions.html#cb263-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dplyr_eval =</span> <span class="kw">ffi_linear_dplyrdo_func</span>(fl_A, fl_alpha))</span>
<span id="cb263-12"><a href="functions.html#cb263-12" aria-hidden="true"></a><span class="co"># Show</span></span>
<span id="cb263-13"><a href="functions.html#cb263-13" aria-hidden="true"></a><span class="kw">kable</span>(tbfunc_A_nN_by_nQ_A_alpha_rowwise) <span class="op">%&gt;%</span></span>
<span id="cb263-14"><a href="functions.html#cb263-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_A
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_alpha
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dplyr_eval
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-2
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
2.346356
</td>
</tr>
<tr>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
2.094273
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
1.895316
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
1.733708
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.9
</td>
<td style="text-align:right;">
1.599477
</td>
</tr>
</tbody>
</table>
</div>
<div id="mutate-with-pmap" class="section level4" number="3.3.2.3">
<h4><span class="header-section-number">3.3.2.3</span> mutate with pmap</h4>
<p>Apparantly <em>rowwise()</em> is not a good idea, and <em>pmap</em> should be used, below is the <em>pmap</em> solution to the problem. Which does seem nicer. Crucially, don’t have to define input parameter names, automatically I think they are matching up to the names in the function</p>
<ul>
<li>dplyr mutate pass function</li>
<li>r function quosure string multiple</li>
<li>r function multiple parameters as one string</li>
<li>dplyr mutate anonymous function</li>
<li>quosure style lambda</li>
<li>pmap tibble rows</li>
<li>dplyr pwalk</li>
</ul>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="functions.html#cb264-1" aria-hidden="true"></a><span class="co"># Define function, fixed inputs are not parameters, but defined</span></span>
<span id="cb264-2"><a href="functions.html#cb264-2" aria-hidden="true"></a><span class="co"># earlier as a part of the function Rorate fl_alpha and fl_A name</span></span>
<span id="cb264-3"><a href="functions.html#cb264-3" aria-hidden="true"></a><span class="co"># compared to before to make sure pmap tracks by names</span></span>
<span id="cb264-4"><a href="functions.html#cb264-4" aria-hidden="true"></a>ffi_linear_dplyrdo_func &lt;-<span class="st"> </span><span class="cf">function</span>(fl_alpha, fl_A){</span>
<span id="cb264-5"><a href="functions.html#cb264-5" aria-hidden="true"></a>  fl_out &lt;-<span class="st"> </span><span class="kw">sum</span>(fl_A<span class="op">*</span>ar_nN_A <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span>(fl_alpha <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span>ar_nN_alpha))</span>
<span id="cb264-6"><a href="functions.html#cb264-6" aria-hidden="true"></a>  <span class="kw">return</span>(fl_out)</span>
<span id="cb264-7"><a href="functions.html#cb264-7" aria-hidden="true"></a>}</span>
<span id="cb264-8"><a href="functions.html#cb264-8" aria-hidden="true"></a></span>
<span id="cb264-9"><a href="functions.html#cb264-9" aria-hidden="true"></a><span class="co"># Evaluate a function row by row of dataframe, generate list,</span></span>
<span id="cb264-10"><a href="functions.html#cb264-10" aria-hidden="true"></a><span class="co"># then to vector</span></span>
<span id="cb264-11"><a href="functions.html#cb264-11" aria-hidden="true"></a>tb_nN_by_nQ_A_alpha <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pmap</span>(ffi_linear_dplyrdo_func) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unlist</span>()</span></code></pre></div>
<pre><code>## [1] 2.346356 2.094273 1.895316 1.733708 1.599477</code></pre>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="functions.html#cb266-1" aria-hidden="true"></a><span class="co"># Same as above, but in line line and save output as new column</span></span>
<span id="cb266-2"><a href="functions.html#cb266-2" aria-hidden="true"></a><span class="co"># in dataframe note this ONLY works if the tibble only has variables</span></span>
<span id="cb266-3"><a href="functions.html#cb266-3" aria-hidden="true"></a><span class="co"># that are inputs for the function if tibble contains additional</span></span>
<span id="cb266-4"><a href="functions.html#cb266-4" aria-hidden="true"></a><span class="co">#  variables, those should be droppd, or only the ones needed selected,</span></span>
<span id="cb266-5"><a href="functions.html#cb266-5" aria-hidden="true"></a><span class="co"># inside the pmap call below.</span></span>
<span id="cb266-6"><a href="functions.html#cb266-6" aria-hidden="true"></a>tbfunc_A_nN_by_nQ_A_alpha_pmap &lt;-<span class="st"> </span>tb_nN_by_nQ_A_alpha <span class="op">%&gt;%</span></span>
<span id="cb266-7"><a href="functions.html#cb266-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dplyr_eval_pmap =</span></span>
<span id="cb266-8"><a href="functions.html#cb266-8" aria-hidden="true"></a>           <span class="kw">unlist</span>(</span>
<span id="cb266-9"><a href="functions.html#cb266-9" aria-hidden="true"></a>             <span class="kw">pmap</span>(tb_nN_by_nQ_A_alpha, ffi_linear_dplyrdo_func)</span>
<span id="cb266-10"><a href="functions.html#cb266-10" aria-hidden="true"></a>           )</span>
<span id="cb266-11"><a href="functions.html#cb266-11" aria-hidden="true"></a>  )</span>
<span id="cb266-12"><a href="functions.html#cb266-12" aria-hidden="true"></a></span>
<span id="cb266-13"><a href="functions.html#cb266-13" aria-hidden="true"></a><span class="co"># Show</span></span>
<span id="cb266-14"><a href="functions.html#cb266-14" aria-hidden="true"></a><span class="kw">kable</span>(tbfunc_A_nN_by_nQ_A_alpha_pmap) <span class="op">%&gt;%</span></span>
<span id="cb266-15"><a href="functions.html#cb266-15" aria-hidden="true"></a><span class="st">  </span><span class="kw">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_A
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_alpha
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dplyr_eval_pmap
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-2
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
2.346356
</td>
</tr>
<tr>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
2.094273
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
1.895316
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
1.733708
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.9
</td>
<td style="text-align:right;">
1.599477
</td>
</tr>
</tbody>
</table>
</div>
<div id="rowwise-and-do" class="section level4" number="3.3.2.4">
<h4><span class="header-section-number">3.3.2.4</span> rowwise and do</h4>
<p>Now, we have three types of parameters, for something like a bisection type calculation. We will supply the program with a function with some hard-coded value inside, and as parameters, we will have one parameter which is a row in the current matrix, and another parameter which is a sclar values. The three types of parameters are dealt with sparately:</p>
<ol style="list-style-type: decimal">
<li>parameters that are fixed for all bisection iterations, but differ for each row</li>
</ol>
<ul>
<li>these are hard-coded into the function</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>parameters that are fixed for all bisection iterations, but are shared across rows</li>
</ol>
<ul>
<li>these are the first parameter of the function, a list</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>parameters that differ for each iteration, but differ acoss iterations</li>
</ol>
<ul>
<li><p>second scalar value parameter for the function</p></li>
<li><p>dplyr mutate function applow to each row dot notation</p></li>
<li><p>note <a href="https://community.rstudio.com/t/dplyr-alternatives-to-rowwise/8071">rowwise might be bad</a> according to Hadley, should use pmap?</p></li>
</ul>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="functions.html#cb267-1" aria-hidden="true"></a>ffi_linear_dplyrdo_fdot &lt;-<span class="st"> </span><span class="cf">function</span>(ls_row, fl_param){</span>
<span id="cb267-2"><a href="functions.html#cb267-2" aria-hidden="true"></a>  <span class="co"># Type 1 Param = ar_nN_A, ar_nN_alpha</span></span>
<span id="cb267-3"><a href="functions.html#cb267-3" aria-hidden="true"></a>  <span class="co"># Type 2 Param = ls_row$fl_A, ls_row$fl_alpha</span></span>
<span id="cb267-4"><a href="functions.html#cb267-4" aria-hidden="true"></a>  <span class="co"># Type 3 Param = fl_param</span></span>
<span id="cb267-5"><a href="functions.html#cb267-5" aria-hidden="true"></a></span>
<span id="cb267-6"><a href="functions.html#cb267-6" aria-hidden="true"></a>  fl_out &lt;-<span class="st"> </span>(<span class="kw">sum</span>(ls_row<span class="op">$</span>fl_A<span class="op">*</span>ar_nN_A <span class="op">+</span></span>
<span id="cb267-7"><a href="functions.html#cb267-7" aria-hidden="true"></a><span class="st">                   </span><span class="dv">1</span><span class="op">/</span>(ls_row<span class="op">$</span>fl_alpha <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span>ar_nN_alpha))) <span class="op">+</span><span class="st"> </span>fl_param</span>
<span id="cb267-8"><a href="functions.html#cb267-8" aria-hidden="true"></a>  <span class="kw">return</span>(fl_out)</span>
<span id="cb267-9"><a href="functions.html#cb267-9" aria-hidden="true"></a>}</span>
<span id="cb267-10"><a href="functions.html#cb267-10" aria-hidden="true"></a></span>
<span id="cb267-11"><a href="functions.html#cb267-11" aria-hidden="true"></a>cur_func &lt;-<span class="st"> </span>ffi_linear_dplyrdo_fdot</span>
<span id="cb267-12"><a href="functions.html#cb267-12" aria-hidden="true"></a>fl_param &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb267-13"><a href="functions.html#cb267-13" aria-hidden="true"></a>dplyr_eval_flex &lt;-<span class="st"> </span>tb_nN_by_nQ_A_alpha <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></span>
<span id="cb267-14"><a href="functions.html#cb267-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">do</span>(<span class="dt">dplyr_eval_flex =</span> <span class="kw">cur_func</span>(., fl_param)) <span class="op">%&gt;%</span></span>
<span id="cb267-15"><a href="functions.html#cb267-15" aria-hidden="true"></a><span class="st">  </span><span class="kw">unnest</span>(dplyr_eval_flex)</span>
<span id="cb267-16"><a href="functions.html#cb267-16" aria-hidden="true"></a>tbfunc_B_nN_by_nQ_A_alpha &lt;-<span class="st"> </span>tb_nN_by_nQ_A_alpha <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">add_column</span>(dplyr_eval_flex)</span>
<span id="cb267-17"><a href="functions.html#cb267-17" aria-hidden="true"></a><span class="co"># Show</span></span>
<span id="cb267-18"><a href="functions.html#cb267-18" aria-hidden="true"></a><span class="kw">kable</span>(tbfunc_B_nN_by_nQ_A_alpha) <span class="op">%&gt;%</span></span>
<span id="cb267-19"><a href="functions.html#cb267-19" aria-hidden="true"></a><span class="st">  </span><span class="kw">kable_styling_fc</span>()</span></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_A
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
fl_alpha
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dplyr_eval_flex
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-2
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
2.346356
</td>
</tr>
<tr>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
2.094273
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
1.895316
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
1.733708
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.9
</td>
<td style="text-align:right;">
1.599477
</td>
</tr>
</tbody>
</table>
</div>
<div id="compare-apply-and-mutate-results" class="section level4" number="3.3.2.5">
<h4><span class="header-section-number">3.3.2.5</span> Compare Apply and Mutate Results</h4>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="functions.html#cb268-1" aria-hidden="true"></a><span class="co"># Show overall Results</span></span>
<span id="cb268-2"><a href="functions.html#cb268-2" aria-hidden="true"></a>mt_results &lt;-<span class="st"> </span><span class="kw">cbind</span>(tb_nN_by_nQ_A_alpha_show[<span class="st">&#39;dplyr_eval&#39;</span>],</span>
<span id="cb268-3"><a href="functions.html#cb268-3" aria-hidden="true"></a>                    tbfunc_A_nN_by_nQ_A_alpha_rowwise[<span class="st">&#39;dplyr_eval&#39;</span>],</span>
<span id="cb268-4"><a href="functions.html#cb268-4" aria-hidden="true"></a>                    tbfunc_A_nN_by_nQ_A_alpha_pmap[<span class="st">&#39;dplyr_eval_pmap&#39;</span>],</span>
<span id="cb268-5"><a href="functions.html#cb268-5" aria-hidden="true"></a>                    tbfunc_B_nN_by_nQ_A_alpha[<span class="st">&#39;dplyr_eval_flex&#39;</span>],</span>
<span id="cb268-6"><a href="functions.html#cb268-6" aria-hidden="true"></a>                    mt_nN_by_nQ_A_alpha)</span>
<span id="cb268-7"><a href="functions.html#cb268-7" aria-hidden="true"></a><span class="kw">colnames</span>(mt_results) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;eval_dplyr_mutate&#39;</span>,</span>
<span id="cb268-8"><a href="functions.html#cb268-8" aria-hidden="true"></a>                          <span class="st">&#39;eval_dplyr_mutate_hcode&#39;</span>,</span>
<span id="cb268-9"><a href="functions.html#cb268-9" aria-hidden="true"></a>                          <span class="st">&#39;eval_dplyr_mutate_pmap&#39;</span>,</span>
<span id="cb268-10"><a href="functions.html#cb268-10" aria-hidden="true"></a>                          <span class="st">&#39;eval_dplyr_mutate_flex&#39;</span>,</span>
<span id="cb268-11"><a href="functions.html#cb268-11" aria-hidden="true"></a>                          <span class="st">&#39;A_child&#39;</span>, <span class="st">&#39;alpha_child&#39;</span>)</span>
<span id="cb268-12"><a href="functions.html#cb268-12" aria-hidden="true"></a><span class="kw">kable</span>(mt_results) <span class="op">%&gt;%</span></span>
<span id="cb268-13"><a href="functions.html#cb268-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">kable_styling_fc_wide</span>()</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:875px; ">
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
eval_dplyr_mutate
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
eval_dplyr_mutate_hcode
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
eval_dplyr_mutate_pmap
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
eval_dplyr_mutate_flex
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
A_child
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
alpha_child
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
2.346356
</td>
<td style="text-align:right;">
2.346356
</td>
<td style="text-align:right;">
2.346356
</td>
<td style="text-align:right;">
2.346356
</td>
<td style="text-align:right;">
-2
</td>
<td style="text-align:right;">
0.1
</td>
</tr>
<tr>
<td style="text-align:right;">
2.094273
</td>
<td style="text-align:right;">
2.094273
</td>
<td style="text-align:right;">
2.094273
</td>
<td style="text-align:right;">
2.094273
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0.3
</td>
</tr>
<tr>
<td style="text-align:right;">
1.895316
</td>
<td style="text-align:right;">
1.895316
</td>
<td style="text-align:right;">
1.895316
</td>
<td style="text-align:right;">
1.895316
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.5
</td>
</tr>
<tr>
<td style="text-align:right;">
1.733708
</td>
<td style="text-align:right;">
1.733708
</td>
<td style="text-align:right;">
1.733708
</td>
<td style="text-align:right;">
1.733708
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.7
</td>
</tr>
<tr>
<td style="text-align:right;">
1.599477
</td>
<td style="text-align:right;">
1.599477
</td>
<td style="text-align:right;">
1.599477
</td>
<td style="text-align:right;">
1.599477
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.9
</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="summarize-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="panel.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": [["Panel-Data-and-Optimization-with-R.pdf", "PDF"]],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
