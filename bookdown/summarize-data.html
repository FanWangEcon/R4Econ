<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Summarize Data | Panel Data and Optimization with R</title>
  <meta name="description" content="R Examples Panel and Optimization." />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Summarize Data | Panel Data and Optimization with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="R Examples Panel and Optimization." />
  <meta name="github-repo" content="fanwangecon/R4Econ" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Summarize Data | Panel Data and Optimization with R" />
  
  <meta name="twitter:description" content="R Examples Panel and Optimization." />
  

<meta name="author" content="Fan Wang" />


<meta name="date" content="2020-04-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="array-matrix-dataframe.html"/>
<link rel="next" href="functions.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-92953468-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-92953468-5');
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Panel Data and Optimization with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html"><i class="fa fa-check"></i><b>1</b> Array, Matrix, Dataframe</a><ul>
<li class="chapter" data-level="1.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#list"><i class="fa fa-check"></i><b>1.1</b> List</a><ul>
<li class="chapter" data-level="1.1.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#multiple-dimensional-list"><i class="fa fa-check"></i><b>1.1.1</b> Multiple Dimensional List</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#array"><i class="fa fa-check"></i><b>1.2</b> Array</a><ul>
<li class="chapter" data-level="1.2.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#array-basics"><i class="fa fa-check"></i><b>1.2.1</b> Array Basics</a></li>
<li class="chapter" data-level="1.2.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-arrays"><i class="fa fa-check"></i><b>1.2.2</b> Generate Arrays</a></li>
<li class="chapter" data-level="1.2.3" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#string-arrays"><i class="fa fa-check"></i><b>1.2.3</b> String Arrays</a></li>
<li class="chapter" data-level="1.2.4" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#mesh-matrix-and-vector"><i class="fa fa-check"></i><b>1.2.4</b> Mesh Matrix and Vector</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#matrix"><i class="fa fa-check"></i><b>1.3</b> Matrix</a><ul>
<li class="chapter" data-level="1.3.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-matrixes"><i class="fa fa-check"></i><b>1.3.1</b> Generate Matrixes</a></li>
<li class="chapter" data-level="1.3.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#linear-algebra"><i class="fa fa-check"></i><b>1.3.2</b> Linear Algebra</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#dataframes-tibble"><i class="fa fa-check"></i><b>1.4</b> Dataframes (Tibble)</a><ul>
<li class="chapter" data-level="1.4.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-dataframe"><i class="fa fa-check"></i><b>1.4.1</b> Generate Dataframe</a></li>
<li class="chapter" data-level="1.4.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#draw-random-rows"><i class="fa fa-check"></i><b>1.4.2</b> Draw Random Rows</a></li>
<li class="chapter" data-level="1.4.3" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#variable-na-values"><i class="fa fa-check"></i><b>1.4.3</b> Variable NA Values</a></li>
<li class="chapter" data-level="1.4.4" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#string-values"><i class="fa fa-check"></i><b>1.4.4</b> String Values</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="summarize-data.html"><a href="summarize-data.html"><i class="fa fa-check"></i><b>2</b> Summarize Data</a><ul>
<li class="chapter" data-level="2.1" data-path="summarize-data.html"><a href="summarize-data.html#counting-observation"><i class="fa fa-check"></i><b>2.1</b> Counting Observation</a><ul>
<li class="chapter" data-level="2.1.1" data-path="summarize-data.html"><a href="summarize-data.html#uncount"><i class="fa fa-check"></i><b>2.1.1</b> Uncount</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="summarize-data.html"><a href="summarize-data.html#sorting-indexing-slicing"><i class="fa fa-check"></i><b>2.2</b> Sorting, Indexing, Slicing</a><ul>
<li class="chapter" data-level="2.2.1" data-path="summarize-data.html"><a href="summarize-data.html#sorting"><i class="fa fa-check"></i><b>2.2.1</b> Sorting</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="summarize-data.html"><a href="summarize-data.html#group-statistics"><i class="fa fa-check"></i><b>2.3</b> Group Statistics</a><ul>
<li class="chapter" data-level="2.3.1" data-path="summarize-data.html"><a href="summarize-data.html#groups-statistics"><i class="fa fa-check"></i><b>2.3.1</b> Groups Statistics</a></li>
<li class="chapter" data-level="2.3.2" data-path="summarize-data.html"><a href="summarize-data.html#one-variable-group-summary"><i class="fa fa-check"></i><b>2.3.2</b> One Variable Group Summary</a></li>
<li class="chapter" data-level="2.3.3" data-path="summarize-data.html"><a href="summarize-data.html#nested-within-group-stats"><i class="fa fa-check"></i><b>2.3.3</b> Nested within Group Stats</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="summarize-data.html"><a href="summarize-data.html#distributional-statistics"><i class="fa fa-check"></i><b>2.4</b> Distributional Statistics</a><ul>
<li class="chapter" data-level="2.4.1" data-path="summarize-data.html"><a href="summarize-data.html#histogram"><i class="fa fa-check"></i><b>2.4.1</b> Histogram</a></li>
<li class="chapter" data-level="2.4.2" data-path="summarize-data.html"><a href="summarize-data.html#joint-quantiles-from-continuous"><i class="fa fa-check"></i><b>2.4.2</b> Joint Quantiles from Continuous</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="summarize-data.html"><a href="summarize-data.html#summarize-multiple-variables"><i class="fa fa-check"></i><b>2.5</b> Summarize Multiple Variables</a><ul>
<li class="chapter" data-level="2.5.1" data-path="summarize-data.html"><a href="summarize-data.html#generate-replace-variables"><i class="fa fa-check"></i><b>2.5.1</b> Generate Replace Variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>3</b> Functions</a><ul>
<li class="chapter" data-level="3.1" data-path="functions.html"><a href="functions.html#dataframe-mutate"><i class="fa fa-check"></i><b>3.1</b> Dataframe Mutate</a><ul>
<li class="chapter" data-level="3.1.1" data-path="functions.html"><a href="functions.html#row-input-functions"><i class="fa fa-check"></i><b>3.1.1</b> Row Input Functions</a></li>
<li class="chapter" data-level="3.1.2" data-path="functions.html"><a href="functions.html#evaluate-choices-across-states"><i class="fa fa-check"></i><b>3.1.2</b> Evaluate Choices Across States</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="functions.html"><a href="functions.html#dataframe-do-anything"><i class="fa fa-check"></i><b>3.2</b> Dataframe Do Anything</a><ul>
<li class="chapter" data-level="3.2.1" data-path="functions.html"><a href="functions.html#mxq-to-mxp-rows"><i class="fa fa-check"></i><b>3.2.1</b> MxQ to MxP Rows</a></li>
<li class="chapter" data-level="3.2.2" data-path="functions.html"><a href="functions.html#mx1-to-mxq-rows"><i class="fa fa-check"></i><b>3.2.2</b> Mx1 to MxQ Rows</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="functions.html"><a href="functions.html#apply-and-pmap"><i class="fa fa-check"></i><b>3.3</b> Apply and pmap</a><ul>
<li class="chapter" data-level="3.3.1" data-path="functions.html"><a href="functions.html#apply-sapply-mutate"><i class="fa fa-check"></i><b>3.3.1</b> Apply, Sapply, Mutate</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="panel.html"><a href="panel.html"><i class="fa fa-check"></i><b>4</b> Panel</a><ul>
<li class="chapter" data-level="4.1" data-path="panel.html"><a href="panel.html#generate-and-join"><i class="fa fa-check"></i><b>4.1</b> Generate and Join</a><ul>
<li class="chapter" data-level="4.1.1" data-path="panel.html"><a href="panel.html#generate-panel-structure"><i class="fa fa-check"></i><b>4.1.1</b> Generate Panel Structure</a></li>
<li class="chapter" data-level="4.1.2" data-path="panel.html"><a href="panel.html#join-datasets"><i class="fa fa-check"></i><b>4.1.2</b> Join Datasets</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="panel.html"><a href="panel.html#wide-and-long"><i class="fa fa-check"></i><b>4.2</b> Wide and Long</a><ul>
<li class="chapter" data-level="4.2.1" data-path="panel.html"><a href="panel.html#long-to-wide"><i class="fa fa-check"></i><b>4.2.1</b> Long to Wide</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i><b>5</b> Linear Regression</a><ul>
<li class="chapter" data-level="5.1" data-path="linear-regression.html"><a href="linear-regression.html#ols-and-iv"><i class="fa fa-check"></i><b>5.1</b> OLS and IV</a><ul>
<li class="chapter" data-level="5.1.1" data-path="linear-regression.html"><a href="linear-regression.html#ols-and-iv-regression"><i class="fa fa-check"></i><b>5.1.1</b> OLS and IV Regression</a></li>
<li class="chapter" data-level="5.1.2" data-path="linear-regression.html"><a href="linear-regression.html#iv-loop-over-rhs"><i class="fa fa-check"></i><b>5.1.2</b> IV Loop over RHS</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="linear-regression.html"><a href="linear-regression.html#decomposition"><i class="fa fa-check"></i><b>5.2</b> Decomposition</a><ul>
<li class="chapter" data-level="5.2.1" data-path="linear-regression.html"><a href="linear-regression.html#decompose-rhs"><i class="fa fa-check"></i><b>5.2.1</b> Decompose RHS</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html"><i class="fa fa-check"></i><b>6</b> Nonlinear Regression</a><ul>
<li class="chapter" data-level="6.1" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html#logit-regression"><i class="fa fa-check"></i><b>6.1</b> Logit Regression</a><ul>
<li class="chapter" data-level="6.1.1" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html#binary-logit"><i class="fa fa-check"></i><b>6.1.1</b> Binary Logit</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="optimization.html"><a href="optimization.html"><i class="fa fa-check"></i><b>7</b> Optimization</a><ul>
<li class="chapter" data-level="7.1" data-path="optimization.html"><a href="optimization.html#bisection"><i class="fa fa-check"></i><b>7.1</b> Bisection</a><ul>
<li class="chapter" data-level="7.1.1" data-path="optimization.html"><a href="optimization.html#bisection-1"><i class="fa fa-check"></i><b>7.1.1</b> Bisection</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://fanwangecon.github.io/R4Econ/bookdown/index.html" target="blank">R4Econ Bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Panel Data and Optimization with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="summarize-data" class="section level1">
<h1><span class="header-section-number">Chapter 2</span> Summarize Data</h1>

<div id="counting-observation" class="section level2">
<h2><span class="header-section-number">2.1</span> Counting Observation</h2>

<div id="uncount" class="section level3">
<h3><span class="header-section-number">2.1.1</span> Uncount</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/CodeDynaAsset/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R4Econ</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository.</p>
</blockquote>
<p>In some panel, there are <span class="math inline">\(N\)</span> individuals, each observed for <span class="math inline">\(Y_i\)</span> years. Given a dataset with two variables, the individual index, and the <span class="math inline">\(Y_i\)</span> variable, expand the dataframe so that there is a row for each individual index’s each unique year in the survey.</p>
<p><em>Search</em>:</p>
<ul>
<li>r duplicate row by variable</li>
</ul>
<p><em>Links</em>:</p>
<ul>
<li>see: <a href="https://stackoverflow.com/questions/52498169/r-create-duplicate-rows-based-on-a-variable-dplyr-preferred">Create duplicate rows based on a variable</a></li>
</ul>
<p><em>Algorithm</em>:</p>
<ol style="list-style-type: decimal">
<li>generate testing frame, the individual attribute dataset with invariant information over panel</li>
<li>uncount, duplicate rows by years in survey</li>
<li>group and generate sorted index</li>
<li>add indiviual specific stat year to index</li>
</ol>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" title="1"><span class="co"># 1. Array of Years in the Survey</span></a>
<a class="sourceLine" id="cb131-2" title="2">ar_years_in_survey &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">2</span>,<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb131-3" title="3">ar_start_yaer &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb131-4" title="4">ar_end_year &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">10</span>,<span class="dv">2</span>,<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb131-5" title="5">mt_combine &lt;-<span class="st"> </span><span class="kw">cbind</span>(ar_years_in_survey, ar_start_yaer, ar_end_year)</a>
<a class="sourceLine" id="cb131-6" title="6"></a>
<a class="sourceLine" id="cb131-7" title="7"><span class="co"># This is the individual attribute dataset, attributes that are invariant acrosss years</span></a>
<a class="sourceLine" id="cb131-8" title="8">tb_indi_attributes &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(mt_combine) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rowid_to_column</span>(<span class="dt">var =</span> <span class="st">&quot;ID&quot;</span>)</a>
<a class="sourceLine" id="cb131-9" title="9"></a>
<a class="sourceLine" id="cb131-10" title="10"><span class="co"># 2. Sort and generate variable equal to sorted index</span></a>
<a class="sourceLine" id="cb131-11" title="11">tb_indi_panel &lt;-<span class="st"> </span>tb_indi_attributes <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">uncount</span>(ar_years_in_survey)</a>
<a class="sourceLine" id="cb131-12" title="12"></a>
<a class="sourceLine" id="cb131-13" title="13"><span class="co"># 3. Panel now construct exactly which year in survey, note that all needed is sort index</span></a>
<a class="sourceLine" id="cb131-14" title="14"><span class="co"># Note sorting not needed, all rows identical now</span></a>
<a class="sourceLine" id="cb131-15" title="15">tb_indi_panel &lt;-<span class="st"> </span>tb_indi_panel <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb131-16" title="16"><span class="st">                    </span><span class="kw">group_by</span>(ID) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb131-17" title="17"><span class="st">                    </span><span class="kw">mutate</span>(<span class="dt">yr_in_survey =</span> <span class="kw">row_number</span>())</a>
<a class="sourceLine" id="cb131-18" title="18"></a>
<a class="sourceLine" id="cb131-19" title="19">tb_indi_panel &lt;-<span class="st"> </span>tb_indi_panel <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb131-20" title="20"><span class="st">                    </span><span class="kw">mutate</span>(<span class="dt">calendar_year =</span> yr_in_survey <span class="op">+</span><span class="st"> </span>ar_start_yaer <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb131-21" title="21"></a>
<a class="sourceLine" id="cb131-22" title="22"><span class="co"># Show results Head 10</span></a>
<a class="sourceLine" id="cb131-23" title="23">tb_indi_panel <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb131-24" title="24"><span class="st">  </span><span class="kw">kable</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb131-25" title="25"><span class="st">  </span><span class="kw">kable_styling_fc</span>()</a></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ID
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ar_start_yaer
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
ar_end_year
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
yr_in_survey
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
calendar_year
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
4
</td>
</tr>
</tbody>
</table>

</div>
</div>
<div id="sorting-indexing-slicing" class="section level2">
<h2><span class="header-section-number">2.2</span> Sorting, Indexing, Slicing</h2>

<div id="sorting" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Sorting</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/CodeDynaAsset/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R4Econ</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository.</p>
</blockquote>
<div id="generate-sorted-index-within-group-with-repeating-values" class="section level4">
<h4><span class="header-section-number">2.2.1.1</span> Generate Sorted Index within Group with Repeating Values</h4>
<p>There is a variable, sort by this variable, then generate index from 1 to N representing sorted values of this index. If there are repeating values, still assign index, different index each value.</p>
<ul>
<li>r generate index sort</li>
<li>dplyr mutate equals index</li>
</ul>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb132-1" title="1"><span class="co"># Sort and generate variable equal to sorted index</span></a>
<a class="sourceLine" id="cb132-2" title="2">df_iris &lt;-<span class="st"> </span>iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(Sepal.Length) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb132-3" title="3"><span class="st">              </span><span class="kw">mutate</span>(<span class="dt">Sepal.Len.Index =</span> <span class="kw">row_number</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb132-4" title="4"><span class="st">              </span><span class="kw">select</span>(Sepal.Length, Sepal.Len.Index, <span class="kw">everything</span>())</a>
<a class="sourceLine" id="cb132-5" title="5"></a>
<a class="sourceLine" id="cb132-6" title="6"><span class="co"># Show results Head 10</span></a>
<a class="sourceLine" id="cb132-7" title="7">df_iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb132-8" title="8"><span class="st">  </span><span class="kw">kable</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb132-9" title="9"><span class="st">  </span><span class="kw">kable_styling_fc_wide</span>()</a></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:875px; ">
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sepal.Length
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sepal.Len.Index
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sepal.Width
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Petal.Length
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Petal.Width
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Species
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
4.3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3.0
</td>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;">
setosa
</td>
</tr>
<tr>
<td style="text-align:right;">
4.4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2.9
</td>
<td style="text-align:right;">
1.4
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
setosa
</td>
</tr>
<tr>
<td style="text-align:right;">
4.4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3.0
</td>
<td style="text-align:right;">
1.3
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
setosa
</td>
</tr>
<tr>
<td style="text-align:right;">
4.4
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3.2
</td>
<td style="text-align:right;">
1.3
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
setosa
</td>
</tr>
<tr>
<td style="text-align:right;">
4.5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2.3
</td>
<td style="text-align:right;">
1.3
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:left;">
setosa
</td>
</tr>
<tr>
<td style="text-align:right;">
4.6
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
3.1
</td>
<td style="text-align:right;">
1.5
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
setosa
</td>
</tr>
<tr>
<td style="text-align:right;">
4.6
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
3.4
</td>
<td style="text-align:right;">
1.4
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:left;">
setosa
</td>
</tr>
<tr>
<td style="text-align:right;">
4.6
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
3.6
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
setosa
</td>
</tr>
<tr>
<td style="text-align:right;">
4.6
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
3.2
</td>
<td style="text-align:right;">
1.4
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
setosa
</td>
</tr>
<tr>
<td style="text-align:right;">
4.7
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
3.2
</td>
<td style="text-align:right;">
1.3
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
setosa
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="populate-value-from-lowest-index-to-all-other-rows" class="section level4">
<h4><span class="header-section-number">2.2.1.2</span> Populate Value from Lowest Index to All other Rows</h4>
<p>We would like to calculate for example the ratio of each individual’s highest to the the person with the lowest height in a dataset. We first need to generated sorted index from lowest to highest, and then populate the lowest height to all rows, and then divide.</p>
<p><em>Search Terms</em>:</p>
<ul>
<li>r spread value to all rows from one row</li>
<li>r other rows equal to the value of one row</li>
<li>Conditional assignment of one variable to the value of one of two other variables</li>
<li>dplyr mutate conditional</li>
<li>dplyr value from one row to all rows</li>
<li>dplyr mutate equal to value in another cell</li>
</ul>
<p><em>Links</em>:</p>
<ul>
<li>see: dplyr <a href="https://dplyr.tidyverse.org/reference/ranking.html">rank</a></li>
<li>see: dplyr <a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></li>
</ul>
<div id="short-method-mutate-and-min" class="section level5">
<h5><span class="header-section-number">2.2.1.2.1</span> Short Method: mutate and min</h5>
<p>We just want the lowest value to be in its own column, so that we can compute various statistics using the lowest value variable and the original variable.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" title="1"><span class="co"># 1. Sort</span></a>
<a class="sourceLine" id="cb133-2" title="2">df_iris_m1 &lt;-<span class="st"> </span>iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Sepal.Len.Lowest.all =</span> <span class="kw">min</span>(Sepal.Length)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb133-3" title="3"><span class="st">                </span><span class="kw">select</span>(Sepal.Length, Sepal.Len.Lowest.all, <span class="kw">everything</span>())</a>
<a class="sourceLine" id="cb133-4" title="4"></a>
<a class="sourceLine" id="cb133-5" title="5"></a>
<a class="sourceLine" id="cb133-6" title="6"><span class="co"># Show results Head 10</span></a>
<a class="sourceLine" id="cb133-7" title="7">df_iris_m1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb133-8" title="8"><span class="st">  </span><span class="kw">kable</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb133-9" title="9"><span class="st">  </span><span class="kw">kable_styling_fc_wide</span>()</a></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:875px; ">
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sepal.Length
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sepal.Len.Lowest.all
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sepal.Width
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Petal.Length
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Petal.Width
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Species
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
4.3
</td>
<td style="text-align:right;">
3.5
</td>
<td style="text-align:right;">
1.4
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
setosa
</td>
</tr>
<tr>
<td style="text-align:right;">
4.9
</td>
<td style="text-align:right;">
4.3
</td>
<td style="text-align:right;">
3.0
</td>
<td style="text-align:right;">
1.4
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
setosa
</td>
</tr>
<tr>
<td style="text-align:right;">
4.7
</td>
<td style="text-align:right;">
4.3
</td>
<td style="text-align:right;">
3.2
</td>
<td style="text-align:right;">
1.3
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
setosa
</td>
</tr>
<tr>
<td style="text-align:right;">
4.6
</td>
<td style="text-align:right;">
4.3
</td>
<td style="text-align:right;">
3.1
</td>
<td style="text-align:right;">
1.5
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
setosa
</td>
</tr>
<tr>
<td style="text-align:right;">
5.0
</td>
<td style="text-align:right;">
4.3
</td>
<td style="text-align:right;">
3.6
</td>
<td style="text-align:right;">
1.4
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
setosa
</td>
</tr>
<tr>
<td style="text-align:right;">
5.4
</td>
<td style="text-align:right;">
4.3
</td>
<td style="text-align:right;">
3.9
</td>
<td style="text-align:right;">
1.7
</td>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:left;">
setosa
</td>
</tr>
<tr>
<td style="text-align:right;">
4.6
</td>
<td style="text-align:right;">
4.3
</td>
<td style="text-align:right;">
3.4
</td>
<td style="text-align:right;">
1.4
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:left;">
setosa
</td>
</tr>
<tr>
<td style="text-align:right;">
5.0
</td>
<td style="text-align:right;">
4.3
</td>
<td style="text-align:right;">
3.4
</td>
<td style="text-align:right;">
1.5
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
setosa
</td>
</tr>
<tr>
<td style="text-align:right;">
4.4
</td>
<td style="text-align:right;">
4.3
</td>
<td style="text-align:right;">
2.9
</td>
<td style="text-align:right;">
1.4
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
setosa
</td>
</tr>
<tr>
<td style="text-align:right;">
4.9
</td>
<td style="text-align:right;">
4.3
</td>
<td style="text-align:right;">
3.1
</td>
<td style="text-align:right;">
1.5
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;">
setosa
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="long-method-row_number-and-case_when" class="section level5">
<h5><span class="header-section-number">2.2.1.2.2</span> Long Method: row_number and case_when</h5>
<p>This is the long method, using row_number, and case_when. The benefit of this method is that it generates several intermediate variables that might be useful. And the key final step is to set a new variable (A=<em>Sepal.Len.Lowest.all</em>) equal to another variable’s (B=<em>Sepal.Length</em>’s) value at the index that satisfies condition based a third variable (C=<em>Sepal.Len.Index</em>).</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" title="1"><span class="co"># 1. Sort</span></a>
<a class="sourceLine" id="cb134-2" title="2"><span class="co"># 2. generate index</span></a>
<a class="sourceLine" id="cb134-3" title="3"><span class="co"># 3. value at lowest index (case_when)</span></a>
<a class="sourceLine" id="cb134-4" title="4"><span class="co"># 4. spread value from lowest index to other rows</span></a>
<a class="sourceLine" id="cb134-5" title="5"><span class="co"># Note step 4 does not require step 3</span></a>
<a class="sourceLine" id="cb134-6" title="6">df_iris_m2 &lt;-<span class="st"> </span>iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(Sepal.Length) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb134-7" title="7"><span class="st">              </span><span class="kw">mutate</span>(<span class="dt">Sepal.Len.Index =</span> <span class="kw">row_number</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb134-8" title="8"><span class="st">              </span><span class="kw">mutate</span>(<span class="dt">Sepal.Len.Lowest.one =</span></a>
<a class="sourceLine" id="cb134-9" title="9">                       <span class="kw">case_when</span>(<span class="kw">row_number</span>()<span class="op">==</span><span class="dv">1</span> <span class="op">~</span><span class="st"> </span>Sepal.Length)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb134-10" title="10"><span class="st">              </span><span class="kw">mutate</span>(<span class="dt">Sepal.Len.Lowest.all =</span></a>
<a class="sourceLine" id="cb134-11" title="11">                       Sepal.Length[Sepal.Len.Index<span class="op">==</span><span class="dv">1</span>]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb134-12" title="12"><span class="st">              </span><span class="kw">select</span>(Sepal.Length, Sepal.Len.Index,</a>
<a class="sourceLine" id="cb134-13" title="13">                     Sepal.Len.Lowest.one, Sepal.Len.Lowest.all)</a>
<a class="sourceLine" id="cb134-14" title="14"></a>
<a class="sourceLine" id="cb134-15" title="15"></a>
<a class="sourceLine" id="cb134-16" title="16"><span class="co"># Show results Head 10</span></a>
<a class="sourceLine" id="cb134-17" title="17">df_iris_m2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb134-18" title="18"><span class="st">  </span><span class="kw">kable</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb134-19" title="19"><span class="st">  </span><span class="kw">kable_styling_fc_wide</span>()</a></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:875px; ">
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sepal.Length
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sepal.Len.Index
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sepal.Len.Lowest.one
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sepal.Len.Lowest.all
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
4.3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4.3
</td>
<td style="text-align:right;">
4.3
</td>
</tr>
<tr>
<td style="text-align:right;">
4.4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
4.3
</td>
</tr>
<tr>
<td style="text-align:right;">
4.4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
4.3
</td>
</tr>
<tr>
<td style="text-align:right;">
4.4
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
4.3
</td>
</tr>
<tr>
<td style="text-align:right;">
4.5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
4.3
</td>
</tr>
<tr>
<td style="text-align:right;">
4.6
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
4.3
</td>
</tr>
<tr>
<td style="text-align:right;">
4.6
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
4.3
</td>
</tr>
<tr>
<td style="text-align:right;">
4.6
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
4.3
</td>
</tr>
<tr>
<td style="text-align:right;">
4.6
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
4.3
</td>
</tr>
<tr>
<td style="text-align:right;">
4.7
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
4.3
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="generate-sorted-index-based-on-deviations" class="section level4">
<h4><span class="header-section-number">2.2.1.3</span> Generate Sorted Index based on Deviations</h4>
<p>Generate Positive and Negative Index based on Ordered Deviation from some Number.</p>
<p>There is a variable that is continuous, substract a number from this variable, and generate index based on deviations. Think of the index as generating intervals indicating where the value lies. 0th index indicates the largest value in sequence that is smaller than or equal to number <span class="math inline">\(x\)</span>, 1st index indicates the smallest value in sequence that is larger than number <span class="math inline">\(x\)</span>.</p>
<p>The solution below is a little bit convoluated and long, there is likely a much quicker way. The process below shows various intermediary outputs that help arrive at deviation index <em>Sepal.Len.Devi.Index</em> from initial sorted index <em>Sepal.Len.Index</em>.</p>
<p><em>search</em>:</p>
<ul>
<li>dplyr arrange ignore na</li>
<li>dplyr index deviation from order number sequence</li>
<li>dplyr index below above</li>
<li>dplyr index order below above value</li>
</ul>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" title="1"><span class="co"># 1. Sort and generate variable equal to sorted index</span></a>
<a class="sourceLine" id="cb135-2" title="2"><span class="co"># 2. Plus or minus deviations from some value</span></a>
<a class="sourceLine" id="cb135-3" title="3"><span class="co"># 3. Find the zero, which means, the number closests to zero including zero from the negative side</span></a>
<a class="sourceLine" id="cb135-4" title="4"><span class="co"># 4. Find the index at the highest zero and below deviation point</span></a>
<a class="sourceLine" id="cb135-5" title="5"><span class="co"># 5. Difference of zero index and original sorted index</span></a>
<a class="sourceLine" id="cb135-6" title="6">sc_val_x &lt;-<span class="st"> </span><span class="fl">4.65</span></a>
<a class="sourceLine" id="cb135-7" title="7">df_iris_deviate &lt;-<span class="st"> </span>iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(Sepal.Length) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-8" title="8"><span class="st">              </span><span class="kw">mutate</span>(<span class="dt">Sepal.Len.Index =</span> <span class="kw">row_number</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-9" title="9"><span class="st">              </span><span class="kw">mutate</span>(<span class="dt">Sepal.Len.Devi =</span> (Sepal.Length <span class="op">-</span><span class="st"> </span>sc_val_x)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-10" title="10"><span class="st">              </span><span class="kw">mutate</span>(<span class="dt">Sepal.Len.Devi.Neg =</span></a>
<a class="sourceLine" id="cb135-11" title="11">                       <span class="kw">case_when</span>(Sepal.Len.Devi <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span> <span class="op">~</span><span class="st"> </span>(<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span>(Sepal.Len.Devi))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-12" title="12"><span class="st">              </span><span class="kw">arrange</span>((Sepal.Len.Devi.Neg), <span class="kw">desc</span>(Sepal.Len.Index)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-13" title="13"><span class="st">              </span><span class="kw">mutate</span>(<span class="dt">Sepal.Len.Index.Zero =</span></a>
<a class="sourceLine" id="cb135-14" title="14">                       <span class="kw">case_when</span>(<span class="kw">row_number</span>() <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span><span class="st"> </span>Sepal.Len.Index)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-15" title="15"><span class="st">              </span><span class="kw">mutate</span>(<span class="dt">Sepal.Len.Devi.Index =</span></a>
<a class="sourceLine" id="cb135-16" title="16">                       Sepal.Len.Index <span class="op">-</span><span class="st"> </span>Sepal.Len.Index.Zero[<span class="kw">row_number</span>() <span class="op">==</span><span class="st"> </span><span class="dv">1</span>]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-17" title="17"><span class="st">              </span><span class="kw">arrange</span>(Sepal.Len.Index) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-18" title="18"><span class="st">              </span><span class="kw">select</span>(Sepal.Length, Sepal.Len.Index, Sepal.Len.Devi,</a>
<a class="sourceLine" id="cb135-19" title="19">                     Sepal.Len.Devi.Neg, Sepal.Len.Index.Zero, Sepal.Len.Devi.Index)</a>
<a class="sourceLine" id="cb135-20" title="20"></a>
<a class="sourceLine" id="cb135-21" title="21"></a>
<a class="sourceLine" id="cb135-22" title="22"><span class="co"># Show results Head 10</span></a>
<a class="sourceLine" id="cb135-23" title="23">df_iris_deviate <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">20</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-24" title="24"><span class="st">  </span><span class="kw">kable</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-25" title="25"><span class="st">  </span><span class="kw">kable_styling_fc_wide</span>()</a></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:875px; ">
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sepal.Length
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sepal.Len.Index
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sepal.Len.Devi
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sepal.Len.Devi.Neg
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sepal.Len.Index.Zero
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Sepal.Len.Devi.Index
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
4.3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-0.35
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
-8
</td>
</tr>
<tr>
<td style="text-align:right;">
4.4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-0.25
</td>
<td style="text-align:right;">
0.25
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
-7
</td>
</tr>
<tr>
<td style="text-align:right;">
4.4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
-0.25
</td>
<td style="text-align:right;">
0.25
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
-6
</td>
</tr>
<tr>
<td style="text-align:right;">
4.4
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
-0.25
</td>
<td style="text-align:right;">
0.25
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
-5
</td>
</tr>
<tr>
<td style="text-align:right;">
4.5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
-0.15
</td>
<td style="text-align:right;">
0.15
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
-4
</td>
</tr>
<tr>
<td style="text-align:right;">
4.6
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
-0.05
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
-3
</td>
</tr>
<tr>
<td style="text-align:right;">
4.6
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
-0.05
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
-2
</td>
</tr>
<tr>
<td style="text-align:right;">
4.6
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
-0.05
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
-1
</td>
</tr>
<tr>
<td style="text-align:right;">
4.6
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
-0.05
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
4.7
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
4.7
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
4.8
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
0.15
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
4.8
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
0.15
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
4.8
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
0.15
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
4.8
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
0.15
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:right;">
4.8
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
0.15
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:right;">
4.9
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
0.25
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:right;">
4.9
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
0.25
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:right;">
4.9
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
0.25
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:right;">
4.9
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
0.25
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
11
</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
</div>
<div id="group-statistics" class="section level2">
<h2><span class="header-section-number">2.3</span> Group Statistics</h2>

<div id="groups-statistics" class="section level3">
<h3><span class="header-section-number">2.3.1</span> Groups Statistics</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/CodeDynaAsset/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R4Econ</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository.</p>
</blockquote>
<div id="aggrgate-groups-only-unique-group-and-count" class="section level4">
<h4><span class="header-section-number">2.3.1.1</span> Aggrgate Groups only Unique Group and Count</h4>
<p>There are two variables that are numeric, we want to find all the unique groups of these two variables in a dataset and count how many times each unique group occurs</p>
<ul>
<li>r unique occurrence of numeric groups</li>
<li>How to add count of unique values by group to R data.frame</li>
</ul>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb136-1" title="1"><span class="co"># Numeric value combinations unique Groups</span></a>
<a class="sourceLine" id="cb136-2" title="2">vars.group &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;hgt0&#39;</span>, <span class="st">&#39;wgt0&#39;</span>)</a>
<a class="sourceLine" id="cb136-3" title="3"></a>
<a class="sourceLine" id="cb136-4" title="4"><span class="co"># dataset subsetting</span></a>
<a class="sourceLine" id="cb136-5" title="5">df_use &lt;-<span class="st"> </span>df_hgt_wgt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">!!!</span><span class="kw">syms</span>(<span class="kw">c</span>(vars.group))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb136-6" title="6"><span class="st">            </span><span class="kw">mutate</span>(<span class="dt">hgt0 =</span> <span class="kw">round</span>(hgt0<span class="op">/</span><span class="dv">5</span>)<span class="op">*</span><span class="dv">5</span>, <span class="dt">wgt0 =</span> <span class="kw">round</span>(wgt0<span class="op">/</span><span class="dv">2000</span>)<span class="op">*</span><span class="dv">2000</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb136-7" title="7"><span class="st">            </span><span class="kw">drop_na</span>()</a>
<a class="sourceLine" id="cb136-8" title="8"></a>
<a class="sourceLine" id="cb136-9" title="9"><span class="co"># Group, count and generate means for each numeric variables</span></a>
<a class="sourceLine" id="cb136-10" title="10"><span class="co"># mutate_at(vars.group, funs(as.factor(.))) %&gt;%</span></a>
<a class="sourceLine" id="cb136-11" title="11">df.group.count &lt;-<span class="st"> </span>df_use <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(<span class="op">!!!</span><span class="kw">syms</span>(vars.group)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb136-12" title="12"><span class="st">                    </span><span class="kw">arrange</span>(<span class="op">!!!</span><span class="kw">syms</span>(vars.group)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb136-13" title="13"><span class="st">                    </span><span class="kw">summarise</span>(<span class="dt">n_obs_group=</span><span class="kw">n</span>())</a>
<a class="sourceLine" id="cb136-14" title="14"></a>
<a class="sourceLine" id="cb136-15" title="15"><span class="co"># Show results Head 10</span></a>
<a class="sourceLine" id="cb136-16" title="16">df.group.count <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable_styling_fc</span>()</a></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
hgt0
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
wgt0
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
n_obs_group
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
2000
</td>
<td style="text-align:right;">
122
</td>
</tr>
<tr>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
2000
</td>
<td style="text-align:right;">
4586
</td>
</tr>
<tr>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
4000
</td>
<td style="text-align:right;">
470
</td>
</tr>
<tr>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
2000
</td>
<td style="text-align:right;">
9691
</td>
</tr>
<tr>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
4000
</td>
<td style="text-align:right;">
13106
</td>
</tr>
<tr>
<td style="text-align:right;">
55
</td>
<td style="text-align:right;">
2000
</td>
<td style="text-align:right;">
126
</td>
</tr>
<tr>
<td style="text-align:right;">
55
</td>
<td style="text-align:right;">
4000
</td>
<td style="text-align:right;">
1900
</td>
</tr>
<tr>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
6000
</td>
<td style="text-align:right;">
18
</td>
</tr>
</tbody>
</table>
</div>
<div id="aggrgate-groups-only-unique-group-show-up-with-means" class="section level4">
<h4><span class="header-section-number">2.3.1.2</span> Aggrgate Groups only Unique Group Show up With Means</h4>
<p>Several variables that are grouping identifiers. Several variables that are values which mean be unique for each group members. For example, a Panel of income for N households over T years with also household education information that is invariant over time. Want to generate a dataset where the unit of observation are households, rather than household years. Take average of all numeric variables that are household and year specific.</p>
<p>A complicating factor potentially is that the number of observations differ within group, for example, income might be observed for all years for some households but not for other households.</p>
<ul>
<li>r dplyr aggregate group average</li>
<li>Aggregating and analyzing data with dplyr</li>
<li>column can’t be modified because it is a grouping variable</li>
<li>see also: <a href="https://datacarpentry.org/dc_zurich/R-ecology/04-dplyr.html">Aggregating and analyzing data with dplyr</a></li>
</ul>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb137-1" title="1"><span class="co"># In the df_hgt_wgt from R4Econ, there is a country id, village id,</span></a>
<a class="sourceLine" id="cb137-2" title="2"><span class="co"># and individual id, and various other statistics</span></a>
<a class="sourceLine" id="cb137-3" title="3">vars.group &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;S.country&#39;</span>, <span class="st">&#39;vil.id&#39;</span>, <span class="st">&#39;indi.id&#39;</span>)</a>
<a class="sourceLine" id="cb137-4" title="4">vars.values &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;hgt&#39;</span>, <span class="st">&#39;momEdu&#39;</span>)</a>
<a class="sourceLine" id="cb137-5" title="5"></a>
<a class="sourceLine" id="cb137-6" title="6"><span class="co"># dataset subsetting</span></a>
<a class="sourceLine" id="cb137-7" title="7">df_use &lt;-<span class="st"> </span>df_hgt_wgt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">!!!</span><span class="kw">syms</span>(<span class="kw">c</span>(vars.group, vars.values)))</a>
<a class="sourceLine" id="cb137-8" title="8"></a>
<a class="sourceLine" id="cb137-9" title="9"><span class="co"># Group, count and generate means for each numeric variables</span></a>
<a class="sourceLine" id="cb137-10" title="10">df.group &lt;-<span class="st"> </span>df_use <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(<span class="op">!!!</span><span class="kw">syms</span>(vars.group)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb137-11" title="11"><span class="st">            </span><span class="kw">arrange</span>(<span class="op">!!!</span><span class="kw">syms</span>(vars.group)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb137-12" title="12"><span class="st">            </span><span class="kw">summarise_if</span>(is.numeric,</a>
<a class="sourceLine" id="cb137-13" title="13">                         <span class="kw">funs</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(., <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb137-14" title="14">                              <span class="dt">sd =</span> <span class="kw">sd</span>(., <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb137-15" title="15">                              <span class="dt">n =</span> <span class="kw">sum</span>(<span class="kw">is.na</span>(.)<span class="op">==</span><span class="dv">0</span>)))</a>
<a class="sourceLine" id="cb137-16" title="16"></a>
<a class="sourceLine" id="cb137-17" title="17"><span class="co"># Show results Head 10</span></a>
<a class="sourceLine" id="cb137-18" title="18">df.group <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb137-19" title="19"><span class="st">  </span><span class="kw">kable</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb137-20" title="20"><span class="st">  </span><span class="kw">kable_styling_fc_wide</span>()</a></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:875px; ">
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
S.country
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
vil.id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
indi.id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
hgt_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
momEdu_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
hgt_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
momEdu_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
hgt_n
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
momEdu_n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Cebu
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
61.80000
</td>
<td style="text-align:right;">
5.3
</td>
<td style="text-align:right;">
9.520504
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
Cebu
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
68.86154
</td>
<td style="text-align:right;">
7.1
</td>
<td style="text-align:right;">
9.058931
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
Cebu
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
80.45882
</td>
<td style="text-align:right;">
9.4
</td>
<td style="text-align:right;">
29.894231
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
Cebu
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
88.10000
</td>
<td style="text-align:right;">
13.9
</td>
<td style="text-align:right;">
35.533166
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
Cebu
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
97.70556
</td>
<td style="text-align:right;">
11.3
</td>
<td style="text-align:right;">
41.090366
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
Cebu
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
87.49444
</td>
<td style="text-align:right;">
7.3
</td>
<td style="text-align:right;">
35.586439
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
Cebu
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
90.79412
</td>
<td style="text-align:right;">
10.4
</td>
<td style="text-align:right;">
38.722385
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
Cebu
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
68.45385
</td>
<td style="text-align:right;">
13.5
</td>
<td style="text-align:right;">
10.011961
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
Cebu
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
86.21111
</td>
<td style="text-align:right;">
10.4
</td>
<td style="text-align:right;">
35.126057
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
Cebu
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
87.67222
</td>
<td style="text-align:right;">
10.5
</td>
<td style="text-align:right;">
36.508127
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
18
</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb138-1" title="1"><span class="co"># Show results Head 10</span></a>
<a class="sourceLine" id="cb138-2" title="2">df.group <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tail</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb138-3" title="3"><span class="st">  </span><span class="kw">kable</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb138-4" title="4"><span class="st">  </span><span class="kw">kable_styling_fc_wide</span>()</a></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:875px; ">
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
S.country
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
vil.id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
indi.id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
hgt_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
momEdu_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
hgt_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
momEdu_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
hgt_n
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
momEdu_n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Guatemala
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
2014
</td>
<td style="text-align:right;">
66.97000
</td>
<td style="text-align:right;">
NaN
</td>
<td style="text-align:right;">
8.967974
</td>
<td style="text-align:right;">
NaN
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Guatemala
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
2015
</td>
<td style="text-align:right;">
71.71818
</td>
<td style="text-align:right;">
NaN
</td>
<td style="text-align:right;">
11.399984
</td>
<td style="text-align:right;">
NaN
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Guatemala
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
2016
</td>
<td style="text-align:right;">
66.33000
</td>
<td style="text-align:right;">
NaN
</td>
<td style="text-align:right;">
9.490352
</td>
<td style="text-align:right;">
NaN
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Guatemala
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
76.40769
</td>
<td style="text-align:right;">
NaN
</td>
<td style="text-align:right;">
14.827871
</td>
<td style="text-align:right;">
NaN
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Guatemala
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:right;">
74.55385
</td>
<td style="text-align:right;">
NaN
</td>
<td style="text-align:right;">
12.707846
</td>
<td style="text-align:right;">
NaN
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Guatemala
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:right;">
70.47500
</td>
<td style="text-align:right;">
NaN
</td>
<td style="text-align:right;">
11.797390
</td>
<td style="text-align:right;">
NaN
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Guatemala
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:right;">
60.28750
</td>
<td style="text-align:right;">
NaN
</td>
<td style="text-align:right;">
7.060036
</td>
<td style="text-align:right;">
NaN
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Guatemala
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
2021
</td>
<td style="text-align:right;">
84.96000
</td>
<td style="text-align:right;">
NaN
</td>
<td style="text-align:right;">
15.446193
</td>
<td style="text-align:right;">
NaN
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Guatemala
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
2022
</td>
<td style="text-align:right;">
79.38667
</td>
<td style="text-align:right;">
NaN
</td>
<td style="text-align:right;">
15.824749
</td>
<td style="text-align:right;">
NaN
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Guatemala
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
2023
</td>
<td style="text-align:right;">
66.50000
</td>
<td style="text-align:right;">
NaN
</td>
<td style="text-align:right;">
8.613113
</td>
<td style="text-align:right;">
NaN
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<div id="one-variable-group-summary" class="section level3">
<h3><span class="header-section-number">2.3.2</span> One Variable Group Summary</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/CodeDynaAsset/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R4Econ</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository.</p>
</blockquote>
<p>There is a categorical variable (based on one or the interaction of multiple variables), there is a continuous variable, obtain statistics for the continuous variable conditional on the categorical variable, but also unconditionally.</p>
<p>Store results in a matrix, but also flatten results wide to row with appropriate keys/variable-names for all group statistics.</p>
<p>Pick which statistics to be included in final wide row</p>
<div id="build-program" class="section level4">
<h4><span class="header-section-number">2.3.2.1</span> Build Program</h4>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb139-1" title="1"><span class="co"># Single Variable Group Statistics (also generate overall statistics)</span></a>
<a class="sourceLine" id="cb139-2" title="2">ff_summ_by_group_summ_one &lt;-<span class="st"> </span><span class="cf">function</span>(</a>
<a class="sourceLine" id="cb139-3" title="3">  df, vars.group, var.numeric, <span class="dt">str.stats.group =</span> <span class="st">&#39;main&#39;</span>,</a>
<a class="sourceLine" id="cb139-4" title="4">  <span class="dt">str.stats.specify =</span> <span class="ot">NULL</span>, <span class="dt">boo.overall.stats =</span> <span class="ot">TRUE</span>){</a>
<a class="sourceLine" id="cb139-5" title="5"></a>
<a class="sourceLine" id="cb139-6" title="6">    <span class="co"># List of statistics</span></a>
<a class="sourceLine" id="cb139-7" title="7">    <span class="co"># https://rdrr.io/cran/dplyr/man/summarise.html</span></a>
<a class="sourceLine" id="cb139-8" title="8">    strs.center &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;mean&#39;</span>, <span class="st">&#39;median&#39;</span>)</a>
<a class="sourceLine" id="cb139-9" title="9">    strs.spread &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;sd&#39;</span>, <span class="st">&#39;IQR&#39;</span>, <span class="st">&#39;mad&#39;</span>)</a>
<a class="sourceLine" id="cb139-10" title="10">    strs.range &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;min&#39;</span>, <span class="st">&#39;max&#39;</span>)</a>
<a class="sourceLine" id="cb139-11" title="11">    strs.pos &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;first&#39;</span>, <span class="st">&#39;last&#39;</span>)</a>
<a class="sourceLine" id="cb139-12" title="12">    strs.count &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;n_distinct&#39;</span>)</a>
<a class="sourceLine" id="cb139-13" title="13"></a>
<a class="sourceLine" id="cb139-14" title="14">    <span class="co"># Grouping of Statistics</span></a>
<a class="sourceLine" id="cb139-15" title="15">    <span class="cf">if</span> (<span class="kw">missing</span>(str.stats.specify)) {</a>
<a class="sourceLine" id="cb139-16" title="16">        <span class="cf">if</span> (str.stats.group <span class="op">==</span><span class="st"> &#39;main&#39;</span>) {</a>
<a class="sourceLine" id="cb139-17" title="17">            strs.all &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;mean&#39;</span>, <span class="st">&#39;min&#39;</span>, <span class="st">&#39;max&#39;</span>, <span class="st">&#39;sd&#39;</span>)</a>
<a class="sourceLine" id="cb139-18" title="18">        }</a>
<a class="sourceLine" id="cb139-19" title="19">        <span class="cf">if</span> (str.stats.group <span class="op">==</span><span class="st"> &#39;all&#39;</span>) {</a>
<a class="sourceLine" id="cb139-20" title="20">            strs.all &lt;-<span class="st"> </span><span class="kw">c</span>(strs.center, strs.spread, strs.range, strs.pos, strs.count)</a>
<a class="sourceLine" id="cb139-21" title="21">        }</a>
<a class="sourceLine" id="cb139-22" title="22">    } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb139-23" title="23">        strs.all &lt;-<span class="st"> </span>str.stats.specify</a>
<a class="sourceLine" id="cb139-24" title="24">    }</a>
<a class="sourceLine" id="cb139-25" title="25"></a>
<a class="sourceLine" id="cb139-26" title="26">    <span class="co"># Start Transform</span></a>
<a class="sourceLine" id="cb139-27" title="27">    df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">drop_na</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="op">!!</span>(var.numeric) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">as.numeric</span>(<span class="op">!!</span><span class="kw">sym</span>(var.numeric)))</a>
<a class="sourceLine" id="cb139-28" title="28"></a>
<a class="sourceLine" id="cb139-29" title="29">    <span class="co"># Overall Statistics</span></a>
<a class="sourceLine" id="cb139-30" title="30">    <span class="cf">if</span> (boo.overall.stats) {</a>
<a class="sourceLine" id="cb139-31" title="31">        df.overall.stats &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize_at</span>(<span class="kw">vars</span>(var.numeric), <span class="kw">funs</span>(<span class="op">!!!</span>strs.all))</a>
<a class="sourceLine" id="cb139-32" title="32">        <span class="cf">if</span> (<span class="kw">length</span>(strs.all) <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb139-33" title="33">            <span class="co"># give it a name, otherwise if only one stat, name of stat not saved</span></a>
<a class="sourceLine" id="cb139-34" title="34">            df.overall.stats &lt;-<span class="st"> </span>df.overall.stats <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="op">!!</span><span class="dt">strs.all :=</span> <span class="op">!!</span><span class="kw">sym</span>(var.numeric))</a>
<a class="sourceLine" id="cb139-35" title="35">        }</a>
<a class="sourceLine" id="cb139-36" title="36">        <span class="kw">names</span>(df.overall.stats) &lt;-<span class="st"> </span><span class="kw">paste0</span>(var.numeric, <span class="st">&#39;.&#39;</span>, <span class="kw">names</span>(df.overall.stats))</a>
<a class="sourceLine" id="cb139-37" title="37">    }</a>
<a class="sourceLine" id="cb139-38" title="38"></a>
<a class="sourceLine" id="cb139-39" title="39">    <span class="co"># Group Sort</span></a>
<a class="sourceLine" id="cb139-40" title="40">    df.select &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb139-41" title="41"><span class="st">                  </span><span class="kw">group_by</span>(<span class="op">!!!</span><span class="kw">syms</span>(vars.group)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb139-42" title="42"><span class="st">                  </span><span class="kw">arrange</span>(<span class="op">!!!</span><span class="kw">syms</span>(<span class="kw">c</span>(vars.group, var.numeric)))</a>
<a class="sourceLine" id="cb139-43" title="43"></a>
<a class="sourceLine" id="cb139-44" title="44">    <span class="co"># Table of Statistics</span></a>
<a class="sourceLine" id="cb139-45" title="45">    df.table.grp.stats &lt;-<span class="st"> </span>df.select <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize_at</span>(<span class="kw">vars</span>(var.numeric), <span class="kw">funs</span>(<span class="op">!!!</span>strs.all))</a>
<a class="sourceLine" id="cb139-46" title="46"></a>
<a class="sourceLine" id="cb139-47" title="47">    <span class="co"># Add Stat Name</span></a>
<a class="sourceLine" id="cb139-48" title="48">    <span class="cf">if</span> (<span class="kw">length</span>(strs.all) <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb139-49" title="49">        <span class="co"># give it a name, otherwise if only one stat, name of stat not saved</span></a>
<a class="sourceLine" id="cb139-50" title="50">        df.table.grp.stats &lt;-<span class="st"> </span>df.table.grp.stats <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="op">!!</span><span class="dt">strs.all :=</span> <span class="op">!!</span><span class="kw">sym</span>(var.numeric))</a>
<a class="sourceLine" id="cb139-51" title="51">    }</a>
<a class="sourceLine" id="cb139-52" title="52"></a>
<a class="sourceLine" id="cb139-53" title="53">    <span class="co"># Row of Statistics</span></a>
<a class="sourceLine" id="cb139-54" title="54">    str.vars.group.combine &lt;-<span class="st"> </span><span class="kw">paste0</span>(vars.group, <span class="dt">collapse=</span><span class="st">&#39;_&#39;</span>)</a>
<a class="sourceLine" id="cb139-55" title="55">    <span class="cf">if</span> (<span class="kw">length</span>(vars.group) <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb139-56" title="56">        df.row.grp.stats &lt;-<span class="st"> </span>df.table.grp.stats <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb139-57" title="57"><span class="st">                </span><span class="kw">mutate</span>(<span class="op">!!</span>(str.vars.group.combine) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">paste0</span>(var.numeric, <span class="st">&#39;.&#39;</span>,</a>
<a class="sourceLine" id="cb139-58" title="58">                                               vars.group, <span class="st">&#39;.g&#39;</span>,</a>
<a class="sourceLine" id="cb139-59" title="59">                                               (<span class="op">!!!</span><span class="kw">syms</span>(vars.group)))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb139-60" title="60"><span class="st">                </span><span class="kw">gather</span>(variable, value, <span class="op">-</span><span class="kw">one_of</span>(vars.group)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb139-61" title="61"><span class="st">                </span><span class="kw">unite</span>(str.vars.group.combine, <span class="kw">c</span>(str.vars.group.combine, <span class="st">&#39;variable&#39;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb139-62" title="62"><span class="st">                </span><span class="kw">spread</span>(str.vars.group.combine, value)</a>
<a class="sourceLine" id="cb139-63" title="63">    } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb139-64" title="64">        df.row.grp.stats &lt;-<span class="st"> </span>df.table.grp.stats <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb139-65" title="65"><span class="st">          </span><span class="kw">mutate</span>(<span class="dt">vars.groups.combine :=</span> <span class="kw">paste0</span>(<span class="kw">paste0</span>(vars.group, <span class="dt">collapse=</span><span class="st">&#39;.&#39;</span>)),</a>
<a class="sourceLine" id="cb139-66" title="66">                 <span class="op">!!</span>(str.vars.group.combine) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">paste0</span>(<span class="kw">interaction</span>(<span class="op">!!!</span>(<span class="kw">syms</span>(vars.group))))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb139-67" title="67"><span class="st">          </span><span class="kw">mutate</span>(<span class="op">!!</span>(str.vars.group.combine) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">paste0</span>(var.numeric, <span class="st">&#39;.&#39;</span>, vars.groups.combine, <span class="st">&#39;.&#39;</span>,</a>
<a class="sourceLine" id="cb139-68" title="68">                                                      (<span class="op">!!</span><span class="kw">sym</span>(str.vars.group.combine)))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb139-69" title="69"><span class="st">          </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb139-70" title="70"><span class="st">          </span><span class="kw">select</span>(<span class="op">-</span>vars.groups.combine, <span class="op">-</span><span class="kw">one_of</span>(vars.group)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb139-71" title="71"><span class="st">          </span><span class="kw">gather</span>(variable, value, <span class="op">-</span><span class="kw">one_of</span>(str.vars.group.combine)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb139-72" title="72"><span class="st">          </span><span class="kw">unite</span>(str.vars.group.combine, <span class="kw">c</span>(str.vars.group.combine, <span class="st">&#39;variable&#39;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb139-73" title="73"><span class="st">          </span><span class="kw">spread</span>(str.vars.group.combine, value)</a>
<a class="sourceLine" id="cb139-74" title="74">    }</a>
<a class="sourceLine" id="cb139-75" title="75"></a>
<a class="sourceLine" id="cb139-76" title="76">    <span class="co"># Clean up name strings</span></a>
<a class="sourceLine" id="cb139-77" title="77">    <span class="kw">names</span>(df.table.grp.stats) &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb139-78" title="78"><span class="st">      </span><span class="kw">gsub</span>(<span class="dt">x =</span> <span class="kw">names</span>(df.table.grp.stats),<span class="dt">pattern =</span> <span class="st">&quot;_&quot;</span>, <span class="dt">replacement =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">.&quot;</span>)</a>
<a class="sourceLine" id="cb139-79" title="79">    <span class="kw">names</span>(df.row.grp.stats) &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb139-80" title="80"><span class="st">      </span><span class="kw">gsub</span>(<span class="dt">x =</span> <span class="kw">names</span>(df.row.grp.stats),<span class="dt">pattern =</span> <span class="st">&quot;_&quot;</span>, <span class="dt">replacement =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">.&quot;</span>)</a>
<a class="sourceLine" id="cb139-81" title="81"></a>
<a class="sourceLine" id="cb139-82" title="82">    <span class="co"># Return</span></a>
<a class="sourceLine" id="cb139-83" title="83">    list.return &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb139-84" title="84"><span class="st">      </span><span class="kw">list</span>(<span class="dt">df_table_grp_stats =</span> df.table.grp.stats, <span class="dt">df_row_grp_stats =</span> df.row.grp.stats)</a>
<a class="sourceLine" id="cb139-85" title="85"></a>
<a class="sourceLine" id="cb139-86" title="86">    <span class="co"># Overall Statistics, without grouping</span></a>
<a class="sourceLine" id="cb139-87" title="87">    <span class="cf">if</span> (boo.overall.stats) {</a>
<a class="sourceLine" id="cb139-88" title="88">        df.row.stats.all &lt;-<span class="st"> </span><span class="kw">c</span>(df.row.grp.stats, df.overall.stats)</a>
<a class="sourceLine" id="cb139-89" title="89">        list.return &lt;-<span class="st"> </span><span class="kw">append</span>(list.return, <span class="kw">list</span>(<span class="dt">df_overall_stats =</span> df.overall.stats,</a>
<a class="sourceLine" id="cb139-90" title="90">                                                <span class="dt">df_row_stats_all =</span> df.row.stats.all))</a>
<a class="sourceLine" id="cb139-91" title="91">    }</a>
<a class="sourceLine" id="cb139-92" title="92"></a>
<a class="sourceLine" id="cb139-93" title="93">    <span class="co"># Return</span></a>
<a class="sourceLine" id="cb139-94" title="94">    <span class="kw">return</span>(list.return)</a>
<a class="sourceLine" id="cb139-95" title="95"></a>
<a class="sourceLine" id="cb139-96" title="96">}</a></code></pre></div>
</div>
<div id="test" class="section level4">
<h4><span class="header-section-number">2.3.2.2</span> Test</h4>
<p>Load data and test</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb140-1" title="1"><span class="co"># Library</span></a>
<a class="sourceLine" id="cb140-2" title="2"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb140-3" title="3"></a>
<a class="sourceLine" id="cb140-4" title="4"><span class="co"># Load Sample Data</span></a>
<a class="sourceLine" id="cb140-5" title="5"><span class="kw">setwd</span>(<span class="st">&#39;C:/Users/fan/R4Econ/_data/&#39;</span>)</a>
<a class="sourceLine" id="cb140-6" title="6">df &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;height_weight.csv&#39;</span>)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   S.country = col_character(),
##   vil.id = col_double(),
##   indi.id = col_double(),
##   sex = col_character(),
##   svymthRound = col_double(),
##   momEdu = col_double(),
##   wealthIdx = col_double(),
##   hgt = col_double(),
##   wgt = col_double(),
##   hgt0 = col_double(),
##   wgt0 = col_double(),
##   prot = col_double(),
##   cal = col_double(),
##   p.A.prot = col_double(),
##   p.A.nProt = col_double()
## )</code></pre>
<div id="function-testing-by-gender-groups" class="section level5">
<h5><span class="header-section-number">2.3.2.2.1</span> Function Testing By Gender Groups</h5>
<p>Need two variables, a group variable that is a factor, and a numeric</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb142-1" title="1">vars.group &lt;-<span class="st"> &#39;sex&#39;</span></a>
<a class="sourceLine" id="cb142-2" title="2">var.numeric &lt;-<span class="st"> &#39;hgt&#39;</span></a></code></pre></div>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb143-1" title="1">df.select &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">one_of</span>(vars.group, var.numeric)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">drop_na</span>()</a></code></pre></div>
<p>Main Statistics:</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb144-1" title="1"><span class="co"># Single Variable Group Statistics</span></a>
<a class="sourceLine" id="cb144-2" title="2"><span class="kw">ff_summ_by_group_summ_one</span>(</a>
<a class="sourceLine" id="cb144-3" title="3">  df.select, <span class="dt">vars.group =</span> vars.group, <span class="dt">var.numeric =</span> var.numeric, </a>
<a class="sourceLine" id="cb144-4" title="4">  <span class="dt">str.stats.group =</span> <span class="st">&#39;main&#39;</span>)</a></code></pre></div>
<pre><code>## $df_table_grp_stats
## # A tibble: 2 x 5
##   sex     mean   min   max    sd
##   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Female  82.8  41.2  171.  29.8
## 2 Male    84.7  41.3  183.  31.8
## 
## $df_row_grp_stats
## # A tibble: 1 x 8
##   hgt.sex.gFemale.max hgt.sex.gFemale.mean hgt.sex.gFemale.min hgt.sex.gFemale.sd hgt.sex.gMale.max hgt.sex.gMale.mean hgt.sex.gMale.min hgt.sex.gMale.sd
##                 &lt;dbl&gt;                &lt;dbl&gt;               &lt;dbl&gt;              &lt;dbl&gt;             &lt;dbl&gt;              &lt;dbl&gt;             &lt;dbl&gt;            &lt;dbl&gt;
## 1                171.                 82.8                41.2               29.8              183.               84.7              41.3             31.8
## 
## $df_overall_stats
## # A tibble: 1 x 4
##   hgt.mean hgt.min hgt.max hgt.sd
##      &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
## 1     83.8    41.2    183.   30.9
## 
## $df_row_stats_all
## $df_row_stats_all$hgt.sex.gFemale.max
## [1] 170.6
## 
## $df_row_stats_all$hgt.sex.gFemale.mean
## [1] 82.81198
## 
## $df_row_stats_all$hgt.sex.gFemale.min
## [1] 41.2
## 
## $df_row_stats_all$hgt.sex.gFemale.sd
## [1] 29.79351
## 
## $df_row_stats_all$hgt.sex.gMale.max
## [1] 182.9
## 
## $df_row_stats_all$hgt.sex.gMale.mean
## [1] 84.68152
## 
## $df_row_stats_all$hgt.sex.gMale.min
## [1] 41.3
## 
## $df_row_stats_all$hgt.sex.gMale.sd
## [1] 31.75037
## 
## $df_row_stats_all$hgt.mean
## [1] 83.80921
## 
## $df_row_stats_all$hgt.min
## [1] 41.2
## 
## $df_row_stats_all$hgt.max
## [1] 182.9
## 
## $df_row_stats_all$hgt.sd
## [1] 30.86631</code></pre>
<p>Specify Two Specific Statistics:</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb146-1" title="1"><span class="kw">ff_summ_by_group_summ_one</span>(</a>
<a class="sourceLine" id="cb146-2" title="2">  df.select, <span class="dt">vars.group =</span> vars.group, <span class="dt">var.numeric =</span> var.numeric, </a>
<a class="sourceLine" id="cb146-3" title="3">  <span class="dt">str.stats.specify =</span> <span class="kw">c</span>(<span class="st">&#39;mean&#39;</span>, <span class="st">&#39;sd&#39;</span>))</a></code></pre></div>
<pre><code>## $df_table_grp_stats
## # A tibble: 2 x 3
##   sex     mean    sd
##   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1 Female  82.8  29.8
## 2 Male    84.7  31.8
## 
## $df_row_grp_stats
## # A tibble: 1 x 4
##   hgt.sex.gFemale.mean hgt.sex.gFemale.sd hgt.sex.gMale.mean hgt.sex.gMale.sd
##                  &lt;dbl&gt;              &lt;dbl&gt;              &lt;dbl&gt;            &lt;dbl&gt;
## 1                 82.8               29.8               84.7             31.8
## 
## $df_overall_stats
## # A tibble: 1 x 2
##   hgt.mean hgt.sd
##      &lt;dbl&gt;  &lt;dbl&gt;
## 1     83.8   30.9
## 
## $df_row_stats_all
## $df_row_stats_all$hgt.sex.gFemale.mean
## [1] 82.81198
## 
## $df_row_stats_all$hgt.sex.gFemale.sd
## [1] 29.79351
## 
## $df_row_stats_all$hgt.sex.gMale.mean
## [1] 84.68152
## 
## $df_row_stats_all$hgt.sex.gMale.sd
## [1] 31.75037
## 
## $df_row_stats_all$hgt.mean
## [1] 83.80921
## 
## $df_row_stats_all$hgt.sd
## [1] 30.86631</code></pre>
<p>Specify One Specific Statistics:</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb148-1" title="1"><span class="kw">ff_summ_by_group_summ_one</span>(</a>
<a class="sourceLine" id="cb148-2" title="2">  df.select, <span class="dt">vars.group =</span> vars.group, <span class="dt">var.numeric =</span> var.numeric, </a>
<a class="sourceLine" id="cb148-3" title="3">  <span class="dt">str.stats.specify =</span> <span class="kw">c</span>(<span class="st">&#39;mean&#39;</span>))</a></code></pre></div>
<pre><code>## $df_table_grp_stats
## # A tibble: 2 x 2
##   sex     mean
##   &lt;chr&gt;  &lt;dbl&gt;
## 1 Female  82.8
## 2 Male    84.7
## 
## $df_row_grp_stats
## # A tibble: 1 x 2
##   hgt.sex.gFemale.mean hgt.sex.gMale.mean
##                  &lt;dbl&gt;              &lt;dbl&gt;
## 1                 82.8               84.7
## 
## $df_overall_stats
## # A tibble: 1 x 1
##   hgt.mean
##      &lt;dbl&gt;
## 1     83.8
## 
## $df_row_stats_all
## $df_row_stats_all$hgt.sex.gFemale.mean
## [1] 82.81198
## 
## $df_row_stats_all$hgt.sex.gMale.mean
## [1] 84.68152
## 
## $df_row_stats_all$hgt.mean
## [1] 83.80921</code></pre>
</div>
<div id="function-testing-by-country-and-gender-groups" class="section level5">
<h5><span class="header-section-number">2.3.2.2.2</span> Function Testing By Country and Gender Groups</h5>
<p>Need two variables, a group variable that is a factor, and a numeric. Now joint grouping variables.</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb150-1" title="1">vars.group &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;S.country&#39;</span>, <span class="st">&#39;sex&#39;</span>)</a>
<a class="sourceLine" id="cb150-2" title="2">var.numeric &lt;-<span class="st"> &#39;hgt&#39;</span></a></code></pre></div>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb151-1" title="1">df.select &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">one_of</span>(vars.group, var.numeric)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">drop_na</span>()</a></code></pre></div>
<p>Main Statistics:</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb152-1" title="1"><span class="kw">ff_summ_by_group_summ_one</span>(</a>
<a class="sourceLine" id="cb152-2" title="2">  df.select, <span class="dt">vars.group =</span> vars.group, <span class="dt">var.numeric =</span> var.numeric, </a>
<a class="sourceLine" id="cb152-3" title="3">  <span class="dt">str.stats.group =</span> <span class="st">&#39;main&#39;</span>)</a></code></pre></div>
<pre><code>## $df_table_grp_stats
## # A tibble: 4 x 6
## # Groups:   S.country [2]
##   S.country sex     mean   min   max    sd
##   &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Cebu      Female  84.6  41.3  171.  32.5
## 2 Cebu      Male    87.0  41.3  183.  35.0
## 3 Guatemala Female  76.6  41.2  120.  15.7
## 4 Guatemala Male    77.0  41.5  125.  15.1
## 
## $df_row_grp_stats
## # A tibble: 1 x 16
##   hgt.S.country.s~ hgt.S.country.s~ hgt.S.country.s~ hgt.S.country.s~ hgt.S.country.s~ hgt.S.country.s~ hgt.S.country.s~ hgt.S.country.s~ hgt.S.country.s~
##              &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
## 1             171.             84.6             41.3             32.5             183.             87.0             41.3             35.0             120.
## # ... with 7 more variables: hgt.S.country.sex.Guatemala.Female.mean &lt;dbl&gt;, hgt.S.country.sex.Guatemala.Female.min &lt;dbl&gt;,
## #   hgt.S.country.sex.Guatemala.Female.sd &lt;dbl&gt;, hgt.S.country.sex.Guatemala.Male.max &lt;dbl&gt;, hgt.S.country.sex.Guatemala.Male.mean &lt;dbl&gt;,
## #   hgt.S.country.sex.Guatemala.Male.min &lt;dbl&gt;, hgt.S.country.sex.Guatemala.Male.sd &lt;dbl&gt;
## 
## $df_overall_stats
## # A tibble: 1 x 4
##   hgt.mean hgt.min hgt.max hgt.sd
##      &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
## 1     83.8    41.2    183.   30.9
## 
## $df_row_stats_all
## $df_row_stats_all$hgt.S.country.sex.Cebu.Female.max
## [1] 170.6
## 
## $df_row_stats_all$hgt.S.country.sex.Cebu.Female.mean
## [1] 84.61326
## 
## $df_row_stats_all$hgt.S.country.sex.Cebu.Female.min
## [1] 41.3
## 
## $df_row_stats_all$hgt.S.country.sex.Cebu.Female.sd
## [1] 32.53651
## 
## $df_row_stats_all$hgt.S.country.sex.Cebu.Male.max
## [1] 182.9
## 
## $df_row_stats_all$hgt.S.country.sex.Cebu.Male.mean
## [1] 87.02836
## 
## $df_row_stats_all$hgt.S.country.sex.Cebu.Male.min
## [1] 41.3
## 
## $df_row_stats_all$hgt.S.country.sex.Cebu.Male.sd
## [1] 34.9909
## 
## $df_row_stats_all$hgt.S.country.sex.Guatemala.Female.max
## [1] 119.9
## 
## $df_row_stats_all$hgt.S.country.sex.Guatemala.Female.mean
## [1] 76.58771
## 
## $df_row_stats_all$hgt.S.country.sex.Guatemala.Female.min
## [1] 41.2
## 
## $df_row_stats_all$hgt.S.country.sex.Guatemala.Female.sd
## [1] 15.71801
## 
## $df_row_stats_all$hgt.S.country.sex.Guatemala.Male.max
## [1] 124.7
## 
## $df_row_stats_all$hgt.S.country.sex.Guatemala.Male.mean
## [1] 77.0471
## 
## $df_row_stats_all$hgt.S.country.sex.Guatemala.Male.min
## [1] 41.5
## 
## $df_row_stats_all$hgt.S.country.sex.Guatemala.Male.sd
## [1] 15.11444
## 
## $df_row_stats_all$hgt.mean
## [1] 83.80921
## 
## $df_row_stats_all$hgt.min
## [1] 41.2
## 
## $df_row_stats_all$hgt.max
## [1] 182.9
## 
## $df_row_stats_all$hgt.sd
## [1] 30.86631</code></pre>
<p>Specify Two Specific Statistics:</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb154-1" title="1"><span class="kw">ff_summ_by_group_summ_one</span>(</a>
<a class="sourceLine" id="cb154-2" title="2">  df.select, <span class="dt">vars.group =</span> vars.group, <span class="dt">var.numeric =</span> var.numeric, </a>
<a class="sourceLine" id="cb154-3" title="3">  <span class="dt">str.stats.specify =</span> <span class="kw">c</span>(<span class="st">&#39;mean&#39;</span>, <span class="st">&#39;sd&#39;</span>))</a></code></pre></div>
<pre><code>## $df_table_grp_stats
## # A tibble: 4 x 4
## # Groups:   S.country [2]
##   S.country sex     mean    sd
##   &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1 Cebu      Female  84.6  32.5
## 2 Cebu      Male    87.0  35.0
## 3 Guatemala Female  76.6  15.7
## 4 Guatemala Male    77.0  15.1
## 
## $df_row_grp_stats
## # A tibble: 1 x 8
##   hgt.S.country.sex.~ hgt.S.country.sex.~ hgt.S.country.sex.~ hgt.S.country.sex~ hgt.S.country.sex~ hgt.S.country.sex~ hgt.S.country.sex~ hgt.S.country.sex~
##                 &lt;dbl&gt;               &lt;dbl&gt;               &lt;dbl&gt;              &lt;dbl&gt;              &lt;dbl&gt;              &lt;dbl&gt;              &lt;dbl&gt;              &lt;dbl&gt;
## 1                84.6                32.5                87.0               35.0               76.6               15.7               77.0               15.1
## 
## $df_overall_stats
## # A tibble: 1 x 2
##   hgt.mean hgt.sd
##      &lt;dbl&gt;  &lt;dbl&gt;
## 1     83.8   30.9
## 
## $df_row_stats_all
## $df_row_stats_all$hgt.S.country.sex.Cebu.Female.mean
## [1] 84.61326
## 
## $df_row_stats_all$hgt.S.country.sex.Cebu.Female.sd
## [1] 32.53651
## 
## $df_row_stats_all$hgt.S.country.sex.Cebu.Male.mean
## [1] 87.02836
## 
## $df_row_stats_all$hgt.S.country.sex.Cebu.Male.sd
## [1] 34.9909
## 
## $df_row_stats_all$hgt.S.country.sex.Guatemala.Female.mean
## [1] 76.58771
## 
## $df_row_stats_all$hgt.S.country.sex.Guatemala.Female.sd
## [1] 15.71801
## 
## $df_row_stats_all$hgt.S.country.sex.Guatemala.Male.mean
## [1] 77.0471
## 
## $df_row_stats_all$hgt.S.country.sex.Guatemala.Male.sd
## [1] 15.11444
## 
## $df_row_stats_all$hgt.mean
## [1] 83.80921
## 
## $df_row_stats_all$hgt.sd
## [1] 30.86631</code></pre>
<p>Specify One Specific Statistics:</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb156-1" title="1"><span class="kw">ff_summ_by_group_summ_one</span>(</a>
<a class="sourceLine" id="cb156-2" title="2">  df.select, <span class="dt">vars.group =</span> vars.group, <span class="dt">var.numeric =</span> var.numeric, <span class="dt">str.stats.specify =</span> <span class="kw">c</span>(<span class="st">&#39;mean&#39;</span>))</a></code></pre></div>
<pre><code>## $df_table_grp_stats
## # A tibble: 4 x 3
## # Groups:   S.country [2]
##   S.country sex     mean
##   &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt;
## 1 Cebu      Female  84.6
## 2 Cebu      Male    87.0
## 3 Guatemala Female  76.6
## 4 Guatemala Male    77.0
## 
## $df_row_grp_stats
## # A tibble: 1 x 4
##   hgt.S.country.sex.Cebu.Female.mean hgt.S.country.sex.Cebu.Male.mean hgt.S.country.sex.Guatemala.Female.mean hgt.S.country.sex.Guatemala.Male.mean
##                                &lt;dbl&gt;                            &lt;dbl&gt;                                   &lt;dbl&gt;                                 &lt;dbl&gt;
## 1                               84.6                             87.0                                    76.6                                  77.0
## 
## $df_overall_stats
## # A tibble: 1 x 1
##   hgt.mean
##      &lt;dbl&gt;
## 1     83.8
## 
## $df_row_stats_all
## $df_row_stats_all$hgt.S.country.sex.Cebu.Female.mean
## [1] 84.61326
## 
## $df_row_stats_all$hgt.S.country.sex.Cebu.Male.mean
## [1] 87.02836
## 
## $df_row_stats_all$hgt.S.country.sex.Guatemala.Female.mean
## [1] 76.58771
## 
## $df_row_stats_all$hgt.S.country.sex.Guatemala.Male.mean
## [1] 77.0471
## 
## $df_row_stats_all$hgt.mean
## [1] 83.80921</code></pre>

</div>
</div>
</div>
<div id="nested-within-group-stats" class="section level3">
<h3><span class="header-section-number">2.3.3</span> Nested within Group Stats</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/CodeDynaAsset/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R4Econ</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository.</p>
</blockquote>
<p>By Multiple within Individual Groups Variables, Averages for All Numeric Variables within All Groups of All Group Variables (Long to very Wide). Suppose you have an individual level final outcome. The individual is observed for N periods, where each period the inputs differ. What inputs impacted the final outcome?</p>
<p>Suppose we can divide N periods in which the individual is in the data into a number of years, a number of semi-years, a number of quarters, or uneven-staggered lengths. We might want to generate averages across individuals and within each of these different possible groups averages of inputs.</p>
<p>Then we want to version of the data where each row is an individual, one of the variables is the final outcome, and the other variables are these different averages: averages for the 1st, 2nd, 3rd year in which indivdiual is in data, averages for 1st, …, final quarter in which indivdiual is in data.</p>
<div id="build-function" class="section level4">
<h4><span class="header-section-number">2.3.3.1</span> Build Function</h4>
<p>This function takes as inputs:</p>
<ol style="list-style-type: decimal">
<li><strong>vars.not.groups2avg</strong>: a list of variables that are not the within-indivdiual or across-individual grouping variables, but the variables we want to average over. Withnin indivdiual grouping averages will be calculated for these variables using the not-listed variables as within indivdiual groups (excluding vars.indi.grp groups).</li>
<li><strong>vars.indi.grp</strong>: a list or individual variables, and also perhaps villages, province, etc id variables that are higher than individual ID. Note the groups are are ACROSS individual higher level group variables.</li>
<li>the remaining variables are all within individual grouping variables.</li>
</ol>
<p>the function output is a dataframe:</p>
<ol style="list-style-type: decimal">
<li>each row is an individual</li>
<li>initial variables individual ID and across individual groups from <em>vars.indi.grp</em>.</li>
<li>other variables are all averages for the variables in <em>vars.not.groups2avg</em>
<ul>
<li>if there are 2 within individual group variables, and the first has 3 groups (years), the second has 6 groups (semi-years), then there would be 9 average variables.</li>
<li>each average variables has the original variable name from vars.not.groups2avg plus the name of the within individual grouping variable, and at the end ‘c_x’, where x is a integer representing the category within the group (if 3 years, x=1, 2, 3)</li>
</ul></li>
</ol>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb158-1" title="1"><span class="co"># Data Function</span></a>
<a class="sourceLine" id="cb158-2" title="2"><span class="co"># https://fanwangecon.github.io/R4Econ/summarize/summ/ByGroupsSummWide.html</span></a>
<a class="sourceLine" id="cb158-3" title="3">f.by.groups.summ.wide &lt;-<span class="st"> </span><span class="cf">function</span>(df.groups.to.average,</a>
<a class="sourceLine" id="cb158-4" title="4">                                  vars.not.groups2avg,</a>
<a class="sourceLine" id="cb158-5" title="5">                                  <span class="dt">vars.indi.grp =</span> <span class="kw">c</span>(<span class="st">&#39;S.country&#39;</span>,<span class="st">&#39;ID&#39;</span>),</a>
<a class="sourceLine" id="cb158-6" title="6">                                  <span class="dt">display=</span><span class="ot">TRUE</span>) {</a>
<a class="sourceLine" id="cb158-7" title="7"></a>
<a class="sourceLine" id="cb158-8" title="8"><span class="co"># 1. generate categoricals for full year (m.12), half year (m.6), quarter year (m.4)</span></a>
<a class="sourceLine" id="cb158-9" title="9"><span class="co"># 2. generate categoricals also for uneven years (m12t14) using stagger (+2 rather than -1)</span></a>
<a class="sourceLine" id="cb158-10" title="10"><span class="co"># 3. reshape wide to long, so that all categorical date groups appear in var=value,</span></a>
<a class="sourceLine" id="cb158-11" title="11">    <span class="co"># and categories in var=variable</span></a>
<a class="sourceLine" id="cb158-12" title="12"><span class="co"># 4. calculate mean for all numeric variables for all date groups</span></a>
<a class="sourceLine" id="cb158-13" title="13"><span class="co"># 5. combine date categorical variable and value, single var:</span></a>
<a class="sourceLine" id="cb158-14" title="14">    <span class="co"># m.12.c1= first year average from m.12 averaging</span></a>
<a class="sourceLine" id="cb158-15" title="15"></a>
<a class="sourceLine" id="cb158-16" title="16"><span class="co">######## ######## ######## ######## #######</span></a>
<a class="sourceLine" id="cb158-17" title="17"><span class="co"># Step 1</span></a>
<a class="sourceLine" id="cb158-18" title="18"><span class="co">######## ######## ######## ######## #######</span></a>
<a class="sourceLine" id="cb158-19" title="19"><span class="co"># 1. generate categoricals for full year (m.12), half year (m.6), quarter year (m.4)</span></a>
<a class="sourceLine" id="cb158-20" title="20"><span class="co"># 2. generate categoricals also for uneven years (m12t14) using stagger (+2 rather than -1)</span></a>
<a class="sourceLine" id="cb158-21" title="21"></a>
<a class="sourceLine" id="cb158-22" title="22"><span class="co">######## ######## ######## ######## #######</span></a>
<a class="sourceLine" id="cb158-23" title="23"><span class="co"># S2: reshape wide to long, so that all categorical date groups appear in var=value,</span></a>
<a class="sourceLine" id="cb158-24" title="24">    <span class="co"># and categories in var=variable; calculate mean for all numeric variables for all date groups</span></a>
<a class="sourceLine" id="cb158-25" title="25"><span class="co">######## ######## ######## ######## #######</span></a>
<a class="sourceLine" id="cb158-26" title="26">df.avg.long &lt;-<span class="st"> </span>df.groups.to.average <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb158-27" title="27"><span class="st">       </span><span class="kw">gather</span>(variable, value, <span class="op">-</span><span class="kw">one_of</span>(<span class="kw">c</span>(vars.indi.grp,</a>
<a class="sourceLine" id="cb158-28" title="28">                                         vars.not.groups2avg))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb158-29" title="29"><span class="st">       </span><span class="kw">group_by</span>(<span class="op">!!!</span><span class="kw">syms</span>(vars.indi.grp), variable, value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb158-30" title="30"><span class="st">       </span><span class="kw">summarise_if</span>(is.numeric, <span class="kw">funs</span>(<span class="kw">mean</span>(., <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)))</a>
<a class="sourceLine" id="cb158-31" title="31"></a>
<a class="sourceLine" id="cb158-32" title="32"><span class="cf">if</span> (display){</a>
<a class="sourceLine" id="cb158-33" title="33">  <span class="kw">dim</span>(df.avg.long)</a>
<a class="sourceLine" id="cb158-34" title="34">  <span class="kw">options</span>(<span class="dt">repr.matrix.max.rows=</span><span class="dv">10</span>, <span class="dt">repr.matrix.max.cols=</span><span class="dv">20</span>)</a>
<a class="sourceLine" id="cb158-35" title="35">  <span class="kw">print</span>(df.avg.long)</a>
<a class="sourceLine" id="cb158-36" title="36">}</a>
<a class="sourceLine" id="cb158-37" title="37"></a>
<a class="sourceLine" id="cb158-38" title="38"><span class="co">######## ######## ######## ######## #######</span></a>
<a class="sourceLine" id="cb158-39" title="39"><span class="co"># S3 combine date categorical variable and value, single var:</span></a>
<a class="sourceLine" id="cb158-40" title="40"><span class="co">#    m.12.c1= first year average from m.12 averaging; to do this make data even longer first</span></a>
<a class="sourceLine" id="cb158-41" title="41"><span class="co">######## ######## ######## ######## #######</span></a>
<a class="sourceLine" id="cb158-42" title="42"></a>
<a class="sourceLine" id="cb158-43" title="43"><span class="co"># We already have the averages, but we want them to show up as variables,</span></a>
<a class="sourceLine" id="cb158-44" title="44">    <span class="co"># mean for each group of each variable.</span></a>
<a class="sourceLine" id="cb158-45" title="45">df.avg.allvars.wide &lt;-<span class="st"> </span>df.avg.long <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb158-46" title="46"><span class="st">   </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb158-47" title="47"><span class="st">   </span><span class="kw">mutate</span>(<span class="dt">all_m_cate =</span> <span class="kw">paste0</span>(variable, <span class="st">&#39;_c&#39;</span>, value)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb158-48" title="48"><span class="st">   </span><span class="kw">select</span>(all_m_cate, <span class="kw">everything</span>(), <span class="op">-</span>variable, <span class="op">-</span>value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb158-49" title="49"><span class="st">   </span><span class="kw">gather</span>(variable, value, <span class="op">-</span><span class="kw">one_of</span>(vars.indi.grp), <span class="op">-</span>all_m_cate) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb158-50" title="50"><span class="st">   </span><span class="kw">unite</span>(<span class="st">&#39;var_mcate&#39;</span>, variable, all_m_cate) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb158-51" title="51"><span class="st">   </span><span class="kw">spread</span>(var_mcate, value)</a>
<a class="sourceLine" id="cb158-52" title="52"></a>
<a class="sourceLine" id="cb158-53" title="53"><span class="cf">if</span> (display){</a>
<a class="sourceLine" id="cb158-54" title="54">  <span class="kw">dim</span>(df.avg.allvars.wide)</a>
<a class="sourceLine" id="cb158-55" title="55">  <span class="kw">options</span>(<span class="dt">repr.matrix.max.rows=</span><span class="dv">10</span>, <span class="dt">repr.matrix.max.cols=</span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb158-56" title="56">  <span class="kw">print</span>(df.avg.allvars.wide)</a>
<a class="sourceLine" id="cb158-57" title="57">}</a>
<a class="sourceLine" id="cb158-58" title="58"></a>
<a class="sourceLine" id="cb158-59" title="59"><span class="kw">return</span>(df.avg.allvars.wide)</a>
<a class="sourceLine" id="cb158-60" title="60">}</a></code></pre></div>
</div>
<div id="test-program" class="section level4">
<h4><span class="header-section-number">2.3.3.2</span> Test Program</h4>
<p>In our sample dataset, the number of nutrition/height/income etc information observed within each country and month of age group are different. We have a panel dataset for children observed over different months of age.</p>
<p>We have two key grouping variables:
1. country: data are observed for guatemala and cebu
2. month-age (survey month round=svymthRound): different months of age at which each individual child is observed</p>
<p>A child could be observed for many months, or just a few months. A child’s height information could be observed for more months-of-age than nutritional intake information. We eventually want to run regressions where the outcome is height/weight and the input is nutrition. The regressions will be at the month-of-age level. We need to know how many times different variables are observed at the month-of-age level.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb159-1" title="1"><span class="co"># Library</span></a>
<a class="sourceLine" id="cb159-2" title="2"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb159-3" title="3"></a>
<a class="sourceLine" id="cb159-4" title="4"><span class="co"># Load Sample Data</span></a>
<a class="sourceLine" id="cb159-5" title="5"><span class="kw">setwd</span>(<span class="st">&#39;C:/Users/fan/R4Econ/_data/&#39;</span>)</a>
<a class="sourceLine" id="cb159-6" title="6">df &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;height_weight.csv&#39;</span>)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   S.country = col_character(),
##   vil.id = col_double(),
##   indi.id = col_double(),
##   sex = col_character(),
##   svymthRound = col_double(),
##   momEdu = col_double(),
##   wealthIdx = col_double(),
##   hgt = col_double(),
##   wgt = col_double(),
##   hgt0 = col_double(),
##   wgt0 = col_double(),
##   prot = col_double(),
##   cal = col_double(),
##   p.A.prot = col_double(),
##   p.A.nProt = col_double()
## )</code></pre>
<div id="generate-within-individual-groups" class="section level5">
<h5><span class="header-section-number">2.3.3.2.1</span> Generate Within Individual Groups</h5>
<p>In the data, children are observed for different number of months since birth. We want to calculate quarterly, semi-year, annual, etc average nutritional intakes. First generate these within-individual grouping variables. We can also generate uneven-staggered calendar groups as shown below.</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb161-1" title="1">mth.var &lt;-<span class="st"> &#39;svymthRound&#39;</span></a>
<a class="sourceLine" id="cb161-2" title="2">df.groups.to.average&lt;-<span class="st"> </span>df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb161-3" title="3"><span class="st">        </span><span class="kw">filter</span>(<span class="op">!!</span><span class="kw">sym</span>(mth.var) <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span><span class="op">!!</span><span class="kw">sym</span>(mth.var) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">24</span>)  <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb161-4" title="4"><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">m12t24=</span>(<span class="kw">floor</span>((<span class="op">!!</span><span class="kw">sym</span>(mth.var) <span class="op">-</span><span class="st"> </span><span class="dv">12</span>) <span class="op">%/%</span><span class="st"> </span><span class="dv">14</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>),</a>
<a class="sourceLine" id="cb161-5" title="5">               <span class="dt">m8t24=</span>(<span class="kw">floor</span>((<span class="op">!!</span><span class="kw">sym</span>(mth.var) <span class="op">-</span><span class="st"> </span><span class="dv">8</span>) <span class="op">%/%</span><span class="st"> </span><span class="dv">18</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>),</a>
<a class="sourceLine" id="cb161-6" title="6">               <span class="dt">m12 =</span> <span class="kw">pmax</span>((<span class="kw">floor</span>((<span class="op">!!</span><span class="kw">sym</span>(mth.var)<span class="op">-</span><span class="dv">1</span>) <span class="op">%/%</span><span class="st"> </span><span class="dv">12</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>), <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb161-7" title="7">               <span class="dt">m6 =</span> <span class="kw">pmax</span>((<span class="kw">floor</span>((<span class="op">!!</span><span class="kw">sym</span>(mth.var)<span class="op">-</span><span class="dv">1</span>) <span class="op">%/%</span><span class="st"> </span><span class="dv">6</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>), <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb161-8" title="8">               <span class="dt">m3 =</span> <span class="kw">pmax</span>((<span class="kw">floor</span>((<span class="op">!!</span><span class="kw">sym</span>(mth.var)<span class="op">-</span><span class="dv">1</span>) <span class="op">%/%</span><span class="st"> </span><span class="dv">3</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>), <span class="dv">1</span>))</a></code></pre></div>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb162-1" title="1"><span class="co"># Show Results</span></a>
<a class="sourceLine" id="cb162-2" title="2"><span class="kw">options</span>(<span class="dt">repr.matrix.max.rows=</span><span class="dv">30</span>, <span class="dt">repr.matrix.max.cols=</span><span class="dv">20</span>)</a>
<a class="sourceLine" id="cb162-3" title="3">vars.arrange &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;S.country&#39;</span>,<span class="st">&#39;indi.id&#39;</span>,<span class="st">&#39;svymthRound&#39;</span>)</a>
<a class="sourceLine" id="cb162-4" title="4">vars.groups.within.indi &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;m12t24&#39;</span>, <span class="st">&#39;m8t24&#39;</span>, <span class="st">&#39;m12&#39;</span>, <span class="st">&#39;m6&#39;</span>, <span class="st">&#39;m3&#39;</span>)</a>
<a class="sourceLine" id="cb162-5" title="5"><span class="kw">as.tibble</span>(df.groups.to.average <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb162-6" title="6"><span class="st">          </span><span class="kw">group_by</span>(<span class="op">!!!</span><span class="kw">syms</span>(vars.arrange)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb162-7" title="7"><span class="st">          </span><span class="kw">arrange</span>(<span class="op">!!!</span><span class="kw">syms</span>(vars.arrange)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb162-8" title="8"><span class="st">          </span><span class="kw">select</span>(<span class="op">!!!</span><span class="kw">syms</span>(vars.arrange), <span class="op">!!!</span><span class="kw">syms</span>(vars.groups.within.indi)))</a></code></pre></div>
<pre><code>## # A tibble: 23,603 x 8
##    S.country indi.id svymthRound m12t24 m8t24   m12    m6    m3
##    &lt;chr&gt;       &lt;dbl&gt;       &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 Cebu            1           0      0     0     1     1     1
##  2 Cebu            1           2      0     0     1     1     1
##  3 Cebu            1           4      0     0     1     1     2
##  4 Cebu            1           6      0     0     1     1     2
##  5 Cebu            1           8      0     1     1     2     3
##  6 Cebu            1          10      0     1     1     2     4
##  7 Cebu            1          12      1     1     1     2     4
##  8 Cebu            1          14      1     1     2     3     5
##  9 Cebu            1          16      1     1     2     3     6
## 10 Cebu            1          18      1     1     2     3     6
## # ... with 23,593 more rows</code></pre>
</div>
<div id="within-group-averages" class="section level5">
<h5><span class="header-section-number">2.3.3.2.2</span> Within Group Averages</h5>
<p>With the within-group averages created, we can generate averages for all variables within these groups.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb164-1" title="1">vars.not.groups2avg &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;prot&#39;</span>, <span class="st">&#39;cal&#39;</span>)</a>
<a class="sourceLine" id="cb164-2" title="2">vars.indi.grp &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;S.country&#39;</span>, <span class="st">&#39;indi.id&#39;</span>)</a>
<a class="sourceLine" id="cb164-3" title="3">vars.groups.within.indi &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;m12t24&#39;</span>, <span class="st">&#39;m8t24&#39;</span>, <span class="st">&#39;m12&#39;</span>, <span class="st">&#39;m6&#39;</span>, <span class="st">&#39;m3&#39;</span>)</a>
<a class="sourceLine" id="cb164-4" title="4"></a>
<a class="sourceLine" id="cb164-5" title="5">df.groups.to.average.select &lt;-<span class="st"> </span>df.groups.to.average <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb164-6" title="6"><span class="st">                        </span><span class="kw">select</span>(<span class="kw">one_of</span>(<span class="kw">c</span>(vars.indi.grp,</a>
<a class="sourceLine" id="cb164-7" title="7">                                        vars.not.groups2avg,</a>
<a class="sourceLine" id="cb164-8" title="8">                                        vars.groups.within.indi)))</a>
<a class="sourceLine" id="cb164-9" title="9">df.avg.allvars.wide &lt;-<span class="st"> </span><span class="kw">f.by.groups.summ.wide</span>(df.groups.to.average.select,</a>
<a class="sourceLine" id="cb164-10" title="10">                                             vars.not.groups2avg,</a>
<a class="sourceLine" id="cb164-11" title="11">                                             vars.indi.grp, <span class="dt">display=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## # A tibble: 36,414 x 6
## # Groups:   S.country, indi.id, variable [10,115]
##    S.country indi.id variable value   prot   cal
##    &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1 Cebu            1 m12          1   5.36 132. 
##  2 Cebu            1 m12          2 NaN    NaN  
##  3 Cebu            1 m12t24       0   4.37  97.1
##  4 Cebu            1 m12t24       1  11.3  343. 
##  5 Cebu            1 m3           1   0.65   9.1
##  6 Cebu            1 m3           2   3.65  95.5
##  7 Cebu            1 m3           3   2.6   85.3
##  8 Cebu            1 m3           4  13.2  315. 
##  9 Cebu            1 m3           5 NaN    NaN  
## 10 Cebu            1 m3           6 NaN    NaN  
## # ... with 36,404 more rows
## # A tibble: 2,023 x 38
##    S.country indi.id cal_m12_c1 cal_m12_c2 cal_m12t24_c0 cal_m12t24_c1 cal_m3_c1 cal_m3_c2 cal_m3_c3 cal_m3_c4 cal_m3_c5 cal_m3_c6 cal_m3_c7 cal_m3_c8
##    &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1 Cebu            1      132.        NaN           97.1          343.      9.1       95.5      85.3     315.       NaN       NaN       NaN       NaN 
##  2 Cebu            2       90.7       256.          81.5          240.     83.4       12.3     155.      144.       228       153.      305       348.
##  3 Cebu            3       96.8       659.          31.6          634.      0.5       28.8      57       281.       459.      550.      612       891.
##  4 Cebu            4       27.5       372.          24.6          325.      4.5       26.0      39.4      46.0      221.      271       581.      443.
##  5 Cebu            5      101.       1081.          79.2          960.     14.1      144.       71.3     161.       453.     1345.     1178.     1082 
##  6 Cebu            6      185.        522.         162.           493.     23.8      185.      169.      356.       653.      506.      417.      523 
##  7 Cebu            7      157.        571.         146.           514.      8.3      138.      408.      200.       391.      637.      688.      570.
##  8 Cebu            8      472.        845.         379.           871.    159.       423       418.      861.       691.      898.      637.      972.
##  9 Cebu            9       32.3       415.          16.6          374.      5.05      10.4      15.1      90.0      142.      204.      753.      594.
## 10 Cebu           10       67.2       395.          68.6          347.      9.55      26.4     165.      117.       297.      303       385.      542.
## # ... with 2,013 more rows, and 24 more variables: cal_m6_c1 &lt;dbl&gt;, cal_m6_c2 &lt;dbl&gt;, cal_m6_c3 &lt;dbl&gt;, cal_m6_c4 &lt;dbl&gt;, cal_m8t24_c0 &lt;dbl&gt;,
## #   cal_m8t24_c1 &lt;dbl&gt;, prot_m12_c1 &lt;dbl&gt;, prot_m12_c2 &lt;dbl&gt;, prot_m12t24_c0 &lt;dbl&gt;, prot_m12t24_c1 &lt;dbl&gt;, prot_m3_c1 &lt;dbl&gt;, prot_m3_c2 &lt;dbl&gt;,
## #   prot_m3_c3 &lt;dbl&gt;, prot_m3_c4 &lt;dbl&gt;, prot_m3_c5 &lt;dbl&gt;, prot_m3_c6 &lt;dbl&gt;, prot_m3_c7 &lt;dbl&gt;, prot_m3_c8 &lt;dbl&gt;, prot_m6_c1 &lt;dbl&gt;, prot_m6_c2 &lt;dbl&gt;,
## #   prot_m6_c3 &lt;dbl&gt;, prot_m6_c4 &lt;dbl&gt;, prot_m8t24_c0 &lt;dbl&gt;, prot_m8t24_c1 &lt;dbl&gt;</code></pre>
<p>This is the tabular version of results</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb166-1" title="1"><span class="kw">dim</span>(df.avg.allvars.wide)</a></code></pre></div>
<pre><code>## [1] 2023   38</code></pre>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb168-1" title="1"><span class="kw">names</span>(df.avg.allvars.wide)</a></code></pre></div>
<pre><code>##  [1] &quot;S.country&quot;      &quot;indi.id&quot;        &quot;cal_m12_c1&quot;     &quot;cal_m12_c2&quot;     &quot;cal_m12t24_c0&quot;  &quot;cal_m12t24_c1&quot;  &quot;cal_m3_c1&quot;      &quot;cal_m3_c2&quot;     
##  [9] &quot;cal_m3_c3&quot;      &quot;cal_m3_c4&quot;      &quot;cal_m3_c5&quot;      &quot;cal_m3_c6&quot;      &quot;cal_m3_c7&quot;      &quot;cal_m3_c8&quot;      &quot;cal_m6_c1&quot;      &quot;cal_m6_c2&quot;     
## [17] &quot;cal_m6_c3&quot;      &quot;cal_m6_c4&quot;      &quot;cal_m8t24_c0&quot;   &quot;cal_m8t24_c1&quot;   &quot;prot_m12_c1&quot;    &quot;prot_m12_c2&quot;    &quot;prot_m12t24_c0&quot; &quot;prot_m12t24_c1&quot;
## [25] &quot;prot_m3_c1&quot;     &quot;prot_m3_c2&quot;     &quot;prot_m3_c3&quot;     &quot;prot_m3_c4&quot;     &quot;prot_m3_c5&quot;     &quot;prot_m3_c6&quot;     &quot;prot_m3_c7&quot;     &quot;prot_m3_c8&quot;    
## [33] &quot;prot_m6_c1&quot;     &quot;prot_m6_c2&quot;     &quot;prot_m6_c3&quot;     &quot;prot_m6_c4&quot;     &quot;prot_m8t24_c0&quot;  &quot;prot_m8t24_c1&quot;</code></pre>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb170-1" title="1"><span class="kw">options</span>(<span class="dt">repr.matrix.max.rows=</span><span class="dv">30</span>, <span class="dt">repr.matrix.max.cols=</span><span class="dv">12</span>)</a>
<a class="sourceLine" id="cb170-2" title="2">df.avg.allvars.wide</a></code></pre></div>
<pre><code>## # A tibble: 2,023 x 38
##    S.country indi.id cal_m12_c1 cal_m12_c2 cal_m12t24_c0 cal_m12t24_c1 cal_m3_c1 cal_m3_c2 cal_m3_c3 cal_m3_c4 cal_m3_c5 cal_m3_c6 cal_m3_c7 cal_m3_c8
##    &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1 Cebu            1      132.        NaN           97.1          343.      9.1       95.5      85.3     315.       NaN       NaN       NaN       NaN 
##  2 Cebu            2       90.7       256.          81.5          240.     83.4       12.3     155.      144.       228       153.      305       348.
##  3 Cebu            3       96.8       659.          31.6          634.      0.5       28.8      57       281.       459.      550.      612       891.
##  4 Cebu            4       27.5       372.          24.6          325.      4.5       26.0      39.4      46.0      221.      271       581.      443.
##  5 Cebu            5      101.       1081.          79.2          960.     14.1      144.       71.3     161.       453.     1345.     1178.     1082 
##  6 Cebu            6      185.        522.         162.           493.     23.8      185.      169.      356.       653.      506.      417.      523 
##  7 Cebu            7      157.        571.         146.           514.      8.3      138.      408.      200.       391.      637.      688.      570.
##  8 Cebu            8      472.        845.         379.           871.    159.       423       418.      861.       691.      898.      637.      972.
##  9 Cebu            9       32.3       415.          16.6          374.      5.05      10.4      15.1      90.0      142.      204.      753.      594.
## 10 Cebu           10       67.2       395.          68.6          347.      9.55      26.4     165.      117.       297.      303       385.      542.
## # ... with 2,013 more rows, and 24 more variables: cal_m6_c1 &lt;dbl&gt;, cal_m6_c2 &lt;dbl&gt;, cal_m6_c3 &lt;dbl&gt;, cal_m6_c4 &lt;dbl&gt;, cal_m8t24_c0 &lt;dbl&gt;,
## #   cal_m8t24_c1 &lt;dbl&gt;, prot_m12_c1 &lt;dbl&gt;, prot_m12_c2 &lt;dbl&gt;, prot_m12t24_c0 &lt;dbl&gt;, prot_m12t24_c1 &lt;dbl&gt;, prot_m3_c1 &lt;dbl&gt;, prot_m3_c2 &lt;dbl&gt;,
## #   prot_m3_c3 &lt;dbl&gt;, prot_m3_c4 &lt;dbl&gt;, prot_m3_c5 &lt;dbl&gt;, prot_m3_c6 &lt;dbl&gt;, prot_m3_c7 &lt;dbl&gt;, prot_m3_c8 &lt;dbl&gt;, prot_m6_c1 &lt;dbl&gt;, prot_m6_c2 &lt;dbl&gt;,
## #   prot_m6_c3 &lt;dbl&gt;, prot_m6_c4 &lt;dbl&gt;, prot_m8t24_c0 &lt;dbl&gt;, prot_m8t24_c1 &lt;dbl&gt;</code></pre>

</div>
</div>
</div>
</div>
<div id="distributional-statistics" class="section level2">
<h2><span class="header-section-number">2.4</span> Distributional Statistics</h2>

<div id="histogram" class="section level3">
<h3><span class="header-section-number">2.4.1</span> Histogram</h3>
<div id="generate-test-score-dataset" class="section level4">
<h4><span class="header-section-number">2.4.1.1</span> Generate Test Score Dataset</h4>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/CodeDynaAsset/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R4Econ</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository.</p>
</blockquote>
<ul>
<li>r generate text string as csv</li>
<li>r tibble matrix hand input</li>
</ul>
<p>First, we will generate a test score dataset, directly from string. Below we type line by line a dataset with four variables in comma separated (csv) format, where the first row includes the variables names. These texts could be stored in a separate file, or they could be directly included in code and read in as csv</p>
<div id="a-dataset-with-only-two-continuous-variable" class="section level5">
<h5><span class="header-section-number">2.4.1.1.1</span> A Dataset with only Two Continuous Variable</h5>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb172-1" title="1">ar_test_scores_ec3 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">107.72</span>,<span class="fl">101.28</span>,<span class="fl">105.92</span>,<span class="fl">109.31</span>,<span class="fl">104.27</span>,<span class="fl">110.27</span>,<span class="fl">91.92846154</span>,<span class="fl">81.8</span>,<span class="fl">109.0071429</span>,<span class="fl">103.07</span>,<span class="fl">98.97923077</span>,<span class="fl">101.91</span>,<span class="fl">96.49</span>,<span class="fl">97.79923077</span>,<span class="fl">99.07846154</span>,<span class="fl">99.17</span>,<span class="fl">103.51</span>,<span class="fl">112.2225</span>,<span class="fl">101.2964286</span>,<span class="fl">94.5</span>,<span class="fl">98.92</span>,<span class="fl">97.09</span>,<span class="fl">93.83989011</span>,<span class="fl">97.36304945</span>,<span class="fl">80.34</span>,<span class="fl">65.74</span>,<span class="fl">85.275</span>,<span class="fl">82.19708791</span>,<span class="fl">86.53758242</span>,<span class="fl">86.2025</span>,<span class="fl">86.63</span>,<span class="fl">82.57392857</span>,<span class="fl">83.66</span>,<span class="fl">79.76</span>,<span class="fl">75.55642857</span>,<span class="fl">86.32571429</span>,<span class="fl">66.41</span>,<span class="fl">76.06</span>,<span class="fl">44.225</span>,<span class="fl">82.28</span>,<span class="fl">47.77392857</span>,<span class="fl">70.005</span>,<span class="fl">69.13769231</span>,<span class="fl">73.52571429</span>,<span class="fl">60.51</span>,<span class="fl">56.04</span>)</a>
<a class="sourceLine" id="cb172-2" title="2">ar_test_scores_ec1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">101.72</span>,<span class="fl">101.28</span>,<span class="fl">99.92</span>,<span class="fl">103.31</span>,<span class="fl">100.27</span>,<span class="fl">104.27</span>,<span class="fl">90.23615385</span>,<span class="fl">77.8</span>,<span class="fl">103.4357143</span>,<span class="fl">97.07</span>,<span class="fl">93.13307692</span>,<span class="fl">95.91</span>,<span class="fl">92.49</span>,<span class="fl">93.95307692</span>,<span class="fl">95.38615385</span>,<span class="fl">97.17</span>,<span class="fl">99.51</span>,<span class="fl">100.3475</span>,<span class="fl">95.83214286</span>,<span class="fl">92.5</span>,<span class="fl">94.92</span>,<span class="fl">91.09</span>,<span class="fl">90.4332967</span>,<span class="fl">93.52101648</span>,<span class="fl">80.34</span>,<span class="fl">59.74</span>,<span class="fl">79.525</span>,<span class="fl">77.67236264</span>,<span class="fl">81.59252747</span>,<span class="fl">82.3275</span>,<span class="fl">80.63</span>,<span class="fl">76.98464286</span>,<span class="fl">81.66</span>,<span class="fl">79.76</span>,<span class="fl">70.59214286</span>,<span class="fl">82.46857143</span>,<span class="fl">66.41</span>,<span class="fl">74.06</span>,<span class="fl">40.475</span>,<span class="fl">76.28</span>,<span class="fl">44.18464286</span>,<span class="fl">66.255</span>,<span class="fl">65.59923077</span>,<span class="fl">69.66857143</span>,<span class="fl">60.51</span>,<span class="fl">56.04</span>)</a>
<a class="sourceLine" id="cb172-3" title="3">mt_test_scores &lt;-<span class="st"> </span><span class="kw">cbind</span>(ar_test_scores_ec1, ar_test_scores_ec3)</a>
<a class="sourceLine" id="cb172-4" title="4">ar_st_varnames &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;course_total_ec1p&#39;</span>,<span class="st">&#39;course_total_ec3p&#39;</span>)</a>
<a class="sourceLine" id="cb172-5" title="5">tb_final_twovar &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(mt_test_scores) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename_all</span>(<span class="op">~</span><span class="kw">c</span>(ar_st_varnames))</a>
<a class="sourceLine" id="cb172-6" title="6"><span class="kw">summary</span>(tb_final_twovar)</a></code></pre></div>
<pre><code>##  course_total_ec1p course_total_ec3p
##  Min.   : 40.48    Min.   : 44.23   
##  1st Qu.: 76.46    1st Qu.: 79.91   
##  Median : 86.35    Median : 89.28   
##  Mean   : 83.88    Mean   : 87.90   
##  3rd Qu.: 95.89    3rd Qu.:100.75   
##  Max.   :104.27    Max.   :112.22</code></pre>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb174-1" title="1"><span class="kw">ff_summ_percentiles</span>(<span class="dt">df =</span> tb_final_twovar, <span class="dt">bl_statsasrows =</span> <span class="ot">TRUE</span>, <span class="dt">col2varname =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## # A tibble: 17 x 3
##    stats   course.total.ec1p course.total.ec3p
##    &lt;chr&gt;   &lt;chr&gt;             &lt;chr&gt;            
##  1 n       46                46               
##  2 NAobs   0                 0                
##  3 ZEROobs 0                 0                
##  4 mean    83.87572          87.90239         
##  5 sd      15.87272          16.76041         
##  6 cv      0.1892409         0.1906706        
##  7 min     40.475            44.225           
##  8 p01     42.14434          45.82202         
##  9 p05     56.9650           57.1575          
## 10 p10     63.05462          66.07500         
## 11 p25     76.45616          79.90500         
## 12 p50     86.35236          89.27923         
## 13 p75     &quot; 95.89054&quot;       100.75250        
## 14 p90     100.8137          106.8200         
## 15 p95     102.9125          109.2343         
## 16 p99     103.8946          111.3439         
## 17 max     104.2700          112.2225</code></pre>
</div>
<div id="a-dataset-with-one-continuous-variable-and-histogram" class="section level5">
<h5><span class="header-section-number">2.4.1.1.2</span> A Dataset with one Continuous Variable and Histogram</h5>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb176-1" title="1">ar_final_scores &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">94.28442509</span>,<span class="fl">95.68817475</span>,<span class="fl">97.25219512</span>,<span class="fl">77.89268293</span>,<span class="fl">95.08795497</span>,<span class="fl">93.27380863</span>,<span class="fl">92.3</span>,<span class="fl">84.25317073</span>,<span class="fl">86.08642991</span>,<span class="fl">84.69219512</span>,<span class="fl">71.43634146</span>,<span class="fl">76.21365854</span>,<span class="fl">71.68878049</span>,<span class="fl">77.46142589</span>,<span class="fl">79.29579268</span>,<span class="fl">43.7285453</span>,<span class="fl">63.80634146</span>,<span class="fl">67.92994774</span>,<span class="fl">100.8980488</span>,<span class="fl">100.0857143</span>,<span class="fl">99.93073171</span>,<span class="fl">98.4102439</span>,<span class="fl">97.93</span>,<span class="fl">97.10359756</span>,<span class="fl">96.97121951</span>,<span class="fl">96.60292683</span>,<span class="fl">96.23317073</span>,<span class="fl">93.92243902</span>,<span class="fl">93.82243902</span>,<span class="fl">92.75390244</span>,<span class="fl">92.65775261</span>,<span class="fl">92.20444653</span>,<span class="fl">91.73463415</span>,<span class="fl">90.38321161</span>,<span class="fl">89.37414634</span>,<span class="fl">86.95932458</span>,<span class="fl">79.58686411</span>,<span class="fl">78.70878049</span>,<span class="fl">77.2497561</span>,<span class="fl">76.88195122</span>,<span class="fl">76.52987805</span>,<span class="fl">74.72114313</span>,<span class="fl">74.27488676</span>,<span class="fl">71.30268293</span>,<span class="fl">63.70256098</span>,<span class="fl">37.90426829</span>,<span class="fl">2.292682927</span>)</a>
<a class="sourceLine" id="cb176-2" title="2">mt_test_scores &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">seq</span>(<span class="dv">1</span>,<span class="kw">length</span>(ar_final_scores)), ar_final_scores)</a>
<a class="sourceLine" id="cb176-3" title="3">ar_st_varnames &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;index&#39;</span>, <span class="st">&#39;course_final&#39;</span>)</a>
<a class="sourceLine" id="cb176-4" title="4">tb_onevar &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(mt_test_scores) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename_all</span>(<span class="op">~</span><span class="kw">c</span>(ar_st_varnames))</a>
<a class="sourceLine" id="cb176-5" title="5"><span class="kw">summary</span>(tb_onevar)</a></code></pre></div>
<pre><code>##      index       course_final    
##  Min.   : 1.0   Min.   :  2.293  
##  1st Qu.:12.5   1st Qu.: 76.372  
##  Median :24.0   Median : 86.959  
##  Mean   :24.0   Mean   : 82.415  
##  3rd Qu.:35.5   3rd Qu.: 94.686  
##  Max.   :47.0   Max.   :100.898</code></pre>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb178-1" title="1"><span class="kw">ff_summ_percentiles</span>(<span class="dt">df =</span> tb_onevar, <span class="dt">bl_statsasrows =</span> <span class="ot">TRUE</span>, <span class="dt">col2varname =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## # A tibble: 17 x 3
##    stats   course.final index     
##    &lt;chr&gt;   &lt;chr&gt;        &lt;chr&gt;     
##  1 n       47           47        
##  2 NAobs   0            0         
##  3 ZEROobs 0            0         
##  4 mean    82.41501     24.00000  
##  5 sd      18.35476     13.71131  
##  6 cv      0.2227113    0.5713046 
##  7 min     2.292683     1.000000  
##  8 p01     18.67401     &quot; 1.46000&quot;
##  9 p05     49.72075     &quot; 3.30000&quot;
## 10 p10     66.28051     &quot; 5.60000&quot;
## 11 p25     76.37177     12.50000  
## 12 p50     86.95932     24.00000  
## 13 p75     94.68619     35.50000  
## 14 p90     97.52332     42.40000  
## 15 p95     99.47459     44.70000  
## 16 p99     100.5244     &quot; 46.5400&quot;
## 17 max     100.898      &quot; 47.000&quot;</code></pre>
</div>
<div id="a-dataset-with-multiple-variables" class="section level5">
<h5><span class="header-section-number">2.4.1.1.3</span> A Dataset with Multiple Variables</h5>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb180-1" title="1"><span class="co">#load in data empirically by hand</span></a>
<a class="sourceLine" id="cb180-2" title="2">txt_test_data &lt;-<span class="st"> &quot;init_prof, later_prof, class_id, exam_score</span></a>
<a class="sourceLine" id="cb180-3" title="3"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 102</span></a>
<a class="sourceLine" id="cb180-4" title="4"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 102</span></a>
<a class="sourceLine" id="cb180-5" title="5"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 101</span></a>
<a class="sourceLine" id="cb180-6" title="6"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 100</span></a>
<a class="sourceLine" id="cb180-7" title="7"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 100</span></a>
<a class="sourceLine" id="cb180-8" title="8"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 99</span></a>
<a class="sourceLine" id="cb180-9" title="9"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 98.5</span></a>
<a class="sourceLine" id="cb180-10" title="10"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 98.5</span></a>
<a class="sourceLine" id="cb180-11" title="11"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 97</span></a>
<a class="sourceLine" id="cb180-12" title="12"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 95</span></a>
<a class="sourceLine" id="cb180-13" title="13"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 94</span></a>
<a class="sourceLine" id="cb180-14" title="14"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 91</span></a>
<a class="sourceLine" id="cb180-15" title="15"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 91</span></a>
<a class="sourceLine" id="cb180-16" title="16"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 90</span></a>
<a class="sourceLine" id="cb180-17" title="17"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 89</span></a>
<a class="sourceLine" id="cb180-18" title="18"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 88.5</span></a>
<a class="sourceLine" id="cb180-19" title="19"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 88</span></a>
<a class="sourceLine" id="cb180-20" title="20"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 87</span></a>
<a class="sourceLine" id="cb180-21" title="21"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 87</span></a>
<a class="sourceLine" id="cb180-22" title="22"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 87</span></a>
<a class="sourceLine" id="cb180-23" title="23"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 86</span></a>
<a class="sourceLine" id="cb180-24" title="24"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 86</span></a>
<a class="sourceLine" id="cb180-25" title="25"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 84</span></a>
<a class="sourceLine" id="cb180-26" title="26"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 82</span></a>
<a class="sourceLine" id="cb180-27" title="27"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 78.5</span></a>
<a class="sourceLine" id="cb180-28" title="28"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 76</span></a>
<a class="sourceLine" id="cb180-29" title="29"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 72</span></a>
<a class="sourceLine" id="cb180-30" title="30"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 70.5</span></a>
<a class="sourceLine" id="cb180-31" title="31"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 67.5</span></a>
<a class="sourceLine" id="cb180-32" title="32"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 67.5</span></a>
<a class="sourceLine" id="cb180-33" title="33"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 67</span></a>
<a class="sourceLine" id="cb180-34" title="34"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 63.5</span></a>
<a class="sourceLine" id="cb180-35" title="35"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 60</span></a>
<a class="sourceLine" id="cb180-36" title="36"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 59</span></a>
<a class="sourceLine" id="cb180-37" title="37"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 44.5</span></a>
<a class="sourceLine" id="cb180-38" title="38"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 44</span></a>
<a class="sourceLine" id="cb180-39" title="39"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 42.5</span></a>
<a class="sourceLine" id="cb180-40" title="40"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 40.5</span></a>
<a class="sourceLine" id="cb180-41" title="41"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 40.5</span></a>
<a class="sourceLine" id="cb180-42" title="42"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 36.5</span></a>
<a class="sourceLine" id="cb180-43" title="43"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 35.5</span></a>
<a class="sourceLine" id="cb180-44" title="44"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 21.5</span></a>
<a class="sourceLine" id="cb180-45" title="45"><span class="st"> &#39;SW&#39;, &#39;SW&#39;, 1, 4</span></a>
<a class="sourceLine" id="cb180-46" title="46"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 105</span></a>
<a class="sourceLine" id="cb180-47" title="47"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 103</span></a>
<a class="sourceLine" id="cb180-48" title="48"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 102</span></a>
<a class="sourceLine" id="cb180-49" title="49"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 101</span></a>
<a class="sourceLine" id="cb180-50" title="50"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 101</span></a>
<a class="sourceLine" id="cb180-51" title="51"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 100.5</span></a>
<a class="sourceLine" id="cb180-52" title="52"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 100</span></a>
<a class="sourceLine" id="cb180-53" title="53"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 99</span></a>
<a class="sourceLine" id="cb180-54" title="54"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 97</span></a>
<a class="sourceLine" id="cb180-55" title="55"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 97</span></a>
<a class="sourceLine" id="cb180-56" title="56"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 97</span></a>
<a class="sourceLine" id="cb180-57" title="57"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 97</span></a>
<a class="sourceLine" id="cb180-58" title="58"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 96</span></a>
<a class="sourceLine" id="cb180-59" title="59"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 95</span></a>
<a class="sourceLine" id="cb180-60" title="60"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 91</span></a>
<a class="sourceLine" id="cb180-61" title="61"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 89</span></a>
<a class="sourceLine" id="cb180-62" title="62"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 85</span></a>
<a class="sourceLine" id="cb180-63" title="63"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 84</span></a>
<a class="sourceLine" id="cb180-64" title="64"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 84</span></a>
<a class="sourceLine" id="cb180-65" title="65"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 84</span></a>
<a class="sourceLine" id="cb180-66" title="66"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 83.5</span></a>
<a class="sourceLine" id="cb180-67" title="67"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 82.5</span></a>
<a class="sourceLine" id="cb180-68" title="68"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 81.5</span></a>
<a class="sourceLine" id="cb180-69" title="69"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 80.5</span></a>
<a class="sourceLine" id="cb180-70" title="70"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 80</span></a>
<a class="sourceLine" id="cb180-71" title="71"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 77</span></a>
<a class="sourceLine" id="cb180-72" title="72"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 77</span></a>
<a class="sourceLine" id="cb180-73" title="73"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 75</span></a>
<a class="sourceLine" id="cb180-74" title="74"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 75</span></a>
<a class="sourceLine" id="cb180-75" title="75"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 71</span></a>
<a class="sourceLine" id="cb180-76" title="76"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 70</span></a>
<a class="sourceLine" id="cb180-77" title="77"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 68</span></a>
<a class="sourceLine" id="cb180-78" title="78"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 63</span></a>
<a class="sourceLine" id="cb180-79" title="79"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 56</span></a>
<a class="sourceLine" id="cb180-80" title="80"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 56</span></a>
<a class="sourceLine" id="cb180-81" title="81"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 55.5</span></a>
<a class="sourceLine" id="cb180-82" title="82"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 49.5</span></a>
<a class="sourceLine" id="cb180-83" title="83"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 48.5</span></a>
<a class="sourceLine" id="cb180-84" title="84"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 47.5</span></a>
<a class="sourceLine" id="cb180-85" title="85"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 44.5</span></a>
<a class="sourceLine" id="cb180-86" title="86"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 34.5</span></a>
<a class="sourceLine" id="cb180-87" title="87"><span class="st"> &#39;MP&#39;, &#39;MP&#39;, 2, 29.5</span></a>
<a class="sourceLine" id="cb180-88" title="88"><span class="st"> &#39;CA&#39;, &#39;MP&#39;, 3, 103</span></a>
<a class="sourceLine" id="cb180-89" title="89"><span class="st"> &#39;CA&#39;, &#39;MP&#39;, 3, 103</span></a>
<a class="sourceLine" id="cb180-90" title="90"><span class="st"> &#39;CA&#39;, &#39;MP&#39;, 3, 101</span></a>
<a class="sourceLine" id="cb180-91" title="91"><span class="st"> &#39;CA&#39;, &#39;MP&#39;, 3, 96.5</span></a>
<a class="sourceLine" id="cb180-92" title="92"><span class="st"> &#39;CA&#39;, &#39;MP&#39;, 3, 93.5</span></a>
<a class="sourceLine" id="cb180-93" title="93"><span class="st"> &#39;CA&#39;, &#39;MP&#39;, 3, 93</span></a>
<a class="sourceLine" id="cb180-94" title="94"><span class="st"> &#39;CA&#39;, &#39;MP&#39;, 3, 93</span></a>
<a class="sourceLine" id="cb180-95" title="95"><span class="st"> &#39;CA&#39;, &#39;MP&#39;, 3, 92</span></a>
<a class="sourceLine" id="cb180-96" title="96"><span class="st"> &#39;CA&#39;, &#39;MP&#39;, 3, 90</span></a>
<a class="sourceLine" id="cb180-97" title="97"><span class="st"> &#39;CA&#39;, &#39;MP&#39;, 3, 90</span></a>
<a class="sourceLine" id="cb180-98" title="98"><span class="st"> &#39;CA&#39;, &#39;MP&#39;, 3, 89</span></a>
<a class="sourceLine" id="cb180-99" title="99"><span class="st"> &#39;CA&#39;, &#39;MP&#39;, 3, 86.5</span></a>
<a class="sourceLine" id="cb180-100" title="100"><span class="st"> &#39;CA&#39;, &#39;MP&#39;, 3, 84.5</span></a>
<a class="sourceLine" id="cb180-101" title="101"><span class="st"> &#39;CA&#39;, &#39;MP&#39;, 3, 83</span></a>
<a class="sourceLine" id="cb180-102" title="102"><span class="st"> &#39;CA&#39;, &#39;MP&#39;, 3, 83</span></a>
<a class="sourceLine" id="cb180-103" title="103"><span class="st"> &#39;CA&#39;, &#39;MP&#39;, 3, 82</span></a>
<a class="sourceLine" id="cb180-104" title="104"><span class="st"> &#39;CA&#39;, &#39;MP&#39;, 3, 78</span></a>
<a class="sourceLine" id="cb180-105" title="105"><span class="st"> &#39;CA&#39;, &#39;MP&#39;, 3, 75</span></a>
<a class="sourceLine" id="cb180-106" title="106"><span class="st"> &#39;CA&#39;, &#39;MP&#39;, 3, 74.5</span></a>
<a class="sourceLine" id="cb180-107" title="107"><span class="st"> &#39;CA&#39;, &#39;MP&#39;, 3, 70</span></a>
<a class="sourceLine" id="cb180-108" title="108"><span class="st"> &#39;CA&#39;, &#39;MP&#39;, 3, 54.5</span></a>
<a class="sourceLine" id="cb180-109" title="109"><span class="st"> &#39;CA&#39;, &#39;MP&#39;, 3, 52</span></a>
<a class="sourceLine" id="cb180-110" title="110"><span class="st"> &#39;CA&#39;, &#39;MP&#39;, 3, 50</span></a>
<a class="sourceLine" id="cb180-111" title="111"><span class="st"> &#39;CA&#39;, &#39;MP&#39;, 3, 42</span></a>
<a class="sourceLine" id="cb180-112" title="112"><span class="st"> &#39;CA&#39;, &#39;MP&#39;, 3, 36.5</span></a>
<a class="sourceLine" id="cb180-113" title="113"><span class="st"> &#39;CA&#39;, &#39;MP&#39;, 3, 28</span></a>
<a class="sourceLine" id="cb180-114" title="114"><span class="st"> &#39;CA&#39;, &#39;MP&#39;, 3, 26</span></a>
<a class="sourceLine" id="cb180-115" title="115"><span class="st"> &#39;CA&#39;, &#39;MP&#39;, 3, 11</span></a>
<a class="sourceLine" id="cb180-116" title="116"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 103</span></a>
<a class="sourceLine" id="cb180-117" title="117"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 103</span></a>
<a class="sourceLine" id="cb180-118" title="118"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 102</span></a>
<a class="sourceLine" id="cb180-119" title="119"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 102</span></a>
<a class="sourceLine" id="cb180-120" title="120"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 101</span></a>
<a class="sourceLine" id="cb180-121" title="121"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 100</span></a>
<a class="sourceLine" id="cb180-122" title="122"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 98</span></a>
<a class="sourceLine" id="cb180-123" title="123"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 98</span></a>
<a class="sourceLine" id="cb180-124" title="124"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 98</span></a>
<a class="sourceLine" id="cb180-125" title="125"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 95</span></a>
<a class="sourceLine" id="cb180-126" title="126"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 95</span></a>
<a class="sourceLine" id="cb180-127" title="127"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 92.5</span></a>
<a class="sourceLine" id="cb180-128" title="128"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 92</span></a>
<a class="sourceLine" id="cb180-129" title="129"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 91</span></a>
<a class="sourceLine" id="cb180-130" title="130"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 90</span></a>
<a class="sourceLine" id="cb180-131" title="131"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 85.5</span></a>
<a class="sourceLine" id="cb180-132" title="132"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 84</span></a>
<a class="sourceLine" id="cb180-133" title="133"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 82.5</span></a>
<a class="sourceLine" id="cb180-134" title="134"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 81</span></a>
<a class="sourceLine" id="cb180-135" title="135"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 77.5</span></a>
<a class="sourceLine" id="cb180-136" title="136"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 77</span></a>
<a class="sourceLine" id="cb180-137" title="137"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 72</span></a>
<a class="sourceLine" id="cb180-138" title="138"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 71.5</span></a>
<a class="sourceLine" id="cb180-139" title="139"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 69</span></a>
<a class="sourceLine" id="cb180-140" title="140"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 68.5</span></a>
<a class="sourceLine" id="cb180-141" title="141"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 68</span></a>
<a class="sourceLine" id="cb180-142" title="142"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 67</span></a>
<a class="sourceLine" id="cb180-143" title="143"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 65.5</span></a>
<a class="sourceLine" id="cb180-144" title="144"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 62.5</span></a>
<a class="sourceLine" id="cb180-145" title="145"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 62</span></a>
<a class="sourceLine" id="cb180-146" title="146"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 61.5</span></a>
<a class="sourceLine" id="cb180-147" title="147"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 61</span></a>
<a class="sourceLine" id="cb180-148" title="148"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 57.5</span></a>
<a class="sourceLine" id="cb180-149" title="149"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 54</span></a>
<a class="sourceLine" id="cb180-150" title="150"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 52.5</span></a>
<a class="sourceLine" id="cb180-151" title="151"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 51</span></a>
<a class="sourceLine" id="cb180-152" title="152"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 50.5</span></a>
<a class="sourceLine" id="cb180-153" title="153"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 50</span></a>
<a class="sourceLine" id="cb180-154" title="154"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 49</span></a>
<a class="sourceLine" id="cb180-155" title="155"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 43</span></a>
<a class="sourceLine" id="cb180-156" title="156"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 39.5</span></a>
<a class="sourceLine" id="cb180-157" title="157"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 32.5</span></a>
<a class="sourceLine" id="cb180-158" title="158"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 25.5</span></a>
<a class="sourceLine" id="cb180-159" title="159"><span class="st"> &#39;CA&#39;, &#39;SN&#39;, 4, 18&quot;</span></a>
<a class="sourceLine" id="cb180-160" title="160"></a>
<a class="sourceLine" id="cb180-161" title="161">csv_test_data =<span class="st"> </span><span class="kw">read.csv</span>(<span class="dt">text=</span>txt_test_data, <span class="dt">header=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb180-162" title="162">ar_st_varnames &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;first_half_professor&#39;</span>, <span class="st">&#39;second_half_professor&#39;</span>, <span class="st">&#39;course_id&#39;</span>, <span class="st">&#39;exam_score&#39;</span>)</a>
<a class="sourceLine" id="cb180-163" title="163">tb_test_data &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(csv_test_data) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename_all</span>(<span class="op">~</span><span class="kw">c</span>(ar_st_varnames))</a>
<a class="sourceLine" id="cb180-164" title="164"><span class="kw">summary</span>(tb_test_data)</a></code></pre></div>
<pre><code>##  first_half_professor second_half_professor   course_id       exam_score    
##   &#39;CA&#39;:72              &#39;MP&#39;:70              Min.   :1.000   Min.   :  4.00  
##   &#39;MP&#39;:42              &#39;SN&#39;:44              1st Qu.:1.000   1st Qu.: 60.00  
##   &#39;SW&#39;:43              &#39;SW&#39;:43              Median :2.000   Median : 82.00  
##                                             Mean   :2.465   Mean   : 75.08  
##                                             3rd Qu.:4.000   3rd Qu.: 94.00  
##                                             Max.   :4.000   Max.   :105.00</code></pre>
</div>
</div>
<div id="test-score-distributions" class="section level4">
<h4><span class="header-section-number">2.4.1.2</span> Test Score Distributions</h4>
<div id="histogram-1" class="section level5">
<h5><span class="header-section-number">2.4.1.2.1</span> Histogram</h5>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb182-1" title="1"><span class="kw">ggplot</span>(tb_final_twovar, <span class="kw">aes</span>(<span class="dt">x=</span>ar_test_scores_ec3)) <span class="op">+</span></a>
<a class="sourceLine" id="cb182-2" title="2"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">bins=</span><span class="dv">25</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb182-3" title="3"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="kw">paste0</span>(<span class="st">&#39;Sandbox: Final Distribution (Econ 2370, FW)&#39;</span>),</a>
<a class="sourceLine" id="cb182-4" title="4">       <span class="dt">caption =</span> <span class="st">&#39;FW Section, formula: 0.3*exam1Perc + 0.3*exam2Perc + 0.42*HWtotalPerc + 0.03*AttendancePerc </span><span class="ch">\n</span><span class="st">+ perfect attendance + 0.03 per Extra Credit&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb182-5" title="5"><span class="st">  </span><span class="kw">theme_bw</span>()</a></code></pre></div>
<p><img src="Panel-Data-and-Optimization-with-R_files/figure-html/unnamed-chunk-60-1.png" width="672" /></p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb183-1" title="1"><span class="kw">ggplot</span>(tb_test_data, <span class="kw">aes</span>(<span class="dt">x=</span>exam_score)) <span class="op">+</span></a>
<a class="sourceLine" id="cb183-2" title="2"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">bins=</span><span class="dv">16</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb183-3" title="3"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="kw">paste0</span>(<span class="st">&#39;Exam Distribution&#39;</span>),</a>
<a class="sourceLine" id="cb183-4" title="4">       <span class="dt">caption =</span> <span class="st">&#39;All Sections&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb183-5" title="5"><span class="st">  </span><span class="kw">theme_bw</span>()</a></code></pre></div>
<p><img src="Panel-Data-and-Optimization-with-R_files/figure-html/unnamed-chunk-61-1.png" width="672" /></p>

</div>
</div>
</div>
<div id="joint-quantiles-from-continuous" class="section level3">
<h3><span class="header-section-number">2.4.2</span> Joint Quantiles from Continuous</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/CodeDynaAsset/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R4Econ</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository.</p>
</blockquote>
<p>There are multiple or a single continuous variables. Find which quantile each observation belongs to for each of the variables. Then also generate a joint/interaction variable of all combinations of quantiles from different variables.</p>
<p>The program has these features:</p>
<ol style="list-style-type: decimal">
<li>Quantiles breaks are generated based on group_by characteristics, meaning quantiles for individual level characteristics when data is panel</li>
<li>Quantiles variables apply to full panel at within-group observation levels.</li>
<li>Robust to non-unique breaks for quantiles (non-unique grouped together)</li>
<li>Quantile categories have detailed labeling (specifying which non-unique groupings belong to quantile)</li>
</ol>
<p>When joining multiple quantile variables together:</p>
<ol style="list-style-type: decimal">
<li>First check if only calculate quantiles at observations where all quantile base variables are not null</li>
<li>Calculate Quantiles for each variable, with different quantile levels for sub-groups of variables</li>
<li>Summary statistics by mulltiple quantile-categorical variables, summary</li>
</ol>
<div id="build-program-1" class="section level4">
<h4><span class="header-section-number">2.4.2.1</span> Build Program</h4>
<div id="support-functions" class="section level5">
<h5><span class="header-section-number">2.4.2.1.1</span> Support Functions</h5>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb184-1" title="1"><span class="co"># Quantiles for any variable</span></a>
<a class="sourceLine" id="cb184-2" title="2">gen_quantiles &lt;-<span class="st"> </span><span class="cf">function</span>(var, df, <span class="dt">prob=</span><span class="kw">c</span>(<span class="fl">0.25</span>, <span class="fl">0.50</span>, <span class="fl">0.75</span>)) {</a>
<a class="sourceLine" id="cb184-3" title="3">    <span class="kw">enframe</span>(<span class="kw">quantile</span>(<span class="kw">as.numeric</span>(df[[var]]), prob, <span class="dt">na.rm=</span><span class="ot">TRUE</span>), <span class="st">&#39;quant.perc&#39;</span>, var)</a>
<a class="sourceLine" id="cb184-4" title="4">}</a>
<a class="sourceLine" id="cb184-5" title="5"><span class="co"># Support Functions for Variable Suffix</span></a>
<a class="sourceLine" id="cb184-6" title="6">f_Q_suffix &lt;-<span class="st"> </span><span class="cf">function</span>(seq.quantiles) {</a>
<a class="sourceLine" id="cb184-7" title="7">    quantile.suffix &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&#39;Qs&#39;</span>, <span class="kw">min</span>(seq.quantiles),</a>
<a class="sourceLine" id="cb184-8" title="8">                              <span class="st">&#39;e&#39;</span>, <span class="kw">max</span>(seq.quantiles),</a>
<a class="sourceLine" id="cb184-9" title="9">                              <span class="st">&#39;n&#39;</span>, (<span class="kw">length</span>(seq.quantiles)<span class="op">-</span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb184-10" title="10">}</a>
<a class="sourceLine" id="cb184-11" title="11"><span class="co"># Support Functions for Quantile Labeling</span></a>
<a class="sourceLine" id="cb184-12" title="12">f_Q_label &lt;-<span class="st"> </span><span class="cf">function</span>(arr.quantiles,</a>
<a class="sourceLine" id="cb184-13" title="13">                      arr.sort.unique.quantile,</a>
<a class="sourceLine" id="cb184-14" title="14">                      seq.quantiles) {</a>
<a class="sourceLine" id="cb184-15" title="15">    <span class="kw">paste0</span>(<span class="st">&#39;(&#39;</span>,</a>
<a class="sourceLine" id="cb184-16" title="16">           <span class="kw">paste0</span>(<span class="kw">which</span>(arr.quantiles <span class="op">%in%</span><span class="st"> </span>arr.sort.unique.quantile), <span class="dt">collapse=</span><span class="st">&#39;,&#39;</span>),</a>
<a class="sourceLine" id="cb184-17" title="17">           <span class="st">&#39;) of &#39;</span>, <span class="kw">f_Q_suffix</span>(seq.quantiles))</a>
<a class="sourceLine" id="cb184-18" title="18">}</a>
<a class="sourceLine" id="cb184-19" title="19"><span class="co"># Generate New Variable Names with Quantile Suffix</span></a>
<a class="sourceLine" id="cb184-20" title="20">f_var_rename &lt;-<span class="st"> </span><span class="cf">function</span>(name, seq.quantiles) {</a>
<a class="sourceLine" id="cb184-21" title="21">    quantile.suffix &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&#39;_&#39;</span>, <span class="kw">f_Q_suffix</span>(seq.quantiles))</a>
<a class="sourceLine" id="cb184-22" title="22">    <span class="kw">return</span>(<span class="kw">sub</span>(<span class="st">&#39;_q&#39;</span>, quantile.suffix, name))</a>
<a class="sourceLine" id="cb184-23" title="23">}</a>
<a class="sourceLine" id="cb184-24" title="24"></a>
<a class="sourceLine" id="cb184-25" title="25"><span class="co"># Check Are Values within Group By Unique? If not, STOP</span></a>
<a class="sourceLine" id="cb184-26" title="26">f_check_distinct_ingroup &lt;-<span class="st"> </span><span class="cf">function</span>(df, vars.group_by, vars.values_in_group) {</a>
<a class="sourceLine" id="cb184-27" title="27"></a>
<a class="sourceLine" id="cb184-28" title="28">    df.uniqus.in.group &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(<span class="op">!!!</span><span class="kw">syms</span>(vars.group_by)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb184-29" title="29"><span class="st">            </span><span class="kw">mutate</span>(<span class="dt">quant_vars_paste =</span> <span class="kw">paste</span>(<span class="op">!!!</span>(<span class="kw">syms</span>(vars.values_in_group)), <span class="dt">sep=</span><span class="st">&#39;-&#39;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb184-30" title="30"><span class="st">            </span><span class="kw">mutate</span>(<span class="dt">unique_in_group =</span> <span class="kw">n_distinct</span>(quant_vars_paste)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb184-31" title="31"><span class="st">            </span><span class="kw">slice</span>(1L) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb184-32" title="32"><span class="st">            </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb184-33" title="33"><span class="st">            </span><span class="kw">group_by</span>(unique_in_group) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb184-34" title="34"><span class="st">            </span><span class="kw">summarise</span>(<span class="dt">n=</span><span class="kw">n</span>())</a>
<a class="sourceLine" id="cb184-35" title="35"></a>
<a class="sourceLine" id="cb184-36" title="36">    <span class="cf">if</span> (<span class="kw">sum</span>(df.uniqus.in.group<span class="op">$</span>unique_in_group) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb184-37" title="37">        <span class="kw">print</span>(df.uniqus.in.group)</a>
<a class="sourceLine" id="cb184-38" title="38">        <span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&#39;vars.values_in_group&#39;</span>, vars.values_in_group, <span class="dt">sep=</span><span class="st">&#39;:&#39;</span>))</a>
<a class="sourceLine" id="cb184-39" title="39">        <span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&#39;vars.group_by&#39;</span>, vars.group_by, <span class="dt">sep=</span><span class="st">&#39;:&#39;</span>))</a>
<a class="sourceLine" id="cb184-40" title="40">        <span class="kw">stop</span>(<span class="st">&quot;The variables for which quantiles are to be taken are not identical within the group variables&quot;</span>)</a>
<a class="sourceLine" id="cb184-41" title="41">    }</a>
<a class="sourceLine" id="cb184-42" title="42">}</a></code></pre></div>
</div>
<div id="data-slicing-and-quantile-generation" class="section level5">
<h5><span class="header-section-number">2.4.2.1.2</span> Data Slicing and Quantile Generation</h5>
<ul>
<li>Function 1: generate quantiles based on group-specific characteristics. the groups could be at the panel observation level as well.</li>
</ul>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb185-1" title="1"><span class="co"># First Step, given groups, generate quantiles based on group characteristics</span></a>
<a class="sourceLine" id="cb185-2" title="2"><span class="co"># vars.cts2quantile &lt;- c(&#39;wealthIdx&#39;, &#39;hgt0&#39;, &#39;wgt0&#39;)</span></a>
<a class="sourceLine" id="cb185-3" title="3"><span class="co"># seq.quantiles &lt;- c(0, 0.3333, 0.6666, 1.0)</span></a>
<a class="sourceLine" id="cb185-4" title="4"><span class="co"># vars.group_by &lt;- c(&#39;indi.id&#39;)</span></a>
<a class="sourceLine" id="cb185-5" title="5"><span class="co"># vars.arrange &lt;- c(&#39;indi.id&#39;, &#39;svymthRound&#39;)</span></a>
<a class="sourceLine" id="cb185-6" title="6"><span class="co"># vars.continuous &lt;- c(&#39;wealthIdx&#39;, &#39;hgt0&#39;, &#39;wgt0&#39;)</span></a>
<a class="sourceLine" id="cb185-7" title="7">df_sliced_quantiles &lt;-<span class="st"> </span><span class="cf">function</span>(df, vars.cts2quantile, seq.quantiles,</a>
<a class="sourceLine" id="cb185-8" title="8">                                vars.group_by, vars.arrange) {</a>
<a class="sourceLine" id="cb185-9" title="9"></a>
<a class="sourceLine" id="cb185-10" title="10">    <span class="co"># Slicing data</span></a>
<a class="sourceLine" id="cb185-11" title="11">    df.grp.L1 &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(<span class="op">!!!</span><span class="kw">syms</span>(vars.group_by)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="op">!!!</span><span class="kw">syms</span>(vars.arrange)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">slice</span>(1L) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb185-12" title="12"></a>
<a class="sourceLine" id="cb185-13" title="13">    <span class="co"># Quantiles based on sliced data</span></a>
<a class="sourceLine" id="cb185-14" title="14">    df.sliced.quantiles &lt;-<span class="st"> </span><span class="kw">lapply</span>(vars.cts2quantile, gen_quantiles, <span class="dt">df=</span>df.grp.L1, <span class="dt">prob=</span>seq.quantiles) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">reduce</span>(full_join)</a>
<a class="sourceLine" id="cb185-15" title="15"></a>
<a class="sourceLine" id="cb185-16" title="16">    <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">df.sliced.quantiles=</span>df.sliced.quantiles,</a>
<a class="sourceLine" id="cb185-17" title="17">                <span class="dt">df.grp.L1=</span>df.grp.L1))</a>
<a class="sourceLine" id="cb185-18" title="18">}</a></code></pre></div>
</div>
<div id="data-cutting" class="section level5">
<h5><span class="header-section-number">2.4.2.1.3</span> Data Cutting</h5>
<ul>
<li>Function 2: cut groups for full panel dataframe based on group-specific characteristics quantiles.</li>
</ul>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb186-1" title="1"><span class="co"># Cutting Function, Cut Continuous Variables into Quantiles with labeing</span></a>
<a class="sourceLine" id="cb186-2" title="2">f_cut &lt;-<span class="st"> </span><span class="cf">function</span>(var, df.sliced.quantiles, seq.quantiles, <span class="dt">include.lowest=</span><span class="ot">TRUE</span>, <span class="dt">fan.labels=</span><span class="ot">TRUE</span>, <span class="dt">print=</span><span class="ot">FALSE</span>) {</a>
<a class="sourceLine" id="cb186-3" title="3"></a>
<a class="sourceLine" id="cb186-4" title="4">    <span class="co"># unparsed string variable name</span></a>
<a class="sourceLine" id="cb186-5" title="5">    var.str &lt;-<span class="st"> </span><span class="kw">substitute</span>(var)</a>
<a class="sourceLine" id="cb186-6" title="6"></a>
<a class="sourceLine" id="cb186-7" title="7">    <span class="co"># Breaks</span></a>
<a class="sourceLine" id="cb186-8" title="8">    arr.quantiles &lt;-<span class="st"> </span>df.sliced.quantiles[[var.str]]</a>
<a class="sourceLine" id="cb186-9" title="9">    arr.sort.unique.quantiles &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">unique</span>(arr.quantiles))</a>
<a class="sourceLine" id="cb186-10" title="10">    <span class="cf">if</span> (print) {</a>
<a class="sourceLine" id="cb186-11" title="11">        <span class="kw">print</span>(arr.sort.unique.quantiles)</a>
<a class="sourceLine" id="cb186-12" title="12">    }</a>
<a class="sourceLine" id="cb186-13" title="13"></a>
<a class="sourceLine" id="cb186-14" title="14">    <span class="co"># Regular cutting With Standard Labels</span></a>
<a class="sourceLine" id="cb186-15" title="15">    <span class="co"># TRUE, means the lowest group has closed bracket left and right</span></a>
<a class="sourceLine" id="cb186-16" title="16">    var.quantile &lt;-<span class="st"> </span><span class="kw">cut</span>(var, <span class="dt">breaks=</span>arr.sort.unique.quantiles, <span class="dt">include.lowest=</span>include.lowest)</a>
<a class="sourceLine" id="cb186-17" title="17"></a>
<a class="sourceLine" id="cb186-18" title="18">    <span class="co"># Use my custom labels</span></a>
<a class="sourceLine" id="cb186-19" title="19">    <span class="cf">if</span> (fan.labels) {</a>
<a class="sourceLine" id="cb186-20" title="20">        levels.suffix &lt;-<span class="st"> </span><span class="kw">lapply</span>(arr.sort.unique.quantiles[<span class="dv">1</span><span class="op">:</span>(<span class="kw">length</span>(arr.sort.unique.quantiles)<span class="op">-</span><span class="dv">1</span>)],</a>
<a class="sourceLine" id="cb186-21" title="21">                                f_Q_label,</a>
<a class="sourceLine" id="cb186-22" title="22">                                <span class="dt">arr.quantiles=</span>arr.quantiles,</a>
<a class="sourceLine" id="cb186-23" title="23">                                <span class="dt">seq.quantiles=</span>seq.quantiles)</a>
<a class="sourceLine" id="cb186-24" title="24">        <span class="cf">if</span> (print) {</a>
<a class="sourceLine" id="cb186-25" title="25">            <span class="kw">print</span>(levels.suffix)</a>
<a class="sourceLine" id="cb186-26" title="26">        }</a>
<a class="sourceLine" id="cb186-27" title="27">        <span class="kw">levels</span>(var.quantile) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="kw">levels</span>(var.quantile), <span class="st">&#39;; &#39;</span>, levels.suffix)</a>
<a class="sourceLine" id="cb186-28" title="28">    }</a>
<a class="sourceLine" id="cb186-29" title="29"></a>
<a class="sourceLine" id="cb186-30" title="30">    <span class="co"># Return</span></a>
<a class="sourceLine" id="cb186-31" title="31">    <span class="kw">return</span>(var.quantile)</a>
<a class="sourceLine" id="cb186-32" title="32">}</a></code></pre></div>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb187-1" title="1"><span class="co"># Combo Quantile Function</span></a>
<a class="sourceLine" id="cb187-2" title="2"><span class="co"># vars.cts2quantile &lt;- c(&#39;wealthIdx&#39;, &#39;hgt0&#39;, &#39;wgt0&#39;)</span></a>
<a class="sourceLine" id="cb187-3" title="3"><span class="co"># seq.quantiles &lt;- c(0, 0.3333, 0.6666, 1.0)</span></a>
<a class="sourceLine" id="cb187-4" title="4"><span class="co"># vars.group_by &lt;- c(&#39;indi.id&#39;)</span></a>
<a class="sourceLine" id="cb187-5" title="5"><span class="co"># vars.arrange &lt;- c(&#39;indi.id&#39;, &#39;svymthRound&#39;)</span></a>
<a class="sourceLine" id="cb187-6" title="6"><span class="co"># vars.continuous &lt;- c(&#39;wealthIdx&#39;, &#39;hgt0&#39;, &#39;wgt0&#39;)</span></a>
<a class="sourceLine" id="cb187-7" title="7">df_cut_by_sliced_quantiles &lt;-<span class="st"> </span><span class="cf">function</span>(df, vars.cts2quantile, seq.quantiles,</a>
<a class="sourceLine" id="cb187-8" title="8">                                       vars.group_by, vars.arrange) {</a>
<a class="sourceLine" id="cb187-9" title="9"></a>
<a class="sourceLine" id="cb187-10" title="10">    <span class="co"># Check Are Values within Group By Unique? If not, STOP</span></a>
<a class="sourceLine" id="cb187-11" title="11">    <span class="kw">f_check_distinct_ingroup</span>(df, vars.group_by, <span class="dt">vars.values_in_group=</span>vars.cts2quantile)</a>
<a class="sourceLine" id="cb187-12" title="12"></a>
<a class="sourceLine" id="cb187-13" title="13">    <span class="co"># First Step Slicing</span></a>
<a class="sourceLine" id="cb187-14" title="14">    df.sliced &lt;-<span class="st"> </span><span class="kw">df_sliced_quantiles</span>(df, vars.cts2quantile, seq.quantiles, vars.group_by, vars.arrange)</a>
<a class="sourceLine" id="cb187-15" title="15"></a>
<a class="sourceLine" id="cb187-16" title="16">    <span class="co"># Second Step Generate Categorical Variables of Quantiles</span></a>
<a class="sourceLine" id="cb187-17" title="17">    df.with.cut.quant &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate_at</span>(vars.cts2quantile,</a>
<a class="sourceLine" id="cb187-18" title="18">                               <span class="kw">funs</span>(<span class="dt">q=</span><span class="kw">f_cut</span>(., df.sliced<span class="op">$</span>df.sliced.quantiles,</a>
<a class="sourceLine" id="cb187-19" title="19">                                            <span class="dt">seq.quantiles=</span>seq.quantiles,</a>
<a class="sourceLine" id="cb187-20" title="20">                                            <span class="dt">include.lowest=</span><span class="ot">TRUE</span>, <span class="dt">fan.labels=</span><span class="ot">TRUE</span>)))</a>
<a class="sourceLine" id="cb187-21" title="21"></a>
<a class="sourceLine" id="cb187-22" title="22">    <span class="cf">if</span> (<span class="kw">length</span>(vars.cts2quantile) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb187-23" title="23">        df.with.cut.quant &lt;-<span class="st"> </span>df.with.cut.quant <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb187-24" title="24"><span class="st">                              </span><span class="kw">rename_at</span>(<span class="kw">vars</span>(<span class="kw">contains</span>(<span class="st">&#39;_q&#39;</span>)),</a>
<a class="sourceLine" id="cb187-25" title="25">                                        <span class="kw">funs</span>(<span class="kw">f_var_rename</span>(., <span class="dt">seq.quantiles=</span>seq.quantiles)))</a>
<a class="sourceLine" id="cb187-26" title="26">    } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb187-27" title="27">        new.var.name &lt;-<span class="st"> </span><span class="kw">paste0</span>(vars.cts2quantile[<span class="dv">1</span>], <span class="st">&#39;_&#39;</span>, <span class="kw">f_Q_suffix</span>(seq.quantiles))</a>
<a class="sourceLine" id="cb187-28" title="28">        df.with.cut.quant &lt;-<span class="st"> </span>df.with.cut.quant <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="op">!!</span><span class="dt">new.var.name :=</span> q)</a>
<a class="sourceLine" id="cb187-29" title="29">    }</a>
<a class="sourceLine" id="cb187-30" title="30"></a>
<a class="sourceLine" id="cb187-31" title="31">    <span class="co"># Newly Generated Quantile-Cut Variables</span></a>
<a class="sourceLine" id="cb187-32" title="32">    vars.quantile.cut &lt;-<span class="st"> </span>df.with.cut.quant <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb187-33" title="33"><span class="st">                </span><span class="kw">select</span>(<span class="kw">matches</span>(<span class="kw">paste0</span>(vars.cts2quantile, <span class="dt">collapse=</span><span class="st">&#39;|&#39;</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb187-34" title="34"><span class="st">                </span><span class="kw">select</span>(<span class="kw">matches</span>(<span class="kw">f_Q_suffix</span>(seq.quantiles)))</a>
<a class="sourceLine" id="cb187-35" title="35"></a>
<a class="sourceLine" id="cb187-36" title="36">    <span class="co"># Return</span></a>
<a class="sourceLine" id="cb187-37" title="37">    <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">df.with.cut.quant =</span> df.with.cut.quant,</a>
<a class="sourceLine" id="cb187-38" title="38">                <span class="dt">df.sliced.quantiles=</span>df.sliced<span class="op">$</span>df.sliced.quantiles,</a>
<a class="sourceLine" id="cb187-39" title="39">                <span class="dt">df.grp.L1=</span>df.sliced<span class="op">$</span>df.grp.L1,</a>
<a class="sourceLine" id="cb187-40" title="40">                <span class="dt">vars.quantile.cut=</span>vars.quantile.cut))</a>
<a class="sourceLine" id="cb187-41" title="41"></a>
<a class="sourceLine" id="cb187-42" title="42">}</a></code></pre></div>
</div>
<div id="different-vars-different-probabilities-joint-quantiles" class="section level5">
<h5><span class="header-section-number">2.4.2.1.4</span> Different Vars Different Probabilities Joint Quantiles</h5>
<ul>
<li>Accomondate multiple continuousv ariables</li>
<li>Different percentiles</li>
<li>list of lists</li>
<li>generate joint categorical variables</li>
<li>keep only values that exist for all quantile base vars</li>
</ul>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb188-1" title="1"><span class="co"># Function to handle list inputs with different quantiles vars and probabilities</span></a>
<a class="sourceLine" id="cb188-2" title="2">df_cut_by_sliced_quantiles_grps &lt;-<span class="st"> </span><span class="cf">function</span>(quantile.grp.list, df, vars.group_by, vars.arrange) {</a>
<a class="sourceLine" id="cb188-3" title="3">   vars.cts2quantile &lt;-<span class="st"> </span>quantile.grp.list<span class="op">$</span>vars</a>
<a class="sourceLine" id="cb188-4" title="4">   seq.quantiles &lt;-<span class="st"> </span>quantile.grp.list<span class="op">$</span>prob</a>
<a class="sourceLine" id="cb188-5" title="5">   <span class="kw">return</span>(<span class="kw">df_cut_by_sliced_quantiles</span>(df, vars.cts2quantile, seq.quantiles, vars.group_by, vars.arrange))</a>
<a class="sourceLine" id="cb188-6" title="6">}</a>
<a class="sourceLine" id="cb188-7" title="7"><span class="co"># Show Results</span></a>
<a class="sourceLine" id="cb188-8" title="8">df_cut_by_sliced_quantiles_joint_results_grped &lt;-<span class="st"> </span><span class="cf">function</span>(df.with.cut.quant.all, vars.cts2quantile, vars.group_by, vars.arrange,</a>
<a class="sourceLine" id="cb188-9" title="9">                                                           vars.quantile.cut.all, var.qjnt.grp.idx) {</a>
<a class="sourceLine" id="cb188-10" title="10">    <span class="co"># Show ALL</span></a>
<a class="sourceLine" id="cb188-11" title="11">    df.group.panel.cnt.mean &lt;-<span class="st"> </span>df.with.cut.quant.all <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(<span class="op">!!!</span><span class="kw">syms</span>(vars.quantile.cut.all), <span class="op">!!</span><span class="kw">sym</span>(var.qjnt.grp.idx)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-12" title="12"><span class="st">            </span><span class="kw">summarise_at</span>(vars.cts2quantile, <span class="kw">funs</span>(mean, <span class="kw">n</span>()))</a>
<a class="sourceLine" id="cb188-13" title="13"></a>
<a class="sourceLine" id="cb188-14" title="14">    <span class="co"># Show Based on SLicing first</span></a>
<a class="sourceLine" id="cb188-15" title="15">    df.group.slice1.cnt.mean &lt;-<span class="st"> </span>df.with.cut.quant.all <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(<span class="op">!!!</span><span class="kw">syms</span>(vars.group_by)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="op">!!!</span><span class="kw">syms</span>(vars.arrange)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">slice</span>(1L) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-16" title="16"><span class="st">            </span><span class="kw">group_by</span>(<span class="op">!!!</span><span class="kw">syms</span>(vars.quantile.cut.all), <span class="op">!!</span><span class="kw">sym</span>(var.qjnt.grp.idx)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-17" title="17"><span class="st">            </span><span class="kw">summarise_at</span>(vars.cts2quantile, <span class="kw">funs</span>(mean, <span class="kw">n</span>()))</a>
<a class="sourceLine" id="cb188-18" title="18"></a>
<a class="sourceLine" id="cb188-19" title="19">    <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">df.group.panel.cnt.mean=</span>df.group.panel.cnt.mean,</a>
<a class="sourceLine" id="cb188-20" title="20">                <span class="dt">df.group.slice1.cnt.mean=</span>df.group.slice1.cnt.mean))</a>
<a class="sourceLine" id="cb188-21" title="21">}</a></code></pre></div>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb189-1" title="1"><span class="co"># # Joint Quantile Group Name</span></a>
<a class="sourceLine" id="cb189-2" title="2"><span class="co"># var.qjnt.grp.idx &lt;- &#39;group.index&#39;</span></a>
<a class="sourceLine" id="cb189-3" title="3"><span class="co"># # Generate Categorical Variables of Quantiles</span></a>
<a class="sourceLine" id="cb189-4" title="4"><span class="co"># vars.group_by &lt;- c(&#39;indi.id&#39;)</span></a>
<a class="sourceLine" id="cb189-5" title="5"><span class="co"># vars.arrange &lt;- c(&#39;indi.id&#39;, &#39;svymthRound&#39;)</span></a>
<a class="sourceLine" id="cb189-6" title="6"><span class="co"># # Quantile Variables and Quantiles</span></a>
<a class="sourceLine" id="cb189-7" title="7"><span class="co"># vars.cts2quantile.wealth &lt;- c(&#39;wealthIdx&#39;)</span></a>
<a class="sourceLine" id="cb189-8" title="8"><span class="co"># seq.quantiles.wealth &lt;- c(0, .5, 1.0)</span></a>
<a class="sourceLine" id="cb189-9" title="9"><span class="co"># vars.cts2quantile.wgthgt &lt;- c(&#39;hgt0&#39;, &#39;wgt0&#39;)</span></a>
<a class="sourceLine" id="cb189-10" title="10"><span class="co"># seq.quantiles.wgthgt &lt;- c(0, .3333, 0.6666, 1.0)</span></a>
<a class="sourceLine" id="cb189-11" title="11"><span class="co"># drop.any.quantile.na &lt;- TRUE</span></a>
<a class="sourceLine" id="cb189-12" title="12"><span class="co"># # collect to list</span></a>
<a class="sourceLine" id="cb189-13" title="13"><span class="co"># list.cts2quantile &lt;- list(list(vars=vars.cts2quantile.wealth,</span></a>
<a class="sourceLine" id="cb189-14" title="14"><span class="co">#                                prob=seq.quantiles.wealth),</span></a>
<a class="sourceLine" id="cb189-15" title="15"><span class="co">#                           list(vars=vars.cts2quantile.wgthgt,</span></a>
<a class="sourceLine" id="cb189-16" title="16"><span class="co">#                                prob=seq.quantiles.wgthgt))</span></a>
<a class="sourceLine" id="cb189-17" title="17"></a>
<a class="sourceLine" id="cb189-18" title="18">df_cut_by_sliced_quantiles_joint &lt;-<span class="st"> </span><span class="cf">function</span>(df, var.qjnt.grp.idx,</a>
<a class="sourceLine" id="cb189-19" title="19">                                             list.cts2quantile,</a>
<a class="sourceLine" id="cb189-20" title="20">                                             vars.group_by, vars.arrange,</a>
<a class="sourceLine" id="cb189-21" title="21">                                             <span class="dt">drop.any.quantile.na =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb189-22" title="22">                                             <span class="dt">toprint =</span> <span class="ot">TRUE</span>) {</a>
<a class="sourceLine" id="cb189-23" title="23"></a>
<a class="sourceLine" id="cb189-24" title="24">  <span class="co">#  Original dimensions</span></a>
<a class="sourceLine" id="cb189-25" title="25">  <span class="cf">if</span>(toprint) {</a>
<a class="sourceLine" id="cb189-26" title="26">   <span class="kw">print</span>(<span class="kw">dim</span>(df))</a>
<a class="sourceLine" id="cb189-27" title="27">  }</a>
<a class="sourceLine" id="cb189-28" title="28"></a>
<a class="sourceLine" id="cb189-29" title="29">  <span class="co"># All Continuous Variables from lists</span></a>
<a class="sourceLine" id="cb189-30" title="30">  vars.cts2quantile &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">lapply</span>(list.cts2quantile, <span class="cf">function</span>(elist) elist<span class="op">$</span>vars))</a>
<a class="sourceLine" id="cb189-31" title="31">  vars.cts2quantile</a>
<a class="sourceLine" id="cb189-32" title="32"></a>
<a class="sourceLine" id="cb189-33" title="33">  <span class="co"># Keep only if not NA for all Quantile variables</span></a>
<a class="sourceLine" id="cb189-34" title="34">  <span class="cf">if</span> (drop.any.quantile.na) {</a>
<a class="sourceLine" id="cb189-35" title="35">   df.select &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">drop_na</span>(<span class="kw">c</span>(vars.group_by, vars.arrange, vars.cts2quantile))</a>
<a class="sourceLine" id="cb189-36" title="36">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb189-37" title="37">   df.select &lt;-<span class="st"> </span>df</a>
<a class="sourceLine" id="cb189-38" title="38">  }</a>
<a class="sourceLine" id="cb189-39" title="39"></a>
<a class="sourceLine" id="cb189-40" title="40">  <span class="cf">if</span>(toprint) {</a>
<a class="sourceLine" id="cb189-41" title="41">   <span class="kw">print</span>(<span class="kw">dim</span>(df.select))</a>
<a class="sourceLine" id="cb189-42" title="42">  }</a>
<a class="sourceLine" id="cb189-43" title="43"></a>
<a class="sourceLine" id="cb189-44" title="44">  <span class="co"># Apply qunatile function to all elements of list of list</span></a>
<a class="sourceLine" id="cb189-45" title="45">  df.cut.list &lt;-<span class="st"> </span><span class="kw">lapply</span>(list.cts2quantile, df_cut_by_sliced_quantiles_grps,</a>
<a class="sourceLine" id="cb189-46" title="46">                        <span class="dt">df=</span>df.select, <span class="dt">vars.group_by=</span>vars.group_by, <span class="dt">vars.arrange=</span>vars.arrange)</a>
<a class="sourceLine" id="cb189-47" title="47"></a>
<a class="sourceLine" id="cb189-48" title="48">  <span class="co"># Reduce Resulting Core Panel Matrix Together</span></a>
<a class="sourceLine" id="cb189-49" title="49">  df.with.cut.quant.all &lt;-<span class="st"> </span><span class="kw">lapply</span>(df.cut.list, <span class="cf">function</span>(elist) elist<span class="op">$</span>df.with.cut.quant) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">reduce</span>(left_join)</a>
<a class="sourceLine" id="cb189-50" title="50">  df.sliced.quantiles.all &lt;-<span class="st"> </span><span class="kw">lapply</span>(df.cut.list, <span class="cf">function</span>(elist) elist<span class="op">$</span>df.sliced.quantiles)</a>
<a class="sourceLine" id="cb189-51" title="51"></a>
<a class="sourceLine" id="cb189-52" title="52">  <span class="cf">if</span>(toprint) {</a>
<a class="sourceLine" id="cb189-53" title="53">    <span class="kw">print</span>(<span class="kw">dim</span>(df.with.cut.quant.all))</a>
<a class="sourceLine" id="cb189-54" title="54">  }</a>
<a class="sourceLine" id="cb189-55" title="55"></a>
<a class="sourceLine" id="cb189-56" title="56">  <span class="co"># Obrain Newly Created Quantile Group Variables</span></a>
<a class="sourceLine" id="cb189-57" title="57">  vars.quantile.cut.all &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">lapply</span>(df.cut.list, <span class="cf">function</span>(elist) <span class="kw">names</span>(elist<span class="op">$</span>vars.quantile.cut)))</a>
<a class="sourceLine" id="cb189-58" title="58">  <span class="cf">if</span>(toprint) {</a>
<a class="sourceLine" id="cb189-59" title="59">    <span class="kw">print</span>(vars.quantile.cut.all)</a>
<a class="sourceLine" id="cb189-60" title="60">    <span class="kw">print</span>(<span class="kw">summary</span>(df.with.cut.quant.all <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">one_of</span>(vars.quantile.cut.all))))</a>
<a class="sourceLine" id="cb189-61" title="61">  }</a>
<a class="sourceLine" id="cb189-62" title="62"></a>
<a class="sourceLine" id="cb189-63" title="63">  <span class="co"># Generate Joint Quantile Index Variable</span></a>
<a class="sourceLine" id="cb189-64" title="64">  df.with.cut.quant.all &lt;-<span class="st"> </span>df.with.cut.quant.all <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="op">!!</span><span class="dt">var.qjnt.grp.idx :=</span> <span class="kw">group_indices</span>(., <span class="op">!!!</span><span class="kw">syms</span>(vars.quantile.cut.all)))</a>
<a class="sourceLine" id="cb189-65" title="65"></a>
<a class="sourceLine" id="cb189-66" title="66">  <span class="co"># Quantile Groups</span></a>
<a class="sourceLine" id="cb189-67" title="67">  arr.group.idx &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">sort</span>(<span class="kw">unique</span>(df.with.cut.quant.all[[var.qjnt.grp.idx]])))</a>
<a class="sourceLine" id="cb189-68" title="68"></a>
<a class="sourceLine" id="cb189-69" title="69">  <span class="co"># Results Display</span></a>
<a class="sourceLine" id="cb189-70" title="70">  df.group.print &lt;-<span class="st"> </span><span class="kw">df_cut_by_sliced_quantiles_joint_results_grped</span>(df.with.cut.quant.all, vars.cts2quantile,</a>
<a class="sourceLine" id="cb189-71" title="71">                                                 vars.group_by, vars.arrange,</a>
<a class="sourceLine" id="cb189-72" title="72">                                                 vars.quantile.cut.all, var.qjnt.grp.idx)</a>
<a class="sourceLine" id="cb189-73" title="73"></a>
<a class="sourceLine" id="cb189-74" title="74">  <span class="co"># list to Return</span></a>
<a class="sourceLine" id="cb189-75" title="75">  <span class="co"># These returns are the same as returns earlier: df_cut_by_sliced_quantiles</span></a>
<a class="sourceLine" id="cb189-76" title="76">  <span class="co"># Except that they are combined together</span></a>
<a class="sourceLine" id="cb189-77" title="77">  <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">df.with.cut.quant =</span> df.with.cut.quant.all,</a>
<a class="sourceLine" id="cb189-78" title="78">              <span class="dt">df.sliced.quantiles =</span> df.sliced.quantiles.all,</a>
<a class="sourceLine" id="cb189-79" title="79">              <span class="dt">df.grp.L1 =</span> (df.cut.list[[<span class="dv">1</span>]])<span class="op">$</span>df.grp.L1,</a>
<a class="sourceLine" id="cb189-80" title="80">              <span class="dt">vars.quantile.cut =</span> vars.quantile.cut.all,</a>
<a class="sourceLine" id="cb189-81" title="81">              <span class="dt">df.group.panel.cnt.mean =</span> df.group.print<span class="op">$</span>df.group.panel.cnt.mean,</a>
<a class="sourceLine" id="cb189-82" title="82">              <span class="dt">df.group.slice1.cnt.mean =</span> df.group.print<span class="op">$</span>df.group.slice1.cnt.mean))</a>
<a class="sourceLine" id="cb189-83" title="83"></a>
<a class="sourceLine" id="cb189-84" title="84">}</a></code></pre></div>
</div>
</div>
<div id="program-testing" class="section level4">
<h4><span class="header-section-number">2.4.2.2</span> Program Testing</h4>
<p>Load Data</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb190-1" title="1"><span class="co"># Library</span></a>
<a class="sourceLine" id="cb190-2" title="2"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb190-3" title="3"></a>
<a class="sourceLine" id="cb190-4" title="4"><span class="co"># Load Sample Data</span></a>
<a class="sourceLine" id="cb190-5" title="5"><span class="kw">setwd</span>(<span class="st">&#39;C:/Users/fan/R4Econ/_data/&#39;</span>)</a>
<a class="sourceLine" id="cb190-6" title="6">df &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;height_weight.csv&#39;</span>)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   S.country = col_character(),
##   vil.id = col_double(),
##   indi.id = col_double(),
##   sex = col_character(),
##   svymthRound = col_double(),
##   momEdu = col_double(),
##   wealthIdx = col_double(),
##   hgt = col_double(),
##   wgt = col_double(),
##   hgt0 = col_double(),
##   wgt0 = col_double(),
##   prot = col_double(),
##   cal = col_double(),
##   p.A.prot = col_double(),
##   p.A.nProt = col_double()
## )</code></pre>
<div id="hgt0-3-groups" class="section level5">
<h5><span class="header-section-number">2.4.2.2.1</span> Hgt0 3 Groups</h5>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb192-1" title="1"><span class="co"># Joint Quantile Group Name</span></a>
<a class="sourceLine" id="cb192-2" title="2">var.qjnt.grp.idx &lt;-<span class="st"> &#39;group.index&#39;</span></a>
<a class="sourceLine" id="cb192-3" title="3">list.cts2quantile &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">list</span>(<span class="dt">vars=</span><span class="kw">c</span>(<span class="st">&#39;hgt0&#39;</span>), <span class="dt">prob=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.3333</span>, <span class="fl">0.6666</span>, <span class="fl">1.0</span>)))</a>
<a class="sourceLine" id="cb192-4" title="4">results &lt;-<span class="st"> </span><span class="kw">df_cut_by_sliced_quantiles_joint</span>(df, var.qjnt.grp.idx, list.cts2quantile,</a>
<a class="sourceLine" id="cb192-5" title="5">                                            <span class="dt">vars.group_by =</span> <span class="kw">c</span>(<span class="st">&#39;indi.id&#39;</span>), <span class="dt">vars.arrange =</span> <span class="kw">c</span>(<span class="st">&#39;indi.id&#39;</span>, <span class="st">&#39;svymthRound&#39;</span>),</a>
<a class="sourceLine" id="cb192-6" title="6">                                            <span class="dt">drop.any.quantile.na =</span> <span class="ot">TRUE</span>, <span class="dt">toprint =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb192-7" title="7"><span class="co"># Show Results</span></a>
<a class="sourceLine" id="cb192-8" title="8">results<span class="op">$</span>df.group.slice1.cnt.mean</a></code></pre></div>
<pre><code>## # A tibble: 3 x 4
## # Groups:   hgt0_Qs0e1n3 [3]
##   hgt0_Qs0e1n3                group.index  mean     n
##   &lt;fct&gt;                             &lt;int&gt; &lt;dbl&gt; &lt;int&gt;
## 1 [40.6,48.5]; (1) of Qs0e1n3           1  47.0   580
## 2 (48.5,50.2]; (2) of Qs0e1n3           2  49.4   561
## 3 (50.2,58]; (3) of Qs0e1n3             3  51.7   568</code></pre>
</div>
<div id="wealth-5-groups-guatemala" class="section level5">
<h5><span class="header-section-number">2.4.2.2.2</span> Wealth 5 Groups Guatemala</h5>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb194-1" title="1"><span class="co"># Joint Quantile Group Name</span></a>
<a class="sourceLine" id="cb194-2" title="2">var.qjnt.grp.idx &lt;-<span class="st"> &#39;wltQuintle.index&#39;</span></a>
<a class="sourceLine" id="cb194-3" title="3">list.cts2quantile &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">list</span>(<span class="dt">vars=</span><span class="kw">c</span>(<span class="st">&#39;wealthIdx&#39;</span>), <span class="dt">prob=</span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">1.0</span>, <span class="fl">0.20</span>)))</a>
<a class="sourceLine" id="cb194-4" title="4">results &lt;-<span class="st"> </span><span class="kw">df_cut_by_sliced_quantiles_joint</span>((df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(S.country <span class="op">==</span><span class="st"> &#39;Guatemala&#39;</span>)),</a>
<a class="sourceLine" id="cb194-5" title="5">                                            var.qjnt.grp.idx, list.cts2quantile,</a>
<a class="sourceLine" id="cb194-6" title="6">                                            <span class="dt">vars.group_by =</span> <span class="kw">c</span>(<span class="st">&#39;indi.id&#39;</span>), <span class="dt">vars.arrange =</span> <span class="kw">c</span>(<span class="st">&#39;indi.id&#39;</span>, <span class="st">&#39;svymthRound&#39;</span>),</a>
<a class="sourceLine" id="cb194-7" title="7">                                            <span class="dt">drop.any.quantile.na =</span> <span class="ot">TRUE</span>, <span class="dt">toprint =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb194-8" title="8"><span class="co"># Show Results</span></a>
<a class="sourceLine" id="cb194-9" title="9">results<span class="op">$</span>df.group.slice1.cnt.mean</a></code></pre></div>
<pre><code>## # A tibble: 5 x 4
## # Groups:   wealthIdx_Qs0e1n5 [5]
##   wealthIdx_Qs0e1n5         wltQuintle.index  mean     n
##   &lt;fct&gt;                                &lt;int&gt; &lt;dbl&gt; &lt;int&gt;
## 1 [1,1.6]; (1) of Qs0e1n5                  1  1.25   151
## 2 (1.6,2.1]; (2) of Qs0e1n5                2  1.82   139
## 3 (2.1,2.3]; (3) of Qs0e1n5                3  2.25   139
## 4 (2.3,2.9]; (4) of Qs0e1n5                4  2.70   134
## 5 (2.9,6.6]; (5) of Qs0e1n5                5  3.77   111</code></pre>
</div>
<div id="hgt0-2-groups-wgt0-2-groups-too" class="section level5">
<h5><span class="header-section-number">2.4.2.2.3</span> Hgt0 2 groups, Wgt0 2 groups too</h5>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb196-1" title="1"><span class="co"># Joint Quantile Group Name</span></a>
<a class="sourceLine" id="cb196-2" title="2">var.qjnt.grp.idx &lt;-<span class="st"> &#39;group.index&#39;</span></a>
<a class="sourceLine" id="cb196-3" title="3">list.cts2quantile &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">list</span>(<span class="dt">vars=</span><span class="kw">c</span>(<span class="st">&#39;hgt0&#39;</span>, <span class="st">&#39;wgt0&#39;</span>), <span class="dt">prob=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="fl">1.0</span>)))</a>
<a class="sourceLine" id="cb196-4" title="4">results &lt;-<span class="st"> </span><span class="kw">df_cut_by_sliced_quantiles_joint</span>(df, var.qjnt.grp.idx, list.cts2quantile,</a>
<a class="sourceLine" id="cb196-5" title="5">                                            <span class="dt">vars.group_by =</span> <span class="kw">c</span>(<span class="st">&#39;indi.id&#39;</span>), <span class="dt">vars.arrange =</span> <span class="kw">c</span>(<span class="st">&#39;indi.id&#39;</span>, <span class="st">&#39;svymthRound&#39;</span>),</a>
<a class="sourceLine" id="cb196-6" title="6">                                            <span class="dt">drop.any.quantile.na =</span> <span class="ot">TRUE</span>, <span class="dt">toprint =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## Joining, by = &quot;quant.perc&quot;</code></pre>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb198-1" title="1"><span class="co"># Show Results</span></a>
<a class="sourceLine" id="cb198-2" title="2">results<span class="op">$</span>df.group.slice1.cnt.mean</a></code></pre></div>
<pre><code>## # A tibble: 4 x 7
## # Groups:   hgt0_Qs0e1n2, wgt0_Qs0e1n2 [4]
##   hgt0_Qs0e1n2                wgt0_Qs0e1n2                        group.index hgt0_mean wgt0_mean hgt0_n wgt0_n
##   &lt;fct&gt;                       &lt;fct&gt;                                     &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;  &lt;int&gt;  &lt;int&gt;
## 1 [40.6,49.4]; (1) of Qs0e1n2 [1.4e+03,3.01e+03]; (1) of Qs0e1n2            1      47.4     2650.    652    652
## 2 [40.6,49.4]; (1) of Qs0e1n2 (3.01e+03,5.49e+03]; (2) of Qs0e1n2           2      48.5     3244.    228    228
## 3 (49.4,58]; (2) of Qs0e1n2   [1.4e+03,3.01e+03]; (1) of Qs0e1n2            3      50.4     2829.    202    202
## 4 (49.4,58]; (2) of Qs0e1n2   (3.01e+03,5.49e+03]; (2) of Qs0e1n2           4      51.3     3483.    626    626</code></pre>
</div>
<div id="hgt0-2-groups-wealth-2-groups-cebu-only" class="section level5">
<h5><span class="header-section-number">2.4.2.2.4</span> Hgt0 2 groups, Wealth 2 groups, Cebu Only</h5>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb200-1" title="1"><span class="co"># Joint Quantile Group Name</span></a>
<a class="sourceLine" id="cb200-2" title="2">var.qjnt.grp.idx &lt;-<span class="st"> &#39;group.index&#39;</span></a>
<a class="sourceLine" id="cb200-3" title="3">list.cts2quantile &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">list</span>(<span class="dt">vars=</span><span class="kw">c</span>(<span class="st">&#39;wealthIdx&#39;</span>), <span class="dt">prob=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="fl">1.0</span>)), <span class="kw">list</span>(<span class="dt">vars=</span><span class="kw">c</span>(<span class="st">&#39;hgt0&#39;</span>), <span class="dt">prob=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.333</span>, <span class="fl">0.666</span>, <span class="fl">1.0</span>)))</a>
<a class="sourceLine" id="cb200-4" title="4">results &lt;-<span class="st"> </span><span class="kw">df_cut_by_sliced_quantiles_joint</span>((df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(S.country <span class="op">==</span><span class="st"> &#39;Cebu&#39;</span>)),</a>
<a class="sourceLine" id="cb200-5" title="5">                                             var.qjnt.grp.idx, list.cts2quantile,</a>
<a class="sourceLine" id="cb200-6" title="6">                                             <span class="dt">vars.group_by =</span> <span class="kw">c</span>(<span class="st">&#39;indi.id&#39;</span>), <span class="dt">vars.arrange =</span> <span class="kw">c</span>(<span class="st">&#39;indi.id&#39;</span>, <span class="st">&#39;svymthRound&#39;</span>),</a>
<a class="sourceLine" id="cb200-7" title="7">                                             <span class="dt">drop.any.quantile.na =</span> <span class="ot">TRUE</span>, <span class="dt">toprint =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## Joining, by = c(&quot;S.country&quot;, &quot;vil.id&quot;, &quot;indi.id&quot;, &quot;sex&quot;, &quot;svymthRound&quot;, &quot;momEdu&quot;, &quot;wealthIdx&quot;, &quot;hgt&quot;, &quot;wgt&quot;, &quot;hgt0&quot;, &quot;wgt0&quot;, &quot;prot&quot;, &quot;cal&quot;, &quot;p.A.prot&quot;,
## &quot;p.A.nProt&quot;)</code></pre>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb202-1" title="1"><span class="co"># Show Results</span></a>
<a class="sourceLine" id="cb202-2" title="2">results<span class="op">$</span>df.group.slice1.cnt.mean</a></code></pre></div>
<pre><code>## # A tibble: 6 x 7
## # Groups:   wealthIdx_Qs0e1n2, hgt0_Qs0e1n3 [6]
##   wealthIdx_Qs0e1n2          hgt0_Qs0e1n3                group.index wealthIdx_mean hgt0_mean wealthIdx_n hgt0_n
##   &lt;fct&gt;                      &lt;fct&gt;                             &lt;int&gt;          &lt;dbl&gt;     &lt;dbl&gt;       &lt;int&gt;  &lt;int&gt;
## 1 [5.2,8.3]; (1) of Qs0e1n2  [41.1,48.4]; (1) of Qs0e1n3           1           7.15      46.9         270    270
## 2 [5.2,8.3]; (1) of Qs0e1n2  (48.4,50.1]; (2) of Qs0e1n3           2           7.18      49.2         269    269
## 3 [5.2,8.3]; (1) of Qs0e1n2  (50.1,58]; (3) of Qs0e1n3             3           7.13      51.3         236    236
## 4 (8.3,19.3]; (2) of Qs0e1n2 [41.1,48.4]; (1) of Qs0e1n3           4          11.1       47.2         179    179
## 5 (8.3,19.3]; (2) of Qs0e1n2 (48.4,50.1]; (2) of Qs0e1n3           5          11.2       49.3         185    185
## 6 (8.3,19.3]; (2) of Qs0e1n2 (50.1,58]; (3) of Qs0e1n3             6          11.6       51.7         207    207</code></pre>
</div>
<div id="results-of-income-wgt0-hgt0-joint-gruops-in-cebu" class="section level5">
<h5><span class="header-section-number">2.4.2.2.5</span> Results of income + Wgt0 + Hgt0 joint Gruops in Cebu</h5>
<p>Weight at month 0 below and above median, height at month zero into three terciles.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb204-1" title="1"><span class="co"># Joint Quantile Group Name</span></a>
<a class="sourceLine" id="cb204-2" title="2">var.qjnt.grp.idx &lt;-<span class="st"> &#39;wltHgt0Wgt0.index&#39;</span></a>
<a class="sourceLine" id="cb204-3" title="3">list.cts2quantile &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">list</span>(<span class="dt">vars=</span><span class="kw">c</span>(<span class="st">&#39;wealthIdx&#39;</span>), <span class="dt">prob=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="fl">1.0</span>)), <span class="kw">list</span>(<span class="dt">vars=</span><span class="kw">c</span>(<span class="st">&#39;hgt0&#39;</span>, <span class="st">&#39;wgt0&#39;</span>), <span class="dt">prob=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="fl">1.0</span>)))</a>
<a class="sourceLine" id="cb204-4" title="4">results &lt;-<span class="st"> </span><span class="kw">df_cut_by_sliced_quantiles_joint</span>((df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(S.country <span class="op">==</span><span class="st"> &#39;Cebu&#39;</span>)),</a>
<a class="sourceLine" id="cb204-5" title="5">                                            var.qjnt.grp.idx, list.cts2quantile,</a>
<a class="sourceLine" id="cb204-6" title="6">                                            <span class="dt">vars.group_by =</span> <span class="kw">c</span>(<span class="st">&#39;indi.id&#39;</span>), <span class="dt">vars.arrange =</span> <span class="kw">c</span>(<span class="st">&#39;indi.id&#39;</span>, <span class="st">&#39;svymthRound&#39;</span>),</a>
<a class="sourceLine" id="cb204-7" title="7">                                            <span class="dt">drop.any.quantile.na =</span> <span class="ot">TRUE</span>, <span class="dt">toprint =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## Joining, by = &quot;quant.perc&quot;Joining, by = c(&quot;S.country&quot;, &quot;vil.id&quot;, &quot;indi.id&quot;, &quot;sex&quot;, &quot;svymthRound&quot;, &quot;momEdu&quot;, &quot;wealthIdx&quot;, &quot;hgt&quot;, &quot;wgt&quot;, &quot;hgt0&quot;, &quot;wgt0&quot;,
## &quot;prot&quot;, &quot;cal&quot;, &quot;p.A.prot&quot;, &quot;p.A.nProt&quot;)</code></pre>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb206-1" title="1"><span class="co"># Show Results</span></a>
<a class="sourceLine" id="cb206-2" title="2">results<span class="op">$</span>df.group.slice1.cnt.mean</a></code></pre></div>
<pre><code>## # A tibble: 8 x 10
## # Groups:   wealthIdx_Qs0e1n2, hgt0_Qs0e1n2, wgt0_Qs0e1n2 [8]
##   wealthIdx_Qs0e1n2       hgt0_Qs0e1n2            wgt0_Qs0e1n2                 wltHgt0Wgt0.ind~ wealthIdx_mean hgt0_mean wgt0_mean wealthIdx_n hgt0_n wgt0_n
##   &lt;fct&gt;                   &lt;fct&gt;                   &lt;fct&gt;                                   &lt;int&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;       &lt;int&gt;  &lt;int&gt;  &lt;int&gt;
## 1 [5.2,8.3]; (1) of Qs0e~ [41.1,49.2]; (1) of Qs~ [1.4e+03,2.98e+03]; (1) of ~                1           7.16      47.3     2607.         308    308    308
## 2 [5.2,8.3]; (1) of Qs0e~ [41.1,49.2]; (1) of Qs~ (2.98e+03,5.49e+03]; (2) of~                2           7.27      48.4     3156.         102    102    102
## 3 [5.2,8.3]; (1) of Qs0e~ (49.2,58]; (2) of Qs0e~ [1.4e+03,2.98e+03]; (1) of ~                3           7.00      50.2     2781.          97     97     97
## 4 [5.2,8.3]; (1) of Qs0e~ (49.2,58]; (2) of Qs0e~ (2.98e+03,5.49e+03]; (2) of~                4           7.16      51.0     3328.         268    268    268
## 5 (8.3,19.3]; (2) of Qs0~ [41.1,49.2]; (1) of Qs~ [1.4e+03,2.98e+03]; (1) of ~                5          10.9       47.4     2632.         186    186    186
## 6 (8.3,19.3]; (2) of Qs0~ [41.1,49.2]; (1) of Qs~ (2.98e+03,5.49e+03]; (2) of~                6          11.3       48.5     3196.          81     81     81
## 7 (8.3,19.3]; (2) of Qs0~ (49.2,58]; (2) of Qs0e~ [1.4e+03,2.98e+03]; (1) of ~                7          11.3       50.2     2779.          82     82     82
## 8 (8.3,19.3]; (2) of Qs0~ (49.2,58]; (2) of Qs0e~ (2.98e+03,5.49e+03]; (2) of~                8          11.7       51.4     3431.         222    222    222</code></pre>
</div>
</div>
<div id="line-by-linequantiles-var-by-var" class="section level4">
<h4><span class="header-section-number">2.4.2.3</span> Line by Line–Quantiles Var by Var</h4>
<p>The idea of the function is to generate quantiles levels first, and then use those to generate the categories based on quantiles. Rather than doing this in one step. These are done in two steps, to increase clarity in the quantiles used for quantile category generation. And a dataframe with these quantiles are saved as a separate output of the function.</p>
<div id="dataframe-of-variables-group-by-level-quantiles" class="section level5">
<h5><span class="header-section-number">2.4.2.3.1</span> Dataframe of Variables’ Group-by Level Quantiles</h5>
<p>Quantiles from Different Variables. Note that these variables are specific to the individual, not individual/month. So we need to first slick the data, so that we only get the first rows.</p>
<p>Do this in several steps to clarify group_by level. No speed loss.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb208-1" title="1"><span class="co"># Selected Variables, many Percentiles</span></a>
<a class="sourceLine" id="cb208-2" title="2">vars.group_by &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;indi.id&#39;</span>)</a>
<a class="sourceLine" id="cb208-3" title="3">vars.arrange &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;indi.id&#39;</span>, <span class="st">&#39;svymthRound&#39;</span>)</a>
<a class="sourceLine" id="cb208-4" title="4">vars.cts2quantile &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;wealthIdx&#39;</span>, <span class="st">&#39;hgt0&#39;</span>, <span class="st">&#39;wgt0&#39;</span>)</a>
<a class="sourceLine" id="cb208-5" title="5">seq.quantiles &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.3333</span>, <span class="fl">0.6666</span>, <span class="fl">1.0</span>)</a>
<a class="sourceLine" id="cb208-6" title="6">df.sliced &lt;-<span class="st"> </span><span class="kw">df_sliced_quantiles</span>(df, vars.cts2quantile, seq.quantiles, vars.group_by, vars.arrange)</a></code></pre></div>
<pre><code>## Joining, by = &quot;quant.perc&quot;Joining, by = &quot;quant.perc&quot;</code></pre>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb210-1" title="1">df.sliced.quantiles &lt;-<span class="st"> </span>df.sliced<span class="op">$</span>df.sliced.quantiles</a>
<a class="sourceLine" id="cb210-2" title="2">df.grp.L1 &lt;-<span class="st"> </span>df.sliced<span class="op">$</span>df.grp.L1</a></code></pre></div>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb211-1" title="1">df.sliced.quantiles</a></code></pre></div>
<pre><code>## # A tibble: 4 x 4
##   quant.perc wealthIdx  hgt0  wgt0
##   &lt;chr&gt;          &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 0%               1    40.6 1402.
## 2 33.33%           5.2  48.5 2843.
## 3 66.66%           8.3  50.2 3209.
## 4 100%            19.3  58   5494.</code></pre>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb213-1" title="1"><span class="co"># Quantiles all Variables</span></a>
<a class="sourceLine" id="cb213-2" title="2"><span class="kw">suppressMessages</span>(<span class="kw">lapply</span>(<span class="kw">names</span>(df), gen_quantiles, <span class="dt">df=</span>df.grp.L1, <span class="dt">prob=</span><span class="kw">seq</span>(<span class="fl">0.1</span>,<span class="fl">0.9</span>,<span class="fl">0.10</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">reduce</span>(full_join))</a></code></pre></div>
<pre><code>## Warning in quantile(as.numeric(df[[var]]), prob, na.rm = TRUE): NAs introduced by coercion

## Warning in quantile(as.numeric(df[[var]]), prob, na.rm = TRUE): NAs introduced by coercion</code></pre>
<pre><code>## # A tibble: 9 x 16
##   quant.perc S.country vil.id indi.id   sex svymthRound momEdu wealthIdx   hgt   wgt  hgt0  wgt0  prot   cal p.A.prot p.A.nProt
##   &lt;chr&gt;          &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1 10%               NA      3    203.    NA           0    5.7       1.7  46.3 1397.  46.6 2500.   0.5  0.5      24.3      0.5 
## 2 20%               NA      4    405.    NA           0    6.9       2.3  47.3 1840.  47.7 2686.   0.5  0.5     172.       0.5 
## 3 30%               NA      6    608.    NA           0    7.7       3.3  48   2272.  48.3 2804.   0.5  0.5     721.       1.06
## 4 40%               NA      8    810.    NA           0    8.6       6.3  48.7 2669.  48.8 2910.   0.5  0.5    1010.      19   
## 5 50%               NA      9   1012     NA           0    9.3       7.3  49.4 3050.  49.4 3013    0.5  0.5    1273.     111.  
## 6 60%               NA     13   1214.    NA           0   10.4       8.3  49.9 3440.  49.9 3126.   0.5  3.88   1614.     222.  
## 7 70%               NA     14   1416.    NA           0   11.4       8.3  50.5 3857.  50.4 3250.   0.7  8.26   2680.     257.  
## 8 80%               NA     17   1619.    NA           0   12.7       9.3  51.2 4258.  51.0 3418.   1.2 11.5    4761.     298.  
## 9 90%               NA     26   1821.    NA           0   14.6      11.3  52.3 4704.  52   3683.   1.6 15.6   10868.     365.</code></pre>
</div>
<div id="cut-quantile-categorical-variables" class="section level5">
<h5><span class="header-section-number">2.4.2.3.2</span> Cut Quantile Categorical Variables</h5>
<p>Using the Quantiles we have generate, cut the continuous variables to generate categorical quantile variables in the full dataframe.</p>
<p>Note that we can only cut based on unique breaks, but sometimes quantile break-points are the same if some values are often observed, and also if there are too few observations with respect to quantile groups.</p>
<p>To resolve this issue, we only look at unique quantiles.</p>
<p>We need several support Functions:
1. support functions to generate suffix for quantile variables based on quantile cuts
2. support for labeling variables of resulting quantiles beyond bracketing</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb216-1" title="1"><span class="co"># Function Testing</span></a>
<a class="sourceLine" id="cb216-2" title="2">arr.quantiles &lt;-<span class="st"> </span>df.sliced.quantiles[[<span class="kw">substitute</span>(<span class="st">&#39;wealthIdx&#39;</span>)]]</a>
<a class="sourceLine" id="cb216-3" title="3">arr.quantiles</a></code></pre></div>
<pre><code>## [1]  1.0  5.2  8.3 19.3</code></pre>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb218-1" title="1">arr.sort.unique.quantiles &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">unique</span>(df.sliced.quantiles[[<span class="kw">substitute</span>(<span class="st">&#39;wealthIdx&#39;</span>)]]))</a>
<a class="sourceLine" id="cb218-2" title="2">arr.sort.unique.quantiles</a></code></pre></div>
<pre><code>## [1]  1.0  5.2  8.3 19.3</code></pre>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb220-1" title="1"><span class="kw">f_Q_label</span>(arr.quantiles, arr.sort.unique.quantiles[<span class="dv">1</span>], seq.quantiles)</a></code></pre></div>
<pre><code>## [1] &quot;(1) of Qs0e1n3&quot;</code></pre>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb222-1" title="1"><span class="kw">f_Q_label</span>(arr.quantiles, arr.sort.unique.quantiles[<span class="dv">2</span>], seq.quantiles)</a></code></pre></div>
<pre><code>## [1] &quot;(2) of Qs0e1n3&quot;</code></pre>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb224-1" title="1"><span class="kw">lapply</span>(arr.sort.unique.quantiles[<span class="dv">1</span><span class="op">:</span>(<span class="kw">length</span>(arr.sort.unique.quantiles)<span class="op">-</span><span class="dv">1</span>)],</a>
<a class="sourceLine" id="cb224-2" title="2">       f_Q_label,</a>
<a class="sourceLine" id="cb224-3" title="3">       <span class="dt">arr.quantiles=</span>arr.quantiles,</a>
<a class="sourceLine" id="cb224-4" title="4">       <span class="dt">seq.quantiles=</span>seq.quantiles)</a></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;(1) of Qs0e1n3&quot;
## 
## [[2]]
## [1] &quot;(2) of Qs0e1n3&quot;
## 
## [[3]]
## [1] &quot;(3) of Qs0e1n3&quot;</code></pre>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb226-1" title="1"><span class="co"># Generate Categorical Variables of Quantiles</span></a>
<a class="sourceLine" id="cb226-2" title="2">vars.group_by &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;indi.id&#39;</span>)</a>
<a class="sourceLine" id="cb226-3" title="3">vars.arrange &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;indi.id&#39;</span>, <span class="st">&#39;svymthRound&#39;</span>)</a>
<a class="sourceLine" id="cb226-4" title="4">vars.cts2quantile &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;wealthIdx&#39;</span>, <span class="st">&#39;hgt0&#39;</span>, <span class="st">&#39;wgt0&#39;</span>)</a>
<a class="sourceLine" id="cb226-5" title="5">seq.quantiles &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.3333</span>, <span class="fl">0.6666</span>, <span class="fl">1.0</span>)</a>
<a class="sourceLine" id="cb226-6" title="6">df.cut &lt;-<span class="st"> </span><span class="kw">df_cut_by_sliced_quantiles</span>(df, vars.cts2quantile, seq.quantiles, vars.group_by, vars.arrange)</a></code></pre></div>
<pre><code>## Joining, by = &quot;quant.perc&quot;Joining, by = &quot;quant.perc&quot;</code></pre>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb228-1" title="1">vars.quantile.cut &lt;-<span class="st"> </span>df.cut<span class="op">$</span>vars.quantile.cut</a>
<a class="sourceLine" id="cb228-2" title="2">df.with.cut.quant &lt;-<span class="st"> </span>df.cut<span class="op">$</span>df.with.cut.quant</a>
<a class="sourceLine" id="cb228-3" title="3">df.grp.L1 &lt;-<span class="st"> </span>df.cut<span class="op">$</span>df.grp.L1</a></code></pre></div>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb229-1" title="1"><span class="co"># Cut Variables Generated</span></a>
<a class="sourceLine" id="cb229-2" title="2"><span class="kw">names</span>(vars.quantile.cut)</a></code></pre></div>
<pre><code>## [1] &quot;wealthIdx_Qs0e1n3&quot; &quot;hgt0_Qs0e1n3&quot;      &quot;wgt0_Qs0e1n3&quot;</code></pre>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb231-1" title="1"><span class="kw">summary</span>(vars.quantile.cut)</a></code></pre></div>
<pre><code>##                   wealthIdx_Qs0e1n3                      hgt0_Qs0e1n3                                wgt0_Qs0e1n3  
##  [1,5.2]; (1) of Qs0e1n3   :10958   [40.6,48.5]; (1) of Qs0e1n3:10232   [1.4e+03,2.84e+03]; (1) of Qs0e1n3 :10105  
##  (5.2,8.3]; (2) of Qs0e1n3 :13812   (48.5,50.2]; (2) of Qs0e1n3: 9895   (2.84e+03,3.21e+03]; (2) of Qs0e1n3:10056  
##  (8.3,19.3]; (3) of Qs0e1n3:10295   (50.2,58]; (3) of Qs0e1n3  : 9908   (3.21e+03,5.49e+03]; (3) of Qs0e1n3: 9858  
##                                     NA&#39;s                       : 5030   NA&#39;s                               : 5046</code></pre>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb233-1" title="1"><span class="co"># options(repr.matrix.max.rows=50, repr.matrix.max.cols=20)</span></a>
<a class="sourceLine" id="cb233-2" title="2"><span class="co"># df.with.cut.quant</span></a></code></pre></div>
</div>
<div id="individual-variables-quantile-cuts-review-results" class="section level5">
<h5><span class="header-section-number">2.4.2.3.3</span> Individual Variables’ Quantile Cuts Review Results</h5>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb234-1" title="1"><span class="co"># Group By Results</span></a>
<a class="sourceLine" id="cb234-2" title="2">f.count &lt;-<span class="st"> </span><span class="cf">function</span>(df, var.cts, seq.quantiles) {</a>
<a class="sourceLine" id="cb234-3" title="3">    df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(S.country, indi.id, svymthRound, <span class="kw">matches</span>(<span class="kw">paste0</span>(var.cts, <span class="dt">collapse=</span><span class="st">&#39;|&#39;</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb234-4" title="4"><span class="st">        </span><span class="kw">group_by</span>(<span class="op">!!</span><span class="kw">sym</span>(<span class="kw">f_var_rename</span>(<span class="kw">paste0</span>(var.cts,<span class="st">&#39;_q&#39;</span>), seq.quantiles))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb234-5" title="5"><span class="st">        </span><span class="kw">summarise_all</span>(<span class="kw">funs</span>(<span class="dt">n=</span><span class="kw">n</span>()))</a>
<a class="sourceLine" id="cb234-6" title="6">}</a></code></pre></div>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb235-1" title="1"><span class="co"># Full Panel Results</span></a>
<a class="sourceLine" id="cb235-2" title="2"><span class="kw">lapply</span>(vars.cts2quantile, f.count, <span class="dt">df=</span>df.with.cut.quant, <span class="dt">seq.quantiles=</span>seq.quantiles)</a></code></pre></div>
<pre><code>## Warning: Factor `hgt0_Qs0e1n3` contains implicit NA, consider using `forcats::fct_explicit_na`</code></pre>
<pre><code>## Warning: Factor `wgt0_Qs0e1n3` contains implicit NA, consider using `forcats::fct_explicit_na`</code></pre>
<pre><code>## [[1]]
## # A tibble: 3 x 5
##   wealthIdx_Qs0e1n3          S.country_n indi.id_n svymthRound_n wealthIdx_n
##   &lt;fct&gt;                            &lt;int&gt;     &lt;int&gt;         &lt;int&gt;       &lt;int&gt;
## 1 [1,5.2]; (1) of Qs0e1n3          10958     10958         10958       10958
## 2 (5.2,8.3]; (2) of Qs0e1n3        13812     13812         13812       13812
## 3 (8.3,19.3]; (3) of Qs0e1n3       10295     10295         10295       10295
## 
## [[2]]
## # A tibble: 4 x 5
##   hgt0_Qs0e1n3                S.country_n indi.id_n svymthRound_n hgt0_n
##   &lt;fct&gt;                             &lt;int&gt;     &lt;int&gt;         &lt;int&gt;  &lt;int&gt;
## 1 [40.6,48.5]; (1) of Qs0e1n3       10232     10232         10232  10232
## 2 (48.5,50.2]; (2) of Qs0e1n3        9895      9895          9895   9895
## 3 (50.2,58]; (3) of Qs0e1n3          9908      9908          9908   9908
## 4 &lt;NA&gt;                               5030      5030          5030   5030
## 
## [[3]]
## # A tibble: 4 x 5
##   wgt0_Qs0e1n3                        S.country_n indi.id_n svymthRound_n wgt0_n
##   &lt;fct&gt;                                     &lt;int&gt;     &lt;int&gt;         &lt;int&gt;  &lt;int&gt;
## 1 [1.4e+03,2.84e+03]; (1) of Qs0e1n3        10105     10105         10105  10105
## 2 (2.84e+03,3.21e+03]; (2) of Qs0e1n3       10056     10056         10056  10056
## 3 (3.21e+03,5.49e+03]; (3) of Qs0e1n3        9858      9858          9858   9858
## 4 &lt;NA&gt;                                       5046      5046          5046   5046</code></pre>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb239-1" title="1"><span class="co"># Results Individual Slice</span></a>
<a class="sourceLine" id="cb239-2" title="2"><span class="kw">lapply</span>(vars.cts2quantile, f.count,</a>
<a class="sourceLine" id="cb239-3" title="3">       <span class="dt">df=</span>(df.with.cut.quant <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(<span class="op">!!!</span><span class="kw">syms</span>(vars.group_by)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="op">!!!</span><span class="kw">syms</span>(vars.arrange)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">slice</span>(1L)),</a>
<a class="sourceLine" id="cb239-4" title="4">       <span class="dt">seq.quantiles =</span> seq.quantiles)</a></code></pre></div>
<pre><code>## Warning: Factor `hgt0_Qs0e1n3` contains implicit NA, consider using `forcats::fct_explicit_na`</code></pre>
<pre><code>## Warning: Factor `wgt0_Qs0e1n3` contains implicit NA, consider using `forcats::fct_explicit_na`</code></pre>
<pre><code>## [[1]]
## # A tibble: 3 x 5
##   wealthIdx_Qs0e1n3          S.country_n indi.id_n svymthRound_n wealthIdx_n
##   &lt;fct&gt;                            &lt;int&gt;     &lt;int&gt;         &lt;int&gt;       &lt;int&gt;
## 1 [1,5.2]; (1) of Qs0e1n3            683       683           683         683
## 2 (5.2,8.3]; (2) of Qs0e1n3          768       768           768         768
## 3 (8.3,19.3]; (3) of Qs0e1n3         572       572           572         572
## 
## [[2]]
## # A tibble: 4 x 5
##   hgt0_Qs0e1n3                S.country_n indi.id_n svymthRound_n hgt0_n
##   &lt;fct&gt;                             &lt;int&gt;     &lt;int&gt;         &lt;int&gt;  &lt;int&gt;
## 1 [40.6,48.5]; (1) of Qs0e1n3         580       580           580    580
## 2 (48.5,50.2]; (2) of Qs0e1n3         561       561           561    561
## 3 (50.2,58]; (3) of Qs0e1n3           568       568           568    568
## 4 &lt;NA&gt;                                314       314           314    314
## 
## [[3]]
## # A tibble: 4 x 5
##   wgt0_Qs0e1n3                        S.country_n indi.id_n svymthRound_n wgt0_n
##   &lt;fct&gt;                                     &lt;int&gt;     &lt;int&gt;         &lt;int&gt;  &lt;int&gt;
## 1 [1.4e+03,2.84e+03]; (1) of Qs0e1n3          569       569           569    569
## 2 (2.84e+03,3.21e+03]; (2) of Qs0e1n3         569       569           569    569
## 3 (3.21e+03,5.49e+03]; (3) of Qs0e1n3         570       570           570    570
## 4 &lt;NA&gt;                                        315       315           315    315</code></pre>
</div>
</div>
<div id="differential-quantiles-for-different-variables-then-combine-to-form-new-groups" class="section level4">
<h4><span class="header-section-number">2.4.2.4</span> Differential Quantiles for Different Variables Then Combine to Form New Groups</h4>
<p>Collect together different quantile base variables and their percentile cuttings quantile rules. Input Parameters.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb243-1" title="1"><span class="co"># Generate Categorical Variables of Quantiles</span></a>
<a class="sourceLine" id="cb243-2" title="2">vars.group_by &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;indi.id&#39;</span>)</a>
<a class="sourceLine" id="cb243-3" title="3">vars.arrange &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;indi.id&#39;</span>, <span class="st">&#39;svymthRound&#39;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb244-1" title="1"><span class="co"># Quantile Variables and Quantiles</span></a>
<a class="sourceLine" id="cb244-2" title="2">vars.cts2quantile.wealth &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;wealthIdx&#39;</span>)</a>
<a class="sourceLine" id="cb244-3" title="3">seq.quantiles.wealth &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="fl">1.0</span>)</a>
<a class="sourceLine" id="cb244-4" title="4">vars.cts2quantile.wgthgt &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;hgt0&#39;</span>, <span class="st">&#39;wgt0&#39;</span>)</a>
<a class="sourceLine" id="cb244-5" title="5">seq.quantiles.wgthgt &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.3333</span>, <span class="fl">0.6666</span>, <span class="fl">1.0</span>)</a>
<a class="sourceLine" id="cb244-6" title="6">drop.any.quantile.na &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb244-7" title="7"><span class="co"># collect to list</span></a>
<a class="sourceLine" id="cb244-8" title="8">list.cts2quantile &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">list</span>(<span class="dt">vars=</span>vars.cts2quantile.wealth,</a>
<a class="sourceLine" id="cb244-9" title="9">                               <span class="dt">prob=</span>seq.quantiles.wealth),</a>
<a class="sourceLine" id="cb244-10" title="10">                          <span class="kw">list</span>(<span class="dt">vars=</span>vars.cts2quantile.wgthgt,</a>
<a class="sourceLine" id="cb244-11" title="11">                               <span class="dt">prob=</span>seq.quantiles.wgthgt))</a></code></pre></div>
</div>
<div id="check-if-within-group-variables-are-the-same" class="section level4">
<h4><span class="header-section-number">2.4.2.5</span> Check if Within Group Variables Are The Same</h4>
<p>Need to make sure quantile variables are unique within groups</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb245-1" title="1">vars.cts2quantile &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">lapply</span>(list.cts2quantile, <span class="cf">function</span>(elist) elist<span class="op">$</span>vars))</a>
<a class="sourceLine" id="cb245-2" title="2"><span class="kw">f_check_distinct_ingroup</span>(df, vars.group_by, <span class="dt">vars.values_in_group=</span>vars.cts2quantile)</a></code></pre></div>
<div id="keep-only-non-na-for-all-quantile-variables" class="section level5">
<h5><span class="header-section-number">2.4.2.5.1</span> Keep only non-NA for all Quantile Variables</h5>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb246-1" title="1"><span class="co"># Original dimensions</span></a>
<a class="sourceLine" id="cb246-2" title="2"><span class="kw">dim</span>(df)</a></code></pre></div>
<pre><code>## [1] 35065    15</code></pre>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb248-1" title="1"><span class="co"># All Continuous Variables from lists</span></a>
<a class="sourceLine" id="cb248-2" title="2">vars.cts2quantile &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">lapply</span>(list.cts2quantile, <span class="cf">function</span>(elist) elist<span class="op">$</span>vars))</a>
<a class="sourceLine" id="cb248-3" title="3">vars.cts2quantile</a></code></pre></div>
<pre><code>## [1] &quot;wealthIdx&quot; &quot;hgt0&quot;      &quot;wgt0&quot;</code></pre>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb250-1" title="1"><span class="co"># Keep only if not NA for all Quantile variables</span></a>
<a class="sourceLine" id="cb250-2" title="2"><span class="cf">if</span> (drop.any.quantile.na) {</a>
<a class="sourceLine" id="cb250-3" title="3">    df.select &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">drop_na</span>(<span class="kw">c</span>(vars.group_by, vars.arrange, vars.cts2quantile))</a>
<a class="sourceLine" id="cb250-4" title="4">}</a>
<a class="sourceLine" id="cb250-5" title="5"><span class="kw">dim</span>(df.select)</a></code></pre></div>
<pre><code>## [1] 30019    15</code></pre>
</div>
<div id="apply-quantiles-for-each-quantile-variable" class="section level5">
<h5><span class="header-section-number">2.4.2.5.2</span> Apply Quantiles for Each Quantile Variable</h5>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb252-1" title="1"><span class="co"># Dealing with a list of quantile variables</span></a>
<a class="sourceLine" id="cb252-2" title="2">df.cut.wealth &lt;-<span class="st"> </span><span class="kw">df_cut_by_sliced_quantiles</span>(df.select, vars.cts2quantile.wealth, seq.quantiles.wealth, vars.group_by, vars.arrange)</a>
<a class="sourceLine" id="cb252-3" title="3"><span class="kw">summary</span>(df.cut.wealth<span class="op">$</span>vars.quantile.cut)</a></code></pre></div>
<pre><code>##                   wealthIdx_Qs0e1n2
##  [1,7.3]; (1) of Qs0e1n2   :14936  
##  (7.3,19.3]; (2) of Qs0e1n2:15083</code></pre>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb254-1" title="1"><span class="co"># summary((df.cut.wealth$df.with.cut.quant)[[&#39;wealthIdx_Qs0e1n2&#39;]])</span></a>
<a class="sourceLine" id="cb254-2" title="2"><span class="co"># df.cut.wealth$df.with.cut.quant %&gt;% filter(is.na(wealthIdx_Qs0e1n2))</span></a>
<a class="sourceLine" id="cb254-3" title="3"><span class="co"># df.cut.wealth$df.with.cut.quant %&gt;% filter(indi.id == 500)</span></a></code></pre></div>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb255-1" title="1">df.cut.wgthgt &lt;-<span class="st"> </span><span class="kw">df_cut_by_sliced_quantiles</span>(df.select, vars.cts2quantile.wgthgt, seq.quantiles.wgthgt, vars.group_by, vars.arrange)</a></code></pre></div>
<pre><code>## Joining, by = &quot;quant.perc&quot;</code></pre>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb257-1" title="1"><span class="kw">summary</span>(df.cut.wgthgt<span class="op">$</span>vars.quantile.cut)</a></code></pre></div>
<pre><code>##                       hgt0_Qs0e1n3                                wgt0_Qs0e1n3  
##  [40.6,48.5]; (1) of Qs0e1n3:10216   [1.4e+03,2.84e+03]; (1) of Qs0e1n3 :10105  
##  (48.5,50.2]; (2) of Qs0e1n3: 9895   (2.84e+03,3.21e+03]; (2) of Qs0e1n3:10056  
##  (50.2,58]; (3) of Qs0e1n3  : 9908   (3.21e+03,5.49e+03]; (3) of Qs0e1n3: 9858</code></pre>
</div>
<div id="apply-quantiles-functionally" class="section level5">
<h5><span class="header-section-number">2.4.2.5.3</span> Apply Quantiles Functionally</h5>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb259-1" title="1"><span class="co"># Function to handle list inputs with different quantiles vars and probabilities</span></a>
<a class="sourceLine" id="cb259-2" title="2">df_cut_by_sliced_quantiles_grps &lt;-<span class="st"> </span><span class="cf">function</span>(quantile.grp.list, df, vars.group_by, vars.arrange) {</a>
<a class="sourceLine" id="cb259-3" title="3">    vars.cts2quantile &lt;-<span class="st"> </span>quantile.grp.list<span class="op">$</span>vars</a>
<a class="sourceLine" id="cb259-4" title="4">    seq.quantiles &lt;-<span class="st"> </span>quantile.grp.list<span class="op">$</span>prob</a>
<a class="sourceLine" id="cb259-5" title="5">    <span class="kw">return</span>(<span class="kw">df_cut_by_sliced_quantiles</span>(df, vars.cts2quantile, seq.quantiles, vars.group_by, vars.arrange))</a>
<a class="sourceLine" id="cb259-6" title="6">}</a></code></pre></div>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb260-1" title="1"><span class="co"># Apply function</span></a>
<a class="sourceLine" id="cb260-2" title="2">df.cut.list &lt;-<span class="st"> </span><span class="kw">lapply</span>(list.cts2quantile, df_cut_by_sliced_quantiles_grps,</a>
<a class="sourceLine" id="cb260-3" title="3">                      <span class="dt">df=</span>df.select, <span class="dt">vars.group_by=</span>vars.group_by, <span class="dt">vars.arrange=</span>vars.arrange)</a></code></pre></div>
<pre><code>## Joining, by = &quot;quant.perc&quot;</code></pre>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb262-1" title="1"><span class="co"># Reduce Resulting Matrixes Together</span></a>
<a class="sourceLine" id="cb262-2" title="2">df.with.cut.quant.all &lt;-<span class="st"> </span><span class="kw">lapply</span>(df.cut.list, <span class="cf">function</span>(elist) elist<span class="op">$</span>df.with.cut.quant) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">reduce</span>(left_join)</a></code></pre></div>
<pre><code>## Joining, by = c(&quot;S.country&quot;, &quot;vil.id&quot;, &quot;indi.id&quot;, &quot;sex&quot;, &quot;svymthRound&quot;, &quot;momEdu&quot;, &quot;wealthIdx&quot;, &quot;hgt&quot;, &quot;wgt&quot;, &quot;hgt0&quot;, &quot;wgt0&quot;, &quot;prot&quot;, &quot;cal&quot;, &quot;p.A.prot&quot;,
## &quot;p.A.nProt&quot;)</code></pre>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb264-1" title="1"><span class="kw">dim</span>(df.with.cut.quant.all)</a></code></pre></div>
<pre><code>## [1] 30019    18</code></pre>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb266-1" title="1"><span class="co"># Obrain Newly Created Quantile Group Variables</span></a>
<a class="sourceLine" id="cb266-2" title="2">vars.quantile.cut.all &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">lapply</span>(df.cut.list, <span class="cf">function</span>(elist) <span class="kw">names</span>(elist<span class="op">$</span>vars.quantile.cut)))</a>
<a class="sourceLine" id="cb266-3" title="3">vars.quantile.cut.all</a></code></pre></div>
<pre><code>## [1] &quot;wealthIdx_Qs0e1n2&quot; &quot;hgt0_Qs0e1n3&quot;      &quot;wgt0_Qs0e1n3&quot;</code></pre>
</div>
<div id="summarize-by-groups" class="section level5">
<h5><span class="header-section-number">2.4.2.5.4</span> Summarize by Groups</h5>
<p>Summarize by all groups.</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb268-1" title="1"><span class="kw">summary</span>(df.with.cut.quant.all <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">one_of</span>(vars.quantile.cut.all)))</a></code></pre></div>
<pre><code>##                   wealthIdx_Qs0e1n2                      hgt0_Qs0e1n3                                wgt0_Qs0e1n3  
##  [1,7.3]; (1) of Qs0e1n2   :14936   [40.6,48.5]; (1) of Qs0e1n3:10216   [1.4e+03,2.84e+03]; (1) of Qs0e1n3 :10105  
##  (7.3,19.3]; (2) of Qs0e1n2:15083   (48.5,50.2]; (2) of Qs0e1n3: 9895   (2.84e+03,3.21e+03]; (2) of Qs0e1n3:10056  
##                                     (50.2,58]; (3) of Qs0e1n3  : 9908   (3.21e+03,5.49e+03]; (3) of Qs0e1n3: 9858</code></pre>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb270-1" title="1"><span class="co"># df.with.cut.quant.all %&gt;%</span></a>
<a class="sourceLine" id="cb270-2" title="2"><span class="co">#     group_by(!!!syms(vars.quantile.cut.all)) %&gt;%</span></a>
<a class="sourceLine" id="cb270-3" title="3"><span class="co">#     summarise_at(vars.cts2quantile, funs(mean, n()))</span></a></code></pre></div>
</div>
<div id="generate-joint-quantile-vars-unique-groups" class="section level5">
<h5><span class="header-section-number">2.4.2.5.5</span> Generate Joint Quantile Vars Unique Groups</h5>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb271-1" title="1"><span class="co"># Generate Joint Quantile Index Variable</span></a>
<a class="sourceLine" id="cb271-2" title="2">var.qjnt.grp.idx &lt;-<span class="st"> &#39;group.index&#39;</span></a>
<a class="sourceLine" id="cb271-3" title="3">df.with.cut.quant.all &lt;-<span class="st"> </span>df.with.cut.quant.all <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="op">!!</span><span class="dt">var.qjnt.grp.idx :=</span> <span class="kw">group_indices</span>(., <span class="op">!!!</span><span class="kw">syms</span>(vars.quantile.cut.all)))</a></code></pre></div>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb272-1" title="1">arr.group.idx &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">sort</span>(<span class="kw">unique</span>(df.with.cut.quant.all[[var.qjnt.grp.idx]])))</a>
<a class="sourceLine" id="cb272-2" title="2">arr.group.idx</a></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12] [,13] [,14] [,15] [,16] [,17] [,18]
## [1,]    1    2    3    4    5    6    7    8    9    10    11    12    13    14    15    16    17    18</code></pre>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb274-1" title="1">df.with.cut.quant.all <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(<span class="op">!!!</span><span class="kw">syms</span>(vars.quantile.cut.all), <span class="op">!!</span><span class="kw">sym</span>(var.qjnt.grp.idx)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb274-2" title="2"><span class="st">        </span><span class="kw">summarise_at</span>(vars.cts2quantile, <span class="kw">funs</span>(mean, <span class="kw">n</span>()))</a></code></pre></div>
<pre><code>## # A tibble: 18 x 10
## # Groups:   wealthIdx_Qs0e1n2, hgt0_Qs0e1n3, wgt0_Qs0e1n3 [18]
##    wealthIdx_Qs0e1n2        hgt0_Qs0e1n3             wgt0_Qs0e1n3                   group.index wealthIdx_mean hgt0_mean wgt0_mean wealthIdx_n hgt0_n wgt0_n
##    &lt;fct&gt;                    &lt;fct&gt;                    &lt;fct&gt;                                &lt;int&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;       &lt;int&gt;  &lt;int&gt;  &lt;int&gt;
##  1 [1,7.3]; (1) of Qs0e1n2  [40.6,48.5]; (1) of Qs0~ [1.4e+03,2.84e+03]; (1) of Qs~           1           5.31      46.6     2498.        3304   3304   3304
##  2 [1,7.3]; (1) of Qs0e1n2  [40.6,48.5]; (1) of Qs0~ (2.84e+03,3.21e+03]; (2) of Q~           2           5.08      47.6     2993.        1348   1348   1348
##  3 [1,7.3]; (1) of Qs0e1n2  [40.6,48.5]; (1) of Qs0~ (3.21e+03,5.49e+03]; (3) of Q~           3           3.64      47.7     3429.         362    362    362
##  4 [1,7.3]; (1) of Qs0e1n2  (48.5,50.2]; (2) of Qs0~ [1.4e+03,2.84e+03]; (1) of Qs~           4           6.04      49.2     2671.        1134   1134   1134
##  5 [1,7.3]; (1) of Qs0e1n2  (48.5,50.2]; (2) of Qs0~ (2.84e+03,3.21e+03]; (2) of Q~           5           5.36      49.3     3030.        2184   2184   2184
##  6 [1,7.3]; (1) of Qs0e1n2  (48.5,50.2]; (2) of Qs0~ (3.21e+03,5.49e+03]; (3) of Q~           6           4.36      49.6     3481.        1484   1484   1484
##  7 [1,7.3]; (1) of Qs0e1n2  (50.2,58]; (3) of Qs0e1~ [1.4e+03,2.84e+03]; (1) of Qs~           7           6.25      51.2     2666.         196    196    196
##  8 [1,7.3]; (1) of Qs0e1n2  (50.2,58]; (3) of Qs0e1~ (2.84e+03,3.21e+03]; (2) of Q~           8           5.45      51.0     3048.        1466   1466   1466
##  9 [1,7.3]; (1) of Qs0e1n2  (50.2,58]; (3) of Qs0e1~ (3.21e+03,5.49e+03]; (3) of Q~           9           4.06      51.8     3660.        3458   3458   3458
## 10 (7.3,19.3]; (2) of Qs0e~ [40.6,48.5]; (1) of Qs0~ [1.4e+03,2.84e+03]; (1) of Qs~          10           9.86      46.8     2540.        3438   3438   3438
## 11 (7.3,19.3]; (2) of Qs0e~ [40.6,48.5]; (1) of Qs0~ (2.84e+03,3.21e+03]; (2) of Q~          11          10.5       47.8     2980.        1440   1440   1440
## 12 (7.3,19.3]; (2) of Qs0e~ [40.6,48.5]; (1) of Qs0~ (3.21e+03,5.49e+03]; (3) of Q~          12          11.2       48.0     3403.         324    324    324
## 13 (7.3,19.3]; (2) of Qs0e~ (48.5,50.2]; (2) of Qs0~ [1.4e+03,2.84e+03]; (1) of Qs~          13          10.2       49.4     2679.        1709   1709   1709
## 14 (7.3,19.3]; (2) of Qs0e~ (48.5,50.2]; (2) of Qs0~ (2.84e+03,3.21e+03]; (2) of Q~          14          10.3       49.3     3024.        2034   2034   2034
## 15 (7.3,19.3]; (2) of Qs0e~ (48.5,50.2]; (2) of Qs0~ (3.21e+03,5.49e+03]; (3) of Q~          15          10.3       49.4     3387.        1350   1350   1350
## 16 (7.3,19.3]; (2) of Qs0e~ (50.2,58]; (3) of Qs0e1~ [1.4e+03,2.84e+03]; (1) of Qs~          16          10.5       50.9     2677.         324    324    324
## 17 (7.3,19.3]; (2) of Qs0e~ (50.2,58]; (3) of Qs0e1~ (2.84e+03,3.21e+03]; (2) of Q~          17          10.3       51.3     3060.        1584   1584   1584
## 18 (7.3,19.3]; (2) of Qs0e~ (50.2,58]; (3) of Qs0e1~ (3.21e+03,5.49e+03]; (3) of Q~          18          11.0       52.1     3623.        2880   2880   2880</code></pre>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb276-1" title="1">df.with.cut.quant.all  <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(<span class="op">!!!</span><span class="kw">syms</span>(vars.group_by)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="op">!!!</span><span class="kw">syms</span>(vars.arrange)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">slice</span>(1L) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb276-2" title="2"><span class="st">        </span><span class="kw">group_by</span>(<span class="op">!!!</span><span class="kw">syms</span>(vars.quantile.cut.all), <span class="op">!!</span><span class="kw">sym</span>(var.qjnt.grp.idx)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb276-3" title="3"><span class="st">        </span><span class="kw">summarise_at</span>(vars.cts2quantile, <span class="kw">funs</span>(mean, <span class="kw">n</span>()))</a></code></pre></div>
<pre><code>## # A tibble: 18 x 10
## # Groups:   wealthIdx_Qs0e1n2, hgt0_Qs0e1n3, wgt0_Qs0e1n3 [18]
##    wealthIdx_Qs0e1n2        hgt0_Qs0e1n3             wgt0_Qs0e1n3                   group.index wealthIdx_mean hgt0_mean wgt0_mean wealthIdx_n hgt0_n wgt0_n
##    &lt;fct&gt;                    &lt;fct&gt;                    &lt;fct&gt;                                &lt;int&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;       &lt;int&gt;  &lt;int&gt;  &lt;int&gt;
##  1 [1,7.3]; (1) of Qs0e1n2  [40.6,48.5]; (1) of Qs0~ [1.4e+03,2.84e+03]; (1) of Qs~           1           5.20      46.6     2499.         190    190    190
##  2 [1,7.3]; (1) of Qs0e1n2  [40.6,48.5]; (1) of Qs0~ (2.84e+03,3.21e+03]; (2) of Q~           2           4.96      47.6     2993.          78     78     78
##  3 [1,7.3]; (1) of Qs0e1n2  [40.6,48.5]; (1) of Qs0~ (3.21e+03,5.49e+03]; (3) of Q~           3           3.56      47.7     3431.          22     22     22
##  4 [1,7.3]; (1) of Qs0e1n2  (48.5,50.2]; (2) of Qs0~ [1.4e+03,2.84e+03]; (1) of Qs~           4           5.99      49.2     2671.          64     64     64
##  5 [1,7.3]; (1) of Qs0e1n2  (48.5,50.2]; (2) of Qs0~ (2.84e+03,3.21e+03]; (2) of Q~           5           5.25      49.3     3031.         126    126    126
##  6 [1,7.3]; (1) of Qs0e1n2  (48.5,50.2]; (2) of Qs0~ (3.21e+03,5.49e+03]; (3) of Q~           6           4.24      49.6     3485.          88     88     88
##  7 [1,7.3]; (1) of Qs0e1n2  (50.2,58]; (3) of Qs0e1~ [1.4e+03,2.84e+03]; (1) of Qs~           7           6.22      51.2     2666.          11     11     11
##  8 [1,7.3]; (1) of Qs0e1n2  (50.2,58]; (3) of Qs0e1~ (2.84e+03,3.21e+03]; (2) of Q~           8           5.36      51.0     3048.          84     84     84
##  9 [1,7.3]; (1) of Qs0e1n2  (50.2,58]; (3) of Qs0e1~ (3.21e+03,5.49e+03]; (3) of Q~           9           3.94      51.8     3667.         207    207    207
## 10 (7.3,19.3]; (2) of Qs0e~ [40.6,48.5]; (1) of Qs0~ [1.4e+03,2.84e+03]; (1) of Qs~          10           9.86      46.8     2540.         191    191    191
## 11 (7.3,19.3]; (2) of Qs0e~ [40.6,48.5]; (1) of Qs0~ (2.84e+03,3.21e+03]; (2) of Q~          11          10.5       47.8     2980.          80     80     80
## 12 (7.3,19.3]; (2) of Qs0e~ [40.6,48.5]; (1) of Qs0~ (3.21e+03,5.49e+03]; (3) of Q~          12          11.2       48.0     3403.          18     18     18
## 13 (7.3,19.3]; (2) of Qs0e~ (48.5,50.2]; (2) of Qs0~ [1.4e+03,2.84e+03]; (1) of Qs~          13          10.2       49.4     2678.          95     95     95
## 14 (7.3,19.3]; (2) of Qs0e~ (48.5,50.2]; (2) of Qs0~ (2.84e+03,3.21e+03]; (2) of Q~          14          10.3       49.3     3024.         113    113    113
## 15 (7.3,19.3]; (2) of Qs0e~ (48.5,50.2]; (2) of Qs0~ (3.21e+03,5.49e+03]; (3) of Q~          15          10.3       49.4     3387.          75     75     75
## 16 (7.3,19.3]; (2) of Qs0e~ (50.2,58]; (3) of Qs0e1~ [1.4e+03,2.84e+03]; (1) of Qs~          16          10.5       50.9     2677.          18     18     18
## 17 (7.3,19.3]; (2) of Qs0e~ (50.2,58]; (3) of Qs0e1~ (2.84e+03,3.21e+03]; (2) of Q~          17          10.3       51.3     3060.          88     88     88
## 18 (7.3,19.3]; (2) of Qs0e~ (50.2,58]; (3) of Qs0e1~ (3.21e+03,5.49e+03]; (3) of Q~          18          11.0       52.1     3623.         160    160    160</code></pre>
</div>
<div id="change-values-based-on-index" class="section level5">
<h5><span class="header-section-number">2.4.2.5.6</span> Change values Based on Index</h5>
<p>Index from 1 to 18, change input values based on index</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb278-1" title="1"><span class="co"># arr.group.idx.subsidy &lt;- arr.group.idx*2 - ((arr.group.idx)^2)*0.01</span></a>
<a class="sourceLine" id="cb278-2" title="2">arr.group.idx.subsidy &lt;-<span class="st"> </span>arr.group.idx<span class="op">*</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb278-3" title="3">df.with.cut.quant.all <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb278-4" title="4"><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">more_prot =</span> prot <span class="op">+</span><span class="st"> </span>arr.group.idx.subsidy[<span class="op">!!</span><span class="kw">sym</span>(var.qjnt.grp.idx)]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb278-5" title="5"><span class="st">        </span><span class="kw">group_by</span>(<span class="op">!!!</span><span class="kw">syms</span>(vars.quantile.cut.all), <span class="op">!!</span><span class="kw">sym</span>(var.qjnt.grp.idx))  <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb278-6" title="6"><span class="st">        </span><span class="kw">summarise_at</span>(<span class="kw">c</span>(<span class="st">&#39;more_prot&#39;</span>, <span class="st">&#39;prot&#39;</span>), <span class="kw">funs</span>(<span class="kw">mean</span>(., <span class="dt">na.rm=</span><span class="ot">TRUE</span>)))</a></code></pre></div>
<pre><code>## # A tibble: 18 x 6
## # Groups:   wealthIdx_Qs0e1n2, hgt0_Qs0e1n3, wgt0_Qs0e1n3 [18]
##    wealthIdx_Qs0e1n2          hgt0_Qs0e1n3                wgt0_Qs0e1n3                        group.index more_prot  prot
##    &lt;fct&gt;                      &lt;fct&gt;                       &lt;fct&gt;                                     &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt;
##  1 [1,7.3]; (1) of Qs0e1n2    [40.6,48.5]; (1) of Qs0e1n3 [1.4e+03,2.84e+03]; (1) of Qs0e1n3            1      14.1  12.1
##  2 [1,7.3]; (1) of Qs0e1n2    [40.6,48.5]; (1) of Qs0e1n3 (2.84e+03,3.21e+03]; (2) of Qs0e1n3           2      15.9  11.9
##  3 [1,7.3]; (1) of Qs0e1n2    [40.6,48.5]; (1) of Qs0e1n3 (3.21e+03,5.49e+03]; (3) of Qs0e1n3           3      27.2  21.2
##  4 [1,7.3]; (1) of Qs0e1n2    (48.5,50.2]; (2) of Qs0e1n3 [1.4e+03,2.84e+03]; (1) of Qs0e1n3            4      18.9  10.9
##  5 [1,7.3]; (1) of Qs0e1n2    (48.5,50.2]; (2) of Qs0e1n3 (2.84e+03,3.21e+03]; (2) of Qs0e1n3           5      22.3  12.3
##  6 [1,7.3]; (1) of Qs0e1n2    (48.5,50.2]; (2) of Qs0e1n3 (3.21e+03,5.49e+03]; (3) of Qs0e1n3           6      28.6  16.6
##  7 [1,7.3]; (1) of Qs0e1n2    (50.2,58]; (3) of Qs0e1n3   [1.4e+03,2.84e+03]; (1) of Qs0e1n3            7      25.5  11.5
##  8 [1,7.3]; (1) of Qs0e1n2    (50.2,58]; (3) of Qs0e1n3   (2.84e+03,3.21e+03]; (2) of Qs0e1n3           8      28.0  12.0
##  9 [1,7.3]; (1) of Qs0e1n2    (50.2,58]; (3) of Qs0e1n3   (3.21e+03,5.49e+03]; (3) of Qs0e1n3           9      34.7  16.7
## 10 (7.3,19.3]; (2) of Qs0e1n2 [40.6,48.5]; (1) of Qs0e1n3 [1.4e+03,2.84e+03]; (1) of Qs0e1n3           10      30.7  10.7
## 11 (7.3,19.3]; (2) of Qs0e1n2 [40.6,48.5]; (1) of Qs0e1n3 (2.84e+03,3.21e+03]; (2) of Qs0e1n3          11      34.8  12.8
## 12 (7.3,19.3]; (2) of Qs0e1n2 [40.6,48.5]; (1) of Qs0e1n3 (3.21e+03,5.49e+03]; (3) of Qs0e1n3          12      37.4  13.4
## 13 (7.3,19.3]; (2) of Qs0e1n2 (48.5,50.2]; (2) of Qs0e1n3 [1.4e+03,2.84e+03]; (1) of Qs0e1n3           13      37.4  11.4
## 14 (7.3,19.3]; (2) of Qs0e1n2 (48.5,50.2]; (2) of Qs0e1n3 (2.84e+03,3.21e+03]; (2) of Qs0e1n3          14      41.5  13.5
## 15 (7.3,19.3]; (2) of Qs0e1n2 (48.5,50.2]; (2) of Qs0e1n3 (3.21e+03,5.49e+03]; (3) of Qs0e1n3          15      43.9  13.9
## 16 (7.3,19.3]; (2) of Qs0e1n2 (50.2,58]; (3) of Qs0e1n3   [1.4e+03,2.84e+03]; (1) of Qs0e1n3           16      43.8  11.8
## 17 (7.3,19.3]; (2) of Qs0e1n2 (50.2,58]; (3) of Qs0e1n3   (2.84e+03,3.21e+03]; (2) of Qs0e1n3          17      47.9  13.9
## 18 (7.3,19.3]; (2) of Qs0e1n2 (50.2,58]; (3) of Qs0e1n3   (3.21e+03,5.49e+03]; (3) of Qs0e1n3          18      50.3  14.3</code></pre>

</div>
</div>
</div>
</div>
<div id="summarize-multiple-variables" class="section level2">
<h2><span class="header-section-number">2.5</span> Summarize Multiple Variables</h2>

<div id="generate-replace-variables" class="section level3">
<h3><span class="header-section-number">2.5.1</span> Generate Replace Variables</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/CodeDynaAsset/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R4Econ</a> Repository (<a href="https://fanwangecon.github.io/R4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository.</p>
</blockquote>
<div id="replace-na-for-multiple-variables" class="section level4">
<h4><span class="header-section-number">2.5.1.1</span> Replace NA for Multiple Variables</h4>
<p>Replace some variables NA by some values, and other variables’ NAs by other values.</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb280-1" title="1"><span class="co"># Define</span></a>
<a class="sourceLine" id="cb280-2" title="2">it_N &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb280-3" title="3">it_M &lt;-<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb280-4" title="4">svr_id &lt;-<span class="st"> &#39;date&#39;</span></a>
<a class="sourceLine" id="cb280-5" title="5"></a>
<a class="sourceLine" id="cb280-6" title="6"><span class="co"># NA dataframe</span></a>
<a class="sourceLine" id="cb280-7" title="7">df_NA &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(<span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">nrow=</span>it_N, <span class="dt">ncol=</span>it_M)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb280-8" title="8"><span class="st">  </span><span class="kw">rowid_to_column</span>(<span class="dt">var =</span> svr_id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb280-9" title="9"><span class="st">  </span><span class="kw">rename_at</span>(<span class="kw">vars</span>(<span class="kw">starts_with</span>(<span class="st">&quot;V&quot;</span>)),</a>
<a class="sourceLine" id="cb280-10" title="10">            <span class="kw">funs</span>(<span class="kw">str_replace</span>(., <span class="st">&quot;V&quot;</span>, <span class="st">&quot;var&quot;</span>)))</a>
<a class="sourceLine" id="cb280-11" title="11"><span class="kw">kable</span>(df_NA) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb280-12" title="12"><span class="st">  </span><span class="kw">kable_styling_fc</span>()</a></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
var1
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
var2
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
var3
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
var4
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
var5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb281-1" title="1"><span class="co"># Replace NA</span></a>
<a class="sourceLine" id="cb281-2" title="2">df_NA_replace &lt;-<span class="st"> </span>df_NA <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb281-3" title="3"><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(<span class="kw">one_of</span>(<span class="kw">c</span>(<span class="st">&#39;var1&#39;</span>, <span class="st">&#39;var2&#39;</span>))), <span class="kw">list</span>(<span class="op">~</span><span class="kw">replace_na</span>(., <span class="dv">0</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb281-4" title="4"><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(<span class="kw">one_of</span>(<span class="kw">c</span>(<span class="st">&#39;var3&#39;</span>, <span class="st">&#39;var5&#39;</span>))), <span class="kw">list</span>(<span class="op">~</span><span class="kw">replace_na</span>(., <span class="dv">99</span>)))</a>
<a class="sourceLine" id="cb281-5" title="5"><span class="kw">kable</span>(df_NA_replace) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb281-6" title="6"><span class="st">  </span><span class="kw">kable_styling_fc</span>()</a></code></pre></div>
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
var1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
var2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
var3
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
var4
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
var5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
99
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
99
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
99
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
99
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
99
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
99
</td>
</tr>
</tbody>
</table>
</div>
<div id="cumulative-sum-multiple-variables" class="section level4">
<h4><span class="header-section-number">2.5.1.2</span> Cumulative Sum Multiple Variables</h4>
<p>Each row is a different date, each column is the profit a firms earns on a date, we want to compute cumulatively how much a person is earning. Also renames variable names below jointly.</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb282-1" title="1"><span class="co"># Define</span></a>
<a class="sourceLine" id="cb282-2" title="2">it_N &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb282-3" title="3">it_M &lt;-<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb282-4" title="4">svr_id &lt;-<span class="st"> &#39;date&#39;</span></a>
<a class="sourceLine" id="cb282-5" title="5"></a>
<a class="sourceLine" id="cb282-6" title="6"><span class="co"># random dataframe, daily profit of firms</span></a>
<a class="sourceLine" id="cb282-7" title="7"><span class="co"># dp_fx: daily profit firm ID something</span></a>
<a class="sourceLine" id="cb282-8" title="8"><span class="kw">set.seed</span>(<span class="dv">123</span>)</a>
<a class="sourceLine" id="cb282-9" title="9">df_daily_profit &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(<span class="kw">matrix</span>(<span class="kw">rnorm</span>(it_N<span class="op">*</span>it_M), <span class="dt">nrow=</span>it_N, <span class="dt">ncol=</span>it_M)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb282-10" title="10"><span class="st">  </span><span class="kw">rowid_to_column</span>(<span class="dt">var =</span> svr_id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb282-11" title="11"><span class="st">  </span><span class="kw">rename_at</span>(<span class="kw">vars</span>(<span class="kw">starts_with</span>(<span class="st">&quot;V&quot;</span>)),</a>
<a class="sourceLine" id="cb282-12" title="12">            <span class="kw">funs</span>(<span class="kw">str_replace</span>(., <span class="st">&quot;V&quot;</span>, <span class="st">&quot;dp_f&quot;</span>)))</a>
<a class="sourceLine" id="cb282-13" title="13"><span class="kw">kable</span>(df_daily_profit) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb282-14" title="14"><span class="st">  </span><span class="kw">kable_styling_fc_wide</span>()</a></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:875px; ">
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dp_f1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dp_f2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dp_f3
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dp_f4
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dp_f5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-0.5604756
</td>
<td style="text-align:right;">
0.0705084
</td>
<td style="text-align:right;">
0.4609162
</td>
<td style="text-align:right;">
-0.4456620
</td>
<td style="text-align:right;">
0.4007715
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-0.2301775
</td>
<td style="text-align:right;">
0.1292877
</td>
<td style="text-align:right;">
-1.2650612
</td>
<td style="text-align:right;">
1.2240818
</td>
<td style="text-align:right;">
0.1106827
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1.5587083
</td>
<td style="text-align:right;">
1.7150650
</td>
<td style="text-align:right;">
-0.6868529
</td>
<td style="text-align:right;">
0.3598138
</td>
<td style="text-align:right;">
-0.5558411
</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb283-1" title="1"><span class="co"># cumulative sum with suffix</span></a>
<a class="sourceLine" id="cb283-2" title="2">df_cumu_profit_suffix &lt;-<span class="st"> </span>df_daily_profit <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb283-3" title="3"><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(<span class="kw">contains</span>(<span class="st">&#39;dp_f&#39;</span>)), <span class="dt">.funs =</span> <span class="kw">list</span>(<span class="dt">cumu =</span> <span class="op">~</span><span class="kw">cumsum</span>(.)))</a>
<a class="sourceLine" id="cb283-4" title="4"><span class="kw">kable</span>(df_cumu_profit_suffix) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb283-5" title="5"><span class="st">  </span><span class="kw">kable_styling_fc_wide</span>()</a></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:875px; ">
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dp_f1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dp_f2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dp_f3
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dp_f4
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dp_f5
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dp_f1_cumu
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dp_f2_cumu
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dp_f3_cumu
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dp_f4_cumu
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dp_f5_cumu
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-0.5604756
</td>
<td style="text-align:right;">
0.0705084
</td>
<td style="text-align:right;">
0.4609162
</td>
<td style="text-align:right;">
-0.4456620
</td>
<td style="text-align:right;">
0.4007715
</td>
<td style="text-align:right;">
-0.5604756
</td>
<td style="text-align:right;">
0.0705084
</td>
<td style="text-align:right;">
0.4609162
</td>
<td style="text-align:right;">
-0.4456620
</td>
<td style="text-align:right;">
0.4007715
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-0.2301775
</td>
<td style="text-align:right;">
0.1292877
</td>
<td style="text-align:right;">
-1.2650612
</td>
<td style="text-align:right;">
1.2240818
</td>
<td style="text-align:right;">
0.1106827
</td>
<td style="text-align:right;">
-0.7906531
</td>
<td style="text-align:right;">
0.1997961
</td>
<td style="text-align:right;">
-0.8041450
</td>
<td style="text-align:right;">
0.7784198
</td>
<td style="text-align:right;">
0.5114542
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1.5587083
</td>
<td style="text-align:right;">
1.7150650
</td>
<td style="text-align:right;">
-0.6868529
</td>
<td style="text-align:right;">
0.3598138
</td>
<td style="text-align:right;">
-0.5558411
</td>
<td style="text-align:right;">
0.7680552
</td>
<td style="text-align:right;">
1.9148611
</td>
<td style="text-align:right;">
-1.4909979
</td>
<td style="text-align:right;">
1.1382337
</td>
<td style="text-align:right;">
-0.0443870
</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb284-1" title="1"><span class="co"># cumulative sum variables naming to prefix</span></a>
<a class="sourceLine" id="cb284-2" title="2">df_cumu_profit &lt;-<span class="st"> </span>df_cumu_profit_suffix <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb284-3" title="3"><span class="st">  </span><span class="kw">rename_at</span>(<span class="kw">vars</span>(<span class="kw">contains</span>( <span class="st">&quot;_cumu&quot;</span>) ), <span class="kw">list</span>(<span class="op">~</span><span class="kw">paste</span>(<span class="st">&quot;cp_f&quot;</span>, <span class="kw">gsub</span>(<span class="st">&quot;_cumu&quot;</span>, <span class="st">&quot;&quot;</span>, .), <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb284-4" title="4"><span class="st">  </span><span class="kw">rename_at</span>(<span class="kw">vars</span>(<span class="kw">contains</span>( <span class="st">&quot;cp_f&quot;</span>) ), <span class="kw">list</span>(<span class="op">~</span><span class="kw">gsub</span>(<span class="st">&quot;dp_f&quot;</span>, <span class="st">&quot;&quot;</span>, .)))</a>
<a class="sourceLine" id="cb284-5" title="5"><span class="kw">kable</span>(df_cumu_profit) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb284-6" title="6"><span class="st">  </span><span class="kw">kable_styling_fc_wide</span>()</a></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:875px; ">
<table class="table table-striped table-hover table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
date
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dp_f1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dp_f2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dp_f3
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dp_f4
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dp_f5
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
cp_f1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
cp_f2
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
cp_f3
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
cp_f4
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
cp_f5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-0.5604756
</td>
<td style="text-align:right;">
0.0705084
</td>
<td style="text-align:right;">
0.4609162
</td>
<td style="text-align:right;">
-0.4456620
</td>
<td style="text-align:right;">
0.4007715
</td>
<td style="text-align:right;">
-0.5604756
</td>
<td style="text-align:right;">
0.0705084
</td>
<td style="text-align:right;">
0.4609162
</td>
<td style="text-align:right;">
-0.4456620
</td>
<td style="text-align:right;">
0.4007715
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-0.2301775
</td>
<td style="text-align:right;">
0.1292877
</td>
<td style="text-align:right;">
-1.2650612
</td>
<td style="text-align:right;">
1.2240818
</td>
<td style="text-align:right;">
0.1106827
</td>
<td style="text-align:right;">
-0.7906531
</td>
<td style="text-align:right;">
0.1997961
</td>
<td style="text-align:right;">
-0.8041450
</td>
<td style="text-align:right;">
0.7784198
</td>
<td style="text-align:right;">
0.5114542
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1.5587083
</td>
<td style="text-align:right;">
1.7150650
</td>
<td style="text-align:right;">
-0.6868529
</td>
<td style="text-align:right;">
0.3598138
</td>
<td style="text-align:right;">
-0.5558411
</td>
<td style="text-align:right;">
0.7680552
</td>
<td style="text-align:right;">
1.9148611
</td>
<td style="text-align:right;">
-1.4909979
</td>
<td style="text-align:right;">
1.1382337
</td>
<td style="text-align:right;">
-0.0443870
</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="array-matrix-dataframe.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="functions.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": [["Panel-Data-and-Optimization-with-R.pdf", "PDF"]],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
