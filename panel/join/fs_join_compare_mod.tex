% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames*,x11names*}{xcolor}
%
\documentclass[
]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Find Closest Values Along Grids},
  colorlinks=true,
  linkcolor=Maroon,
  filecolor=Maroon,
  citecolor=Blue,
  urlcolor=blue,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{3}
\usepackage{bbm}
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{array}
\usepackage{multirow}
\usepackage{wrapfig}
\usepackage{float}
% \floatplacement{figure}{H}
\usepackage[labelformat = empty]{caption}
\usepackage{colortbl}
\usepackage{pdflscape}
\usepackage{tabu}
\usepackage{threeparttable}
\usepackage{threeparttablex}
\usepackage[normalem]{ulem}
\usepackage{makecell}
\usepackage{xcolor}
% \setcounter{secnumdepth}{5}
% \setcounter{tocdepth}{5}
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{array}
\usepackage{multirow}
\usepackage{wrapfig}
\usepackage{float}
\usepackage{colortbl}
\usepackage{pdflscape}
\usepackage{tabu}
\usepackage{threeparttable}
\usepackage{threeparttablex}
\usepackage[normalem]{ulem}
\usepackage{makecell}
\usepackage{xcolor}
\ifluatex
  \usepackage{selnolig}  % disable illegal ligatures
\fi

\title{Find Closest Values Along Grids}
\author{\href{https://fanwangecon.github.io}{Fan Wang}}
\date{2021-01-10}

\begin{document}
\maketitle

{
\hypersetup{linkcolor=}
\setcounter{tocdepth}{3}
\tableofcontents
}
\hypertarget{find-closest-neighbor-on-grid}{%
\section{Find Closest Neighbor on
Grid}\label{find-closest-neighbor-on-grid}}

\begin{quote}
Go to the
\href{https://github.com/FanWangEcon//R4Econ/blob/master/panel/join//fs_join_compare.Rmd}{\textbf{RMD}},
\href{https://github.com/FanWangEcon//R4Econ/blob/master/panel/join//htmlpdfr/fs_join_compare.R}{\textbf{R}},
\href{https://github.com/FanWangEcon//R4Econ/blob/master/panel/join//htmlpdfr/fs_join_compare.pdf}{\textbf{PDF}},
or
\href{https://fanwangecon.github.io//R4Econ/panel/join//htmlpdfr/fs_join_compare.html}{\textbf{HTML}}
version of this file. Go back to
\href{http://fanwangecon.github.io/}{fan}'s
\href{https://fanwangecon.github.io/REconTools/}{REconTools} Package,
\href{https://fanwangecon.github.io/R4Econ/}{R Code Examples} Repository
(\href{https://fanwangecon.github.io/R4Econ/bookdown}{bookdown site}),
or \href{https://fanwangecon.github.io/Stat4Econ/}{Intro Stats with R}
Repository
(\href{https://fanwangecon.github.io/Stat4Econ/bookdown}{bookdown
site}).
\end{quote}

Using the
\href{https://tidyr.tidyverse.org/reference/pivot_wider.html}{pivot\_wider}
function in tidyr to reshape panel or other data structures

\hypertarget{closest-neighbor-on-grid}{%
\subsection{Closest Neighbor on Grid}\label{closest-neighbor-on-grid}}

There is a dataframe that provides \(V(coh, a, cev)\) levels. There is
another dataframe with \(\hat{V}(coh, a)\), for each \(coh, a\), find
the \(cev\) that such that the difference between \(\hat{V}(coh, a)\)
and \(V(coh, a, cev)\) is minimized.

\(V\) and \(\hat{V}\) information are stored in a dataframe in the
\href{https://github.com/FanWangEcon/R4Econ/tree/master/panel/join/_file/csv}{csv
folder} in the current directory. In fact, we have one \(V\) surface,
but multiple \(\hat{V}\) files, so we want to do the find closest
neighbor exercise for each one of the several \(\hat{V}\) files.

The structure is as follows: (1) Load in the \(V\) file, where
\(coh, a, cev\) are all variable attributes. (2) Merge with one
\(\hat{V}\) file. (3) Take the difference between the \(V\) and
\(\hat{V}\) columns, and take the absolute value of the difference. (4)
Group by \(coh, a\), and sort to get the smallest absolute difference
among the \(cev\) possibilities, and slice out the row for the smallest.
(5) Now We have \(V(coh, a, cev^{\star}(coh, a))\). (6) Do this for each
of the several \(\hat{V}\) files. (7) Stack the results from 1 through 6
together, generate a column that identifies which
simulation/exercise/counterfactual each of the \(\hat{V}\) file comes
from. (8) Visualize by plotting as subplot different \(a\), \(coh\) is
x-axis, different \(\hat{V}\) outcome are different lines, and
\(cev^{\star}\left(coh, a, \hat{V})\) is the y-axis outcome.

First, load the CEV file.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# folder}
\NormalTok{spt\_root }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}C:/Users/fan/R4Econ/panel/join/\_file/csv\textquotesingle{}}\NormalTok{)}
\CommentTok{\# cev surface file, the V file}
\NormalTok{snm\_cev\_surface }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}e\_19E1NEp99r99\_ITG\_PE\_cev\_subsettest.csv\textquotesingle{}}
\NormalTok{mt\_cev\_surface }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\AttributeTok{file =} \FunctionTok{file.path}\NormalTok{(spt\_root, snm\_cev\_surface))}
\NormalTok{tb\_cev\_surface }\OtherTok{\textless{}{-}} \FunctionTok{as\_tibble}\NormalTok{(mt\_cev\_surface) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}\AttributeTok{EjVcev =}\NormalTok{ EjV)}
\end{Highlighting}
\end{Shaded}

Second, loop over the V hat files, join V with V hat:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ls\_tb\_cev\_surfhat }\OtherTok{=} \FunctionTok{vector}\NormalTok{(}\AttributeTok{mode =} \StringTok{"list"}\NormalTok{, }\AttributeTok{length =} \DecValTok{4}\NormalTok{)}
\ControlFlowTok{for}\NormalTok{ (it\_simu\_counter }\ControlFlowTok{in} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{)) \{}

    \CommentTok{\# conditionally change file names}
    \ControlFlowTok{if}\NormalTok{ (it\_simu\_counter }\SpecialCharTok{==} \DecValTok{1}\NormalTok{) \{}
\NormalTok{        st\_counter }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}19E1NEp99r99\textquotesingle{}}
\NormalTok{    \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (it\_simu\_counter }\SpecialCharTok{==} \DecValTok{2}\NormalTok{) \{}
\NormalTok{        st\_counter }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}19E1NEp02r99\textquotesingle{}}
\NormalTok{    \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (it\_simu\_counter }\SpecialCharTok{==} \DecValTok{3}\NormalTok{) \{}
\NormalTok{        st\_counter }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}19E1NEp02per02ger99\textquotesingle{}}
\NormalTok{    \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (it\_simu\_counter }\SpecialCharTok{==} \DecValTok{4}\NormalTok{) \{}
\NormalTok{        st\_counter }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}19E1NEp02r02\textquotesingle{}}
\NormalTok{    \}}
\NormalTok{    snm\_v\_hat }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}e\_\textquotesingle{}}\NormalTok{, st\_counter, }\StringTok{\textquotesingle{}\_ITG\_PE\_subsettest.csv\textquotesingle{}}\NormalTok{)}
    
    \CommentTok{\# Overall path to files}
\NormalTok{    mt\_v\_hat }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\AttributeTok{file =} \FunctionTok{file.path}\NormalTok{(spt\_root, snm\_v\_hat))}
\NormalTok{    tb\_v\_hat }\OtherTok{\textless{}{-}} \FunctionTok{as\_tibble}\NormalTok{(mt\_v\_hat) }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{select}\NormalTok{(prod\_type\_lvl, statesid, EjV)}
    
    \CommentTok{\# Merge file using key }
\NormalTok{    tb\_cev\_surfhat }\OtherTok{\textless{}{-}}\NormalTok{ tb\_cev\_surface }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{left\_join}\NormalTok{(tb\_v\_hat, }\AttributeTok{by=}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}prod\_type\_lvl\textquotesingle{}}\OtherTok{=}\StringTok{\textquotesingle{}prod\_type\_lvl\textquotesingle{}}\NormalTok{, }
                                \StringTok{\textquotesingle{}statesid\textquotesingle{}}\OtherTok{=}\StringTok{\textquotesingle{}statesid\textquotesingle{}}\NormalTok{))) }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{arrange}\NormalTok{(statesid, prod\_type\_lvl, cev\_lvl) }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{mutate}\NormalTok{(}\AttributeTok{counter\_policy =}\NormalTok{ st\_counter)}
    
    \CommentTok{\# Store to list}
\NormalTok{    ls\_tb\_cev\_surfhat[[it\_simu\_counter]] }\OtherTok{\textless{}{-}}\NormalTok{ tb\_cev\_surfhat}
\NormalTok{\}}

\CommentTok{\# Display}
\FunctionTok{kable}\NormalTok{(ls\_tb\_cev\_surfhat[[}\DecValTok{1}\NormalTok{]][}\FunctionTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{40}\NormalTok{, }\DecValTok{5}\NormalTok{),]) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{kable\_styling\_fc\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{r|l|r|l|r|r|r|r|r|l}
\hline
X & cev\_st & cev\_lvl & prod\_type\_st & prod\_type\_lvl & statesid & cash\_tt & EjVcev & EjV & counter\_policy\\
\hline
\cellcolor{gray!6}{1} & \cellcolor{gray!6}{cev-2000} & \cellcolor{gray!6}{-0.2000} & \cellcolor{gray!6}{A0} & \cellcolor{gray!6}{0} & \cellcolor{gray!6}{526} & \cellcolor{gray!6}{32.84747} & \cellcolor{gray!6}{-1.0479929} & \cellcolor{gray!6}{-0.7957419} & \cellcolor{gray!6}{19E1NEp99r99}\\
\hline
1501 & cev-947 & -0.0947 & A0 & 0 & 526 & 32.84747 & -0.9079859 & -0.7957419 & 19E1NEp99r99\\
\hline
\cellcolor{gray!6}{3001} & \cellcolor{gray!6}{cev105} & \cellcolor{gray!6}{0.0105} & \cellcolor{gray!6}{A0} & \cellcolor{gray!6}{0} & \cellcolor{gray!6}{526} & \cellcolor{gray!6}{32.84747} & \cellcolor{gray!6}{-0.7880156} & \cellcolor{gray!6}{-0.7957419} & \cellcolor{gray!6}{19E1NEp99r99}\\
\hline
4501 & cev1157 & 0.1157 & A0 & 0 & 526 & 32.84747 & -0.6803586 & -0.7957419 & 19E1NEp99r99\\
\hline
\cellcolor{gray!6}{51} & \cellcolor{gray!6}{cev-2000} & \cellcolor{gray!6}{-0.2000} & \cellcolor{gray!6}{A2504} & \cellcolor{gray!6}{2504} & \cellcolor{gray!6}{526} & \cellcolor{gray!6}{32.90371} & \cellcolor{gray!6}{-1.0002921} & \cellcolor{gray!6}{-0.7504785} & \cellcolor{gray!6}{19E1NEp99r99}\\
\hline
1551 & cev-947 & -0.0947 & A2504 & 2504 & 526 & 32.90371 & -0.8613743 & -0.7504785 & 19E1NEp99r99\\
\hline
\cellcolor{gray!6}{3051} & \cellcolor{gray!6}{cev105} & \cellcolor{gray!6}{0.0105} & \cellcolor{gray!6}{A2504} & \cellcolor{gray!6}{2504} & \cellcolor{gray!6}{526} & \cellcolor{gray!6}{32.90371} & \cellcolor{gray!6}{-0.7423281} & \cellcolor{gray!6}{-0.7504785} & \cellcolor{gray!6}{19E1NEp99r99}\\
\hline
4551 & cev1157 & 0.1157 & A2504 & 2504 & 526 & 32.90371 & -0.6354620 & -0.7504785 & 19E1NEp99r99\\
\hline
\end{tabular}}
\end{table}

Third, sort each file, and keep only the best match rows that minimize
the absolute distance between \emph{EjV} and \emph{EjVcev}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ls\_tb\_cev\_matched }\OtherTok{=} \FunctionTok{vector}\NormalTok{(}\AttributeTok{mode =} \StringTok{"list"}\NormalTok{, }\AttributeTok{length =} \DecValTok{4}\NormalTok{)}
\ControlFlowTok{for}\NormalTok{ (it\_simu\_counter }\ControlFlowTok{in} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{)) \{}

    \CommentTok{\# Load merged file}
\NormalTok{    tb\_cev\_surfhat }\OtherTok{\textless{}{-}}\NormalTok{ ls\_tb\_cev\_surfhat[[it\_simu\_counter]]}

    \CommentTok{\# Difference Column}
\NormalTok{    tb\_cev\_surfhat }\OtherTok{\textless{}{-}}\NormalTok{ tb\_cev\_surfhat }\SpecialCharTok{\%\textgreater{}\%} 
      \FunctionTok{mutate}\NormalTok{(}\AttributeTok{EjVcev\_gap =} \FunctionTok{abs}\NormalTok{(EjVcev }\SpecialCharTok{{-}}\NormalTok{ EjV))}
    
    \CommentTok{\# Group by, Arrange and Slice, get lowest gap}
\NormalTok{    tb\_cev\_matched }\OtherTok{\textless{}{-}}\NormalTok{ tb\_cev\_surfhat }\SpecialCharTok{\%\textgreater{}\%} 
      \FunctionTok{arrange}\NormalTok{(statesid, prod\_type\_lvl, EjVcev\_gap) }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{group\_by}\NormalTok{(statesid, prod\_type\_lvl) }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{slice\_head}\NormalTok{(}\AttributeTok{n=}\DecValTok{1}\NormalTok{)}

    \CommentTok{\# Store to list}
\NormalTok{    ls\_tb\_cev\_matched[[it\_simu\_counter]] }\OtherTok{\textless{}{-}}\NormalTok{ tb\_cev\_matched}
\NormalTok{\}}

\CommentTok{\# Display}
\FunctionTok{kable}\NormalTok{(ls\_tb\_cev\_matched[[}\DecValTok{2}\NormalTok{]][}\FunctionTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{30}\NormalTok{, }\DecValTok{1}\NormalTok{),]) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{kable\_styling\_fc\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{r|l|r|l|r|r|r|r|r|l|r}
\hline
X & cev\_st & cev\_lvl & prod\_type\_st & prod\_type\_lvl & statesid & cash\_tt & EjVcev & EjV & counter\_policy & EjVcev\_gap\\
\hline
\cellcolor{gray!6}{3001} & \cellcolor{gray!6}{cev105} & \cellcolor{gray!6}{0.0105} & \cellcolor{gray!6}{A0} & \cellcolor{gray!6}{0} & \cellcolor{gray!6}{526} & \cellcolor{gray!6}{32.847471} & \cellcolor{gray!6}{-0.7880156} & \cellcolor{gray!6}{-0.7928034} & \cellcolor{gray!6}{19E1NEp02r99} & \cellcolor{gray!6}{0.0047878}\\
\hline
3051 & cev105 & 0.0105 & A2504 & 2504 & 526 & 32.903714 & -0.7423281 & -0.7480617 & 19E1NEp02r99 & 0.0057336\\
\hline
\cellcolor{gray!6}{3101} & \cellcolor{gray!6}{cev105} & \cellcolor{gray!6}{0.0105} & \cellcolor{gray!6}{A4145} & \cellcolor{gray!6}{4145} & \cellcolor{gray!6}{526} & \cellcolor{gray!6}{32.948970} & \cellcolor{gray!6}{-0.7082006} & \cellcolor{gray!6}{-0.7145418} & \cellcolor{gray!6}{19E1NEp02r99} & \cellcolor{gray!6}{0.0063412}\\
\hline
3151 & cev105 & 0.0105 & A5633 & 5633 & 526 & 32.996952 & -0.6753576 & -0.6818996 & 19E1NEp02r99 & 0.0065420\\
\hline
\cellcolor{gray!6}{3201} & \cellcolor{gray!6}{cev105} & \cellcolor{gray!6}{0.0105} & \cellcolor{gray!6}{A7274} & \cellcolor{gray!6}{7274} & \cellcolor{gray!6}{526} & \cellcolor{gray!6}{33.058832} & \cellcolor{gray!6}{-0.6368297} & \cellcolor{gray!6}{-0.6431710} & \cellcolor{gray!6}{19E1NEp02r99} & \cellcolor{gray!6}{0.0063413}\\
\hline
3251 & cev105 & 0.0105 & A9779 & 9779 & 526 & 33.175241 & -0.5711706 & -0.5774648 & 19E1NEp02r99 & 0.0062942\\
\hline
\cellcolor{gray!6}{3002} & \cellcolor{gray!6}{cev105} & \cellcolor{gray!6}{0.0105} & \cellcolor{gray!6}{A0} & \cellcolor{gray!6}{0} & \cellcolor{gray!6}{555} & \cellcolor{gray!6}{53.346587} & \cellcolor{gray!6}{-0.2985944} & \cellcolor{gray!6}{-0.3041922} & \cellcolor{gray!6}{19E1NEp02r99} & \cellcolor{gray!6}{0.0055978}\\
\hline
3052 & cev105 & 0.0105 & A2504 & 2504 & 555 & 53.815772 & -0.2617572 & -0.2680026 & 19E1NEp02r99 & 0.0062454\\
\hline
\cellcolor{gray!6}{3102} & \cellcolor{gray!6}{cev105} & \cellcolor{gray!6}{0.0105} & \cellcolor{gray!6}{A4145} & \cellcolor{gray!6}{4145} & \cellcolor{gray!6}{555} & \cellcolor{gray!6}{54.193302} & \cellcolor{gray!6}{-0.2340822} & \cellcolor{gray!6}{-0.2406142} & \cellcolor{gray!6}{19E1NEp02r99} & \cellcolor{gray!6}{0.0065320}\\
\hline
3152 & cev105 & 0.0105 & A5633 & 5633 & 555 & 54.593579 & -0.2067964 & -0.2134634 & 19E1NEp02r99 & 0.0066670\\
\hline
\cellcolor{gray!6}{3202} & \cellcolor{gray!6}{cev105} & \cellcolor{gray!6}{0.0105} & \cellcolor{gray!6}{A7274} & \cellcolor{gray!6}{7274} & \cellcolor{gray!6}{555} & \cellcolor{gray!6}{55.109790} & \cellcolor{gray!6}{-0.1740126} & \cellcolor{gray!6}{-0.1806320} & \cellcolor{gray!6}{19E1NEp02r99} & \cellcolor{gray!6}{0.0066194}\\
\hline
3252 & cev105 & 0.0105 & A9779 & 9779 & 555 & 56.080888 & -0.1169470 & -0.1236111 & 19E1NEp02r99 & 0.0066641\\
\hline
\cellcolor{gray!6}{3603} & \cellcolor{gray!6}{cev526} & \cellcolor{gray!6}{0.0526} & \cellcolor{gray!6}{A0} & \cellcolor{gray!6}{0} & \cellcolor{gray!6}{905} & \cellcolor{gray!6}{1.533025} & \cellcolor{gray!6}{-5.2530406} & \cellcolor{gray!6}{-5.2486887} & \cellcolor{gray!6}{19E1NEp02r99} & \cellcolor{gray!6}{0.0043519}\\
\hline
3353 & cev315 & 0.0315 & A2504 & 2504 & 905 & 1.714498 & -4.5517474 & -4.5408560 & 19E1NEp02r99 & 0.0108913\\
\hline
\cellcolor{gray!6}{3403} & \cellcolor{gray!6}{cev315} & \cellcolor{gray!6}{0.0315} & \cellcolor{gray!6}{A4145} & \cellcolor{gray!6}{4145} & \cellcolor{gray!6}{905} & \cellcolor{gray!6}{1.860521} & \cellcolor{gray!6}{-4.1039608} & \cellcolor{gray!6}{-4.1072736} & \cellcolor{gray!6}{19E1NEp02r99} & \cellcolor{gray!6}{0.0033128}\\
\hline
3453 & cev315 & 0.0315 & A5633 & 5633 & 905 & 2.015341 & -3.7465733 & -3.7611842 & 19E1NEp02r99 & 0.0146109\\
\hline
\cellcolor{gray!6}{3503} & \cellcolor{gray!6}{cev315} & \cellcolor{gray!6}{0.0315} & \cellcolor{gray!6}{A7274} & \cellcolor{gray!6}{7274} & \cellcolor{gray!6}{905} & \cellcolor{gray!6}{2.215003} & \cellcolor{gray!6}{-3.4101025} & \cellcolor{gray!6}{-3.4235413} & \cellcolor{gray!6}{19E1NEp02r99} & \cellcolor{gray!6}{0.0134388}\\
\hline
3553 & cev315 & 0.0315 & A9779 & 9779 & 905 & 2.590608 & -2.9413469 & -2.9535570 & 19E1NEp02r99 & 0.0122101\\
\hline
\cellcolor{gray!6}{3004} & \cellcolor{gray!6}{cev105} & \cellcolor{gray!6}{0.0105} & \cellcolor{gray!6}{A0} & \cellcolor{gray!6}{0} & \cellcolor{gray!6}{953} & \cellcolor{gray!6}{20.125381} & \cellcolor{gray!6}{-1.3249909} & \cellcolor{gray!6}{-1.3290865} & \cellcolor{gray!6}{19E1NEp02r99} & \cellcolor{gray!6}{0.0040957}\\
\hline
3054 & cev105 & 0.0105 & A2504 & 2504 & 953 & 20.306854 & -1.2476021 & -1.2531860 & 19E1NEp02r99 & 0.0055839\\
\hline
\cellcolor{gray!6}{3104} & \cellcolor{gray!6}{cev105} & \cellcolor{gray!6}{0.0105} & \cellcolor{gray!6}{A4145} & \cellcolor{gray!6}{4145} & \cellcolor{gray!6}{953} & \cellcolor{gray!6}{20.452876} & \cellcolor{gray!6}{-1.1916003} & \cellcolor{gray!6}{-1.1975215} & \cellcolor{gray!6}{19E1NEp02r99} & \cellcolor{gray!6}{0.0059211}\\
\hline
3154 & cev105 & 0.0105 & A5633 & 5633 & 953 & 20.607697 & -1.1383665 & -1.1444048 & 19E1NEp02r99 & 0.0060383\\
\hline
\cellcolor{gray!6}{3204} & \cellcolor{gray!6}{cev105} & \cellcolor{gray!6}{0.0105} & \cellcolor{gray!6}{A7274} & \cellcolor{gray!6}{7274} & \cellcolor{gray!6}{953} & \cellcolor{gray!6}{20.807359} & \cellcolor{gray!6}{-1.0766095} & \cellcolor{gray!6}{-1.0823344} & \cellcolor{gray!6}{19E1NEp02r99} & \cellcolor{gray!6}{0.0057250}\\
\hline
3254 & cev105 & 0.0105 & A9779 & 9779 & 953 & 21.182964 & -0.9729832 & -0.9781408 & 19E1NEp02r99 & 0.0051576\\
\hline
\cellcolor{gray!6}{3005} & \cellcolor{gray!6}{cev105} & \cellcolor{gray!6}{0.0105} & \cellcolor{gray!6}{A0} & \cellcolor{gray!6}{0} & \cellcolor{gray!6}{1017} & \cellcolor{gray!6}{63.774766} & \cellcolor{gray!6}{-0.1284542} & \cellcolor{gray!6}{-0.1342653} & \cellcolor{gray!6}{19E1NEp02r99} & \cellcolor{gray!6}{0.0058110}\\
\hline
3055 & cev105 & 0.0105 & A2504 & 2504 & 1017 & 64.298911 & -0.0967695 & -0.1031112 & 19E1NEp02r99 & 0.0063417\\
\hline
\cellcolor{gray!6}{3105} & \cellcolor{gray!6}{cev105} & \cellcolor{gray!6}{0.0105} & \cellcolor{gray!6}{A4145} & \cellcolor{gray!6}{4145} & \cellcolor{gray!6}{1017} & \cellcolor{gray!6}{64.720664} & \cellcolor{gray!6}{-0.0728485} & \cellcolor{gray!6}{-0.0793940} & \cellcolor{gray!6}{19E1NEp02r99} & \cellcolor{gray!6}{0.0065454}\\
\hline
3155 & cev105 & 0.0105 & A5633 & 5633 & 1017 & 65.167829 & -0.0490898 & -0.0557238 & 19E1NEp02r99 & 0.0066341\\
\hline
\cellcolor{gray!6}{3205} & \cellcolor{gray!6}{cev105} & \cellcolor{gray!6}{0.0105} & \cellcolor{gray!6}{A7274} & \cellcolor{gray!6}{7274} & \cellcolor{gray!6}{1017} & \cellcolor{gray!6}{65.744507} & \cellcolor{gray!6}{-0.0203378} & \cellcolor{gray!6}{-0.0269149} & \cellcolor{gray!6}{19E1NEp02r99} & \cellcolor{gray!6}{0.0065772}\\
\hline
3255 & cev105 & 0.0105 & A9779 & 9779 & 1017 & 66.829359 & 0.0299397 & 0.0233507 & 19E1NEp02r99 & 0.0065890\\
\hline
\end{tabular}}
\end{table}

Fourth, row\_bind results together.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Single dataframe with all results}
\NormalTok{tb\_cev\_matched\_all\_counter }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(bind\_rows, ls\_tb\_cev\_matched)}
\CommentTok{\# check size}
\FunctionTok{print}\NormalTok{(}\FunctionTok{dim}\NormalTok{(tb\_cev\_matched\_all\_counter))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1200   11
\end{verbatim}

Fifth, visualize results

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# select four from the productivity types}
\NormalTok{ar\_prod\_type\_lvl\_unique }\OtherTok{\textless{}{-}} \FunctionTok{unique}\NormalTok{(tb\_cev\_matched\_all\_counter }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{pull}\NormalTok{(prod\_type\_lvl))}
\NormalTok{ar\_prod\_type\_lvl\_selected }\OtherTok{\textless{}{-}}\NormalTok{ ar\_prod\_type\_lvl\_unique[}\FunctionTok{round}\NormalTok{(}\FunctionTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FunctionTok{length}\NormalTok{(ar\_prod\_type\_lvl\_unique), }\AttributeTok{length.out=}\DecValTok{4}\NormalTok{))]}
\CommentTok{\# graph}
\NormalTok{lineplot }\OtherTok{\textless{}{-}}\NormalTok{ tb\_cev\_matched\_all\_counter }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{filter}\NormalTok{(prod\_type\_lvl }\SpecialCharTok{\%in\%}\NormalTok{ ar\_prod\_type\_lvl\_selected) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{group\_by}\NormalTok{(prod\_type\_st, cash\_tt) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{cash\_tt, }\AttributeTok{y=}\NormalTok{cev\_lvl,}
               \AttributeTok{colour=}\NormalTok{counter\_policy, }\AttributeTok{linetype=}\NormalTok{counter\_policy, }\AttributeTok{shape=}\NormalTok{counter\_policy)) }\SpecialCharTok{+}
        \FunctionTok{facet\_wrap}\NormalTok{( }\SpecialCharTok{\textasciitilde{}}\NormalTok{ prod\_type\_st) }\SpecialCharTok{+}
        \FunctionTok{geom\_line}\NormalTok{() }\SpecialCharTok{+}
        \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
        \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{\textquotesingle{}Visualizing the positions of matched values\textquotesingle{}}\NormalTok{,}
             \AttributeTok{x =} \StringTok{\textquotesingle{}Resource Levels\textquotesingle{}}\NormalTok{,}
             \AttributeTok{y =} \StringTok{\textquotesingle{}CEV\textquotesingle{}}\NormalTok{,}
             \AttributeTok{caption =} \FunctionTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}https://fanwangecon.github.io/\textquotesingle{}}\NormalTok{,}
                              \StringTok{\textquotesingle{}R4Econ/panel/join/htmlpdfr/fs\_join\_compare.html\textquotesingle{}}\NormalTok{)) }
\FunctionTok{print}\NormalTok{(lineplot)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{fs_join_compare_mod_files/figure-latex/unnamed-chunk-5-1} \end{center}

\end{document}
