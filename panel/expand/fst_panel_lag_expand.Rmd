---
title: "Append Lagged Information as Additional Panel Variables"
output:
  html_notebook: default
  pdf_document: defaults
  html_document:
    df_print: paged
  word_document: default
urlcolor: blue
---

Back to **[Fan](https://fanwangecon.github.io/)**'s R4Econ Homepage **[Table of Content](https://fanwangecon.github.io/R4Econ/)

# Outline

There is a panel dataset, where each row is an observation at a date. 

1. There is a variable recorded for a panel, and a variable with date info, and another with obs info
  + @param svr_id_t string time variable name
  + @param svr_id_i string individual ID name
  + @param svr_data string variable name
  + related to new variable for t to be generated:
      - @param bl_gen_newgrp boolean if to generate new group or use svr_id_t levels directly
      - @param svr_tgrp string new of new group variable to be generated
  + ar_it_ct: array indicating new variable generated by svr_id_t
2. Compute averages over sub-groups of dates for each variable, with different ways of specifying date subgroups.
  + average(svr_data) over svr
2. Reshape data so each date is a variable for selected subset of key variables
3. Merge results from 2 back to main, so that each indi/date observation has as variables all lagged and forward information as additional variables. Append not n lag m forward, but full history as additional variables

# Package and Data Loading and Parameter Setting
```{r}
# Load Library
rm(list = ls())
library(tidyverse)
library(R4Econ)

# Select Cebu Only
df_hw_cebu <- df_hgt_wgt %>% filter(S.country == 'Cebu' & svymthRound <= 24)
str(df_hw_cebu)

# Count Unique
svr_unique_identifier = 'indi.id'
df_uniques_vil <- ff_summ_count_unique_by_groups(
  df_hw_cebu, ar_svr_group=c('S.country', 'vil.id'), svr_unique_identifier)
print(df_uniques_vil, n=20)
df_uniques_mth <- ff_summ_count_unique_by_groups(
  df_hw_cebu, ar_svr_group=c('S.country', 'svymthRound'),svr_unique_identifier)
print(df_uniques_mth, n=20)
df_uniques_mth <- ff_summ_count_unique_by_groups(
  df_hw_cebu, ar_svr_group=c('S.country'),svr_unique_identifier)
print(df_uniques_mth, n=20)
```

# Duplicate and flatten for all dates for Cebu
```{r}
# Load Library
svr_id_t <- 'svymthRound'
svr_id_i <- 'indi.id'
svr_data <- 'hgt'

bl_gen_newgrp <- FALSE

# Select dataset

```

