<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Linear Regression | Panel Data and Optimization with R</title>
  <meta name="description" content="R Examples Panel and Optimization." />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Linear Regression | Panel Data and Optimization with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="R Examples Panel and Optimization." />
  <meta name="github-repo" content="fanwangecon/R4Econ" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Linear Regression | Panel Data and Optimization with R" />
  
  <meta name="twitter:description" content="R Examples Panel and Optimization." />
  

<meta name="author" content="Fan Wang" />


<meta name="date" content="2020-04-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="panel.html"/>
<link rel="next" href="nonlinear-regression.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Panel Data and Optimization with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html"><i class="fa fa-check"></i><b>1</b> Array, Matrix, Dataframe</a><ul>
<li class="chapter" data-level="1.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#list"><i class="fa fa-check"></i><b>1.1</b> List</a><ul>
<li class="chapter" data-level="1.1.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#multiple-dimensional-list"><i class="fa fa-check"></i><b>1.1.1</b> Multiple Dimensional List</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#array"><i class="fa fa-check"></i><b>1.2</b> Array</a><ul>
<li class="chapter" data-level="1.2.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#array-basics"><i class="fa fa-check"></i><b>1.2.1</b> Array Basics</a></li>
<li class="chapter" data-level="1.2.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-arrays"><i class="fa fa-check"></i><b>1.2.2</b> Generate Arrays</a></li>
<li class="chapter" data-level="1.2.3" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#string-arrays"><i class="fa fa-check"></i><b>1.2.3</b> String Arrays</a></li>
<li class="chapter" data-level="1.2.4" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#mesh-matrix-and-vector"><i class="fa fa-check"></i><b>1.2.4</b> Mesh Matrix and Vector</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#matrix"><i class="fa fa-check"></i><b>1.3</b> Matrix</a><ul>
<li class="chapter" data-level="1.3.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-matrixes"><i class="fa fa-check"></i><b>1.3.1</b> Generate Matrixes</a></li>
<li class="chapter" data-level="1.3.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#linear-algebra"><i class="fa fa-check"></i><b>1.3.2</b> Linear Algebra</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#dataframes-tibble"><i class="fa fa-check"></i><b>1.4</b> Dataframes (Tibble)</a><ul>
<li class="chapter" data-level="1.4.1" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#generate-dataframe"><i class="fa fa-check"></i><b>1.4.1</b> Generate Dataframe</a></li>
<li class="chapter" data-level="1.4.2" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#draw-random-rows"><i class="fa fa-check"></i><b>1.4.2</b> Draw Random Rows</a></li>
<li class="chapter" data-level="1.4.3" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#variable-na-values"><i class="fa fa-check"></i><b>1.4.3</b> Variable NA Values</a></li>
<li class="chapter" data-level="1.4.4" data-path="array-matrix-dataframe.html"><a href="array-matrix-dataframe.html#string-values"><i class="fa fa-check"></i><b>1.4.4</b> String Values</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="summarize-data.html"><a href="summarize-data.html"><i class="fa fa-check"></i><b>2</b> Summarize Data</a><ul>
<li class="chapter" data-level="2.1" data-path="summarize-data.html"><a href="summarize-data.html#counting-observation"><i class="fa fa-check"></i><b>2.1</b> Counting Observation</a><ul>
<li class="chapter" data-level="2.1.1" data-path="summarize-data.html"><a href="summarize-data.html#uncount"><i class="fa fa-check"></i><b>2.1.1</b> Uncount</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="summarize-data.html"><a href="summarize-data.html#sorting-indexing-slicing"><i class="fa fa-check"></i><b>2.2</b> Sorting, Indexing, Slicing</a><ul>
<li class="chapter" data-level="2.2.1" data-path="summarize-data.html"><a href="summarize-data.html#sorting"><i class="fa fa-check"></i><b>2.2.1</b> Sorting</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="summarize-data.html"><a href="summarize-data.html#group-statistics"><i class="fa fa-check"></i><b>2.3</b> Group Statistics</a><ul>
<li class="chapter" data-level="2.3.1" data-path="summarize-data.html"><a href="summarize-data.html#groups-statistics"><i class="fa fa-check"></i><b>2.3.1</b> Groups Statistics</a></li>
<li class="chapter" data-level="2.3.2" data-path="summarize-data.html"><a href="summarize-data.html#one-variable-group-summary"><i class="fa fa-check"></i><b>2.3.2</b> One Variable Group Summary</a></li>
<li class="chapter" data-level="2.3.3" data-path="summarize-data.html"><a href="summarize-data.html#nested-within-group-stats"><i class="fa fa-check"></i><b>2.3.3</b> Nested within Group Stats</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="summarize-data.html"><a href="summarize-data.html#distributional-statistics"><i class="fa fa-check"></i><b>2.4</b> Distributional Statistics</a><ul>
<li class="chapter" data-level="2.4.1" data-path="summarize-data.html"><a href="summarize-data.html#histogram"><i class="fa fa-check"></i><b>2.4.1</b> Histogram</a></li>
<li class="chapter" data-level="2.4.2" data-path="summarize-data.html"><a href="summarize-data.html#joint-quantiles-from-continuous"><i class="fa fa-check"></i><b>2.4.2</b> Joint Quantiles from Continuous</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="summarize-data.html"><a href="summarize-data.html#summarize-multiple-variables"><i class="fa fa-check"></i><b>2.5</b> Summarize Multiple Variables</a><ul>
<li class="chapter" data-level="2.5.1" data-path="summarize-data.html"><a href="summarize-data.html#generate-replace-variables"><i class="fa fa-check"></i><b>2.5.1</b> Generate Replace Variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>3</b> Functions</a><ul>
<li class="chapter" data-level="3.1" data-path="functions.html"><a href="functions.html#dataframe-mutate"><i class="fa fa-check"></i><b>3.1</b> Dataframe Mutate</a><ul>
<li class="chapter" data-level="3.1.1" data-path="functions.html"><a href="functions.html#row-input-functions"><i class="fa fa-check"></i><b>3.1.1</b> Row Input Functions</a></li>
<li class="chapter" data-level="3.1.2" data-path="functions.html"><a href="functions.html#evaluate-choices-across-states"><i class="fa fa-check"></i><b>3.1.2</b> Evaluate Choices Across States</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="functions.html"><a href="functions.html#dataframe-do-anything"><i class="fa fa-check"></i><b>3.2</b> Dataframe Do Anything</a><ul>
<li class="chapter" data-level="3.2.1" data-path="functions.html"><a href="functions.html#mxq-to-mxp-rows"><i class="fa fa-check"></i><b>3.2.1</b> MxQ to MxP Rows</a></li>
<li class="chapter" data-level="3.2.2" data-path="functions.html"><a href="functions.html#mx1-to-mxq-rows"><i class="fa fa-check"></i><b>3.2.2</b> Mx1 to MxQ Rows</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="functions.html"><a href="functions.html#apply-and-pmap"><i class="fa fa-check"></i><b>3.3</b> Apply and pmap</a><ul>
<li class="chapter" data-level="3.3.1" data-path="functions.html"><a href="functions.html#apply-sapply-mutate"><i class="fa fa-check"></i><b>3.3.1</b> Apply, Sapply, Mutate</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="panel.html"><a href="panel.html"><i class="fa fa-check"></i><b>4</b> Panel</a><ul>
<li class="chapter" data-level="4.1" data-path="panel.html"><a href="panel.html#generate-and-join"><i class="fa fa-check"></i><b>4.1</b> Generate and Join</a><ul>
<li class="chapter" data-level="4.1.1" data-path="panel.html"><a href="panel.html#generate-panel-structure"><i class="fa fa-check"></i><b>4.1.1</b> Generate Panel Structure</a></li>
<li class="chapter" data-level="4.1.2" data-path="panel.html"><a href="panel.html#join-datasets"><i class="fa fa-check"></i><b>4.1.2</b> Join Datasets</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="panel.html"><a href="panel.html#wide-and-long"><i class="fa fa-check"></i><b>4.2</b> Wide and Long</a><ul>
<li class="chapter" data-level="4.2.1" data-path="panel.html"><a href="panel.html#long-to-wide"><i class="fa fa-check"></i><b>4.2.1</b> Long to Wide</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i><b>5</b> Linear Regression</a><ul>
<li class="chapter" data-level="5.1" data-path="linear-regression.html"><a href="linear-regression.html#ols-and-iv"><i class="fa fa-check"></i><b>5.1</b> OLS and IV</a><ul>
<li class="chapter" data-level="5.1.1" data-path="linear-regression.html"><a href="linear-regression.html#ols-and-iv-regression"><i class="fa fa-check"></i><b>5.1.1</b> OLS and IV Regression</a></li>
<li class="chapter" data-level="5.1.2" data-path="linear-regression.html"><a href="linear-regression.html#iv-loop-over-rhs"><i class="fa fa-check"></i><b>5.1.2</b> IV Loop over RHS</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="linear-regression.html"><a href="linear-regression.html#decomposition"><i class="fa fa-check"></i><b>5.2</b> Decomposition</a><ul>
<li class="chapter" data-level="5.2.1" data-path="linear-regression.html"><a href="linear-regression.html#decompose-rhs"><i class="fa fa-check"></i><b>5.2.1</b> Decompose RHS</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html"><i class="fa fa-check"></i><b>6</b> Nonlinear Regression</a><ul>
<li class="chapter" data-level="6.1" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html#logit-regression"><i class="fa fa-check"></i><b>6.1</b> Logit Regression</a><ul>
<li class="chapter" data-level="6.1.1" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html#binary-logit"><i class="fa fa-check"></i><b>6.1.1</b> Binary Logit</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="optimization.html"><a href="optimization.html"><i class="fa fa-check"></i><b>7</b> Optimization</a><ul>
<li class="chapter" data-level="7.1" data-path="optimization.html"><a href="optimization.html#bisection"><i class="fa fa-check"></i><b>7.1</b> Bisection</a><ul>
<li class="chapter" data-level="7.1.1" data-path="optimization.html"><a href="optimization.html#bisection-1"><i class="fa fa-check"></i><b>7.1.1</b> Bisection</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://fanwangecon.github.io/R4Econ/" target="blank">R4Econ</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Panel Data and Optimization with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="linear-regression" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> Linear Regression</h1>

<div id="ols-and-iv" class="section level2">
<h2><span class="header-section-number">5.1</span> OLS and IV</h2>

<p>Back to <strong><a href="https://fanwangecon.github.io/">Fan</a></strong>’s R4Econ Homepage <strong><a href="https://fanwangecon.github.io/R4Econ/">Table of Content</a></strong></p>
<div id="ols-and-iv-regression" class="section level3">
<h3><span class="header-section-number">5.1.1</span> OLS and IV Regression</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/CodeDynaAsset/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R4Econ</a> Repository, or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository.</p>
</blockquote>
<p>IV regression using AER package. Option to store all results in dataframe row for combining results from other estimations together. Produce Row Statistics.</p>
<div id="construct-program" class="section level4">
<h4><span class="header-section-number">5.1.1.1</span> Construct Program</h4>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb361-1" title="1"><span class="co"># IV regression function</span></a>
<a class="sourceLine" id="cb361-2" title="2"><span class="co"># The code below uses the AER library&#39;s regresison function</span></a>
<a class="sourceLine" id="cb361-3" title="3"><span class="co"># All results are stored in a single row as data_frame</span></a>
<a class="sourceLine" id="cb361-4" title="4"><span class="co"># This functoin could work with dplyr do</span></a>
<a class="sourceLine" id="cb361-5" title="5"><span class="co"># var.y is single outcome, vars.x, vars.c and vars.z are vectors of endogenous variables, controls and instruments.</span></a>
<a class="sourceLine" id="cb361-6" title="6">regf.iv &lt;-<span class="st"> </span><span class="cf">function</span>(var.y, vars.x, vars.c, vars.z, df, <span class="dt">transpose=</span><span class="ot">TRUE</span>) {</a>
<a class="sourceLine" id="cb361-7" title="7"></a>
<a class="sourceLine" id="cb361-8" title="8"><span class="co">#     print(length(vars.z))</span></a>
<a class="sourceLine" id="cb361-9" title="9"></a>
<a class="sourceLine" id="cb361-10" title="10">    <span class="co"># A. Set-Up Equation</span></a>
<a class="sourceLine" id="cb361-11" title="11">    str.vars.x &lt;-<span class="st"> </span><span class="kw">paste</span>(vars.x, <span class="dt">collapse=</span><span class="st">&#39;+&#39;</span>)</a>
<a class="sourceLine" id="cb361-12" title="12">    str.vars.c &lt;-<span class="st"> </span><span class="kw">paste</span>(vars.c, <span class="dt">collapse=</span><span class="st">&#39;+&#39;</span>)</a>
<a class="sourceLine" id="cb361-13" title="13"></a>
<a class="sourceLine" id="cb361-14" title="14">    df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">one_of</span>(var.y, vars.x, vars.c, vars.z)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">drop_na</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter_all</span>(<span class="kw">all_vars</span>(<span class="op">!</span><span class="kw">is.infinite</span>(.)))</a>
<a class="sourceLine" id="cb361-15" title="15"></a>
<a class="sourceLine" id="cb361-16" title="16">    <span class="cf">if</span> (<span class="kw">length</span>(vars.z) <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb361-17" title="17">        <span class="co">#     library(AER)</span></a>
<a class="sourceLine" id="cb361-18" title="18">            str.vars.z &lt;-<span class="st"> </span><span class="kw">paste</span>(vars.z, <span class="dt">collapse=</span><span class="st">&#39;+&#39;</span>)</a>
<a class="sourceLine" id="cb361-19" title="19">            equa.iv &lt;-<span class="st"> </span><span class="kw">paste</span>(var.y,</a>
<a class="sourceLine" id="cb361-20" title="20">                             <span class="kw">paste</span>(<span class="kw">paste</span>(str.vars.x, str.vars.c, <span class="dt">sep=</span><span class="st">&#39;+&#39;</span>),</a>
<a class="sourceLine" id="cb361-21" title="21">                                   <span class="kw">paste</span>(str.vars.z, str.vars.c, <span class="dt">sep=</span><span class="st">&#39;+&#39;</span>),</a>
<a class="sourceLine" id="cb361-22" title="22">                                   <span class="dt">sep=</span><span class="st">&#39;|&#39;</span>),</a>
<a class="sourceLine" id="cb361-23" title="23">                             <span class="dt">sep=</span><span class="st">&#39;~&#39;</span>)</a>
<a class="sourceLine" id="cb361-24" title="24">        <span class="co">#     print(equa.iv)</span></a>
<a class="sourceLine" id="cb361-25" title="25"></a>
<a class="sourceLine" id="cb361-26" title="26">        <span class="co"># B. IV Regression</span></a>
<a class="sourceLine" id="cb361-27" title="27">        ivreg.summ &lt;-<span class="st"> </span><span class="kw">summary</span>(<span class="kw">ivreg</span>(<span class="kw">as.formula</span>(equa.iv), <span class="dt">data=</span>df),</a>
<a class="sourceLine" id="cb361-28" title="28">                              <span class="dt">vcov =</span> sandwich, <span class="dt">df =</span> <span class="ot">Inf</span>, <span class="dt">diagnostics =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb361-29" title="29"></a>
<a class="sourceLine" id="cb361-30" title="30">        <span class="co"># C. Statistics from IV Regression</span></a>
<a class="sourceLine" id="cb361-31" title="31">    <span class="co">#     ivreg.summ$coef</span></a>
<a class="sourceLine" id="cb361-32" title="32">    <span class="co">#     ivreg.summ$diagnostics</span></a>
<a class="sourceLine" id="cb361-33" title="33"></a>
<a class="sourceLine" id="cb361-34" title="34">        <span class="co"># D. Combine Regression Results into a Matrix</span></a>
<a class="sourceLine" id="cb361-35" title="35">        df.results &lt;-<span class="st"> </span><span class="kw">suppressMessages</span>(<span class="kw">as_tibble</span>(ivreg.summ<span class="op">$</span>coef, <span class="dt">rownames=</span><span class="st">&#39;rownames&#39;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb361-36" title="36"><span class="st">            </span><span class="kw">full_join</span>(<span class="kw">as_tibble</span>(ivreg.summ<span class="op">$</span>diagnostics, <span class="dt">rownames=</span><span class="st">&#39;rownames&#39;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb361-37" title="37"><span class="st">            </span><span class="kw">full_join</span>(<span class="kw">tibble</span>(<span class="dt">rownames=</span><span class="kw">c</span>(<span class="st">&#39;vars&#39;</span>),</a>
<a class="sourceLine" id="cb361-38" title="38">                             <span class="dt">var.y=</span>var.y,</a>
<a class="sourceLine" id="cb361-39" title="39">                             <span class="dt">vars.x=</span>str.vars.x,</a>
<a class="sourceLine" id="cb361-40" title="40">                             <span class="dt">vars.z=</span>str.vars.z,</a>
<a class="sourceLine" id="cb361-41" title="41">                             <span class="dt">vars.c=</span>str.vars.c)))</a>
<a class="sourceLine" id="cb361-42" title="42">    } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb361-43" title="43"></a>
<a class="sourceLine" id="cb361-44" title="44">        <span class="co"># OLS regression</span></a>
<a class="sourceLine" id="cb361-45" title="45">        equa.ols &lt;-<span class="st"> </span><span class="kw">paste</span>(var.y,</a>
<a class="sourceLine" id="cb361-46" title="46">                          <span class="kw">paste</span>(<span class="kw">paste</span>(vars.x, <span class="dt">collapse=</span><span class="st">&#39;+&#39;</span>),</a>
<a class="sourceLine" id="cb361-47" title="47">                                <span class="kw">paste</span>(vars.c, <span class="dt">collapse=</span><span class="st">&#39;+&#39;</span>), <span class="dt">sep=</span><span class="st">&#39;+&#39;</span>),</a>
<a class="sourceLine" id="cb361-48" title="48">                          <span class="dt">sep=</span><span class="st">&#39;~&#39;</span>)</a>
<a class="sourceLine" id="cb361-49" title="49"></a>
<a class="sourceLine" id="cb361-50" title="50">        lmreg.summ &lt;-<span class="st"> </span><span class="kw">summary</span>(<span class="kw">lm</span>(<span class="kw">as.formula</span>(equa.ols), <span class="dt">data=</span>df))</a>
<a class="sourceLine" id="cb361-51" title="51"></a>
<a class="sourceLine" id="cb361-52" title="52">        lm.diagnostics &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(<span class="kw">list</span>(<span class="dt">df1=</span>lmreg.summ<span class="op">$</span>df[[<span class="dv">1</span>]],</a>
<a class="sourceLine" id="cb361-53" title="53">                                         <span class="dt">df2=</span>lmreg.summ<span class="op">$</span>df[[<span class="dv">2</span>]],</a>
<a class="sourceLine" id="cb361-54" title="54">                                         <span class="dt">df3=</span>lmreg.summ<span class="op">$</span>df[[<span class="dv">3</span>]],</a>
<a class="sourceLine" id="cb361-55" title="55">                                         <span class="dt">sigma=</span>lmreg.summ<span class="op">$</span>sigma,</a>
<a class="sourceLine" id="cb361-56" title="56">                                         <span class="dt">r.squared=</span>lmreg.summ<span class="op">$</span>r.squared,</a>
<a class="sourceLine" id="cb361-57" title="57">                                         <span class="dt">adj.r.squared=</span>lmreg.summ<span class="op">$</span>adj.r.squared)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb361-58" title="58"><span class="st">                                         </span><span class="kw">gather</span>(variable, value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb361-59" title="59"><span class="st">                                         </span><span class="kw">rename</span>(<span class="dt">rownames =</span> variable) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb361-60" title="60"><span class="st">                                         </span><span class="kw">rename</span>(<span class="dt">v =</span> value)</a>
<a class="sourceLine" id="cb361-61" title="61"></a>
<a class="sourceLine" id="cb361-62" title="62">        df.results &lt;-<span class="st"> </span><span class="kw">suppressMessages</span>(<span class="kw">as_tibble</span>(lmreg.summ<span class="op">$</span>coef, <span class="dt">rownames=</span><span class="st">&#39;rownames&#39;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb361-63" title="63"><span class="st">            </span><span class="kw">full_join</span>(lm.diagnostics) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb361-64" title="64"><span class="st">            </span><span class="kw">full_join</span>(<span class="kw">tibble</span>(<span class="dt">rownames=</span><span class="kw">c</span>(<span class="st">&#39;vars&#39;</span>),</a>
<a class="sourceLine" id="cb361-65" title="65">                             <span class="dt">var.y=</span>var.y,</a>
<a class="sourceLine" id="cb361-66" title="66">                             <span class="dt">vars.x=</span>str.vars.x,</a>
<a class="sourceLine" id="cb361-67" title="67">                             <span class="dt">vars.c=</span>str.vars.c)))</a>
<a class="sourceLine" id="cb361-68" title="68">    }</a>
<a class="sourceLine" id="cb361-69" title="69"></a>
<a class="sourceLine" id="cb361-70" title="70">    <span class="co"># E. Flatten Matrix, All IV results as a single tibble row to be combined with other IV results</span></a>
<a class="sourceLine" id="cb361-71" title="71">    df.row.results &lt;-<span class="st"> </span>df.results <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb361-72" title="72"><span class="st">        </span><span class="kw">gather</span>(variable, value, <span class="op">-</span>rownames) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb361-73" title="73"><span class="st">        </span><span class="kw">drop_na</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb361-74" title="74"><span class="st">        </span><span class="kw">unite</span>(esti.val, rownames, variable) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb361-75" title="75"><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">esti.val =</span> <span class="kw">gsub</span>(<span class="st">&#39; &#39;</span>, <span class="st">&#39;&#39;</span>, esti.val))</a>
<a class="sourceLine" id="cb361-76" title="76"></a>
<a class="sourceLine" id="cb361-77" title="77">    <span class="cf">if</span> (transpose) {</a>
<a class="sourceLine" id="cb361-78" title="78">      df.row.results &lt;-<span class="st"> </span>df.row.results <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">spread</span>(esti.val, value)</a>
<a class="sourceLine" id="cb361-79" title="79">    }</a>
<a class="sourceLine" id="cb361-80" title="80"></a>
<a class="sourceLine" id="cb361-81" title="81">    <span class="co"># F. Return</span></a>
<a class="sourceLine" id="cb361-82" title="82">    <span class="kw">return</span>(<span class="kw">data.frame</span>(df.row.results))</a>
<a class="sourceLine" id="cb361-83" title="83">}</a></code></pre></div>
</div>
<div id="program-testing-1" class="section level4">
<h4><span class="header-section-number">5.1.1.2</span> Program Testing</h4>
<p>Load Data</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb362-1" title="1"><span class="co"># Library</span></a>
<a class="sourceLine" id="cb362-2" title="2"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb362-3" title="3"><span class="kw">library</span>(AER)</a>
<a class="sourceLine" id="cb362-4" title="4"></a>
<a class="sourceLine" id="cb362-5" title="5"><span class="co"># Load Sample Data</span></a>
<a class="sourceLine" id="cb362-6" title="6"><span class="kw">setwd</span>(<span class="st">&#39;C:/Users/fan/R4Econ/_data/&#39;</span>)</a>
<a class="sourceLine" id="cb362-7" title="7">df &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;height_weight.csv&#39;</span>)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   S.country = col_character(),
##   vil.id = col_double(),
##   indi.id = col_double(),
##   sex = col_character(),
##   svymthRound = col_double(),
##   momEdu = col_double(),
##   wealthIdx = col_double(),
##   hgt = col_double(),
##   wgt = col_double(),
##   hgt0 = col_double(),
##   wgt0 = col_double(),
##   prot = col_double(),
##   cal = col_double(),
##   p.A.prot = col_double(),
##   p.A.nProt = col_double()
## )</code></pre>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb364-1" title="1"><span class="co"># Setting</span></a>
<a class="sourceLine" id="cb364-2" title="2"><span class="kw">options</span>(<span class="dt">repr.matrix.max.rows=</span><span class="dv">50</span>, <span class="dt">repr.matrix.max.cols=</span><span class="dv">50</span>)</a></code></pre></div>
<div id="example-no-instrument-ols" class="section level5">
<h5><span class="header-section-number">5.1.1.2.1</span> Example No Instrument, OLS</h5>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb365-1" title="1"><span class="co"># One Instrucments</span></a>
<a class="sourceLine" id="cb365-2" title="2">var.y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;hgt&#39;</span>)</a>
<a class="sourceLine" id="cb365-3" title="3">vars.x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;prot&#39;</span>)</a>
<a class="sourceLine" id="cb365-4" title="4">vars.z &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb365-5" title="5">vars.c &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;sex&#39;</span>, <span class="st">&#39;hgt0&#39;</span>, <span class="st">&#39;wgt0&#39;</span>)</a>
<a class="sourceLine" id="cb365-6" title="6"><span class="co"># Regression</span></a>
<a class="sourceLine" id="cb365-7" title="7"><span class="kw">regf.iv</span>(var.y, vars.x, vars.c, vars.z, df, <span class="dt">transpose=</span><span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>##                 esti.val                 value
## 1   (Intercept)_Estimate      52.1186286658651
## 2          prot_Estimate     0.374472386357917
## 3       sexMale_Estimate     0.611043720578292
## 4          hgt0_Estimate     0.148513781160842
## 5          wgt0_Estimate   0.00150560230505631
## 6  (Intercept)_Std.Error      1.57770483608693
## 7         prot_Std.Error   0.00418121191133815
## 8      sexMale_Std.Error     0.118396259120659
## 9         hgt0_Std.Error    0.0393807494783186
## 10        wgt0_Std.Error  0.000187123663624397
## 11    (Intercept)_tvalue      33.0344608660332
## 12           prot_tvalue      89.5607288744356
## 13        sexMale_tvalue      5.16100529794248
## 14           hgt0_tvalue      3.77122790013449
## 15           wgt0_tvalue      8.04602836377991
## 16  (Intercept)_Pr(&gt;|t|) 9.92126150975783e-233
## 17         prot_Pr(&gt;|t|)                     0
## 18      sexMale_Pr(&gt;|t|)  2.48105505495642e-07
## 19         hgt0_Pr(&gt;|t|)  0.000162939618371183
## 20         wgt0_Pr(&gt;|t|)  9.05257561534111e-16
## 21                 df1_v                     5
## 22                 df2_v                 18958
## 23                 df3_v                     5
## 24               sigma_v      8.06197784622979
## 25           r.squared_v     0.319078711001325
## 26       adj.r.squared_v     0.318935041565942
## 27            vars_var.y                   hgt
## 28           vars_vars.x                  prot
## 29           vars_vars.c         sex+hgt0+wgt0</code></pre>
</div>
<div id="example-1-insturment" class="section level5">
<h5><span class="header-section-number">5.1.1.2.2</span> Example 1 Insturment</h5>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb367-1" title="1"><span class="co"># One Instrucments</span></a>
<a class="sourceLine" id="cb367-2" title="2">var.y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;hgt&#39;</span>)</a>
<a class="sourceLine" id="cb367-3" title="3">vars.x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;prot&#39;</span>)</a>
<a class="sourceLine" id="cb367-4" title="4">vars.z &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;momEdu&#39;</span>)</a>
<a class="sourceLine" id="cb367-5" title="5">vars.c &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;sex&#39;</span>, <span class="st">&#39;hgt0&#39;</span>, <span class="st">&#39;wgt0&#39;</span>)</a>
<a class="sourceLine" id="cb367-6" title="6"><span class="co"># Regression</span></a>
<a class="sourceLine" id="cb367-7" title="7"><span class="kw">regf.iv</span>(var.y, vars.x, vars.c, vars.z, df, <span class="dt">transpose=</span><span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## Warning: attributes are not identical across measure variables;
## they will be dropped</code></pre>
<pre><code>##                     esti.val                 value
## 1       (Intercept)_Estimate      43.4301969117558
## 2              prot_Estimate     0.130833343849446
## 3           sexMale_Estimate     0.868121847262411
## 4              hgt0_Estimate     0.412093881817148
## 5              wgt0_Estimate  0.000858630042617921
## 6      (Intercept)_Std.Error      1.82489550971182
## 7             prot_Std.Error    0.0192036220809189
## 8          sexMale_Std.Error      0.13373016700542
## 9             hgt0_Std.Error    0.0459431912927002
## 10            wgt0_Std.Error   0.00022691057702563
## 11        (Intercept)_zvalue       23.798730766023
## 12               prot_zvalue      6.81295139521853
## 13            sexMale_zvalue      6.49159323361366
## 14               hgt0_zvalue      8.96963990141069
## 15               wgt0_zvalue       3.7840018472164
## 16      (Intercept)_Pr(&gt;|z|)  3.4423766196876e-125
## 17             prot_Pr(&gt;|z|)  9.56164541643828e-12
## 18          sexMale_Pr(&gt;|z|)  8.49333228172763e-11
## 19             hgt0_Pr(&gt;|z|)  2.97485394526792e-19
## 20             wgt0_Pr(&gt;|z|)  0.000154326676608523
## 21       Weakinstruments_df1                     1
## 22            Wu-Hausman_df1                     1
## 23                Sargan_df1                     0
## 24       Weakinstruments_df2                 16394
## 25            Wu-Hausman_df2                 16393
## 26 Weakinstruments_statistic      935.817456612075
## 27      Wu-Hausman_statistic      123.595856606729
## 28   Weakinstruments_p-value 6.39714929178024e-200
## 29        Wu-Hausman_p-value  1.30703637796748e-28
## 30                vars_var.y                   hgt
## 31               vars_vars.x                  prot
## 32               vars_vars.z                momEdu
## 33               vars_vars.c         sex+hgt0+wgt0</code></pre>
</div>
<div id="example-multiple-instrucments" class="section level5">
<h5><span class="header-section-number">5.1.1.2.3</span> Example Multiple Instrucments</h5>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb370-1" title="1"><span class="co"># Multiple Instrucments</span></a>
<a class="sourceLine" id="cb370-2" title="2">var.y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;hgt&#39;</span>)</a>
<a class="sourceLine" id="cb370-3" title="3">vars.x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;prot&#39;</span>)</a>
<a class="sourceLine" id="cb370-4" title="4">vars.z &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;momEdu&#39;</span>, <span class="st">&#39;wealthIdx&#39;</span>, <span class="st">&#39;p.A.prot&#39;</span>, <span class="st">&#39;p.A.nProt&#39;</span>)</a>
<a class="sourceLine" id="cb370-5" title="5">vars.c &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;sex&#39;</span>, <span class="st">&#39;hgt0&#39;</span>, <span class="st">&#39;wgt0&#39;</span>)</a>
<a class="sourceLine" id="cb370-6" title="6"><span class="co"># Regression</span></a>
<a class="sourceLine" id="cb370-7" title="7"><span class="kw">regf.iv</span>(var.y, vars.x, vars.c, vars.z, df, <span class="dt">transpose=</span><span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## Warning: attributes are not identical across measure variables;
## they will be dropped</code></pre>
<pre><code>##                     esti.val                               value
## 1       (Intercept)_Estimate                    42.2437613555242
## 2              prot_Estimate                    0.26699945194704
## 3           sexMale_Estimate                   0.695548488812932
## 4              hgt0_Estimate                   0.424954881263031
## 5              wgt0_Estimate                0.000486951420329484
## 6      (Intercept)_Std.Error                    1.85356686789642
## 7             prot_Std.Error                  0.0154939347964083
## 8          sexMale_Std.Error                   0.133157977814374
## 9             hgt0_Std.Error                  0.0463195803786233
## 10            wgt0_Std.Error                0.000224867994873235
## 11        (Intercept)_zvalue                    22.7905246296649
## 12               prot_zvalue                    17.2325142357597
## 13            sexMale_zvalue                    5.22348341593581
## 14               hgt0_zvalue                    9.17441129192849
## 15               wgt0_zvalue                    2.16549901022595
## 16      (Intercept)_Pr(&gt;|z|)               5.69294074735747e-115
## 17             prot_Pr(&gt;|z|)                1.51424021931607e-66
## 18          sexMale_Pr(&gt;|z|)                1.75588197502565e-07
## 19             hgt0_Pr(&gt;|z|)                4.54048595587756e-20
## 20             wgt0_Pr(&gt;|z|)                   0.030349491114332
## 21       Weakinstruments_df1                                   4
## 22            Wu-Hausman_df1                                   1
## 23                Sargan_df1                                   3
## 24       Weakinstruments_df2                               14914
## 25            Wu-Hausman_df2                               14916
## 26 Weakinstruments_statistic                    274.147084958343
## 27      Wu-Hausman_statistic                    17.7562545747101
## 28          Sargan_statistic                    463.729664547249
## 29   Weakinstruments_p-value               8.61731956233366e-228
## 30        Wu-Hausman_p-value                2.52567249124181e-05
## 31            Sargan_p-value               3.45452874915475e-100
## 32                vars_var.y                                 hgt
## 33               vars_vars.x                                prot
## 34               vars_vars.z momEdu+wealthIdx+p.A.prot+p.A.nProt
## 35               vars_vars.c                       sex+hgt0+wgt0</code></pre>
</div>
<div id="example-multiple-endogenous-variables" class="section level5">
<h5><span class="header-section-number">5.1.1.2.4</span> Example Multiple Endogenous Variables</h5>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb373-1" title="1"><span class="co"># Multiple Instrucments</span></a>
<a class="sourceLine" id="cb373-2" title="2">var.y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;hgt&#39;</span>)</a>
<a class="sourceLine" id="cb373-3" title="3">vars.x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;prot&#39;</span>, <span class="st">&#39;cal&#39;</span>)</a>
<a class="sourceLine" id="cb373-4" title="4">vars.z &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;momEdu&#39;</span>, <span class="st">&#39;wealthIdx&#39;</span>, <span class="st">&#39;p.A.prot&#39;</span>, <span class="st">&#39;p.A.nProt&#39;</span>)</a>
<a class="sourceLine" id="cb373-5" title="5">vars.c &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;sex&#39;</span>, <span class="st">&#39;hgt0&#39;</span>, <span class="st">&#39;wgt0&#39;</span>)</a>
<a class="sourceLine" id="cb373-6" title="6"><span class="co"># Regression</span></a>
<a class="sourceLine" id="cb373-7" title="7"><span class="kw">regf.iv</span>(var.y, vars.x, vars.c, vars.z, df, <span class="dt">transpose=</span><span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## Warning: attributes are not identical across measure variables;
## they will be dropped</code></pre>
<pre><code>##                           esti.val                               value
## 1             (Intercept)_Estimate                    44.0243196254297
## 2                    prot_Estimate                    -1.4025623247106
## 3                     cal_Estimate                   0.065104895750151
## 4                 sexMale_Estimate                   0.120832787571818
## 5                    hgt0_Estimate                   0.286525437984517
## 6                    wgt0_Estimate                0.000850481389651033
## 7            (Intercept)_Std.Error                    2.75354847244082
## 8                   prot_Std.Error                   0.198640060273635
## 9                    cal_Std.Error                 0.00758881298880996
## 10               sexMale_Std.Error                   0.209984580636303
## 11                  hgt0_Std.Error                  0.0707828182888255
## 12                  wgt0_Std.Error                 0.00033711210444429
## 13              (Intercept)_zvalue                    15.9882130516502
## 14                     prot_zvalue                   -7.06082309267581
## 15                      cal_zvalue                    8.57906181719737
## 16                  sexMale_zvalue                   0.575436478267434
## 17                     hgt0_zvalue                    4.04795181812859
## 18                     wgt0_zvalue                    2.52284441418383
## 19            (Intercept)_Pr(&gt;|z|)                1.54396598126854e-57
## 20                   prot_Pr(&gt;|z|)                1.65519210848649e-12
## 21                    cal_Pr(&gt;|z|)                9.56500648203187e-18
## 22                sexMale_Pr(&gt;|z|)                   0.564996139463599
## 23                   hgt0_Pr(&gt;|z|)                5.16677787108928e-05
## 24                   wgt0_Pr(&gt;|z|)                  0.0116409892837831
## 25       Weakinstruments(prot)_df1                                   4
## 26        Weakinstruments(cal)_df1                                   4
## 27                  Wu-Hausman_df1                                   2
## 28                      Sargan_df1                                   2
## 29       Weakinstruments(prot)_df2                               14914
## 30        Weakinstruments(cal)_df2                               14914
## 31                  Wu-Hausman_df2                               14914
## 32 Weakinstruments(prot)_statistic                    274.147084958343
## 33  Weakinstruments(cal)_statistic                    315.036848606231
## 34            Wu-Hausman_statistic                    94.7020085425169
## 35                Sargan_statistic                    122.081979628898
## 36   Weakinstruments(prot)_p-value               8.61731956233366e-228
## 37    Weakinstruments(cal)_p-value               1.18918641220866e-260
## 38              Wu-Hausman_p-value                1.35024050408262e-41
## 39                  Sargan_p-value                3.09196773720398e-27
## 40                      vars_var.y                                 hgt
## 41                     vars_vars.x                            prot+cal
## 42                     vars_vars.z momEdu+wealthIdx+p.A.prot+p.A.nProt
## 43                     vars_vars.c                       sex+hgt0+wgt0</code></pre>
</div>
<div id="examples-line-by-line" class="section level5">
<h5><span class="header-section-number">5.1.1.2.5</span> Examples Line by Line</h5>
<p>The examples are just to test the code with different types of variables.</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb376-1" title="1"><span class="co"># Selecting Variables</span></a>
<a class="sourceLine" id="cb376-2" title="2">var.y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;hgt&#39;</span>)</a>
<a class="sourceLine" id="cb376-3" title="3">vars.x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;prot&#39;</span>, <span class="st">&#39;cal&#39;</span>)</a>
<a class="sourceLine" id="cb376-4" title="4">vars.z &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;momEdu&#39;</span>, <span class="st">&#39;wealthIdx&#39;</span>, <span class="st">&#39;p.A.prot&#39;</span>, <span class="st">&#39;p.A.nProt&#39;</span>)</a>
<a class="sourceLine" id="cb376-5" title="5">vars.c &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;sex&#39;</span>, <span class="st">&#39;hgt0&#39;</span>, <span class="st">&#39;wgt0&#39;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb377-1" title="1"><span class="co"># A. create Equation</span></a>
<a class="sourceLine" id="cb377-2" title="2">str.vars.x &lt;-<span class="st"> </span><span class="kw">paste</span>(vars.x, <span class="dt">collapse=</span><span class="st">&#39;+&#39;</span>)</a>
<a class="sourceLine" id="cb377-3" title="3">str.vars.c &lt;-<span class="st"> </span><span class="kw">paste</span>(vars.c, <span class="dt">collapse=</span><span class="st">&#39;+&#39;</span>)</a>
<a class="sourceLine" id="cb377-4" title="4">str.vars.z &lt;-<span class="st"> </span><span class="kw">paste</span>(vars.z, <span class="dt">collapse=</span><span class="st">&#39;+&#39;</span>)</a>
<a class="sourceLine" id="cb377-5" title="5"><span class="kw">print</span>(str.vars.x)</a></code></pre></div>
<pre><code>## [1] &quot;prot+cal&quot;</code></pre>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb379-1" title="1"><span class="kw">print</span>(str.vars.c)</a></code></pre></div>
<pre><code>## [1] &quot;sex+hgt0+wgt0&quot;</code></pre>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb381-1" title="1"><span class="kw">print</span>(str.vars.z)</a></code></pre></div>
<pre><code>## [1] &quot;momEdu+wealthIdx+p.A.prot+p.A.nProt&quot;</code></pre>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb383-1" title="1">equa.iv &lt;-<span class="st"> </span><span class="kw">paste</span>(var.y,</a>
<a class="sourceLine" id="cb383-2" title="2">                 <span class="kw">paste</span>(<span class="kw">paste</span>(str.vars.x, str.vars.c, <span class="dt">sep=</span><span class="st">&#39;+&#39;</span>),</a>
<a class="sourceLine" id="cb383-3" title="3">                       <span class="kw">paste</span>(str.vars.z, str.vars.c, <span class="dt">sep=</span><span class="st">&#39;+&#39;</span>),</a>
<a class="sourceLine" id="cb383-4" title="4">                       <span class="dt">sep=</span><span class="st">&#39;|&#39;</span>),</a>
<a class="sourceLine" id="cb383-5" title="5">                 <span class="dt">sep=</span><span class="st">&#39;~&#39;</span>)</a>
<a class="sourceLine" id="cb383-6" title="6"><span class="kw">print</span>(equa.iv)</a></code></pre></div>
<pre><code>## [1] &quot;hgt~prot+cal+sex+hgt0+wgt0|momEdu+wealthIdx+p.A.prot+p.A.nProt+sex+hgt0+wgt0&quot;</code></pre>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb385-1" title="1"><span class="co"># B. regression</span></a>
<a class="sourceLine" id="cb385-2" title="2">res.ivreg &lt;-<span class="st"> </span><span class="kw">ivreg</span>(<span class="kw">as.formula</span>(equa.iv), <span class="dt">data=</span>df)</a>
<a class="sourceLine" id="cb385-3" title="3"><span class="kw">coef</span>(res.ivreg)</a></code></pre></div>
<pre><code>##   (Intercept)          prot           cal       sexMale          hgt0          wgt0 
## 44.0243196254 -1.4025623247  0.0651048958  0.1208327876  0.2865254380  0.0008504814</code></pre>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb387-1" title="1"><span class="co"># C. Regression Summary</span></a>
<a class="sourceLine" id="cb387-2" title="2">ivreg.summ &lt;-<span class="st"> </span><span class="kw">summary</span>(res.ivreg, <span class="dt">vcov =</span> sandwich, <span class="dt">df =</span> <span class="ot">Inf</span>, <span class="dt">diagnostics =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb387-3" title="3"></a>
<a class="sourceLine" id="cb387-4" title="4">ivreg.summ<span class="op">$</span>coef</a></code></pre></div>
<pre><code>##                  Estimate   Std. Error    z value     Pr(&gt;|z|)
## (Intercept) 44.0243196254 2.7535484724 15.9882131 1.543966e-57
## prot        -1.4025623247 0.1986400603 -7.0608231 1.655192e-12
## cal          0.0651048958 0.0075888130  8.5790618 9.565006e-18
## sexMale      0.1208327876 0.2099845806  0.5754365 5.649961e-01
## hgt0         0.2865254380 0.0707828183  4.0479518 5.166778e-05
## wgt0         0.0008504814 0.0003371121  2.5228444 1.164099e-02
## attr(,&quot;df&quot;)
## [1] 0</code></pre>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb389-1" title="1">ivreg.summ<span class="op">$</span>diagnostics</a></code></pre></div>
<pre><code>##                         df1   df2 statistic       p-value
## Weak instruments (prot)   4 14914 274.14708 8.617320e-228
## Weak instruments (cal)    4 14914 315.03685 1.189186e-260
## Wu-Hausman                2 14914  94.70201  1.350241e-41
## Sargan                    2    NA 122.08198  3.091968e-27</code></pre>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb391-1" title="1"><span class="co"># D. Combine Regression Results into a Matrix</span></a>
<a class="sourceLine" id="cb391-2" title="2">df.results &lt;-<span class="st"> </span><span class="kw">suppressMessages</span>(<span class="kw">as_tibble</span>(ivreg.summ<span class="op">$</span>coef, <span class="dt">rownames=</span><span class="st">&#39;rownames&#39;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb391-3" title="3"><span class="st">    </span><span class="kw">full_join</span>(<span class="kw">as_tibble</span>(ivreg.summ<span class="op">$</span>diagnostics, <span class="dt">rownames=</span><span class="st">&#39;rownames&#39;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb391-4" title="4"><span class="st">    </span><span class="kw">full_join</span>(<span class="kw">tibble</span>(<span class="dt">rownames=</span><span class="kw">c</span>(<span class="st">&#39;vars&#39;</span>),</a>
<a class="sourceLine" id="cb391-5" title="5">                     <span class="dt">var.y=</span>var.y,</a>
<a class="sourceLine" id="cb391-6" title="6">                     <span class="dt">vars.x=</span>str.vars.x,</a>
<a class="sourceLine" id="cb391-7" title="7">                     <span class="dt">vars.z=</span>str.vars.z,</a>
<a class="sourceLine" id="cb391-8" title="8">                     <span class="dt">vars.c=</span>str.vars.c)))</a>
<a class="sourceLine" id="cb391-9" title="9"><span class="co"># E. Flatten Matrix, All IV results as a single tibble row to be combined with other IV results</span></a>
<a class="sourceLine" id="cb391-10" title="10">df.row.results &lt;-<span class="st"> </span>df.results <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb391-11" title="11"><span class="st">    </span><span class="kw">gather</span>(variable, value, <span class="op">-</span>rownames) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb391-12" title="12"><span class="st">    </span><span class="kw">drop_na</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb391-13" title="13"><span class="st">    </span><span class="kw">unite</span>(esti.val, rownames, variable) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb391-14" title="14"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">esti.val =</span> <span class="kw">gsub</span>(<span class="st">&#39; &#39;</span>, <span class="st">&#39;&#39;</span>, esti.val))</a></code></pre></div>
<pre><code>## Warning: attributes are not identical across measure variables;
## they will be dropped</code></pre>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb393-1" title="1"><span class="co"># F. Results as Single Colum</span></a>
<a class="sourceLine" id="cb393-2" title="2">df.row.results</a></code></pre></div>
<pre><code>## # A tibble: 43 x 2
##    esti.val              value               
##    &lt;chr&gt;                 &lt;chr&gt;               
##  1 (Intercept)_Estimate  44.0243196254297    
##  2 prot_Estimate         -1.4025623247106    
##  3 cal_Estimate          0.065104895750151   
##  4 sexMale_Estimate      0.120832787571818   
##  5 hgt0_Estimate         0.286525437984517   
##  6 wgt0_Estimate         0.000850481389651033
##  7 (Intercept)_Std.Error 2.75354847244082    
##  8 prot_Std.Error        0.198640060273635   
##  9 cal_Std.Error         0.00758881298880996 
## 10 sexMale_Std.Error     0.209984580636303   
## # ... with 33 more rows</code></pre>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb395-1" title="1"><span class="co"># G. Results as Single Row</span></a>
<a class="sourceLine" id="cb395-2" title="2">df.row.results</a></code></pre></div>
<pre><code>## # A tibble: 43 x 2
##    esti.val              value               
##    &lt;chr&gt;                 &lt;chr&gt;               
##  1 (Intercept)_Estimate  44.0243196254297    
##  2 prot_Estimate         -1.4025623247106    
##  3 cal_Estimate          0.065104895750151   
##  4 sexMale_Estimate      0.120832787571818   
##  5 hgt0_Estimate         0.286525437984517   
##  6 wgt0_Estimate         0.000850481389651033
##  7 (Intercept)_Std.Error 2.75354847244082    
##  8 prot_Std.Error        0.198640060273635   
##  9 cal_Std.Error         0.00758881298880996 
## 10 sexMale_Std.Error     0.209984580636303   
## # ... with 33 more rows</code></pre>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb397-1" title="1">df.row.results <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">spread</span>(esti.val, value)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 43
##   `(Intercept)_Es~ `(Intercept)_Pr~ `(Intercept)_St~ `(Intercept)_zv~ cal_Estimate `cal_Pr(&gt;|z|)`
##   &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;        &lt;chr&gt;         
## 1 44.0243196254297 1.5439659812685~ 2.75354847244082 15.9882130516502 0.065104895~ 9.56500648203~
## # ... with 37 more variables: cal_Std.Error &lt;chr&gt;, cal_zvalue &lt;chr&gt;, hgt0_Estimate &lt;chr&gt;,
## #   `hgt0_Pr(&gt;|z|)` &lt;chr&gt;, hgt0_Std.Error &lt;chr&gt;, hgt0_zvalue &lt;chr&gt;, prot_Estimate &lt;chr&gt;,
## #   `prot_Pr(&gt;|z|)` &lt;chr&gt;, prot_Std.Error &lt;chr&gt;, prot_zvalue &lt;chr&gt;, Sargan_df1 &lt;chr&gt;,
## #   `Sargan_p-value` &lt;chr&gt;, Sargan_statistic &lt;chr&gt;, sexMale_Estimate &lt;chr&gt;,
## #   `sexMale_Pr(&gt;|z|)` &lt;chr&gt;, sexMale_Std.Error &lt;chr&gt;, sexMale_zvalue &lt;chr&gt;, vars_var.y &lt;chr&gt;,
## #   vars_vars.c &lt;chr&gt;, vars_vars.x &lt;chr&gt;, vars_vars.z &lt;chr&gt;, `Weakinstruments(cal)_df1` &lt;chr&gt;,
## #   `Weakinstruments(cal)_df2` &lt;chr&gt;, `Weakinstruments(cal)_p-value` &lt;chr&gt;,
## #   `Weakinstruments(cal)_statistic` &lt;chr&gt;, `Weakinstruments(prot)_df1` &lt;chr&gt;,
## #   `Weakinstruments(prot)_df2` &lt;chr&gt;, `Weakinstruments(prot)_p-value` &lt;chr&gt;,
## #   `Weakinstruments(prot)_statistic` &lt;chr&gt;, wgt0_Estimate &lt;chr&gt;, `wgt0_Pr(&gt;|z|)` &lt;chr&gt;,
## #   wgt0_Std.Error &lt;chr&gt;, wgt0_zvalue &lt;chr&gt;, `Wu-Hausman_df1` &lt;chr&gt;, `Wu-Hausman_df2` &lt;chr&gt;,
## #   `Wu-Hausman_p-value` &lt;chr&gt;, `Wu-Hausman_statistic` &lt;chr&gt;</code></pre>

</div>
</div>
</div>
<div id="iv-loop-over-rhs" class="section level3">
<h3><span class="header-section-number">5.1.2</span> IV Loop over RHS</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/CodeDynaAsset/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R4Econ</a> Repository, or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository.</p>
</blockquote>
<p>Regression with a Variety of Outcome Variables and Right Hand Side Variables. There are M outcome variables, and there are N alternative right hand side variables. Regress each M outcome variable and each N alternative right hand side variable, with some common sets of controls and perhaps shared instruments. The output file is a M by N matrix of coefficients, with proper variable names and row names. The matrix stores coefficients for this key endogenous variable.</p>
<ul>
<li>Dependency: <em>R4Econ/linreg/ivreg/ivregdfrow.R</em></li>
</ul>
<div id="construct-program-1" class="section level4">
<h4><span class="header-section-number">5.1.2.1</span> Construct Program</h4>
<p>The program relies on double lapply. lapply is used for convenience, not speed.</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb399-1" title="1">ff_reg_mbyn &lt;-<span class="st"> </span><span class="cf">function</span>(list.vars.y, list.vars.x,</a>
<a class="sourceLine" id="cb399-2" title="2">                        vars.c, vars.z, df,</a>
<a class="sourceLine" id="cb399-3" title="3">                        <span class="dt">return_all =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb399-4" title="4">                        <span class="dt">stats_ends =</span> <span class="st">&#39;value&#39;</span>, <span class="dt">time =</span> <span class="ot">FALSE</span>) {</a>
<a class="sourceLine" id="cb399-5" title="5"></a>
<a class="sourceLine" id="cb399-6" title="6">    <span class="co"># regf.iv() function is from C:\Users\fan\R4Econ\linreg\ivreg\ivregdfrow.R</span></a>
<a class="sourceLine" id="cb399-7" title="7">    <span class="cf">if</span> (time) {</a>
<a class="sourceLine" id="cb399-8" title="8">        start_time &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</a>
<a class="sourceLine" id="cb399-9" title="9">    }</a>
<a class="sourceLine" id="cb399-10" title="10"></a>
<a class="sourceLine" id="cb399-11" title="11">    <span class="cf">if</span> (return_all) {</a>
<a class="sourceLine" id="cb399-12" title="12">        df.reg.out.all &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(<span class="kw">lapply</span>(list.vars.x,</a>
<a class="sourceLine" id="cb399-13" title="13">                              <span class="cf">function</span>(x) (</a>
<a class="sourceLine" id="cb399-14" title="14">                                  <span class="kw">bind_rows</span>(<span class="kw">lapply</span>(list.vars.y, regf.iv, <span class="dt">vars.x=</span>x, <span class="dt">vars.c=</span>vars.c, <span class="dt">vars.z=</span>vars.z, <span class="dt">df=</span>df))</a>
<a class="sourceLine" id="cb399-15" title="15">                              )))</a>
<a class="sourceLine" id="cb399-16" title="16"></a>
<a class="sourceLine" id="cb399-17" title="17">    } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb399-18" title="18">        df.reg.out.all &lt;-<span class="st"> </span>(<span class="kw">lapply</span>(list.vars.x,</a>
<a class="sourceLine" id="cb399-19" title="19">                              <span class="cf">function</span>(x) (</a>
<a class="sourceLine" id="cb399-20" title="20">                                  <span class="kw">bind_rows</span>(<span class="kw">lapply</span>(list.vars.y, regf.iv, <span class="dt">vars.x=</span>x, <span class="dt">vars.c=</span>vars.c, <span class="dt">vars.z=</span>vars.z, <span class="dt">df=</span>df)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb399-21" title="21"><span class="st">                                      </span><span class="kw">select</span>(vars_var.y, <span class="kw">starts_with</span>(x)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb399-22" title="22"><span class="st">                                      </span><span class="kw">select</span>(vars_var.y, <span class="kw">ends_with</span>(stats_ends))</a>
<a class="sourceLine" id="cb399-23" title="23">                              ))) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">reduce</span>(full_join)</a>
<a class="sourceLine" id="cb399-24" title="24">    }</a>
<a class="sourceLine" id="cb399-25" title="25"></a>
<a class="sourceLine" id="cb399-26" title="26">    <span class="cf">if</span> (time) {</a>
<a class="sourceLine" id="cb399-27" title="27">        end_time &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</a>
<a class="sourceLine" id="cb399-28" title="28">        <span class="kw">print</span>(<span class="kw">paste0</span>(<span class="st">&#39;Estimation for all ys and xs took (seconds):&#39;</span>, end_time <span class="op">-</span><span class="st"> </span>start_time))</a>
<a class="sourceLine" id="cb399-29" title="29">    }</a>
<a class="sourceLine" id="cb399-30" title="30"></a>
<a class="sourceLine" id="cb399-31" title="31">    <span class="kw">return</span>(df.reg.out.all)</a>
<a class="sourceLine" id="cb399-32" title="32">}</a></code></pre></div>
</div>
<div id="prepare-data" class="section level4">
<h4><span class="header-section-number">5.1.2.2</span> Prepare Data</h4>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb400-1" title="1"><span class="co"># Library</span></a>
<a class="sourceLine" id="cb400-2" title="2"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb400-3" title="3"><span class="kw">library</span>(AER)</a>
<a class="sourceLine" id="cb400-4" title="4"></a>
<a class="sourceLine" id="cb400-5" title="5"><span class="co"># Load Sample Data</span></a>
<a class="sourceLine" id="cb400-6" title="6"><span class="kw">setwd</span>(<span class="st">&#39;C:/Users/fan/R4Econ/_data/&#39;</span>)</a>
<a class="sourceLine" id="cb400-7" title="7">df &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;height_weight.csv&#39;</span>)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   S.country = col_character(),
##   vil.id = col_double(),
##   indi.id = col_double(),
##   sex = col_character(),
##   svymthRound = col_double(),
##   momEdu = col_double(),
##   wealthIdx = col_double(),
##   hgt = col_double(),
##   wgt = col_double(),
##   hgt0 = col_double(),
##   wgt0 = col_double(),
##   prot = col_double(),
##   cal = col_double(),
##   p.A.prot = col_double(),
##   p.A.nProt = col_double()
## )</code></pre>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb402-1" title="1"><span class="co"># Source Dependency</span></a>
<a class="sourceLine" id="cb402-2" title="2"><span class="kw">source</span>(<span class="st">&#39;C:/Users/fan/R4Econ/linreg/ivreg/ivregdfrow.R&#39;</span>)</a>
<a class="sourceLine" id="cb402-3" title="3"></a>
<a class="sourceLine" id="cb402-4" title="4"><span class="co"># Setting</span></a>
<a class="sourceLine" id="cb402-5" title="5"><span class="kw">options</span>(<span class="dt">repr.matrix.max.rows=</span><span class="dv">50</span>, <span class="dt">repr.matrix.max.cols=</span><span class="dv">50</span>)</a></code></pre></div>
<p>Parameters.</p>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb403-1" title="1">var.y1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;hgt&#39;</span>)</a>
<a class="sourceLine" id="cb403-2" title="2">var.y2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;wgt&#39;</span>)</a>
<a class="sourceLine" id="cb403-3" title="3">var.y3 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;vil.id&#39;</span>)</a>
<a class="sourceLine" id="cb403-4" title="4">list.vars.y &lt;-<span class="st"> </span><span class="kw">c</span>(var.y1, var.y2, var.y3)</a>
<a class="sourceLine" id="cb403-5" title="5"></a>
<a class="sourceLine" id="cb403-6" title="6">var.x1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;prot&#39;</span>)</a>
<a class="sourceLine" id="cb403-7" title="7">var.x2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;cal&#39;</span>)</a>
<a class="sourceLine" id="cb403-8" title="8">var.x3 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;wealthIdx&#39;</span>)</a>
<a class="sourceLine" id="cb403-9" title="9">var.x4 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;p.A.prot&#39;</span>)</a>
<a class="sourceLine" id="cb403-10" title="10">var.x5 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;p.A.nProt&#39;</span>)</a>
<a class="sourceLine" id="cb403-11" title="11">list.vars.x &lt;-<span class="st"> </span><span class="kw">c</span>(var.x1, var.x2, var.x3, var.x4, var.x5)</a>
<a class="sourceLine" id="cb403-12" title="12"></a>
<a class="sourceLine" id="cb403-13" title="13">vars.z &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;indi.id&#39;</span>)</a>
<a class="sourceLine" id="cb403-14" title="14">vars.c &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;sex&#39;</span>, <span class="st">&#39;wgt0&#39;</span>, <span class="st">&#39;hgt0&#39;</span>, <span class="st">&#39;svymthRound&#39;</span>)</a></code></pre></div>
</div>
<div id="program-testing-2" class="section level4">
<h4><span class="header-section-number">5.1.2.3</span> Program Testing</h4>
<div id="test-program-ols-z-stat" class="section level5">
<h5><span class="header-section-number">5.1.2.3.1</span> Test Program OLS Z-Stat</h5>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb404-1" title="1">vars.z &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb404-2" title="2"><span class="kw">suppressMessages</span>(<span class="kw">ff_reg_mbyn</span>(list.vars.y, list.vars.x,</a>
<a class="sourceLine" id="cb404-3" title="3">                             vars.c, vars.z, df,</a>
<a class="sourceLine" id="cb404-4" title="4">                             <span class="dt">return_all =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb404-5" title="5">                             <span class="dt">stats_ends =</span> <span class="st">&#39;value&#39;</span>))</a></code></pre></div>
<pre><code>##   vars_var.y       prot_tvalue        cal_tvalue wealthIdx_tvalue  p.A.prot_tvalue p.A.nProt_tvalue
## 1        hgt  18.8756010031786  23.4421863484661  13.508899618216 3.83682180045518 32.5448257554855
## 2        wgt  16.3591125056062  17.3686031309332 14.1390521528113 1.36958319982295 12.0961557911467
## 3     vil.id -14.9385580468907 -19.6150110809452 34.0972558327347 8.45943342783186 17.7801422421419</code></pre>
</div>
<div id="test-program-iv-t-stat" class="section level5">
<h5><span class="header-section-number">5.1.2.3.2</span> Test Program IV T-stat</h5>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb406-1" title="1">vars.z &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;indi.id&#39;</span>)</a>
<a class="sourceLine" id="cb406-2" title="2"><span class="kw">suppressMessages</span>(<span class="kw">ff_reg_mbyn</span>(list.vars.y, list.vars.x,</a>
<a class="sourceLine" id="cb406-3" title="3">                             vars.c, vars.z, df,</a>
<a class="sourceLine" id="cb406-4" title="4">                             <span class="dt">return_all =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb406-5" title="5">                             <span class="dt">stats_ends =</span> <span class="st">&#39;value&#39;</span>))</a></code></pre></div>
<pre><code>## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped</code></pre>
<pre><code>##   vars_var.y       prot_zvalue        cal_zvalue  wealthIdx_zvalue   p.A.prot_zvalue
## 1        hgt  8.87674929300964  12.0739764947235  4.62589553677969  26.6373587567312
## 2        wgt  5.60385871756365   6.1225187008946  5.17869536991717  11.9295584469998
## 3     vil.id -9.22106223347162 -13.0586007975839 -51.5866689219593 -29.9627476577329
##    p.A.nProt_zvalue
## 1  32.1162192385744
## 2  12.3509307017263
## 3 -38.3528894620707</code></pre>
</div>
<div id="test-program-ols-coefficient" class="section level5">
<h5><span class="header-section-number">5.1.2.3.3</span> Test Program OLS Coefficient</h5>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb409-1" title="1">vars.z &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb409-2" title="2"><span class="kw">suppressMessages</span>(<span class="kw">ff_reg_mbyn</span>(list.vars.y, list.vars.x,</a>
<a class="sourceLine" id="cb409-3" title="3">                             vars.c, vars.z, df,</a>
<a class="sourceLine" id="cb409-4" title="4">                             <span class="dt">return_all =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb409-5" title="5">                             <span class="dt">stats_ends =</span> <span class="st">&#39;Estimate&#39;</span>))</a></code></pre></div>
<pre><code>##   vars_var.y       prot_Estimate         cal_Estimate wealthIdx_Estimate    p.A.prot_Estimate
## 1        hgt   0.049431093806755  0.00243408846205622   0.21045655488185 3.86952250259526e-05
## 2        wgt    16.5557424523585    0.699072500364623   106.678721085969  0.00521731297924587
## 3     vil.id -0.0758835879205584 -0.00395676177098486  0.451733304543324 0.000149388430455142
##    p.A.nProt_Estimate
## 1 0.00542428867316449
## 2   0.779514232050632
## 3 0.00526237555581024</code></pre>
</div>
<div id="test-program-iv-coefficient" class="section level5">
<h5><span class="header-section-number">5.1.2.3.4</span> Test Program IV coefficient</h5>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb411-1" title="1">vars.z &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;indi.id&#39;</span>)</a>
<a class="sourceLine" id="cb411-2" title="2"><span class="kw">suppressMessages</span>(<span class="kw">ff_reg_mbyn</span>(list.vars.y, list.vars.x,</a>
<a class="sourceLine" id="cb411-3" title="3">                             vars.c, vars.z, df,</a>
<a class="sourceLine" id="cb411-4" title="4">                             <span class="dt">return_all =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb411-5" title="5">                             <span class="dt">stats_ends =</span> <span class="st">&#39;Estimate&#39;</span>))</a></code></pre></div>
<pre><code>## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped</code></pre>
<pre><code>##   vars_var.y     prot_Estimate       cal_Estimate wealthIdx_Estimate    p.A.prot_Estimate
## 1        hgt 0.859205733632614 0.0238724384575419  0.144503490136948  0.00148073028434642
## 2        wgt  98.9428234201406   2.71948246216953   69.1816142883022    0.221916473012486
## 3     vil.id -6.02451379136132 -0.168054407187466  -1.91414470908345 -0.00520794333267238
##    p.A.nProt_Estimate
## 1  0.0141317656200726
## 2    2.11856940494335
## 3 -0.0494468877742109</code></pre>
</div>
<div id="test-program-ols-return-all" class="section level5">
<h5><span class="header-section-number">5.1.2.3.5</span> Test Program OLS Return All</h5>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb414-1" title="1">vars.z &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb414-2" title="2"><span class="kw">ff_reg_mbyn</span>(list.vars.y, list.vars.x,</a>
<a class="sourceLine" id="cb414-3" title="3">            vars.c, vars.z, df,</a>
<a class="sourceLine" id="cb414-4" title="4">            <span class="dt">return_all =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb414-5" title="5">            <span class="dt">stats_ends =</span> <span class="st">&#39;Estimate&#39;</span>)</a></code></pre></div>
<pre><code>##    X.Intercept._Estimate X.Intercept._Pr...t.. X.Intercept._Std.Error X.Intercept._tvalue
## 1       27.3528514188608 5.68247182214952e-231      0.831272666092284    32.9047886867776
## 2        99.873884728925      0.75529705553815       320.450650378664    0.31166697465244
## 3       31.4646660224049  6.78164655340399e-84       1.61328519718754     19.503474077155
## 4       27.9038445914729 8.24252673989353e-242      0.828072565159449    33.6973421962119
## 5       219.626705179399     0.493216914827181       320.522532223672   0.685214557790078
## 6       30.5103987898551  1.62608789535248e-79       1.60831193651104    18.9704485163756
## 7       35.7840188807906 2.26726906489443e-145       1.38461348429899    25.8440491058106
## 8      -2662.74787734003  7.13318862990131e-05       670.301542938561   -3.97246270039407
## 9       29.2381039651127 1.53578035267873e-124       1.22602177264147    23.8479483950102
## 10      23.9948407749744 2.11912344053336e-165       0.86658104216672    27.6890903532576
## 11     -547.959546430028    0.0941551350855875       327.343126852912    -1.6739607509042
## 12      22.3367814226238  3.04337266226599e-49        1.5098937308759    14.7936116071335
## 13      24.4904444950827 2.34941965806705e-181      0.843371070670838    29.0387533397398
## 14     -476.703973630552     0.143844033032183       326.132837036936   -1.46168652614567
## 15      22.7781908464511  9.58029450711211e-52        1.5004526558957    15.1808794212527
##       adj.r.squared_v df1_v df2_v df3_v      hgt0_Estimate         hgt0_Pr...t..     hgt0_Std.Error
## 1   0.814249026159781     6 18957     6   0.60391817340617 1.14533314566771e-183 0.0206657538633713
## 2    0.60716936506893     6 18962     6   56.3852027199184  1.52417506966835e-12   7.96735224000553
## 3  0.0373247512680971     6 18999     6 -0.296844389234445  1.40290395213743e-13 0.0401060913799595
## 4    0.81608922805658     6 18957     6  0.589847843438394 7.79174951119325e-177 0.0205836398278421
## 5   0.607863678511207     6 18962     6   52.9707041800704  3.05720143843395e-11   7.96822145797115
## 6  0.0453498711076042     6 18999     6 -0.273219210757899  8.49149153665126e-12 0.0399777363511633
## 7   0.935014931990565     6 25092     6  0.439374451256039  2.71000479249152e-36 0.0348701896610764
## 8    0.92193683733695     6 25102     6    47.176969664749   0.00520266507060071   16.8823489375743
## 9   0.059543122812776     6 30013     6  -0.35908163982046  2.41020063623865e-31 0.0307984635553859
## 10  0.814690803458616     6 18587     6  0.687269209411865 1.31914432912869e-220 0.0213841849324282
## 11  0.617300597776144     6 18591     6    72.105560623359  4.78613024244006e-19   8.07744906400683
## 12 0.0261131074199838     6 18845     6 -0.108789161111504    0.0034801146146182 0.0372288594891345
## 13  0.824542352656376     6 18587     6  0.622395388389206 1.11511327164938e-190 0.0208846437570215
## 14  0.620250730454724     6 18591     6   62.7336220289257  8.38546282719268e-15   8.07589192978212
## 15 0.0385437355117917     6 18845     6 -0.157811627494693  2.13723119924676e-05 0.0371223237183417
##          hgt0_tvalue       prot_Estimate        prot_Pr...t..      prot_Std.Error       prot_tvalue
## 1   29.2231378249683   0.049431093806755 9.54769322304645e-79 0.00261878251179557  18.8756010031786
## 2    7.0770314931977    16.5557424523585 9.61203373222183e-60    1.01201959743751  16.3591125056062
## 3  -7.40147890309685 -0.0758835879205584 3.56396093562335e-50 0.00507971302734622 -14.9385580468907
## 4   28.6561486875877                &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 5   6.64774497790599                &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 6  -6.83428417151858                &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 7   12.6002885423502                &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 8   2.79445531182864                &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 9   -11.659076407325                &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 10  32.1391351404584                &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 11  8.92677379355593                &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 12 -2.92217281443323                &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 13  29.8015803204665                &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 14  7.76801157994423                &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 15 -4.25112470577158                &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
##           r.squared_v   sexMale_Estimate     sexMale_Pr...t..  sexMale_Std.Error    sexMale_tvalue
## 1   0.814298005954592  0.935177182449406 2.36432111724607e-51 0.0618482294097262  15.1205166481668
## 2   0.607272921412825   415.163616765357 2.48252880290814e-67   23.8518341439675  17.4059409544552
## 3  0.0375780335372857 -0.254089999175318   0.0343768259467621  0.120093045309631 -2.11577613441484
## 4   0.816137722617266  0.893484662055608 2.08765935335877e-47 0.0616078355613525  14.5027763743757
## 5    0.60796705182314   405.534891838028 2.51355675686752e-64   23.8567507583516  16.9987478993157
## 6  0.0456010419476623 -0.181389489610951    0.129768754080748   0.11972270545355 -1.51508010885476
## 7    0.93502787877066   1.80682463132073 1.26527362032354e-66  0.104475287357902  17.2942776901016
## 8   0.921952383432195   999.926876716707 2.64630894140004e-86   50.5879876531386  19.7660931597596
## 9  0.0596997716363463  -0.33436777751525 0.000311174554787706 0.0927193334338799 -3.60623577771614
## 10  0.814740639193486  0.932686930233136 7.90489020586094e-47 0.0647209948973267  14.4108867873979
## 11  0.617403496088206   397.141948675354 6.19449742677662e-59   24.4473730956481  16.2447698213453
## 12 0.0263714328556815 -0.445232370681998 7.93666802281971e-05  0.112797805327952 -3.94717228218682
## 13  0.824589538985803   0.96466980500711 1.24556615236597e-52 0.0629827627260302   15.316409812052
## 14  0.620352835549783    401.59056368102 1.18469030741261e-60   24.3549086073387  16.4891016491029
## 15 0.0387987636986586 -0.423829627017582  0.00015644693636154  0.112083516545945 -3.78137339083082
##             sigma_v svymthRound_Estimate svymthRound_Pr...t.. svymthRound_Std.Error
## 1  4.21029844914315     0.87166589100565                    0   0.00387681209575621
## 2  1623.77111076428      189.04290688382                    0       1.4955473831309
## 3  8.18491760066961  -0.0154759587993917   0.0397984032097113   0.00752730297891317
## 4  4.18939119979502    0.851989049736817                    0   0.00411253488213795
## 5  1622.33549880859     185.318286001897                    0      1.59266949679221
## 6  8.15073036560541   0.0201471237605442   0.0117151185126433   0.00799217807522278
## 7  8.18607049768594    0.432815253441723                    0  0.000728323735328998
## 8  3964.45339913597     189.877994795061                    0     0.352701518968252
## 9  7.93450742809862  0.00215144302579706 0.000447277200167272  0.000612792699568233
## 10 4.35662621773428     0.91961467696139                    0   0.00331108017589107
## 11 1645.77655955938     205.597385664745                    0      1.25083486490652
## 12  7.6435668370875  -0.0509574460702806 1.37139389802397e-18   0.00578476859618168
## 13 4.23923961592693    0.921894094780682                    0   0.00317113547025635
## 14 1639.42085007515     205.945143306004                    0      1.22639878616071
## 15 7.59462918474114  -0.0557204455206461 7.79141497751766e-23   0.00565696328562864
##    svymthRound_tvalue vars_var.y               vars_vars.c vars_vars.x         wgt0_Estimate
## 1    224.840892330022        hgt sex+wgt0+hgt0+svymthRound        prot -0.000146104685986986
## 2    126.403823119306        wgt sex+wgt0+hgt0+svymthRound        prot     0.637023553461055
## 3   -2.05597660181154     vil.id sex+wgt0+hgt0+svymthRound        prot -0.000903390591533867
## 4    207.168832400006        hgt sex+wgt0+hgt0+svymthRound         cal -0.000116898230009949
## 5    116.357025971267        wgt sex+wgt0+hgt0+svymthRound         cal     0.649394003614758
## 6    2.52085521254888     vil.id sex+wgt0+hgt0+svymthRound         cal -0.000941137072743919
## 7    594.262183761197        hgt sex+wgt0+hgt0+svymthRound   wealthIdx   0.00122231975126219
## 8    538.353209678558        wgt sex+wgt0+hgt0+svymthRound   wealthIdx      1.32870822160235
## 9    3.51088227277012     vil.id sex+wgt0+hgt0+svymthRound   wealthIdx -0.000845938526704796
## 10   277.738571133786        hgt sex+wgt0+hgt0+svymthRound    p.A.prot -0.000489534836079617
## 11   164.368128386085        wgt sex+wgt0+hgt0+svymthRound    p.A.prot     0.580023505722658
## 12  -8.80889965139067     vil.id sex+wgt0+hgt0+svymthRound    p.A.prot  -0.00156196911156061
## 13   290.714194782148        hgt sex+wgt0+hgt0+svymthRound   p.A.nProt  3.23596154259101e-05
## 14   167.926734460268        wgt sex+wgt0+hgt0+svymthRound   p.A.nProt      0.65551206304675
## 15  -9.84988636256528     vil.id sex+wgt0+hgt0+svymthRound   p.A.nProt  -0.00115432723977403
##           wgt0_Pr...t..       wgt0_Std.Error       wgt0_tvalue         cal_Estimate
## 1     0.136011583497549 9.79994437486573e-05 -1.49087260496811                 &lt;NA&gt;
## 2  2.96480083692757e-63   0.0378027371614794  16.8512547316329                 &lt;NA&gt;
## 3  2.05763549729273e-06 0.000190221503167431 -4.74915073475531                 &lt;NA&gt;
## 4     0.230228828649018 9.74307633896921e-05 -1.19980821193398  0.00243408846205622
## 5  7.43034302413852e-66    0.037739875283113  17.2071051836606    0.699072500364623
## 6  6.66901196231733e-07 0.000189270503626621 -4.97244448929308 -0.00395676177098486
## 7  1.22269348058816e-13 0.000164767846917989  7.41843614592224                 &lt;NA&gt;
## 8  6.75367630221077e-62   0.0798131859486402  16.6477281392748                 &lt;NA&gt;
## 9  4.32675510884621e-09 0.000144040382619518   -5.872926128913                 &lt;NA&gt;
## 10 7.77000489086602e-07 9.90410500454311e-05 -4.94274682926991                 &lt;NA&gt;
## 11 7.42419220783427e-54   0.0374185042114355  15.5009805428138                 &lt;NA&gt;
## 12 1.40362012201826e-19 0.000172365145002826  -9.0619777654873                 &lt;NA&gt;
## 13    0.740027016459552 9.75208524392668e-05 0.331822524275644                 &lt;NA&gt;
## 14 4.09082062947785e-67   0.0377202854835204  17.3782370584956                 &lt;NA&gt;
## 15 2.75472781728448e-11 0.000173241059789276 -6.66312732777158                 &lt;NA&gt;
##             cal_Pr...t..        cal_Std.Error        cal_tvalue wealthIdx_Estimate
## 1                   &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;               &lt;NA&gt;
## 2                   &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;               &lt;NA&gt;
## 3                   &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;               &lt;NA&gt;
## 4  8.01672708877986e-120 0.000103833679413418  23.4421863484661               &lt;NA&gt;
## 5   4.71331900885298e-67   0.0402492068645167  17.3686031309332               &lt;NA&gt;
## 6   7.94646124029527e-85 0.000201721108117477 -19.6150110809452               &lt;NA&gt;
## 7                   &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;   0.21045655488185
## 8                   &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;   106.678721085969
## 9                   &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;  0.451733304543324
## 10                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;               &lt;NA&gt;
## 11                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;               &lt;NA&gt;
## 12                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;               &lt;NA&gt;
## 13                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;               &lt;NA&gt;
## 14                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;               &lt;NA&gt;
## 15                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;               &lt;NA&gt;
##       wealthIdx_Pr...t.. wealthIdx_Std.Error wealthIdx_tvalue    p.A.prot_Estimate
## 1                   &lt;NA&gt;                &lt;NA&gt;             &lt;NA&gt;                 &lt;NA&gt;
## 2                   &lt;NA&gt;                &lt;NA&gt;             &lt;NA&gt;                 &lt;NA&gt;
## 3                   &lt;NA&gt;                &lt;NA&gt;             &lt;NA&gt;                 &lt;NA&gt;
## 4                   &lt;NA&gt;                &lt;NA&gt;             &lt;NA&gt;                 &lt;NA&gt;
## 5                   &lt;NA&gt;                &lt;NA&gt;             &lt;NA&gt;                 &lt;NA&gt;
## 6                   &lt;NA&gt;                &lt;NA&gt;             &lt;NA&gt;                 &lt;NA&gt;
## 7   1.93494257274268e-41  0.0155791042075745  13.508899618216                 &lt;NA&gt;
## 8    3.2548345535026e-45    7.54496977117083 14.1390521528113                 &lt;NA&gt;
## 9  4.82890644822007e-250  0.0132483771350785 34.0972558327347                 &lt;NA&gt;
## 10                  &lt;NA&gt;                &lt;NA&gt;             &lt;NA&gt; 3.86952250259526e-05
## 11                  &lt;NA&gt;                &lt;NA&gt;             &lt;NA&gt;  0.00521731297924587
## 12                  &lt;NA&gt;                &lt;NA&gt;             &lt;NA&gt; 0.000149388430455142
## 13                  &lt;NA&gt;                &lt;NA&gt;             &lt;NA&gt;                 &lt;NA&gt;
## 14                  &lt;NA&gt;                &lt;NA&gt;             &lt;NA&gt;                 &lt;NA&gt;
## 15                  &lt;NA&gt;                &lt;NA&gt;             &lt;NA&gt;                 &lt;NA&gt;
##       p.A.prot_Pr...t..   p.A.prot_Std.Error  p.A.prot_tvalue  p.A.nProt_Estimate
## 1                  &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;                &lt;NA&gt;
## 2                  &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;                &lt;NA&gt;
## 3                  &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;                &lt;NA&gt;
## 4                  &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;                &lt;NA&gt;
## 5                  &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;                &lt;NA&gt;
## 6                  &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;                &lt;NA&gt;
## 7                  &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;                &lt;NA&gt;
## 8                  &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;                &lt;NA&gt;
## 9                  &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;                &lt;NA&gt;
## 10 0.000125048896903791 1.00852286184785e-05 3.83682180045518                &lt;NA&gt;
## 11    0.170833589209346  0.00380941660201464 1.36958319982295                &lt;NA&gt;
## 12 2.88060045451681e-17 1.76593895713687e-05 8.45943342783186                &lt;NA&gt;
## 13                 &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt; 0.00542428867316449
## 14                 &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;   0.779514232050632
## 15                 &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt; 0.00526237555581024
##       p.A.nProt_Pr...t..  p.A.nProt_Std.Error p.A.nProt_tvalue
## 1                   &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;
## 2                   &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;
## 3                   &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;
## 4                   &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;
## 5                   &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;
## 6                   &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;
## 7                   &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;
## 8                   &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;
## 9                   &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;
## 10                  &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;
## 11                  &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;
## 12                  &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;
## 13 5.25341325077391e-226 0.000166671307872964 32.5448257554855
## 14  1.47950939943836e-33     0.06444313759758 12.0961557911467
## 15   3.7685780281174e-70 0.000295969260771016 17.7801422421419</code></pre>
</div>
<div id="test-program-iv-return-all" class="section level5">
<h5><span class="header-section-number">5.1.2.3.6</span> Test Program IV Return All</h5>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb416-1" title="1">vars.z &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;indi.id&#39;</span>)</a>
<a class="sourceLine" id="cb416-2" title="2"><span class="kw">ff_reg_mbyn</span>(list.vars.y, list.vars.x,</a>
<a class="sourceLine" id="cb416-3" title="3">            vars.c, vars.z, df,</a>
<a class="sourceLine" id="cb416-4" title="4">            <span class="dt">return_all =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb416-5" title="5">            <span class="dt">stats_ends =</span> <span class="st">&#39;Estimate&#39;</span>)</a></code></pre></div>
<pre><code>## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped</code></pre>
<pre><code>##    X.Intercept._Estimate X.Intercept._Pr...z.. X.Intercept._Std.Error X.Intercept._zvalue
## 1       40.2173991882938  3.69748206920405e-59       2.47963650430699    16.2190704639323
## 2        1408.1626637032   0.00217397545504963       459.377029874119    3.06537456626657
## 3       -64.490636067872  0.000109756271656929        16.673099250727   -3.86794531107106
## 4       39.6732302990235 1.30030240177373e-103       1.83545587849039    21.6149190857443
## 5       1325.54736576331   0.00138952700443324       414.645900526211    3.19681772828602
## 6      -59.8304089440729  3.75547414421179e-07       11.7754321198995   -5.08095230263053
## 7       35.5561817357046 2.01357089467444e-142       1.39936229104453    25.4088465605032
## 8        -2791.221534909  1.95034793045284e-05       653.605248808641   -4.27050048939585
## 9       21.8005242861645  1.17899313785408e-34       1.77547715237629    12.2786847788984
## 10      24.3009261707644  1.97968607369592e-84        1.2481331128579    19.4698193008609
## 11     -499.067024090554     0.155922992163314       351.723712333143   -1.41891776582254
## 12      21.4632286881661  1.84405333738942e-09       3.57067054655531    6.01097984491234
## 13       25.299209739617 1.29388565624566e-157      0.945826571474308     26.748254386829
## 14     -352.278518334717     0.287184942021997       330.990098562619    -1.0643173915611
## 15      17.9359211844992  1.13855583530306e-12       2.52170174723203    7.11262590993832
##        hgt0_Estimate         hgt0_Pr...z..     hgt0_Std.Error      hgt0_zvalue     prot_Estimate
## 1  0.403139725681418  1.25009876641748e-13 0.0543948312973965 7.41136089709158 0.859205733632614
## 2   35.5765914326678  0.000445802636381424   10.1318250572006 3.51137048180512  98.9428234201406
## 3   1.20995060148712   0.00097112649404847  0.366789440587685 3.29876072644971 -6.02451379136132
## 4  0.357976348180876  2.82141265004339e-17 0.0423453726223874 8.45373003027063              &lt;NA&gt;
## 5   31.0172706497394    0.0013100303315764   9.65135595900306 3.21377335801252              &lt;NA&gt;
## 6    1.5037447089682  3.70002169470828e-08  0.273179527952317 5.50460248701607              &lt;NA&gt;
## 7  0.460434521499963  2.98739737280869e-37 0.0361031059207763 12.7533216258548              &lt;NA&gt;
## 8   59.1545587745268  0.000542570320022534   17.1025823111635 3.45880859967647              &lt;NA&gt;
## 9  0.412512139031067  3.02226357947691e-20 0.0447499166716409 9.21816552325528              &lt;NA&gt;
## 10 0.515794899569023  8.57492956381676e-59 0.0319035514861838 16.1673191711084              &lt;NA&gt;
## 11  46.2591615803265   2.8561488738123e-07   9.01263684093548 5.13270005180026              &lt;NA&gt;
## 12 0.520812513246773  1.10039023747789e-08 0.0911390672920558 5.71448149208973              &lt;NA&gt;
## 13 0.510868687340428 3.24936430168307e-102 0.0237991645877977 21.4658243761363              &lt;NA&gt;
## 14  45.5654716961559   6.3454545304127e-08   8.42434865398195 5.40878275196011              &lt;NA&gt;
## 15 0.534362107844268  3.42500501176006e-17  0.063380058773461  8.4310762436216              &lt;NA&gt;
##           prot_Pr...z..     prot_Std.Error       prot_zvalue Sargan_df1   sexMale_Estimate
## 1  6.88427338202428e-19 0.0967928354481331  8.87674929300964          0  0.154043421788007
## 2  2.09631602352917e-08   17.6561952052848  5.60385871756365          0   333.799680049259
## 3  2.94171378745816e-20  0.653342710289155 -9.22106223347162          0   5.41175429817609
## 4                  &lt;NA&gt;               &lt;NA&gt;              &lt;NA&gt;          0  0.106307556057668
## 5                  &lt;NA&gt;               &lt;NA&gt;              &lt;NA&gt;          0   330.452608866758
## 6                  &lt;NA&gt;               &lt;NA&gt;              &lt;NA&gt;          0   5.83118942788808
## 7                  &lt;NA&gt;               &lt;NA&gt;              &lt;NA&gt;          0   1.80283907885782
## 8                  &lt;NA&gt;               &lt;NA&gt;              &lt;NA&gt;          0   997.747599807148
## 9                  &lt;NA&gt;               &lt;NA&gt;              &lt;NA&gt;          0 -0.452827875182598
## 10                 &lt;NA&gt;               &lt;NA&gt;              &lt;NA&gt;          0   1.02741625216018
## 11                 &lt;NA&gt;               &lt;NA&gt;              &lt;NA&gt;          0   411.365911332896
## 12                 &lt;NA&gt;               &lt;NA&gt;              &lt;NA&gt;          0 -0.789122421167432
## 13                 &lt;NA&gt;               &lt;NA&gt;              &lt;NA&gt;          0   1.02009164592608
## 14                 &lt;NA&gt;               &lt;NA&gt;              &lt;NA&gt;          0   409.820707458838
## 15                 &lt;NA&gt;               &lt;NA&gt;              &lt;NA&gt;          0 -0.746032636368145
##        sexMale_Pr...z..  sexMale_Std.Error    sexMale_zvalue svymthRound_Estimate
## 1      0.38807812932888  0.178475271469781  0.86310792817082     0.20990165085783
## 2  5.06413216642981e-24   33.0216035385405  10.1085242471545      121.78985943172
## 3  5.80077629932476e-06   1.19371921154418  4.53352366774387     4.84745570027424
## 4     0.423490075745117  0.132821186086547 0.800381017440976    0.322893837128574
## 5  2.52735690930834e-27   30.5174257711927  10.8283251459136     135.494858749214
## 6  6.12283824664132e-12  0.847955715223327  6.87676174970095     4.07024693316581
## 7   1.1689328480129e-65  0.105343525210948   17.113904962338    0.433164820953121
## 8  2.02347084785411e-89   49.7632792630648  20.0498764266063      190.07735139541
## 9  0.000647195788038449  0.132754263303719 -3.41102322376347   0.0137438264666969
## 10 1.69796551008584e-27 0.0945646985181925  10.8646912458831     1.00582859923509
## 11 2.05327249429949e-54   26.4822313532216  15.5336574870174     218.549980922774
## 12  0.00428270841484855  0.276250047248363 -2.85655126226267   -0.369567838754916
## 13 1.70848440093529e-51 0.0675715533063635  15.0964658352764    0.929266902426869
## 14 2.36314216739034e-62   24.5920104216267  16.6647907361992     207.078222946319
## 15 6.57521045473888e-05   0.18692145837209 -3.99115565898846  -0.0985678389223824
##     svymthRound_Pr...z.. svymthRound_Std.Error svymthRound_zvalue vars_var.y
## 1    0.00846239710392287    0.0797183179471441   2.63304164291327        hgt
## 2   5.96047652813855e-17      14.5577085129475   8.36600480930094        wgt
## 3   2.07373887977152e-19     0.538050140685815   9.00930105527994     vil.id
## 4   9.66146445882893e-11    0.0498896912188091   6.47215545416802        hgt
## 5   4.48931446042076e-34       11.133488331472   12.1700274626596        wgt
## 6   5.64723572160763e-36     0.325043349284718   12.5221664806331     vil.id
## 7                      0   0.00120472816008751   359.553993426746        hgt
## 8                      0     0.739269879490032    257.11496798237        wgt
## 9   1.57416908709431e-66  0.000797655931686456   17.2302692435808     vil.id
## 10                     0   0.00746867714609297   134.672925279848        hgt
## 11                     0       1.9315711781906   113.146221785884        wgt
## 12 2.42696379701225e-102    0.0172056989832505  -21.4793853545086     vil.id
## 13                     0   0.00539330635998817   172.300040161061        hgt
## 14                     0      1.46167854745858   141.671520941705        wgt
## 15  1.84569897952709e-27   0.00907867488118012  -10.8570733297996     vil.id
##                  vars_vars.c vars_vars.x vars_vars.z Weakinstruments_df1 Weakinstruments_df2
## 1  sex+wgt0+hgt0+svymthRound        prot     indi.id                   1               18957
## 2  sex+wgt0+hgt0+svymthRound        prot     indi.id                   1               18962
## 3  sex+wgt0+hgt0+svymthRound        prot     indi.id                   1               18999
## 4  sex+wgt0+hgt0+svymthRound         cal     indi.id                   1               18957
## 5  sex+wgt0+hgt0+svymthRound         cal     indi.id                   1               18962
## 6  sex+wgt0+hgt0+svymthRound         cal     indi.id                   1               18999
## 7  sex+wgt0+hgt0+svymthRound   wealthIdx     indi.id                   1               25092
## 8  sex+wgt0+hgt0+svymthRound   wealthIdx     indi.id                   1               25102
## 9  sex+wgt0+hgt0+svymthRound   wealthIdx     indi.id                   1               30013
## 10 sex+wgt0+hgt0+svymthRound    p.A.prot     indi.id                   1               18587
## 11 sex+wgt0+hgt0+svymthRound    p.A.prot     indi.id                   1               18591
## 12 sex+wgt0+hgt0+svymthRound    p.A.prot     indi.id                   1               18845
## 13 sex+wgt0+hgt0+svymthRound   p.A.nProt     indi.id                   1               18587
## 14 sex+wgt0+hgt0+svymthRound   p.A.nProt     indi.id                   1               18591
## 15 sex+wgt0+hgt0+svymthRound   p.A.nProt     indi.id                   1               18845
##    Weakinstruments_p.value Weakinstruments_statistic         wgt0_Estimate         wgt0_Pr...z..
## 1     1.42153759923994e-19          82.0931934821266  -0.00163274724538111  4.88365163639597e-08
## 2     4.45734829676713e-19          79.8251182827386     0.492582112313709  2.33136555228405e-20
## 3     5.72345606957941e-20          83.8989817367586   0.00999798623641602  7.95432753711715e-07
## 4     1.77770827184424e-37          164.392129625299 -0.000658938519302931   0.00032843149807424
## 5     4.03760292920738e-37          162.747072038429     0.601258436431587   2.0921134733036e-48
## 6     5.47447735093002e-38           166.75260665498   0.00326074237566435   0.00667886646012294
## 7                        0          7029.47383089383   0.00112485055604169  2.26123807446765e-11
## 8                        0          7038.38467113128      1.27282038539707  6.67525280062144e-56
## 9                        0          12942.6315513372  -0.00512158791392237 6.51923753120087e-127
## 10                       0          1710.98122418591  0.000716628918444932  2.43477572076212e-06
## 11                       0          1715.15052113399     0.761704518610475   8.2201479288098e-69
## 12                       0          1725.71954882902  -0.00601345031606092  5.19751747217521e-44
## 13                       0          5097.88462603711  0.000922100117259348  1.68237436753105e-15
## 14                       0           5110.7741807338     0.792700893714085  4.81415543564975e-82
## 15                       0          5136.55662964887  -0.00668277875606482 2.54848840100353e-105
##          wgt0_Std.Error       wgt0_zvalue Wu.Hausman_df1 Wu.Hausman_df2    Wu.Hausman_p.value
## 1   0.00029928487659495 -5.45549532591606              1          18956 1.53929570343279e-118
## 2    0.0532753838702833  9.24596082710666              1          18961  3.13415891402799e-08
## 3   0.00202532507408065  4.93648469787221              1          18998                     0
## 4  0.000183457551985601 -3.59177647456371              1          18956 2.88592507054107e-108
## 5    0.0411255751282477  14.6200614716414              1          18961   7.6495944085204e-07
## 6   0.00120214094164169  2.71244598924594              1          18998                     0
## 7  0.000168187467853553  6.68807593334564              1          25091    0.0221987672063003
## 8      0.08080475140115  15.7518012657231              1          25101    0.0099360023036833
## 9  0.000213715312589078 -23.9645341827701              1          30012                     0
## 10 0.000152036990658929  4.71351685756907              1          18586 1.80909125272768e-238
## 11   0.0434474820359048   17.531614789115              1          18590  2.14946499922491e-35
## 12  0.00043218241369976 -13.9141485757875              1          18844                     0
## 13  0.00011580150512068  7.96276452796019              1          18586 3.15182965429765e-108
## 14   0.0413159097814445  19.1863351892132              1          18590   1.7681125741529e-17
## 15 0.000306609919182859 -21.7957030675165              1          18844                     0
##    Wu.Hausman_statistic       cal_Estimate         cal_Pr...z..       cal_Std.Error
## 1      543.467268879953               &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;
## 2      30.6481856102772               &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;
## 3      5652.51924792859               &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;
## 4      494.955883488045 0.0238724384575419 1.44956616452661e-33 0.00197718112735887
## 5      24.4605456760994   2.71948246216953 9.21076021290446e-10   0.444177077282291
## 6      5583.56513052781 -0.168054407187466 5.67614501764414e-39  0.0128692506794877
## 7      5.23078768861684               &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;
## 8       6.6473469952822               &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;
## 9      25949.7118056025               &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;
## 10     1119.87022468742               &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;
## 11     154.793296861581               &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;
## 12     4826.92242730041               &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;
## 13     494.903094649183               &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;
## 14      72.530787010352               &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;
## 15     7607.83405438193               &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;
##           cal_zvalue wealthIdx_Estimate   wealthIdx_Pr...z.. wealthIdx_Std.Error  wealthIdx_zvalue
## 1               &lt;NA&gt;               &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 2               &lt;NA&gt;               &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 3               &lt;NA&gt;               &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 4   12.0739764947235               &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 5    6.1225187008946               &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 6  -13.0586007975839               &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 7               &lt;NA&gt;  0.144503490136948 3.72983264926432e-06  0.0312379492766376  4.62589553677969
## 8               &lt;NA&gt;   69.1816142883022 2.23442991281176e-07     13.358888551386  5.17869536991717
## 9               &lt;NA&gt;  -1.91414470908345                    0  0.0371054140359243 -51.5866689219593
## 10              &lt;NA&gt;               &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 11              &lt;NA&gt;               &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 12              &lt;NA&gt;               &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 13              &lt;NA&gt;               &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 14              &lt;NA&gt;               &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 15              &lt;NA&gt;               &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
##       p.A.prot_Estimate     p.A.prot_Pr...z..   p.A.prot_Std.Error   p.A.prot_zvalue
## 1                  &lt;NA&gt;                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;
## 2                  &lt;NA&gt;                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;
## 3                  &lt;NA&gt;                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;
## 4                  &lt;NA&gt;                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;
## 5                  &lt;NA&gt;                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;
## 6                  &lt;NA&gt;                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;
## 7                  &lt;NA&gt;                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;
## 8                  &lt;NA&gt;                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;
## 9                  &lt;NA&gt;                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;
## 10  0.00148073028434642 2.50759287066563e-156 5.55884799941827e-05  26.6373587567312
## 11    0.221916473012486  8.30126393398654e-33   0.0186022369560791  11.9295584469998
## 12 -0.00520794333267238 3.00201194005694e-197 0.000173813943639721 -29.9627476577329
## 13                 &lt;NA&gt;                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;
## 14                 &lt;NA&gt;                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;
## 15                 &lt;NA&gt;                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;
##     p.A.nProt_Estimate    p.A.nProt_Pr...z..  p.A.nProt_Std.Error  p.A.nProt_zvalue
## 1                 &lt;NA&gt;                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;
## 2                 &lt;NA&gt;                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;
## 3                 &lt;NA&gt;                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;
## 4                 &lt;NA&gt;                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;
## 5                 &lt;NA&gt;                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;
## 6                 &lt;NA&gt;                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;
## 7                 &lt;NA&gt;                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;
## 8                 &lt;NA&gt;                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;
## 9                 &lt;NA&gt;                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;
## 10                &lt;NA&gt;                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;
## 11                &lt;NA&gt;                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;
## 12                &lt;NA&gt;                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;
## 13  0.0141317656200726 2.61782083774363e-226 0.000440019589949091  32.1162192385744
## 14    2.11856940494335  4.81511329043196e-35     0.17153115470458  12.3509307017263
## 15 -0.0494468877742109                     0  0.00128926108222202 -38.3528894620707</code></pre>
</div>
</div>
<div id="program-line-by-line" class="section level4">
<h4><span class="header-section-number">5.1.2.4</span> Program Line by Line</h4>
<p>Set Up Parameters</p>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb419-1" title="1">vars.z &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;indi.id&#39;</span>)</a>
<a class="sourceLine" id="cb419-2" title="2">vars.z &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb419-3" title="3">vars.c &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;sex&#39;</span>, <span class="st">&#39;wgt0&#39;</span>, <span class="st">&#39;hgt0&#39;</span>, <span class="st">&#39;svymthRound&#39;</span>)</a></code></pre></div>
<div id="lapply" class="section level5">
<h5><span class="header-section-number">5.1.2.4.1</span> Lapply</h5>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb420-1" title="1">df.reg.out &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(<span class="kw">bind_rows</span>(<span class="kw">lapply</span>(list.vars.y, regf.iv, <span class="dt">vars.x=</span>var.x1, <span class="dt">vars.c=</span>vars.c, <span class="dt">vars.z=</span>vars.z, <span class="dt">df=</span>df)))</a></code></pre></div>
</div>
<div id="nested-lapply-test" class="section level5">
<h5><span class="header-section-number">5.1.2.4.2</span> Nested Lapply Test</h5>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb421-1" title="1"><span class="kw">lapply</span>(list.vars.y, <span class="cf">function</span>(y) (<span class="kw">mean</span>(df[[var.x1]], <span class="dt">na.rm=</span><span class="ot">TRUE</span>) <span class="op">+</span><span class="st"> </span><span class="kw">mean</span>(df[[y]], <span class="dt">na.rm=</span><span class="ot">TRUE</span>)))</a></code></pre></div>
<pre><code>## [[1]]
## [1] 98.3272
## 
## [[2]]
## [1] 13626.51
## 
## [[3]]
## [1] 26.11226</code></pre>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb423-1" title="1">lapplytwice &lt;-<span class="st"> </span><span class="kw">lapply</span>(list.vars.x, <span class="cf">function</span>(x) (<span class="kw">lapply</span>(list.vars.y, <span class="cf">function</span>(y) (<span class="kw">mean</span>(df[[x]], <span class="dt">na.rm=</span><span class="ot">TRUE</span>) <span class="op">+</span><span class="st"> </span><span class="kw">mean</span>(df[[y]], <span class="dt">na.rm=</span><span class="ot">TRUE</span>)))))</a>
<a class="sourceLine" id="cb423-2" title="2">lapplytwice</a></code></pre></div>
<pre><code>## [[1]]
## [[1]][[1]]
## [1] 98.3272
## 
## [[1]][[2]]
## [1] 13626.51
## 
## [[1]][[3]]
## [1] 26.11226
## 
## 
## [[2]]
## [[2]][[1]]
## [1] 525.4708
## 
## [[2]][[2]]
## [1] 14053.65
## 
## [[2]][[3]]
## [1] 453.2558
## 
## 
## [[3]]
## [[3]][[1]]
## [1] 90.69287
## 
## [[3]][[2]]
## [1] 13618.87
## 
## [[3]][[3]]
## [1] 18.47793
## 
## 
## [[4]]
## [[4]][[1]]
## [1] 2095.3
## 
## [[4]][[2]]
## [1] 15623.48
## 
## [[4]][[3]]
## [1] 2023.085
## 
## 
## [[5]]
## [[5]][[1]]
## [1] 271.2886
## 
## [[5]][[2]]
## [1] 13799.47
## 
## [[5]][[3]]
## [1] 199.0737</code></pre>
</div>
<div id="nested-lapply-all" class="section level5">
<h5><span class="header-section-number">5.1.2.4.3</span> Nested Lapply All</h5>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb425-1" title="1">df.reg.out.all &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(<span class="kw">lapply</span>(list.vars.x,</a>
<a class="sourceLine" id="cb425-2" title="2">                      <span class="cf">function</span>(x) (</a>
<a class="sourceLine" id="cb425-3" title="3">                          <span class="kw">bind_rows</span>(<span class="kw">lapply</span>(list.vars.y, regf.iv, <span class="dt">vars.x=</span>x, <span class="dt">vars.c=</span>vars.c, <span class="dt">vars.z=</span>vars.z, <span class="dt">df=</span>df))</a>
<a class="sourceLine" id="cb425-4" title="4">                      )))</a></code></pre></div>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb426-1" title="1">df.reg.out.all</a></code></pre></div>
<pre><code>##    X.Intercept._Estimate X.Intercept._Pr...t.. X.Intercept._Std.Error X.Intercept._tvalue
## 1       27.3528514188608 5.68247182214952e-231      0.831272666092284    32.9047886867776
## 2        99.873884728925      0.75529705553815       320.450650378664    0.31166697465244
## 3       31.4646660224049  6.78164655340399e-84       1.61328519718754     19.503474077155
## 4       27.9038445914729 8.24252673989353e-242      0.828072565159449    33.6973421962119
## 5       219.626705179399     0.493216914827181       320.522532223672   0.685214557790078
## 6       30.5103987898551  1.62608789535248e-79       1.60831193651104    18.9704485163756
## 7       35.7840188807906 2.26726906489443e-145       1.38461348429899    25.8440491058106
## 8      -2662.74787734003  7.13318862990131e-05       670.301542938561   -3.97246270039407
## 9       29.2381039651127 1.53578035267873e-124       1.22602177264147    23.8479483950102
## 10      23.9948407749744 2.11912344053336e-165       0.86658104216672    27.6890903532576
## 11     -547.959546430028    0.0941551350855875       327.343126852912    -1.6739607509042
## 12      22.3367814226238  3.04337266226599e-49        1.5098937308759    14.7936116071335
## 13      24.4904444950827 2.34941965806705e-181      0.843371070670838    29.0387533397398
## 14     -476.703973630552     0.143844033032183       326.132837036936   -1.46168652614567
## 15      22.7781908464511  9.58029450711211e-52        1.5004526558957    15.1808794212527
##       adj.r.squared_v df1_v df2_v df3_v      hgt0_Estimate         hgt0_Pr...t..     hgt0_Std.Error
## 1   0.814249026159781     6 18957     6   0.60391817340617 1.14533314566771e-183 0.0206657538633713
## 2    0.60716936506893     6 18962     6   56.3852027199184  1.52417506966835e-12   7.96735224000553
## 3  0.0373247512680971     6 18999     6 -0.296844389234445  1.40290395213743e-13 0.0401060913799595
## 4    0.81608922805658     6 18957     6  0.589847843438394 7.79174951119325e-177 0.0205836398278421
## 5   0.607863678511207     6 18962     6   52.9707041800704  3.05720143843395e-11   7.96822145797115
## 6  0.0453498711076042     6 18999     6 -0.273219210757899  8.49149153665126e-12 0.0399777363511633
## 7   0.935014931990565     6 25092     6  0.439374451256039  2.71000479249152e-36 0.0348701896610764
## 8    0.92193683733695     6 25102     6    47.176969664749   0.00520266507060071   16.8823489375743
## 9   0.059543122812776     6 30013     6  -0.35908163982046  2.41020063623865e-31 0.0307984635553859
## 10  0.814690803458616     6 18587     6  0.687269209411865 1.31914432912869e-220 0.0213841849324282
## 11  0.617300597776144     6 18591     6    72.105560623359  4.78613024244006e-19   8.07744906400683
## 12 0.0261131074199838     6 18845     6 -0.108789161111504    0.0034801146146182 0.0372288594891345
## 13  0.824542352656376     6 18587     6  0.622395388389206 1.11511327164938e-190 0.0208846437570215
## 14  0.620250730454724     6 18591     6   62.7336220289257  8.38546282719268e-15   8.07589192978212
## 15 0.0385437355117917     6 18845     6 -0.157811627494693  2.13723119924676e-05 0.0371223237183417
##          hgt0_tvalue       prot_Estimate        prot_Pr...t..      prot_Std.Error       prot_tvalue
## 1   29.2231378249683   0.049431093806755 9.54769322304645e-79 0.00261878251179557  18.8756010031786
## 2    7.0770314931977    16.5557424523585 9.61203373222183e-60    1.01201959743751  16.3591125056062
## 3  -7.40147890309685 -0.0758835879205584 3.56396093562335e-50 0.00507971302734622 -14.9385580468907
## 4   28.6561486875877                &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 5   6.64774497790599                &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 6  -6.83428417151858                &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 7   12.6002885423502                &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 8   2.79445531182864                &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 9   -11.659076407325                &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 10  32.1391351404584                &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 11  8.92677379355593                &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 12 -2.92217281443323                &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 13  29.8015803204665                &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 14  7.76801157994423                &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
## 15 -4.25112470577158                &lt;NA&gt;                 &lt;NA&gt;                &lt;NA&gt;              &lt;NA&gt;
##           r.squared_v   sexMale_Estimate     sexMale_Pr...t..  sexMale_Std.Error    sexMale_tvalue
## 1   0.814298005954592  0.935177182449406 2.36432111724607e-51 0.0618482294097262  15.1205166481668
## 2   0.607272921412825   415.163616765357 2.48252880290814e-67   23.8518341439675  17.4059409544552
## 3  0.0375780335372857 -0.254089999175318   0.0343768259467621  0.120093045309631 -2.11577613441484
## 4   0.816137722617266  0.893484662055608 2.08765935335877e-47 0.0616078355613525  14.5027763743757
## 5    0.60796705182314   405.534891838028 2.51355675686752e-64   23.8567507583516  16.9987478993157
## 6  0.0456010419476623 -0.181389489610951    0.129768754080748   0.11972270545355 -1.51508010885476
## 7    0.93502787877066   1.80682463132073 1.26527362032354e-66  0.104475287357902  17.2942776901016
## 8   0.921952383432195   999.926876716707 2.64630894140004e-86   50.5879876531386  19.7660931597596
## 9  0.0596997716363463  -0.33436777751525 0.000311174554787706 0.0927193334338799 -3.60623577771614
## 10  0.814740639193486  0.932686930233136 7.90489020586094e-47 0.0647209948973267  14.4108867873979
## 11  0.617403496088206   397.141948675354 6.19449742677662e-59   24.4473730956481  16.2447698213453
## 12 0.0263714328556815 -0.445232370681998 7.93666802281971e-05  0.112797805327952 -3.94717228218682
## 13  0.824589538985803   0.96466980500711 1.24556615236597e-52 0.0629827627260302   15.316409812052
## 14  0.620352835549783    401.59056368102 1.18469030741261e-60   24.3549086073387  16.4891016491029
## 15 0.0387987636986586 -0.423829627017582  0.00015644693636154  0.112083516545945 -3.78137339083082
##             sigma_v svymthRound_Estimate svymthRound_Pr...t.. svymthRound_Std.Error
## 1  4.21029844914315     0.87166589100565                    0   0.00387681209575621
## 2  1623.77111076428      189.04290688382                    0       1.4955473831309
## 3  8.18491760066961  -0.0154759587993917   0.0397984032097113   0.00752730297891317
## 4  4.18939119979502    0.851989049736817                    0   0.00411253488213795
## 5  1622.33549880859     185.318286001897                    0      1.59266949679221
## 6  8.15073036560541   0.0201471237605442   0.0117151185126433   0.00799217807522278
## 7  8.18607049768594    0.432815253441723                    0  0.000728323735328998
## 8  3964.45339913597     189.877994795061                    0     0.352701518968252
## 9  7.93450742809862  0.00215144302579706 0.000447277200167272  0.000612792699568233
## 10 4.35662621773428     0.91961467696139                    0   0.00331108017589107
## 11 1645.77655955938     205.597385664745                    0      1.25083486490652
## 12  7.6435668370875  -0.0509574460702806 1.37139389802397e-18   0.00578476859618168
## 13 4.23923961592693    0.921894094780682                    0   0.00317113547025635
## 14 1639.42085007515     205.945143306004                    0      1.22639878616071
## 15 7.59462918474114  -0.0557204455206461 7.79141497751766e-23   0.00565696328562864
##    svymthRound_tvalue vars_var.y               vars_vars.c vars_vars.x         wgt0_Estimate
## 1    224.840892330022        hgt sex+wgt0+hgt0+svymthRound        prot -0.000146104685986986
## 2    126.403823119306        wgt sex+wgt0+hgt0+svymthRound        prot     0.637023553461055
## 3   -2.05597660181154     vil.id sex+wgt0+hgt0+svymthRound        prot -0.000903390591533867
## 4    207.168832400006        hgt sex+wgt0+hgt0+svymthRound         cal -0.000116898230009949
## 5    116.357025971267        wgt sex+wgt0+hgt0+svymthRound         cal     0.649394003614758
## 6    2.52085521254888     vil.id sex+wgt0+hgt0+svymthRound         cal -0.000941137072743919
## 7    594.262183761197        hgt sex+wgt0+hgt0+svymthRound   wealthIdx   0.00122231975126219
## 8    538.353209678558        wgt sex+wgt0+hgt0+svymthRound   wealthIdx      1.32870822160235
## 9    3.51088227277012     vil.id sex+wgt0+hgt0+svymthRound   wealthIdx -0.000845938526704796
## 10   277.738571133786        hgt sex+wgt0+hgt0+svymthRound    p.A.prot -0.000489534836079617
## 11   164.368128386085        wgt sex+wgt0+hgt0+svymthRound    p.A.prot     0.580023505722658
## 12  -8.80889965139067     vil.id sex+wgt0+hgt0+svymthRound    p.A.prot  -0.00156196911156061
## 13   290.714194782148        hgt sex+wgt0+hgt0+svymthRound   p.A.nProt  3.23596154259101e-05
## 14   167.926734460268        wgt sex+wgt0+hgt0+svymthRound   p.A.nProt      0.65551206304675
## 15  -9.84988636256528     vil.id sex+wgt0+hgt0+svymthRound   p.A.nProt  -0.00115432723977403
##           wgt0_Pr...t..       wgt0_Std.Error       wgt0_tvalue         cal_Estimate
## 1     0.136011583497549 9.79994437486573e-05 -1.49087260496811                 &lt;NA&gt;
## 2  2.96480083692757e-63   0.0378027371614794  16.8512547316329                 &lt;NA&gt;
## 3  2.05763549729273e-06 0.000190221503167431 -4.74915073475531                 &lt;NA&gt;
## 4     0.230228828649018 9.74307633896921e-05 -1.19980821193398  0.00243408846205622
## 5  7.43034302413852e-66    0.037739875283113  17.2071051836606    0.699072500364623
## 6  6.66901196231733e-07 0.000189270503626621 -4.97244448929308 -0.00395676177098486
## 7  1.22269348058816e-13 0.000164767846917989  7.41843614592224                 &lt;NA&gt;
## 8  6.75367630221077e-62   0.0798131859486402  16.6477281392748                 &lt;NA&gt;
## 9  4.32675510884621e-09 0.000144040382619518   -5.872926128913                 &lt;NA&gt;
## 10 7.77000489086602e-07 9.90410500454311e-05 -4.94274682926991                 &lt;NA&gt;
## 11 7.42419220783427e-54   0.0374185042114355  15.5009805428138                 &lt;NA&gt;
## 12 1.40362012201826e-19 0.000172365145002826  -9.0619777654873                 &lt;NA&gt;
## 13    0.740027016459552 9.75208524392668e-05 0.331822524275644                 &lt;NA&gt;
## 14 4.09082062947785e-67   0.0377202854835204  17.3782370584956                 &lt;NA&gt;
## 15 2.75472781728448e-11 0.000173241059789276 -6.66312732777158                 &lt;NA&gt;
##             cal_Pr...t..        cal_Std.Error        cal_tvalue wealthIdx_Estimate
## 1                   &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;               &lt;NA&gt;
## 2                   &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;               &lt;NA&gt;
## 3                   &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;               &lt;NA&gt;
## 4  8.01672708877986e-120 0.000103833679413418  23.4421863484661               &lt;NA&gt;
## 5   4.71331900885298e-67   0.0402492068645167  17.3686031309332               &lt;NA&gt;
## 6   7.94646124029527e-85 0.000201721108117477 -19.6150110809452               &lt;NA&gt;
## 7                   &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;   0.21045655488185
## 8                   &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;   106.678721085969
## 9                   &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;  0.451733304543324
## 10                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;               &lt;NA&gt;
## 11                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;               &lt;NA&gt;
## 12                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;               &lt;NA&gt;
## 13                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;               &lt;NA&gt;
## 14                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;               &lt;NA&gt;
## 15                  &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;               &lt;NA&gt;
##       wealthIdx_Pr...t.. wealthIdx_Std.Error wealthIdx_tvalue    p.A.prot_Estimate
## 1                   &lt;NA&gt;                &lt;NA&gt;             &lt;NA&gt;                 &lt;NA&gt;
## 2                   &lt;NA&gt;                &lt;NA&gt;             &lt;NA&gt;                 &lt;NA&gt;
## 3                   &lt;NA&gt;                &lt;NA&gt;             &lt;NA&gt;                 &lt;NA&gt;
## 4                   &lt;NA&gt;                &lt;NA&gt;             &lt;NA&gt;                 &lt;NA&gt;
## 5                   &lt;NA&gt;                &lt;NA&gt;             &lt;NA&gt;                 &lt;NA&gt;
## 6                   &lt;NA&gt;                &lt;NA&gt;             &lt;NA&gt;                 &lt;NA&gt;
## 7   1.93494257274268e-41  0.0155791042075745  13.508899618216                 &lt;NA&gt;
## 8    3.2548345535026e-45    7.54496977117083 14.1390521528113                 &lt;NA&gt;
## 9  4.82890644822007e-250  0.0132483771350785 34.0972558327347                 &lt;NA&gt;
## 10                  &lt;NA&gt;                &lt;NA&gt;             &lt;NA&gt; 3.86952250259526e-05
## 11                  &lt;NA&gt;                &lt;NA&gt;             &lt;NA&gt;  0.00521731297924587
## 12                  &lt;NA&gt;                &lt;NA&gt;             &lt;NA&gt; 0.000149388430455142
## 13                  &lt;NA&gt;                &lt;NA&gt;             &lt;NA&gt;                 &lt;NA&gt;
## 14                  &lt;NA&gt;                &lt;NA&gt;             &lt;NA&gt;                 &lt;NA&gt;
## 15                  &lt;NA&gt;                &lt;NA&gt;             &lt;NA&gt;                 &lt;NA&gt;
##       p.A.prot_Pr...t..   p.A.prot_Std.Error  p.A.prot_tvalue  p.A.nProt_Estimate
## 1                  &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;                &lt;NA&gt;
## 2                  &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;                &lt;NA&gt;
## 3                  &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;                &lt;NA&gt;
## 4                  &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;                &lt;NA&gt;
## 5                  &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;                &lt;NA&gt;
## 6                  &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;                &lt;NA&gt;
## 7                  &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;                &lt;NA&gt;
## 8                  &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;                &lt;NA&gt;
## 9                  &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;                &lt;NA&gt;
## 10 0.000125048896903791 1.00852286184785e-05 3.83682180045518                &lt;NA&gt;
## 11    0.170833589209346  0.00380941660201464 1.36958319982295                &lt;NA&gt;
## 12 2.88060045451681e-17 1.76593895713687e-05 8.45943342783186                &lt;NA&gt;
## 13                 &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt; 0.00542428867316449
## 14                 &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;   0.779514232050632
## 15                 &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt; 0.00526237555581024
##       p.A.nProt_Pr...t..  p.A.nProt_Std.Error p.A.nProt_tvalue
## 1                   &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;
## 2                   &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;
## 3                   &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;
## 4                   &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;
## 5                   &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;
## 6                   &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;
## 7                   &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;
## 8                   &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;
## 9                   &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;
## 10                  &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;
## 11                  &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;
## 12                  &lt;NA&gt;                 &lt;NA&gt;             &lt;NA&gt;
## 13 5.25341325077391e-226 0.000166671307872964 32.5448257554855
## 14  1.47950939943836e-33     0.06444313759758 12.0961557911467
## 15   3.7685780281174e-70 0.000295969260771016 17.7801422421419</code></pre>
</div>
<div id="nested-lapply-select" class="section level5">
<h5><span class="header-section-number">5.1.2.4.4</span> Nested Lapply Select</h5>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb428-1" title="1">df.reg.out.all &lt;-<span class="st"> </span>(<span class="kw">lapply</span>(list.vars.x,</a>
<a class="sourceLine" id="cb428-2" title="2">                      <span class="cf">function</span>(x) (</a>
<a class="sourceLine" id="cb428-3" title="3">                          <span class="kw">bind_rows</span>(<span class="kw">lapply</span>(list.vars.y, regf.iv, <span class="dt">vars.x=</span>x, <span class="dt">vars.c=</span>vars.c, <span class="dt">vars.z=</span>vars.z, <span class="dt">df=</span>df)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb428-4" title="4"><span class="st">                              </span><span class="kw">select</span>(vars_var.y, <span class="kw">starts_with</span>(x)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb428-5" title="5"><span class="st">                              </span><span class="kw">select</span>(vars_var.y, <span class="kw">ends_with</span>(<span class="st">&#39;value&#39;</span>))</a>
<a class="sourceLine" id="cb428-6" title="6">                      ))) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">reduce</span>(full_join)</a></code></pre></div>
<pre><code>## Joining, by = &quot;vars_var.y&quot;Joining, by = &quot;vars_var.y&quot;Joining, by = &quot;vars_var.y&quot;Joining, by =
## &quot;vars_var.y&quot;</code></pre>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb430-1" title="1">df.reg.out.all</a></code></pre></div>
<pre><code>##   vars_var.y       prot_tvalue        cal_tvalue wealthIdx_tvalue  p.A.prot_tvalue p.A.nProt_tvalue
## 1        hgt  18.8756010031786  23.4421863484661  13.508899618216 3.83682180045518 32.5448257554855
## 2        wgt  16.3591125056062  17.3686031309332 14.1390521528113 1.36958319982295 12.0961557911467
## 3     vil.id -14.9385580468907 -19.6150110809452 34.0972558327347 8.45943342783186 17.7801422421419</code></pre>

</div>
</div>
</div>
</div>
<div id="decomposition" class="section level2">
<h2><span class="header-section-number">5.2</span> Decomposition</h2>

<div id="decompose-rhs" class="section level3">
<h3><span class="header-section-number">5.2.1</span> Decompose RHS</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/CodeDynaAsset/">fan</a>’s <a href="https://fanwangecon.github.io/REconTools/">REconTools</a> Package, <a href="https://fanwangecon.github.io/R4Econ/">R4Econ</a> Repository, or <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> Repository.</p>
</blockquote>
<p>One runs a number of regressions. With different outcomes, and various right hand side variables.</p>
<p>What is the remaining variation in the left hand side variable if right hand side variable one by one is set to the average of the observed values.</p>
<ul>
<li>Dependency: <em>R4Econ/linreg/ivreg/ivregdfrow.R</em></li>
</ul>
<p>The code below does not work with categorical variables (except for dummies). Dummy variable inputs need to be converted to zero/one first.</p>
<div id="decomposition-program" class="section level4">
<h4><span class="header-section-number">5.2.1.1</span> Decomposition Program</h4>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb432-1" title="1">ff_lr_decompose &lt;-<span class="st"> </span><span class="cf">function</span>(df, vars.y, vars.x, vars.c, vars.z, vars.other.keep,</a>
<a class="sourceLine" id="cb432-2" title="2">                            list.vars.tomean, list.vars.tomean.name.suffix,</a>
<a class="sourceLine" id="cb432-3" title="3">                            <span class="dt">df.reg.out =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb432-4" title="4">                            <span class="dt">graph=</span><span class="ot">FALSE</span>, <span class="dt">graph.nrow=</span><span class="dv">2</span>) {</a>
<a class="sourceLine" id="cb432-5" title="5"></a>
<a class="sourceLine" id="cb432-6" title="6">    vars.xc &lt;-<span class="st"> </span><span class="kw">c</span>(vars.x, vars.c)</a>
<a class="sourceLine" id="cb432-7" title="7"></a>
<a class="sourceLine" id="cb432-8" title="8">    <span class="co"># Regressions</span></a>
<a class="sourceLine" id="cb432-9" title="9">    <span class="co"># regf.iv from C:\Users\fan\R4Econ\linreg\ivreg\ivregdfrow.R</span></a>
<a class="sourceLine" id="cb432-10" title="10">    <span class="cf">if</span>(<span class="kw">is.null</span>(df.reg.out)) {</a>
<a class="sourceLine" id="cb432-11" title="11">      df.reg.out &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(<span class="kw">bind_rows</span>(<span class="kw">lapply</span>(vars.y, regf.iv,</a>
<a class="sourceLine" id="cb432-12" title="12">                                               <span class="dt">vars.x=</span>vars.x, <span class="dt">vars.c=</span>vars.c, <span class="dt">vars.z=</span>vars.z, <span class="dt">df=</span>df)))</a>
<a class="sourceLine" id="cb432-13" title="13">    }</a>
<a class="sourceLine" id="cb432-14" title="14"></a>
<a class="sourceLine" id="cb432-15" title="15">    <span class="co"># Select Variables</span></a>
<a class="sourceLine" id="cb432-16" title="16">    str.esti.suffix &lt;-<span class="st"> &#39;_Estimate&#39;</span></a>
<a class="sourceLine" id="cb432-17" title="17">    arr.esti.name &lt;-<span class="st"> </span><span class="kw">paste0</span>(vars.xc, str.esti.suffix)</a>
<a class="sourceLine" id="cb432-18" title="18">    str.outcome.name &lt;-<span class="st"> &#39;vars_var.y&#39;</span></a>
<a class="sourceLine" id="cb432-19" title="19">    arr.columns2select &lt;-<span class="st"> </span><span class="kw">c</span>(arr.esti.name, str.outcome.name)</a>
<a class="sourceLine" id="cb432-20" title="20">    <span class="co"># arr.columns2select</span></a>
<a class="sourceLine" id="cb432-21" title="21"></a>
<a class="sourceLine" id="cb432-22" title="22">    <span class="co"># Generate dataframe for coefficients</span></a>
<a class="sourceLine" id="cb432-23" title="23">    df.coef &lt;-<span class="st"> </span>df.reg.out[,<span class="kw">c</span>(arr.columns2select)] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(arr.esti.name), as.numeric) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">column_to_rownames</span>(str.outcome.name)</a>
<a class="sourceLine" id="cb432-24" title="24">    <span class="co"># df.coef</span></a>
<a class="sourceLine" id="cb432-25" title="25">    <span class="co"># str(df.coef)</span></a>
<a class="sourceLine" id="cb432-26" title="26"></a>
<a class="sourceLine" id="cb432-27" title="27">    <span class="co"># Decomposition Step 1: gather</span></a>
<a class="sourceLine" id="cb432-28" title="28">    df.decompose &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb432-29" title="29"><span class="st">                            </span><span class="kw">filter</span>(svymthRound <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">18</span>, <span class="dv">24</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb432-30" title="30"><span class="st">                            </span><span class="kw">select</span>(<span class="kw">one_of</span>(<span class="kw">c</span>(vars.other.keep, vars.xc, vars.y))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb432-31" title="31"><span class="st">                            </span><span class="kw">drop_na</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb432-32" title="32"><span class="st">                            </span><span class="kw">gather</span>(variable, value, <span class="op">-</span><span class="kw">one_of</span>(<span class="kw">c</span>(vars.other.keep, vars.xc)))</a>
<a class="sourceLine" id="cb432-33" title="33"></a>
<a class="sourceLine" id="cb432-34" title="34">    <span class="co"># Decomposition Step 2: mutate_at(vars, funs(mean = mean(.)))</span></a>
<a class="sourceLine" id="cb432-35" title="35">    <span class="co"># the xc averaging could have taken place earlier, no difference in mean across variables</span></a>
<a class="sourceLine" id="cb432-36" title="36">    df.decompose &lt;-<span class="st"> </span>df.decompose <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb432-37" title="37"><span class="st">                          </span><span class="kw">group_by</span>(variable) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb432-38" title="38"><span class="st">                          </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(<span class="kw">c</span>(vars.xc, <span class="st">&#39;value&#39;</span>)), <span class="kw">funs</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(.))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb432-39" title="39"><span class="st">                          </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb432-40" title="40"></a>
<a class="sourceLine" id="cb432-41" title="41">    <span class="co"># Decomposition Step 3 With Loop</span></a>
<a class="sourceLine" id="cb432-42" title="42">    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(list.vars.tomean)) {</a>
<a class="sourceLine" id="cb432-43" title="43">        var.decomp.cur &lt;-<span class="st"> </span>(<span class="kw">paste0</span>(<span class="st">&#39;value&#39;</span>, list.vars.tomean.name.suffix[[i]]))</a>
<a class="sourceLine" id="cb432-44" title="44">        vars.tomean &lt;-<span class="st"> </span>list.vars.tomean[[i]]</a>
<a class="sourceLine" id="cb432-45" title="45">        var.decomp.cur</a>
<a class="sourceLine" id="cb432-46" title="46">        df.decompose &lt;-<span class="st"> </span>df.decompose <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>((<span class="op">!!</span>var.decomp.cur) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">ff_lr_decompose_valadj</span>(., df.coef, vars.tomean, str.esti.suffix))</a>
<a class="sourceLine" id="cb432-47" title="47">    }</a>
<a class="sourceLine" id="cb432-48" title="48"></a>
<a class="sourceLine" id="cb432-49" title="49">    <span class="co"># Additional Statistics</span></a>
<a class="sourceLine" id="cb432-50" title="50">    df.decompose.var.frac &lt;-<span class="st"> </span>df.decompose <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb432-51" title="51"><span class="st">            </span><span class="kw">select</span>(variable, <span class="kw">contains</span>(<span class="st">&#39;value&#39;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb432-52" title="52"><span class="st">            </span><span class="kw">group_by</span>(variable) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb432-53" title="53"><span class="st">            </span><span class="kw">summarize_all</span>(<span class="kw">funs</span>(<span class="dt">mean =</span> mean, <span class="dt">var =</span> var)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb432-54" title="54"><span class="st">            </span><span class="kw">select</span>(variable, <span class="kw">matches</span>(<span class="st">&#39;value&#39;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(variable, <span class="kw">ends_with</span>(<span class="st">&quot;_var&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb432-55" title="55"><span class="st">            </span><span class="kw">mutate_if</span>(is.numeric, <span class="kw">funs</span>( <span class="dt">frac =</span> (.<span class="op">/</span>value_var))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb432-56" title="56"><span class="st">            </span><span class="kw">mutate_if</span>(is.numeric, round, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb432-57" title="57"></a>
<a class="sourceLine" id="cb432-58" title="58">    <span class="co"># Graph</span></a>
<a class="sourceLine" id="cb432-59" title="59">    g.graph.dist &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb432-60" title="60">    <span class="cf">if</span> (graph) {</a>
<a class="sourceLine" id="cb432-61" title="61">      g.graph.dist &lt;-<span class="st"> </span>df.decompose <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb432-62" title="62"><span class="st">          </span><span class="kw">select</span>(variable, <span class="kw">contains</span>(<span class="st">&#39;value&#39;</span>), <span class="op">-</span>value_mean) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb432-63" title="63"><span class="st">          </span><span class="kw">rename</span>(<span class="dt">outcome =</span> variable) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb432-64" title="64"><span class="st">          </span><span class="kw">gather</span>(variable, value, <span class="op">-</span>outcome) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb432-65" title="65"><span class="st">          </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>value, <span class="dt">color =</span> variable, <span class="dt">fill =</span> variable)) <span class="op">+</span></a>
<a class="sourceLine" id="cb432-66" title="66"><span class="st">              </span><span class="kw">geom_line</span>(<span class="dt">stat =</span> <span class="st">&quot;density&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb432-67" title="67"><span class="st">              </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>outcome, <span class="dt">scales=</span><span class="st">&#39;free&#39;</span>, <span class="dt">nrow=</span>graph.nrow)</a>
<a class="sourceLine" id="cb432-68" title="68">    }</a>
<a class="sourceLine" id="cb432-69" title="69"></a>
<a class="sourceLine" id="cb432-70" title="70">    <span class="co"># Return</span></a>
<a class="sourceLine" id="cb432-71" title="71">    <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">dfmain =</span> df.decompose,</a>
<a class="sourceLine" id="cb432-72" title="72">                <span class="dt">dfsumm =</span> df.decompose.var.frac,</a>
<a class="sourceLine" id="cb432-73" title="73">                <span class="dt">graph =</span> g.graph.dist))</a>
<a class="sourceLine" id="cb432-74" title="74"></a>
<a class="sourceLine" id="cb432-75" title="75">}</a>
<a class="sourceLine" id="cb432-76" title="76"></a>
<a class="sourceLine" id="cb432-77" title="77"><span class="co"># Support Function</span></a>
<a class="sourceLine" id="cb432-78" title="78">ff_lr_decompose_valadj &lt;-<span class="st"> </span><span class="cf">function</span>(df, df.coef, vars.tomean, str.esti.suffix) {</a>
<a class="sourceLine" id="cb432-79" title="79">    new_value &lt;-<span class="st"> </span>(df<span class="op">$</span>value <span class="op">+</span></a>
<a class="sourceLine" id="cb432-80" title="80"><span class="st">                  </span><span class="kw">rowSums</span>((df[<span class="kw">paste0</span>(vars.tomean, <span class="st">&#39;_mean&#39;</span>)] <span class="op">-</span><span class="st"> </span>df[vars.tomean])</a>
<a class="sourceLine" id="cb432-81" title="81">                          <span class="op">*</span>df.coef[df<span class="op">$</span>variable, <span class="kw">paste0</span>(vars.tomean, str.esti.suffix)]))</a>
<a class="sourceLine" id="cb432-82" title="82">    <span class="kw">return</span>(new_value)</a>
<a class="sourceLine" id="cb432-83" title="83">}</a></code></pre></div>
</div>
<div id="prepare-decomposition-data" class="section level4">
<h4><span class="header-section-number">5.2.1.2</span> Prepare Decomposition Data</h4>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb433-1" title="1"><span class="co"># Library</span></a>
<a class="sourceLine" id="cb433-2" title="2"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb433-3" title="3"><span class="kw">library</span>(AER)</a>
<a class="sourceLine" id="cb433-4" title="4"></a>
<a class="sourceLine" id="cb433-5" title="5"><span class="co"># Load Sample Data</span></a>
<a class="sourceLine" id="cb433-6" title="6"><span class="kw">setwd</span>(<span class="st">&#39;C:/Users/fan/R4Econ/_data/&#39;</span>)</a>
<a class="sourceLine" id="cb433-7" title="7">df &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;height_weight.csv&#39;</span>)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   S.country = col_character(),
##   vil.id = col_double(),
##   indi.id = col_double(),
##   sex = col_character(),
##   svymthRound = col_double(),
##   momEdu = col_double(),
##   wealthIdx = col_double(),
##   hgt = col_double(),
##   wgt = col_double(),
##   hgt0 = col_double(),
##   wgt0 = col_double(),
##   prot = col_double(),
##   cal = col_double(),
##   p.A.prot = col_double(),
##   p.A.nProt = col_double()
## )</code></pre>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb435-1" title="1"><span class="co"># Source Dependency</span></a>
<a class="sourceLine" id="cb435-2" title="2"><span class="kw">source</span>(<span class="st">&#39;C:/Users/fan/R4Econ/linreg/ivreg/ivregdfrow.R&#39;</span>)</a>
<a class="sourceLine" id="cb435-3" title="3"></a>
<a class="sourceLine" id="cb435-4" title="4"><span class="co"># Setting</span></a>
<a class="sourceLine" id="cb435-5" title="5"><span class="kw">options</span>(<span class="dt">repr.matrix.max.rows=</span><span class="dv">50</span>, <span class="dt">repr.matrix.max.cols=</span><span class="dv">50</span>)</a></code></pre></div>
<p>Data Cleaning.</p>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb436-1" title="1"><span class="co"># Convert Variable for Sex which is categorical to Numeric</span></a>
<a class="sourceLine" id="cb436-2" title="2">df &lt;-<span class="st"> </span>df</a>
<a class="sourceLine" id="cb436-3" title="3">df<span class="op">$</span>male &lt;-<span class="st"> </span>(<span class="kw">as.numeric</span>(<span class="kw">factor</span>(df<span class="op">$</span>sex)) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb436-4" title="4"><span class="kw">summary</span>(<span class="kw">factor</span>(df<span class="op">$</span>sex))</a></code></pre></div>
<pre><code>## Female   Male 
##  16446  18619</code></pre>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb438-1" title="1"><span class="kw">summary</span>(df<span class="op">$</span>male)</a></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   0.000   0.000   1.000   0.531   1.000   1.000</code></pre>
<p>Parameters.</p>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb440-1" title="1">var.y1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;hgt&#39;</span>)</a>
<a class="sourceLine" id="cb440-2" title="2">var.y2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;wgt&#39;</span>)</a>
<a class="sourceLine" id="cb440-3" title="3">vars.y &lt;-<span class="st"> </span><span class="kw">c</span>(var.y1, var.y2)</a>
<a class="sourceLine" id="cb440-4" title="4">vars.x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;prot&#39;</span>)</a>
<a class="sourceLine" id="cb440-5" title="5">vars.c &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;male&#39;</span>, <span class="st">&#39;wgt0&#39;</span>, <span class="st">&#39;hgt0&#39;</span>, <span class="st">&#39;svymthRound&#39;</span>)</a>
<a class="sourceLine" id="cb440-6" title="6">vars.other.keep &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;S.country&#39;</span>, <span class="st">&#39;vil.id&#39;</span>, <span class="st">&#39;indi.id&#39;</span>, <span class="st">&#39;svymthRound&#39;</span>)</a>
<a class="sourceLine" id="cb440-7" title="7"></a>
<a class="sourceLine" id="cb440-8" title="8"><span class="co"># Decompose sequence</span></a>
<a class="sourceLine" id="cb440-9" title="9">vars.tomean.first &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;male&#39;</span>, <span class="st">&#39;hgt0&#39;</span>)</a>
<a class="sourceLine" id="cb440-10" title="10">var.tomean.first.name.suffix &lt;-<span class="st"> &#39;_A&#39;</span></a>
<a class="sourceLine" id="cb440-11" title="11">vars.tomean.third &lt;-<span class="st"> </span><span class="kw">c</span>(vars.tomean.first, <span class="st">&#39;prot&#39;</span>)</a>
<a class="sourceLine" id="cb440-12" title="12">var.tomean.third.name.suffix &lt;-<span class="st"> &#39;_B&#39;</span></a>
<a class="sourceLine" id="cb440-13" title="13">vars.tomean.fourth &lt;-<span class="st"> </span><span class="kw">c</span>(vars.tomean.third, <span class="st">&#39;svymthRound&#39;</span>)</a>
<a class="sourceLine" id="cb440-14" title="14">var.tomean.fourth.name.suffix &lt;-<span class="st"> &#39;_C&#39;</span></a>
<a class="sourceLine" id="cb440-15" title="15">list.vars.tomean =<span class="st"> </span><span class="kw">list</span>(vars.tomean.first,</a>
<a class="sourceLine" id="cb440-16" title="16">                        vars.tomean.third,</a>
<a class="sourceLine" id="cb440-17" title="17">                        vars.tomean.fourth)</a>
<a class="sourceLine" id="cb440-18" title="18">list.vars.tomean.name.suffix &lt;-<span class="st"> </span><span class="kw">list</span>(var.tomean.first.name.suffix,</a>
<a class="sourceLine" id="cb440-19" title="19">                                     var.tomean.third.name.suffix,</a>
<a class="sourceLine" id="cb440-20" title="20">                                     var.tomean.fourth.name.suffix)</a></code></pre></div>
</div>
<div id="example-guatemala-ols" class="section level4">
<h4><span class="header-section-number">5.2.1.3</span> Example Guatemala OLS</h4>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb441-1" title="1">df.use &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(S.country <span class="op">==</span><span class="st"> &#39;Guatemala&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(svymthRound <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">18</span>, <span class="dv">24</span>))</a>
<a class="sourceLine" id="cb441-2" title="2">vars.z &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb441-3" title="3">list.out &lt;-<span class="st"> </span><span class="kw">ff_lr_decompose</span>(<span class="dt">df=</span>df.use, vars.y, vars.x, vars.c, vars.z, vars.other.keep,</a>
<a class="sourceLine" id="cb441-4" title="4">                            list.vars.tomean, list.vars.tomean.name.suffix,</a>
<a class="sourceLine" id="cb441-5" title="5">                            <span class="dt">graph=</span><span class="ot">TRUE</span>, <span class="dt">graph.nrow=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb441-6" title="6"><span class="kw">options</span>(<span class="dt">repr.matrix.max.rows=</span><span class="dv">10</span>, <span class="dt">repr.matrix.max.cols=</span><span class="dv">50</span>)</a>
<a class="sourceLine" id="cb441-7" title="7">list.out<span class="op">$</span>dfmain</a></code></pre></div>
<pre><code>## # A tibble: 1,382 x 19
##    S.country vil.id indi.id svymthRound  prot  male  wgt0  hgt0 variable value prot_mean male_mean
##    &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1 Guatemala      3    1352          18  13.3     1 2545.  47.4 hgt       70.2      20.6     0.550
##  2 Guatemala      3    1352          24  46.3     1 2545.  47.4 hgt       75.8      20.6     0.550
##  3 Guatemala      3    1354          12   1       1 3634.  51.2 hgt       66.3      20.6     0.550
##  4 Guatemala      3    1354          18   9.8     1 3634.  51.2 hgt       69.2      20.6     0.550
##  5 Guatemala      3    1354          24  15.4     1 3634.  51.2 hgt       75.3      20.6     0.550
##  6 Guatemala      3    1356          12   8.6     1 3912.  51.9 hgt       68.1      20.6     0.550
##  7 Guatemala      3    1356          18  17.8     1 3912.  51.9 hgt       74.1      20.6     0.550
##  8 Guatemala      3    1356          24  30.5     1 3912.  51.9 hgt       77.1      20.6     0.550
##  9 Guatemala      3    1357          12   1       1 3791.  52.6 hgt       71.5      20.6     0.550
## 10 Guatemala      3    1357          18  12.7     1 3791.  52.6 hgt       77.8      20.6     0.550
## # ... with 1,372 more rows, and 7 more variables: wgt0_mean &lt;dbl&gt;, hgt0_mean &lt;dbl&gt;,
## #   svymthRound_mean &lt;dbl&gt;, value_mean &lt;dbl&gt;, value_A &lt;dbl&gt;, value_B &lt;dbl&gt;, value_C &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb443-1" title="1"><span class="kw">options</span>(<span class="dt">repr.plot.width =</span> <span class="dv">10</span>, <span class="dt">repr.plot.height =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb443-2" title="2">list.out<span class="op">$</span>dfsumm</a></code></pre></div>
<pre><code>## # A tibble: 2 x 11
##   variable value_var value_mean_var value_A_var value_B_var value_C_var value_var_frac
##   &lt;chr&gt;        &lt;dbl&gt;          &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;          &lt;dbl&gt;
## 1 hgt           21.9             NA        20.3        18.4        8.40              1
## 2 wgt      2965693.              NA   2863501.    2659434.   2346297.                1
## # ... with 4 more variables: value_mean_var_frac &lt;dbl&gt;, value_A_var_frac &lt;dbl&gt;,
## #   value_B_var_frac &lt;dbl&gt;, value_C_var_frac &lt;dbl&gt;</code></pre>
</div>
<div id="example-guatemala-iv-vil.id" class="section level4">
<h4><span class="header-section-number">5.2.1.4</span> Example Guatemala IV = vil.id</h4>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb445-1" title="1">df.use &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(S.country <span class="op">==</span><span class="st"> &#39;Guatemala&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(svymthRound <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">18</span>, <span class="dv">24</span>))</a>
<a class="sourceLine" id="cb445-2" title="2">vars.z &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;vil.id&#39;</span>)</a>
<a class="sourceLine" id="cb445-3" title="3">list.out &lt;-<span class="st"> </span><span class="kw">ff_lr_decompose</span>(<span class="dt">df=</span>df.use, vars.y, vars.x, vars.c, vars.z, vars.other.keep,</a>
<a class="sourceLine" id="cb445-4" title="4">                            list.vars.tomean, list.vars.tomean.name.suffix,</a>
<a class="sourceLine" id="cb445-5" title="5">                            <span class="dt">graph=</span><span class="ot">TRUE</span>, <span class="dt">graph.nrow=</span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped</code></pre>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb447-1" title="1">list.out<span class="op">$</span>dfsumm</a></code></pre></div>
<pre><code>## # A tibble: 2 x 11
##   variable value_var value_mean_var value_A_var value_B_var value_C_var value_var_frac
##   &lt;chr&gt;        &lt;dbl&gt;          &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;          &lt;dbl&gt;
## 1 hgt           21.9             NA        20.2        16.3        10.0              1
## 2 wgt      2965693.              NA   2876683.    2676220.    2583301.               1
## # ... with 4 more variables: value_mean_var_frac &lt;dbl&gt;, value_A_var_frac &lt;dbl&gt;,
## #   value_B_var_frac &lt;dbl&gt;, value_C_var_frac &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb449-1" title="1"><span class="kw">options</span>(<span class="dt">repr.plot.width =</span> <span class="dv">10</span>, <span class="dt">repr.plot.height =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb449-2" title="2">list.out<span class="op">$</span>graph</a></code></pre></div>
<p><img src="Panel-Data-and-Optimization-with-R_files/figure-html/unnamed-chunk-161-1.png" width="672" /></p>
</div>
<div id="example-cebu-ols" class="section level4">
<h4><span class="header-section-number">5.2.1.5</span> Example Cebu OLS</h4>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb450-1" title="1">df.use &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(S.country <span class="op">==</span><span class="st"> &#39;Cebu&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(svymthRound <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">18</span>, <span class="dv">24</span>))</a>
<a class="sourceLine" id="cb450-2" title="2">vars.z &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb450-3" title="3">list.out &lt;-<span class="st"> </span><span class="kw">ff_lr_decompose</span>(<span class="dt">df=</span>df.use, vars.y, vars.x, vars.c, vars.z, vars.other.keep,</a>
<a class="sourceLine" id="cb450-4" title="4">                            list.vars.tomean, list.vars.tomean.name.suffix,</a>
<a class="sourceLine" id="cb450-5" title="5">                            <span class="dt">graph=</span><span class="ot">TRUE</span>, <span class="dt">graph.nrow=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb450-6" title="6"><span class="kw">options</span>(<span class="dt">repr.matrix.max.rows=</span><span class="dv">10</span>, <span class="dt">repr.matrix.max.cols=</span><span class="dv">50</span>)</a>
<a class="sourceLine" id="cb450-7" title="7">list.out<span class="op">$</span>dfmain</a></code></pre></div>
<pre><code>## # A tibble: 7,262 x 19
##    S.country vil.id indi.id svymthRound  prot  male  wgt0  hgt0 variable value prot_mean male_mean
##    &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1 Cebu           1       1          12  11.3     1 2044.  44.2 hgt       70.8      17.0     0.526
##  2 Cebu           1       2          12   5.9     0 2840.  49.7 hgt       72.2      17.0     0.526
##  3 Cebu           1       2          18   0.5     0 2840.  49.7 hgt       76.5      17.0     0.526
##  4 Cebu           1       2          24  14.1     0 2840.  49.7 hgt       79.2      17.0     0.526
##  5 Cebu           1       3          12  21.4     0 3446.  51.7 hgt       68        17.0     0.526
##  6 Cebu           1       3          18  23.6     0 3446.  51.7 hgt       71.6      17.0     0.526
##  7 Cebu           1       3          24  20.6     0 3446.  51.7 hgt       76.7      17.0     0.526
##  8 Cebu           1       4          12   0.7     0 3091.  50.2 hgt       69.1      17.0     0.526
##  9 Cebu           1       4          18   7.2     0 3091.  50.2 hgt       74.3      17.0     0.526
## 10 Cebu           1       4          24  10.3     0 3091.  50.2 hgt       78.1      17.0     0.526
## # ... with 7,252 more rows, and 7 more variables: wgt0_mean &lt;dbl&gt;, hgt0_mean &lt;dbl&gt;,
## #   svymthRound_mean &lt;dbl&gt;, value_mean &lt;dbl&gt;, value_A &lt;dbl&gt;, value_B &lt;dbl&gt;, value_C &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb452-1" title="1"><span class="kw">options</span>(<span class="dt">repr.plot.width =</span> <span class="dv">10</span>, <span class="dt">repr.plot.height =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb452-2" title="2">list.out<span class="op">$</span>dfsumm</a></code></pre></div>
<pre><code>## # A tibble: 2 x 11
##   variable value_var value_mean_var value_A_var value_B_var value_C_var value_var_frac
##   &lt;chr&gt;        &lt;dbl&gt;          &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;          &lt;dbl&gt;
## 1 hgt           24.4             NA        22.6        21.3        10.0              1
## 2 wgt      3337461.              NA   3218987.    3039514.    2558514.               1
## # ... with 4 more variables: value_mean_var_frac &lt;dbl&gt;, value_A_var_frac &lt;dbl&gt;,
## #   value_B_var_frac &lt;dbl&gt;, value_C_var_frac &lt;dbl&gt;</code></pre>
</div>
<div id="example-cebu-iv" class="section level4">
<h4><span class="header-section-number">5.2.1.6</span> Example Cebu IV</h4>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb454-1" title="1">df.use &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(S.country <span class="op">==</span><span class="st"> &#39;Cebu&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(svymthRound <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">18</span>, <span class="dv">24</span>))</a>
<a class="sourceLine" id="cb454-2" title="2">vars.z &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;wealthIdx&#39;</span>)</a>
<a class="sourceLine" id="cb454-3" title="3">list.out &lt;-<span class="st"> </span><span class="kw">ff_lr_decompose</span>(<span class="dt">df=</span>df.use, vars.y, vars.x, vars.c, vars.z, vars.other.keep,</a>
<a class="sourceLine" id="cb454-4" title="4">                            list.vars.tomean, list.vars.tomean.name.suffix,</a>
<a class="sourceLine" id="cb454-5" title="5">                            <span class="dt">graph=</span><span class="ot">TRUE</span>, <span class="dt">graph.nrow=</span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped</code></pre>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb456-1" title="1">list.out<span class="op">$</span>dfsumm</a></code></pre></div>
<pre><code>## # A tibble: 2 x 11
##   variable value_var value_mean_var value_A_var value_B_var value_C_var value_var_frac
##   &lt;chr&gt;        &lt;dbl&gt;          &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;          &lt;dbl&gt;
## 1 hgt           24.4             NA        22.6        22.2        14.4              1
## 2 wgt      3337461.              NA   3237415.    3385815.    3158659.               1
## # ... with 4 more variables: value_mean_var_frac &lt;dbl&gt;, value_A_var_frac &lt;dbl&gt;,
## #   value_B_var_frac &lt;dbl&gt;, value_C_var_frac &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb458-1" title="1"><span class="kw">options</span>(<span class="dt">repr.plot.width =</span> <span class="dv">10</span>, <span class="dt">repr.plot.height =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb458-2" title="2">list.out<span class="op">$</span>graph</a></code></pre></div>
<p><img src="Panel-Data-and-Optimization-with-R_files/figure-html/unnamed-chunk-163-1.png" width="672" /></p>
</div>
<div id="examples-line-by-line-1" class="section level4">
<h4><span class="header-section-number">5.2.1.7</span> Examples Line by Line</h4>
<p>The examples are just to test the code with different types of variables.</p>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb459-1" title="1">df.use &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(S.country <span class="op">==</span><span class="st"> &#39;Guatemala&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(svymthRound <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">18</span>, <span class="dv">24</span>))</a>
<a class="sourceLine" id="cb459-2" title="2"><span class="kw">dim</span>(df.use)</a></code></pre></div>
<pre><code>## [1] 2022   16</code></pre>
<p>Setting Up Parameters.</p>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb461-1" title="1"><span class="co"># Define Left Hand Side Variables</span></a>
<a class="sourceLine" id="cb461-2" title="2">var.y1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;hgt&#39;</span>)</a>
<a class="sourceLine" id="cb461-3" title="3">var.y2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;wgt&#39;</span>)</a>
<a class="sourceLine" id="cb461-4" title="4">vars.y &lt;-<span class="st"> </span><span class="kw">c</span>(var.y1, var.y2)</a>
<a class="sourceLine" id="cb461-5" title="5"><span class="co"># Define Right Hand Side Variables</span></a>
<a class="sourceLine" id="cb461-6" title="6">vars.x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;prot&#39;</span>)</a>
<a class="sourceLine" id="cb461-7" title="7">vars.c &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;male&#39;</span>, <span class="st">&#39;wgt0&#39;</span>, <span class="st">&#39;hgt0&#39;</span>, <span class="st">&#39;svymthRound&#39;</span>)</a>
<a class="sourceLine" id="cb461-8" title="8"><span class="co"># vars.z &lt;- c(&#39;p.A.prot&#39;)</span></a>
<a class="sourceLine" id="cb461-9" title="9">vars.z &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;vil.id&#39;</span>)</a>
<a class="sourceLine" id="cb461-10" title="10"><span class="co"># vars.z &lt;- NULL</span></a>
<a class="sourceLine" id="cb461-11" title="11">vars.xc &lt;-<span class="st"> </span><span class="kw">c</span>(vars.x, vars.c)</a>
<a class="sourceLine" id="cb461-12" title="12"></a>
<a class="sourceLine" id="cb461-13" title="13"><span class="co"># Other variables to keep</span></a>
<a class="sourceLine" id="cb461-14" title="14">vars.other.keep &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;S.country&#39;</span>, <span class="st">&#39;vil.id&#39;</span>, <span class="st">&#39;indi.id&#39;</span>, <span class="st">&#39;svymthRound&#39;</span>)</a>
<a class="sourceLine" id="cb461-15" title="15"></a>
<a class="sourceLine" id="cb461-16" title="16"><span class="co"># Decompose sequence</span></a>
<a class="sourceLine" id="cb461-17" title="17">vars.tomean.first &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;male&#39;</span>, <span class="st">&#39;hgt0&#39;</span>)</a>
<a class="sourceLine" id="cb461-18" title="18">var.tomean.first.name.suffix &lt;-<span class="st"> &#39;_mh02m&#39;</span></a>
<a class="sourceLine" id="cb461-19" title="19">vars.tomean.second &lt;-<span class="st"> </span><span class="kw">c</span>(vars.tomean.first, <span class="st">&#39;hgt0&#39;</span>, <span class="st">&#39;wgt0&#39;</span>)</a>
<a class="sourceLine" id="cb461-20" title="20">var.tomean.second.name.suffix &lt;-<span class="st"> &#39;_mh0me2m&#39;</span></a>
<a class="sourceLine" id="cb461-21" title="21">vars.tomean.third &lt;-<span class="st"> </span><span class="kw">c</span>(vars.tomean.second, <span class="st">&#39;prot&#39;</span>)</a>
<a class="sourceLine" id="cb461-22" title="22">var.tomean.third.name.suffix &lt;-<span class="st"> &#39;_mh0mep2m&#39;</span></a>
<a class="sourceLine" id="cb461-23" title="23">vars.tomean.fourth &lt;-<span class="st"> </span><span class="kw">c</span>(vars.tomean.third, <span class="st">&#39;svymthRound&#39;</span>)</a>
<a class="sourceLine" id="cb461-24" title="24">var.tomean.fourth.name.suffix &lt;-<span class="st"> &#39;_mh0mepm2m&#39;</span></a>
<a class="sourceLine" id="cb461-25" title="25">list.vars.tomean =<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb461-26" title="26"><span class="co">#                         vars.tomean.first,</span></a>
<a class="sourceLine" id="cb461-27" title="27">                        vars.tomean.second,</a>
<a class="sourceLine" id="cb461-28" title="28">                        vars.tomean.third,</a>
<a class="sourceLine" id="cb461-29" title="29">                        vars.tomean.fourth</a>
<a class="sourceLine" id="cb461-30" title="30">                        )</a>
<a class="sourceLine" id="cb461-31" title="31">list.vars.tomean.name.suffix &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb461-32" title="32"><span class="co">#                                     var.tomean.first.name.suffix,</span></a>
<a class="sourceLine" id="cb461-33" title="33">                                     var.tomean.second.name.suffix,</a>
<a class="sourceLine" id="cb461-34" title="34">                                     var.tomean.third.name.suffix,</a>
<a class="sourceLine" id="cb461-35" title="35">                                     var.tomean.fourth.name.suffix</a>
<a class="sourceLine" id="cb461-36" title="36">                                    )</a></code></pre></div>
<div id="obtain-regression-coefficients-from-somewhere" class="section level5">
<h5><span class="header-section-number">5.2.1.7.1</span> Obtain Regression Coefficients from somewhere</h5>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb462-1" title="1"><span class="co"># Regressions</span></a>
<a class="sourceLine" id="cb462-2" title="2"><span class="co"># regf.iv from C:\Users\fan\R4Econ\linreg\ivreg\ivregdfrow.R</span></a>
<a class="sourceLine" id="cb462-3" title="3">df.reg.out &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(<span class="kw">bind_rows</span>(<span class="kw">lapply</span>(vars.y, regf.iv,</a>
<a class="sourceLine" id="cb462-4" title="4">                                         <span class="dt">vars.x=</span>vars.x, <span class="dt">vars.c=</span>vars.c, <span class="dt">vars.z=</span>vars.z, <span class="dt">df=</span>df)))</a></code></pre></div>
<pre><code>## Warning: attributes are not identical across measure variables;
## they will be dropped

## Warning: attributes are not identical across measure variables;
## they will be dropped</code></pre>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb464-1" title="1"><span class="co"># Regressions</span></a>
<a class="sourceLine" id="cb464-2" title="2"><span class="co"># reg1 &lt;- regf.iv(var.y = var.y1, vars.x, vars.c, vars.z, df.use)</span></a>
<a class="sourceLine" id="cb464-3" title="3"><span class="co"># reg2 &lt;- regf.iv(var.y = var.y2, vars.x, vars.c, vars.z, df.use)</span></a>
<a class="sourceLine" id="cb464-4" title="4"><span class="co"># df.reg.out &lt;- as_tibble(bind_rows(reg1, reg2))</span></a></code></pre></div>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb465-1" title="1"><span class="kw">options</span>(<span class="dt">repr.matrix.max.rows=</span><span class="dv">50</span>, <span class="dt">repr.matrix.max.cols=</span><span class="dv">50</span>)</a>
<a class="sourceLine" id="cb465-2" title="2">df.reg.out</a></code></pre></div>
<pre><code>## # A tibble: 2 x 37
##   X.Intercept._Es~ X.Intercept._Pr~ X.Intercept._St~ X.Intercept._zv~ hgt0_Estimate hgt0_Pr...z..
##   &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;         &lt;chr&gt;        
## 1 22.2547168993562 8.9088080511633~ 1.21637209166939 18.2959778934199 0.6834853337~ 4.5575874740~
## 2 -1101.090058068~ 0.0051062029326~ 393.210441213089 -2.800256408938~ 75.486789661~ 3.0043362381~
## # ... with 31 more variables: hgt0_Std.Error &lt;chr&gt;, hgt0_zvalue &lt;chr&gt;, male_Estimate &lt;chr&gt;,
## #   male_Pr...z.. &lt;chr&gt;, male_Std.Error &lt;chr&gt;, male_zvalue &lt;chr&gt;, prot_Estimate &lt;chr&gt;,
## #   prot_Pr...z.. &lt;chr&gt;, prot_Std.Error &lt;chr&gt;, prot_zvalue &lt;chr&gt;, Sargan_df1 &lt;chr&gt;,
## #   svymthRound_Estimate &lt;chr&gt;, svymthRound_Pr...z.. &lt;chr&gt;, svymthRound_Std.Error &lt;chr&gt;,
## #   svymthRound_zvalue &lt;chr&gt;, vars_var.y &lt;chr&gt;, vars_vars.c &lt;chr&gt;, vars_vars.x &lt;chr&gt;,
## #   vars_vars.z &lt;chr&gt;, Weakinstruments_df1 &lt;chr&gt;, Weakinstruments_df2 &lt;chr&gt;,
## #   Weakinstruments_p.value &lt;chr&gt;, Weakinstruments_statistic &lt;chr&gt;, wgt0_Estimate &lt;chr&gt;,
## #   wgt0_Pr...z.. &lt;chr&gt;, wgt0_Std.Error &lt;chr&gt;, wgt0_zvalue &lt;chr&gt;, Wu.Hausman_df1 &lt;chr&gt;,
## #   Wu.Hausman_df2 &lt;chr&gt;, Wu.Hausman_p.value &lt;chr&gt;, Wu.Hausman_statistic &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb467-1" title="1"><span class="co"># Select Variables</span></a>
<a class="sourceLine" id="cb467-2" title="2">str.esti.suffix &lt;-<span class="st"> &#39;_Estimate&#39;</span></a>
<a class="sourceLine" id="cb467-3" title="3">arr.esti.name &lt;-<span class="st"> </span><span class="kw">paste0</span>(vars.xc, str.esti.suffix)</a>
<a class="sourceLine" id="cb467-4" title="4">str.outcome.name &lt;-<span class="st"> &#39;vars_var.y&#39;</span></a>
<a class="sourceLine" id="cb467-5" title="5">arr.columns2select &lt;-<span class="st"> </span><span class="kw">c</span>(arr.esti.name, str.outcome.name)</a>
<a class="sourceLine" id="cb467-6" title="6">arr.columns2select</a></code></pre></div>
<pre><code>## [1] &quot;prot_Estimate&quot;        &quot;male_Estimate&quot;        &quot;wgt0_Estimate&quot;        &quot;hgt0_Estimate&quot;       
## [5] &quot;svymthRound_Estimate&quot; &quot;vars_var.y&quot;</code></pre>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb469-1" title="1"><span class="co"># Generate dataframe for coefficients</span></a>
<a class="sourceLine" id="cb469-2" title="2">df.coef &lt;-<span class="st"> </span>df.reg.out[,<span class="kw">c</span>(arr.columns2select)] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(arr.esti.name), as.numeric) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">column_to_rownames</span>(str.outcome.name)</a>
<a class="sourceLine" id="cb469-3" title="3">df.coef</a></code></pre></div>
<pre><code>##     prot_Estimate male_Estimate wgt0_Estimate hgt0_Estimate svymthRound_Estimate
## hgt    -0.2714772      1.244735  0.0004430418     0.6834853             1.133919
## wgt   -59.0727542    489.852902  0.7696158110    75.4867897           250.778883</code></pre>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb471-1" title="1"><span class="kw">str</span>(df.coef)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    2 obs. of  5 variables:
##  $ prot_Estimate       : num  -0.271 -59.073
##  $ male_Estimate       : num  1.24 489.85
##  $ wgt0_Estimate       : num  0.000443 0.769616
##  $ hgt0_Estimate       : num  0.683 75.487
##  $ svymthRound_Estimate: num  1.13 250.78</code></pre>
</div>
<div id="decomposition-step-1" class="section level5">
<h5><span class="header-section-number">5.2.1.7.2</span> Decomposition Step 1</h5>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb473-1" title="1"><span class="co"># Decomposition Step 1: gather</span></a>
<a class="sourceLine" id="cb473-2" title="2">df.decompose_step1 &lt;-<span class="st"> </span>df.use <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb473-3" title="3"><span class="st">                        </span><span class="kw">filter</span>(svymthRound <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">18</span>, <span class="dv">24</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb473-4" title="4"><span class="st">                        </span><span class="kw">select</span>(<span class="kw">one_of</span>(<span class="kw">c</span>(vars.other.keep, vars.xc, vars.y))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb473-5" title="5"><span class="st">                        </span><span class="kw">drop_na</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb473-6" title="6"><span class="st">                        </span><span class="kw">gather</span>(variable, value, <span class="op">-</span><span class="kw">one_of</span>(<span class="kw">c</span>(vars.other.keep, vars.xc)))</a>
<a class="sourceLine" id="cb473-7" title="7"><span class="kw">options</span>(<span class="dt">repr.matrix.max.rows=</span><span class="dv">20</span>, <span class="dt">repr.matrix.max.cols=</span><span class="dv">20</span>)</a>
<a class="sourceLine" id="cb473-8" title="8"><span class="kw">dim</span>(df.decompose_step1)</a></code></pre></div>
<pre><code>## [1] 1382   10</code></pre>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb475-1" title="1">df.decompose_step1</a></code></pre></div>
<pre><code>## # A tibble: 1,382 x 10
##    S.country vil.id indi.id svymthRound  prot  male  wgt0  hgt0 variable value
##    &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;
##  1 Guatemala      3    1352          18  13.3     1 2545.  47.4 hgt       70.2
##  2 Guatemala      3    1352          24  46.3     1 2545.  47.4 hgt       75.8
##  3 Guatemala      3    1354          12   1       1 3634.  51.2 hgt       66.3
##  4 Guatemala      3    1354          18   9.8     1 3634.  51.2 hgt       69.2
##  5 Guatemala      3    1354          24  15.4     1 3634.  51.2 hgt       75.3
##  6 Guatemala      3    1356          12   8.6     1 3912.  51.9 hgt       68.1
##  7 Guatemala      3    1356          18  17.8     1 3912.  51.9 hgt       74.1
##  8 Guatemala      3    1356          24  30.5     1 3912.  51.9 hgt       77.1
##  9 Guatemala      3    1357          12   1       1 3791.  52.6 hgt       71.5
## 10 Guatemala      3    1357          18  12.7     1 3791.  52.6 hgt       77.8
## # ... with 1,372 more rows</code></pre>
</div>
<div id="decomposition-step-2" class="section level5">
<h5><span class="header-section-number">5.2.1.7.3</span> Decomposition Step 2</h5>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb477-1" title="1"><span class="co"># Decomposition Step 2: mutate_at(vars, funs(mean = mean(.)))</span></a>
<a class="sourceLine" id="cb477-2" title="2"><span class="co"># the xc averaging could have taken place earlier, no difference in mean across variables</span></a>
<a class="sourceLine" id="cb477-3" title="3">df.decompose_step2 &lt;-<span class="st"> </span>df.decompose_step1 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb477-4" title="4"><span class="st">                        </span><span class="kw">group_by</span>(variable) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb477-5" title="5"><span class="st">                        </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(<span class="kw">c</span>(vars.xc, <span class="st">&#39;value&#39;</span>)), <span class="kw">funs</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(.))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb477-6" title="6"><span class="st">                        </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb477-7" title="7"></a>
<a class="sourceLine" id="cb477-8" title="8"><span class="kw">options</span>(<span class="dt">repr.matrix.max.rows=</span><span class="dv">20</span>, <span class="dt">repr.matrix.max.cols=</span><span class="dv">20</span>)</a>
<a class="sourceLine" id="cb477-9" title="9"><span class="kw">dim</span>(df.decompose_step2)</a></code></pre></div>
<pre><code>## [1] 1382   16</code></pre>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb479-1" title="1">df.decompose_step2</a></code></pre></div>
<pre><code>## # A tibble: 1,382 x 16
##    S.country vil.id indi.id svymthRound  prot  male  wgt0  hgt0 variable value prot_mean male_mean
##    &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1 Guatemala      3    1352          18  13.3     1 2545.  47.4 hgt       70.2      20.6     0.550
##  2 Guatemala      3    1352          24  46.3     1 2545.  47.4 hgt       75.8      20.6     0.550
##  3 Guatemala      3    1354          12   1       1 3634.  51.2 hgt       66.3      20.6     0.550
##  4 Guatemala      3    1354          18   9.8     1 3634.  51.2 hgt       69.2      20.6     0.550
##  5 Guatemala      3    1354          24  15.4     1 3634.  51.2 hgt       75.3      20.6     0.550
##  6 Guatemala      3    1356          12   8.6     1 3912.  51.9 hgt       68.1      20.6     0.550
##  7 Guatemala      3    1356          18  17.8     1 3912.  51.9 hgt       74.1      20.6     0.550
##  8 Guatemala      3    1356          24  30.5     1 3912.  51.9 hgt       77.1      20.6     0.550
##  9 Guatemala      3    1357          12   1       1 3791.  52.6 hgt       71.5      20.6     0.550
## 10 Guatemala      3    1357          18  12.7     1 3791.  52.6 hgt       77.8      20.6     0.550
## # ... with 1,372 more rows, and 4 more variables: wgt0_mean &lt;dbl&gt;, hgt0_mean &lt;dbl&gt;,
## #   svymthRound_mean &lt;dbl&gt;, value_mean &lt;dbl&gt;</code></pre>
</div>
<div id="decomposition-step-3-non-loop" class="section level5">
<h5><span class="header-section-number">5.2.1.7.4</span> Decomposition Step 3 Non-Loop</h5>
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb481-1" title="1">ff_lr_decompose_valadj &lt;-<span class="st"> </span><span class="cf">function</span>(df, df.coef, vars.tomean, str.esti.suffix) {</a>
<a class="sourceLine" id="cb481-2" title="2">    new_value &lt;-<span class="st"> </span>(df<span class="op">$</span>value <span class="op">+</span></a>
<a class="sourceLine" id="cb481-3" title="3"><span class="st">                  </span><span class="kw">rowSums</span>((df[<span class="kw">paste0</span>(vars.tomean, <span class="st">&#39;_mean&#39;</span>)] <span class="op">-</span><span class="st"> </span>df[vars.tomean])</a>
<a class="sourceLine" id="cb481-4" title="4">                          <span class="op">*</span>df.coef[df<span class="op">$</span>variable, <span class="kw">paste0</span>(vars.tomean, str.esti.suffix)]))</a>
<a class="sourceLine" id="cb481-5" title="5">    <span class="kw">return</span>(new_value)</a>
<a class="sourceLine" id="cb481-6" title="6">}</a>
<a class="sourceLine" id="cb481-7" title="7"></a>
<a class="sourceLine" id="cb481-8" title="8"><span class="co"># # Decomposition Step 3: mutate_at(vars, funs(mean = mean(.)))</span></a>
<a class="sourceLine" id="cb481-9" title="9"><span class="co"># var.decomp.one &lt;- (paste0(&#39;value&#39;, list.vars.tomean.name.suffix[[1]]))</span></a>
<a class="sourceLine" id="cb481-10" title="10"><span class="co"># var.decomp.two &lt;- (paste0(&#39;value&#39;, list.vars.tomean.name.suffix[[2]]))</span></a>
<a class="sourceLine" id="cb481-11" title="11"><span class="co"># var.decomp.thr &lt;- (paste0(&#39;value&#39;, list.vars.tomean.name.suffix[[3]]))</span></a>
<a class="sourceLine" id="cb481-12" title="12"><span class="co"># df.decompose_step3 &lt;- df.decompose_step2 %&gt;%</span></a>
<a class="sourceLine" id="cb481-13" title="13"><span class="co">#                         mutate((!!var.decomp.one) := f_decompose_here(., df.coef, list.vars.tomean[[1]], str.esti.suffix),</span></a>
<a class="sourceLine" id="cb481-14" title="14"><span class="co">#                                (!!var.decomp.two) := f_decompose_here(., df.coef, list.vars.tomean[[2]], str.esti.suffix),</span></a>
<a class="sourceLine" id="cb481-15" title="15"><span class="co">#                                (!!var.decomp.thr) := f_decompose_here(., df.coef, list.vars.tomean[[3]], str.esti.suffix))</span></a>
<a class="sourceLine" id="cb481-16" title="16"></a>
<a class="sourceLine" id="cb481-17" title="17"><span class="co"># options(repr.matrix.max.rows=10, repr.matrix.max.cols=20)</span></a>
<a class="sourceLine" id="cb481-18" title="18"><span class="co"># dim(df.decompose_step3)</span></a>
<a class="sourceLine" id="cb481-19" title="19"><span class="co"># df.decompose_step3</span></a></code></pre></div>
</div>
<div id="decomposition-step-3-with-loop" class="section level5">
<h5><span class="header-section-number">5.2.1.7.5</span> Decomposition Step 3 With Loop</h5>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb482-1" title="1">df.decompose_step3 &lt;-<span class="st"> </span>df.decompose_step2</a>
<a class="sourceLine" id="cb482-2" title="2"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(list.vars.tomean)) {</a>
<a class="sourceLine" id="cb482-3" title="3">    var.decomp.cur &lt;-<span class="st"> </span>(<span class="kw">paste0</span>(<span class="st">&#39;value&#39;</span>, list.vars.tomean.name.suffix[[i]]))</a>
<a class="sourceLine" id="cb482-4" title="4">    vars.tomean &lt;-<span class="st"> </span>list.vars.tomean[[i]]</a>
<a class="sourceLine" id="cb482-5" title="5">    var.decomp.cur</a>
<a class="sourceLine" id="cb482-6" title="6">    df.decompose_step3 &lt;-<span class="st"> </span>df.decompose_step3 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>((<span class="op">!!</span>var.decomp.cur) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">ff_lr_decompose_valadj</span>(., df.coef, vars.tomean, str.esti.suffix))</a>
<a class="sourceLine" id="cb482-7" title="7"></a>
<a class="sourceLine" id="cb482-8" title="8">}</a>
<a class="sourceLine" id="cb482-9" title="9"><span class="kw">options</span>(<span class="dt">repr.matrix.max.rows=</span><span class="dv">10</span>, <span class="dt">repr.matrix.max.cols=</span><span class="dv">20</span>)</a>
<a class="sourceLine" id="cb482-10" title="10"><span class="kw">dim</span>(df.decompose_step3)</a></code></pre></div>
<pre><code>## [1] 1382   19</code></pre>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb484-1" title="1">df.decompose_step3</a></code></pre></div>
<pre><code>## # A tibble: 1,382 x 19
##    S.country vil.id indi.id svymthRound  prot  male  wgt0  hgt0 variable value prot_mean male_mean
##    &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1 Guatemala      3    1352          18  13.3     1 2545.  47.4 hgt       70.2      20.6     0.550
##  2 Guatemala      3    1352          24  46.3     1 2545.  47.4 hgt       75.8      20.6     0.550
##  3 Guatemala      3    1354          12   1       1 3634.  51.2 hgt       66.3      20.6     0.550
##  4 Guatemala      3    1354          18   9.8     1 3634.  51.2 hgt       69.2      20.6     0.550
##  5 Guatemala      3    1354          24  15.4     1 3634.  51.2 hgt       75.3      20.6     0.550
##  6 Guatemala      3    1356          12   8.6     1 3912.  51.9 hgt       68.1      20.6     0.550
##  7 Guatemala      3    1356          18  17.8     1 3912.  51.9 hgt       74.1      20.6     0.550
##  8 Guatemala      3    1356          24  30.5     1 3912.  51.9 hgt       77.1      20.6     0.550
##  9 Guatemala      3    1357          12   1       1 3791.  52.6 hgt       71.5      20.6     0.550
## 10 Guatemala      3    1357          18  12.7     1 3791.  52.6 hgt       77.8      20.6     0.550
## # ... with 1,372 more rows, and 7 more variables: wgt0_mean &lt;dbl&gt;, hgt0_mean &lt;dbl&gt;,
## #   svymthRound_mean &lt;dbl&gt;, value_mean &lt;dbl&gt;, value_mh0me2m &lt;dbl&gt;, value_mh0mep2m &lt;dbl&gt;,
## #   value_mh0mepm2m &lt;dbl&gt;</code></pre>
</div>
<div id="decomposition-step-4-variance" class="section level5">
<h5><span class="header-section-number">5.2.1.7.6</span> Decomposition Step 4 Variance</h5>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb486-1" title="1">df.decompose_step3 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb486-2" title="2"><span class="st">        </span><span class="kw">select</span>(variable, <span class="kw">contains</span>(<span class="st">&#39;value&#39;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb486-3" title="3"><span class="st">        </span><span class="kw">group_by</span>(variable) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb486-4" title="4"><span class="st">        </span><span class="kw">summarize_all</span>(<span class="kw">funs</span>(<span class="dt">mean =</span> mean, <span class="dt">var =</span> var)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb486-5" title="5"><span class="st">        </span><span class="kw">select</span>(<span class="kw">matches</span>(<span class="st">&#39;value&#39;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">ends_with</span>(<span class="st">&quot;_var&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb486-6" title="6"><span class="st">        </span><span class="kw">mutate_if</span>(is.numeric, <span class="kw">funs</span>( <span class="dt">frac =</span> (.<span class="op">/</span>value_var))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb486-7" title="7"><span class="st">        </span><span class="kw">mutate_if</span>(is.numeric, round, <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 10
##   value_var value_mean_var value_mh0me2m_v~ value_mh0mep2m_~ value_mh0mepm2m~ value_var_frac
##       &lt;dbl&gt;          &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;          &lt;dbl&gt;
## 1      21.9             NA             25.4             49.0             23.1              1
## 2 2965693.              NA        2949188.         4192770.         3147507.               1
## # ... with 4 more variables: value_mean_var_frac &lt;dbl&gt;, value_mh0me2m_var_frac &lt;dbl&gt;,
## #   value_mh0mep2m_var_frac &lt;dbl&gt;, value_mh0mepm2m_var_frac &lt;dbl&gt;</code></pre>
</div>
<div id="graphical-results" class="section level5">
<h5><span class="header-section-number">5.2.1.7.7</span> Graphical Results</h5>
<p>Graphically, difficult to pick up exact differences in variance, a 50 percent reduction in variance visually does not look like 50 percent. Intuitively, we are kind of seeing standard deviation, not variance on the graph if we think abou the x-scale.</p>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb488-1" title="1">df.decompose_step3 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb488-2" title="2"><span class="st">    </span><span class="kw">select</span>(variable, <span class="kw">contains</span>(<span class="st">&#39;value&#39;</span>), <span class="op">-</span>value_mean)</a></code></pre></div>
<pre><code>## # A tibble: 1,382 x 5
##    variable value value_mh0me2m value_mh0mep2m value_mh0mepm2m
##    &lt;chr&gt;    &lt;dbl&gt;         &lt;dbl&gt;          &lt;dbl&gt;           &lt;dbl&gt;
##  1 hgt       70.2          73.2           71.2            71.7
##  2 hgt       75.8          78.8           85.8            79.4
##  3 hgt       66.3          63.6           58.3            65.6
##  4 hgt       69.2          66.5           63.6            64.1
##  5 hgt       75.3          72.6           71.2            64.9
##  6 hgt       68.1          64.3           61.1            68.4
##  7 hgt       74.1          70.3           69.6            70.0
##  8 hgt       77.1          73.3           76.0            69.7
##  9 hgt       71.5          66.8           61.5            68.8
## 10 hgt       77.8          73.1           71.0            71.5
## # ... with 1,372 more rows</code></pre>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb490-1" title="1"><span class="kw">options</span>(<span class="dt">repr.plot.width =</span> <span class="dv">10</span>, <span class="dt">repr.plot.height =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb490-2" title="2">df.decompose_step3 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb490-3" title="3"><span class="st">    </span><span class="kw">select</span>(variable, <span class="kw">contains</span>(<span class="st">&#39;value&#39;</span>), <span class="op">-</span>value_mean) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb490-4" title="4"><span class="st">    </span><span class="kw">rename</span>(<span class="dt">outcome =</span> variable) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb490-5" title="5"><span class="st">    </span><span class="kw">gather</span>(variable, value, <span class="op">-</span>outcome) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb490-6" title="6"><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>value, <span class="dt">color =</span> variable, <span class="dt">fill =</span> variable)) <span class="op">+</span></a>
<a class="sourceLine" id="cb490-7" title="7"><span class="st">        </span><span class="kw">geom_line</span>(<span class="dt">stat =</span> <span class="st">&quot;density&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb490-8" title="8"><span class="st">        </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>outcome, <span class="dt">scales=</span><span class="st">&#39;free&#39;</span>, <span class="dt">nrow=</span><span class="dv">2</span>)</a></code></pre></div>
<p><img src="Panel-Data-and-Optimization-with-R_files/figure-html/unnamed-chunk-176-1.png" width="672" /></p>
</div>
</div>
<div id="additional-decomposition-testings" class="section level4">
<h4><span class="header-section-number">5.2.1.8</span> Additional Decomposition Testings</h4>
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb491-1" title="1"><span class="kw">head</span>(df.decompose_step2[vars.tomean.first],<span class="dv">3</span>)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##    male  hgt0
##   &lt;dbl&gt; &lt;dbl&gt;
## 1     1  47.4
## 2     1  47.4
## 3     1  51.2</code></pre>
<div class="sourceCode" id="cb493"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb493-1" title="1"><span class="kw">head</span>(df.decompose_step2[<span class="kw">paste0</span>(vars.tomean.first, <span class="st">&#39;_mean&#39;</span>)], <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   male_mean hgt0_mean
##       &lt;dbl&gt;     &lt;dbl&gt;
## 1     0.550      49.8
## 2     0.550      49.8
## 3     0.550      49.8</code></pre>
<div class="sourceCode" id="cb495"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb495-1" title="1"><span class="kw">head</span>(df.coef[df.decompose_step2<span class="op">$</span>variable, <span class="kw">paste0</span>(vars.tomean.first, str.esti.suffix)], <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##       male_Estimate hgt0_Estimate
## hgt        1.244735     0.6834853
## hgt.1      1.244735     0.6834853
## hgt.2      1.244735     0.6834853</code></pre>
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb497-1" title="1">df.decompose.tomean.first &lt;-<span class="st"> </span>df.decompose_step2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb497-2" title="2"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">pred_new =</span> df.decompose_step2<span class="op">$</span>value <span class="op">+</span></a>
<a class="sourceLine" id="cb497-3" title="3"><span class="st">        </span><span class="kw">rowSums</span>((df.decompose_step2[<span class="kw">paste0</span>(vars.tomean.first, <span class="st">&#39;_mean&#39;</span>)] <span class="op">-</span><span class="st"> </span>df.decompose_step2[vars.tomean.first])</a>
<a class="sourceLine" id="cb497-4" title="4">            <span class="op">*</span>df.coef[df.decompose_step2<span class="op">$</span>variable, <span class="kw">paste0</span>(vars.tomean.first, str.esti.suffix)])) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb497-5" title="5"><span class="st">        </span><span class="kw">select</span>(variable, value, pred_new)</a>
<a class="sourceLine" id="cb497-6" title="6"><span class="kw">head</span>(df.decompose.tomean.first, <span class="dv">10</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##    variable value pred_new
##    &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1 hgt       70.2     71.2
##  2 hgt       75.8     76.8
##  3 hgt       66.3     64.7
##  4 hgt       69.2     67.6
##  5 hgt       75.3     73.7
##  6 hgt       68.1     66.1
##  7 hgt       74.1     72.1
##  8 hgt       77.1     75.1
##  9 hgt       71.5     69.0
## 10 hgt       77.8     75.3</code></pre>
<div class="sourceCode" id="cb499"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb499-1" title="1">df.decompose.tomean.first <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb499-2" title="2"><span class="st">        </span><span class="kw">group_by</span>(variable) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb499-3" title="3"><span class="st">        </span><span class="kw">summarize_all</span>(<span class="kw">funs</span>(<span class="dt">mean =</span> mean, <span class="dt">sd =</span> sd))</a></code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   variable value_mean pred_new_mean value_sd pred_new_sd
##   &lt;chr&gt;         &lt;dbl&gt;         &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;
## 1 hgt            73.4          73.4     4.68        4.53
## 2 wgt          8808.         8808.   1722.       1695.</code></pre>
<p>Note the r-square from regression above matches up with the 1 - ratio below. This is the proper decomposition method that is equivalent to r2.</p>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb501-1" title="1">df.decompose_step2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb501-2" title="2"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">pred_new =</span> df.decompose_step2<span class="op">$</span>value <span class="op">+</span></a>
<a class="sourceLine" id="cb501-3" title="3"><span class="st">        </span><span class="kw">rowSums</span>((df.decompose_step2[<span class="kw">paste0</span>(vars.tomean.second, <span class="st">&#39;_mean&#39;</span>)] <span class="op">-</span><span class="st"> </span>df.decompose_step2[vars.tomean.second])</a>
<a class="sourceLine" id="cb501-4" title="4">            <span class="op">*</span>df.coef[df.decompose_step2<span class="op">$</span>variable, <span class="kw">paste0</span>(vars.tomean.second, str.esti.suffix)])) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb501-5" title="5"><span class="st">        </span><span class="kw">select</span>(variable, value, pred_new) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb501-6" title="6"><span class="st">        </span><span class="kw">group_by</span>(variable) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb501-7" title="7"><span class="st">        </span><span class="kw">summarize_all</span>(<span class="kw">funs</span>(<span class="dt">mean =</span> mean, <span class="dt">var =</span> var)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb501-8" title="8"><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">ratio =</span> (pred_new_var<span class="op">/</span>value_var))</a></code></pre></div>
<pre><code>## # A tibble: 2 x 6
##   variable value_mean pred_new_mean value_var pred_new_var ratio
##   &lt;chr&gt;         &lt;dbl&gt;         &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt; &lt;dbl&gt;
## 1 hgt            73.4          73.4      21.9         25.4 1.16 
## 2 wgt          8808.         8808.  2965693.     2949188.  0.994</code></pre>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="panel.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="nonlinear-regression.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Panel Data and Optimization with R.pdf", "Panel Data and Optimization with R.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
